# ConfiguraciÃ³n en EspaÃ±ol para GitHub Actions y Issues
# Este archivo define templates y configuraciones para mantener todo en espaÃ±ol

name: ConfiguraciÃ³n en EspaÃ±ol - Templates y Etiquetas

on:
  workflow_dispatch:
    inputs:
      setup_type:
        description: 'Tipo de configuraciÃ³n a ejecutar'
        required: true
        default: 'labels'
        type: choice
        options:
          - labels
          - templates
          - both

permissions:
  contents: write
  issues: write
  pull-requests: write

jobs:
  configurar-espanol:
    name: Configurar Proyecto en EspaÃ±ol
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout del Repositorio
      uses: actions/checkout@v4

    - name: ðŸ·ï¸ Configurar Etiquetas en EspaÃ±ol
      if: ${{ github.event.inputs.setup_type == 'labels' || github.event.inputs.setup_type == 'both' }}
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const labels = [
            { name: 'error', color: 'B60205', description: 'Algo no funciona correctamente' },
            { name: 'mejora', color: '0075CA', description: 'Nueva funcionalidad o solicitud' },
            { name: 'copilot-agent', color: '6F42C1', description: 'Asignado al GitHub Copilot Agent' },
            { name: 'mejora-build', color: 'FFC107', description: 'Mejoras en el sistema de build' },
            { name: 'automatizacion', color: '00D4AA', description: 'AutomatizaciÃ³n y CI/CD' },
            { name: 'react', color: '61DAFB', description: 'Relacionado con React' },
            { name: 'firebase', color: 'FFA000', description: 'Relacionado con Firebase' },
            { name: 'alimentacion', color: '4CAF50', description: 'App de alimentaciÃ³n bovina' },
            { name: 'combustibles', color: 'FF5722', description: 'App de gestiÃ³n de combustibles' },
            { name: 'lint', color: 'E91E63', description: 'Problemas de linting' },
            { name: 'documentacion', color: '0366D6', description: 'Mejoras o adiciones a la documentaciÃ³n' },
            { name: 'urgente', color: 'D73A49', description: 'Requiere atenciÃ³n inmediata' },
            { name: 'ayuda-buscada', color: '128A0C', description: 'Se busca ayuda adicional de la comunidad' },
            { name: 'no-vÃ¡lido', color: 'FFFFFF', description: 'Este issue o PR no es vÃ¡lido' }
          ];

          console.log('ðŸ·ï¸ Configurando etiquetas en espaÃ±ol...');
          
          for (const label of labels) {
            try {
              await github.rest.issues.createLabel({
                owner: context.repo.owner,
                repo: context.repo.repo,
                name: label.name,
                color: label.color,
                description: label.description
              });
              console.log(`âœ… Etiqueta creada: ${label.name}`);
            } catch (error) {
              if (error.status === 422) {
                // Label already exists, update it
                await github.rest.issues.updateLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  name: label.name,
                  color: label.color,
                  description: label.description
                });
                console.log(`ðŸ“ Etiqueta actualizada: ${label.name}`);
              } else {
                console.log(`âŒ Error con etiqueta ${label.name}: ${error.message}`);
              }
            }
          }

    - name: ðŸ“ Crear Templates de Issues en EspaÃ±ol
      if: ${{ github.event.inputs.setup_type == 'templates' || github.event.inputs.setup_type == 'both' }}
      run: |
        mkdir -p .github/ISSUE_TEMPLATE
        
        # Template para reportar errores
        cat > .github/ISSUE_TEMPLATE/reporte-error.yml << 'EOF'
        name: ðŸ› Reporte de Error
        description: Reporta un error o problema con el sistema
        title: "[ERROR] "
        labels: ["error"]
        body:
          - type: markdown
            attributes:
              value: |
                Gracias por reportar un error. Por favor llena la informaciÃ³n a continuaciÃ³n.
                
          - type: textarea
            id: descripcion
            attributes:
              label: DescripciÃ³n del Error
              description: Describe quÃ© error estÃ¡s experimentando
              placeholder: Explica quÃ© sucediÃ³ y quÃ© esperabas que sucediera
            validations:
              required: true
              
          - type: dropdown
            id: aplicacion
            attributes:
              label: AplicaciÃ³n Afectada
              description: Â¿En quÃ© aplicaciÃ³n ocurre el error?
              options:
                - alimentacion (App de alimentaciÃ³n bovina)
                - combustibles (App de gestiÃ³n de combustibles)
                - shared (Componentes compartidos)
                - build/ci (Sistema de construcciÃ³n)
                - documentacion
            validations:
              required: true
              
          - type: textarea
            id: pasos
            attributes:
              label: Pasos para Reproducir
              description: Lista los pasos para reproducir el error
              placeholder: |
                1. Navega a...
                2. Haz clic en...
                3. El error aparece...
            validations:
              required: true
              
          - type: textarea
            id: logs
            attributes:
              label: Logs de Error
              description: Copia cualquier mensaje de error de la consola
              render: shell
        EOF
        
        # Template para solicitar mejoras
        cat > .github/ISSUE_TEMPLATE/solicitud-mejora.yml << 'EOF'
        name: âœ¨ Solicitud de Mejora
        description: Sugiere una nueva funcionalidad o mejora
        title: "[MEJORA] "
        labels: ["mejora"]
        body:
          - type: markdown
            attributes:
              value: |
                Â¡Gracias por tu sugerencia! Describe tu idea para mejorar Forestech.
                
          - type: textarea
            id: problema
            attributes:
              label: Â¿QuÃ© problema resuelve esta mejora?
              description: Describe el problema o necesidad que esta mejora abordarÃ­a
              placeholder: Explica la situaciÃ³n actual y por quÃ© necesita mejorarse
            validations:
              required: true
              
          - type: textarea
            id: solucion
            attributes:
              label: SoluciÃ³n Propuesta
              description: Describe tu idea para resolver el problema
              placeholder: Explica cÃ³mo deberÃ­a funcionar la nueva funcionalidad
            validations:
              required: true
              
          - type: dropdown
            id: aplicacion
            attributes:
              label: AplicaciÃ³n Objetivo
              description: Â¿Para quÃ© aplicaciÃ³n es esta mejora?
              options:
                - alimentacion (App de alimentaciÃ³n bovina)
                - combustibles (App de gestiÃ³n de combustibles)
                - shared (Componentes compartidos)
                - documentacion
                - general (Todo el proyecto)
            validations:
              required: true
              
          - type: dropdown
            id: prioridad
            attributes:
              label: Prioridad
              description: Â¿QuÃ© tan importante es esta mejora?
              options:
                - Baja (serÃ­a bueno tenerla)
                - Media (mejorarÃ­a la experiencia)
                - Alta (necesaria para el proyecto)
                - CrÃ­tica (bloquea otras funcionalidades)
            validations:
              required: true
        EOF
        
        echo "âœ… Templates de issues creados en espaÃ±ol"

    - name: ðŸ“‹ Crear Template de Pull Request en EspaÃ±ol
      if: ${{ github.event.inputs.setup_type == 'templates' || github.event.inputs.setup_type == 'both' }}
      run: |
        mkdir -p .github
        
        cat > .github/pull_request_template.md << 'EOF'
        ## ðŸ“‹ DescripciÃ³n
        
        Describe brevemente los cambios realizados en este PR.
        
        ## ðŸŽ¯ Tipo de Cambio
        
        - [ ] ðŸ› CorrecciÃ³n de error (fix)
        - [ ] âœ¨ Nueva funcionalidad (feature)
        - [ ] ðŸ”§ Refactoring
        - [ ] ðŸ“ DocumentaciÃ³n
        - [ ] ðŸŽ¨ Mejoras de UI/UX
        - [ ] âš¡ Mejoras de rendimiento
        - [ ] ðŸ§ª Tests
        
        ## ðŸš€ AplicaciÃ³n Afectada
        
        - [ ] ðŸ„ alimentacion (App de alimentaciÃ³n bovina)
        - [ ] â›½ combustibles (App de gestiÃ³n de combustibles)
        - [ ] ðŸ”— shared (Componentes compartidos)
        - [ ] ðŸ—ï¸ build/ci (Sistema de construcciÃ³n)
        - [ ] ðŸ“š documentacion
        
        ## âœ… Checklist
        
        - [ ] Mi cÃ³digo sigue los estÃ¡ndares del proyecto
        - [ ] He realizado una auto-revisiÃ³n de mi cÃ³digo
        - [ ] He comentado mi cÃ³digo, especialmente en Ã¡reas difÃ­ciles de entender
        - [ ] He realizado los cambios correspondientes en la documentaciÃ³n
        - [ ] Mis cambios no generan nuevas advertencias
        - [ ] He agregado tests que prueban que mi fix es efectivo o que mi feature funciona
        - [ ] Los tests unitarios nuevos y existentes pasan localmente con mis cambios
        
        ## ðŸ§ª CÃ³mo se ha probado
        
        Describe las pruebas que realizaste para verificar tus cambios:
        
        - [ ] Test A
        - [ ] Test B
        
        **ConfiguraciÃ³n de prueba**:
        * VersiÃ³n del firmware:
        * Hardware:
        * Toolchain:
        * SDK:
        
        ## ðŸ“± Capturas de pantalla (si aplica)
        
        Agrega capturas de pantalla para ayudar a explicar tu cambio.
        
        ## ðŸ“ Notas adicionales
        
        Agrega cualquier otra informaciÃ³n sobre este PR aquÃ­.
        EOF
        
        echo "âœ… Template de pull request creado en espaÃ±ol"

    - name: ðŸŽ‰ Commit de Templates y ConfiguraciÃ³n
      if: ${{ github.event.inputs.setup_type == 'templates' || github.event.inputs.setup_type == 'both' }}
      run: |
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        git add .github/ISSUE_TEMPLATE/ .github/pull_request_template.md
        if git diff --staged --quiet; then
          echo "No hay cambios para commitear"
        else
          git commit -m "ðŸ‡ªðŸ‡¸ Agregar templates en espaÃ±ol para issues y PRs
          
          - Templates de issues para reportes de errores y solicitudes de mejora
          - Template de pull request con checklist en espaÃ±ol
          - ConfiguraciÃ³n adaptada al proyecto Forestech Colombia"
          git push
          echo "âœ… Templates commiteados y pusheados"
        fi

    - name: ðŸ“Š Resumen de ConfiguraciÃ³n
      run: |
        echo "ðŸ‡ªðŸ‡¸ Â¡ConfiguraciÃ³n en espaÃ±ol completada!"
        echo ""
        echo "âœ… Configuraciones aplicadas:"
        if [[ "${{ github.event.inputs.setup_type }}" == "labels" || "${{ github.event.inputs.setup_type }}" == "both" ]]; then
          echo "  ðŸ·ï¸  Etiquetas en espaÃ±ol configuradas"
        fi
        if [[ "${{ github.event.inputs.setup_type }}" == "templates" || "${{ github.event.inputs.setup_type }}" == "both" ]]; then
          echo "  ðŸ“ Templates de issues y PRs en espaÃ±ol"
        fi
        echo ""
        echo "ðŸŽ¯ CaracterÃ­sticas del sistema en espaÃ±ol:"
        echo "  â€¢ Issues automÃ¡ticos en espaÃ±ol"
        echo "  â€¢ Workflows con nombres y mensajes en espaÃ±ol"
        echo "  â€¢ Claude configurado para responder en espaÃ±ol"
        echo "  â€¢ Copilot Agent con instrucciones en espaÃ±ol"
        echo "  â€¢ Templates de issues y PRs adaptados a Forestech"
        echo ""
        echo "ðŸš€ El proyecto Forestech ahora estÃ¡ completamente configurado en espaÃ±ol!"
