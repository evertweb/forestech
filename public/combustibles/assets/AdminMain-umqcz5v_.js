import{u as I,r as t,a8 as c,a9 as S,j as e,aa as A,ab as k}from"./index-ZNlzdefS.js";const w=()=>{const{user:n,userProfile:h}=I(),[r,u]=t.useState("invitations"),[m,N]=t.useState([]),[b,x]=t.useState(!1),[p,l]=t.useState(!1),[j,v]=t.useState(!1),[i,o]=t.useState({email:"",name:"",role:c.CLIENTE});t.useEffect(()=>{n&&h?.role==="admin"&&d()},[n,h,d]);const d=t.useCallback(async()=>{if(n){x(!0);try{const s=await S(n.uid);s.success?N(s.invitations):console.error("Error loading invitations:",s.error)}catch(s){console.error("Error loading invitations:",s)}finally{x(!1)}}},[n]),C=async s=>{s.preventDefault(),v(!0);try{const a=await k(i,n.uid);a.success?(o({email:"",name:"",role:c.CLIENTE}),l(!1),await d(),alert(`Invitaci√≥n creada exitosamente!
C√≥digo: ${a.invitation.code}`)):alert(`Error: ${a.error}`)}catch(a){console.error("Error creating invitation:",a),alert("Error creando invitaci√≥n")}finally{v(!1)}},f=async s=>{if(confirm("¬øEst√°s seguro de cancelar esta invitaci√≥n?"))try{const a=await A(s,n.uid);a.success?(await d(),alert("Invitaci√≥n cancelada exitosamente")):alert(`Error: ${a.error}`)}catch(a){console.error("Error cancelling invitation:",a),alert("Error cancelando invitaci√≥n")}},E=s=>({pending:{text:"Pendiente",class:"status-pending"},used:{text:"Usada",class:"status-used"},cancelled:{text:"Cancelada",class:"status-cancelled"},expired:{text:"Expirada",class:"status-expired"}})[s]||{text:s,class:"status-unknown"},y=s=>({admin:"Administrador",contador:"Contador",cliente:"Cliente"})[s]||s,g=s=>s?(s.toDate?s.toDate():new Date(s)).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";return h?.role!=="admin"?e.jsxs("div",{className:"admin-unauthorized",children:[e.jsx("h2",{children:"‚õî Acceso Denegado"}),e.jsx("p",{children:"Solo los administradores pueden acceder a esta secci√≥n."})]}):e.jsxs("div",{className:"admin-main",children:[e.jsxs("div",{className:"admin-header",children:[e.jsx("h1",{children:"‚öôÔ∏è Administraci√≥n del Sistema"}),e.jsx("p",{children:"Gesti√≥n de usuarios y configuraciones"})]}),e.jsxs("div",{className:"admin-tabs",children:[e.jsx("button",{className:`tab-button ${r==="invitations"?"active":""}`,onClick:()=>u("invitations"),children:"üé´ Invitaciones"}),e.jsx("button",{className:`tab-button ${r==="users"?"active":""}`,onClick:()=>u("users"),children:"üë• Usuarios"}),e.jsx("button",{className:`tab-button ${r==="settings"?"active":""}`,onClick:()=>u("settings"),children:"‚öôÔ∏è Configuraci√≥n"})]}),e.jsxs("div",{className:"admin-content",children:[r==="invitations"&&e.jsxs("div",{className:"invitations-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"Gesti√≥n de Invitaciones"}),e.jsx("button",{className:"create-button",onClick:()=>l(!0),children:"+ Crear Invitaci√≥n"})]}),b?e.jsx("div",{className:"loading",children:"Cargando invitaciones..."}):e.jsxs("div",{className:"invitations-table",children:[e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"C√≥digo"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Rol"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Creada"}),e.jsx("th",{children:"Expira"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:m.map(s=>{const a=E(s.status);return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{className:"invitation-code",children:s.code})}),e.jsx("td",{children:s.targetEmail}),e.jsx("td",{children:s.targetName||"-"}),e.jsx("td",{children:y(s.targetRole)}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${a.class}`,children:a.text})}),e.jsx("td",{children:g(s.createdAt)}),e.jsx("td",{children:g(s.expiresAt)}),e.jsx("td",{children:s.status==="pending"&&e.jsx("button",{className:"cancel-button",onClick:()=>f(s.id),children:"Cancelar"})})]},s.id)})})]}),m.length===0&&e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No hay invitaciones creadas"})})]})]}),r==="users"&&e.jsxs("div",{className:"users-section",children:[e.jsx("h2",{children:"üë• Usuarios del Sistema"}),e.jsxs("div",{className:"coming-soon",children:[e.jsx("span",{children:"üöß En desarrollo"}),e.jsx("p",{children:"Pr√≥ximamente: Lista de usuarios registrados, edici√≥n de permisos, y estad√≠sticas."})]})]}),r==="settings"&&e.jsxs("div",{className:"settings-section",children:[e.jsx("h2",{children:"‚öôÔ∏è Configuraci√≥n del Sistema"}),e.jsxs("div",{className:"coming-soon",children:[e.jsx("span",{children:"üöß En desarrollo"}),e.jsx("p",{children:"Pr√≥ximamente: Configuraciones generales, notificaciones, y par√°metros del sistema."})]})]})]}),p&&e.jsx("div",{className:"modal-overlay",onClick:()=>l(!1),children:e.jsxs("div",{className:"modal-content",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Crear Nueva Invitaci√≥n"}),e.jsx("button",{className:"modal-close",onClick:()=>l(!1),children:"√ó"})]}),e.jsxs("form",{onSubmit:C,className:"invitation-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email del usuario:"}),e.jsx("input",{id:"email",type:"email",required:!0,value:i.email,onChange:s=>o({...i,email:s.target.value}),placeholder:"usuario@ejemplo.com"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Nombre (opcional):"}),e.jsx("input",{id:"name",type:"text",value:i.name,onChange:s=>o({...i,name:s.target.value}),placeholder:"Nombre del usuario"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"role",children:"Rol:"}),e.jsxs("select",{id:"role",value:i.role,onChange:s=>o({...i,role:s.target.value}),children:[e.jsx("option",{value:c.CLIENTE,children:"Cliente"}),e.jsx("option",{value:c.CONTADOR,children:"Contador"}),e.jsx("option",{value:c.ADMIN,children:"Administrador"})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"cancel-button",onClick:()=>l(!1),children:"Cancelar"}),e.jsx("button",{type:"submit",className:"create-button",disabled:j,children:j?"Creando...":"Crear Invitaci√≥n"})]})]})]})})]})};export{w as default};
