import{u as b,r as m,j as e,f as p,a as k}from"./index-M96RpLqe.js";const S=(n=[])=>{if(!Array.isArray(n)||n.length===0){console.warn("ðŸ“‹ Inventario vacÃ­o o no vÃ¡lido");return}console.group("ðŸ“‹ Estado Actual del Inventario"),console.log(`Total de items: ${n.length}`);const o=n.reduce((a,i)=>a+(parseFloat(i.currentStock)||0),0);console.log(`Stock total: ${o.toFixed(2)} galones`);const l=n.filter(a=>typeof a.currentStock>"u"||isNaN(parseFloat(a.currentStock))||a.currentStock!==a.quantity&&typeof a.quantity<"u");l.length>0&&(console.warn(`âš ï¸ ${l.length} items con posibles problemas de datos:`),l.forEach(a=>{console.warn(`- ${a.fuelType||a.name||"Item sin nombre"}: currentStock=${a.currentStock}, quantity=${a.quantity}`)}));const r={};n.forEach(a=>{const i=a.fuelType||"Desconocido";r[i]||(r[i]=0),r[i]+=parseFloat(a.currentStock)||0}),console.log("Stock por tipo de combustible:"),Object.entries(r).forEach(([a,i])=>{console.log(`- ${a}: ${i.toFixed(2)} gal`)}),console.groupEnd()},y=(n=[])=>{if(!Array.isArray(n)||n.length===0)return[];const o={},l=[];return n.forEach(r=>{const a=`${r.fuelType||""}:${r.location||""}`;o[a]?(o[a].push(r),o[a].length===2?l.push(...o[a]):o[a].length>2&&l.push(r)):o[a]=[r]}),l},A=()=>{const{inventory:n,movements:o,vehicles:l,loading:r,error:a}=b();m.useEffect(()=>{if(!r&&n.length>0){console.log("ðŸ” Ejecutando diagnÃ³stico del inventario..."),S(n);const s=y(n);s.length>0&&(console.warn(`âš ï¸ Se detectaron ${s.length} posibles items duplicados:`),console.table(s.map(c=>({id:c.id,tipo:c.fuelType,ubicacion:c.location,stock:c.currentStock}))))}},[r,n]);const i=s=>s?s.toDate&&typeof s.toDate=="function"?s.toDate():s.seconds?new Date(s.seconds*1e3):s instanceof Date?s:new Date(s):new Date,d=m.useMemo(()=>{const s=l.filter(t=>t.status==="activo").length,c=o.filter(t=>t.status==="pendiente").length;console.log("Inventario en DashboardMain:",n.map(t=>({id:t.id,fuelType:t.fuelType,currentStock:t.currentStock,pricePerUnit:t.pricePerUnit||t.unitPrice})));const u=n.filter(t=>t.status==="active").reduce((t,h)=>{const j=parseFloat(h.currentStock)||0;return console.log(`Sumando stock de ${h.fuelType}: ${j} gal`),t+j},0),f=n.filter(t=>t.isActive!==!1).reduce((t,h)=>{const j=parseFloat(h.currentStock)||0,g=parseFloat(h.pricePerUnit||h.unitPrice)||0;return t+j*g},0),N=n.filter(t=>{const h=parseFloat(t.currentStock)||0,j=parseFloat(t.minStock)||parseFloat(t.minThreshold)||20;return t.isActive!==!1&&h<=j}).length;return{totalFuel:u,totalValue:f,lowStockAlerts:N,activeInventoryItems:n.filter(t=>t.isActive!==!1).length,activeVehicles:s,pendingMovements:c,totalMaintenance:0,overdueMaintenance:0}},[n,l,o]),x=m.useMemo(()=>o.sort((s,c)=>i(c.createdAt).getTime()-i(s.createdAt).getTime()).slice(0,5),[o]),v=s=>{const c=s.quantity||0,u=s.fuelType||"N/A";switch(s.type){case"entrada":return`Entrada de ${c} gal de ${u}.`;case"salida":return`Salida de ${c} gal para vehÃ­culo ${s.vehicleId||"N/A"}.`;case"transferencia":return`Transferencia de ${c} gal.`;case"ajuste":return`Ajuste de inventario: ${c} gal de ${u}.`;default:return"Movimiento registrado."}};return r?e.jsxs("div",{className:"dashboard-main",children:[e.jsx("h1",{className:"dashboard-title",children:"Dashboard Operativo"}),e.jsx("p",{className:"dashboard-subtitle",children:"Cargando datos en tiempo real..."}),e.jsx("div",{className:"loading-spinner-container",children:e.jsx("div",{className:"loading-spinner"})})]}):a?e.jsxs("div",{className:"dashboard-main",children:[e.jsx("h1",{className:"dashboard-title",children:"Dashboard Operativo"}),e.jsxs("div",{className:"error-message",children:[e.jsxs("p",{children:["âš ï¸ ",a]}),e.jsx("button",{onClick:()=>window.location.reload(),children:"Reintentar"})]})]}):e.jsxs("div",{className:"dashboard-main",children:[e.jsx("h1",{className:"dashboard-title",children:"Dashboard Operativo"}),e.jsx("p",{className:"dashboard-subtitle",children:"Resumen general del estado de combustibles y maquinaria."}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon fuel-icon",children:"ðŸ›¢ï¸"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("p",{children:"Combustible Total"}),e.jsxs("h2",{children:[p(d.totalFuel)," gal"]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon value-icon",children:"ðŸ’°"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("p",{children:"Valor Inventario"}),e.jsx("h2",{children:k(d.totalValue)})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon vehicle-icon",children:"ðŸšœ"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("p",{children:"VehÃ­culos Activos"}),e.jsx("h2",{children:p(d.activeVehicles)})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon movement-icon",children:"ðŸ”„"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("p",{children:"Movimientos Pendientes"}),e.jsx("h2",{children:p(d.pendingMovements)})]})]}),e.jsxs("div",{className:`stat-card ${d.lowStockAlerts>0?"alert":""}`,children:[e.jsx("div",{className:"stat-icon alert-icon",children:"âš ï¸"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("p",{children:"Alertas de Stock"}),e.jsx("h2",{children:p(d.lowStockAlerts)})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon maintenance-icon",children:"ðŸ”§"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("p",{children:"Mantenimientos"}),e.jsx("h2",{children:p(d.totalMaintenance)})]})]}),e.jsxs("div",{className:`stat-card ${d.overdueMaintenance>0?"alert":""}`,children:[e.jsx("div",{className:"stat-icon maintenance-alert-icon",children:"â°"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("p",{children:"Mantenimientos Vencidos"}),e.jsx("h2",{children:p(d.overdueMaintenance)})]})]})]}),e.jsxs("div",{className:"dashboard-content",children:[e.jsxs("div",{className:"dashboard-widget",children:[e.jsx("h3",{children:"Actividad Reciente"}),x.length>0?e.jsx("ul",{children:x.map(s=>e.jsxs("li",{children:[e.jsx("span",{className:`movement-type-badge ${s.type}`,children:s.type}),v(s),e.jsx("span",{className:"movement-date",children:i(s.createdAt).toLocaleDateString()})]},s.id))}):e.jsx("p",{children:"No hay movimientos recientes."})]}),e.jsxs("div",{className:"dashboard-widget",children:[e.jsx("h3",{children:"ðŸ“¦ Stock por Producto"}),n.length>0?e.jsx("div",{className:"products-summary",children:n.map(s=>{const c=parseFloat(s.currentStock)||0,u=parseFloat(s.minStock||s.minThreshold)||20;return e.jsxs("div",{className:"product-summary-item",children:[e.jsx("div",{className:"product-icon",children:"â›½"}),e.jsxs("div",{className:"product-info",children:[e.jsx("span",{className:"product-name",children:s.fuelType||s.name}),e.jsxs("div",{className:"product-stats",children:[e.jsxs("span",{className:"stock-value",children:[p(c)," gal"]}),e.jsx("span",{className:`stock-status ${c<=u?"low":"normal"}`,children:c<=u?"ðŸŸ¡ Stock bajo":"ðŸŸ¢ Normal"})]})]})]},s.id)})}):e.jsx("div",{className:"no-products",children:e.jsx("p",{children:"No hay inventario registrado."})})]})]})]})};export{A as default};
