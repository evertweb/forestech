import{u as S,r as m,j as e,f as p,a as $}from"./index-BQoCA6St.js";const T=(n=[])=>{if(!Array.isArray(n)||n.length===0){console.warn("📋 Inventario vacío o no válido");return}console.group("📋 Estado Actual del Inventario"),console.log(`Total de items: ${n.length}`);const r=n.reduce((a,d)=>a+(parseFloat(d.currentStock)||0),0);console.log(`Stock total: ${r.toFixed(2)} galones`);const i=n.filter(a=>typeof a.currentStock>"u"||isNaN(parseFloat(a.currentStock))||a.currentStock!==a.quantity&&typeof a.quantity<"u");i.length>0&&(console.warn(`⚠️ ${i.length} items con posibles problemas de datos:`),i.forEach(a=>{console.warn(`- ${a.fuelType||a.name||"Item sin nombre"}: currentStock=${a.currentStock}, quantity=${a.quantity}`)}));const o={};n.forEach(a=>{const d=a.fuelType||"Desconocido";o[d]||(o[d]=0),o[d]+=parseFloat(a.currentStock)||0}),console.log("Stock por tipo de combustible:"),Object.entries(o).forEach(([a,d])=>{console.log(`- ${a}: ${d.toFixed(2)} gal`)}),console.groupEnd()},A=(n=[])=>{if(!Array.isArray(n)||n.length===0)return[];const r={},i=[];return n.forEach(o=>{const a=`${o.fuelType||""}:${o.location||""}`;r[a]?(r[a].push(o),r[a].length===2?i.push(...r[a]):r[a].length>2&&i.push(o)):r[a]=[o]}),i},D=()=>{const{inventory:n,movements:r,vehicles:i,dataLoading:o,dataError:a,subscribeToInventory:d,subscribeToMovements:v,subscribeToVehicles:g}=S();m.useEffect(()=>{console.log("🚀 Dashboard iniciando suscripciones a datos...");const s=d(),c=v(),l=g();return()=>{typeof s=="function"&&s(),typeof c=="function"&&c(),typeof l=="function"&&l()}},[]),m.useEffect(()=>{if(!o&&n.length>0){console.log("🔍 Ejecutando diagnóstico del inventario..."),T(n);const s=A(n);s.length>0&&(console.warn(`⚠️ Se detectaron ${s.length} posibles items duplicados:`),console.table(s.map(c=>({id:c.id,tipo:c.fuelType,ubicacion:c.location,stock:c.currentStock}))))}},[o,n]);const j=s=>s?s.toDate&&typeof s.toDate=="function"?s.toDate():s.seconds?new Date(s.seconds*1e3):s instanceof Date?s:new Date(s):new Date,h=m.useMemo(()=>{const s=i.filter(t=>t.status==="activo").length,c=r.filter(t=>t.status==="pendiente").length;console.log("Inventario en DashboardMain:",n.map(t=>({id:t.id,fuelType:t.fuelType,currentStock:t.currentStock,pricePerUnit:t.pricePerUnit||t.unitPrice})));const l=n.filter(t=>t.status==="active").reduce((t,u)=>{const f=parseFloat(u.currentStock)||0;return console.log(`Sumando stock de ${u.fuelType}: ${f} gal`),t+f},0),b=n.filter(t=>t.isActive!==!1).reduce((t,u)=>{const f=parseFloat(u.currentStock)||0,y=parseFloat(u.pricePerUnit||u.unitPrice)||0;return t+f*y},0),k=n.filter(t=>{const u=parseFloat(t.currentStock)||0,f=parseFloat(t.minStock)||parseFloat(t.minThreshold)||20;return t.isActive!==!1&&u<=f}).length;return{totalFuel:l,totalValue:b,lowStockAlerts:k,activeInventoryItems:n.filter(t=>t.isActive!==!1).length,activeVehicles:s,pendingMovements:c,totalMaintenance:0,overdueMaintenance:0}},[n,i,r]),x=m.useMemo(()=>r.sort((s,c)=>j(c.createdAt).getTime()-j(s.createdAt).getTime()).slice(0,5),[r]),N=s=>{const c=s.quantity||0,l=s.fuelType||"N/A";switch(s.type){case"entrada":return`Entrada de ${c} gal de ${l}.`;case"salida":return`Salida de ${c} gal para vehículo ${s.vehicleId||"N/A"}.`;case"transferencia":return`Transferencia de ${c} gal.`;case"ajuste":return`Ajuste de inventario: ${c} gal de ${l}.`;default:return"Movimiento registrado."}};return o?e.jsxs("div",{className:"dashboard-main",children:[e.jsx("h1",{className:"dashboard-title",children:"Dashboard Operativo"}),e.jsx("p",{className:"dashboard-subtitle",children:"Cargando datos en tiempo real..."}),e.jsx("div",{className:"loading-spinner-container",children:e.jsx("div",{className:"loading-spinner"})})]}):a?e.jsxs("div",{className:"dashboard-main",children:[e.jsx("h1",{className:"dashboard-title",children:"Dashboard Operativo"}),e.jsxs("div",{className:"error-message",children:[e.jsxs("p",{children:["⚠️ ",a]}),e.jsx("button",{onClick:()=>window.location.reload(),children:"Reintentar"})]})]}):e.jsxs("div",{className:"dashboard-main",children:[e.jsx("h1",{className:"dashboard-title",children:"Dashboard Operativo"}),e.jsx("p",{className:"dashboard-subtitle",children:"Resumen general del estado de combustibles y maquinaria."}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon fuel-icon",children:"🛢️"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("p",{children:"Combustible Total"}),e.jsxs("h2",{children:[p(h.totalFuel)," gal"]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon value-icon",children:"💰"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("p",{children:"Valor Inventario"}),e.jsx("h2",{children:$(h.totalValue)})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon vehicle-icon",children:"🚜"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("p",{children:"Vehículos Activos"}),e.jsx("h2",{children:p(h.activeVehicles)})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon movement-icon",children:"🔄"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("p",{children:"Movimientos Pendientes"}),e.jsx("h2",{children:p(h.pendingMovements)})]})]}),e.jsxs("div",{className:`stat-card ${h.lowStockAlerts>0?"alert":""}`,children:[e.jsx("div",{className:"stat-icon alert-icon",children:"⚠️"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("p",{children:"Alertas de Stock"}),e.jsx("h2",{children:p(h.lowStockAlerts)})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon maintenance-icon",children:"🔧"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("p",{children:"Mantenimientos"}),e.jsx("h2",{children:p(h.totalMaintenance)})]})]}),e.jsxs("div",{className:`stat-card ${h.overdueMaintenance>0?"alert":""}`,children:[e.jsx("div",{className:"stat-icon maintenance-alert-icon",children:"⏰"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("p",{children:"Mantenimientos Vencidos"}),e.jsx("h2",{children:p(h.overdueMaintenance)})]})]})]}),e.jsxs("div",{className:"dashboard-content",children:[e.jsxs("div",{className:"dashboard-widget",children:[e.jsx("h3",{children:"Actividad Reciente"}),x.length>0?e.jsx("ul",{children:x.map(s=>e.jsxs("li",{children:[e.jsx("span",{className:`movement-type-badge ${s.type}`,children:s.type}),N(s),e.jsx("span",{className:"movement-date",children:j(s.createdAt).toLocaleDateString()})]},s.id))}):e.jsx("p",{children:"No hay movimientos recientes."})]}),e.jsxs("div",{className:"dashboard-widget",children:[e.jsx("h3",{children:"📦 Stock por Producto"}),n.length>0?e.jsx("div",{className:"products-summary",children:n.map(s=>{const c=parseFloat(s.currentStock)||0,l=parseFloat(s.minStock||s.minThreshold)||20;return e.jsxs("div",{className:"product-summary-item",children:[e.jsx("div",{className:"product-icon",children:"⛽"}),e.jsxs("div",{className:"product-info",children:[e.jsx("span",{className:"product-name",children:s.fuelType||s.name}),e.jsxs("div",{className:"product-stats",children:[e.jsxs("span",{className:"stock-value",children:[p(c)," gal"]}),e.jsx("span",{className:`stock-status ${c<=l?"low":"normal"}`,children:c<=l?"🟡 Stock bajo":"🟢 Normal"})]})]})]},s.id)})}):e.jsx("div",{className:"no-products",children:e.jsx("p",{children:"No hay inventario registrado."})})]})]})]})};export{D as default};
