import{k as O,b as _,L,a3 as H,N as P,P as ae,d as V,Q as te,i as B,s as R,W as re,e as $,j as e,f as I,a as F,r as p,u as ne}from"./index-erOuM6B7.js";const k="combustibles_maintenance",z="combustibles_vehicles",t={OIL_CHANGE:"oil_change",BATTERY_CHANGE:"battery_change",FILTER_CHANGE:"filter_change",GENERAL_MAINTENANCE:"general_maintenance"},h={COMPLETED:"completado",PENDING:"pendiente",CANCELLED:"cancelado"},D={NEW:"nueva",USED:"usada",REPAIRED:"reparada"},U={OIL_CHANGE_HOURS:250,BATTERY_LIFETIME_MONTHS:24},ie=async s=>{try{Ne(s);const a={...s,createdAt:R(),updatedAt:R(),status:s.status||h.COMPLETED,createdBy:s.createdBy||"system"};s.type===t.OIL_CHANGE&&(a.nextChangeHours=q(s.currentHours)),s.type===t.BATTERY_CHANGE&&(a.nextBatteryChange=me(s.date));const i=await re(O(_,k),a);return s.vehicleId&&s.currentHours&&await Q(s.vehicleId,s.currentHours),console.log("‚úÖ Mantenimiento creado exitosamente:",i.id),i.id}catch(a){throw console.error("‚ùå Error al crear mantenimiento:",a),new Error(`Error al crear mantenimiento: ${a.message}`)}},le=async(s={})=>{try{let a=O(_,k);s.type&&(a=L(a,H("type","==",s.type))),s.vehicleId&&(a=L(a,H("vehicleId","==",s.vehicleId))),s.status&&(a=L(a,H("status","==",s.status))),s.dateFrom&&(a=L(a,H("date",">=",new Date(s.dateFrom)))),s.dateTo&&(a=L(a,H("date","<=",new Date(s.dateTo)))),a=L(a,P("date","desc"));const i=await B(a),c=[];return i.forEach(l=>{c.push({id:l.id,...l.data()})}),c}catch(a){throw console.error("‚ùå Error al obtener mantenimientos:",a),new Error(`Error al obtener mantenimientos: ${a.message}`)}},ce=async(s,a)=>{try{xe(a);const i=V(_,k,s),c={...a,updatedAt:R()};a.currentHours&&a.type===t.OIL_CHANGE&&(c.nextChangeHours=q(a.currentHours)),await $(i,c),a.vehicleId&&a.currentHours&&await Q(a.vehicleId,a.currentHours),console.log("‚úÖ Mantenimiento actualizado exitosamente:",s)}catch(i){throw console.error("‚ùå Error al actualizar mantenimiento:",i),new Error(`Error al actualizar mantenimiento: ${i.message}`)}},oe=async s=>{try{const a=V(_,k,s);await te(a),console.log("‚úÖ Mantenimiento eliminado exitosamente:",s)}catch(a){throw console.error("‚ùå Error al eliminar mantenimiento:",a),new Error(`Error al eliminar mantenimiento: ${a.message}`)}},de=async(s={})=>{try{const a=await le(s),i={total:a.length,byType:{},byStatus:{},byVehicle:{},totalCost:0,averageCost:0,upcomingCount:0,overdueCount:0};let c=0;return a.forEach(l=>{i.byType[l.type]=(i.byType[l.type]||0)+1,i.byStatus[l.status]=(i.byStatus[l.status]||0)+1,i.byVehicle[l.vehicleId]=(i.byVehicle[l.vehicleId]||0)+1,l.cost&&(c+=parseFloat(l.cost)),l.nextChangeDate&&(new Date(l.nextChangeDate)>new Date?i.upcomingCount++:i.overdueCount++)}),i.totalCost=c,i.averageCost=i.total>0?c/i.total:0,i}catch(a){throw console.error("‚ùå Error al obtener estad√≠sticas de mantenimiento:",a),new Error(`Error al obtener estad√≠sticas de mantenimiento: ${a.message}`)}},ue=(s,a={})=>{try{let i=O(_,k);return a.type&&(i=L(i,H("type","==",a.type))),a.vehicleId&&(i=L(i,H("vehicleId","==",a.vehicleId))),a.status&&(i=L(i,H("status","==",a.status))),i=L(i,P("date","desc")),ae(i,l=>{const u=[];l.forEach(x=>{u.push({id:x.id,...x.data()})}),s(u,null)},l=>{console.error("‚ùå Error en suscripci√≥n de mantenimientos:",l),s([],l)})}catch(i){return console.error("‚ùå Error al suscribirse a mantenimientos:",i),s([],i),()=>{}}},he=async()=>{try{const s=L(O(_,z),H("status","in",["activo","mantenimiento"]),P("name","asc")),a=await B(s),i=[];return a.forEach(c=>{i.push({id:c.id,...c.data()})}),i}catch(s){throw console.error("‚ùå Error al obtener veh√≠culos para mantenimiento:",s),new Error(`Error al obtener veh√≠culos para mantenimiento: ${s.message}`)}},q=s=>parseInt(s)+U.OIL_CHANGE_HOURS,me=s=>{const a=new Date(s);return a.setMonth(a.getMonth()+U.BATTERY_LIFETIME_MONTHS),a},Q=async(s,a)=>{try{const i=L(O(_,z),H("vehicleId","==",s)),c=await B(i);if(!c.empty){const l=c.docs[0],u=l.data();if(u.hasHourMeter&&u.type==="tractor"){const x=parseInt(u.currentHours)||0,d=parseInt(a)||0;d>x&&(await $(l.ref,{currentHours:d,lastHourMeterDate:R(),updatedAt:R()}),console.log(`‚úÖ Hor√≥metro actualizado para ${s}: ${x} ‚Üí ${d}`))}}}catch(i){console.error("‚ùå Error al actualizar hor√≥metro del veh√≠culo:",i)}},Ne=s=>{const a=[];if(s.type||a.push("El tipo de mantenimiento es obligatorio"),s.vehicleId||a.push("El veh√≠culo es obligatorio"),s.date||a.push("La fecha es obligatoria"),s.type===t.OIL_CHANGE&&((!s.quantity||s.quantity<=0)&&a.push("La cantidad de aceite es obligatoria y debe ser mayor a 0"),(!s.currentHours||s.currentHours<0)&&a.push("La lectura del hor√≥metro es obligatoria")),s.type===t.BATTERY_CHANGE&&(s.batteryType||a.push("El tipo de bater√≠a es obligatorio"),(!s.cost||s.cost<=0)&&a.push("El costo de la bater√≠a es obligatorio")),a.length>0)throw new Error(a.join(", "))},xe=s=>{const a=[];if(s.type&&!Object.values(t).includes(s.type)&&a.push("Tipo de mantenimiento inv√°lido"),s.status&&!Object.values(h).includes(s.status)&&a.push("Estado de mantenimiento inv√°lido"),s.batteryStatus&&!Object.values(D).includes(s.batteryStatus)&&a.push("Estado de bater√≠a inv√°lido"),a.length>0)throw new Error(a.join(", "))},je=({stats:s})=>{if(!s)return null;const a=u=>{switch(u){case t.OIL_CHANGE:return"üõ¢Ô∏è";case t.BATTERY_CHANGE:return"üîã";case t.FILTER_CHANGE:return"üîß";case t.GENERAL_MAINTENANCE:return"‚öôÔ∏è";default:return"üîß"}},i=u=>{switch(u){case t.OIL_CHANGE:return"Cambios de Aceite";case t.BATTERY_CHANGE:return"Cambios de Bater√≠a";case t.FILTER_CHANGE:return"Cambios de Filtros";case t.GENERAL_MAINTENANCE:return"Mantenimientos Generales";default:return u}},c=u=>{switch(u){case h.COMPLETED:return"#10b981";case h.PENDING:return"#f59e0b";case h.CANCELLED:return"#ef4444";default:return"#6b7280"}},l=u=>{switch(u){case h.COMPLETED:return"Completados";case h.PENDING:return"Pendientes";case h.CANCELLED:return"Cancelados";default:return u}};return e.jsxs("div",{className:"maintenance-stats",children:[e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card primary",children:[e.jsx("div",{className:"stat-icon",children:"üîß"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:I(s.total)}),e.jsx("p",{children:"Total Mantenimientos"})]})]}),e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-icon",children:"üí∞"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:F(s.totalCost)}),e.jsx("p",{children:"Costo Total"})]})]}),e.jsxs("div",{className:"stat-card warning",children:[e.jsx("div",{className:"stat-icon",children:"‚è∞"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:I(s.upcomingCount)}),e.jsx("p",{children:"Pr√≥ximos"})]})]}),e.jsxs("div",{className:"stat-card danger",children:[e.jsx("div",{className:"stat-icon",children:"‚ö†Ô∏è"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:I(s.overdueCount)}),e.jsx("p",{children:"Vencidos"})]})]})]}),Object.keys(s.byType).length>0&&e.jsxs("div",{className:"stats-breakdown",children:[e.jsx("h3",{children:"üìä Desglose por Tipo"}),e.jsx("div",{className:"breakdown-grid",children:Object.entries(s.byType).map(([u,x])=>e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-header",children:[e.jsx("span",{className:"breakdown-icon",children:a(u)}),e.jsx("span",{className:"breakdown-label",children:i(u)})]}),e.jsx("div",{className:"breakdown-value",children:I(x)}),e.jsx("div",{className:"breakdown-bar",children:e.jsx("div",{className:"breakdown-fill",style:{width:`${x/s.total*100}%`,backgroundColor:"#3b82f6"}})}),e.jsxs("div",{className:"breakdown-percentage",children:[(x/s.total*100).toFixed(1),"%"]})]},u))})]}),Object.keys(s.byStatus).length>0&&e.jsxs("div",{className:"stats-breakdown",children:[e.jsx("h3",{children:"üìà Desglose por Estado"}),e.jsx("div",{className:"breakdown-grid",children:Object.entries(s.byStatus).map(([u,x])=>e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-header",children:[e.jsx("span",{className:"status-dot",style:{backgroundColor:c(u)}}),e.jsx("span",{className:"breakdown-label",children:l(u)})]}),e.jsx("div",{className:"breakdown-value",children:I(x)}),e.jsx("div",{className:"breakdown-bar",children:e.jsx("div",{className:"breakdown-fill",style:{width:`${x/s.total*100}%`,backgroundColor:c(u)}})}),e.jsxs("div",{className:"breakdown-percentage",children:[(x/s.total*100).toFixed(1),"%"]})]},u))})]}),e.jsxs("div",{className:"stats-insights",children:[e.jsx("h3",{children:"üí° Insights"}),e.jsxs("div",{className:"insights-grid",children:[e.jsxs("div",{className:"insight-item",children:[e.jsx("span",{className:"insight-label",children:"Costo Promedio:"}),e.jsx("span",{className:"insight-value",children:F(s.averageCost)})]}),s.overdueCount>0&&e.jsxs("div",{className:"insight-item alert",children:[e.jsx("span",{className:"insight-label",children:"‚ö†Ô∏è Mantenimientos Vencidos:"}),e.jsxs("span",{className:"insight-value",children:[I(s.overdueCount)," requieren atenci√≥n"]})]}),s.upcomingCount>0&&e.jsxs("div",{className:"insight-item info",children:[e.jsx("span",{className:"insight-label",children:"‚è∞ Pr√≥ximos Mantenimientos:"}),e.jsxs("span",{className:"insight-value",children:[I(s.upcomingCount)," programados"]})]})]})]})]})},ve=({filters:s,onFilterChange:a,onClearFilters:i,searchTerm:c,onSearchChange:l,viewMode:u,onViewModeChange:x,totalResults:d})=>{const b=m=>{switch(m){case t.OIL_CHANGE:return"Cambio de Aceite";case t.BATTERY_CHANGE:return"Cambio de Bater√≠a";case t.FILTER_CHANGE:return"Cambio de Filtros";case t.GENERAL_MAINTENANCE:return"Mantenimiento General";default:return m}},j=m=>{switch(m){case h.COMPLETED:return"Completado";case h.PENDING:return"Pendiente";case h.CANCELLED:return"Cancelado";default:return m}},E=(m,n)=>{a({[m]:n})},A=m=>{a(m)},C=()=>Object.values(s).some(m=>m!=="")||c;return e.jsx("div",{className:"maintenance-filters",children:e.jsxs("div",{className:"filters-main",children:[e.jsx("div",{className:"search-section",children:e.jsxs("div",{className:"search-box",children:[e.jsx("span",{className:"search-icon",children:"üîç"}),e.jsx("input",{type:"text",className:"search-input",placeholder:"Buscar mantenimientos...",value:c,onChange:m=>l(m.target.value)}),c&&e.jsx("button",{className:"search-clear",onClick:()=>l(""),children:"√ó"})]})}),e.jsxs("div",{className:"filters-controls",children:[e.jsxs("div",{className:"quick-filters",children:[e.jsx("button",{className:`quick-filter ${C()?"":"active"}`,onClick:()=>i(),children:"Todos"}),e.jsx("button",{className:`quick-filter ${s.type===t.OIL_CHANGE?"active":""}`,onClick:()=>A({type:t.OIL_CHANGE}),children:"üõ¢Ô∏è Aceite"}),e.jsx("button",{className:`quick-filter ${s.type===t.BATTERY_CHANGE?"active":""}`,onClick:()=>A({type:t.BATTERY_CHANGE}),children:"üîã Bater√≠as"}),e.jsx("button",{className:`quick-filter ${s.status===h.PENDING?"active":""}`,onClick:()=>A({status:h.PENDING}),children:"‚è∞ Pendientes"})]}),e.jsxs("button",{className:`btn-advanced-filters ${C()?"active":""}`,onClick:()=>document.querySelector(".filters-advanced").classList.toggle("show"),children:["üîß Filtros Avanzados",C()&&e.jsx("span",{className:"filters-count",children:Object.values(s).filter(m=>m!=="").length})]}),e.jsxs("div",{className:"view-modes",children:[e.jsx("button",{className:`view-mode ${u==="cards"?"active":""}`,onClick:()=>x("cards"),children:"üìã Cards"}),e.jsx("button",{className:`view-mode ${u==="table"?"active":""}`,onClick:()=>x("table"),children:"üìä Tabla"})]})]}),e.jsxs("div",{className:"filters-advanced",children:[e.jsxs("div",{className:"filters-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Tipo de Mantenimiento"}),e.jsxs("select",{value:s.type,onChange:m=>E("type",m.target.value),children:[e.jsx("option",{value:"",children:"Todos los tipos"}),e.jsx("option",{value:t.OIL_CHANGE,children:b(t.OIL_CHANGE)}),e.jsx("option",{value:t.BATTERY_CHANGE,children:b(t.BATTERY_CHANGE)}),e.jsx("option",{value:t.FILTER_CHANGE,children:b(t.FILTER_CHANGE)}),e.jsx("option",{value:t.GENERAL_MAINTENANCE,children:b(t.GENERAL_MAINTENANCE)})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Estado"}),e.jsxs("select",{value:s.status,onChange:m=>E("status",m.target.value),children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:h.COMPLETED,children:j(h.COMPLETED)}),e.jsx("option",{value:h.PENDING,children:j(h.PENDING)}),e.jsx("option",{value:h.CANCELLED,children:j(h.CANCELLED)})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Fecha Desde"}),e.jsx("input",{type:"date",value:s.dateFrom,onChange:m=>E("dateFrom",m.target.value)})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Fecha Hasta"}),e.jsx("input",{type:"date",value:s.dateTo,onChange:m=>E("dateTo",m.target.value)})]})]}),e.jsx("div",{className:"filters-actions",children:e.jsx("button",{className:"btn-clear-filters",onClick:i,disabled:!C(),children:"üóëÔ∏è Limpiar Filtros"})})]}),e.jsxs("div",{className:"filters-info",children:[e.jsxs("div",{className:"results-count",children:[d," mantenimiento",d!==1?"s":""," encontrado",d!==1?"s":""]}),C()&&e.jsxs("div",{className:"active-filters",children:[e.jsx("span",{className:"filters-label",children:"Filtros activos:"}),e.jsxs("div",{className:"filter-tags",children:[s.type&&e.jsxs("span",{className:"filter-tag",children:["Tipo: ",b(s.type),e.jsx("button",{onClick:()=>E("type",""),children:"√ó"})]}),s.status&&e.jsxs("span",{className:"filter-tag",children:["Estado: ",j(s.status),e.jsx("button",{onClick:()=>E("status",""),children:"√ó"})]}),s.dateFrom&&e.jsxs("span",{className:"filter-tag",children:["Desde: ",s.dateFrom,e.jsx("button",{onClick:()=>E("dateFrom",""),children:"√ó"})]}),s.dateTo&&e.jsxs("span",{className:"filter-tag",children:["Hasta: ",s.dateTo,e.jsx("button",{onClick:()=>E("dateTo",""),children:"√ó"})]}),c&&e.jsxs("span",{className:"filter-tag",children:['B√∫squeda: "',c,'"',e.jsx("button",{onClick:()=>l(""),children:"√ó"})]})]})]})]})]})})},Ee=({maintenanceRecords:s,onEdit:a,onView:i,onDelete:c,userRole:l})=>{const u=n=>n?new Date(n).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric"}):"N/A",x=n=>{if(!n)return"";const v=new Date,T=new Date(n),M=Math.abs(v-T),g=Math.ceil(M/(1e3*60*60*24));return g===0?"Hoy":g===1?"Ayer":g<7?`Hace ${g} d√≠as`:g<30?`Hace ${Math.floor(g/7)} semanas`:`Hace ${Math.floor(g/30)} meses`},d=n=>{switch(n){case t.OIL_CHANGE:return"maintenance-oil-change";case t.BATTERY_CHANGE:return"maintenance-battery-change";case t.FILTER_CHANGE:return"maintenance-filter-change";case t.GENERAL_MAINTENANCE:return"maintenance-general";default:return"maintenance-general"}},b=n=>{switch(n){case h.COMPLETED:return"status-completado";case h.PENDING:return"status-pendiente";case h.CANCELLED:return"status-cancelado";default:return"status-unknown"}},j=n=>{switch(n){case t.OIL_CHANGE:return"üõ¢Ô∏è";case t.BATTERY_CHANGE:return"üîã";case t.FILTER_CHANGE:return"üîß";case t.GENERAL_MAINTENANCE:return"‚öôÔ∏è";default:return"üîß"}},E=n=>{switch(n){case t.OIL_CHANGE:return"Cambio de Aceite";case t.BATTERY_CHANGE:return"Cambio de Bater√≠a";case t.FILTER_CHANGE:return"Cambio de Filtros";case t.GENERAL_MAINTENANCE:return"Mantenimiento General";default:return n}},A=n=>{switch(n){case h.COMPLETED:return"‚úÖ";case h.PENDING:return"‚è∞";case h.CANCELLED:return"‚ùå";default:return"‚ùì"}},C=n=>{switch(n){case h.COMPLETED:return"Completado";case h.PENDING:return"Pendiente";case h.CANCELLED:return"Cancelado";default:return n}},m=l==="admin"||l==="supervisor";return e.jsx("div",{className:"maintenance-cards",children:s.map(n=>e.jsxs("div",{className:`maintenance-card ${d(n.type)}`,children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"maintenance-type",children:[e.jsx("span",{className:"type-icon",children:j(n.type)}),e.jsx("span",{className:"type-label",children:E(n.type)})]}),e.jsxs("div",{className:`status-badge ${b(n.status)}`,children:[A(n.status)," ",C(n.status)]})]}),e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"vehicle-info",children:[e.jsx("span",{className:"vehicle-icon",children:"üöú"}),e.jsxs("div",{className:"vehicle-details",children:[e.jsx("div",{className:"vehicle-name",children:n.vehicleName}),e.jsx("div",{className:"vehicle-id",children:n.vehicleId})]})]}),e.jsxs("div",{className:"date-info",children:[e.jsx("div",{className:"created-date",children:u(n.date)}),e.jsx("div",{className:"relative-time",children:x(n.date)})]}),n.type===t.OIL_CHANGE&&e.jsxs("div",{className:"oil-change-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Cantidad:"}),e.jsxs("span",{className:"info-value",children:[I(n.quantity)," galones"]})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Hor√≥metro:"}),e.jsxs("span",{className:"info-value",children:[I(n.currentHours)," horas"]})]}),n.nextChangeHours&&e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Pr√≥ximo cambio:"}),e.jsxs("span",{className:"info-value",children:[I(n.nextChangeHours)," horas"]})]}),n.filters&&e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Filtros:"}),e.jsx("span",{className:"info-value",children:n.filters})]})]}),n.type===t.BATTERY_CHANGE&&e.jsxs("div",{className:"battery-change-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Tipo:"}),e.jsx("span",{className:"info-value",children:n.batteryType})]}),n.brand&&e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Marca:"}),e.jsx("span",{className:"info-value",children:n.brand})]}),n.model&&e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Modelo:"}),e.jsx("span",{className:"info-value",children:n.model})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Estado:"}),e.jsx("span",{className:"info-value",children:n.batteryStatus})]}),n.cost&&e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Costo:"}),e.jsx("span",{className:"info-value",children:F(n.cost)})]})]}),n.notes&&e.jsxs("div",{className:"notes-section",children:[e.jsx("span",{className:"notes-label",children:"Notas:"}),e.jsx("p",{className:"notes-text",children:n.notes})]})]}),e.jsx("div",{className:"card-footer",children:e.jsxs("div",{className:"card-actions",children:[e.jsx("button",{className:"btn-view",onClick:()=>i(n),title:"Ver detalles",children:"üëÅÔ∏è Ver"}),m&&a&&e.jsx("button",{className:"btn-edit",onClick:()=>a(n),title:"Editar",children:"‚úèÔ∏è Editar"}),m&&c&&e.jsx("button",{className:"btn-delete",onClick:()=>c(n.id),title:"Eliminar",children:"üóëÔ∏è Eliminar"})]})})]},n.id))})},pe=({maintenanceRecords:s,onEdit:a,onView:i,onDelete:c,userRole:l})=>{const[u,x]=p.useState("date"),[d,b]=p.useState("desc"),j=o=>o?new Date(o).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit"}):"N/A",E=o=>{switch(o){case t.OIL_CHANGE:return"üõ¢Ô∏è";case t.BATTERY_CHANGE:return"üîã";case t.FILTER_CHANGE:return"üîß";case t.GENERAL_MAINTENANCE:return"‚öôÔ∏è";default:return"üîß"}},A=o=>{switch(o){case t.OIL_CHANGE:return"Cambio de Aceite";case t.BATTERY_CHANGE:return"Cambio de Bater√≠a";case t.FILTER_CHANGE:return"Cambio de Filtros";case t.GENERAL_MAINTENANCE:return"Mantenimiento General";default:return o}},C=o=>{switch(o){case h.COMPLETED:return"‚úÖ";case h.PENDING:return"‚è∞";case h.CANCELLED:return"‚ùå";default:return"‚ùì"}},m=o=>{switch(o){case h.COMPLETED:return"Completado";case h.PENDING:return"Pendiente";case h.CANCELLED:return"Cancelado";default:return o}},n=o=>{switch(o){case h.COMPLETED:return"status-completado";case h.PENDING:return"status-pendiente";case h.CANCELLED:return"status-cancelado";default:return"status-unknown"}},v=o=>{u===o?b(d==="asc"?"desc":"asc"):(x(o),b("asc"))},T=o=>u!==o?"‚ÜïÔ∏è":d==="asc"?"‚Üë":"‚Üì",M=[...s].sort((o,G)=>{let r=o[u],N=G[u];return u==="date"&&(r=new Date(r),N=new Date(N)),["quantity","currentHours","nextChangeHours","cost"].includes(u)&&(r=parseFloat(r)||0,N=parseFloat(N)||0),typeof r=="string"&&(r=r.toLowerCase(),N=N.toLowerCase()),d==="asc"?r>N?1:-1:r<N?1:-1}),g=l==="admin"||l==="supervisor";return e.jsxs("div",{className:"maintenance-table-container",children:[e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"maintenance-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{className:"sortable",onClick:()=>v("type"),children:["Tipo ",T("type")]}),e.jsxs("th",{className:"sortable",onClick:()=>v("vehicleName"),children:["Veh√≠culo ",T("vehicleName")]}),e.jsxs("th",{className:"sortable",onClick:()=>v("date"),children:["Fecha ",T("date")]}),e.jsx("th",{children:"Detalles"}),e.jsxs("th",{className:"sortable",onClick:()=>v("status"),children:["Estado ",T("status")]}),e.jsxs("th",{className:"sortable text-right",onClick:()=>v("cost"),children:["Costo ",T("cost")]}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:M.map(o=>e.jsxs("tr",{className:"maintenance-row",children:[e.jsx("td",{className:"type-cell",children:e.jsxs("div",{className:"type-content",children:[e.jsx("span",{className:"type-icon",children:E(o.type)}),e.jsx("span",{className:"type-name",children:A(o.type)})]})}),e.jsx("td",{className:"vehicle-cell",children:e.jsxs("div",{className:"vehicle-info",children:[e.jsx("div",{className:"vehicle-name",children:o.vehicleName}),e.jsx("div",{className:"vehicle-id",children:o.vehicleId})]})}),e.jsx("td",{className:"date-cell",children:e.jsx("div",{className:"date-content",children:e.jsx("div",{className:"date-value",children:j(o.date)})})}),e.jsxs("td",{className:"details-cell",children:[o.type===t.OIL_CHANGE&&e.jsxs("div",{className:"oil-details",children:[e.jsxs("div",{children:["Qty: ",I(o.quantity)," gal"]}),e.jsxs("div",{children:["Hrs: ",I(o.currentHours)]}),o.filters&&e.jsxs("div",{children:["Filtros: ",o.filters]})]}),o.type===t.BATTERY_CHANGE&&e.jsxs("div",{className:"battery-details",children:[e.jsx("div",{children:o.batteryType}),o.brand&&e.jsx("div",{children:o.brand}),e.jsxs("div",{children:["Estado: ",o.batteryStatus]})]}),o.notes&&e.jsx("div",{className:"notes-small",children:o.notes})]}),e.jsx("td",{className:"status-cell",children:e.jsxs("div",{className:`status-badge ${n(o.status)}`,children:[C(o.status)," ",m(o.status)]})}),e.jsx("td",{className:"cost-cell text-right",children:o.cost?F(o.cost):"N/A"}),e.jsx("td",{className:"actions-cell",children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn-action btn-view",onClick:()=>i(o),title:"Ver detalles",children:"üëÅÔ∏è"}),g&&a&&e.jsx("button",{className:"btn-action btn-edit",onClick:()=>a(o),title:"Editar",children:"‚úèÔ∏è"}),g&&c&&e.jsx("button",{className:"btn-action btn-delete",onClick:()=>c(o.id),title:"Eliminar",children:"üóëÔ∏è"})]})})]},o.id))})]})}),e.jsxs("div",{className:"table-info",children:[e.jsx("div",{className:"table-summary",children:e.jsxs("span",{className:"total-rows",children:[s.length," mantenimiento",s.length!==1?"s":""," en total"]})}),e.jsxs("div",{className:"table-legend",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot oil-change"}),e.jsx("span",{children:"Cambio de Aceite"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot battery-change"}),e.jsx("span",{children:"Cambio de Bater√≠a"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot filter-change"}),e.jsx("span",{children:"Cambio de Filtros"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot general"}),e.jsx("span",{children:"Mantenimiento General"})]})]})]})]})},be=({maintenanceRecords:s,viewMode:a,onEdit:i,onView:c,onDelete:l,userRole:u})=>!s||s.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"üîß"}),e.jsx("h3",{children:"No hay mantenimientos registrados"}),e.jsx("p",{children:"Comienza creando el primer mantenimiento para tu flota de veh√≠culos."})]}):e.jsx("div",{className:"maintenance-list",children:a==="cards"?e.jsx(Ee,{maintenanceRecords:s,onEdit:i,onView:c,onDelete:l,userRole:u}):e.jsx(pe,{maintenanceRecords:s,onEdit:i,onView:c,onDelete:l,userRole:u})}),Ce=({isOpen:s,onClose:a,onSuccess:i,maintenance:c,mode:l="create",userRole:u})=>{const x=p.useCallback(()=>({type:c?.type||t.OIL_CHANGE,vehicleId:c?.vehicleId||"",vehicleName:c?.vehicleName||"",date:c?.date?new Date(c.date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],status:c?.status||h.COMPLETED,quantity:c?.quantity||0,currentHours:c?.currentHours||0,nextChangeHours:c?.nextChangeHours||0,filters:c?.filters||"",batteryType:c?.batteryType||"",brand:c?.brand||"",model:c?.model||"",batteryStatus:c?.batteryStatus||D.NEW,notes:c?.notes||"",cost:c?.cost||0}),[c]),[d,b]=p.useState(x()),[j,E]=p.useState({}),[A,C]=p.useState(!1),[m,n]=p.useState([]);p.useEffect(()=>{s&&(async()=>{try{const N=await he();n(N)}catch(N){console.error("Error al cargar veh√≠culos:",N)}})()},[s]),p.useEffect(()=>{s&&(b(x()),E({}))},[s,c,m,x]),p.useEffect(()=>{if(d.type===t.OIL_CHANGE&&d.currentHours>0){const r=q(d.currentHours);b(N=>({...N,nextChangeHours:r}))}},[d.currentHours,d.type]);const v=(r,N)=>{const w=typeof N=="number"?parseFloat(N)||0:N;b(S=>({...S,[r]:w})),j[r]&&E(S=>({...S,[r]:null}))},T=r=>{const N=m.find(w=>w.vehicleId===r);b(w=>({...w,vehicleId:r,vehicleName:N?N.name:""})),N&&N.hasHourMeter&&N.currentHours&&b(w=>({...w,currentHours:N.currentHours}))},M=()=>{const r={};return d.type||(r.type="El tipo de mantenimiento es obligatorio"),d.vehicleId||(r.vehicleId="El veh√≠culo es obligatorio"),d.date||(r.date="La fecha es obligatoria"),d.type===t.OIL_CHANGE&&((!d.quantity||d.quantity<=0)&&(r.quantity="La cantidad de aceite es obligatoria y debe ser mayor a 0"),(!d.currentHours||d.currentHours<0)&&(r.currentHours="La lectura del hor√≥metro es obligatoria")),d.type===t.BATTERY_CHANGE&&(d.batteryType||(r.batteryType="El tipo de bater√≠a es obligatorio"),(!d.cost||d.cost<=0)&&(r.cost="El costo de la bater√≠a es obligatorio")),E(r),Object.keys(r).length===0},g=async r=>{if(r.preventDefault(),!!M()){C(!0);try{const N={...d,date:new Date(d.date),createdBy:u||"user"};l==="create"?(await ie(N),console.log("‚úÖ Mantenimiento creado exitosamente")):l==="edit"&&(await ce(c.id,N),console.log("‚úÖ Mantenimiento actualizado exitosamente")),i()}catch(N){console.error("‚ùå Error al guardar mantenimiento:",N),alert("Error al guardar mantenimiento: "+N.message)}finally{C(!1)}}},o=()=>{switch(l){case"create":return"Crear Mantenimiento";case"edit":return"Editar Mantenimiento";case"view":return"Ver Mantenimiento";default:return"Mantenimiento"}},G=r=>{switch(r){case t.OIL_CHANGE:return"üõ¢Ô∏è";case t.BATTERY_CHANGE:return"üîã";case t.FILTER_CHANGE:return"üîß";case t.GENERAL_MAINTENANCE:return"‚öôÔ∏è";default:return"üîß"}};return s?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content maintenance-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:o()}),e.jsx("button",{className:"modal-close",onClick:a,children:"√ó"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{onSubmit:g,className:"maintenance-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tipo de Mantenimiento *"}),e.jsxs("select",{value:d.type,onChange:r=>v("type",r.target.value),disabled:l==="view",children:[e.jsxs("option",{value:t.OIL_CHANGE,children:[G(t.OIL_CHANGE)," Cambio de Aceite"]}),e.jsxs("option",{value:t.BATTERY_CHANGE,children:[G(t.BATTERY_CHANGE)," Cambio de Bater√≠a"]}),e.jsxs("option",{value:t.FILTER_CHANGE,children:[G(t.FILTER_CHANGE)," Cambio de Filtros"]}),e.jsxs("option",{value:t.GENERAL_MAINTENANCE,children:[G(t.GENERAL_MAINTENANCE)," Mantenimiento General"]})]}),j.type&&e.jsx("span",{className:"error-text",children:j.type})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Veh√≠culo *"}),e.jsxs("select",{value:d.vehicleId,onChange:r=>T(r.target.value),disabled:l==="view",children:[e.jsx("option",{value:"",children:"Seleccionar veh√≠culo"}),m.map(r=>e.jsxs("option",{value:r.vehicleId,children:[r.vehicleId," - ",r.name," (",r.type,")"]},r.vehicleId))]}),j.vehicleId&&e.jsx("span",{className:"error-text",children:j.vehicleId})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Fecha *"}),e.jsx("input",{type:"date",value:d.date,onChange:r=>v("date",r.target.value),disabled:l==="view"}),j.date&&e.jsx("span",{className:"error-text",children:j.date})]}),d.type===t.OIL_CHANGE&&e.jsxs("div",{className:"maintenance-section",children:[e.jsx("h3",{children:"üõ¢Ô∏è Informaci√≥n del Cambio de Aceite"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cantidad (galones) *"}),e.jsx("input",{type:"number",step:"0.1",value:d.quantity,onChange:r=>v("quantity",r.target.value),disabled:l==="view"}),j.quantity&&e.jsx("span",{className:"error-text",children:j.quantity})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Hor√≥metro Actual *"}),e.jsx("input",{type:"number",value:d.currentHours,onChange:r=>v("currentHours",r.target.value),disabled:l==="view"}),j.currentHours&&e.jsx("span",{className:"error-text",children:j.currentHours})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Pr√≥ximo Cambio (horas)"}),e.jsx("input",{type:"number",value:d.nextChangeHours,disabled:!0,className:"readonly-input"}),e.jsx("small",{children:"Calculado autom√°ticamente: actual + 250 horas"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Filtros o Extras"}),e.jsx("textarea",{value:d.filters,onChange:r=>v("filters",r.target.value),disabled:l==="view",placeholder:"Especificar filtros cambiados o extras..."})]})]}),d.type===t.BATTERY_CHANGE&&e.jsxs("div",{className:"maintenance-section",children:[e.jsx("h3",{children:"üîã Informaci√≥n del Cambio de Bater√≠a"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tipo de Bater√≠a *"}),e.jsx("input",{type:"text",value:d.batteryType,onChange:r=>v("batteryType",r.target.value),disabled:l==="view",placeholder:"Ej: 12V 60Ah"}),j.batteryType&&e.jsx("span",{className:"error-text",children:j.batteryType})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Estado *"}),e.jsxs("select",{value:d.batteryStatus,onChange:r=>v("batteryStatus",r.target.value),disabled:l==="view",children:[e.jsx("option",{value:D.NEW,children:"Nueva"}),e.jsx("option",{value:D.USED,children:"Usada"}),e.jsx("option",{value:D.REPAIRED,children:"Reparada"})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Marca"}),e.jsx("input",{type:"text",value:d.brand,onChange:r=>v("brand",r.target.value),disabled:l==="view",placeholder:"Ej: Bosch, Exide"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Modelo"}),e.jsx("input",{type:"text",value:d.model,onChange:r=>v("model",r.target.value),disabled:l==="view",placeholder:"Ej: S4 005"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Costo *"}),e.jsx("input",{type:"number",step:"1000",value:d.cost,onChange:r=>v("cost",r.target.value),disabled:l==="view",placeholder:"0"}),j.cost&&e.jsx("span",{className:"error-text",children:j.cost})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notas Adicionales"}),e.jsx("textarea",{value:d.notes,onChange:r=>v("notes",r.target.value),disabled:l==="view",placeholder:"Observaciones adicionales...",rows:"3"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Estado"}),e.jsxs("select",{value:d.status,onChange:r=>v("status",r.target.value),disabled:l==="view",children:[e.jsx("option",{value:h.COMPLETED,children:"Completado"}),e.jsx("option",{value:h.PENDING,children:"Pendiente"}),e.jsx("option",{value:h.CANCELLED,children:"Cancelado"})]})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:a,disabled:A,children:"Cancelar"}),l!=="view"&&e.jsx("button",{type:"submit",className:"btn btn-primary",onClick:g,disabled:A,children:A?"Guardando...":l==="create"?"Crear":"Actualizar"})]})]})}):null},fe=()=>{const{user:s,userProfile:a}=ne(),[i,c]=p.useState([]),[l,u]=p.useState(null),[x,d]=p.useState(!0),[b,j]=p.useState(null),[E,A]=p.useState({type:"",status:"",vehicleId:"",dateFrom:"",dateTo:""}),[C,m]=p.useState("cards"),[n,v]=p.useState(""),[T,M]=p.useState(!1),[g,o]=p.useState(null),[G,r]=p.useState("create");p.useEffect(()=>{if(!s)return;d(!0);const f=ue((y,Y)=>{if(Y){console.error("Error en suscripci√≥n de mantenimientos:",Y),j("Error al cargar mantenimientos"),d(!1);return}c(y),j(null),d(!1)},E);return()=>f()},[s,E]),p.useEffect(()=>{s&&(async()=>{try{const y=await de(E);u(y)}catch(y){console.error("Error al cargar estad√≠sticas:",y)}})()},[s,i,E]);const N=i.filter(f=>{if(!n)return!0;const y=n.toLowerCase();return f.vehicleName?.toLowerCase().includes(y)||f.type?.toLowerCase().includes(y)||f.status?.toLowerCase().includes(y)||f.notes?.toLowerCase().includes(y)}),w=a?.combustiblesPermissions?.canManageMaintenance||!1,S=()=>{o(null),r("create"),M(!0)},W=f=>{o(f),r("edit"),M(!0)},J=f=>{o(f),r("view"),M(!0)},K=()=>{M(!1),o(null)},X=()=>{M(!1),o(null)},Z=f=>{A(y=>({...y,...f}))},ee=()=>{A({type:"",status:"",vehicleId:"",dateFrom:"",dateTo:""}),v("")},se=async f=>{if(!w){alert("No tienes permisos para eliminar mantenimientos");return}if(window.confirm("¬øEst√°s seguro de que quieres eliminar este mantenimiento?"))try{await oe(f),console.log("‚úÖ Mantenimiento eliminado exitosamente")}catch(y){console.error("‚ùå Error al eliminar mantenimiento:",y),alert("Error al eliminar mantenimiento: "+y.message)}};return s?e.jsxs("div",{className:"maintenance-main",children:[e.jsxs("div",{className:"maintenance-header",children:[e.jsxs("div",{className:"header-title",children:[e.jsx("h2",{children:"üîß Mantenimiento de Veh√≠culos"}),e.jsx("p",{children:"Gesti√≥n de cambios de aceite, filtros y bater√≠as"})]}),e.jsx("div",{className:"header-actions",children:w&&e.jsx("button",{className:"btn-create-maintenance",onClick:S,children:"‚ûï Crear Mantenimiento"})})]}),x&&e.jsxs("div",{className:"maintenance-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Cargando mantenimientos..."})]}),b&&e.jsxs("div",{className:"error-banner",children:[e.jsxs("span",{children:["‚ùå ",b]}),e.jsx("button",{onClick:()=>window.location.reload(),children:"Reintentar"})]}),l&&e.jsx(je,{stats:l}),e.jsx(ve,{filters:E,onFilterChange:Z,onClearFilters:ee,searchTerm:n,onSearchChange:v,viewMode:C,onViewModeChange:m,totalResults:N.length}),!x&&!b&&e.jsx(be,{maintenanceRecords:N,viewMode:C,onEdit:w?W:null,onView:J,onDelete:w?se:null,userRole:a?.role}),T&&e.jsx(Ce,{isOpen:T,onClose:K,onSuccess:X,maintenance:g,mode:G,userRole:a?.role})]}):e.jsx("div",{className:"maintenance-main",children:e.jsxs("div",{className:"auth-required",children:[e.jsx("h2",{children:"üîê Autenticaci√≥n Requerida"}),e.jsx("p",{children:"Debes iniciar sesi√≥n para acceder al m√≥dulo de mantenimiento."})]})})};export{fe as default};
