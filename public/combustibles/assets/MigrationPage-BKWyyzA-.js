import{r as x,_ as Be,d as je,b as oe,s as ie,c as be,e as He,g as Re,h as Ge,i as Ye,v as Xe,m as We,M as Qe,k as Ze,j as e,R as pe}from"./index-CbuH0zjO.js";import{P as te,c as Ke}from"./productsService-DQLINdS6.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),es=a=>a.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,s)=>s?s.toUpperCase():n.toLowerCase()),Ce=a=>{const t=es(a);return t.charAt(0).toUpperCase()+t.slice(1)},Ae=(...a)=>a.filter((t,n,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===n).join(" ").trim(),ss=a=>{for(const t in a)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var as={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=x.forwardRef(({color:a="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:s,className:l="",children:d,iconNode:c,...i},o)=>x.createElement("svg",{ref:o,...as,width:t,height:t,stroke:a,strokeWidth:s?Number(n)*24/Number(t):n,className:Ae("lucide",l),...!d&&!ss(i)&&{"aria-hidden":"true"},...i},[...c.map(([h,k])=>x.createElement(h,k)),...Array.isArray(d)?d:[d]]));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=(a,t)=>{const n=x.forwardRef(({className:s,...l},d)=>x.createElement(ts,{ref:d,iconNode:t,className:Ae(`lucide-${Je(Ce(a))}`,`lucide-${a}`,s),...l}));return n.displayName=Ce(a),n};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],is=R("activity",ns);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],cs=R("arrow-left",rs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],re=R("arrow-right",ls);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ds=R("calendar",os);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],hs=R("chevron-left",us);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],ms=R("chevron-right",ps);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],B=R("circle-alert",xs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],G=R("circle-check-big",gs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],js=R("clock",vs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],Ee=R("columns-2",fs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],ce=R("database",Ns);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Le=R("download",ys);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],bs=R("eye-off",ws);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Q=R("eye",Cs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],fe=R("file-text",Es);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],ke=R("file",ks);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Ms=R("funnel",Ss);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],As=R("house",Rs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],se=R("info",Ls);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],ze=R("loader",zs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],me=R("package",Ds);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],Ts=R("pause",Os);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]],_s=R("pen-line",$s);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],xe=R("play",Is);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Vs=R("refresh-cw",Ps);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],de=R("rotate-ccw",Us);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Fs=R("save",qs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],De=R("search",Bs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Gs=R("settings",Hs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Xs=R("square",Ys);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Oe=R("target",Ws);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],ge=R("trending-up",Qs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],J=R("triangle-alert",Zs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Te=R("upload",Ks);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ve=R("users",Js);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],le=R("x",ea);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],$e=R("zap",sa),_e={EXCEL:["xlsx","xls"],CSV:["csv"],TEXT:["txt","tsv"]},Z=(a,t=null,n=null,s={})=>({success:a,data:t,error:n,metadata:{fileName:"",fileSize:0,fileType:"",rowCount:0,columnCount:0,sheets:[],encoding:"UTF-8",...s}}),Ie=a=>{const t=a.name.split(".").pop().toLowerCase();for(const[n,s]of Object.entries(_e))if(s.includes(t))return n;return a.type.includes("spreadsheet")||a.type.includes("excel")?"EXCEL":a.type.includes("csv")||a.type.includes("text")?"CSV":"UNKNOWN"},Pe=a=>{if(!a)return{valid:!1,error:"No se proporcionó ningún archivo"};if(a.size>52428800)return{valid:!1,error:"El archivo es demasiado grande (máximo 50MB)"};if(a.size<10)return{valid:!1,error:"El archivo está vacío o es demasiado pequeño"};const s=Ie(a);return s==="UNKNOWN"?{valid:!1,error:"Tipo de archivo no soportado. Use Excel (.xlsx, .xls) o CSV (.csv)"}:{valid:!0,fileType:s}},aa=async(a,t={})=>{try{const n=await Be(()=>import("./xlsx-DLvP5s0v.js"),[]),s=n.read(a,{type:"buffer",cellText:!1,cellDates:!0,...t}),l={sheets:[],data:null,metadata:{sheetNames:s.SheetNames,sheets:s.SheetNames.length}};s.SheetNames.forEach((c,i)=>{const o=s.Sheets[c],h=n.utils.sheet_to_json(o,{header:1,defval:"",blankrows:!1});if(h.length===0)return;const k=h[0]||[],N=h.slice(1),D=k.map((j,E)=>!j||j.toString().trim()===""?`Columna_${E+1}`:j.toString().trim()),y=N.filter(j=>j.some(E=>E!=null&&E!=="")).map(j=>{const E={};return D.forEach((S,T)=>{const M=j[T];M instanceof Date||typeof M=="number"?E[S]=M:typeof M=="string"?E[S]=M.trim():E[S]=M||""}),E}),O={name:c,index:i,headers:D,rowCount:y.length,columnCount:D.length,data:y,range:o["!ref"]||"A1",isEmpty:y.length===0};l.sheets.push(O)});const d=l.sheets.find(c=>!c.isEmpty)||l.sheets[0];return d&&(l.data=d.data,l.metadata.primarySheet=d.name,l.metadata.headers=d.headers,l.metadata.rowCount=d.rowCount,l.metadata.columnCount=d.columnCount),Z(!0,l.data,null,l.metadata)}catch(n){return console.error("❌ Error parsing Excel file:",n),Z(!1,null,`Error procesando archivo Excel: ${n.message}`)}},ta=(a,t={})=>{try{const{delimiter:n=",",quote:s='"',escape:l='"',skipEmptyLines:d=!0,trimValues:c=!0}=t,i=a.split(/\r?\n/);if(i.length===0)return Z(!1,null,"El archivo CSV está vacío");const o=y=>{const O=[];let j="",E=!1,S=0;for(;S<y.length;){const T=y[S],M=y[S+1];T===s&&!E?E=!0:T===s&&E?M===s?(j+=s,S++):E=!1:T===n&&!E?(O.push(c?j.trim():j),j=""):j+=T,S++}return O.push(c?j.trim():j),O},h=i[0],k=o(h).map((y,O)=>!y||y.trim()===""?`Columna_${O+1}`:y.trim()),N=[];for(let y=1;y<i.length;y++){const O=i[y].trim();if(d&&O==="")continue;const j=o(O);if(j.every(S=>S===""))continue;const E={};k.forEach((S,T)=>{const M=j[T]||"";M!==""&&!isNaN(M)&&!isNaN(parseFloat(M))?E[S]=parseFloat(M):E[S]=M}),N.push(E)}const D={headers:k,rowCount:N.length,columnCount:k.length,delimiter:n,encoding:"UTF-8"};return Z(!0,N,null,D)}catch(n){return console.error("❌ Error parsing CSV file:",n),Z(!1,null,`Error procesando archivo CSV: ${n.message}`)}},na=async(a,t={})=>{try{const n=Pe(a);if(!n.valid)return Z(!1,null,n.error);const s=n.fileType,l=await a.arrayBuffer(),d={fileName:a.name,fileSize:a.size,fileType:s,lastModified:new Date(a.lastModified)};let c;switch(s){case"EXCEL":c=await aa(l,t.excel);break;case"CSV":{const i=new TextDecoder("utf-8").decode(l);c=ta(i,t.csv);break}default:return Z(!1,null,`Tipo de archivo no soportado: ${s}`)}return c.success&&(c.metadata={...d,...c.metadata}),c}catch(n){return console.error("❌ Error general parsing file:",n),Z(!1,null,`Error inesperado procesando archivo: ${n.message}`)}},ia=(a,t=10)=>{if(!Array.isArray(a)||a.length===0)return{preview:[],total:0,headers:[],statistics:{}};const n=Object.keys(a[0]),s=a.slice(0,t),l={totalRows:a.length,totalColumns:n.length,emptyFields:0,dataTypes:{}};return n.forEach(d=>{const c=a.map(o=>o[d]).filter(o=>o!==""&&o!==null&&o!==void 0);if(c.length===0){l.dataTypes[d]="empty";return}const i=c[0];i instanceof Date?l.dataTypes[d]="date":typeof i=="number"?l.dataTypes[d]="number":typeof i=="boolean"?l.dataTypes[d]="boolean":l.dataTypes[d]="text"}),{preview:s,total:a.length,headers:n,statistics:l}},ra=a=>{const t={fecha:["fecha","date","dia","day","timestamp","created","creado"],cantidad:["cantidad","qty","quantity","galones","litros","amount","volume"],vehiculo:["vehiculo","vehicle","maquina","machine","equipo","equipment","codigo","code","id"],producto:["producto","product","combustible","fuel","articulo","item","tipo"],precio:["precio","price","cost","costo","valor","value"],horometro:["horometro","horas","hours","hour_meter","lectura"],ubicacion:["ubicacion","location","lugar","place","destino","destination","origen","source"],descripcion:["descripcion","description","notes","notas","observaciones","comments"]},n={},s=a.map(l=>({original:l,normalized:l.toLowerCase().trim().replace(/[^a-z0-9]/g,"_")}));return Object.entries(t).forEach(([l,d])=>{let c=null,i=0;s.forEach(({original:o,normalized:h})=>{d.forEach(k=>{const N=ca(h,k);N>i&&N>.6&&(i=N,c=o)})}),c&&(n[l]=c)}),n},ca=(a,t)=>{if(a===t)return 1;if(a.includes(t)||t.includes(a))return .8;const n=a.length>t.length?a:t,s=a.length>t.length?t:a;if(n.length===0)return 1;const l=la(n,s);return(n.length-l)/n.length},la=(a,t)=>{const n=[];for(let s=0;s<=t.length;s++)n[s]=[s];for(let s=0;s<=a.length;s++)n[0][s]=s;for(let s=1;s<=t.length;s++)for(let l=1;l<=a.length;l++)t.charAt(s-1)===a.charAt(l-1)?n[s][l]=n[s-1][l-1]:n[s][l]=Math.min(n[s-1][l-1]+1,n[s][l-1]+1,n[s-1][l]+1);return n[t.length][a.length]},ue={parseFile:na,getDataPreview:ia,suggestColumnMapping:ra,validateFile:Pe,detectFileType:Ie,SUPPORTED_FILE_TYPES:_e},Ne="combustibles_migration_aliases",V={VEHICLE:"vehicle",PRODUCT:"product",LOCATION:"location",SUPPLIER:"supplier"},Se=(a,t={},n={})=>({type:a,mappings:t,metadata:{totalMappings:Object.keys(t).length,lastUsed:null,usageCount:0,...n},createdAt:ie(),updatedAt:ie()}),ne=async a=>{try{if(!Object.values(V).includes(a))throw new Error(`Tipo de alias inválido: ${a}`);const t=`${a}_aliases`,n=je(oe,Ne,t),s=await Re(n);return s.exists()?{id:s.id,...s.data(),createdAt:s.data().createdAt?.toDate?.()||s.data().createdAt,updatedAt:s.data().updatedAt?.toDate?.()||s.data().updatedAt,lastUsed:s.data().metadata?.lastUsed?.toDate?.()||s.data().metadata?.lastUsed}:null}catch(t){throw console.error("❌ Error obteniendo alias:",t),new Error(`Error al obtener alias: ${t.message}`)}},ye=async(a,t,n=!0)=>{try{if(!Object.values(V).includes(a))throw new Error(`Tipo de alias inválido: ${a}`);if(!t||typeof t!="object")throw new Error("Los mapeos deben ser un objeto válido");const s=`${a}_aliases`,l=je(oe,Ne,s);if(n){const d=await ne(a),c=d?{...d.mappings,...t}:t,i=Se(a,c,{totalMappings:Object.keys(c).length,lastUpdated:ie(),usageCount:(d?.metadata?.usageCount||0)+1});await be(l,i,{merge:!0})}else{const d=Se(a,t);await be(l,d)}console.log(`✅ Alias ${a} guardados exitosamente:`,Object.keys(t).length,"mapeos")}catch(s){throw console.error("❌ Error guardando alias:",s),new Error(`Error al guardar alias: ${s.message}`)}},Ve=async(a,t)=>{try{if(!t||typeof t!="string")return null;const n=await ne(a);if(!n||!n.mappings)return null;const s=n.mappings[t];if(s)return s;const l=t.toLowerCase().trim();for(const[d,c]of Object.entries(n.mappings))if(d.toLowerCase().trim()===l)return c;for(const[d,c]of Object.entries(n.mappings)){const i=d.toLowerCase().trim();if(i.includes(l)||l.includes(i))return c}return null}catch(n){return console.error("❌ Error resolviendo alias:",n),null}},oa=async(a,t)=>{try{const n={},s=await Ue(a),l=await ne(a);for(const d of t){const c=await Ve(a,d);if(c){n[d]={suggested:c,confidence:1,source:"alias",alternatives:[]};continue}const i=ma(d,s);if(i){n[d]={suggested:i.id,confidence:i.confidence,source:"direct",alternatives:[]};continue}const o=xa(d,s,3);if(o.length>0){n[d]={suggested:o[0].id,confidence:o[0].confidence,source:"fuzzy",alternatives:o.slice(1)};continue}n[d]={suggested:null,confidence:0,source:"none",alternatives:[],requiresManualMapping:!0}}return n}catch(n){throw console.error("❌ Error obteniendo sugerencias:",n),new Error(`Error al obtener sugerencias: ${n.message}`)}},da=async a=>{try{const t=`${a}_aliases`,n=je(oe,Ne,t);await He(n,{"metadata.lastUsed":ie(),"metadata.usageCount":(await Re(n)).data()?.metadata?.usageCount+1||1,updatedAt:ie()})}catch(t){console.error("❌ Error registrando uso de alias:",t)}},ua=async(a,t=90)=>{try{const n=await ne(a);if(!n||!n.mappings)return 0;const s=await Ue(a),l=new Set(s.map(i=>i.id));let d=0;const c={};for(const[i,o]of Object.entries(n.mappings))l.has(o)?c[i]=o:d++;return d>0&&(await ye(a,c,!1),console.log(`🧹 Limpieza completada: ${d} alias eliminados para ${a}`)),d}catch(n){return console.error("❌ Error en limpieza de alias:",n),0}},ha=async(a=null)=>{try{const t={exportedAt:new Date().toISOString(),version:"1.0",aliases:{}},n=a?[a]:Object.values(V);for(const s of n){const l=await ne(s);l&&(t.aliases[s]=l)}return t}catch(t){throw console.error("❌ Error exportando alias:",t),new Error(`Error al exportar alias: ${t.message}`)}},pa=async(a,t=!0)=>{try{if(!a||!a.aliases)throw new Error("Formato de backup inválido");let n=0;for(const[s,l]of Object.entries(a.aliases))Object.values(V).includes(s)&&l.mappings&&(await ye(s,l.mappings,t),n++);return console.log(`📥 Importación completada: ${n} tipos de alias importados`),n}catch(n){throw console.error("❌ Error importando alias:",n),new Error(`Error al importar alias: ${n.message}`)}},Ue=async a=>{try{let t,n=["id"];switch(a){case V.VEHICLE:t="combustibles_vehicles",n=["vehicleId","name"];break;case V.PRODUCT:t="combustibles_products",n=["name","displayName"];break;case V.LOCATION:return[{id:"principal",name:"Principal"},{id:"bodega_austria",name:"Bodega Austria"},{id:"bodega_ilusion",name:"Bodega Ilusión"},{id:"campo_operativo",name:"Campo Operativo"},{id:"estacion_movil",name:"Estación Móvil"}];case V.SUPPLIER:t="combustibles_suppliers",n=["name","displayName"];break;default:return[]}const s=await Ge(Ye(oe,t)),l=[];return s.forEach(d=>{const c=d.data(),i={id:d.id};n.forEach(o=>{c[o]&&(i[o]=c[o])}),a===V.VEHICLE&&c.vehicleId&&(i.id=c.vehicleId,i.displayName=`${c.vehicleId} - ${c.name||"Sin nombre"}`),l.push(i)}),l}catch(t){return console.error("❌ Error obteniendo datos existentes:",t),[]}},ma=(a,t)=>{const n=a.toLowerCase().trim();for(const s of t){if(s.id.toLowerCase()===n)return{id:s.id,confidence:1};if(s.name&&s.name.toLowerCase().trim()===n)return{id:s.id,confidence:.95};if(s.displayName&&s.displayName.toLowerCase().trim()===n)return{id:s.id,confidence:.95}}return null},xa=(a,t,n=5)=>{const s=[],l=a.toLowerCase().trim();for(const d of t){const c=[d.id,d.name,d.displayName].filter(Boolean);for(const i of c){const o=i.toLowerCase().trim();if(o.includes(l)||l.includes(o)){const h=Math.max(l.length/o.length,o.length/l.length)*.8;s.push({id:d.id,confidence:h,matchedField:i});break}}}return s.sort((d,c)=>c.confidence-d.confidence).slice(0,n)},Y={getAliasesByType:ne,saveAliases:ye,resolveAlias:Ve,getSuggestedMappings:oa,recordAliasUsage:da,cleanupUnusedAliases:ua,exportAliases:ha,importAliases:pa,ALIAS_TYPES:V},U={FILE_UPLOAD:1,COLUMN_MAPPING:2,VALUE_MAPPING:3,VALIDATION:4,EXECUTION:5},W={fecha:{required:!0,type:"date",description:"Fecha del movimiento"},cantidad:{required:!0,type:"number",description:"Cantidad de combustible"},vehiculo:{required:!0,type:"string",description:"Vehículo o equipo"},producto:{required:!0,type:"string",description:"Tipo de combustible/producto"}},we={horometro:{required:!1,type:"number",description:"Lectura del horómetro"},precio:{required:!1,type:"number",description:"Precio unitario"},ubicacion:{required:!1,type:"string",description:"Ubicación origen"},destino:{required:!1,type:"string",description:"Ubicación destino"},descripcion:{required:!1,type:"string",description:"Notas adicionales"},proveedor:{required:!1,type:"string",description:"Proveedor (para entradas)"}},ga=()=>({step:U.FILE_UPLOAD,fileData:null,columnMapping:{},valueMapping:{},validationResult:null,executionResult:null,errors:[],warnings:[],metadata:{startedAt:new Date,fileName:"",totalRows:0,processedRows:0,successfulRows:0,failedRows:0}}),va=async(a,t={})=>{try{console.log("🔄 Iniciando procesamiento de archivo:",a.name);const n=await ue.parseFile(a,t);if(!n.success)return{success:!1,error:n.error,data:null};const s=ue.getDataPreview(n.data,20),l=ue.suggestColumnMapping(s.headers);return{success:!0,data:n.data,metadata:n.metadata,preview:s,columnSuggestions:l,error:null}}catch(n){return console.error("❌ Error procesando archivo:",n),{success:!1,error:n.message,data:null}}},ja=(a,t)=>{try{const n={},s=[],l=[];return Object.entries(t).forEach(([c,i])=>{a.includes(i)&&(n[c]=i)}),Object.keys(W).forEach(c=>{n[c]||l.push(c)}),a.forEach(c=>{Object.values(n).includes(c)||s.push(c)}),{success:l.length===0,mapping:n,unmappedColumns:s,missingRequiredFields:l,warnings:s.length>0?[`${s.length} columnas no fueron mapeadas`]:[]}}catch(n){return console.error("❌ Error configurando mapeo de columnas:",n),{success:!1,error:n.message,mapping:{}}}},fa=async(a,t)=>{try{console.log("🔄 Configurando mapeo de valores...");const n={},s={},l=t.vehiculo,d=t.producto;if(l){const i=[...new Set(a.map(h=>h[l]).filter(Boolean))],o=await Y.getSuggestedMappings(V.VEHICLE,i);n.vehiculos={},s.vehiculos=o}if(d){const i=[...new Set(a.map(h=>h[d]).filter(Boolean))],o=await Y.getSuggestedMappings(V.PRODUCT,i);n.productos={},s.productos=o}const c=t.ubicacion;if(c){const i=[...new Set(a.map(h=>h[c]).filter(Boolean))],o=await Y.getSuggestedMappings(V.LOCATION,i);n.ubicaciones={},s.ubicaciones=o}return{success:!0,valueMapping:n,suggestions:s,error:null}}catch(n){return console.error("❌ Error configurando mapeo de valores:",n),{success:!1,error:n.message,valueMapping:{},suggestions:{}}}},Na=async(a,t,n)=>{try{console.log("🔄 Iniciando validación de datos (Dry Run)...");const s={isValid:!0,errors:[],warnings:[],statistics:{totalRows:a.length,validRows:0,invalidRows:0,newVehicles:new Set,newProducts:new Set,dateRange:{min:null,max:null}},preview:[]},l=[];for(let d=0;d<a.length;d++){const c=a[d],i=d+1,o={rowNumber:i,original:c,mapped:{},errors:[],warnings:[]};try{for(const[h,k]of Object.entries(W)){const N=t[h];if(!N){o.errors.push(`Campo requerido '${h}' no mapeado`);continue}const D=c[N],y=Me(D,k,h,i);y.error?o.errors.push(y.error):o.mapped[h]=y.value}for(const[h,k]of Object.entries(we)){const N=t[h];if(N&&c[N]!==void 0&&c[N]!==""){const D=c[N],y=Me(D,k,h,i);y.error?o.warnings.push(y.error):o.mapped[h]=y.value}}if(o.mapped.vehiculo){const h=o.mapped.vehiculo,k=n.vehiculos?.[h]||await Y.resolveAlias(V.VEHICLE,h);k?o.mapped.vehiculoId=k:(s.statistics.newVehicles.add(h),o.warnings.push(`Vehículo '${h}' no existe, será creado`),o.mapped.vehiculoId=qe(h))}if(o.mapped.producto){const h=o.mapped.producto,k=n.productos?.[h]||await Y.resolveAlias(V.PRODUCT,h);k?o.mapped.productoId=k:(s.statistics.newProducts.add(h),o.warnings.push(`Producto '${h}' no existe, será creado`),o.mapped.productoId=Fe(h))}if(o.mapped.fecha){const h=o.mapped.fecha;(!s.statistics.dateRange.min||h<s.statistics.dateRange.min)&&(s.statistics.dateRange.min=h),(!s.statistics.dateRange.max||h>s.statistics.dateRange.max)&&(s.statistics.dateRange.max=h)}o.errors.length===0?s.statistics.validRows++:(s.statistics.invalidRows++,s.isValid=!1),s.errors.push(...o.errors),s.warnings.push(...o.warnings),l.push(o)}catch(h){o.errors.push(`Error procesando fila: ${h.message}`),s.statistics.invalidRows++,s.isValid=!1,l.push(o)}}return s.preview=l.slice(0,10),s.processedData=l,s.statistics.newVehicles=Array.from(s.statistics.newVehicles),s.statistics.newProducts=Array.from(s.statistics.newProducts),console.log(`✅ Validación completada: ${s.statistics.validRows}/${s.statistics.totalRows} filas válidas`),{success:!0,validationResult:s,error:null}}catch(s){return console.error("❌ Error en validación:",s),{success:!1,error:s.message,validationResult:null}}},ya=async(a,t,n=null)=>{try{console.log("🚀 Iniciando ejecución de migración...");const s={success:!0,statistics:{totalRows:a.statistics.totalRows,processedRows:0,successfulRows:0,failedRows:0,newVehiclesCreated:0,newProductsCreated:0,movementsCreated:0},errors:[],warnings:[],migrationId:`migration_${Date.now()}`,startedAt:new Date};Object.keys(t.vehiculos||{}).length>0&&await Y.saveAliases(V.VEHICLE,t.vehiculos),Object.keys(t.productos||{}).length>0&&await Y.saveAliases(V.PRODUCT,t.productos);for(const c of a.statistics.newVehicles)try{const i=qe(c);await Xe.createVehicle({vehicleId:i,name:c,type:ba(c),fuelType:"GASOLINA",status:"activo",hasHourMeter:Ca(c),currentHours:0,description:`Creado automáticamente durante migración ${s.migrationId}`}),s.statistics.newVehiclesCreated++,console.log(`✅ Vehículo creado: ${i} - ${c}`)}catch(i){console.error(`❌ Error creando vehículo ${c}:`,i),s.warnings.push(`No se pudo crear vehículo '${c}': ${i.message}`)}for(const c of a.statistics.newProducts)try{const i=Fe(c);i&&!Object.values(te).includes(i)&&(await Ke({name:i,displayName:c,category:"Combustible",unit:"gal",defaultPrice:0,isActive:!0,description:`Creado automáticamente durante migración ${s.migrationId}`}),s.statistics.newProductsCreated++,console.log(`✅ Producto creado: ${c}`))}catch(i){console.error(`❌ Error creando producto ${c}:`,i),s.warnings.push(`No se pudo crear producto '${c}': ${i.message}`)}const l=100,d=a.processedData.filter(c=>c.errors.length===0);for(let c=0;c<d.length;c+=l){const i=d.slice(c,c+l);for(const o of i){try{const h=Ea(o.mapped);await We.createMovement(h),s.statistics.successfulRows++,s.statistics.movementsCreated++}catch(h){console.error(`❌ Error creando movimiento fila ${o.rowNumber}:`,h),s.errors.push(`Fila ${o.rowNumber}: ${h.message}`),s.statistics.failedRows++}if(s.statistics.processedRows++,n){const h=s.statistics.processedRows/d.length*100;n({progress:Math.round(h),processedRows:s.statistics.processedRows,totalRows:d.length,currentStep:`Procesando lote ${Math.floor(c/l)+1}...`})}}}return s.completedAt=new Date,s.success=s.statistics.failedRows<d.length*.1,console.log(`🎉 Migración completada: ${s.statistics.successfulRows}/${d.length} movimientos creados`),{success:!0,executionResult:s,error:null}}catch(s){return console.error("❌ Error en ejecución de migración:",s),{success:!1,error:s.message,executionResult:null}}},Me=(a,t,n,s)=>{if(a==null||a==="")return t.required?{error:`Campo '${n}' requerido en fila ${s}`}:{value:null};switch(t.type){case"date":{const l=wa(a);return l?{value:l}:{error:`Fecha inválida '${a}' en fila ${s}`}}case"number":{const l=parseFloat(a);return isNaN(l)||l<0?{error:`Número inválido '${a}' en fila ${s}`}:{value:l}}case"string":return{value:a.toString().trim()};default:return{value:a}}},wa=a=>{if(a instanceof Date)return a;if(typeof a=="number"){const l=new Date((a-25569)*86400*1e3);return he(l)?l:null}const t=a.toString().trim(),n=[/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/,/^(\d{4})-(\d{1,2})-(\d{1,2})$/,/^(\d{1,2})-(\d{1,2})-(\d{4})$/];for(const l of n){const d=t.match(l);if(d){let c,i,o;l.source.includes("YYYY")&&(l.source.startsWith("^(\\d{4})")?[,o,i,c]=d:[,c,i,o]=d);const h=new Date(parseInt(o),parseInt(i)-1,parseInt(c));return he(h)?h:null}}const s=new Date(t);return he(s)?s:null},he=a=>a instanceof Date&&!isNaN(a.getTime())&&a.getFullYear()>1900,qe=a=>{const t=a.toUpperCase().replace(/[^A-Z0-9]/g,"");return t.includes("TR")&&t.match(/\d/)?`TR-${t.match(/\d+/)?.[0]}`:t.includes("CAMIONETA")?t.includes("AMARILLA")?"CA-001":t.includes("BURBUJA")?"CB-001":"CM-001":t.includes("CARRO")?"CR-001":t.includes("VOLQUETA")?"VQ-001":t.includes("MOTO")?`MT-${Math.floor(Math.random()*100)}`:`${t.substring(0,2)||"EQ"}-${Math.floor(Math.random()*1e3)}`},ba=a=>{const t=a.toLowerCase();return t.includes("tractor")||t.includes("tr-")?"tractor":t.includes("camioneta")?"pickup_truck":t.includes("carro")?"car":t.includes("volqueta")?"log_truck":t.includes("moto")?"motorcycle":t.includes("bomba")?"water_pump":t.includes("planta")?"generator":t.includes("fumigadora")?"fumigadora":t.includes("guadaña")?"guadana":t.includes("hidrolavadora")?"hidrolavadora":"otros"},Ca=a=>{const t=a.toLowerCase();return t.includes("tr-")||t.includes("tractor")},Fe=a=>{const t=a.toLowerCase().trim();return t.includes("gasolina")?te.GASOLINA:t.includes("acpm")?te.ACPM:t.includes("diesel")?te.ACPM:te.GASOLINA},Ea=a=>({type:Ze.SALIDA,fuelType:a.productoId||te.GASOLINA,quantity:a.cantidad,unitPrice:a.precio||0,vehicleId:a.vehiculoId,location:a.ubicacion||"principal",destinationLocation:a.destino,currentHours:a.horometro,description:a.descripcion||"Migrado desde archivo histórico",effectiveDate:a.fecha,reference:`MIGRACION_${Date.now()}`,status:Qe.COMPLETADO}),ee={createMigrationContext:ga,processFile:va,configureColumnMapping:ja,configureValueMapping:fa,validateData:Na,executeMigration:ya,MIGRATION_STEPS:U,REQUIRED_FIELDS:W,OPTIONAL_FIELDS:we},ka=({onFileProcessed:a,currentFile:t=null,isLoading:n=!1,error:s=null})=>{const[l,d]=x.useState(!1),[c,i]=x.useState(0),[o,h]=x.useState(!1),[k,N]=x.useState({excel:{cellText:!1,cellDates:!0},csv:{delimiter:",",quote:'"',skipEmptyLines:!0,trimValues:!0}}),D=x.useRef(null),y=x.useCallback(async m=>{const g=m[0];if(g){i(0);try{const w=setInterval(()=>{i(A=>A>=90?(clearInterval(w),90):A+10)},100);await a(g,k),clearInterval(w),i(100)}catch(w){console.error("Error procesando archivo:",w)}}},[a,k]),O=x.useCallback(m=>{m.preventDefault(),d(!0)},[]),j=x.useCallback(m=>{m.preventDefault(),d(!1)},[]),E=x.useCallback(m=>{m.preventDefault(),d(!1);const g=Array.from(m.dataTransfer.files);y(g)},[y]),S=()=>{D.current?.click()},T=()=>{D.current&&(D.current.value=""),i(0),a(null)},M=m=>{if(m===0)return"0 Bytes";const g=1024,w=["Bytes","KB","MB","GB"],A=Math.floor(Math.log(m)/Math.log(g));return parseFloat((m/Math.pow(g,A)).toFixed(2))+" "+w[A]},H=m=>{switch(m.split(".").pop()?.toLowerCase()){case"xlsx":case"xls":return e.jsx(ke,{className:"text-green-600",size:24});case"csv":return e.jsx(fe,{className:"text-blue-600",size:24});default:return e.jsx(ke,{className:"text-gray-600",size:24})}};return e.jsxs("div",{className:"file-upload-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(se,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Formatos soportados"}),e.jsx("p",{children:"Excel (.xlsx, .xls) y CSV (.csv) con datos históricos de combustibles"})]})]}),t?.success?e.jsxs("div",{className:"file-preview-card",children:[e.jsxs("div",{className:"file-header",children:[e.jsxs("div",{className:"file-info",children:[H(t.metadata.fileName),e.jsxs("div",{className:"file-details",children:[e.jsx("h4",{children:t.metadata.fileName}),e.jsxs("div",{className:"file-meta",children:[e.jsx("span",{children:M(t.metadata.fileSize)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:t.metadata.fileType}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[t.metadata.rowCount," filas"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[t.metadata.columnCount," columnas"]})]})]})]}),e.jsxs("div",{className:"file-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>h(!o),title:"Opciones avanzadas",children:e.jsx(Gs,{size:16})}),e.jsx("button",{className:"btn-icon danger",onClick:T,title:"Remover archivo",children:e.jsx(le,{size:16})})]})]}),e.jsxs("div",{className:"processing-status success",children:[e.jsx(G,{size:16}),e.jsx("span",{children:"Archivo procesado exitosamente"})]}),t.preview&&t.preview.headers.length>0&&e.jsxs("div",{className:"data-preview",children:[e.jsxs("div",{className:"preview-header",children:[e.jsx(Q,{size:16}),e.jsxs("span",{children:["Vista previa de datos (",t.preview.total," filas total)"]})]}),e.jsx("div",{className:"preview-table-container",children:e.jsxs("table",{className:"preview-table",children:[e.jsx("thead",{children:e.jsx("tr",{children:t.preview.headers.map((m,g)=>e.jsx("th",{title:m,children:m},g))})}),e.jsx("tbody",{children:t.preview.preview.map((m,g)=>e.jsx("tr",{children:t.preview.headers.map((w,A)=>e.jsx("td",{title:m[w],children:m[w]?.toString()||"—"},A))},g))})]})}),e.jsxs("div",{className:"preview-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Filas encontradas:"}),e.jsx("span",{className:"stat-value",children:t.preview.statistics.totalRows})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Columnas detectadas:"}),e.jsx("span",{className:"stat-value",children:t.preview.statistics.totalColumns})]})]})]}),t.columnSuggestions&&Object.keys(t.columnSuggestions).length>0&&e.jsxs("div",{className:"suggestions-preview",children:[e.jsx("h5",{children:"Mapeos sugeridos automáticamente:"}),e.jsx("div",{className:"suggestions-grid",children:Object.entries(t.columnSuggestions).map(([m,g])=>e.jsxs("div",{className:"suggestion-item",children:[e.jsx("span",{className:"field-name",children:m}),e.jsx("span",{className:"arrow",children:"→"}),e.jsx("span",{className:"column-name",children:g})]},m))})]})]}):e.jsxs("div",{className:`upload-zone ${l?"drag-over":""} ${n?"loading":""}`,onDragOver:O,onDragLeave:j,onDrop:E,onClick:S,children:[e.jsx("div",{className:"upload-content",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"upload-spinner",children:e.jsx("div",{className:"spinner"})}),e.jsx("h3",{children:"Procesando archivo..."}),e.jsx("p",{children:"Analizando estructura y validando formato"}),c>0&&e.jsxs("div",{className:"progress-container",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${c}%`}})}),e.jsxs("span",{className:"progress-text",children:[c,"%"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{size:48,className:"upload-icon"}),e.jsx("h3",{children:"Arrastra tu archivo aquí"}),e.jsx("p",{children:"o haz clic para seleccionar desde tu computadora"}),e.jsxs("div",{className:"supported-formats",children:[e.jsx("span",{className:"format-tag excel",children:"Excel (.xlsx, .xls)"}),e.jsx("span",{className:"format-tag csv",children:"CSV (.csv)"})]})]})}),e.jsx("input",{ref:D,type:"file",accept:".xlsx,.xls,.csv",onChange:m=>y(Array.from(m.target.files)),style:{display:"none"}})]}),o&&e.jsxs("div",{className:"advanced-options",children:[e.jsx("h4",{children:"Opciones de procesamiento"}),e.jsxs("div",{className:"option-group",children:[e.jsx("h5",{children:"Opciones Excel"}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:k.excel.cellDates,onChange:m=>N(g=>({...g,excel:{...g.excel,cellDates:m.target.checked}}))}),e.jsx("span",{children:"Convertir fechas automáticamente"})]})]}),e.jsxs("div",{className:"option-group",children:[e.jsx("h5",{children:"Opciones CSV"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("label",{children:["Delimitador:",e.jsxs("select",{value:k.csv.delimiter,onChange:m=>N(g=>({...g,csv:{...g.csv,delimiter:m.target.value}})),children:[e.jsx("option",{value:",",children:"Coma (,)"}),e.jsx("option",{value:";",children:"Punto y coma (;)"}),e.jsx("option",{value:"\\t",children:"Tabulación"})]})]}),e.jsxs("label",{children:["Comillas:",e.jsxs("select",{value:k.csv.quote,onChange:m=>N(g=>({...g,csv:{...g.csv,quote:m.target.value}})),children:[e.jsx("option",{value:'"',children:'Comillas dobles (")'}),e.jsx("option",{value:"'",children:"Comillas simples (')"})]})]})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:k.csv.skipEmptyLines,onChange:m=>N(g=>({...g,csv:{...g.csv,skipEmptyLines:m.target.checked}}))}),e.jsx("span",{children:"Omitir líneas vacías"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:k.csv.trimValues,onChange:m=>N(g=>({...g,csv:{...g.csv,trimValues:m.target.checked}}))}),e.jsx("span",{children:"Limpiar espacios en valores"})]})]})]}),s&&e.jsxs("div",{className:"error-message",children:[e.jsx(B,{size:20}),e.jsx("span",{children:s})]})]})},Sa=({fileHeaders:a=[],currentMapping:t={},columnSuggestions:n={},onMappingChange:s,previewData:l=[],isLoading:d=!1,error:c=null})=>{const[i,o]=x.useState(t),[h,k]=x.useState(null),[N,D]=x.useState(!1),[y,O]=x.useState(null);x.useEffect(()=>{Object.keys(t).length>0?o(t):Object.keys(n).length>0&&o(n)},[t,n]);const j=x.useMemo(()=>{const p=Object.keys(W).filter(F=>!i[F]),L=Object.values(i),b=a.filter(F=>!L.includes(F)),q=L.filter((F,K)=>L.indexOf(F)!==K);return{isValid:p.length===0&&q.length===0,missingRequired:p,unmappedColumns:b,duplicateColumns:q,totalMapped:Object.keys(i).length,requiredMapped:Object.keys(W).filter(F=>i[F]).length}},[i,a]),E=x.useCallback((p,L)=>{const b={...i};L?(Object.keys(b).forEach(q=>{b[q]===L&&delete b[q]}),b[p]=L):delete b[p],o(b),s(b)},[i,s]),S=()=>{o({...n}),s(n)},T=()=>{o({}),s({})},M=(p,L)=>{k(L),p.dataTransfer.effectAllowed="move"},H=(p,L)=>{p.preventDefault(),p.dataTransfer.dropEffect="move",O(L)},m=()=>{O(null)},g=(p,L)=>{p.preventDefault(),h&&E(L,h),k(null),O(null)},w=p=>W[p]?"required":"optional",A=()=>{if(!N||l.length===0)return null;const p=l.slice(0,3).map(L=>{const b={};return Object.entries(i).forEach(([q,F])=>{b[q]=L[F]}),b});return e.jsxs("div",{className:"mapping-preview",children:[e.jsxs("div",{className:"preview-header",children:[e.jsx(Q,{size:16}),e.jsx("span",{children:"Vista previa del mapeo"})]}),e.jsx("div",{className:"preview-table-container",children:e.jsxs("table",{className:"preview-table",children:[e.jsx("thead",{children:e.jsx("tr",{children:Object.keys(i).map(L=>e.jsxs("th",{children:[L,e.jsx("span",{className:`field-type ${w(L)}`,children:w(L)==="required"?"REQ":"OPT"})]},L))})}),e.jsx("tbody",{children:p.map((L,b)=>e.jsx("tr",{children:Object.keys(i).map(q=>e.jsx("td",{children:L[q]?.toString()||"—"},q))},b))})]})})]})};return e.jsxs("div",{className:"column-mapping-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(se,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Mapeo de columnas"}),e.jsx("p",{children:"Relaciona las columnas de tu archivo con los campos del sistema. Los campos marcados como REQ son obligatorios."})]})]}),e.jsxs("div",{className:"mapping-status",children:[e.jsxs("div",{className:"status-grid",children:[e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-label",children:"Campos mapeados:"}),e.jsx("span",{className:"status-value",children:j.totalMapped})]}),e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-label",children:"Obligatorios:"}),e.jsxs("span",{className:`status-value ${j.requiredMapped===Object.keys(W).length?"success":"warning"}`,children:[j.requiredMapped,"/",Object.keys(W).length]})]}),e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-label",children:"Sin mapear:"}),e.jsx("span",{className:"status-value",children:j.unmappedColumns.length})]})]}),e.jsxs("div",{className:"mapping-actions",children:[e.jsxs("button",{className:"btn-secondary",onClick:S,disabled:Object.keys(n).length===0,children:[e.jsx($e,{size:16}),"Aplicar sugerencias"]}),e.jsxs("button",{className:"btn-secondary",onClick:T,disabled:Object.keys(i).length===0,children:[e.jsx(de,{size:16}),"Limpiar todo"]}),e.jsxs("button",{className:"btn-secondary",onClick:()=>D(!N),disabled:Object.keys(i).length===0,children:[e.jsx(Q,{size:16}),N?"Ocultar":"Ver"," preview"]})]})]}),!j.isValid&&e.jsxs("div",{className:"validation-messages",children:[j.missingRequired.length>0&&e.jsxs("div",{className:"validation-error",children:[e.jsx(B,{size:16}),e.jsxs("span",{children:["Campos obligatorios sin mapear: ",j.missingRequired.join(", ")]})]}),j.duplicateColumns.length>0&&e.jsxs("div",{className:"validation-error",children:[e.jsx(B,{size:16}),e.jsxs("span",{children:["Columnas duplicadas: ",j.duplicateColumns.join(", ")]})]})]}),e.jsxs("div",{className:"mapping-container",children:[e.jsxs("div",{className:"file-columns",children:[e.jsxs("h3",{children:[e.jsx(Ee,{size:20}),"Columnas del archivo (",a.length,")"]}),e.jsx("div",{className:"columns-list",children:a.map((p,L)=>e.jsxs("div",{className:`column-item ${Object.values(i).includes(p)?"mapped":"unmapped"} ${h===p?"dragging":""}`,draggable:!0,onDragStart:b=>M(b,p),children:[e.jsx("span",{className:"column-name",children:p}),Object.values(i).includes(p)&&e.jsx(G,{size:14,className:"mapped-icon"})]},L))})]}),e.jsx("div",{className:"mapping-arrow",children:e.jsx(re,{size:24})}),e.jsxs("div",{className:"system-fields",children:[e.jsxs("h3",{children:[e.jsx(Ee,{size:20}),"Campos del sistema"]}),e.jsxs("div",{className:"field-group",children:[e.jsx("h4",{children:"Campos obligatorios"}),e.jsx("div",{className:"fields-list",children:Object.entries(W).map(([p,L])=>e.jsxs("div",{className:`field-item required ${i[p]?"mapped":"unmapped"} ${y===p?"hovered":""}`,onDragOver:b=>H(b,p),onDragLeave:m,onDrop:b=>g(b,p),children:[e.jsxs("div",{className:"field-header",children:[e.jsx("span",{className:"field-name",children:p}),e.jsx("span",{className:"field-type required",children:"REQ"})]}),e.jsx("p",{className:"field-description",children:L.description}),i[p]?e.jsxs("div",{className:"mapped-column",children:[e.jsxs("span",{className:"mapped-to",children:["→ ",i[p]]}),e.jsx("button",{className:"unmap-btn",onClick:()=>E(p,null),children:"×"})]}):e.jsx("div",{className:"unmapped-field",children:e.jsxs("select",{value:"",onChange:b=>E(p,b.target.value),className:"column-select",children:[e.jsx("option",{value:"",children:"Seleccionar columna..."}),a.filter(b=>!Object.values(i).includes(b)).map(b=>e.jsx("option",{value:b,children:b},b))]})})]},p))})]}),e.jsxs("div",{className:"field-group",children:[e.jsx("h4",{children:"Campos opcionales"}),e.jsx("div",{className:"fields-list",children:Object.entries(we).map(([p,L])=>e.jsxs("div",{className:`field-item optional ${i[p]?"mapped":"unmapped"} ${y===p?"hovered":""}`,onDragOver:b=>H(b,p),onDragLeave:m,onDrop:b=>g(b,p),children:[e.jsxs("div",{className:"field-header",children:[e.jsx("span",{className:"field-name",children:p}),e.jsx("span",{className:"field-type optional",children:"OPT"})]}),e.jsx("p",{className:"field-description",children:L.description}),i[p]?e.jsxs("div",{className:"mapped-column",children:[e.jsxs("span",{className:"mapped-to",children:["→ ",i[p]]}),e.jsx("button",{className:"unmap-btn",onClick:()=>E(p,null),children:"×"})]}):e.jsx("div",{className:"unmapped-field",children:e.jsxs("select",{value:"",onChange:b=>E(p,b.target.value),className:"column-select",children:[e.jsx("option",{value:"",children:"Seleccionar columna..."}),a.filter(b=>!Object.values(i).includes(b)).map(b=>e.jsx("option",{value:b,children:b},b))]})})]},p))})]})]})]}),A(),c&&e.jsxs("div",{className:"error-message",children:[e.jsx(B,{size:20}),e.jsx("span",{children:c})]})]})},Ma=({mappedData:a=[],columnMapping:t={},onValueMappingChange:n,currentValueMapping:s={},isLoading:l=!1,error:d=null})=>{const[c,i]=x.useState(s),[o,h]=x.useState(!1),[k,N]=x.useState("vehicle"),[D,y]=x.useState({}),[O,j]=x.useState(null),[E,S]=x.useState(""),[T,M]=x.useState(!1),[H,m]=x.useState({}),g=x.useMemo(()=>{const r=[];return Object.entries(t).forEach(([u,v])=>{u.toLowerCase().includes("vehicle")||u==="vehicleId"?r.push({systemField:u,fileColumn:v,aliasType:V.VEHICLE,displayName:"Vehículos",icon:"🚛",description:"Mapear nombres de vehículos a códigos del sistema"}):u.toLowerCase().includes("product")||u==="productName"?r.push({systemField:u,fileColumn:v,aliasType:V.PRODUCT,displayName:"Productos",icon:"⛽",description:"Mapear nombres de combustibles a códigos del sistema"}):u.toLowerCase().includes("location")||u==="location"?r.push({systemField:u,fileColumn:v,aliasType:V.LOCATION,displayName:"Ubicaciones",icon:"📍",description:"Mapear nombres de ubicaciones a códigos del sistema"}):(u.toLowerCase().includes("supplier")||u==="supplierName")&&r.push({systemField:u,fileColumn:v,aliasType:V.SUPPLIER,displayName:"Proveedores",icon:"🏢",description:"Mapear nombres de proveedores a códigos del sistema"})}),r},[t]),w=x.useMemo(()=>{const r={};return g.forEach(u=>{const v=a.map(f=>f[u.fileColumn]).filter(f=>f&&f.toString().trim()).map(f=>f.toString().trim());r[u.aliasType]=[...new Set(v)].sort()}),r},[a,g]);x.useEffect(()=>{(async()=>{if(Object.keys(s).length>0){i(s);return}M(!0);const u={};try{for(const v of g){const f=w[v.aliasType]||[];if(f.length>0){const _=await Y.getSuggestedMappings(v.aliasType,f);u[v.aliasType]=_}}i(u),n(u)}catch(v){console.error("Error cargando sugerencias:",v)}finally{M(!1)}})()},[g,w,s,n]),x.useEffect(()=>{(async()=>{const u={};for(const v of Object.values(V))try{const f=await Y.getAliasesByType(v);u[v]={totalAliases:f?.metadata?.totalMappings||0,lastUsed:f?.metadata?.lastUsed||null,usageCount:f?.metadata?.usageCount||0}}catch{u[v]={totalAliases:0,lastUsed:null,usageCount:0}}m(u)})()},[]);const A=x.useMemo(()=>{const r={};let u=0,v=0;return g.forEach(f=>{const _=w[f.aliasType]||[],$=c[f.aliasType]||{},C=_.filter(I=>$[I]?.suggested&&$[I].suggested!==null),z=_.filter(I=>!$[I]?.suggested||$[I].suggested===null);r[f.aliasType]={total:_.length,mapped:C.length,unmapped:z.length,mappedValues:C,unmappedValues:z,percentage:_.length>0?C.length/_.length*100:100},u+=C.length,v+=z.length}),{byType:r,overall:{totalMapped:u,totalUnmapped:v,percentage:u+v>0?u/(u+v)*100:100}}},[g,w,c]),p=x.useCallback(async(r,u,v)=>{const f={...c};if(f[r]||(f[r]={}),f[r][u]={suggested:v,confidence:1,source:"manual",alternatives:[]},i(f),n(f),v)try{await Y.saveAliases(r,{[u]:v})}catch(_){console.error("Error guardando alias:",_)}},[c,n]),L=async()=>{M(!0);try{const r={};for(const u of g){const v=w[u.aliasType]||[];if(v.length>0){const f=await Y.getSuggestedMappings(u.aliasType,v);r[u.aliasType]=f}}i(r),n(r)}catch(r){console.error("Error aplicando sugerencias:",r)}finally{M(!1)}},b=()=>{i({}),n({})},q=async()=>{if(!(!O||!E.trim()))try{await p(O.aliasType,O.inputValue,E.trim()),j(null),S("")}catch(r){console.error("Error guardando alias:",r)}},F=r=>{const u=w[r]||[],v=D[r]||"";return v.trim()?u.filter(f=>f.toLowerCase().includes(v.toLowerCase())):u},K=()=>{if(!o||a.length===0)return null;const r=a.slice(0,5).map(u=>{const v={...u};return g.forEach(f=>{const _=u[f.fileColumn],$=c[f.aliasType]?.[_];$?.suggested&&(v[`${f.fileColumn}_mapped`]=$.suggested)}),v});return e.jsxs("div",{className:"mapping-preview",children:[e.jsxs("div",{className:"preview-header",children:[e.jsx(Q,{size:16}),e.jsxs("span",{children:["Vista previa del mapeo de valores (",a.length," filas total)"]})]}),e.jsx("div",{className:"preview-table-container",children:e.jsxs("table",{className:"preview-table",children:[e.jsx("thead",{children:e.jsx("tr",{children:g.map(u=>e.jsxs(pe.Fragment,{children:[e.jsxs("th",{className:"original-column",children:[u.fileColumn," (Original)"]}),e.jsxs("th",{className:"mapped-column",children:[u.fileColumn," (Mapeado)"]})]},u.aliasType))})}),e.jsx("tbody",{children:r.map((u,v)=>e.jsx("tr",{children:g.map(f=>e.jsxs(pe.Fragment,{children:[e.jsx("td",{className:"original-value",children:u[f.fileColumn]||"—"}),e.jsx("td",{className:"mapped-value",children:e.jsx("span",{className:`mapped-result ${u[`${f.fileColumn}_mapped`]?"success":"pending"}`,children:u[`${f.fileColumn}_mapped`]||"Sin mapear"})})]},f.aliasType))},v))})]})})]})};return g.length===0?e.jsx("div",{className:"value-mapping-step",children:e.jsxs("div",{className:"step-info-card",children:[e.jsx(se,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"No se requiere mapeo de valores"}),e.jsx("p",{children:"Los campos mapeados no requieren conversión de valores. Puedes continuar al siguiente paso."})]})]})}):e.jsxs("div",{className:"value-mapping-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(se,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Mapeo de valores"}),e.jsx("p",{children:"Convierte nombres descriptivos del archivo a códigos específicos del sistema. Los alias se guardan para reutilizar en futuras migraciones."})]})]}),e.jsxs("div",{className:"mapping-status",children:[e.jsx("div",{className:"status-overview",children:e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-label",children:"Progreso total:"}),e.jsxs("div",{className:"status-progress",children:[e.jsx("div",{className:"progress-bar",style:{width:`${A.overall.percentage}%`}}),e.jsxs("span",{className:"progress-text",children:[A.overall.totalMapped," / ",A.overall.totalMapped+A.overall.totalUnmapped,"(",Math.round(A.overall.percentage),"%)"]})]})]})}),e.jsxs("div",{className:"mapping-actions",children:[e.jsxs("button",{className:"btn-secondary",onClick:L,disabled:T,children:[e.jsx($e,{size:16}),T?"Cargando...":"Recargar sugerencias"]}),e.jsxs("button",{className:"btn-secondary",onClick:b,disabled:Object.keys(c).length===0,children:[e.jsx(de,{size:16}),"Limpiar todo"]}),e.jsxs("button",{className:"btn-secondary",onClick:()=>h(!o),disabled:Object.keys(c).length===0,children:[e.jsx(Q,{size:16}),o?"Ocultar":"Ver"," preview"]})]})]}),e.jsxs("div",{className:"mapping-tabs",children:[e.jsx("div",{className:"tab-buttons",children:g.map(r=>e.jsxs("button",{className:`tab-button ${k===r.aliasType?"active":""}`,onClick:()=>N(r.aliasType),children:[e.jsx("span",{className:"tab-icon",children:r.icon}),e.jsx("span",{className:"tab-text",children:r.displayName}),e.jsxs("span",{className:"tab-badge",children:[A.byType[r.aliasType]?.mapped||0," / ",A.byType[r.aliasType]?.total||0]})]},r.aliasType))}),g.map(r=>{if(r.aliasType!==k)return null;const u=A.byType[r.aliasType],v=F(r.aliasType),f=c[r.aliasType]||{};return e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{className:"tab-header",children:[e.jsxs("div",{className:"tab-info",children:[e.jsxs("h3",{children:[r.icon," ",r.displayName]}),e.jsx("p",{children:r.description})]}),e.jsxs("div",{className:"tab-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx(Oe,{size:16}),e.jsxs("span",{children:["Progreso: ",Math.round(u?.percentage||0),"%"]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx(ce,{size:16}),e.jsxs("span",{children:["Alias guardados: ",H[r.aliasType]?.totalAliases||0]})]})]})]}),e.jsxs("div",{className:"search-bar",children:[e.jsx(De,{size:16}),e.jsx("input",{type:"text",placeholder:`Buscar en ${v.length} valores de ${r.displayName.toLowerCase()}...`,value:D[r.aliasType]||"",onChange:_=>y($=>({...$,[r.aliasType]:_.target.value}))})]}),e.jsx("div",{className:"values-mapping-list",children:v.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("span",{children:"No se encontraron valores para mapear"})}):v.map(_=>{const $=f[_],C=$?.suggested&&$.suggested!==null;return e.jsxs("div",{className:`value-mapping-item ${C?"mapped":"unmapped"}`,children:[e.jsxs("div",{className:"value-info",children:[e.jsxs("div",{className:"original-value",children:[e.jsx("span",{className:"value-text",children:_}),e.jsxs("span",{className:"value-count",children:[a.filter(z=>z[r.fileColumn]===_).length," registros"]})]}),C&&e.jsxs("div",{className:"mapped-result",children:[e.jsx(re,{size:14}),e.jsx("span",{className:"mapped-value",children:$.suggested}),e.jsxs("span",{className:`confidence ${$.confidence>=.8?"high":$.confidence>=.5?"medium":"low"}`,children:[Math.round($.confidence*100),"%"]}),e.jsx("span",{className:"source",children:$.source})]})]}),e.jsxs("div",{className:"value-actions",children:[$?.alternatives&&$.alternatives.length>0&&e.jsxs("select",{className:"alternatives-select",value:$.suggested||"",onChange:z=>p(r.aliasType,_,z.target.value),children:[e.jsxs("option",{value:$.suggested,children:[$.suggested," (Sugerido)"]}),$.alternatives.map(z=>e.jsxs("option",{value:z.id,children:[z.id," (",Math.round(z.confidence*100),"%)"]},z.id))]}),e.jsx("button",{className:"btn-icon",onClick:()=>{j({aliasType:r.aliasType,inputValue:_}),S($?.suggested||"")},title:"Editar mapeo",children:e.jsx(_s,{size:14})}),C&&e.jsx("button",{className:"btn-icon danger",onClick:()=>p(r.aliasType,_,null),title:"Eliminar mapeo",children:e.jsx(le,{size:14})})]})]},_)})})]},r.aliasType)})]}),O&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h4",{children:"Editar mapeo"}),e.jsx("button",{className:"btn-icon",onClick:()=>{j(null),S("")},children:e.jsx(le,{size:16})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Valor original:"}),e.jsx("input",{type:"text",value:O.inputValue,disabled:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Mapear a:"}),e.jsx("input",{type:"text",value:E,onChange:r=>S(r.target.value),placeholder:"Código del sistema (ej: V-001, DIESEL, etc.)",autoFocus:!0})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>{j(null),S("")},children:"Cancelar"}),e.jsxs("button",{className:"btn-primary",onClick:q,disabled:!E.trim(),children:[e.jsx(Fs,{size:16}),"Guardar alias"]})]})]})}),K(),d&&e.jsxs("div",{className:"error-message",children:[e.jsx(B,{size:20}),e.jsx("span",{children:d})]})]})},Ra=({fileData:a=[],columnMapping:t={},valueMapping:n={},onValidationComplete:s,currentValidation:l=null,isValidating:d=!1,error:c=null})=>{const[i,o]=x.useState(l),[h,k]=x.useState(!0),[N,D]=x.useState("overview"),[y,O]=x.useState("all"),[j,E]=x.useState(""),[S,T]=x.useState(1),[M]=x.useState(10),[H,m]=x.useState(new Set);x.useEffect(()=>{(async()=>{if(!l&&a.length>0&&Object.keys(t).length>0)try{const u=await ee.validateData(a,t,n);u.success&&(o(u.validationResult),s(u.validationResult))}catch(u){console.error("Error en validación automática:",u)}else l&&o(l)})()},[a,t,n,l,s]);const g=async()=>{try{const r=await ee.validateData(a,t,n);r.success&&(o(r.validationResult),s(r.validationResult))}catch(r){console.error("Error ejecutando validación:",r)}},w=x.useMemo(()=>{if(!i?.processedData)return[];let r=i.processedData;switch(y){case"valid":r=r.filter(u=>u.errors.length===0);break;case"invalid":r=r.filter(u=>u.errors.length>0);break;case"warnings":r=r.filter(u=>u.warnings.length>0);break}if(j.trim()){const u=j.toLowerCase();r=r.filter(v=>{const f=Object.values(v.original).join(" ").toLowerCase(),_=Object.values(v.mapped).join(" ").toLowerCase();return f.includes(u)||_.includes(u)})}return r},[i,y,j]),A=x.useMemo(()=>{const r=(S-1)*M;return w.slice(r,r+M)},[w,S,M]),p=x.useMemo(()=>{if(!i)return null;const r=i.statistics,u=r.totalRows>0?r.validRows/r.totalRows*100:0;return{...r,successRate:u,hasErrors:i.errors.length>0,hasWarnings:i.warnings.length>0,totalPages:Math.ceil(w.length/M)}},[i,w.length,M]),L=r=>{const u=new Set(H);u.has(r)?u.delete(r):u.add(r),m(u)},b=()=>{if(!i)return;const r={summary:p,dateRange:i.statistics.dateRange,newEntities:{vehicles:i.statistics.newVehicles,products:i.statistics.newProducts},errors:i.errors,warnings:i.warnings,exportedAt:new Date().toISOString()},u=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),v=URL.createObjectURL(u),f=document.createElement("a");f.href=v,f.download=`validacion_migracion_${Date.now()}.json`,f.click(),URL.revokeObjectURL(v)},q=()=>p?e.jsxs("div",{className:"validation-overview",children:[e.jsxs("div",{className:"main-stats-grid",children:[e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(G,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:p.validRows}),e.jsx("p",{children:"Filas válidas"}),e.jsxs("span",{className:"stat-percentage",children:[Math.round(p.successRate),"%"]})]})]}),e.jsxs("div",{className:"stat-card error",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(B,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:p.invalidRows}),e.jsx("p",{children:"Filas con errores"}),e.jsxs("span",{className:"stat-percentage",children:[Math.round(100-p.successRate),"%"]})]})]}),e.jsxs("div",{className:"stat-card warning",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(J,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:i.warnings.length}),e.jsx("p",{children:"Advertencias"}),e.jsx("span",{className:"stat-note",children:"No bloquean migración"})]})]}),e.jsxs("div",{className:"stat-card info",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(ce,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:p.totalRows}),e.jsx("p",{children:"Total de filas"}),e.jsx("span",{className:"stat-note",children:"Archivo procesado"})]})]})]}),e.jsxs("div",{className:"detailed-stats-grid",children:[e.jsxs("div",{className:"stat-group",children:[e.jsxs("h4",{children:[e.jsx(ds,{size:16})," Rango de fechas"]}),e.jsxs("div",{className:"stat-values",children:[e.jsxs("span",{children:["Desde: ",p.dateRange.min?.toLocaleDateString("es-CO")||"N/A"]}),e.jsxs("span",{children:["Hasta: ",p.dateRange.max?.toLocaleDateString("es-CO")||"N/A"]})]})]}),e.jsxs("div",{className:"stat-group",children:[e.jsxs("h4",{children:[e.jsx(ve,{size:16})," Nuevos vehículos"]}),e.jsxs("div",{className:"stat-values",children:[e.jsx("span",{className:"stat-number",children:p.newVehicles.length}),e.jsx("span",{className:"stat-detail",children:"Se crearán automáticamente"})]})]}),e.jsxs("div",{className:"stat-group",children:[e.jsxs("h4",{children:[e.jsx(me,{size:16})," Nuevos productos"]}),e.jsxs("div",{className:"stat-values",children:[e.jsx("span",{className:"stat-number",children:p.newProducts.length}),e.jsx("span",{className:"stat-detail",children:"Se crearán automáticamente"})]})]}),e.jsxs("div",{className:"stat-group",children:[e.jsxs("h4",{children:[e.jsx(ge,{size:16})," Estimación"]}),e.jsxs("div",{className:"stat-values",children:[e.jsxs("span",{children:[p.validRows," movimientos"]}),e.jsx("span",{className:"stat-detail",children:"Listos para migrar"})]})]})]}),e.jsxs("div",{className:"validation-progress",children:[e.jsxs("div",{className:"progress-header",children:[e.jsx("span",{children:"Estado de validación"}),e.jsxs("span",{children:[p.validRows,"/",p.totalRows," filas válidas"]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill success",style:{width:`${p.successRate}%`}})})]})]}):null,F=()=>{const r=i?.errors||[],u=i?.warnings||[];return e.jsxs("div",{className:"errors-warnings-section",children:[r.length>0&&e.jsxs("div",{className:"message-group errors",children:[e.jsxs("h4",{children:[e.jsx(B,{size:16}),"Errores (",r.length,")"]}),e.jsxs("div",{className:"messages-list",children:[r.slice(0,20).map((v,f)=>e.jsx("div",{className:"message-item error",children:e.jsx("span",{className:"message-text",children:v})},f)),r.length>20&&e.jsx("div",{className:"message-item info",children:e.jsxs("span",{children:["... y ",r.length-20," errores más"]})})]})]}),u.length>0&&e.jsxs("div",{className:"message-group warnings",children:[e.jsxs("h4",{children:[e.jsx(J,{size:16}),"Advertencias (",u.length,")"]}),e.jsxs("div",{className:"messages-list",children:[u.slice(0,20).map((v,f)=>e.jsx("div",{className:"message-item warning",children:e.jsx("span",{className:"message-text",children:v})},f)),u.length>20&&e.jsx("div",{className:"message-item info",children:e.jsxs("span",{children:["... y ",u.length-20," advertencias más"]})})]})]}),r.length===0&&u.length===0&&e.jsxs("div",{className:"no-issues",children:[e.jsx(G,{size:48}),e.jsx("h3",{children:"¡Todo perfecto!"}),e.jsx("p",{children:"No se encontraron errores ni advertencias en los datos."})]})]})},K=()=>!h||A.length===0?null:e.jsxs("div",{className:"data-preview-section",children:[e.jsxs("div",{className:"preview-controls",children:[e.jsxs("div",{className:"filter-controls",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx(Ms,{size:16}),e.jsxs("select",{value:y,onChange:r=>{O(r.target.value),T(1)},children:[e.jsxs("option",{value:"all",children:["Todas las filas (",i.processedData.length,")"]}),e.jsxs("option",{value:"valid",children:["Solo válidas (",p.validRows,")"]}),e.jsxs("option",{value:"invalid",children:["Con errores (",p.invalidRows,")"]}),e.jsxs("option",{value:"warnings",children:["Con advertencias (",i.warnings.length,")"]})]})]}),e.jsxs("div",{className:"search-group",children:[e.jsx(De,{size:16}),e.jsx("input",{type:"text",placeholder:"Buscar en datos...",value:j,onChange:r=>{E(r.target.value),T(1)}})]}),e.jsxs("button",{className:"btn-secondary",onClick:()=>k(!h),children:[h?e.jsx(bs,{size:16}):e.jsx(Q,{size:16}),h?"Ocultar":"Mostrar"," preview"]})]}),e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"btn-icon",onClick:()=>T(Math.max(1,S-1)),disabled:S===1,children:e.jsx(hs,{size:16})}),e.jsxs("span",{className:"pagination-info",children:["Página ",S," de ",p.totalPages,"(",w.length," filas)"]}),e.jsx("button",{className:"btn-icon",onClick:()=>T(Math.min(p.totalPages,S+1)),disabled:S===p.totalPages,children:e.jsx(ms,{size:16})})]})]}),e.jsx("div",{className:"preview-table-container",children:e.jsxs("table",{className:"validation-preview-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"row-number",children:"#"}),e.jsx("th",{className:"status-column",children:"Estado"}),e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Vehículo"}),e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Horómetro"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:A.map(r=>e.jsxs(pe.Fragment,{children:[e.jsxs("tr",{className:`preview-row ${r.errors.length>0?"has-errors":r.warnings.length>0?"has-warnings":"valid"}`,children:[e.jsx("td",{className:"row-number",children:r.rowNumber}),e.jsx("td",{className:"status-column",children:r.errors.length>0?e.jsxs("span",{className:"status error",children:[e.jsx(B,{size:14})," Error"]}):r.warnings.length>0?e.jsxs("span",{className:"status warning",children:[e.jsx(J,{size:14})," Advertencia"]}):e.jsxs("span",{className:"status success",children:[e.jsx(G,{size:14})," Válido"]})}),e.jsx("td",{children:r.mapped.fecha?.toLocaleDateString("es-CO")||"—"}),e.jsx("td",{children:e.jsxs("div",{className:"vehicle-cell",children:[e.jsx("span",{className:"original",children:r.original[t.vehiculo]||"—"}),r.mapped.vehiculoId&&e.jsxs("span",{className:"mapped",children:["→ ",r.mapped.vehiculoId]})]})}),e.jsx("td",{children:e.jsxs("div",{className:"product-cell",children:[e.jsx("span",{className:"original",children:r.original[t.producto]||"—"}),r.mapped.productoId&&e.jsxs("span",{className:"mapped",children:["→ ",r.mapped.productoId]})]})}),e.jsx("td",{className:"quantity-cell",children:r.mapped.cantidad||"—"}),e.jsx("td",{className:"hours-cell",children:r.mapped.horometro||"—"}),e.jsx("td",{className:"actions-cell",children:e.jsx("button",{className:"btn-icon",onClick:()=>L(r.rowNumber),title:"Ver detalles",children:e.jsx(Q,{size:14})})})]}),H.has(r.rowNumber)&&e.jsx("tr",{className:"expanded-row",children:e.jsx("td",{colSpan:"8",children:e.jsxs("div",{className:"row-details",children:[r.errors.length>0&&e.jsxs("div",{className:"row-issues errors",children:[e.jsxs("h5",{children:[e.jsx(B,{size:14})," Errores"]}),e.jsx("ul",{children:r.errors.map((u,v)=>e.jsx("li",{children:u},v))})]}),r.warnings.length>0&&e.jsxs("div",{className:"row-issues warnings",children:[e.jsxs("h5",{children:[e.jsx(J,{size:14})," Advertencias"]}),e.jsx("ul",{children:r.warnings.map((u,v)=>e.jsx("li",{children:u},v))})]}),e.jsxs("div",{className:"mapped-data",children:[e.jsxs("h5",{children:[e.jsx(ce,{size:14})," Datos mapeados"]}),e.jsx("div",{className:"mapped-fields",children:Object.entries(r.mapped).map(([u,v])=>e.jsxs("div",{className:"mapped-field",children:[e.jsxs("span",{className:"field-name",children:[u,":"]}),e.jsx("span",{className:"field-value",children:v instanceof Date?v.toLocaleDateString("es-CO"):v?.toString()||"N/A"})]},u))})]})]})})})]},r.rowNumber))})]})})]});return!i&&!d?e.jsxs("div",{className:"validation-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(se,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Validación de datos"}),e.jsx("p",{children:"Ejecuta la validación para verificar que los datos están listos para migrar."})]})]}),e.jsx("div",{className:"validation-prompt",children:e.jsxs("div",{className:"prompt-content",children:[e.jsx(fe,{size:48}),e.jsx("h3",{children:"¿Listo para validar?"}),e.jsx("p",{children:"Los datos se verificarán antes de la migración final. Esto incluye:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Validación de campos obligatorios"}),e.jsx("li",{children:"Verificación de formatos de fecha y números"}),e.jsx("li",{children:"Resolución de alias de vehículos y productos"}),e.jsx("li",{children:"Detección de datos que requieren creación automática"})]}),e.jsxs("button",{className:"btn-primary",onClick:g,disabled:d,children:[e.jsx(xe,{size:16}),d?"Validando...":"Ejecutar validación"]})]})})]}):d?e.jsx("div",{className:"validation-step",children:e.jsxs("div",{className:"validation-loading",children:[e.jsx("div",{className:"loading-spinner",children:e.jsx("div",{className:"spinner"})}),e.jsx("h3",{children:"Validando datos..."}),e.jsxs("p",{children:["Verificando ",a.length," filas de datos"]})]})}):e.jsxs("div",{className:"validation-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(se,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Validación completada"}),e.jsx("p",{children:"Revisa los resultados de la validación antes de proceder con la migración final."})]})]}),e.jsxs("div",{className:"validation-status",children:[e.jsxs("div",{className:"status-header",children:[e.jsx("div",{className:"status-icon",children:i.isValid?e.jsx(G,{size:24,className:"success"}):e.jsx(B,{size:24,className:"error"})}),e.jsxs("div",{className:"status-content",children:[e.jsx("h3",{children:i.isValid?"✅ Datos listos para migrar":"❌ Se encontraron errores que deben corregirse"}),e.jsxs("p",{children:[p.validRows," de ",p.totalRows," filas son válidas (",Math.round(p.successRate),"% de éxito)"]})]})]}),e.jsxs("div",{className:"validation-actions",children:[e.jsxs("button",{className:"btn-secondary",onClick:g,disabled:d,children:[e.jsx(de,{size:16}),"Re-validar"]}),e.jsxs("button",{className:"btn-secondary",onClick:b,children:[e.jsx(Le,{size:16}),"Exportar reporte"]})]})]}),e.jsxs("div",{className:"validation-tabs",children:[e.jsxs("div",{className:"tab-buttons",children:[e.jsxs("button",{className:`tab-button ${N==="overview"?"active":""}`,onClick:()=>D("overview"),children:[e.jsx(ge,{size:16}),"Resumen"]}),e.jsxs("button",{className:`tab-button ${N==="issues"?"active":""}`,onClick:()=>D("issues"),children:[e.jsx(J,{size:16}),"Errores y Advertencias",i.errors.length+i.warnings.length>0&&e.jsx("span",{className:"tab-badge",children:i.errors.length+i.warnings.length})]}),e.jsxs("button",{className:`tab-button ${N==="preview"?"active":""}`,onClick:()=>D("preview"),children:[e.jsx(Q,{size:16}),"Preview de Datos"]})]}),e.jsxs("div",{className:"tab-content",children:[N==="overview"&&q(),N==="issues"&&F(),N==="preview"&&K()]})]}),c&&e.jsxs("div",{className:"error-message",children:[e.jsx(B,{size:20}),e.jsx("span",{children:c})]})]})},P={READY:"ready",RUNNING:"running",PAUSED:"paused",COMPLETED:"completed",FAILED:"failed",CANCELLED:"cancelled"},Aa=({validationResult:a,valueMapping:t={},onExecutionComplete:n,onNavigateToStep:s,currentExecution:l=null,canExecute:d=!0,error:c=null})=>{const[i,o]=x.useState(P.READY),[h,k]=x.useState(l),[N,D]=x.useState({progress:0,processedRows:0,totalRows:0,currentStep:""}),[y,O]=x.useState(null),[j,E]=x.useState(0),[S,T]=x.useState([]),[M,H]=x.useState(!1),[m,g]=x.useState(null);x.useRef(null);const w=x.useRef(null);x.useEffect(()=>{if(i===P.RUNNING&&y)return w.current=setInterval(()=>{const C=Date.now()-y;if(E(C),N.progress>0){const I=C/N.progress*100-C;g(I>0?I:0)}},1e3),()=>{w.current&&clearInterval(w.current)}},[i,y,N.progress]),x.useEffect(()=>()=>{w.current&&clearInterval(w.current)},[]);const A=x.useCallback((C,z="info")=>{const I={id:Date.now(),timestamp:new Date,message:C,type:z};T(X=>[...X,I])},[]),p=x.useCallback(C=>{D(C),A(`${C.currentStep} - ${C.processedRows}/${C.totalRows} filas`,"progress")},[A]),L=async()=>{if(!(!a||!d))try{o(P.RUNNING),O(Date.now()),D({progress:0,processedRows:0,totalRows:a.statistics.validRows,currentStep:"Iniciando..."}),T([]),E(0),g(null),A("🚀 Iniciando migración de datos...","info"),A(`📊 Total de filas válidas a procesar: ${a.statistics.validRows}`,"info"),a.statistics.newVehicles.length>0&&A(`🚛 Se crearán ${a.statistics.newVehicles.length} vehículos nuevos`,"info"),a.statistics.newProducts.length>0&&A(`⛽ Se crearán ${a.statistics.newProducts.length} productos nuevos`,"info");const C=await ee.executeMigration(a,t,p);C.success?(o(P.COMPLETED),k(C.executionResult),A("✅ Migración completada exitosamente","success"),A(`📈 Estadísticas finales: ${C.executionResult.statistics.successfulRows} movimientos creados`,"success"),n(C.executionResult)):(o(P.FAILED),A(`❌ Error en migración: ${C.error}`,"error"))}catch(C){console.error("Error ejecutando migración:",C),o(P.FAILED),A(`❌ Error inesperado: ${C.message}`,"error")}},b=()=>{o(P.PAUSED),A("⏸️ Ejecución pausada por el usuario","warning")},q=()=>{o(P.RUNNING),A("▶️ Reanudando ejecución...","info")},F=()=>{o(P.CANCELLED),A("🛑 Ejecución cancelada por el usuario","warning"),w.current&&clearInterval(w.current)},K=()=>{o(P.READY),k(null),D({progress:0,processedRows:0,totalRows:0,currentStep:""}),O(null),E(0),g(null),T([])},r=()=>{const C={executionResult:h,logs:S,progress:N,elapsedTime:j,exportedAt:new Date().toISOString()},z=new Blob([JSON.stringify(C,null,2)],{type:"application/json"}),I=URL.createObjectURL(z),X=document.createElement("a");X.href=I,X.download=`migracion_logs_${Date.now()}.json`,X.click(),URL.revokeObjectURL(I)},u=C=>{const z=Math.floor(C/1e3),I=Math.floor(z/60),X=Math.floor(I/60);return X>0?`${X}h ${I%60}m ${z%60}s`:I>0?`${I}m ${z%60}s`:`${z}s`},v=x.useMemo(()=>{if(!h||!j)return null;const C=h.statistics.processedRows/(j/1e3),z=h.statistics.totalRows>0?h.statistics.successfulRows/h.statistics.totalRows*100:0;return{rowsPerSecond:Math.round(C*100)/100,successRate:Math.round(z*100)/100,totalTime:u(j),averageTimePerRow:Math.round(j/h.statistics.processedRows*100)/100}},[h,j]),f=()=>e.jsx("div",{className:"pre-execution",children:e.jsxs("div",{className:"execution-summary",children:[e.jsx("h3",{children:"🚀 ¿Listo para ejecutar la migración?"}),e.jsxs("p",{children:["Se procesarán ",e.jsxs("strong",{children:[a.statistics.validRows," filas válidas"]})," y se crearán los siguientes elementos:"]}),e.jsxs("div",{className:"summary-grid",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx(ce,{size:24}),e.jsxs("div",{children:[e.jsx("h4",{children:a.statistics.validRows}),e.jsx("p",{children:"Movimientos de combustible"})]})]}),a.statistics.newVehicles.length>0&&e.jsxs("div",{className:"summary-item",children:[e.jsx(ve,{size:24}),e.jsxs("div",{children:[e.jsx("h4",{children:a.statistics.newVehicles.length}),e.jsx("p",{children:"Vehículos nuevos"})]})]}),a.statistics.newProducts.length>0&&e.jsxs("div",{className:"summary-item",children:[e.jsx(me,{size:24}),e.jsxs("div",{children:[e.jsx("h4",{children:a.statistics.newProducts.length}),e.jsx("p",{children:"Productos nuevos"})]})]})]}),e.jsxs("div",{className:"execution-warning",children:[e.jsx(J,{size:20}),e.jsxs("div",{children:[e.jsx("h4",{children:"⚠️ Importante"}),e.jsxs("p",{children:["Esta acción ",e.jsx("strong",{children:"modificará permanentemente"})," la base de datos. Asegúrate de que la validación sea correcta."]})]})]}),e.jsxs("div",{className:"execution-actions",children:[e.jsxs("button",{className:"btn-secondary",onClick:()=>s(4),children:[e.jsx(de,{size:16}),"Volver a validación"]}),e.jsxs("button",{className:"btn-primary",onClick:L,disabled:!d,children:[e.jsx(xe,{size:16}),"Ejecutar migración"]})]})]})}),_=()=>e.jsxs("div",{className:"execution-progress",children:[e.jsxs("div",{className:"progress-header",children:[e.jsxs("div",{className:"progress-status",children:[e.jsx(is,{size:24,className:"status-icon running"}),e.jsxs("div",{className:"status-content",children:[e.jsx("h3",{children:"Migración en progreso..."}),e.jsx("p",{children:N.currentStep})]})]}),e.jsxs("div",{className:"progress-controls",children:[i===P.RUNNING&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-icon",onClick:b,children:e.jsx(Ts,{size:16})}),e.jsx("button",{className:"btn-icon danger",onClick:F,children:e.jsx(Xs,{size:16})})]}),i===P.PAUSED&&e.jsxs("button",{className:"btn-primary",onClick:q,children:[e.jsx(xe,{size:16}),"Reanudar"]})]})]}),e.jsxs("div",{className:"main-progress",children:[e.jsxs("div",{className:"progress-info",children:[e.jsxs("span",{children:[N.processedRows," / ",N.totalRows," filas procesadas"]}),e.jsxs("span",{children:[Math.round(N.progress),"%"]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${N.progress}%`}})})]}),e.jsxs("div",{className:"real-time-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx(js,{size:16}),e.jsxs("span",{children:["Tiempo transcurrido: ",u(j)]})]}),m!==null&&e.jsxs("div",{className:"stat-item",children:[e.jsx(Oe,{size:16}),e.jsxs("span",{children:["Tiempo estimado restante: ",u(m)]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx(ge,{size:16}),e.jsxs("span",{children:["Velocidad: ",Math.round(N.processedRows/(j/1e3)*10)/10," filas/seg"]})]})]}),e.jsxs("div",{className:"execution-logs",children:[e.jsxs("div",{className:"logs-header",children:[e.jsxs("h4",{children:[e.jsx(fe,{size:16}),"Registro de ejecución"]}),e.jsxs("button",{className:"btn-secondary",onClick:()=>H(!M),children:[M?"Ocultar":"Mostrar"," detalles"]})]}),e.jsx("div",{className:`logs-container ${M?"detailed":"compact"}`,children:S.slice(-10).map(C=>e.jsxs("div",{className:`log-entry ${C.type}`,children:[e.jsx("span",{className:"log-time",children:C.timestamp.toLocaleTimeString("es-CO")}),e.jsx("span",{className:"log-message",children:C.message})]},C.id))})]})]}),$=()=>{const C=i===P.COMPLETED,z=h?.statistics;return e.jsxs("div",{className:"execution-results",children:[e.jsxs("div",{className:"results-header",children:[e.jsxs("div",{className:"results-status",children:[C?e.jsx(G,{size:48,className:"success"}):e.jsx(B,{size:48,className:"error"}),e.jsxs("div",{className:"status-content",children:[e.jsx("h3",{children:C?"🎉 ¡Migración completada exitosamente!":"❌ Migración falló"}),e.jsx("p",{children:C?`Se procesaron ${z?.processedRows||0} filas con ${z?.successfulRows||0} movimientos creados`:"La migración no pudo completarse. Revisa los errores para más información."})]})]}),e.jsxs("div",{className:"results-actions",children:[e.jsxs("button",{className:"btn-secondary",onClick:r,children:[e.jsx(Le,{size:16}),"Exportar logs"]}),e.jsxs("button",{className:"btn-secondary",onClick:K,children:[e.jsx(Vs,{size:16}),"Nueva migración"]}),e.jsxs("button",{className:"btn-primary",onClick:()=>window.location.href="/combustibles",children:[e.jsx(As,{size:16}),"Ir al sistema"]})]})]}),C&&z&&e.jsxs("div",{className:"results-stats",children:[e.jsx("h4",{children:"📊 Estadísticas finales"}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(G,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:z.successfulRows}),e.jsx("p",{children:"Movimientos creados"})]})]}),e.jsxs("div",{className:"stat-card info",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(ve,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:z.newVehiclesCreated}),e.jsx("p",{children:"Vehículos creados"})]})]}),e.jsxs("div",{className:"stat-card info",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(me,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:z.newProductsCreated}),e.jsx("p",{children:"Productos creados"})]})]}),z.failedRows>0&&e.jsxs("div",{className:"stat-card warning",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(J,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:z.failedRows}),e.jsx("p",{children:"Filas fallidas"})]})]})]}),v&&e.jsxs("div",{className:"performance-stats",children:[e.jsx("h5",{children:"⚡ Rendimiento"}),e.jsxs("div",{className:"performance-grid",children:[e.jsxs("div",{className:"perf-item",children:[e.jsx("span",{className:"perf-label",children:"Tiempo total:"}),e.jsx("span",{className:"perf-value",children:v.totalTime})]}),e.jsxs("div",{className:"perf-item",children:[e.jsx("span",{className:"perf-label",children:"Velocidad promedio:"}),e.jsxs("span",{className:"perf-value",children:[v.rowsPerSecond," filas/seg"]})]}),e.jsxs("div",{className:"perf-item",children:[e.jsx("span",{className:"perf-label",children:"Tasa de éxito:"}),e.jsxs("span",{className:"perf-value",children:[v.successRate,"%"]})]}),e.jsxs("div",{className:"perf-item",children:[e.jsx("span",{className:"perf-label",children:"Tiempo por fila:"}),e.jsxs("span",{className:"perf-value",children:[v.averageTimePerRow,"ms"]})]})]})]})]}),h?.errors&&h.errors.length>0&&e.jsxs("div",{className:"results-issues",children:[e.jsx("h4",{children:"❌ Errores encontrados"}),e.jsxs("div",{className:"issues-list",children:[h.errors.slice(0,10).map((I,X)=>e.jsx("div",{className:"issue-item error",children:I},X)),h.errors.length>10&&e.jsxs("div",{className:"issue-item info",children:["... y ",h.errors.length-10," errores más"]})]})]}),e.jsxs("div",{className:"complete-logs",children:[e.jsx("h4",{children:"📋 Registro completo"}),e.jsx("div",{className:"logs-container",children:S.map(I=>e.jsxs("div",{className:`log-entry ${I.type}`,children:[e.jsx("span",{className:"log-time",children:I.timestamp.toLocaleTimeString("es-CO")}),e.jsx("span",{className:"log-message",children:I.message})]},I.id))})]})]})};return e.jsxs("div",{className:"execution-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(se,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Ejecución de migración"}),e.jsxs("p",{children:[i===P.READY&&"Confirma la ejecución para procesar los datos validados.",i===P.RUNNING&&"La migración está en progreso. No cierres esta ventana.",i===P.COMPLETED&&"Migración completada. Revisa los resultados.",i===P.FAILED&&"La migración falló. Revisa los errores reportados.",i===P.CANCELLED&&"Migración cancelada por el usuario."]})]})]}),i===P.READY&&f(),(i===P.RUNNING||i===P.PAUSED)&&_(),(i===P.COMPLETED||i===P.FAILED||i===P.CANCELLED)&&$(),c&&e.jsxs("div",{className:"error-message",children:[e.jsx(B,{size:20}),e.jsx("span",{children:c})]})]})},ae=[{id:U.FILE_UPLOAD,title:"Cargar Archivo",description:"Selecciona y carga tu archivo Excel o CSV",icon:Te,component:"Step1_FileUpload"},{id:U.COLUMN_MAPPING,title:"Mapear Columnas",description:"Relaciona las columnas del archivo con los campos del sistema",icon:re,component:"Step2_ColumnMapping"},{id:U.VALUE_MAPPING,title:"Mapear Valores",description:"Define alias para vehículos, productos y ubicaciones",icon:re,component:"Step3_ValueMapping"},{id:U.VALIDATION,title:"Validar Datos",description:"Verifica que todos los datos sean correctos antes de migrar",icon:G,component:"Step4_Validation"},{id:U.EXECUTION,title:"Ejecutar Migración",description:"Procesa y carga los datos en el sistema",icon:ze,component:"Step5_Execution"}],La=({isOpen:a,onClose:t,onComplete:n})=>{const[s,l]=x.useState(ee.createMigrationContext()),[d,c]=x.useState(!1),[i,o]=x.useState(null),h=x.useMemo(()=>ae.find(m=>m.id===s.step)||ae[0],[s.step]),k=x.useMemo(()=>(s.step-1)/(ae.length-1)*100,[s.step]),N=x.useMemo(()=>{switch(s.step){case U.FILE_UPLOAD:return s.fileData&&s.fileData.success;case U.COLUMN_MAPPING:{const m=["fecha","cantidad","vehiculo","producto"],g=Object.keys(s.columnMapping||{});return m.every(w=>g.includes(w))}case U.VALUE_MAPPING:return!0;case U.VALIDATION:return s.validationResult&&s.validationResult.isValid;case U.EXECUTION:return!1;default:return!1}},[s]),D=x.useMemo(()=>s.step>U.FILE_UPLOAD&&s.step!==U.EXECUTION,[s.step]),y=x.useCallback(m=>{l(g=>({...g,...m,metadata:{...g.metadata,...m.metadata}}))},[]),O=async(m,g={})=>{c(!0),o(null);try{const w=await ee.processFile(m,g);w.success?y({fileData:w,metadata:{fileName:m.name,totalRows:w.metadata.rowCount}}):o(w.error)}catch(w){console.error("Error procesando archivo:",w),o(`Error procesando archivo: ${w.message}`)}finally{c(!1)}},j=m=>{c(!0),o(null);try{const g=s.fileData?.preview?.headers||[],w=ee.configureColumnMapping(g,m);w.success?y({columnMapping:w.mapping}):o(w.error)}catch(g){console.error("Error configurando mapeo de columnas:",g),o(`Error en mapeo de columnas: ${g.message}`)}finally{c(!1)}},E=m=>{y({valueMapping:m})},S=()=>{N&&s.step<ae.length&&(y({step:s.step+1}),o(null))},T=()=>{D&&(y({step:s.step-1}),o(null))},M=()=>{s.step>U.FILE_UPLOAD?confirm("¿Estás seguro de que quieres cerrar el wizard? Se perderá el progreso actual.")&&t():t()},H=()=>{confirm("¿Estás seguro de que quieres reiniciar el wizard?")&&(l(ee.createMigrationContext()),o(null))};return a?e.jsx("div",{className:"migration-wizard-overlay",children:e.jsxs("div",{className:"migration-wizard",children:[e.jsxs("div",{className:"wizard-header",children:[e.jsxs("div",{className:"wizard-title",children:[e.jsx("h2",{children:"Asistente de Migración de Datos"}),e.jsx("p",{children:"Importa datos históricos de forma segura y validada"})]}),e.jsx("button",{className:"wizard-close",onClick:M,"aria-label":"Cerrar",children:e.jsx(le,{size:24})})]}),e.jsxs("div",{className:"wizard-progress",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${k}%`}})}),e.jsx("div",{className:"progress-steps",children:ae.map(m=>e.jsxs("div",{className:`progress-step ${s.step>m.id?"completed":s.step===m.id?"active":"pending"}`,children:[e.jsx("div",{className:"step-circle",children:s.step>m.id?e.jsx(G,{size:16}):e.jsx("span",{children:m.id})}),e.jsx("span",{className:"step-title",children:m.title})]},m.id))})]}),e.jsxs("div",{className:"wizard-content",children:[e.jsxs("div",{className:"step-header",children:[e.jsx("div",{className:"step-icon",children:e.jsx(h.icon,{size:32})}),e.jsxs("div",{className:"step-info",children:[e.jsx("h3",{children:h.title}),e.jsx("p",{children:h.description})]})]}),i&&e.jsxs("div",{className:"wizard-error",children:[e.jsx(B,{size:20}),e.jsx("span",{children:i}),e.jsx("button",{onClick:()=>o(null),children:"×"})]}),e.jsxs("div",{className:"step-content",children:[s.step===U.FILE_UPLOAD&&e.jsx(ka,{onFileProcessed:O,currentFile:s.fileData,isLoading:d,error:i}),s.step===U.COLUMN_MAPPING&&e.jsx(Sa,{fileHeaders:s.fileData?.preview?.headers||[],currentMapping:s.columnMapping,columnSuggestions:s.fileData?.columnSuggestions||{},onMappingChange:j,previewData:s.fileData?.preview?.preview||[],isLoading:d,error:i}),s.step===U.VALUE_MAPPING&&e.jsx(Ma,{mappedData:s.fileData?.data||[],columnMapping:s.columnMapping,currentValueMapping:s.valueMapping,onValueMappingChange:E,isLoading:d,error:i}),s.step===U.VALIDATION&&e.jsx(Ra,{fileData:s.fileData?.data||[],columnMapping:s.columnMapping,valueMapping:s.valueMapping,currentValidation:s.validationResult,isValidating:d,onValidationComplete:m=>y({validationResult:m}),error:i}),s.step===U.EXECUTION&&e.jsx(Aa,{validationResult:s.validationResult,valueMapping:s.valueMapping,currentExecution:s.executionResult,canExecute:s.validationResult?.isValid||!1,onExecutionComplete:m=>{y({executionResult:m}),n&&n(m)},onNavigateToStep:m=>y({step:m}),error:i})]})]}),e.jsxs("div",{className:"wizard-footer",children:[e.jsx("div",{className:"footer-left",children:e.jsx("button",{className:"btn-secondary",onClick:H,disabled:d,children:"Reiniciar"})}),e.jsxs("div",{className:"footer-right",children:[e.jsxs("button",{className:"btn-secondary",onClick:T,disabled:!D||d,children:[e.jsx(cs,{size:16}),"Anterior"]}),s.step<ae.length?e.jsxs("button",{className:"btn-primary",onClick:S,disabled:!N||d,children:["Siguiente",e.jsx(re,{size:16})]}):e.jsxs("button",{className:"btn-success",onClick:M,disabled:d,children:["Finalizar",e.jsx(G,{size:16})]})]})]}),d&&e.jsxs("div",{className:"wizard-loading",children:[e.jsx(ze,{className:"spinner",size:32}),e.jsx("p",{children:"Procesando..."})]})]})}):null};function Oa(){return e.jsx("div",{children:e.jsx(La,{})})}export{Oa as default};
