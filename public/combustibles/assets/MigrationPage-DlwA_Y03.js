import{r as x,_ as Be,d as je,b as oe,s as ie,c as be,e as He,g as Re,h as Ge,i as Ye,v as Xe,m as We,M as Qe,k as Ze,j as e,R as pe}from"./index-DNdTQFCt.js";import{P as te,c as Ke}from"./productsService-BoGucGnM.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),es=a=>a.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,s)=>s?s.toUpperCase():n.toLowerCase()),Ce=a=>{const t=es(a);return t.charAt(0).toUpperCase()+t.slice(1)},Ae=(...a)=>a.filter((t,n,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===n).join(" ").trim(),ss=a=>{for(const t in a)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var as={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=x.forwardRef(({color:a="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:s,className:c="",children:o,iconNode:i,...r},d)=>x.createElement("svg",{ref:d,...as,width:t,height:t,stroke:a,strokeWidth:s?Number(n)*24/Number(t):n,className:Ae("lucide",c),...!o&&!ss(r)&&{"aria-hidden":"true"},...r},[...i.map(([u,k])=>x.createElement(u,k)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=(a,t)=>{const n=x.forwardRef(({className:s,...c},o)=>x.createElement(ts,{ref:o,iconNode:t,className:Ae(`lucide-${Je(Ce(a))}`,`lucide-${a}`,s),...c}));return n.displayName=Ce(a),n};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],is=R("activity",ns);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],cs=R("arrow-left",rs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],re=R("arrow-right",ls);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ds=R("calendar",os);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],hs=R("chevron-left",us);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],ms=R("chevron-right",ps);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],F=R("circle-alert",xs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],H=R("circle-check-big",gs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],js=R("clock",vs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],Ee=R("columns-2",fs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],ce=R("database",Ns);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Le=R("download",ys);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],bs=R("eye-off",ws);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Q=R("eye",Cs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],fe=R("file-text",Es);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],ke=R("file",ks);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Ms=R("funnel",Ss);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],As=R("house",Rs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],se=R("info",Ls);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],ze=R("loader",zs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],me=R("package",Ds);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],Ts=R("pause",Os);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]],_s=R("pen-line",$s);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],xe=R("play",Is);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Vs=R("refresh-cw",Ps);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],de=R("rotate-ccw",Us);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Fs=R("save",qs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],De=R("search",Bs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Gs=R("settings",Hs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Xs=R("square",Ys);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Oe=R("target",Ws);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],ge=R("trending-up",Qs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],J=R("triangle-alert",Zs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Te=R("upload",Ks);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ve=R("users",Js);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],le=R("x",ea);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],$e=R("zap",sa),_e={EXCEL:["xlsx","xls"],CSV:["csv"],TEXT:["txt","tsv"]},Z=(a,t=null,n=null,s={})=>({success:a,data:t,error:n,metadata:{fileName:"",fileSize:0,fileType:"",rowCount:0,columnCount:0,sheets:[],encoding:"UTF-8",...s}}),Ie=a=>{const t=a.name.split(".").pop().toLowerCase();for(const[n,s]of Object.entries(_e))if(s.includes(t))return n;return a.type.includes("spreadsheet")||a.type.includes("excel")?"EXCEL":a.type.includes("csv")||a.type.includes("text")?"CSV":"UNKNOWN"},Pe=a=>{if(!a)return{valid:!1,error:"No se proporcionó ningún archivo"};if(a.size>52428800)return{valid:!1,error:"El archivo es demasiado grande (máximo 50MB)"};if(a.size<10)return{valid:!1,error:"El archivo está vacío o es demasiado pequeño"};const s=Ie(a);return s==="UNKNOWN"?{valid:!1,error:"Tipo de archivo no soportado. Use Excel (.xlsx, .xls) o CSV (.csv)"}:{valid:!0,fileType:s}},aa=async(a,t={})=>{try{const n=await Be(()=>import("./xlsx-DLvP5s0v.js"),[]),s=n.read(a,{type:"buffer",cellText:!1,cellDates:!0,...t}),c={sheets:[],data:null,metadata:{sheetNames:s.SheetNames,sheets:s.SheetNames.length}};s.SheetNames.forEach((i,r)=>{const d=s.Sheets[i],u=n.utils.sheet_to_json(d,{header:1,defval:"",blankrows:!1});if(u.length===0)return;const k=u[0]||[],b=u.slice(1),S=k.map((C,M)=>!C||C.toString().trim()===""?`Columna_${M+1}`:C.toString().trim()),N=b.filter(C=>C.some(M=>M!=null&&M!=="")).map(C=>{const M={};return S.forEach((z,D)=>{const T=C[D];T instanceof Date||typeof T=="number"?M[z]=T:typeof T=="string"?M[z]=T.trim():M[z]=T||""}),M}),A={name:i,index:r,headers:S,rowCount:N.length,columnCount:S.length,data:N,range:d["!ref"]||"A1",isEmpty:N.length===0};c.sheets.push(A)});const o=c.sheets.find(i=>!i.isEmpty)||c.sheets[0];return o&&(c.data=o.data,c.metadata.primarySheet=o.name,c.metadata.headers=o.headers,c.metadata.rowCount=o.rowCount,c.metadata.columnCount=o.columnCount),Z(!0,c.data,null,c.metadata)}catch(n){return console.error("❌ Error parsing Excel file:",n),Z(!1,null,`Error procesando archivo Excel: ${n.message}`)}},ta=(a,t={})=>{try{const{delimiter:n=",",quote:s='"',skipEmptyLines:c=!0,trimValues:o=!0}=t,i=a.split(/\r?\n/);if(i.length===0)return Z(!1,null,"El archivo CSV está vacío");const r=S=>{const N=[];let A="",C=!1,M=0;for(;M<S.length;){const z=S[M],D=S[M+1];z===s&&!C?C=!0:z===s&&C?D===s?(A+=s,M++):C=!1:z===n&&!C?(N.push(o?A.trim():A),A=""):A+=z,M++}return N.push(o?A.trim():A),N},d=i[0],u=r(d).map((S,N)=>!S||S.trim()===""?`Columna_${N+1}`:S.trim()),k=[];for(let S=1;S<i.length;S++){const N=i[S].trim();if(c&&N==="")continue;const A=r(N);if(A.every(M=>M===""))continue;const C={};u.forEach((M,z)=>{const D=A[z]||"";D!==""&&!isNaN(D)&&!isNaN(parseFloat(D))?C[M]=parseFloat(D):C[M]=D}),k.push(C)}const b={headers:u,rowCount:k.length,columnCount:u.length,delimiter:n,encoding:"UTF-8"};return Z(!0,k,null,b)}catch(n){return console.error("❌ Error parsing CSV file:",n),Z(!1,null,`Error procesando archivo CSV: ${n.message}`)}},na=async(a,t={})=>{try{const n=Pe(a);if(!n.valid)return Z(!1,null,n.error);const s=n.fileType,c=await a.arrayBuffer(),o={fileName:a.name,fileSize:a.size,fileType:s,lastModified:new Date(a.lastModified)};let i;switch(s){case"EXCEL":i=await aa(c,t.excel);break;case"CSV":{const r=new TextDecoder("utf-8").decode(c);i=ta(r,t.csv);break}default:return Z(!1,null,`Tipo de archivo no soportado: ${s}`)}return i.success&&(i.metadata={...o,...i.metadata}),i}catch(n){return console.error("❌ Error general parsing file:",n),Z(!1,null,`Error inesperado procesando archivo: ${n.message}`)}},ia=(a,t=10)=>{if(!Array.isArray(a)||a.length===0)return{preview:[],total:0,headers:[],statistics:{}};const n=Object.keys(a[0]),s=a.slice(0,t),c={totalRows:a.length,totalColumns:n.length,emptyFields:0,dataTypes:{}};return n.forEach(o=>{const i=a.map(d=>d[o]).filter(d=>d!==""&&d!==null&&d!==void 0);if(i.length===0){c.dataTypes[o]="empty";return}const r=i[0];r instanceof Date?c.dataTypes[o]="date":typeof r=="number"?c.dataTypes[o]="number":typeof r=="boolean"?c.dataTypes[o]="boolean":c.dataTypes[o]="text"}),{preview:s,total:a.length,headers:n,statistics:c}},ra=a=>{const t={fecha:["fecha","date","dia","day","timestamp","created","creado"],cantidad:["cantidad","qty","quantity","galones","litros","amount","volume"],vehiculo:["vehiculo","vehicle","maquina","machine","equipo","equipment","codigo","code","id"],producto:["producto","product","combustible","fuel","articulo","item","tipo"],precio:["precio","price","cost","costo","valor","value"],horometro:["horometro","horas","hours","hour_meter","lectura"],ubicacion:["ubicacion","location","lugar","place","destino","destination","origen","source"],descripcion:["descripcion","description","notes","notas","observaciones","comments"]},n={},s=a.map(c=>({original:c,normalized:c.toLowerCase().trim().replace(/[^a-z0-9]/g,"_")}));return Object.entries(t).forEach(([c,o])=>{let i=null,r=0;s.forEach(({original:d,normalized:u})=>{o.forEach(k=>{const b=ca(u,k);b>r&&b>.6&&(r=b,i=d)})}),i&&(n[c]=i)}),n},ca=(a,t)=>{if(a===t)return 1;if(a.includes(t)||t.includes(a))return .8;const n=a.length>t.length?a:t,s=a.length>t.length?t:a;if(n.length===0)return 1;const c=la(n,s);return(n.length-c)/n.length},la=(a,t)=>{const n=[];for(let s=0;s<=t.length;s++)n[s]=[s];for(let s=0;s<=a.length;s++)n[0][s]=s;for(let s=1;s<=t.length;s++)for(let c=1;c<=a.length;c++)t.charAt(s-1)===a.charAt(c-1)?n[s][c]=n[s-1][c-1]:n[s][c]=Math.min(n[s-1][c-1]+1,n[s][c-1]+1,n[s-1][c]+1);return n[t.length][a.length]},ue={parseFile:na,getDataPreview:ia,suggestColumnMapping:ra,validateFile:Pe,detectFileType:Ie,SUPPORTED_FILE_TYPES:_e},Ne="combustibles_migration_aliases",I={VEHICLE:"vehicle",PRODUCT:"product",LOCATION:"location",SUPPLIER:"supplier"},Se=(a,t={},n={})=>({type:a,mappings:t,metadata:{totalMappings:Object.keys(t).length,lastUsed:null,usageCount:0,...n},createdAt:ie(),updatedAt:ie()}),ne=async a=>{try{if(!Object.values(I).includes(a))throw new Error(`Tipo de alias inválido: ${a}`);const t=`${a}_aliases`,n=je(oe,Ne,t),s=await Re(n);return s.exists()?{id:s.id,...s.data(),createdAt:s.data().createdAt?.toDate?.()||s.data().createdAt,updatedAt:s.data().updatedAt?.toDate?.()||s.data().updatedAt,lastUsed:s.data().metadata?.lastUsed?.toDate?.()||s.data().metadata?.lastUsed}:null}catch(t){throw console.error("❌ Error obteniendo alias:",t),new Error(`Error al obtener alias: ${t.message}`)}},ye=async(a,t,n=!0)=>{try{if(!Object.values(I).includes(a))throw new Error(`Tipo de alias inválido: ${a}`);if(!t||typeof t!="object")throw new Error("Los mapeos deben ser un objeto válido");const s=`${a}_aliases`,c=je(oe,Ne,s);if(n){const o=await ne(a),i=o?{...o.mappings,...t}:t,r=Se(a,i,{totalMappings:Object.keys(i).length,lastUpdated:ie(),usageCount:(o?.metadata?.usageCount||0)+1});await be(c,r,{merge:!0})}else{const o=Se(a,t);await be(c,o)}console.log(`✅ Alias ${a} guardados exitosamente:`,Object.keys(t).length,"mapeos")}catch(s){throw console.error("❌ Error guardando alias:",s),new Error(`Error al guardar alias: ${s.message}`)}},Ve=async(a,t)=>{try{if(!t||typeof t!="string")return null;const n=await ne(a);if(!n||!n.mappings)return null;const s=n.mappings[t];if(s)return s;const c=t.toLowerCase().trim();for(const[o,i]of Object.entries(n.mappings))if(o.toLowerCase().trim()===c)return i;for(const[o,i]of Object.entries(n.mappings)){const r=o.toLowerCase().trim();if(r.includes(c)||c.includes(r))return i}return null}catch(n){return console.error("❌ Error resolviendo alias:",n),null}},oa=async(a,t)=>{try{const n={},s=await Ue(a),c=await ne(a);for(const o of t){const i=await Ve(a,o);if(i){n[o]={suggested:i,confidence:1,source:"alias",alternatives:[]};continue}const r=ma(o,s);if(r){n[o]={suggested:r.id,confidence:r.confidence,source:"direct",alternatives:[]};continue}const d=xa(o,s,3);if(d.length>0){n[o]={suggested:d[0].id,confidence:d[0].confidence,source:"fuzzy",alternatives:d.slice(1)};continue}n[o]={suggested:null,confidence:0,source:"none",alternatives:[],requiresManualMapping:!0}}return n}catch(n){throw console.error("❌ Error obteniendo sugerencias:",n),new Error(`Error al obtener sugerencias: ${n.message}`)}},da=async a=>{try{const t=`${a}_aliases`,n=je(oe,Ne,t);await He(n,{"metadata.lastUsed":ie(),"metadata.usageCount":(await Re(n)).data()?.metadata?.usageCount+1||1,updatedAt:ie()})}catch(t){console.error("❌ Error registrando uso de alias:",t)}},ua=async a=>{try{const t=await ne(a);if(!t||!t.mappings)return 0;const n=await Ue(a),s=new Set(n.map(i=>i.id));let c=0;const o={};for(const[i,r]of Object.entries(t.mappings))s.has(r)?o[i]=r:c++;return c>0&&(await ye(a,o,!1),console.log(`🧹 Limpieza completada: ${c} alias eliminados para ${a}`)),c}catch(t){return console.error("❌ Error en limpieza de alias:",t),0}},ha=async(a=null)=>{try{const t={exportedAt:new Date().toISOString(),version:"1.0",aliases:{}},n=a?[a]:Object.values(I);for(const s of n){const c=await ne(s);c&&(t.aliases[s]=c)}return t}catch(t){throw console.error("❌ Error exportando alias:",t),new Error(`Error al exportar alias: ${t.message}`)}},pa=async(a,t=!0)=>{try{if(!a||!a.aliases)throw new Error("Formato de backup inválido");let n=0;for(const[s,c]of Object.entries(a.aliases))Object.values(I).includes(s)&&c.mappings&&(await ye(s,c.mappings,t),n++);return console.log(`📥 Importación completada: ${n} tipos de alias importados`),n}catch(n){throw console.error("❌ Error importando alias:",n),new Error(`Error al importar alias: ${n.message}`)}},Ue=async a=>{try{let t,n=["id"];switch(a){case I.VEHICLE:t="combustibles_vehicles",n=["vehicleId","name"];break;case I.PRODUCT:t="combustibles_products",n=["name","displayName"];break;case I.LOCATION:return[{id:"principal",name:"Principal"},{id:"bodega_austria",name:"Bodega Austria"},{id:"bodega_ilusion",name:"Bodega Ilusión"},{id:"campo_operativo",name:"Campo Operativo"},{id:"estacion_movil",name:"Estación Móvil"}];case I.SUPPLIER:t="combustibles_suppliers",n=["name","displayName"];break;default:return[]}const s=await Ge(Ye(oe,t)),c=[];return s.forEach(o=>{const i=o.data(),r={id:o.id};n.forEach(d=>{i[d]&&(r[d]=i[d])}),a===I.VEHICLE&&i.vehicleId&&(r.id=i.vehicleId,r.displayName=`${i.vehicleId} - ${i.name||"Sin nombre"}`),c.push(r)}),c}catch(t){return console.error("❌ Error obteniendo datos existentes:",t),[]}},ma=(a,t)=>{const n=a.toLowerCase().trim();for(const s of t){if(s.id.toLowerCase()===n)return{id:s.id,confidence:1};if(s.name&&s.name.toLowerCase().trim()===n)return{id:s.id,confidence:.95};if(s.displayName&&s.displayName.toLowerCase().trim()===n)return{id:s.id,confidence:.95}}return null},xa=(a,t,n=5)=>{const s=[],c=a.toLowerCase().trim();for(const o of t){const i=[o.id,o.name,o.displayName].filter(Boolean);for(const r of i){const d=r.toLowerCase().trim();if(d.includes(c)||c.includes(d)){const u=Math.max(c.length/d.length,d.length/c.length)*.8;s.push({id:o.id,confidence:u,matchedField:r});break}}}return s.sort((o,i)=>i.confidence-o.confidence).slice(0,n)},G={getAliasesByType:ne,saveAliases:ye,resolveAlias:Ve,getSuggestedMappings:oa,recordAliasUsage:da,cleanupUnusedAliases:ua,exportAliases:ha,importAliases:pa,ALIAS_TYPES:I},P={FILE_UPLOAD:1,COLUMN_MAPPING:2,VALUE_MAPPING:3,VALIDATION:4,EXECUTION:5},W={fecha:{required:!0,type:"date",description:"Fecha del movimiento"},cantidad:{required:!0,type:"number",description:"Cantidad de combustible"},vehiculo:{required:!0,type:"string",description:"Vehículo o equipo"},producto:{required:!0,type:"string",description:"Tipo de combustible/producto"}},we={horometro:{required:!1,type:"number",description:"Lectura del horómetro"},precio:{required:!1,type:"number",description:"Precio unitario"},ubicacion:{required:!1,type:"string",description:"Ubicación origen"},destino:{required:!1,type:"string",description:"Ubicación destino"},descripcion:{required:!1,type:"string",description:"Notas adicionales"},proveedor:{required:!1,type:"string",description:"Proveedor (para entradas)"}},ga=()=>({step:P.FILE_UPLOAD,fileData:null,columnMapping:{},valueMapping:{},validationResult:null,executionResult:null,errors:[],warnings:[],metadata:{startedAt:new Date,fileName:"",totalRows:0,processedRows:0,successfulRows:0,failedRows:0}}),va=async(a,t={})=>{try{console.log("🔄 Iniciando procesamiento de archivo:",a.name);const n=await ue.parseFile(a,t);if(!n.success)return{success:!1,error:n.error,data:null};const s=ue.getDataPreview(n.data,20),c=ue.suggestColumnMapping(s.headers);return{success:!0,data:n.data,metadata:n.metadata,preview:s,columnSuggestions:c,error:null}}catch(n){return console.error("❌ Error procesando archivo:",n),{success:!1,error:n.message,data:null}}},ja=(a,t)=>{try{const n={},s=[],c=[];return Object.entries(t).forEach(([i,r])=>{a.includes(r)&&(n[i]=r)}),Object.keys(W).forEach(i=>{n[i]||c.push(i)}),a.forEach(i=>{Object.values(n).includes(i)||s.push(i)}),{success:c.length===0,mapping:n,unmappedColumns:s,missingRequiredFields:c,warnings:s.length>0?[`${s.length} columnas no fueron mapeadas`]:[]}}catch(n){return console.error("❌ Error configurando mapeo de columnas:",n),{success:!1,error:n.message,mapping:{}}}},fa=async(a,t)=>{try{console.log("🔄 Configurando mapeo de valores...");const n={},s={},c=t.vehiculo,o=t.producto;if(c){const r=[...new Set(a.map(u=>u[c]).filter(Boolean))],d=await G.getSuggestedMappings(I.VEHICLE,r);n.vehiculos={},s.vehiculos=d}if(o){const r=[...new Set(a.map(u=>u[o]).filter(Boolean))],d=await G.getSuggestedMappings(I.PRODUCT,r);n.productos={},s.productos=d}const i=t.ubicacion;if(i){const r=[...new Set(a.map(u=>u[i]).filter(Boolean))],d=await G.getSuggestedMappings(I.LOCATION,r);n.ubicaciones={},s.ubicaciones=d}return{success:!0,valueMapping:n,suggestions:s,error:null}}catch(n){return console.error("❌ Error configurando mapeo de valores:",n),{success:!1,error:n.message,valueMapping:{},suggestions:{}}}},Na=async(a,t,n)=>{try{console.log("🔄 Iniciando validación de datos (Dry Run)...");const s={isValid:!0,errors:[],warnings:[],statistics:{totalRows:a.length,validRows:0,invalidRows:0,newVehicles:new Set,newProducts:new Set,dateRange:{min:null,max:null}},preview:[]},c=[];for(let o=0;o<a.length;o++){const i=a[o],r=o+1,d={rowNumber:r,original:i,mapped:{},errors:[],warnings:[]};try{for(const[u,k]of Object.entries(W)){const b=t[u];if(!b){d.errors.push(`Campo requerido '${u}' no mapeado`);continue}const S=i[b],N=Me(S,k,u,r);N.error?d.errors.push(N.error):d.mapped[u]=N.value}for(const[u,k]of Object.entries(we)){const b=t[u];if(b&&i[b]!==void 0&&i[b]!==""){const S=i[b],N=Me(S,k,u,r);N.error?d.warnings.push(N.error):d.mapped[u]=N.value}}if(d.mapped.vehiculo){const u=d.mapped.vehiculo,k=n.vehiculos?.[u]||await G.resolveAlias(I.VEHICLE,u);k?d.mapped.vehiculoId=k:(s.statistics.newVehicles.add(u),d.warnings.push(`Vehículo '${u}' no existe, será creado`),d.mapped.vehiculoId=qe(u))}if(d.mapped.producto){const u=d.mapped.producto,k=n.productos?.[u]||await G.resolveAlias(I.PRODUCT,u);k?d.mapped.productoId=k:(s.statistics.newProducts.add(u),d.warnings.push(`Producto '${u}' no existe, será creado`),d.mapped.productoId=Fe(u))}if(d.mapped.fecha){const u=d.mapped.fecha;(!s.statistics.dateRange.min||u<s.statistics.dateRange.min)&&(s.statistics.dateRange.min=u),(!s.statistics.dateRange.max||u>s.statistics.dateRange.max)&&(s.statistics.dateRange.max=u)}d.errors.length===0?s.statistics.validRows++:(s.statistics.invalidRows++,s.isValid=!1),s.errors.push(...d.errors),s.warnings.push(...d.warnings),c.push(d)}catch(u){d.errors.push(`Error procesando fila: ${u.message}`),s.statistics.invalidRows++,s.isValid=!1,c.push(d)}}return s.preview=c.slice(0,10),s.processedData=c,s.statistics.newVehicles=Array.from(s.statistics.newVehicles),s.statistics.newProducts=Array.from(s.statistics.newProducts),console.log(`✅ Validación completada: ${s.statistics.validRows}/${s.statistics.totalRows} filas válidas`),{success:!0,validationResult:s,error:null}}catch(s){return console.error("❌ Error en validación:",s),{success:!1,error:s.message,validationResult:null}}},ya=async(a,t,n=null)=>{try{console.log("🚀 Iniciando ejecución de migración...");const s={success:!0,statistics:{totalRows:a.statistics.totalRows,processedRows:0,successfulRows:0,failedRows:0,newVehiclesCreated:0,newProductsCreated:0,movementsCreated:0},errors:[],warnings:[],migrationId:`migration_${Date.now()}`,startedAt:new Date};Object.keys(t.vehiculos||{}).length>0&&await G.saveAliases(I.VEHICLE,t.vehiculos),Object.keys(t.productos||{}).length>0&&await G.saveAliases(I.PRODUCT,t.productos);for(const i of a.statistics.newVehicles)try{const r=qe(i);await Xe.createVehicle({vehicleId:r,name:i,type:ba(i),fuelType:"GASOLINA",status:"activo",hasHourMeter:Ca(i),currentHours:0,description:`Creado automáticamente durante migración ${s.migrationId}`}),s.statistics.newVehiclesCreated++,console.log(`✅ Vehículo creado: ${r} - ${i}`)}catch(r){console.error(`❌ Error creando vehículo ${i}:`,r),s.warnings.push(`No se pudo crear vehículo '${i}': ${r.message}`)}for(const i of a.statistics.newProducts)try{const r=Fe(i);r&&!Object.values(te).includes(r)&&(await Ke({name:r,displayName:i,category:"Combustible",unit:"gal",defaultPrice:0,isActive:!0,description:`Creado automáticamente durante migración ${s.migrationId}`}),s.statistics.newProductsCreated++,console.log(`✅ Producto creado: ${i}`))}catch(r){console.error(`❌ Error creando producto ${i}:`,r),s.warnings.push(`No se pudo crear producto '${i}': ${r.message}`)}const c=100,o=a.processedData.filter(i=>i.errors.length===0);for(let i=0;i<o.length;i+=c){const r=o.slice(i,i+c);for(const d of r){try{const u=Ea(d.mapped);await We.createMovement(u),s.statistics.successfulRows++,s.statistics.movementsCreated++}catch(u){console.error(`❌ Error creando movimiento fila ${d.rowNumber}:`,u),s.errors.push(`Fila ${d.rowNumber}: ${u.message}`),s.statistics.failedRows++}if(s.statistics.processedRows++,n){const u=s.statistics.processedRows/o.length*100;n({progress:Math.round(u),processedRows:s.statistics.processedRows,totalRows:o.length,currentStep:`Procesando lote ${Math.floor(i/c)+1}...`})}}}return s.completedAt=new Date,s.success=s.statistics.failedRows<o.length*.1,console.log(`🎉 Migración completada: ${s.statistics.successfulRows}/${o.length} movimientos creados`),{success:!0,executionResult:s,error:null}}catch(s){return console.error("❌ Error en ejecución de migración:",s),{success:!1,error:s.message,executionResult:null}}},Me=(a,t,n,s)=>{if(a==null||a==="")return t.required?{error:`Campo '${n}' requerido en fila ${s}`}:{value:null};switch(t.type){case"date":{const c=wa(a);return c?{value:c}:{error:`Fecha inválida '${a}' en fila ${s}`}}case"number":{const c=parseFloat(a);return isNaN(c)||c<0?{error:`Número inválido '${a}' en fila ${s}`}:{value:c}}case"string":return{value:a.toString().trim()};default:return{value:a}}},wa=a=>{if(a instanceof Date)return a;if(typeof a=="number"){const c=new Date((a-25569)*86400*1e3);return he(c)?c:null}const t=a.toString().trim(),n=[/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/,/^(\d{4})-(\d{1,2})-(\d{1,2})$/,/^(\d{1,2})-(\d{1,2})-(\d{4})$/];for(const c of n){const o=t.match(c);if(o){let i,r,d;c.source.includes("YYYY")&&(c.source.startsWith("^(\\d{4})")?[,d,r,i]=o:[,i,r,d]=o);const u=new Date(parseInt(d),parseInt(r)-1,parseInt(i));return he(u)?u:null}}const s=new Date(t);return he(s)?s:null},he=a=>a instanceof Date&&!isNaN(a.getTime())&&a.getFullYear()>1900,qe=a=>{const t=a.toUpperCase().replace(/[^A-Z0-9]/g,"");return t.includes("TR")&&t.match(/\d/)?`TR-${t.match(/\d+/)?.[0]}`:t.includes("CAMIONETA")?t.includes("AMARILLA")?"CA-001":t.includes("BURBUJA")?"CB-001":"CM-001":t.includes("CARRO")?"CR-001":t.includes("VOLQUETA")?"VQ-001":t.includes("MOTO")?`MT-${Math.floor(Math.random()*100)}`:`${t.substring(0,2)||"EQ"}-${Math.floor(Math.random()*1e3)}`},ba=a=>{const t=a.toLowerCase();return t.includes("tractor")||t.includes("tr-")?"tractor":t.includes("camioneta")?"pickup_truck":t.includes("carro")?"car":t.includes("volqueta")?"log_truck":t.includes("moto")?"motorcycle":t.includes("bomba")?"water_pump":t.includes("planta")?"generator":t.includes("fumigadora")?"fumigadora":t.includes("guadaña")?"guadana":t.includes("hidrolavadora")?"hidrolavadora":"otros"},Ca=a=>{const t=a.toLowerCase();return t.includes("tr-")||t.includes("tractor")},Fe=a=>{const t=a.toLowerCase().trim();return t.includes("gasolina")?te.GASOLINA:t.includes("acpm")?te.ACPM:t.includes("diesel")?te.ACPM:te.GASOLINA},Ea=a=>({type:Ze.SALIDA,fuelType:a.productoId||te.GASOLINA,quantity:a.cantidad,unitPrice:a.precio||0,vehicleId:a.vehiculoId,location:a.ubicacion||"principal",destinationLocation:a.destino,currentHours:a.horometro,description:a.descripcion||"Migrado desde archivo histórico",effectiveDate:a.fecha,reference:`MIGRACION_${Date.now()}`,status:Qe.COMPLETADO}),ee={createMigrationContext:ga,processFile:va,configureColumnMapping:ja,configureValueMapping:fa,validateData:Na,executeMigration:ya,MIGRATION_STEPS:P,REQUIRED_FIELDS:W,OPTIONAL_FIELDS:we},ka=({onFileProcessed:a,currentFile:t=null,isLoading:n=!1,error:s=null})=>{const[c,o]=x.useState(!1),[i,r]=x.useState(0),[d,u]=x.useState(!1),[k,b]=x.useState({excel:{cellText:!1,cellDates:!0},csv:{delimiter:",",quote:'"',skipEmptyLines:!0,trimValues:!0}}),S=x.useRef(null),N=x.useCallback(async h=>{const j=h[0];if(j){r(0);try{const y=setInterval(()=>{r(m=>m>=90?(clearInterval(y),90):m+10)},100);await a(j,k),clearInterval(y),r(100)}catch(y){console.error("Error procesando archivo:",y)}}},[a,k]),A=x.useCallback(h=>{h.preventDefault(),o(!0)},[]),C=x.useCallback(h=>{h.preventDefault(),o(!1)},[]),M=x.useCallback(h=>{h.preventDefault(),o(!1);const j=Array.from(h.dataTransfer.files);N(j)},[N]),z=()=>{S.current?.click()},D=()=>{S.current&&(S.current.value=""),r(0),a(null)},T=h=>{if(h===0)return"0 Bytes";const j=1024,y=["Bytes","KB","MB","GB"],m=Math.floor(Math.log(h)/Math.log(j));return parseFloat((h/Math.pow(j,m)).toFixed(2))+" "+y[m]},B=h=>{switch(h.split(".").pop()?.toLowerCase()){case"xlsx":case"xls":return e.jsx(ke,{className:"text-green-600",size:24});case"csv":return e.jsx(fe,{className:"text-blue-600",size:24});default:return e.jsx(ke,{className:"text-gray-600",size:24})}};return e.jsxs("div",{className:"file-upload-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(se,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Formatos soportados"}),e.jsx("p",{children:"Excel (.xlsx, .xls) y CSV (.csv) con datos históricos de combustibles"})]})]}),t?.success?e.jsxs("div",{className:"file-preview-card",children:[e.jsxs("div",{className:"file-header",children:[e.jsxs("div",{className:"file-info",children:[B(t.metadata.fileName),e.jsxs("div",{className:"file-details",children:[e.jsx("h4",{children:t.metadata.fileName}),e.jsxs("div",{className:"file-meta",children:[e.jsx("span",{children:T(t.metadata.fileSize)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:t.metadata.fileType}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[t.metadata.rowCount," filas"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[t.metadata.columnCount," columnas"]})]})]})]}),e.jsxs("div",{className:"file-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>u(!d),title:"Opciones avanzadas",children:e.jsx(Gs,{size:16})}),e.jsx("button",{className:"btn-icon danger",onClick:D,title:"Remover archivo",children:e.jsx(le,{size:16})})]})]}),e.jsxs("div",{className:"processing-status success",children:[e.jsx(H,{size:16}),e.jsx("span",{children:"Archivo procesado exitosamente"})]}),t.preview&&t.preview.headers.length>0&&e.jsxs("div",{className:"data-preview",children:[e.jsxs("div",{className:"preview-header",children:[e.jsx(Q,{size:16}),e.jsxs("span",{children:["Vista previa de datos (",t.preview.total," filas total)"]})]}),e.jsx("div",{className:"preview-table-container",children:e.jsxs("table",{className:"preview-table",children:[e.jsx("thead",{children:e.jsx("tr",{children:t.preview.headers.map((h,j)=>e.jsx("th",{title:h,children:h},j))})}),e.jsx("tbody",{children:t.preview.preview.map((h,j)=>e.jsx("tr",{children:t.preview.headers.map((y,m)=>e.jsx("td",{title:h[y],children:h[y]?.toString()||"—"},m))},j))})]})}),e.jsxs("div",{className:"preview-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Filas encontradas:"}),e.jsx("span",{className:"stat-value",children:t.preview.statistics.totalRows})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Columnas detectadas:"}),e.jsx("span",{className:"stat-value",children:t.preview.statistics.totalColumns})]})]})]}),t.columnSuggestions&&Object.keys(t.columnSuggestions).length>0&&e.jsxs("div",{className:"suggestions-preview",children:[e.jsx("h5",{children:"Mapeos sugeridos automáticamente:"}),e.jsx("div",{className:"suggestions-grid",children:Object.entries(t.columnSuggestions).map(([h,j])=>e.jsxs("div",{className:"suggestion-item",children:[e.jsx("span",{className:"field-name",children:h}),e.jsx("span",{className:"arrow",children:"→"}),e.jsx("span",{className:"column-name",children:j})]},h))})]})]}):e.jsxs("div",{className:`upload-zone ${c?"drag-over":""} ${n?"loading":""}`,onDragOver:A,onDragLeave:C,onDrop:M,onClick:z,children:[e.jsx("div",{className:"upload-content",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"upload-spinner",children:e.jsx("div",{className:"spinner"})}),e.jsx("h3",{children:"Procesando archivo..."}),e.jsx("p",{children:"Analizando estructura y validando formato"}),i>0&&e.jsxs("div",{className:"progress-container",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${i}%`}})}),e.jsxs("span",{className:"progress-text",children:[i,"%"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{size:48,className:"upload-icon"}),e.jsx("h3",{children:"Arrastra tu archivo aquí"}),e.jsx("p",{children:"o haz clic para seleccionar desde tu computadora"}),e.jsxs("div",{className:"supported-formats",children:[e.jsx("span",{className:"format-tag excel",children:"Excel (.xlsx, .xls)"}),e.jsx("span",{className:"format-tag csv",children:"CSV (.csv)"})]})]})}),e.jsx("input",{ref:S,type:"file",accept:".xlsx,.xls,.csv",onChange:h=>N(Array.from(h.target.files)),style:{display:"none"}})]}),d&&e.jsxs("div",{className:"advanced-options",children:[e.jsx("h4",{children:"Opciones de procesamiento"}),e.jsxs("div",{className:"option-group",children:[e.jsx("h5",{children:"Opciones Excel"}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:k.excel.cellDates,onChange:h=>b(j=>({...j,excel:{...j.excel,cellDates:h.target.checked}}))}),e.jsx("span",{children:"Convertir fechas automáticamente"})]})]}),e.jsxs("div",{className:"option-group",children:[e.jsx("h5",{children:"Opciones CSV"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("label",{children:["Delimitador:",e.jsxs("select",{value:k.csv.delimiter,onChange:h=>b(j=>({...j,csv:{...j.csv,delimiter:h.target.value}})),children:[e.jsx("option",{value:",",children:"Coma (,)"}),e.jsx("option",{value:";",children:"Punto y coma (;)"}),e.jsx("option",{value:"\\t",children:"Tabulación"})]})]}),e.jsxs("label",{children:["Comillas:",e.jsxs("select",{value:k.csv.quote,onChange:h=>b(j=>({...j,csv:{...j.csv,quote:h.target.value}})),children:[e.jsx("option",{value:'"',children:'Comillas dobles (")'}),e.jsx("option",{value:"'",children:"Comillas simples (')"})]})]})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:k.csv.skipEmptyLines,onChange:h=>b(j=>({...j,csv:{...j.csv,skipEmptyLines:h.target.checked}}))}),e.jsx("span",{children:"Omitir líneas vacías"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:k.csv.trimValues,onChange:h=>b(j=>({...j,csv:{...j.csv,trimValues:h.target.checked}}))}),e.jsx("span",{children:"Limpiar espacios en valores"})]})]})]}),s&&e.jsxs("div",{className:"error-message",children:[e.jsx(F,{size:20}),e.jsx("span",{children:s})]})]})},Sa=({fileHeaders:a=[],currentMapping:t={},columnSuggestions:n={},onMappingChange:s,previewData:c=[],error:o=null})=>{const[i,r]=x.useState(t),[d,u]=x.useState(null),[k,b]=x.useState(!1),[S,N]=x.useState(null);x.useEffect(()=>{Object.keys(t).length>0?r(t):Object.keys(n).length>0&&r(n)},[t,n]);const A=x.useMemo(()=>{const m=Object.keys(W).filter(q=>!i[q]),f=Object.values(i),E=a.filter(q=>!f.includes(q)),U=f.filter((q,K)=>f.indexOf(q)!==K);return{isValid:m.length===0&&U.length===0,missingRequired:m,unmappedColumns:E,duplicateColumns:U,totalMapped:Object.keys(i).length,requiredMapped:Object.keys(W).filter(q=>i[q]).length}},[i,a]),C=x.useCallback((m,f)=>{const E={...i};f?(Object.keys(E).forEach(U=>{E[U]===f&&delete E[U]}),E[m]=f):delete E[m],r(E),s(E)},[i,s]),M=()=>{r({...n}),s(n)},z=()=>{r({}),s({})},D=(m,f)=>{u(f),m.dataTransfer.effectAllowed="move"},T=(m,f)=>{m.preventDefault(),m.dataTransfer.dropEffect="move",N(f)},B=()=>{N(null)},h=(m,f)=>{m.preventDefault(),d&&C(f,d),u(null),N(null)},j=m=>W[m]?"required":"optional",y=()=>{if(!k||c.length===0)return null;const m=c.slice(0,3).map(f=>{const E={};return Object.entries(i).forEach(([U,q])=>{E[U]=f[q]}),E});return e.jsxs("div",{className:"mapping-preview",children:[e.jsxs("div",{className:"preview-header",children:[e.jsx(Q,{size:16}),e.jsx("span",{children:"Vista previa del mapeo"})]}),e.jsx("div",{className:"preview-table-container",children:e.jsxs("table",{className:"preview-table",children:[e.jsx("thead",{children:e.jsx("tr",{children:Object.keys(i).map(f=>e.jsxs("th",{children:[f,e.jsx("span",{className:`field-type ${j(f)}`,children:j(f)==="required"?"REQ":"OPT"})]},f))})}),e.jsx("tbody",{children:m.map((f,E)=>e.jsx("tr",{children:Object.keys(i).map(U=>e.jsx("td",{children:f[U]?.toString()||"—"},U))},E))})]})})]})};return e.jsxs("div",{className:"column-mapping-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(se,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Mapeo de columnas"}),e.jsx("p",{children:"Relaciona las columnas de tu archivo con los campos del sistema. Los campos marcados como REQ son obligatorios."})]})]}),e.jsxs("div",{className:"mapping-status",children:[e.jsxs("div",{className:"status-grid",children:[e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-label",children:"Campos mapeados:"}),e.jsx("span",{className:"status-value",children:A.totalMapped})]}),e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-label",children:"Obligatorios:"}),e.jsxs("span",{className:`status-value ${A.requiredMapped===Object.keys(W).length?"success":"warning"}`,children:[A.requiredMapped,"/",Object.keys(W).length]})]}),e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-label",children:"Sin mapear:"}),e.jsx("span",{className:"status-value",children:A.unmappedColumns.length})]})]}),e.jsxs("div",{className:"mapping-actions",children:[e.jsxs("button",{className:"btn-secondary",onClick:M,disabled:Object.keys(n).length===0,children:[e.jsx($e,{size:16}),"Aplicar sugerencias"]}),e.jsxs("button",{className:"btn-secondary",onClick:z,disabled:Object.keys(i).length===0,children:[e.jsx(de,{size:16}),"Limpiar todo"]}),e.jsxs("button",{className:"btn-secondary",onClick:()=>b(!k),disabled:Object.keys(i).length===0,children:[e.jsx(Q,{size:16}),k?"Ocultar":"Ver"," preview"]})]})]}),!A.isValid&&e.jsxs("div",{className:"validation-messages",children:[A.missingRequired.length>0&&e.jsxs("div",{className:"validation-error",children:[e.jsx(F,{size:16}),e.jsxs("span",{children:["Campos obligatorios sin mapear: ",A.missingRequired.join(", ")]})]}),A.duplicateColumns.length>0&&e.jsxs("div",{className:"validation-error",children:[e.jsx(F,{size:16}),e.jsxs("span",{children:["Columnas duplicadas: ",A.duplicateColumns.join(", ")]})]})]}),e.jsxs("div",{className:"mapping-container",children:[e.jsxs("div",{className:"file-columns",children:[e.jsxs("h3",{children:[e.jsx(Ee,{size:20}),"Columnas del archivo (",a.length,")"]}),e.jsx("div",{className:"columns-list",children:a.map((m,f)=>e.jsxs("div",{className:`column-item ${Object.values(i).includes(m)?"mapped":"unmapped"} ${d===m?"dragging":""}`,draggable:!0,onDragStart:E=>D(E,m),children:[e.jsx("span",{className:"column-name",children:m}),Object.values(i).includes(m)&&e.jsx(H,{size:14,className:"mapped-icon"})]},f))})]}),e.jsx("div",{className:"mapping-arrow",children:e.jsx(re,{size:24})}),e.jsxs("div",{className:"system-fields",children:[e.jsxs("h3",{children:[e.jsx(Ee,{size:20}),"Campos del sistema"]}),e.jsxs("div",{className:"field-group",children:[e.jsx("h4",{children:"Campos obligatorios"}),e.jsx("div",{className:"fields-list",children:Object.entries(W).map(([m,f])=>e.jsxs("div",{className:`field-item required ${i[m]?"mapped":"unmapped"} ${S===m?"hovered":""}`,onDragOver:E=>T(E,m),onDragLeave:B,onDrop:E=>h(E,m),children:[e.jsxs("div",{className:"field-header",children:[e.jsx("span",{className:"field-name",children:m}),e.jsx("span",{className:"field-type required",children:"REQ"})]}),e.jsx("p",{className:"field-description",children:f.description}),i[m]?e.jsxs("div",{className:"mapped-column",children:[e.jsxs("span",{className:"mapped-to",children:["→ ",i[m]]}),e.jsx("button",{className:"unmap-btn",onClick:()=>C(m,null),children:"×"})]}):e.jsx("div",{className:"unmapped-field",children:e.jsxs("select",{value:"",onChange:E=>C(m,E.target.value),className:"column-select",children:[e.jsx("option",{value:"",children:"Seleccionar columna..."}),a.filter(E=>!Object.values(i).includes(E)).map(E=>e.jsx("option",{value:E,children:E},E))]})})]},m))})]}),e.jsxs("div",{className:"field-group",children:[e.jsx("h4",{children:"Campos opcionales"}),e.jsx("div",{className:"fields-list",children:Object.entries(we).map(([m,f])=>e.jsxs("div",{className:`field-item optional ${i[m]?"mapped":"unmapped"} ${S===m?"hovered":""}`,onDragOver:E=>T(E,m),onDragLeave:B,onDrop:E=>h(E,m),children:[e.jsxs("div",{className:"field-header",children:[e.jsx("span",{className:"field-name",children:m}),e.jsx("span",{className:"field-type optional",children:"OPT"})]}),e.jsx("p",{className:"field-description",children:f.description}),i[m]?e.jsxs("div",{className:"mapped-column",children:[e.jsxs("span",{className:"mapped-to",children:["→ ",i[m]]}),e.jsx("button",{className:"unmap-btn",onClick:()=>C(m,null),children:"×"})]}):e.jsx("div",{className:"unmapped-field",children:e.jsxs("select",{value:"",onChange:E=>C(m,E.target.value),className:"column-select",children:[e.jsx("option",{value:"",children:"Seleccionar columna..."}),a.filter(E=>!Object.values(i).includes(E)).map(E=>e.jsx("option",{value:E,children:E},E))]})})]},m))})]})]})]}),y(),o&&e.jsxs("div",{className:"error-message",children:[e.jsx(F,{size:20}),e.jsx("span",{children:o})]})]})},Ma=({mappedData:a=[],columnMapping:t={},onValueMappingChange:n,currentValueMapping:s={},error:c=null})=>{const[o,i]=x.useState(s),[r,d]=x.useState(!1),[u,k]=x.useState("vehicle"),[b,S]=x.useState({}),[N,A]=x.useState(null),[C,M]=x.useState(""),[z,D]=x.useState(!1),[T,B]=x.useState({}),h=x.useMemo(()=>{const g=[];return Object.entries(t).forEach(([l,p])=>{l.toLowerCase().includes("vehicle")||l==="vehicleId"?g.push({systemField:l,fileColumn:p,aliasType:I.VEHICLE,displayName:"Vehículos",icon:"🚛",description:"Mapear nombres de vehículos a códigos del sistema"}):l.toLowerCase().includes("product")||l==="productName"?g.push({systemField:l,fileColumn:p,aliasType:I.PRODUCT,displayName:"Productos",icon:"⛽",description:"Mapear nombres de combustibles a códigos del sistema"}):l.toLowerCase().includes("location")||l==="location"?g.push({systemField:l,fileColumn:p,aliasType:I.LOCATION,displayName:"Ubicaciones",icon:"📍",description:"Mapear nombres de ubicaciones a códigos del sistema"}):(l.toLowerCase().includes("supplier")||l==="supplierName")&&g.push({systemField:l,fileColumn:p,aliasType:I.SUPPLIER,displayName:"Proveedores",icon:"🏢",description:"Mapear nombres de proveedores a códigos del sistema"})}),g},[t]),j=x.useMemo(()=>{const g={};return h.forEach(l=>{const p=a.map(v=>v[l.fileColumn]).filter(v=>v&&v.toString().trim()).map(v=>v.toString().trim());g[l.aliasType]=[...new Set(p)].sort()}),g},[a,h]);x.useEffect(()=>{(async()=>{if(Object.keys(s).length>0){i(s);return}D(!0);const l={};try{for(const p of h){const v=j[p.aliasType]||[];if(v.length>0){const L=await G.getSuggestedMappings(p.aliasType,v);l[p.aliasType]=L}}i(l),n(l)}catch(p){console.error("Error cargando sugerencias:",p)}finally{D(!1)}})()},[h,j,s,n]),x.useEffect(()=>{(async()=>{const l={};for(const p of Object.values(I))try{const v=await G.getAliasesByType(p);l[p]={totalAliases:v?.metadata?.totalMappings||0,lastUsed:v?.metadata?.lastUsed||null,usageCount:v?.metadata?.usageCount||0}}catch{l[p]={totalAliases:0,lastUsed:null,usageCount:0}}B(l)})()},[]);const y=x.useMemo(()=>{const g={};let l=0,p=0;return h.forEach(v=>{const L=j[v.aliasType]||[],O=o[v.aliasType]||{},Y=L.filter($=>O[$]?.suggested&&O[$].suggested!==null),w=L.filter($=>!O[$]?.suggested||O[$].suggested===null);g[v.aliasType]={total:L.length,mapped:Y.length,unmapped:w.length,mappedValues:Y,unmappedValues:w,percentage:L.length>0?Y.length/L.length*100:100},l+=Y.length,p+=w.length}),{byType:g,overall:{totalMapped:l,totalUnmapped:p,percentage:l+p>0?l/(l+p)*100:100}}},[h,j,o]),m=x.useCallback(async(g,l,p)=>{const v={...o};if(v[g]||(v[g]={}),v[g][l]={suggested:p,confidence:1,source:"manual",alternatives:[]},i(v),n(v),p)try{await G.saveAliases(g,{[l]:p})}catch(L){console.error("Error guardando alias:",L)}},[o,n]),f=async()=>{D(!0);try{const g={};for(const l of h){const p=j[l.aliasType]||[];if(p.length>0){const v=await G.getSuggestedMappings(l.aliasType,p);g[l.aliasType]=v}}i(g),n(g)}catch(g){console.error("Error aplicando sugerencias:",g)}finally{D(!1)}},E=()=>{i({}),n({})},U=async()=>{if(!(!N||!C.trim()))try{await m(N.aliasType,N.inputValue,C.trim()),A(null),M("")}catch(g){console.error("Error guardando alias:",g)}},q=g=>{const l=j[g]||[],p=b[g]||"";return p.trim()?l.filter(v=>v.toLowerCase().includes(p.toLowerCase())):l},K=()=>{if(!r||a.length===0)return null;const g=a.slice(0,5).map(l=>{const p={...l};return h.forEach(v=>{const L=l[v.fileColumn],O=o[v.aliasType]?.[L];O?.suggested&&(p[`${v.fileColumn}_mapped`]=O.suggested)}),p});return e.jsxs("div",{className:"mapping-preview",children:[e.jsxs("div",{className:"preview-header",children:[e.jsx(Q,{size:16}),e.jsxs("span",{children:["Vista previa del mapeo de valores (",a.length," filas total)"]})]}),e.jsx("div",{className:"preview-table-container",children:e.jsxs("table",{className:"preview-table",children:[e.jsx("thead",{children:e.jsx("tr",{children:h.map(l=>e.jsxs(pe.Fragment,{children:[e.jsxs("th",{className:"original-column",children:[l.fileColumn," (Original)"]}),e.jsxs("th",{className:"mapped-column",children:[l.fileColumn," (Mapeado)"]})]},l.aliasType))})}),e.jsx("tbody",{children:g.map((l,p)=>e.jsx("tr",{children:h.map(v=>e.jsxs(pe.Fragment,{children:[e.jsx("td",{className:"original-value",children:l[v.fileColumn]||"—"}),e.jsx("td",{className:"mapped-value",children:e.jsx("span",{className:`mapped-result ${l[`${v.fileColumn}_mapped`]?"success":"pending"}`,children:l[`${v.fileColumn}_mapped`]||"Sin mapear"})})]},v.aliasType))},p))})]})})]})};return h.length===0?e.jsx("div",{className:"value-mapping-step",children:e.jsxs("div",{className:"step-info-card",children:[e.jsx(se,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"No se requiere mapeo de valores"}),e.jsx("p",{children:"Los campos mapeados no requieren conversión de valores. Puedes continuar al siguiente paso."})]})]})}):e.jsxs("div",{className:"value-mapping-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(se,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Mapeo de valores"}),e.jsx("p",{children:"Convierte nombres descriptivos del archivo a códigos específicos del sistema. Los alias se guardan para reutilizar en futuras migraciones."})]})]}),e.jsxs("div",{className:"mapping-status",children:[e.jsx("div",{className:"status-overview",children:e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-label",children:"Progreso total:"}),e.jsxs("div",{className:"status-progress",children:[e.jsx("div",{className:"progress-bar",style:{width:`${y.overall.percentage}%`}}),e.jsxs("span",{className:"progress-text",children:[y.overall.totalMapped," / ",y.overall.totalMapped+y.overall.totalUnmapped,"(",Math.round(y.overall.percentage),"%)"]})]})]})}),e.jsxs("div",{className:"mapping-actions",children:[e.jsxs("button",{className:"btn-secondary",onClick:f,disabled:z,children:[e.jsx($e,{size:16}),z?"Cargando...":"Recargar sugerencias"]}),e.jsxs("button",{className:"btn-secondary",onClick:E,disabled:Object.keys(o).length===0,children:[e.jsx(de,{size:16}),"Limpiar todo"]}),e.jsxs("button",{className:"btn-secondary",onClick:()=>d(!r),disabled:Object.keys(o).length===0,children:[e.jsx(Q,{size:16}),r?"Ocultar":"Ver"," preview"]})]})]}),e.jsxs("div",{className:"mapping-tabs",children:[e.jsx("div",{className:"tab-buttons",children:h.map(g=>e.jsxs("button",{className:`tab-button ${u===g.aliasType?"active":""}`,onClick:()=>k(g.aliasType),children:[e.jsx("span",{className:"tab-icon",children:g.icon}),e.jsx("span",{className:"tab-text",children:g.displayName}),e.jsxs("span",{className:"tab-badge",children:[y.byType[g.aliasType]?.mapped||0," / ",y.byType[g.aliasType]?.total||0]})]},g.aliasType))}),h.map(g=>{if(g.aliasType!==u)return null;const l=y.byType[g.aliasType],p=q(g.aliasType),v=o[g.aliasType]||{};return e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{className:"tab-header",children:[e.jsxs("div",{className:"tab-info",children:[e.jsxs("h3",{children:[g.icon," ",g.displayName]}),e.jsx("p",{children:g.description})]}),e.jsxs("div",{className:"tab-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx(Oe,{size:16}),e.jsxs("span",{children:["Progreso: ",Math.round(l?.percentage||0),"%"]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx(ce,{size:16}),e.jsxs("span",{children:["Alias guardados: ",T[g.aliasType]?.totalAliases||0]})]})]})]}),e.jsxs("div",{className:"search-bar",children:[e.jsx(De,{size:16}),e.jsx("input",{type:"text",placeholder:`Buscar en ${p.length} valores de ${g.displayName.toLowerCase()}...`,value:b[g.aliasType]||"",onChange:L=>S(O=>({...O,[g.aliasType]:L.target.value}))})]}),e.jsx("div",{className:"values-mapping-list",children:p.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("span",{children:"No se encontraron valores para mapear"})}):p.map(L=>{const O=v[L],Y=O?.suggested&&O.suggested!==null;return e.jsxs("div",{className:`value-mapping-item ${Y?"mapped":"unmapped"}`,children:[e.jsxs("div",{className:"value-info",children:[e.jsxs("div",{className:"original-value",children:[e.jsx("span",{className:"value-text",children:L}),e.jsxs("span",{className:"value-count",children:[a.filter(w=>w[g.fileColumn]===L).length," registros"]})]}),Y&&e.jsxs("div",{className:"mapped-result",children:[e.jsx(re,{size:14}),e.jsx("span",{className:"mapped-value",children:O.suggested}),e.jsxs("span",{className:`confidence ${O.confidence>=.8?"high":O.confidence>=.5?"medium":"low"}`,children:[Math.round(O.confidence*100),"%"]}),e.jsx("span",{className:"source",children:O.source})]})]}),e.jsxs("div",{className:"value-actions",children:[O?.alternatives&&O.alternatives.length>0&&e.jsxs("select",{className:"alternatives-select",value:O.suggested||"",onChange:w=>m(g.aliasType,L,w.target.value),children:[e.jsxs("option",{value:O.suggested,children:[O.suggested," (Sugerido)"]}),O.alternatives.map(w=>e.jsxs("option",{value:w.id,children:[w.id," (",Math.round(w.confidence*100),"%)"]},w.id))]}),e.jsx("button",{className:"btn-icon",onClick:()=>{A({aliasType:g.aliasType,inputValue:L}),M(O?.suggested||"")},title:"Editar mapeo",children:e.jsx(_s,{size:14})}),Y&&e.jsx("button",{className:"btn-icon danger",onClick:()=>m(g.aliasType,L,null),title:"Eliminar mapeo",children:e.jsx(le,{size:14})})]})]},L)})})]},g.aliasType)})]}),N&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h4",{children:"Editar mapeo"}),e.jsx("button",{className:"btn-icon",onClick:()=>{A(null),M("")},children:e.jsx(le,{size:16})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Valor original:"}),e.jsx("input",{type:"text",value:N.inputValue,disabled:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Mapear a:"}),e.jsx("input",{type:"text",value:C,onChange:g=>M(g.target.value),placeholder:"Código del sistema (ej: V-001, DIESEL, etc.)",autoFocus:!0})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>{A(null),M("")},children:"Cancelar"}),e.jsxs("button",{className:"btn-primary",onClick:U,disabled:!C.trim(),children:[e.jsx(Fs,{size:16}),"Guardar alias"]})]})]})}),K(),c&&e.jsxs("div",{className:"error-message",children:[e.jsx(F,{size:20}),e.jsx("span",{children:c})]})]})},Ra=({fileData:a=[],columnMapping:t={},valueMapping:n={},onValidationComplete:s,currentValidation:c=null,isValidating:o=!1,error:i=null})=>{const[r,d]=x.useState(c),[u,k]=x.useState(!0),[b,S]=x.useState("overview"),[N,A]=x.useState("all"),[C,M]=x.useState(""),[z,D]=x.useState(1),[T]=x.useState(10),[B,h]=x.useState(new Set);x.useEffect(()=>{(async()=>{if(!c&&a.length>0&&Object.keys(t).length>0)try{const p=await ee.validateData(a,t,n);p.success&&(d(p.validationResult),s(p.validationResult))}catch(p){console.error("Error en validación automática:",p)}else c&&d(c)})()},[a,t,n,c,s]);const j=async()=>{try{const l=await ee.validateData(a,t,n);l.success&&(d(l.validationResult),s(l.validationResult))}catch(l){console.error("Error ejecutando validación:",l)}},y=x.useMemo(()=>{if(!r?.processedData)return[];let l=r.processedData;switch(N){case"valid":l=l.filter(p=>p.errors.length===0);break;case"invalid":l=l.filter(p=>p.errors.length>0);break;case"warnings":l=l.filter(p=>p.warnings.length>0);break}if(C.trim()){const p=C.toLowerCase();l=l.filter(v=>{const L=Object.values(v.original).join(" ").toLowerCase(),O=Object.values(v.mapped).join(" ").toLowerCase();return L.includes(p)||O.includes(p)})}return l},[r,N,C]),m=x.useMemo(()=>{const l=(z-1)*T;return y.slice(l,l+T)},[y,z,T]),f=x.useMemo(()=>{if(!r)return null;const l=r.statistics,p=l.totalRows>0?l.validRows/l.totalRows*100:0;return{...l,successRate:p,hasErrors:r.errors.length>0,hasWarnings:r.warnings.length>0,totalPages:Math.ceil(y.length/T)}},[r,y.length,T]),E=l=>{const p=new Set(B);p.has(l)?p.delete(l):p.add(l),h(p)},U=()=>{if(!r)return;const l={summary:f,dateRange:r.statistics.dateRange,newEntities:{vehicles:r.statistics.newVehicles,products:r.statistics.newProducts},errors:r.errors,warnings:r.warnings,exportedAt:new Date().toISOString()},p=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),v=URL.createObjectURL(p),L=document.createElement("a");L.href=v,L.download=`validacion_migracion_${Date.now()}.json`,L.click(),URL.revokeObjectURL(v)},q=()=>f?e.jsxs("div",{className:"validation-overview",children:[e.jsxs("div",{className:"main-stats-grid",children:[e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(H,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:f.validRows}),e.jsx("p",{children:"Filas válidas"}),e.jsxs("span",{className:"stat-percentage",children:[Math.round(f.successRate),"%"]})]})]}),e.jsxs("div",{className:"stat-card error",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(F,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:f.invalidRows}),e.jsx("p",{children:"Filas con errores"}),e.jsxs("span",{className:"stat-percentage",children:[Math.round(100-f.successRate),"%"]})]})]}),e.jsxs("div",{className:"stat-card warning",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(J,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:r.warnings.length}),e.jsx("p",{children:"Advertencias"}),e.jsx("span",{className:"stat-note",children:"No bloquean migración"})]})]}),e.jsxs("div",{className:"stat-card info",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(ce,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:f.totalRows}),e.jsx("p",{children:"Total de filas"}),e.jsx("span",{className:"stat-note",children:"Archivo procesado"})]})]})]}),e.jsxs("div",{className:"detailed-stats-grid",children:[e.jsxs("div",{className:"stat-group",children:[e.jsxs("h4",{children:[e.jsx(ds,{size:16})," Rango de fechas"]}),e.jsxs("div",{className:"stat-values",children:[e.jsxs("span",{children:["Desde: ",f.dateRange.min?.toLocaleDateString("es-CO")||"N/A"]}),e.jsxs("span",{children:["Hasta: ",f.dateRange.max?.toLocaleDateString("es-CO")||"N/A"]})]})]}),e.jsxs("div",{className:"stat-group",children:[e.jsxs("h4",{children:[e.jsx(ve,{size:16})," Nuevos vehículos"]}),e.jsxs("div",{className:"stat-values",children:[e.jsx("span",{className:"stat-number",children:f.newVehicles.length}),e.jsx("span",{className:"stat-detail",children:"Se crearán automáticamente"})]})]}),e.jsxs("div",{className:"stat-group",children:[e.jsxs("h4",{children:[e.jsx(me,{size:16})," Nuevos productos"]}),e.jsxs("div",{className:"stat-values",children:[e.jsx("span",{className:"stat-number",children:f.newProducts.length}),e.jsx("span",{className:"stat-detail",children:"Se crearán automáticamente"})]})]}),e.jsxs("div",{className:"stat-group",children:[e.jsxs("h4",{children:[e.jsx(ge,{size:16})," Estimación"]}),e.jsxs("div",{className:"stat-values",children:[e.jsxs("span",{children:[f.validRows," movimientos"]}),e.jsx("span",{className:"stat-detail",children:"Listos para migrar"})]})]})]}),e.jsxs("div",{className:"validation-progress",children:[e.jsxs("div",{className:"progress-header",children:[e.jsx("span",{children:"Estado de validación"}),e.jsxs("span",{children:[f.validRows,"/",f.totalRows," filas válidas"]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill success",style:{width:`${f.successRate}%`}})})]})]}):null,K=()=>{const l=r?.errors||[],p=r?.warnings||[];return e.jsxs("div",{className:"errors-warnings-section",children:[l.length>0&&e.jsxs("div",{className:"message-group errors",children:[e.jsxs("h4",{children:[e.jsx(F,{size:16}),"Errores (",l.length,")"]}),e.jsxs("div",{className:"messages-list",children:[l.slice(0,20).map((v,L)=>e.jsx("div",{className:"message-item error",children:e.jsx("span",{className:"message-text",children:v})},L)),l.length>20&&e.jsx("div",{className:"message-item info",children:e.jsxs("span",{children:["... y ",l.length-20," errores más"]})})]})]}),p.length>0&&e.jsxs("div",{className:"message-group warnings",children:[e.jsxs("h4",{children:[e.jsx(J,{size:16}),"Advertencias (",p.length,")"]}),e.jsxs("div",{className:"messages-list",children:[p.slice(0,20).map((v,L)=>e.jsx("div",{className:"message-item warning",children:e.jsx("span",{className:"message-text",children:v})},L)),p.length>20&&e.jsx("div",{className:"message-item info",children:e.jsxs("span",{children:["... y ",p.length-20," advertencias más"]})})]})]}),l.length===0&&p.length===0&&e.jsxs("div",{className:"no-issues",children:[e.jsx(H,{size:48}),e.jsx("h3",{children:"¡Todo perfecto!"}),e.jsx("p",{children:"No se encontraron errores ni advertencias en los datos."})]})]})},g=()=>!u||m.length===0?null:e.jsxs("div",{className:"data-preview-section",children:[e.jsxs("div",{className:"preview-controls",children:[e.jsxs("div",{className:"filter-controls",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx(Ms,{size:16}),e.jsxs("select",{value:N,onChange:l=>{A(l.target.value),D(1)},children:[e.jsxs("option",{value:"all",children:["Todas las filas (",r.processedData.length,")"]}),e.jsxs("option",{value:"valid",children:["Solo válidas (",f.validRows,")"]}),e.jsxs("option",{value:"invalid",children:["Con errores (",f.invalidRows,")"]}),e.jsxs("option",{value:"warnings",children:["Con advertencias (",r.warnings.length,")"]})]})]}),e.jsxs("div",{className:"search-group",children:[e.jsx(De,{size:16}),e.jsx("input",{type:"text",placeholder:"Buscar en datos...",value:C,onChange:l=>{M(l.target.value),D(1)}})]}),e.jsxs("button",{className:"btn-secondary",onClick:()=>k(!u),children:[u?e.jsx(bs,{size:16}):e.jsx(Q,{size:16}),u?"Ocultar":"Mostrar"," preview"]})]}),e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"btn-icon",onClick:()=>D(Math.max(1,z-1)),disabled:z===1,children:e.jsx(hs,{size:16})}),e.jsxs("span",{className:"pagination-info",children:["Página ",z," de ",f.totalPages,"(",y.length," filas)"]}),e.jsx("button",{className:"btn-icon",onClick:()=>D(Math.min(f.totalPages,z+1)),disabled:z===f.totalPages,children:e.jsx(ms,{size:16})})]})]}),e.jsx("div",{className:"preview-table-container",children:e.jsxs("table",{className:"validation-preview-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"row-number",children:"#"}),e.jsx("th",{className:"status-column",children:"Estado"}),e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Vehículo"}),e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Horómetro"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:m.map(l=>e.jsxs(pe.Fragment,{children:[e.jsxs("tr",{className:`preview-row ${l.errors.length>0?"has-errors":l.warnings.length>0?"has-warnings":"valid"}`,children:[e.jsx("td",{className:"row-number",children:l.rowNumber}),e.jsx("td",{className:"status-column",children:l.errors.length>0?e.jsxs("span",{className:"status error",children:[e.jsx(F,{size:14})," Error"]}):l.warnings.length>0?e.jsxs("span",{className:"status warning",children:[e.jsx(J,{size:14})," Advertencia"]}):e.jsxs("span",{className:"status success",children:[e.jsx(H,{size:14})," Válido"]})}),e.jsx("td",{children:l.mapped.fecha?.toLocaleDateString("es-CO")||"—"}),e.jsx("td",{children:e.jsxs("div",{className:"vehicle-cell",children:[e.jsx("span",{className:"original",children:l.original[t.vehiculo]||"—"}),l.mapped.vehiculoId&&e.jsxs("span",{className:"mapped",children:["→ ",l.mapped.vehiculoId]})]})}),e.jsx("td",{children:e.jsxs("div",{className:"product-cell",children:[e.jsx("span",{className:"original",children:l.original[t.producto]||"—"}),l.mapped.productoId&&e.jsxs("span",{className:"mapped",children:["→ ",l.mapped.productoId]})]})}),e.jsx("td",{className:"quantity-cell",children:l.mapped.cantidad||"—"}),e.jsx("td",{className:"hours-cell",children:l.mapped.horometro||"—"}),e.jsx("td",{className:"actions-cell",children:e.jsx("button",{className:"btn-icon",onClick:()=>E(l.rowNumber),title:"Ver detalles",children:e.jsx(Q,{size:14})})})]}),B.has(l.rowNumber)&&e.jsx("tr",{className:"expanded-row",children:e.jsx("td",{colSpan:"8",children:e.jsxs("div",{className:"row-details",children:[l.errors.length>0&&e.jsxs("div",{className:"row-issues errors",children:[e.jsxs("h5",{children:[e.jsx(F,{size:14})," Errores"]}),e.jsx("ul",{children:l.errors.map((p,v)=>e.jsx("li",{children:p},v))})]}),l.warnings.length>0&&e.jsxs("div",{className:"row-issues warnings",children:[e.jsxs("h5",{children:[e.jsx(J,{size:14})," Advertencias"]}),e.jsx("ul",{children:l.warnings.map((p,v)=>e.jsx("li",{children:p},v))})]}),e.jsxs("div",{className:"mapped-data",children:[e.jsxs("h5",{children:[e.jsx(ce,{size:14})," Datos mapeados"]}),e.jsx("div",{className:"mapped-fields",children:Object.entries(l.mapped).map(([p,v])=>e.jsxs("div",{className:"mapped-field",children:[e.jsxs("span",{className:"field-name",children:[p,":"]}),e.jsx("span",{className:"field-value",children:v instanceof Date?v.toLocaleDateString("es-CO"):v?.toString()||"N/A"})]},p))})]})]})})})]},l.rowNumber))})]})})]});return!r&&!o?e.jsxs("div",{className:"validation-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(se,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Validación de datos"}),e.jsx("p",{children:"Ejecuta la validación para verificar que los datos están listos para migrar."})]})]}),e.jsx("div",{className:"validation-prompt",children:e.jsxs("div",{className:"prompt-content",children:[e.jsx(fe,{size:48}),e.jsx("h3",{children:"¿Listo para validar?"}),e.jsx("p",{children:"Los datos se verificarán antes de la migración final. Esto incluye:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Validación de campos obligatorios"}),e.jsx("li",{children:"Verificación de formatos de fecha y números"}),e.jsx("li",{children:"Resolución de alias de vehículos y productos"}),e.jsx("li",{children:"Detección de datos que requieren creación automática"})]}),e.jsxs("button",{className:"btn-primary",onClick:j,disabled:o,children:[e.jsx(xe,{size:16}),o?"Validando...":"Ejecutar validación"]})]})})]}):o?e.jsx("div",{className:"validation-step",children:e.jsxs("div",{className:"validation-loading",children:[e.jsx("div",{className:"loading-spinner",children:e.jsx("div",{className:"spinner"})}),e.jsx("h3",{children:"Validando datos..."}),e.jsxs("p",{children:["Verificando ",a.length," filas de datos"]})]})}):e.jsxs("div",{className:"validation-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(se,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Validación completada"}),e.jsx("p",{children:"Revisa los resultados de la validación antes de proceder con la migración final."})]})]}),e.jsxs("div",{className:"validation-status",children:[e.jsxs("div",{className:"status-header",children:[e.jsx("div",{className:"status-icon",children:r.isValid?e.jsx(H,{size:24,className:"success"}):e.jsx(F,{size:24,className:"error"})}),e.jsxs("div",{className:"status-content",children:[e.jsx("h3",{children:r.isValid?"✅ Datos listos para migrar":"❌ Se encontraron errores que deben corregirse"}),e.jsxs("p",{children:[f.validRows," de ",f.totalRows," filas son válidas (",Math.round(f.successRate),"% de éxito)"]})]})]}),e.jsxs("div",{className:"validation-actions",children:[e.jsxs("button",{className:"btn-secondary",onClick:j,disabled:o,children:[e.jsx(de,{size:16}),"Re-validar"]}),e.jsxs("button",{className:"btn-secondary",onClick:U,children:[e.jsx(Le,{size:16}),"Exportar reporte"]})]})]}),e.jsxs("div",{className:"validation-tabs",children:[e.jsxs("div",{className:"tab-buttons",children:[e.jsxs("button",{className:`tab-button ${b==="overview"?"active":""}`,onClick:()=>S("overview"),children:[e.jsx(ge,{size:16}),"Resumen"]}),e.jsxs("button",{className:`tab-button ${b==="issues"?"active":""}`,onClick:()=>S("issues"),children:[e.jsx(J,{size:16}),"Errores y Advertencias",r.errors.length+r.warnings.length>0&&e.jsx("span",{className:"tab-badge",children:r.errors.length+r.warnings.length})]}),e.jsxs("button",{className:`tab-button ${b==="preview"?"active":""}`,onClick:()=>S("preview"),children:[e.jsx(Q,{size:16}),"Preview de Datos"]})]}),e.jsxs("div",{className:"tab-content",children:[b==="overview"&&q(),b==="issues"&&K(),b==="preview"&&g()]})]}),i&&e.jsxs("div",{className:"error-message",children:[e.jsx(F,{size:20}),e.jsx("span",{children:i})]})]})},_={READY:"ready",RUNNING:"running",PAUSED:"paused",COMPLETED:"completed",FAILED:"failed",CANCELLED:"cancelled"},Aa=({validationResult:a,valueMapping:t={},onExecutionComplete:n,onNavigateToStep:s,currentExecution:c=null,canExecute:o=!0,error:i=null})=>{const[r,d]=x.useState(_.READY),[u,k]=x.useState(c),[b,S]=x.useState({progress:0,processedRows:0,totalRows:0,currentStep:""}),[N,A]=x.useState(null),[C,M]=x.useState(0),[z,D]=x.useState([]),[T,B]=x.useState(!1),[h,j]=x.useState(null);x.useRef(null);const y=x.useRef(null);x.useEffect(()=>{if(r===_.RUNNING&&N)return y.current=setInterval(()=>{const w=Date.now()-N;if(M(w),b.progress>0){const V=w/b.progress*100-w;j(V>0?V:0)}},1e3),()=>{y.current&&clearInterval(y.current)}},[r,N,b.progress]),x.useEffect(()=>()=>{y.current&&clearInterval(y.current)},[]);const m=x.useCallback((w,$="info")=>{const V={id:Date.now(),timestamp:new Date,message:w,type:$};D(X=>[...X,V])},[]),f=x.useCallback(w=>{S(w),m(`${w.currentStep} - ${w.processedRows}/${w.totalRows} filas`,"progress")},[m]),E=async()=>{if(!(!a||!o))try{d(_.RUNNING),A(Date.now()),S({progress:0,processedRows:0,totalRows:a.statistics.validRows,currentStep:"Iniciando..."}),D([]),M(0),j(null),m("🚀 Iniciando migración de datos...","info"),m(`📊 Total de filas válidas a procesar: ${a.statistics.validRows}`,"info"),a.statistics.newVehicles.length>0&&m(`🚛 Se crearán ${a.statistics.newVehicles.length} vehículos nuevos`,"info"),a.statistics.newProducts.length>0&&m(`⛽ Se crearán ${a.statistics.newProducts.length} productos nuevos`,"info");const w=await ee.executeMigration(a,t,f);w.success?(d(_.COMPLETED),k(w.executionResult),m("✅ Migración completada exitosamente","success"),m(`📈 Estadísticas finales: ${w.executionResult.statistics.successfulRows} movimientos creados`,"success"),n(w.executionResult)):(d(_.FAILED),m(`❌ Error en migración: ${w.error}`,"error"))}catch(w){console.error("Error ejecutando migración:",w),d(_.FAILED),m(`❌ Error inesperado: ${w.message}`,"error")}},U=()=>{d(_.PAUSED),m("⏸️ Ejecución pausada por el usuario","warning")},q=()=>{d(_.RUNNING),m("▶️ Reanudando ejecución...","info")},K=()=>{d(_.CANCELLED),m("🛑 Ejecución cancelada por el usuario","warning"),y.current&&clearInterval(y.current)},g=()=>{d(_.READY),k(null),S({progress:0,processedRows:0,totalRows:0,currentStep:""}),A(null),M(0),j(null),D([])},l=()=>{const w={executionResult:u,logs:z,progress:b,elapsedTime:C,exportedAt:new Date().toISOString()},$=new Blob([JSON.stringify(w,null,2)],{type:"application/json"}),V=URL.createObjectURL($),X=document.createElement("a");X.href=V,X.download=`migracion_logs_${Date.now()}.json`,X.click(),URL.revokeObjectURL(V)},p=w=>{const $=Math.floor(w/1e3),V=Math.floor($/60),X=Math.floor(V/60);return X>0?`${X}h ${V%60}m ${$%60}s`:V>0?`${V}m ${$%60}s`:`${$}s`},v=x.useMemo(()=>{if(!u||!C)return null;const w=u.statistics.processedRows/(C/1e3),$=u.statistics.totalRows>0?u.statistics.successfulRows/u.statistics.totalRows*100:0;return{rowsPerSecond:Math.round(w*100)/100,successRate:Math.round($*100)/100,totalTime:p(C),averageTimePerRow:Math.round(C/u.statistics.processedRows*100)/100}},[u,C]),L=()=>e.jsx("div",{className:"pre-execution",children:e.jsxs("div",{className:"execution-summary",children:[e.jsx("h3",{children:"🚀 ¿Listo para ejecutar la migración?"}),e.jsxs("p",{children:["Se procesarán ",e.jsxs("strong",{children:[a.statistics.validRows," filas válidas"]})," y se crearán los siguientes elementos:"]}),e.jsxs("div",{className:"summary-grid",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx(ce,{size:24}),e.jsxs("div",{children:[e.jsx("h4",{children:a.statistics.validRows}),e.jsx("p",{children:"Movimientos de combustible"})]})]}),a.statistics.newVehicles.length>0&&e.jsxs("div",{className:"summary-item",children:[e.jsx(ve,{size:24}),e.jsxs("div",{children:[e.jsx("h4",{children:a.statistics.newVehicles.length}),e.jsx("p",{children:"Vehículos nuevos"})]})]}),a.statistics.newProducts.length>0&&e.jsxs("div",{className:"summary-item",children:[e.jsx(me,{size:24}),e.jsxs("div",{children:[e.jsx("h4",{children:a.statistics.newProducts.length}),e.jsx("p",{children:"Productos nuevos"})]})]})]}),e.jsxs("div",{className:"execution-warning",children:[e.jsx(J,{size:20}),e.jsxs("div",{children:[e.jsx("h4",{children:"⚠️ Importante"}),e.jsxs("p",{children:["Esta acción ",e.jsx("strong",{children:"modificará permanentemente"})," la base de datos. Asegúrate de que la validación sea correcta."]})]})]}),e.jsxs("div",{className:"execution-actions",children:[e.jsxs("button",{className:"btn-secondary",onClick:()=>s(4),children:[e.jsx(de,{size:16}),"Volver a validación"]}),e.jsxs("button",{className:"btn-primary",onClick:E,disabled:!o,children:[e.jsx(xe,{size:16}),"Ejecutar migración"]})]})]})}),O=()=>e.jsxs("div",{className:"execution-progress",children:[e.jsxs("div",{className:"progress-header",children:[e.jsxs("div",{className:"progress-status",children:[e.jsx(is,{size:24,className:"status-icon running"}),e.jsxs("div",{className:"status-content",children:[e.jsx("h3",{children:"Migración en progreso..."}),e.jsx("p",{children:b.currentStep})]})]}),e.jsxs("div",{className:"progress-controls",children:[r===_.RUNNING&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-icon",onClick:U,children:e.jsx(Ts,{size:16})}),e.jsx("button",{className:"btn-icon danger",onClick:K,children:e.jsx(Xs,{size:16})})]}),r===_.PAUSED&&e.jsxs("button",{className:"btn-primary",onClick:q,children:[e.jsx(xe,{size:16}),"Reanudar"]})]})]}),e.jsxs("div",{className:"main-progress",children:[e.jsxs("div",{className:"progress-info",children:[e.jsxs("span",{children:[b.processedRows," / ",b.totalRows," filas procesadas"]}),e.jsxs("span",{children:[Math.round(b.progress),"%"]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${b.progress}%`}})})]}),e.jsxs("div",{className:"real-time-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx(js,{size:16}),e.jsxs("span",{children:["Tiempo transcurrido: ",p(C)]})]}),h!==null&&e.jsxs("div",{className:"stat-item",children:[e.jsx(Oe,{size:16}),e.jsxs("span",{children:["Tiempo estimado restante: ",p(h)]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx(ge,{size:16}),e.jsxs("span",{children:["Velocidad: ",Math.round(b.processedRows/(C/1e3)*10)/10," filas/seg"]})]})]}),e.jsxs("div",{className:"execution-logs",children:[e.jsxs("div",{className:"logs-header",children:[e.jsxs("h4",{children:[e.jsx(fe,{size:16}),"Registro de ejecución"]}),e.jsxs("button",{className:"btn-secondary",onClick:()=>B(!T),children:[T?"Ocultar":"Mostrar"," detalles"]})]}),e.jsx("div",{className:`logs-container ${T?"detailed":"compact"}`,children:z.slice(-10).map(w=>e.jsxs("div",{className:`log-entry ${w.type}`,children:[e.jsx("span",{className:"log-time",children:w.timestamp.toLocaleTimeString("es-CO")}),e.jsx("span",{className:"log-message",children:w.message})]},w.id))})]})]}),Y=()=>{const w=r===_.COMPLETED,$=u?.statistics;return e.jsxs("div",{className:"execution-results",children:[e.jsxs("div",{className:"results-header",children:[e.jsxs("div",{className:"results-status",children:[w?e.jsx(H,{size:48,className:"success"}):e.jsx(F,{size:48,className:"error"}),e.jsxs("div",{className:"status-content",children:[e.jsx("h3",{children:w?"🎉 ¡Migración completada exitosamente!":"❌ Migración falló"}),e.jsx("p",{children:w?`Se procesaron ${$?.processedRows||0} filas con ${$?.successfulRows||0} movimientos creados`:"La migración no pudo completarse. Revisa los errores para más información."})]})]}),e.jsxs("div",{className:"results-actions",children:[e.jsxs("button",{className:"btn-secondary",onClick:l,children:[e.jsx(Le,{size:16}),"Exportar logs"]}),e.jsxs("button",{className:"btn-secondary",onClick:g,children:[e.jsx(Vs,{size:16}),"Nueva migración"]}),e.jsxs("button",{className:"btn-primary",onClick:()=>window.location.href="/combustibles",children:[e.jsx(As,{size:16}),"Ir al sistema"]})]})]}),w&&$&&e.jsxs("div",{className:"results-stats",children:[e.jsx("h4",{children:"📊 Estadísticas finales"}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(H,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:$.successfulRows}),e.jsx("p",{children:"Movimientos creados"})]})]}),e.jsxs("div",{className:"stat-card info",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(ve,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:$.newVehiclesCreated}),e.jsx("p",{children:"Vehículos creados"})]})]}),e.jsxs("div",{className:"stat-card info",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(me,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:$.newProductsCreated}),e.jsx("p",{children:"Productos creados"})]})]}),$.failedRows>0&&e.jsxs("div",{className:"stat-card warning",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(J,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:$.failedRows}),e.jsx("p",{children:"Filas fallidas"})]})]})]}),v&&e.jsxs("div",{className:"performance-stats",children:[e.jsx("h5",{children:"⚡ Rendimiento"}),e.jsxs("div",{className:"performance-grid",children:[e.jsxs("div",{className:"perf-item",children:[e.jsx("span",{className:"perf-label",children:"Tiempo total:"}),e.jsx("span",{className:"perf-value",children:v.totalTime})]}),e.jsxs("div",{className:"perf-item",children:[e.jsx("span",{className:"perf-label",children:"Velocidad promedio:"}),e.jsxs("span",{className:"perf-value",children:[v.rowsPerSecond," filas/seg"]})]}),e.jsxs("div",{className:"perf-item",children:[e.jsx("span",{className:"perf-label",children:"Tasa de éxito:"}),e.jsxs("span",{className:"perf-value",children:[v.successRate,"%"]})]}),e.jsxs("div",{className:"perf-item",children:[e.jsx("span",{className:"perf-label",children:"Tiempo por fila:"}),e.jsxs("span",{className:"perf-value",children:[v.averageTimePerRow,"ms"]})]})]})]})]}),u?.errors&&u.errors.length>0&&e.jsxs("div",{className:"results-issues",children:[e.jsx("h4",{children:"❌ Errores encontrados"}),e.jsxs("div",{className:"issues-list",children:[u.errors.slice(0,10).map((V,X)=>e.jsx("div",{className:"issue-item error",children:V},X)),u.errors.length>10&&e.jsxs("div",{className:"issue-item info",children:["... y ",u.errors.length-10," errores más"]})]})]}),e.jsxs("div",{className:"complete-logs",children:[e.jsx("h4",{children:"📋 Registro completo"}),e.jsx("div",{className:"logs-container",children:z.map(V=>e.jsxs("div",{className:`log-entry ${V.type}`,children:[e.jsx("span",{className:"log-time",children:V.timestamp.toLocaleTimeString("es-CO")}),e.jsx("span",{className:"log-message",children:V.message})]},V.id))})]})]})};return e.jsxs("div",{className:"execution-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(se,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Ejecución de migración"}),e.jsxs("p",{children:[r===_.READY&&"Confirma la ejecución para procesar los datos validados.",r===_.RUNNING&&"La migración está en progreso. No cierres esta ventana.",r===_.COMPLETED&&"Migración completada. Revisa los resultados.",r===_.FAILED&&"La migración falló. Revisa los errores reportados.",r===_.CANCELLED&&"Migración cancelada por el usuario."]})]})]}),r===_.READY&&L(),(r===_.RUNNING||r===_.PAUSED)&&O(),(r===_.COMPLETED||r===_.FAILED||r===_.CANCELLED)&&Y(),i&&e.jsxs("div",{className:"error-message",children:[e.jsx(F,{size:20}),e.jsx("span",{children:i})]})]})},ae=[{id:P.FILE_UPLOAD,title:"Cargar Archivo",description:"Selecciona y carga tu archivo Excel o CSV",icon:Te,component:"Step1_FileUpload"},{id:P.COLUMN_MAPPING,title:"Mapear Columnas",description:"Relaciona las columnas del archivo con los campos del sistema",icon:re,component:"Step2_ColumnMapping"},{id:P.VALUE_MAPPING,title:"Mapear Valores",description:"Define alias para vehículos, productos y ubicaciones",icon:re,component:"Step3_ValueMapping"},{id:P.VALIDATION,title:"Validar Datos",description:"Verifica que todos los datos sean correctos antes de migrar",icon:H,component:"Step4_Validation"},{id:P.EXECUTION,title:"Ejecutar Migración",description:"Procesa y carga los datos en el sistema",icon:ze,component:"Step5_Execution"}],La=({isOpen:a,onClose:t,onComplete:n})=>{const[s,c]=x.useState(ee.createMigrationContext()),[o,i]=x.useState(!1),[r,d]=x.useState(null),u=x.useMemo(()=>ae.find(h=>h.id===s.step)||ae[0],[s.step]),k=x.useMemo(()=>(s.step-1)/(ae.length-1)*100,[s.step]),b=x.useMemo(()=>{switch(s.step){case P.FILE_UPLOAD:return s.fileData&&s.fileData.success;case P.COLUMN_MAPPING:{const h=["fecha","cantidad","vehiculo","producto"],j=Object.keys(s.columnMapping||{});return h.every(y=>j.includes(y))}case P.VALUE_MAPPING:return!0;case P.VALIDATION:return s.validationResult&&s.validationResult.isValid;case P.EXECUTION:return!1;default:return!1}},[s]),S=x.useMemo(()=>s.step>P.FILE_UPLOAD&&s.step!==P.EXECUTION,[s.step]),N=x.useCallback(h=>{c(j=>({...j,...h,metadata:{...j.metadata,...h.metadata}}))},[]),A=async(h,j={})=>{i(!0),d(null);try{const y=await ee.processFile(h,j);y.success?N({fileData:y,metadata:{fileName:h.name,totalRows:y.metadata.rowCount}}):d(y.error)}catch(y){console.error("Error procesando archivo:",y),d(`Error procesando archivo: ${y.message}`)}finally{i(!1)}},C=h=>{i(!0),d(null);try{const j=s.fileData?.preview?.headers||[],y=ee.configureColumnMapping(j,h);y.success?N({columnMapping:y.mapping}):d(y.error)}catch(j){console.error("Error configurando mapeo de columnas:",j),d(`Error en mapeo de columnas: ${j.message}`)}finally{i(!1)}},M=h=>{N({valueMapping:h})},z=()=>{b&&s.step<ae.length&&(N({step:s.step+1}),d(null))},D=()=>{S&&(N({step:s.step-1}),d(null))},T=()=>{s.step>P.FILE_UPLOAD?confirm("¿Estás seguro de que quieres cerrar el wizard? Se perderá el progreso actual.")&&t():t()},B=()=>{confirm("¿Estás seguro de que quieres reiniciar el wizard?")&&(c(ee.createMigrationContext()),d(null))};return a?e.jsx("div",{className:"migration-wizard-overlay",children:e.jsxs("div",{className:"migration-wizard",children:[e.jsxs("div",{className:"wizard-header",children:[e.jsxs("div",{className:"wizard-title",children:[e.jsx("h2",{children:"Asistente de Migración de Datos"}),e.jsx("p",{children:"Importa datos históricos de forma segura y validada"})]}),e.jsx("button",{className:"wizard-close",onClick:T,"aria-label":"Cerrar",children:e.jsx(le,{size:24})})]}),e.jsxs("div",{className:"wizard-progress",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${k}%`}})}),e.jsx("div",{className:"progress-steps",children:ae.map(h=>e.jsxs("div",{className:`progress-step ${s.step>h.id?"completed":s.step===h.id?"active":"pending"}`,children:[e.jsx("div",{className:"step-circle",children:s.step>h.id?e.jsx(H,{size:16}):e.jsx("span",{children:h.id})}),e.jsx("span",{className:"step-title",children:h.title})]},h.id))})]}),e.jsxs("div",{className:"wizard-content",children:[e.jsxs("div",{className:"step-header",children:[e.jsx("div",{className:"step-icon",children:e.jsx(u.icon,{size:32})}),e.jsxs("div",{className:"step-info",children:[e.jsx("h3",{children:u.title}),e.jsx("p",{children:u.description})]})]}),r&&e.jsxs("div",{className:"wizard-error",children:[e.jsx(F,{size:20}),e.jsx("span",{children:r}),e.jsx("button",{onClick:()=>d(null),children:"×"})]}),e.jsxs("div",{className:"step-content",children:[s.step===P.FILE_UPLOAD&&e.jsx(ka,{onFileProcessed:A,currentFile:s.fileData,isLoading:o,error:r}),s.step===P.COLUMN_MAPPING&&e.jsx(Sa,{fileHeaders:s.fileData?.preview?.headers||[],currentMapping:s.columnMapping,columnSuggestions:s.fileData?.columnSuggestions||{},onMappingChange:C,previewData:s.fileData?.preview?.preview||[],isLoading:o,error:r}),s.step===P.VALUE_MAPPING&&e.jsx(Ma,{mappedData:s.fileData?.data||[],columnMapping:s.columnMapping,currentValueMapping:s.valueMapping,onValueMappingChange:M,isLoading:o,error:r}),s.step===P.VALIDATION&&e.jsx(Ra,{fileData:s.fileData?.data||[],columnMapping:s.columnMapping,valueMapping:s.valueMapping,currentValidation:s.validationResult,isValidating:o,onValidationComplete:h=>N({validationResult:h}),error:r}),s.step===P.EXECUTION&&e.jsx(Aa,{validationResult:s.validationResult,valueMapping:s.valueMapping,currentExecution:s.executionResult,canExecute:s.validationResult?.isValid||!1,onExecutionComplete:h=>{N({executionResult:h}),n&&n(h)},onNavigateToStep:h=>N({step:h}),error:r})]})]}),e.jsxs("div",{className:"wizard-footer",children:[e.jsx("div",{className:"footer-left",children:e.jsx("button",{className:"btn-secondary",onClick:B,disabled:o,children:"Reiniciar"})}),e.jsxs("div",{className:"footer-right",children:[e.jsxs("button",{className:"btn-secondary",onClick:D,disabled:!S||o,children:[e.jsx(cs,{size:16}),"Anterior"]}),s.step<ae.length?e.jsxs("button",{className:"btn-primary",onClick:z,disabled:!b||o,children:["Siguiente",e.jsx(re,{size:16})]}):e.jsxs("button",{className:"btn-success",onClick:T,disabled:o,children:["Finalizar",e.jsx(H,{size:16})]})]})]}),o&&e.jsxs("div",{className:"wizard-loading",children:[e.jsx(ze,{className:"spinner",size:32}),e.jsx("p",{children:"Procesando..."})]})]})}):null};function Oa(){return e.jsx("div",{children:e.jsx(La,{})})}export{Oa as default};
