import{g as is,r as x,_ as ns,d as be,b as de,s as re,c as Re,e as rs,h as Be,i as cs,k as ls,v as os,m as ds,M as us,l as ps,j as e,R as ve}from"./index-BX0KpfFq.js";import{P as te,c as hs}from"./productsService-DdV-ueB8.js";var pe={exports:{}},he,Ae;function ms(){if(Ae)return he;Ae=1;var a="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return he=a,he}var me,ze;function xs(){if(ze)return me;ze=1;var a=ms();function i(){}function n(){}return n.resetWarningCache=i,me=function(){function s(r,c,d,u,b,N){if(N!==a){var M=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw M.name="Invariant Violation",M}}s.isRequired=s;function t(){return s}var o={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:t,element:s,elementType:s,instanceOf:t,node:s,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:n,resetWarningCache:i};return o.PropTypes=o,o},me}var Te;function gs(){return Te||(Te=1,pe.exports=xs()()),pe.exports}var vs=gs();const ce=is(vs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),fs=a=>a.replace(/^([A-Z])|[\s-_]+(\w)/g,(i,n,s)=>s?s.toUpperCase():n.toLowerCase()),De=a=>{const i=fs(a);return i.charAt(0).toUpperCase()+i.slice(1)},He=(...a)=>a.filter((i,n,s)=>!!i&&i.trim()!==""&&s.indexOf(i)===n).join(" ").trim(),Ns=a=>{for(const i in a)if(i.startsWith("aria-")||i==="role"||i==="title")return!0};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ys={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=x.forwardRef(({color:a="currentColor",size:i=24,strokeWidth:n=2,absoluteStrokeWidth:s,className:t="",children:o,iconNode:r,...c},d)=>x.createElement("svg",{ref:d,...ys,width:i,height:i,stroke:a,strokeWidth:s?Number(n)*24/Number(i):n,className:He("lucide",t),...!o&&!Ns(c)&&{"aria-hidden":"true"},...c},[...r.map(([u,b])=>x.createElement(u,b)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=(a,i)=>{const n=x.forwardRef(({className:s,...t},o)=>x.createElement(ws,{ref:o,iconNode:i,className:He(`lucide-${js(De(a))}`,`lucide-${a}`,s),...t}));return n.displayName=De(a),n};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Cs=A("activity",bs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Le=A("arrow-left",Es);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],ie=A("arrow-right",ks);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Ms=A("calendar",Ss);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],As=A("chevron-left",Rs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ts=A("chevron-right",zs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],B=A("circle-alert",Ds);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],H=A("circle-check-big",Ls);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ps=A("clock",Os);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],Oe=A("columns-2",_s);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],le=A("database",$s);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Ge=A("download",Is);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Us=A("eye-off",Vs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Z=A("eye",qs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Ce=A("file-text",Fs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],Pe=A("file",Bs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Gs=A("funnel",Hs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],Ys=A("house",Ws);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],ae=A("info",Xs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],je=A("loader",Qs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],fe=A("package",Zs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],Js=A("pause",Ks);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]],sa=A("pen-line",ea);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],Ne=A("play",aa);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],ia=A("refresh-cw",ta);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],ue=A("rotate-ccw",na);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],ca=A("save",ra);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],We=A("search",la);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],da=A("settings",oa);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],pa=A("square",ua);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Ye=A("target",ha);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],ye=A("trending-up",ma);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ee=A("triangle-alert",xa);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Xe=A("upload",ga);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],we=A("users",va);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],oe=A("x",ja);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Qe=A("zap",fa),Ze={EXCEL:["xlsx","xls"],CSV:["csv"],TEXT:["txt","tsv"]},K=(a,i=null,n=null,s={})=>({success:a,data:i,error:n,metadata:{fileName:"",fileSize:0,fileType:"",rowCount:0,columnCount:0,sheets:[],encoding:"UTF-8",...s}}),Ke=a=>{const i=a.name.split(".").pop().toLowerCase();for(const[n,s]of Object.entries(Ze))if(s.includes(i))return n;return a.type.includes("spreadsheet")||a.type.includes("excel")?"EXCEL":a.type.includes("csv")||a.type.includes("text")?"CSV":"UNKNOWN"},Je=a=>{if(!a)return{valid:!1,error:"No se proporcionÃ³ ningÃºn archivo"};if(a.size>52428800)return{valid:!1,error:"El archivo es demasiado grande (mÃ¡ximo 50MB)"};if(a.size<10)return{valid:!1,error:"El archivo estÃ¡ vacÃ­o o es demasiado pequeÃ±o"};const s=Ke(a);return s==="UNKNOWN"?{valid:!1,error:"Tipo de archivo no soportado. Use Excel (.xlsx, .xls) o CSV (.csv)"}:{valid:!0,fileType:s}},Na=async(a,i={})=>{try{const n=await ns(()=>import("./xlsx-DLvP5s0v.js"),[]),s=n.read(a,{type:"buffer",cellText:!1,cellDates:!0,...i}),t={sheets:[],data:null,metadata:{sheetNames:s.SheetNames,sheets:s.SheetNames.length}};s.SheetNames.forEach((r,c)=>{const d=s.Sheets[r],u=n.utils.sheet_to_json(d,{header:1,defval:"",blankrows:!1});if(u.length===0)return;const b=u[0]||[],N=u.slice(1),M=b.map((w,R)=>!w||w.toString().trim()===""?`Columna_${R+1}`:w.toString().trim()),C=N.filter(w=>w.some(R=>R!=null&&R!=="")).map(w=>{const R={};return M.forEach((z,D)=>{const O=w[D];O instanceof Date||typeof O=="number"?R[z]=O:typeof O=="string"?R[z]=O.trim():R[z]=O||""}),R}),E={name:r,index:c,headers:M,rowCount:C.length,columnCount:M.length,data:C,range:d["!ref"]||"A1",isEmpty:C.length===0};t.sheets.push(E)});const o=t.sheets.find(r=>!r.isEmpty)||t.sheets[0];return o&&(t.data=o.data,t.metadata.primarySheet=o.name,t.metadata.headers=o.headers,t.metadata.rowCount=o.rowCount,t.metadata.columnCount=o.columnCount),K(!0,t.data,null,t.metadata)}catch(n){return console.error("âŒ Error parsing Excel file:",n),K(!1,null,`Error procesando archivo Excel: ${n.message}`)}},ya=(a,i={})=>{try{const{delimiter:n=",",quote:s='"',skipEmptyLines:t=!0,trimValues:o=!0}=i,r=a.split(/\r?\n/);if(r.length===0)return K(!1,null,"El archivo CSV estÃ¡ vacÃ­o");const c=M=>{const C=[];let E="",w=!1,R=0;for(;R<M.length;){const z=M[R],D=M[R+1];z===s&&!w?w=!0:z===s&&w?D===s?(E+=s,R++):w=!1:z===n&&!w?(C.push(o?E.trim():E),E=""):E+=z,R++}return C.push(o?E.trim():E),C},d=r[0],u=c(d).map((M,C)=>!M||M.trim()===""?`Columna_${C+1}`:M.trim()),b=[];for(let M=1;M<r.length;M++){const C=r[M].trim();if(t&&C==="")continue;const E=c(C);if(E.every(R=>R===""))continue;const w={};u.forEach((R,z)=>{const D=E[z]||"";D!==""&&!isNaN(D)&&!isNaN(parseFloat(D))?w[R]=parseFloat(D):w[R]=D}),b.push(w)}const N={headers:u,rowCount:b.length,columnCount:u.length,delimiter:n,encoding:"UTF-8"};return K(!0,b,null,N)}catch(n){return console.error("âŒ Error parsing CSV file:",n),K(!1,null,`Error procesando archivo CSV: ${n.message}`)}},wa=async(a,i={})=>{try{const n=Je(a);if(!n.valid)return K(!1,null,n.error);const s=n.fileType,t=await a.arrayBuffer(),o={fileName:a.name,fileSize:a.size,fileType:s,lastModified:new Date(a.lastModified)};let r;switch(s){case"EXCEL":r=await Na(t,i.excel);break;case"CSV":{const c=new TextDecoder("utf-8").decode(t);r=ya(c,i.csv);break}default:return K(!1,null,`Tipo de archivo no soportado: ${s}`)}return r.success&&(r.metadata={...o,...r.metadata}),r}catch(n){return console.error("âŒ Error general parsing file:",n),K(!1,null,`Error inesperado procesando archivo: ${n.message}`)}},ba=(a,i=10)=>{if(!Array.isArray(a)||a.length===0)return{preview:[],total:0,headers:[],statistics:{}};const n=Object.keys(a[0]),s=a.slice(0,i),t={totalRows:a.length,totalColumns:n.length,emptyFields:0,dataTypes:{}};return n.forEach(o=>{const r=a.map(d=>d[o]).filter(d=>d!==""&&d!==null&&d!==void 0);if(r.length===0){t.dataTypes[o]="empty";return}const c=r[0];c instanceof Date?t.dataTypes[o]="date":typeof c=="number"?t.dataTypes[o]="number":typeof c=="boolean"?t.dataTypes[o]="boolean":t.dataTypes[o]="text"}),{preview:s,total:a.length,headers:n,statistics:t}},Ca=a=>{const i={fecha:["fecha","date","dia","day","timestamp","created","creado"],cantidad:["cantidad","qty","quantity","galones","litros","amount","volume"],vehiculo:["vehiculo","vehicle","maquina","machine","equipo","equipment","codigo","code","id"],producto:["producto","product","combustible","fuel","articulo","item","tipo"],precio:["precio","price","cost","costo","valor","value"],horometro:["horometro","horas","hours","hour_meter","lectura"],ubicacion:["ubicacion","location","lugar","place","destino","destination","origen","source"],descripcion:["descripcion","description","notes","notas","observaciones","comments"]},n={},s=a.map(t=>({original:t,normalized:t.toLowerCase().trim().replace(/[^a-z0-9]/g,"_")}));return Object.entries(i).forEach(([t,o])=>{let r=null,c=0;s.forEach(({original:d,normalized:u})=>{o.forEach(b=>{const N=Ea(u,b);N>c&&N>.6&&(c=N,r=d)})}),r&&(n[t]=r)}),n},Ea=(a,i)=>{if(a===i)return 1;if(a.includes(i)||i.includes(a))return .8;const n=a.length>i.length?a:i,s=a.length>i.length?i:a;if(n.length===0)return 1;const t=ka(n,s);return(n.length-t)/n.length},ka=(a,i)=>{const n=[];for(let s=0;s<=i.length;s++)n[s]=[s];for(let s=0;s<=a.length;s++)n[0][s]=s;for(let s=1;s<=i.length;s++)for(let t=1;t<=a.length;t++)i.charAt(s-1)===a.charAt(t-1)?n[s][t]=n[s-1][t-1]:n[s][t]=Math.min(n[s-1][t-1]+1,n[s][t-1]+1,n[s-1][t]+1);return n[i.length][a.length]},xe={parseFile:wa,getDataPreview:ba,suggestColumnMapping:Ca,validateFile:Je,detectFileType:Ke,SUPPORTED_FILE_TYPES:Ze},Ee="combustibles_migration_aliases",I={VEHICLE:"vehicle",PRODUCT:"product",LOCATION:"location",SUPPLIER:"supplier"},_e=(a,i={},n={})=>({type:a,mappings:i,metadata:{totalMappings:Object.keys(i).length,lastUsed:null,usageCount:0,...n},createdAt:re(),updatedAt:re()}),ne=async a=>{try{if(!Object.values(I).includes(a))throw new Error(`Tipo de alias invÃ¡lido: ${a}`);const i=`${a}_aliases`,n=be(de,Ee,i),s=await Be(n);return s.exists()?{id:s.id,...s.data(),createdAt:s.data().createdAt?.toDate?.()||s.data().createdAt,updatedAt:s.data().updatedAt?.toDate?.()||s.data().updatedAt,lastUsed:s.data().metadata?.lastUsed?.toDate?.()||s.data().metadata?.lastUsed}:null}catch(i){throw console.error("âŒ Error obteniendo alias:",i),new Error(`Error al obtener alias: ${i.message}`)}},ke=async(a,i,n=!0)=>{try{if(!Object.values(I).includes(a))throw new Error(`Tipo de alias invÃ¡lido: ${a}`);if(!i||typeof i!="object")throw new Error("Los mapeos deben ser un objeto vÃ¡lido");const s=`${a}_aliases`,t=be(de,Ee,s);if(n){const o=await ne(a),r=o?{...o.mappings,...i}:i,c=_e(a,r,{totalMappings:Object.keys(r).length,lastUpdated:re(),usageCount:(o?.metadata?.usageCount||0)+1});await Re(t,c,{merge:!0})}else{const o=_e(a,i);await Re(t,o)}console.log(`âœ… Alias ${a} guardados exitosamente:`,Object.keys(i).length,"mapeos")}catch(s){throw console.error("âŒ Error guardando alias:",s),new Error(`Error al guardar alias: ${s.message}`)}},es=async(a,i)=>{try{if(!i||typeof i!="string")return null;const n=await ne(a);if(!n||!n.mappings)return null;const s=n.mappings[i];if(s)return s;const t=i.toLowerCase().trim();for(const[o,r]of Object.entries(n.mappings))if(o.toLowerCase().trim()===t)return r;for(const[o,r]of Object.entries(n.mappings)){const c=o.toLowerCase().trim();if(c.includes(t)||t.includes(c))return r}return null}catch(n){return console.error("âŒ Error resolviendo alias:",n),null}},Sa=async(a,i)=>{try{const n={},s=await ss(a),t=await ne(a);for(const o of i){const r=await es(a,o);if(r){n[o]={suggested:r,confidence:1,source:"alias",alternatives:[]};continue}const c=Ta(o,s);if(c){n[o]={suggested:c.id,confidence:c.confidence,source:"direct",alternatives:[]};continue}const d=Da(o,s,3);if(d.length>0){n[o]={suggested:d[0].id,confidence:d[0].confidence,source:"fuzzy",alternatives:d.slice(1)};continue}n[o]={suggested:null,confidence:0,source:"none",alternatives:[],requiresManualMapping:!0}}return n}catch(n){throw console.error("âŒ Error obteniendo sugerencias:",n),new Error(`Error al obtener sugerencias: ${n.message}`)}},Ma=async a=>{try{const i=`${a}_aliases`,n=be(de,Ee,i);await rs(n,{"metadata.lastUsed":re(),"metadata.usageCount":(await Be(n)).data()?.metadata?.usageCount+1||1,updatedAt:re()})}catch(i){console.error("âŒ Error registrando uso de alias:",i)}},Ra=async a=>{try{const i=await ne(a);if(!i||!i.mappings)return 0;const n=await ss(a),s=new Set(n.map(r=>r.id));let t=0;const o={};for(const[r,c]of Object.entries(i.mappings))s.has(c)?o[r]=c:t++;return t>0&&(await ke(a,o,!1),console.log(`ðŸ§¹ Limpieza completada: ${t} alias eliminados para ${a}`)),t}catch(i){return console.error("âŒ Error en limpieza de alias:",i),0}},Aa=async(a=null)=>{try{const i={exportedAt:new Date().toISOString(),version:"1.0",aliases:{}},n=a?[a]:Object.values(I);for(const s of n){const t=await ne(s);t&&(i.aliases[s]=t)}return i}catch(i){throw console.error("âŒ Error exportando alias:",i),new Error(`Error al exportar alias: ${i.message}`)}},za=async(a,i=!0)=>{try{if(!a||!a.aliases)throw new Error("Formato de backup invÃ¡lido");let n=0;for(const[s,t]of Object.entries(a.aliases))Object.values(I).includes(s)&&t.mappings&&(await ke(s,t.mappings,i),n++);return console.log(`ðŸ“¥ ImportaciÃ³n completada: ${n} tipos de alias importados`),n}catch(n){throw console.error("âŒ Error importando alias:",n),new Error(`Error al importar alias: ${n.message}`)}},ss=async a=>{try{let i,n=["id"];switch(a){case I.VEHICLE:i="combustibles_vehicles",n=["vehicleId","name"];break;case I.PRODUCT:i="combustibles_products",n=["name","displayName"];break;case I.LOCATION:return[{id:"principal",name:"Principal"},{id:"bodega_austria",name:"Bodega Austria"},{id:"bodega_ilusion",name:"Bodega IlusiÃ³n"},{id:"campo_operativo",name:"Campo Operativo"},{id:"estacion_movil",name:"EstaciÃ³n MÃ³vil"}];case I.SUPPLIER:i="combustibles_suppliers",n=["name","displayName"];break;default:return[]}const s=await cs(ls(de,i)),t=[];return s.forEach(o=>{const r=o.data(),c={id:o.id};n.forEach(d=>{r[d]&&(c[d]=r[d])}),a===I.VEHICLE&&r.vehicleId&&(c.id=r.vehicleId,c.displayName=`${r.vehicleId} - ${r.name||"Sin nombre"}`),t.push(c)}),t}catch(i){return console.error("âŒ Error obteniendo datos existentes:",i),[]}},Ta=(a,i)=>{const n=a.toLowerCase().trim();for(const s of i){if(s.id.toLowerCase()===n)return{id:s.id,confidence:1};if(s.name&&s.name.toLowerCase().trim()===n)return{id:s.id,confidence:.95};if(s.displayName&&s.displayName.toLowerCase().trim()===n)return{id:s.id,confidence:.95}}return null},Da=(a,i,n=5)=>{const s=[],t=a.toLowerCase().trim();for(const o of i){const r=[o.id,o.name,o.displayName].filter(Boolean);for(const c of r){const d=c.toLowerCase().trim();if(d.includes(t)||t.includes(d)){const u=Math.max(t.length/d.length,d.length/t.length)*.8;s.push({id:o.id,confidence:u,matchedField:c});break}}}return s.sort((o,r)=>r.confidence-o.confidence).slice(0,n)},G={getAliasesByType:ne,saveAliases:ke,resolveAlias:es,getSuggestedMappings:Sa,recordAliasUsage:Ma,cleanupUnusedAliases:Ra,exportAliases:Aa,importAliases:za,ALIAS_TYPES:I},$={FILE_UPLOAD:1,COLUMN_MAPPING:2,VALUE_MAPPING:3,VALIDATION:4,EXECUTION:5},X={fecha:{required:!0,type:"date",description:"Fecha del movimiento"},cantidad:{required:!0,type:"number",description:"Cantidad de combustible"},vehiculo:{required:!0,type:"string",description:"VehÃ­culo o equipo"},producto:{required:!0,type:"string",description:"Tipo de combustible/producto"}},Se={horometro:{required:!1,type:"number",description:"Lectura del horÃ³metro"},precio:{required:!1,type:"number",description:"Precio unitario"},ubicacion:{required:!1,type:"string",description:"UbicaciÃ³n origen"},destino:{required:!1,type:"string",description:"UbicaciÃ³n destino"},descripcion:{required:!1,type:"string",description:"Notas adicionales"},proveedor:{required:!1,type:"string",description:"Proveedor (para entradas)"}},La=()=>({step:$.FILE_UPLOAD,fileData:null,columnMapping:{},valueMapping:{},validationResult:null,executionResult:null,errors:[],warnings:[],metadata:{startedAt:new Date,fileName:"",totalRows:0,processedRows:0,successfulRows:0,failedRows:0}}),Oa=async(a,i={})=>{try{console.log("ðŸ”„ Iniciando procesamiento de archivo:",a.name);const n=await xe.parseFile(a,i);if(!n.success)return{success:!1,error:n.error,data:null};const s=xe.getDataPreview(n.data,20),t=xe.suggestColumnMapping(s.headers);return{success:!0,data:n.data,metadata:n.metadata,preview:s,columnSuggestions:t,error:null}}catch(n){return console.error("âŒ Error procesando archivo:",n),{success:!1,error:n.message,data:null}}},Pa=(a,i)=>{try{const n={},s=[],t=[];return Object.entries(i).forEach(([r,c])=>{a.includes(c)&&(n[r]=c)}),Object.keys(X).forEach(r=>{n[r]||t.push(r)}),a.forEach(r=>{Object.values(n).includes(r)||s.push(r)}),{success:t.length===0,mapping:n,unmappedColumns:s,missingRequiredFields:t,warnings:s.length>0?[`${s.length} columnas no fueron mapeadas`]:[]}}catch(n){return console.error("âŒ Error configurando mapeo de columnas:",n),{success:!1,error:n.message,mapping:{}}}},_a=async(a,i)=>{try{console.log("ðŸ”„ Configurando mapeo de valores...");const n={},s={},t=i.vehiculo,o=i.producto;if(t){const c=[...new Set(a.map(u=>u[t]).filter(Boolean))],d=await G.getSuggestedMappings(I.VEHICLE,c);n.vehiculos={},s.vehiculos=d}if(o){const c=[...new Set(a.map(u=>u[o]).filter(Boolean))],d=await G.getSuggestedMappings(I.PRODUCT,c);n.productos={},s.productos=d}const r=i.ubicacion;if(r){const c=[...new Set(a.map(u=>u[r]).filter(Boolean))],d=await G.getSuggestedMappings(I.LOCATION,c);n.ubicaciones={},s.ubicaciones=d}return{success:!0,valueMapping:n,suggestions:s,error:null}}catch(n){return console.error("âŒ Error configurando mapeo de valores:",n),{success:!1,error:n.message,valueMapping:{},suggestions:{}}}},$a=async(a,i,n)=>{try{console.log("ðŸ”„ Iniciando validaciÃ³n de datos (Dry Run)...");const s={isValid:!0,errors:[],warnings:[],statistics:{totalRows:a.length,validRows:0,invalidRows:0,newVehicles:new Set,newProducts:new Set,dateRange:{min:null,max:null}},preview:[]},t=[];for(let o=0;o<a.length;o++){const r=a[o],c=o+1,d={rowNumber:c,original:r,mapped:{},errors:[],warnings:[]};try{for(const[u,b]of Object.entries(X)){const N=i[u];if(!N){d.errors.push(`Campo requerido '${u}' no mapeado`);continue}const M=r[N],C=$e(M,b,u,c);C.error?d.errors.push(C.error):d.mapped[u]=C.value}for(const[u,b]of Object.entries(Se)){const N=i[u];if(N&&r[N]!==void 0&&r[N]!==""){const M=r[N],C=$e(M,b,u,c);C.error?d.warnings.push(C.error):d.mapped[u]=C.value}}if(d.mapped.vehiculo){const u=d.mapped.vehiculo,b=n.vehiculos?.[u]||await G.resolveAlias(I.VEHICLE,u);b?d.mapped.vehiculoId=b:(s.statistics.newVehicles.add(u),d.warnings.push(`VehÃ­culo '${u}' no existe, serÃ¡ creado`),d.mapped.vehiculoId=as(u))}if(d.mapped.producto){const u=d.mapped.producto,b=n.productos?.[u]||await G.resolveAlias(I.PRODUCT,u);b?d.mapped.productoId=b:(s.statistics.newProducts.add(u),d.warnings.push(`Producto '${u}' no existe, serÃ¡ creado`),d.mapped.productoId=ts(u))}if(d.mapped.fecha){const u=d.mapped.fecha;(!s.statistics.dateRange.min||u<s.statistics.dateRange.min)&&(s.statistics.dateRange.min=u),(!s.statistics.dateRange.max||u>s.statistics.dateRange.max)&&(s.statistics.dateRange.max=u)}d.errors.length===0?s.statistics.validRows++:(s.statistics.invalidRows++,s.isValid=!1),s.errors.push(...d.errors),s.warnings.push(...d.warnings),t.push(d)}catch(u){d.errors.push(`Error procesando fila: ${u.message}`),s.statistics.invalidRows++,s.isValid=!1,t.push(d)}}return s.preview=t.slice(0,10),s.processedData=t,s.statistics.newVehicles=Array.from(s.statistics.newVehicles),s.statistics.newProducts=Array.from(s.statistics.newProducts),console.log(`âœ… ValidaciÃ³n completada: ${s.statistics.validRows}/${s.statistics.totalRows} filas vÃ¡lidas`),{success:!0,validationResult:s,error:null}}catch(s){return console.error("âŒ Error en validaciÃ³n:",s),{success:!1,error:s.message,validationResult:null}}},Ia=async(a,i,n=null)=>{try{console.log("ðŸš€ Iniciando ejecuciÃ³n de migraciÃ³n...");const s={success:!0,statistics:{totalRows:a.statistics.totalRows,processedRows:0,successfulRows:0,failedRows:0,newVehiclesCreated:0,newProductsCreated:0,movementsCreated:0},errors:[],warnings:[],migrationId:`migration_${Date.now()}`,startedAt:new Date};Object.keys(i.vehiculos||{}).length>0&&await G.saveAliases(I.VEHICLE,i.vehiculos),Object.keys(i.productos||{}).length>0&&await G.saveAliases(I.PRODUCT,i.productos);for(const r of a.statistics.newVehicles)try{const c=as(r);await os.createVehicle({vehicleId:c,name:r,type:Ua(r),fuelType:"GASOLINA",status:"activo",hasHourMeter:qa(r),currentHours:0,description:`Creado automÃ¡ticamente durante migraciÃ³n ${s.migrationId}`}),s.statistics.newVehiclesCreated++,console.log(`âœ… VehÃ­culo creado: ${c} - ${r}`)}catch(c){console.error(`âŒ Error creando vehÃ­culo ${r}:`,c),s.warnings.push(`No se pudo crear vehÃ­culo '${r}': ${c.message}`)}for(const r of a.statistics.newProducts)try{const c=ts(r);c&&!Object.values(te).includes(c)&&(await hs({name:c,displayName:r,category:"Combustible",unit:"gal",defaultPrice:0,isActive:!0,description:`Creado automÃ¡ticamente durante migraciÃ³n ${s.migrationId}`}),s.statistics.newProductsCreated++,console.log(`âœ… Producto creado: ${r}`))}catch(c){console.error(`âŒ Error creando producto ${r}:`,c),s.warnings.push(`No se pudo crear producto '${r}': ${c.message}`)}const t=100,o=a.processedData.filter(r=>r.errors.length===0);for(let r=0;r<o.length;r+=t){const c=o.slice(r,r+t);for(const d of c){try{const u=Fa(d.mapped);await ds.createMovement(u),s.statistics.successfulRows++,s.statistics.movementsCreated++}catch(u){console.error(`âŒ Error creando movimiento fila ${d.rowNumber}:`,u),s.errors.push(`Fila ${d.rowNumber}: ${u.message}`),s.statistics.failedRows++}if(s.statistics.processedRows++,n){const u=s.statistics.processedRows/o.length*100;n({progress:Math.round(u),processedRows:s.statistics.processedRows,totalRows:o.length,currentStep:`Procesando lote ${Math.floor(r/t)+1}...`})}}}return s.completedAt=new Date,s.success=s.statistics.failedRows<o.length*.1,console.log(`ðŸŽ‰ MigraciÃ³n completada: ${s.statistics.successfulRows}/${o.length} movimientos creados`),{success:!0,executionResult:s,error:null}}catch(s){return console.error("âŒ Error en ejecuciÃ³n de migraciÃ³n:",s),{success:!1,error:s.message,executionResult:null}}},$e=(a,i,n,s)=>{if(a==null||a==="")return i.required?{error:`Campo '${n}' requerido en fila ${s}`}:{value:null};switch(i.type){case"date":{const t=Va(a);return t?{value:t}:{error:`Fecha invÃ¡lida '${a}' en fila ${s}`}}case"number":{const t=parseFloat(a);return isNaN(t)||t<0?{error:`NÃºmero invÃ¡lido '${a}' en fila ${s}`}:{value:t}}case"string":return{value:a.toString().trim()};default:return{value:a}}},Va=a=>{if(a instanceof Date)return a;if(typeof a=="number"){const t=new Date((a-25569)*86400*1e3);return ge(t)?t:null}const i=a.toString().trim(),n=[/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/,/^(\d{4})-(\d{1,2})-(\d{1,2})$/,/^(\d{1,2})-(\d{1,2})-(\d{4})$/];for(const t of n){const o=i.match(t);if(o){let r,c,d;t.source.includes("YYYY")&&(t.source.startsWith("^(\\d{4})")?[,d,c,r]=o:[,r,c,d]=o);const u=new Date(parseInt(d),parseInt(c)-1,parseInt(r));return ge(u)?u:null}}const s=new Date(i);return ge(s)?s:null},ge=a=>a instanceof Date&&!isNaN(a.getTime())&&a.getFullYear()>1900,as=a=>{const i=a.toUpperCase().replace(/[^A-Z0-9]/g,"");return i.includes("TR")&&i.match(/\d/)?`TR-${i.match(/\d+/)?.[0]}`:i.includes("CAMIONETA")?i.includes("AMARILLA")?"CA-001":i.includes("BURBUJA")?"CB-001":"CM-001":i.includes("CARRO")?"CR-001":i.includes("VOLQUETA")?"VQ-001":i.includes("MOTO")?`MT-${Math.floor(Math.random()*100)}`:`${i.substring(0,2)||"EQ"}-${Math.floor(Math.random()*1e3)}`},Ua=a=>{const i=a.toLowerCase();return i.includes("tractor")||i.includes("tr-")?"tractor":i.includes("camioneta")?"pickup_truck":i.includes("carro")?"car":i.includes("volqueta")?"log_truck":i.includes("moto")?"motorcycle":i.includes("bomba")?"water_pump":i.includes("planta")?"generator":i.includes("fumigadora")?"fumigadora":i.includes("guadaÃ±a")?"guadana":i.includes("hidrolavadora")?"hidrolavadora":"otros"},qa=a=>{const i=a.toLowerCase();return i.includes("tr-")||i.includes("tractor")},ts=a=>{const i=a.toLowerCase().trim();return i.includes("gasolina")?te.GASOLINA:i.includes("acpm")?te.ACPM:i.includes("diesel")?te.ACPM:te.GASOLINA},Fa=a=>({type:ps.SALIDA,fuelType:a.productoId||te.GASOLINA,quantity:a.cantidad,unitPrice:a.precio||0,vehicleId:a.vehiculoId,location:a.ubicacion||"principal",destinationLocation:a.destino,currentHours:a.horometro,description:a.descripcion||"Migrado desde archivo histÃ³rico",effectiveDate:a.fecha,reference:`MIGRACION_${Date.now()}`,status:us.COMPLETADO}),se={createMigrationContext:La,processFile:Oa,configureColumnMapping:Pa,configureValueMapping:_a,validateData:$a,executeMigration:Ia,MIGRATION_STEPS:$,REQUIRED_FIELDS:X,OPTIONAL_FIELDS:Se},Ie=({onFileProcessed:a,currentFile:i=null,isLoading:n=!1,error:s=null})=>{const[t,o]=x.useState(!1),[r,c]=x.useState(0),[d,u]=x.useState(!1),[b,N]=x.useState({excel:{cellText:!1,cellDates:!0},csv:{delimiter:",",quote:'"',skipEmptyLines:!0,trimValues:!0}}),M=x.useRef(null),C=x.useCallback(async j=>{const p=j[0];if(p){c(0);try{const S=setInterval(()=>{c(h=>h>=90?(clearInterval(S),90):h+10)},100);await a(p,b),clearInterval(S),c(100)}catch(S){console.error("Error procesando archivo:",S)}}},[a,b]),E=x.useCallback(j=>{j.preventDefault(),o(!0)},[]),w=x.useCallback(j=>{j.preventDefault(),o(!1)},[]),R=x.useCallback(j=>{j.preventDefault(),o(!1);const p=Array.from(j.dataTransfer.files);C(p)},[C]),z=()=>{M.current?.click()},D=()=>{M.current&&(M.current.value=""),c(0),a(null)},O=j=>{if(j===0)return"0 Bytes";const p=1024,S=["Bytes","KB","MB","GB"],h=Math.floor(Math.log(j)/Math.log(p));return parseFloat((j/Math.pow(p,h)).toFixed(2))+" "+S[h]},q=j=>{switch(j.split(".").pop()?.toLowerCase()){case"xlsx":case"xls":return e.jsx(Pe,{className:"text-green-600",size:24});case"csv":return e.jsx(Ce,{className:"text-blue-600",size:24});default:return e.jsx(Pe,{className:"text-gray-600",size:24})}};return e.jsxs("div",{className:"file-upload-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(ae,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Formatos soportados"}),e.jsx("p",{children:"Excel (.xlsx, .xls) y CSV (.csv) con datos histÃ³ricos de combustibles"})]})]}),i?.success?e.jsxs("div",{className:"file-preview-card",children:[e.jsxs("div",{className:"file-header",children:[e.jsxs("div",{className:"file-info",children:[q(i.metadata.fileName),e.jsxs("div",{className:"file-details",children:[e.jsx("h4",{children:i.metadata.fileName}),e.jsxs("div",{className:"file-meta",children:[e.jsx("span",{children:O(i.metadata.fileSize)}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:i.metadata.fileType}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[i.metadata.rowCount," filas"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[i.metadata.columnCount," columnas"]})]})]})]}),e.jsxs("div",{className:"file-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>u(!d),title:"Opciones avanzadas",children:e.jsx(da,{size:16})}),e.jsx("button",{className:"btn-icon danger",onClick:D,title:"Remover archivo",children:e.jsx(oe,{size:16})})]})]}),e.jsxs("div",{className:"processing-status success",children:[e.jsx(H,{size:16}),e.jsx("span",{children:"Archivo procesado exitosamente"})]}),i.preview&&i.preview.headers.length>0&&e.jsxs("div",{className:"data-preview",children:[e.jsxs("div",{className:"preview-header",children:[e.jsx(Z,{size:16}),e.jsxs("span",{children:["Vista previa de datos (",i.preview.total," filas total)"]})]}),e.jsx("div",{className:"preview-table-container",children:e.jsxs("table",{className:"preview-table",children:[e.jsx("thead",{children:e.jsx("tr",{children:i.preview.headers.map((j,p)=>e.jsx("th",{title:j,children:j},p))})}),e.jsx("tbody",{children:i.preview.preview.map((j,p)=>e.jsx("tr",{children:i.preview.headers.map((S,h)=>e.jsx("td",{title:j[S],children:j[S]?.toString()||"â€”"},h))},p))})]})}),e.jsxs("div",{className:"preview-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Filas encontradas:"}),e.jsx("span",{className:"stat-value",children:i.preview.statistics.totalRows})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Columnas detectadas:"}),e.jsx("span",{className:"stat-value",children:i.preview.statistics.totalColumns})]})]})]}),i.columnSuggestions&&Object.keys(i.columnSuggestions).length>0&&e.jsxs("div",{className:"suggestions-preview",children:[e.jsx("h5",{children:"Mapeos sugeridos automÃ¡ticamente:"}),e.jsx("div",{className:"suggestions-grid",children:Object.entries(i.columnSuggestions).map(([j,p])=>e.jsxs("div",{className:"suggestion-item",children:[e.jsx("span",{className:"field-name",children:j}),e.jsx("span",{className:"arrow",children:"â†’"}),e.jsx("span",{className:"column-name",children:p})]},j))})]})]}):e.jsxs("div",{className:`upload-zone ${t?"drag-over":""} ${n?"loading":""}`,onDragOver:E,onDragLeave:w,onDrop:R,onClick:z,children:[e.jsx("div",{className:"upload-content",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"upload-spinner",children:e.jsx("div",{className:"spinner"})}),e.jsx("h3",{children:"Procesando archivo..."}),e.jsx("p",{children:"Analizando estructura y validando formato"}),r>0&&e.jsxs("div",{className:"progress-container",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${r}%`}})}),e.jsxs("span",{className:"progress-text",children:[r,"%"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{size:48,className:"upload-icon"}),e.jsx("h3",{children:"Arrastra tu archivo aquÃ­"}),e.jsx("p",{children:"o haz clic para seleccionar desde tu computadora"}),e.jsxs("div",{className:"supported-formats",children:[e.jsx("span",{className:"format-tag excel",children:"Excel (.xlsx, .xls)"}),e.jsx("span",{className:"format-tag csv",children:"CSV (.csv)"})]})]})}),e.jsx("input",{ref:M,type:"file",accept:".xlsx,.xls,.csv",onChange:j=>C(Array.from(j.target.files)),style:{display:"none"}})]}),d&&e.jsxs("div",{className:"advanced-options",children:[e.jsx("h4",{children:"Opciones de procesamiento"}),e.jsxs("div",{className:"option-group",children:[e.jsx("h5",{children:"Opciones Excel"}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:b.excel.cellDates,onChange:j=>N(p=>({...p,excel:{...p.excel,cellDates:j.target.checked}}))}),e.jsx("span",{children:"Convertir fechas automÃ¡ticamente"})]})]}),e.jsxs("div",{className:"option-group",children:[e.jsx("h5",{children:"Opciones CSV"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("label",{children:["Delimitador:",e.jsxs("select",{value:b.csv.delimiter,onChange:j=>N(p=>({...p,csv:{...p.csv,delimiter:j.target.value}})),children:[e.jsx("option",{value:",",children:"Coma (,)"}),e.jsx("option",{value:";",children:"Punto y coma (;)"}),e.jsx("option",{value:"\\t",children:"TabulaciÃ³n"})]})]}),e.jsxs("label",{children:["Comillas:",e.jsxs("select",{value:b.csv.quote,onChange:j=>N(p=>({...p,csv:{...p.csv,quote:j.target.value}})),children:[e.jsx("option",{value:'"',children:'Comillas dobles (")'}),e.jsx("option",{value:"'",children:"Comillas simples (')"})]})]})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:b.csv.skipEmptyLines,onChange:j=>N(p=>({...p,csv:{...p.csv,skipEmptyLines:j.target.checked}}))}),e.jsx("span",{children:"Omitir lÃ­neas vacÃ­as"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:b.csv.trimValues,onChange:j=>N(p=>({...p,csv:{...p.csv,trimValues:j.target.checked}}))}),e.jsx("span",{children:"Limpiar espacios en valores"})]})]})]}),s&&e.jsxs("div",{className:"error-message",children:[e.jsx(B,{size:20}),e.jsx("span",{children:s})]})]})},Ve=({fileHeaders:a=[],currentMapping:i={},columnSuggestions:n={},onMappingChange:s,previewData:t=[],error:o=null})=>{const[r,c]=x.useState(i),[d,u]=x.useState(null),[b,N]=x.useState(!1),[M,C]=x.useState(null);x.useEffect(()=>{Object.keys(i).length>0?c(i):Object.keys(n).length>0&&c(n)},[i,n]);const E=x.useMemo(()=>{const h=Object.keys(X).filter(F=>!r[F]),f=Object.values(r),k=a.filter(F=>!f.includes(F)),U=f.filter((F,J)=>f.indexOf(F)!==J);return{isValid:h.length===0&&U.length===0,missingRequired:h,unmappedColumns:k,duplicateColumns:U,totalMapped:Object.keys(r).length,requiredMapped:Object.keys(X).filter(F=>r[F]).length}},[r,a]),w=x.useCallback((h,f)=>{const k={...r};f?(Object.keys(k).forEach(U=>{k[U]===f&&delete k[U]}),k[h]=f):delete k[h],c(k),s(k)},[r,s]),R=()=>{c({...n}),s(n)},z=()=>{c({}),s({})},D=(h,f)=>{u(f),h.dataTransfer.effectAllowed="move"},O=(h,f)=>{h.preventDefault(),h.dataTransfer.dropEffect="move",C(f)},q=()=>{C(null)},j=(h,f)=>{h.preventDefault(),d&&w(f,d),u(null),C(null)},p=h=>X[h]?"required":"optional",S=()=>{if(!b||t.length===0)return null;const h=t.slice(0,3).map(f=>{const k={};return Object.entries(r).forEach(([U,F])=>{k[U]=f[F]}),k});return e.jsxs("div",{className:"mapping-preview",children:[e.jsxs("div",{className:"preview-header",children:[e.jsx(Z,{size:16}),e.jsx("span",{children:"Vista previa del mapeo"})]}),e.jsx("div",{className:"preview-table-container",children:e.jsxs("table",{className:"preview-table",children:[e.jsx("thead",{children:e.jsx("tr",{children:Object.keys(r).map(f=>e.jsxs("th",{children:[f,e.jsx("span",{className:`field-type ${p(f)}`,children:p(f)==="required"?"REQ":"OPT"})]},f))})}),e.jsx("tbody",{children:h.map((f,k)=>e.jsx("tr",{children:Object.keys(r).map(U=>e.jsx("td",{children:f[U]?.toString()||"â€”"},U))},k))})]})})]})};return e.jsxs("div",{className:"column-mapping-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(ae,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Mapeo de columnas"}),e.jsx("p",{children:"Relaciona las columnas de tu archivo con los campos del sistema. Los campos marcados como REQ son obligatorios."})]})]}),e.jsxs("div",{className:"mapping-status",children:[e.jsxs("div",{className:"status-grid",children:[e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-label",children:"Campos mapeados:"}),e.jsx("span",{className:"status-value",children:E.totalMapped})]}),e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-label",children:"Obligatorios:"}),e.jsxs("span",{className:`status-value ${E.requiredMapped===Object.keys(X).length?"success":"warning"}`,children:[E.requiredMapped,"/",Object.keys(X).length]})]}),e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-label",children:"Sin mapear:"}),e.jsx("span",{className:"status-value",children:E.unmappedColumns.length})]})]}),e.jsxs("div",{className:"mapping-actions",children:[e.jsxs("button",{className:"btn-secondary",onClick:R,disabled:Object.keys(n).length===0,children:[e.jsx(Qe,{size:16}),"Aplicar sugerencias"]}),e.jsxs("button",{className:"btn-secondary",onClick:z,disabled:Object.keys(r).length===0,children:[e.jsx(ue,{size:16}),"Limpiar todo"]}),e.jsxs("button",{className:"btn-secondary",onClick:()=>N(!b),disabled:Object.keys(r).length===0,children:[e.jsx(Z,{size:16}),b?"Ocultar":"Ver"," preview"]})]})]}),!E.isValid&&e.jsxs("div",{className:"validation-messages",children:[E.missingRequired.length>0&&e.jsxs("div",{className:"validation-error",children:[e.jsx(B,{size:16}),e.jsxs("span",{children:["Campos obligatorios sin mapear: ",E.missingRequired.join(", ")]})]}),E.duplicateColumns.length>0&&e.jsxs("div",{className:"validation-error",children:[e.jsx(B,{size:16}),e.jsxs("span",{children:["Columnas duplicadas: ",E.duplicateColumns.join(", ")]})]})]}),e.jsxs("div",{className:"mapping-container",children:[e.jsxs("div",{className:"file-columns",children:[e.jsxs("h3",{children:[e.jsx(Oe,{size:20}),"Columnas del archivo (",a.length,")"]}),e.jsx("div",{className:"columns-list",children:a.map((h,f)=>e.jsxs("div",{className:`column-item ${Object.values(r).includes(h)?"mapped":"unmapped"} ${d===h?"dragging":""}`,draggable:!0,onDragStart:k=>D(k,h),children:[e.jsx("span",{className:"column-name",children:h}),Object.values(r).includes(h)&&e.jsx(H,{size:14,className:"mapped-icon"})]},f))})]}),e.jsx("div",{className:"mapping-arrow",children:e.jsx(ie,{size:24})}),e.jsxs("div",{className:"system-fields",children:[e.jsxs("h3",{children:[e.jsx(Oe,{size:20}),"Campos del sistema"]}),e.jsxs("div",{className:"field-group",children:[e.jsx("h4",{children:"Campos obligatorios"}),e.jsx("div",{className:"fields-list",children:Object.entries(X).map(([h,f])=>e.jsxs("div",{className:`field-item required ${r[h]?"mapped":"unmapped"} ${M===h?"hovered":""}`,onDragOver:k=>O(k,h),onDragLeave:q,onDrop:k=>j(k,h),children:[e.jsxs("div",{className:"field-header",children:[e.jsx("span",{className:"field-name",children:h}),e.jsx("span",{className:"field-type required",children:"REQ"})]}),e.jsx("p",{className:"field-description",children:f.description}),r[h]?e.jsxs("div",{className:"mapped-column",children:[e.jsxs("span",{className:"mapped-to",children:["â†’ ",r[h]]}),e.jsx("button",{className:"unmap-btn",onClick:()=>w(h,null),children:"Ã—"})]}):e.jsx("div",{className:"unmapped-field",children:e.jsxs("select",{value:"",onChange:k=>w(h,k.target.value),className:"column-select",children:[e.jsx("option",{value:"",children:"Seleccionar columna..."}),a.filter(k=>!Object.values(r).includes(k)).map(k=>e.jsx("option",{value:k,children:k},k))]})})]},h))})]}),e.jsxs("div",{className:"field-group",children:[e.jsx("h4",{children:"Campos opcionales"}),e.jsx("div",{className:"fields-list",children:Object.entries(Se).map(([h,f])=>e.jsxs("div",{className:`field-item optional ${r[h]?"mapped":"unmapped"} ${M===h?"hovered":""}`,onDragOver:k=>O(k,h),onDragLeave:q,onDrop:k=>j(k,h),children:[e.jsxs("div",{className:"field-header",children:[e.jsx("span",{className:"field-name",children:h}),e.jsx("span",{className:"field-type optional",children:"OPT"})]}),e.jsx("p",{className:"field-description",children:f.description}),r[h]?e.jsxs("div",{className:"mapped-column",children:[e.jsxs("span",{className:"mapped-to",children:["â†’ ",r[h]]}),e.jsx("button",{className:"unmap-btn",onClick:()=>w(h,null),children:"Ã—"})]}):e.jsx("div",{className:"unmapped-field",children:e.jsxs("select",{value:"",onChange:k=>w(h,k.target.value),className:"column-select",children:[e.jsx("option",{value:"",children:"Seleccionar columna..."}),a.filter(k=>!Object.values(r).includes(k)).map(k=>e.jsx("option",{value:k,children:k},k))]})})]},h))})]})]})]}),S(),o&&e.jsxs("div",{className:"error-message",children:[e.jsx(B,{size:20}),e.jsx("span",{children:o})]})]})},Ue=({mappedData:a=[],columnMapping:i={},onValueMappingChange:n,currentValueMapping:s={},error:t=null})=>{const[o,r]=x.useState(s),[c,d]=x.useState(!1),[u,b]=x.useState("vehicle"),[N,M]=x.useState({}),[C,E]=x.useState(null),[w,R]=x.useState(""),[z,D]=x.useState(!1),[O,q]=x.useState({}),j=x.useMemo(()=>{const g=[];return Object.entries(i).forEach(([l,m])=>{l.toLowerCase().includes("vehicle")||l==="vehicleId"?g.push({systemField:l,fileColumn:m,aliasType:I.VEHICLE,displayName:"VehÃ­culos",icon:"ðŸš›",description:"Mapear nombres de vehÃ­culos a cÃ³digos del sistema"}):l.toLowerCase().includes("product")||l==="productName"?g.push({systemField:l,fileColumn:m,aliasType:I.PRODUCT,displayName:"Productos",icon:"â›½",description:"Mapear nombres de combustibles a cÃ³digos del sistema"}):l.toLowerCase().includes("location")||l==="location"?g.push({systemField:l,fileColumn:m,aliasType:I.LOCATION,displayName:"Ubicaciones",icon:"ðŸ“",description:"Mapear nombres de ubicaciones a cÃ³digos del sistema"}):(l.toLowerCase().includes("supplier")||l==="supplierName")&&g.push({systemField:l,fileColumn:m,aliasType:I.SUPPLIER,displayName:"Proveedores",icon:"ðŸ¢",description:"Mapear nombres de proveedores a cÃ³digos del sistema"})}),g},[i]),p=x.useMemo(()=>{const g={};return j.forEach(l=>{const m=a.map(v=>v[l.fileColumn]).filter(v=>v&&v.toString().trim()).map(v=>v.toString().trim());g[l.aliasType]=[...new Set(m)].sort()}),g},[a,j]);x.useEffect(()=>{(async()=>{if(Object.keys(s).length>0){r(s);return}D(!0);const l={};try{for(const m of j){const v=p[m.aliasType]||[];if(v.length>0){const T=await G.getSuggestedMappings(m.aliasType,v);l[m.aliasType]=T}}r(l),n(l)}catch(m){console.error("Error cargando sugerencias:",m)}finally{D(!1)}})()},[j,p,s,n]),x.useEffect(()=>{(async()=>{const l={};for(const m of Object.values(I))try{const v=await G.getAliasesByType(m);l[m]={totalAliases:v?.metadata?.totalMappings||0,lastUsed:v?.metadata?.lastUsed||null,usageCount:v?.metadata?.usageCount||0}}catch{l[m]={totalAliases:0,lastUsed:null,usageCount:0}}q(l)})()},[]);const S=x.useMemo(()=>{const g={};let l=0,m=0;return j.forEach(v=>{const T=p[v.aliasType]||[],L=o[v.aliasType]||{},W=T.filter(P=>L[P]?.suggested&&L[P].suggested!==null),y=T.filter(P=>!L[P]?.suggested||L[P].suggested===null);g[v.aliasType]={total:T.length,mapped:W.length,unmapped:y.length,mappedValues:W,unmappedValues:y,percentage:T.length>0?W.length/T.length*100:100},l+=W.length,m+=y.length}),{byType:g,overall:{totalMapped:l,totalUnmapped:m,percentage:l+m>0?l/(l+m)*100:100}}},[j,p,o]),h=x.useCallback(async(g,l,m)=>{const v={...o};if(v[g]||(v[g]={}),v[g][l]={suggested:m,confidence:1,source:"manual",alternatives:[]},r(v),n(v),m)try{await G.saveAliases(g,{[l]:m})}catch(T){console.error("Error guardando alias:",T)}},[o,n]),f=async()=>{D(!0);try{const g={};for(const l of j){const m=p[l.aliasType]||[];if(m.length>0){const v=await G.getSuggestedMappings(l.aliasType,m);g[l.aliasType]=v}}r(g),n(g)}catch(g){console.error("Error aplicando sugerencias:",g)}finally{D(!1)}},k=()=>{r({}),n({})},U=async()=>{if(!(!C||!w.trim()))try{await h(C.aliasType,C.inputValue,w.trim()),E(null),R("")}catch(g){console.error("Error guardando alias:",g)}},F=g=>{const l=p[g]||[],m=N[g]||"";return m.trim()?l.filter(v=>v.toLowerCase().includes(m.toLowerCase())):l},J=()=>{if(!c||a.length===0)return null;const g=a.slice(0,5).map(l=>{const m={...l};return j.forEach(v=>{const T=l[v.fileColumn],L=o[v.aliasType]?.[T];L?.suggested&&(m[`${v.fileColumn}_mapped`]=L.suggested)}),m});return e.jsxs("div",{className:"mapping-preview",children:[e.jsxs("div",{className:"preview-header",children:[e.jsx(Z,{size:16}),e.jsxs("span",{children:["Vista previa del mapeo de valores (",a.length," filas total)"]})]}),e.jsx("div",{className:"preview-table-container",children:e.jsxs("table",{className:"preview-table",children:[e.jsx("thead",{children:e.jsx("tr",{children:j.map(l=>e.jsxs(ve.Fragment,{children:[e.jsxs("th",{className:"original-column",children:[l.fileColumn," (Original)"]}),e.jsxs("th",{className:"mapped-column",children:[l.fileColumn," (Mapeado)"]})]},l.aliasType))})}),e.jsx("tbody",{children:g.map((l,m)=>e.jsx("tr",{children:j.map(v=>e.jsxs(ve.Fragment,{children:[e.jsx("td",{className:"original-value",children:l[v.fileColumn]||"â€”"}),e.jsx("td",{className:"mapped-value",children:e.jsx("span",{className:`mapped-result ${l[`${v.fileColumn}_mapped`]?"success":"pending"}`,children:l[`${v.fileColumn}_mapped`]||"Sin mapear"})})]},v.aliasType))},m))})]})})]})};return j.length===0?e.jsx("div",{className:"value-mapping-step",children:e.jsxs("div",{className:"step-info-card",children:[e.jsx(ae,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"No se requiere mapeo de valores"}),e.jsx("p",{children:"Los campos mapeados no requieren conversiÃ³n de valores. Puedes continuar al siguiente paso."})]})]})}):e.jsxs("div",{className:"value-mapping-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(ae,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Mapeo de valores"}),e.jsx("p",{children:"Convierte nombres descriptivos del archivo a cÃ³digos especÃ­ficos del sistema. Los alias se guardan para reutilizar en futuras migraciones."})]})]}),e.jsxs("div",{className:"mapping-status",children:[e.jsx("div",{className:"status-overview",children:e.jsxs("div",{className:"status-item",children:[e.jsx("span",{className:"status-label",children:"Progreso total:"}),e.jsxs("div",{className:"status-progress",children:[e.jsx("div",{className:"progress-bar",style:{width:`${S.overall.percentage}%`}}),e.jsxs("span",{className:"progress-text",children:[S.overall.totalMapped," / ",S.overall.totalMapped+S.overall.totalUnmapped,"(",Math.round(S.overall.percentage),"%)"]})]})]})}),e.jsxs("div",{className:"mapping-actions",children:[e.jsxs("button",{className:"btn-secondary",onClick:f,disabled:z,children:[e.jsx(Qe,{size:16}),z?"Cargando...":"Recargar sugerencias"]}),e.jsxs("button",{className:"btn-secondary",onClick:k,disabled:Object.keys(o).length===0,children:[e.jsx(ue,{size:16}),"Limpiar todo"]}),e.jsxs("button",{className:"btn-secondary",onClick:()=>d(!c),disabled:Object.keys(o).length===0,children:[e.jsx(Z,{size:16}),c?"Ocultar":"Ver"," preview"]})]})]}),e.jsxs("div",{className:"mapping-tabs",children:[e.jsx("div",{className:"tab-buttons",children:j.map(g=>e.jsxs("button",{className:`tab-button ${u===g.aliasType?"active":""}`,onClick:()=>b(g.aliasType),children:[e.jsx("span",{className:"tab-icon",children:g.icon}),e.jsx("span",{className:"tab-text",children:g.displayName}),e.jsxs("span",{className:"tab-badge",children:[S.byType[g.aliasType]?.mapped||0," / ",S.byType[g.aliasType]?.total||0]})]},g.aliasType))}),j.map(g=>{if(g.aliasType!==u)return null;const l=S.byType[g.aliasType],m=F(g.aliasType),v=o[g.aliasType]||{};return e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{className:"tab-header",children:[e.jsxs("div",{className:"tab-info",children:[e.jsxs("h3",{children:[g.icon," ",g.displayName]}),e.jsx("p",{children:g.description})]}),e.jsxs("div",{className:"tab-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx(Ye,{size:16}),e.jsxs("span",{children:["Progreso: ",Math.round(l?.percentage||0),"%"]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx(le,{size:16}),e.jsxs("span",{children:["Alias guardados: ",O[g.aliasType]?.totalAliases||0]})]})]})]}),e.jsxs("div",{className:"search-bar",children:[e.jsx(We,{size:16}),e.jsx("input",{type:"text",placeholder:`Buscar en ${m.length} valores de ${g.displayName.toLowerCase()}...`,value:N[g.aliasType]||"",onChange:T=>M(L=>({...L,[g.aliasType]:T.target.value}))})]}),e.jsx("div",{className:"values-mapping-list",children:m.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("span",{children:"No se encontraron valores para mapear"})}):m.map(T=>{const L=v[T],W=L?.suggested&&L.suggested!==null;return e.jsxs("div",{className:`value-mapping-item ${W?"mapped":"unmapped"}`,children:[e.jsxs("div",{className:"value-info",children:[e.jsxs("div",{className:"original-value",children:[e.jsx("span",{className:"value-text",children:T}),e.jsxs("span",{className:"value-count",children:[a.filter(y=>y[g.fileColumn]===T).length," registros"]})]}),W&&e.jsxs("div",{className:"mapped-result",children:[e.jsx(ie,{size:14}),e.jsx("span",{className:"mapped-value",children:L.suggested}),e.jsxs("span",{className:`confidence ${L.confidence>=.8?"high":L.confidence>=.5?"medium":"low"}`,children:[Math.round(L.confidence*100),"%"]}),e.jsx("span",{className:"source",children:L.source})]})]}),e.jsxs("div",{className:"value-actions",children:[L?.alternatives&&L.alternatives.length>0&&e.jsxs("select",{className:"alternatives-select",value:L.suggested||"",onChange:y=>h(g.aliasType,T,y.target.value),children:[e.jsxs("option",{value:L.suggested,children:[L.suggested," (Sugerido)"]}),L.alternatives.map(y=>e.jsxs("option",{value:y.id,children:[y.id," (",Math.round(y.confidence*100),"%)"]},y.id))]}),e.jsx("button",{className:"btn-icon",onClick:()=>{E({aliasType:g.aliasType,inputValue:T}),R(L?.suggested||"")},title:"Editar mapeo",children:e.jsx(sa,{size:14})}),W&&e.jsx("button",{className:"btn-icon danger",onClick:()=>h(g.aliasType,T,null),title:"Eliminar mapeo",children:e.jsx(oe,{size:14})})]})]},T)})})]},g.aliasType)})]}),C&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h4",{children:"Editar mapeo"}),e.jsx("button",{className:"btn-icon",onClick:()=>{E(null),R("")},children:e.jsx(oe,{size:16})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Valor original:"}),e.jsx("input",{type:"text",value:C.inputValue,disabled:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Mapear a:"}),e.jsx("input",{type:"text",value:w,onChange:g=>R(g.target.value),placeholder:"CÃ³digo del sistema (ej: V-001, DIESEL, etc.)",autoFocus:!0})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>{E(null),R("")},children:"Cancelar"}),e.jsxs("button",{className:"btn-primary",onClick:U,disabled:!w.trim(),children:[e.jsx(ca,{size:16}),"Guardar alias"]})]})]})}),J(),t&&e.jsxs("div",{className:"error-message",children:[e.jsx(B,{size:20}),e.jsx("span",{children:t})]})]})},qe=({fileData:a=[],columnMapping:i={},valueMapping:n={},onValidationComplete:s,currentValidation:t=null,isValidating:o=!1,error:r=null})=>{const[c,d]=x.useState(t),[u,b]=x.useState(!0),[N,M]=x.useState("overview"),[C,E]=x.useState("all"),[w,R]=x.useState(""),[z,D]=x.useState(1),[O]=x.useState(10),[q,j]=x.useState(new Set);x.useEffect(()=>{(async()=>{if(!t&&a.length>0&&Object.keys(i).length>0)try{const m=await se.validateData(a,i,n);m.success&&(d(m.validationResult),s(m.validationResult))}catch(m){console.error("Error en validaciÃ³n automÃ¡tica:",m)}else t&&d(t)})()},[a,i,n,t,s]);const p=async()=>{try{const l=await se.validateData(a,i,n);l.success&&(d(l.validationResult),s(l.validationResult))}catch(l){console.error("Error ejecutando validaciÃ³n:",l)}},S=x.useMemo(()=>{if(!c?.processedData)return[];let l=c.processedData;switch(C){case"valid":l=l.filter(m=>m.errors.length===0);break;case"invalid":l=l.filter(m=>m.errors.length>0);break;case"warnings":l=l.filter(m=>m.warnings.length>0);break}if(w.trim()){const m=w.toLowerCase();l=l.filter(v=>{const T=Object.values(v.original).join(" ").toLowerCase(),L=Object.values(v.mapped).join(" ").toLowerCase();return T.includes(m)||L.includes(m)})}return l},[c,C,w]),h=x.useMemo(()=>{const l=(z-1)*O;return S.slice(l,l+O)},[S,z,O]),f=x.useMemo(()=>{if(!c)return null;const l=c.statistics,m=l.totalRows>0?l.validRows/l.totalRows*100:0;return{...l,successRate:m,hasErrors:c.errors.length>0,hasWarnings:c.warnings.length>0,totalPages:Math.ceil(S.length/O)}},[c,S.length,O]),k=l=>{const m=new Set(q);m.has(l)?m.delete(l):m.add(l),j(m)},U=()=>{if(!c)return;const l={summary:f,dateRange:c.statistics.dateRange,newEntities:{vehicles:c.statistics.newVehicles,products:c.statistics.newProducts},errors:c.errors,warnings:c.warnings,exportedAt:new Date().toISOString()},m=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),v=URL.createObjectURL(m),T=document.createElement("a");T.href=v,T.download=`validacion_migracion_${Date.now()}.json`,T.click(),URL.revokeObjectURL(v)},F=()=>f?e.jsxs("div",{className:"validation-overview",children:[e.jsxs("div",{className:"main-stats-grid",children:[e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(H,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:f.validRows}),e.jsx("p",{children:"Filas vÃ¡lidas"}),e.jsxs("span",{className:"stat-percentage",children:[Math.round(f.successRate),"%"]})]})]}),e.jsxs("div",{className:"stat-card error",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(B,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:f.invalidRows}),e.jsx("p",{children:"Filas con errores"}),e.jsxs("span",{className:"stat-percentage",children:[Math.round(100-f.successRate),"%"]})]})]}),e.jsxs("div",{className:"stat-card warning",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(ee,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:c.warnings.length}),e.jsx("p",{children:"Advertencias"}),e.jsx("span",{className:"stat-note",children:"No bloquean migraciÃ³n"})]})]}),e.jsxs("div",{className:"stat-card info",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(le,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:f.totalRows}),e.jsx("p",{children:"Total de filas"}),e.jsx("span",{className:"stat-note",children:"Archivo procesado"})]})]})]}),e.jsxs("div",{className:"detailed-stats-grid",children:[e.jsxs("div",{className:"stat-group",children:[e.jsxs("h4",{children:[e.jsx(Ms,{size:16})," Rango de fechas"]}),e.jsxs("div",{className:"stat-values",children:[e.jsxs("span",{children:["Desde: ",f.dateRange.min?.toLocaleDateString("es-CO")||"N/A"]}),e.jsxs("span",{children:["Hasta: ",f.dateRange.max?.toLocaleDateString("es-CO")||"N/A"]})]})]}),e.jsxs("div",{className:"stat-group",children:[e.jsxs("h4",{children:[e.jsx(we,{size:16})," Nuevos vehÃ­culos"]}),e.jsxs("div",{className:"stat-values",children:[e.jsx("span",{className:"stat-number",children:f.newVehicles.length}),e.jsx("span",{className:"stat-detail",children:"Se crearÃ¡n automÃ¡ticamente"})]})]}),e.jsxs("div",{className:"stat-group",children:[e.jsxs("h4",{children:[e.jsx(fe,{size:16})," Nuevos productos"]}),e.jsxs("div",{className:"stat-values",children:[e.jsx("span",{className:"stat-number",children:f.newProducts.length}),e.jsx("span",{className:"stat-detail",children:"Se crearÃ¡n automÃ¡ticamente"})]})]}),e.jsxs("div",{className:"stat-group",children:[e.jsxs("h4",{children:[e.jsx(ye,{size:16})," EstimaciÃ³n"]}),e.jsxs("div",{className:"stat-values",children:[e.jsxs("span",{children:[f.validRows," movimientos"]}),e.jsx("span",{className:"stat-detail",children:"Listos para migrar"})]})]})]}),e.jsxs("div",{className:"validation-progress",children:[e.jsxs("div",{className:"progress-header",children:[e.jsx("span",{children:"Estado de validaciÃ³n"}),e.jsxs("span",{children:[f.validRows,"/",f.totalRows," filas vÃ¡lidas"]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill success",style:{width:`${f.successRate}%`}})})]})]}):null,J=()=>{const l=c?.errors||[],m=c?.warnings||[];return e.jsxs("div",{className:"errors-warnings-section",children:[l.length>0&&e.jsxs("div",{className:"message-group errors",children:[e.jsxs("h4",{children:[e.jsx(B,{size:16}),"Errores (",l.length,")"]}),e.jsxs("div",{className:"messages-list",children:[l.slice(0,20).map((v,T)=>e.jsx("div",{className:"message-item error",children:e.jsx("span",{className:"message-text",children:v})},T)),l.length>20&&e.jsx("div",{className:"message-item info",children:e.jsxs("span",{children:["... y ",l.length-20," errores mÃ¡s"]})})]})]}),m.length>0&&e.jsxs("div",{className:"message-group warnings",children:[e.jsxs("h4",{children:[e.jsx(ee,{size:16}),"Advertencias (",m.length,")"]}),e.jsxs("div",{className:"messages-list",children:[m.slice(0,20).map((v,T)=>e.jsx("div",{className:"message-item warning",children:e.jsx("span",{className:"message-text",children:v})},T)),m.length>20&&e.jsx("div",{className:"message-item info",children:e.jsxs("span",{children:["... y ",m.length-20," advertencias mÃ¡s"]})})]})]}),l.length===0&&m.length===0&&e.jsxs("div",{className:"no-issues",children:[e.jsx(H,{size:48}),e.jsx("h3",{children:"Â¡Todo perfecto!"}),e.jsx("p",{children:"No se encontraron errores ni advertencias en los datos."})]})]})},g=()=>!u||h.length===0?null:e.jsxs("div",{className:"data-preview-section",children:[e.jsxs("div",{className:"preview-controls",children:[e.jsxs("div",{className:"filter-controls",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx(Gs,{size:16}),e.jsxs("select",{value:C,onChange:l=>{E(l.target.value),D(1)},children:[e.jsxs("option",{value:"all",children:["Todas las filas (",c.processedData.length,")"]}),e.jsxs("option",{value:"valid",children:["Solo vÃ¡lidas (",f.validRows,")"]}),e.jsxs("option",{value:"invalid",children:["Con errores (",f.invalidRows,")"]}),e.jsxs("option",{value:"warnings",children:["Con advertencias (",c.warnings.length,")"]})]})]}),e.jsxs("div",{className:"search-group",children:[e.jsx(We,{size:16}),e.jsx("input",{type:"text",placeholder:"Buscar en datos...",value:w,onChange:l=>{R(l.target.value),D(1)}})]}),e.jsxs("button",{className:"btn-secondary",onClick:()=>b(!u),children:[u?e.jsx(Us,{size:16}):e.jsx(Z,{size:16}),u?"Ocultar":"Mostrar"," preview"]})]}),e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"btn-icon",onClick:()=>D(Math.max(1,z-1)),disabled:z===1,children:e.jsx(As,{size:16})}),e.jsxs("span",{className:"pagination-info",children:["PÃ¡gina ",z," de ",f.totalPages,"(",S.length," filas)"]}),e.jsx("button",{className:"btn-icon",onClick:()=>D(Math.min(f.totalPages,z+1)),disabled:z===f.totalPages,children:e.jsx(Ts,{size:16})})]})]}),e.jsx("div",{className:"preview-table-container",children:e.jsxs("table",{className:"validation-preview-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"row-number",children:"#"}),e.jsx("th",{className:"status-column",children:"Estado"}),e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"VehÃ­culo"}),e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"HorÃ³metro"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:h.map(l=>e.jsxs(ve.Fragment,{children:[e.jsxs("tr",{className:`preview-row ${l.errors.length>0?"has-errors":l.warnings.length>0?"has-warnings":"valid"}`,children:[e.jsx("td",{className:"row-number",children:l.rowNumber}),e.jsx("td",{className:"status-column",children:l.errors.length>0?e.jsxs("span",{className:"status error",children:[e.jsx(B,{size:14})," Error"]}):l.warnings.length>0?e.jsxs("span",{className:"status warning",children:[e.jsx(ee,{size:14})," Advertencia"]}):e.jsxs("span",{className:"status success",children:[e.jsx(H,{size:14})," VÃ¡lido"]})}),e.jsx("td",{children:l.mapped.fecha?.toLocaleDateString("es-CO")||"â€”"}),e.jsx("td",{children:e.jsxs("div",{className:"vehicle-cell",children:[e.jsx("span",{className:"original",children:l.original[i.vehiculo]||"â€”"}),l.mapped.vehiculoId&&e.jsxs("span",{className:"mapped",children:["â†’ ",l.mapped.vehiculoId]})]})}),e.jsx("td",{children:e.jsxs("div",{className:"product-cell",children:[e.jsx("span",{className:"original",children:l.original[i.producto]||"â€”"}),l.mapped.productoId&&e.jsxs("span",{className:"mapped",children:["â†’ ",l.mapped.productoId]})]})}),e.jsx("td",{className:"quantity-cell",children:l.mapped.cantidad||"â€”"}),e.jsx("td",{className:"hours-cell",children:l.mapped.horometro||"â€”"}),e.jsx("td",{className:"actions-cell",children:e.jsx("button",{className:"btn-icon",onClick:()=>k(l.rowNumber),title:"Ver detalles",children:e.jsx(Z,{size:14})})})]}),q.has(l.rowNumber)&&e.jsx("tr",{className:"expanded-row",children:e.jsx("td",{colSpan:"8",children:e.jsxs("div",{className:"row-details",children:[l.errors.length>0&&e.jsxs("div",{className:"row-issues errors",children:[e.jsxs("h5",{children:[e.jsx(B,{size:14})," Errores"]}),e.jsx("ul",{children:l.errors.map((m,v)=>e.jsx("li",{children:m},v))})]}),l.warnings.length>0&&e.jsxs("div",{className:"row-issues warnings",children:[e.jsxs("h5",{children:[e.jsx(ee,{size:14})," Advertencias"]}),e.jsx("ul",{children:l.warnings.map((m,v)=>e.jsx("li",{children:m},v))})]}),e.jsxs("div",{className:"mapped-data",children:[e.jsxs("h5",{children:[e.jsx(le,{size:14})," Datos mapeados"]}),e.jsx("div",{className:"mapped-fields",children:Object.entries(l.mapped).map(([m,v])=>e.jsxs("div",{className:"mapped-field",children:[e.jsxs("span",{className:"field-name",children:[m,":"]}),e.jsx("span",{className:"field-value",children:v instanceof Date?v.toLocaleDateString("es-CO"):v?.toString()||"N/A"})]},m))})]})]})})})]},l.rowNumber))})]})})]});return!c&&!o?e.jsxs("div",{className:"validation-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(ae,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"ValidaciÃ³n de datos"}),e.jsx("p",{children:"Ejecuta la validaciÃ³n para verificar que los datos estÃ¡n listos para migrar."})]})]}),e.jsx("div",{className:"validation-prompt",children:e.jsxs("div",{className:"prompt-content",children:[e.jsx(Ce,{size:48}),e.jsx("h3",{children:"Â¿Listo para validar?"}),e.jsx("p",{children:"Los datos se verificarÃ¡n antes de la migraciÃ³n final. Esto incluye:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"ValidaciÃ³n de campos obligatorios"}),e.jsx("li",{children:"VerificaciÃ³n de formatos de fecha y nÃºmeros"}),e.jsx("li",{children:"ResoluciÃ³n de alias de vehÃ­culos y productos"}),e.jsx("li",{children:"DetecciÃ³n de datos que requieren creaciÃ³n automÃ¡tica"})]}),e.jsxs("button",{className:"btn-primary",onClick:p,disabled:o,children:[e.jsx(Ne,{size:16}),o?"Validando...":"Ejecutar validaciÃ³n"]})]})})]}):o?e.jsx("div",{className:"validation-step",children:e.jsxs("div",{className:"validation-loading",children:[e.jsx("div",{className:"loading-spinner",children:e.jsx("div",{className:"spinner"})}),e.jsx("h3",{children:"Validando datos..."}),e.jsxs("p",{children:["Verificando ",a.length," filas de datos"]})]})}):e.jsxs("div",{className:"validation-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(ae,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"ValidaciÃ³n completada"}),e.jsx("p",{children:"Revisa los resultados de la validaciÃ³n antes de proceder con la migraciÃ³n final."})]})]}),e.jsxs("div",{className:"validation-status",children:[e.jsxs("div",{className:"status-header",children:[e.jsx("div",{className:"status-icon",children:c.isValid?e.jsx(H,{size:24,className:"success"}):e.jsx(B,{size:24,className:"error"})}),e.jsxs("div",{className:"status-content",children:[e.jsx("h3",{children:c.isValid?"âœ… Datos listos para migrar":"âŒ Se encontraron errores que deben corregirse"}),e.jsxs("p",{children:[f.validRows," de ",f.totalRows," filas son vÃ¡lidas (",Math.round(f.successRate),"% de Ã©xito)"]})]})]}),e.jsxs("div",{className:"validation-actions",children:[e.jsxs("button",{className:"btn-secondary",onClick:p,disabled:o,children:[e.jsx(ue,{size:16}),"Re-validar"]}),e.jsxs("button",{className:"btn-secondary",onClick:U,children:[e.jsx(Ge,{size:16}),"Exportar reporte"]})]})]}),e.jsxs("div",{className:"validation-tabs",children:[e.jsxs("div",{className:"tab-buttons",children:[e.jsxs("button",{className:`tab-button ${N==="overview"?"active":""}`,onClick:()=>M("overview"),children:[e.jsx(ye,{size:16}),"Resumen"]}),e.jsxs("button",{className:`tab-button ${N==="issues"?"active":""}`,onClick:()=>M("issues"),children:[e.jsx(ee,{size:16}),"Errores y Advertencias",c.errors.length+c.warnings.length>0&&e.jsx("span",{className:"tab-badge",children:c.errors.length+c.warnings.length})]}),e.jsxs("button",{className:`tab-button ${N==="preview"?"active":""}`,onClick:()=>M("preview"),children:[e.jsx(Z,{size:16}),"Preview de Datos"]})]}),e.jsxs("div",{className:"tab-content",children:[N==="overview"&&F(),N==="issues"&&J(),N==="preview"&&g()]})]}),r&&e.jsxs("div",{className:"error-message",children:[e.jsx(B,{size:20}),e.jsx("span",{children:r})]})]})},_={READY:"ready",RUNNING:"running",PAUSED:"paused",COMPLETED:"completed",FAILED:"failed",CANCELLED:"cancelled"},Fe=({validationResult:a,valueMapping:i={},onExecutionComplete:n,onNavigateToStep:s,currentExecution:t=null,canExecute:o=!0,error:r=null})=>{const[c,d]=x.useState(_.READY),[u,b]=x.useState(t),[N,M]=x.useState({progress:0,processedRows:0,totalRows:0,currentStep:""}),[C,E]=x.useState(null),[w,R]=x.useState(0),[z,D]=x.useState([]),[O,q]=x.useState(!1),[j,p]=x.useState(null);x.useRef(null);const S=x.useRef(null);x.useEffect(()=>{if(c===_.RUNNING&&C)return S.current=setInterval(()=>{const y=Date.now()-C;if(R(y),N.progress>0){const V=y/N.progress*100-y;p(V>0?V:0)}},1e3),()=>{S.current&&clearInterval(S.current)}},[c,C,N.progress]),x.useEffect(()=>()=>{S.current&&clearInterval(S.current)},[]);const h=x.useCallback((y,P="info")=>{const V={id:Date.now(),timestamp:new Date,message:y,type:P};D(Y=>[...Y,V])},[]),f=x.useCallback(y=>{M(y),h(`${y.currentStep} - ${y.processedRows}/${y.totalRows} filas`,"progress")},[h]),k=async()=>{if(!(!a||!o))try{d(_.RUNNING),E(Date.now()),M({progress:0,processedRows:0,totalRows:a.statistics.validRows,currentStep:"Iniciando..."}),D([]),R(0),p(null),h("ðŸš€ Iniciando migraciÃ³n de datos...","info"),h(`ðŸ“Š Total de filas vÃ¡lidas a procesar: ${a.statistics.validRows}`,"info"),a.statistics.newVehicles.length>0&&h(`ðŸš› Se crearÃ¡n ${a.statistics.newVehicles.length} vehÃ­culos nuevos`,"info"),a.statistics.newProducts.length>0&&h(`â›½ Se crearÃ¡n ${a.statistics.newProducts.length} productos nuevos`,"info");const y=await se.executeMigration(a,i,f);y.success?(d(_.COMPLETED),b(y.executionResult),h("âœ… MigraciÃ³n completada exitosamente","success"),h(`ðŸ“ˆ EstadÃ­sticas finales: ${y.executionResult.statistics.successfulRows} movimientos creados`,"success"),n(y.executionResult)):(d(_.FAILED),h(`âŒ Error en migraciÃ³n: ${y.error}`,"error"))}catch(y){console.error("Error ejecutando migraciÃ³n:",y),d(_.FAILED),h(`âŒ Error inesperado: ${y.message}`,"error")}},U=()=>{d(_.PAUSED),h("â¸ï¸ EjecuciÃ³n pausada por el usuario","warning")},F=()=>{d(_.RUNNING),h("â–¶ï¸ Reanudando ejecuciÃ³n...","info")},J=()=>{d(_.CANCELLED),h("ðŸ›‘ EjecuciÃ³n cancelada por el usuario","warning"),S.current&&clearInterval(S.current)},g=()=>{d(_.READY),b(null),M({progress:0,processedRows:0,totalRows:0,currentStep:""}),E(null),R(0),p(null),D([])},l=()=>{const y={executionResult:u,logs:z,progress:N,elapsedTime:w,exportedAt:new Date().toISOString()},P=new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),V=URL.createObjectURL(P),Y=document.createElement("a");Y.href=V,Y.download=`migracion_logs_${Date.now()}.json`,Y.click(),URL.revokeObjectURL(V)},m=y=>{const P=Math.floor(y/1e3),V=Math.floor(P/60),Y=Math.floor(V/60);return Y>0?`${Y}h ${V%60}m ${P%60}s`:V>0?`${V}m ${P%60}s`:`${P}s`},v=x.useMemo(()=>{if(!u||!w)return null;const y=u.statistics.processedRows/(w/1e3),P=u.statistics.totalRows>0?u.statistics.successfulRows/u.statistics.totalRows*100:0;return{rowsPerSecond:Math.round(y*100)/100,successRate:Math.round(P*100)/100,totalTime:m(w),averageTimePerRow:Math.round(w/u.statistics.processedRows*100)/100}},[u,w]),T=()=>e.jsx("div",{className:"pre-execution",children:e.jsxs("div",{className:"execution-summary",children:[e.jsx("h3",{children:"ðŸš€ Â¿Listo para ejecutar la migraciÃ³n?"}),e.jsxs("p",{children:["Se procesarÃ¡n ",e.jsxs("strong",{children:[a.statistics.validRows," filas vÃ¡lidas"]})," y se crearÃ¡n los siguientes elementos:"]}),e.jsxs("div",{className:"summary-grid",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx(le,{size:24}),e.jsxs("div",{children:[e.jsx("h4",{children:a.statistics.validRows}),e.jsx("p",{children:"Movimientos de combustible"})]})]}),a.statistics.newVehicles.length>0&&e.jsxs("div",{className:"summary-item",children:[e.jsx(we,{size:24}),e.jsxs("div",{children:[e.jsx("h4",{children:a.statistics.newVehicles.length}),e.jsx("p",{children:"VehÃ­culos nuevos"})]})]}),a.statistics.newProducts.length>0&&e.jsxs("div",{className:"summary-item",children:[e.jsx(fe,{size:24}),e.jsxs("div",{children:[e.jsx("h4",{children:a.statistics.newProducts.length}),e.jsx("p",{children:"Productos nuevos"})]})]})]}),e.jsxs("div",{className:"execution-warning",children:[e.jsx(ee,{size:20}),e.jsxs("div",{children:[e.jsx("h4",{children:"âš ï¸ Importante"}),e.jsxs("p",{children:["Esta acciÃ³n ",e.jsx("strong",{children:"modificarÃ¡ permanentemente"})," la base de datos. AsegÃºrate de que la validaciÃ³n sea correcta."]})]})]}),e.jsxs("div",{className:"execution-actions",children:[e.jsxs("button",{className:"btn-secondary",onClick:()=>s(4),children:[e.jsx(ue,{size:16}),"Volver a validaciÃ³n"]}),e.jsxs("button",{className:"btn-primary",onClick:k,disabled:!o,children:[e.jsx(Ne,{size:16}),"Ejecutar migraciÃ³n"]})]})]})}),L=()=>e.jsxs("div",{className:"execution-progress",children:[e.jsxs("div",{className:"progress-header",children:[e.jsxs("div",{className:"progress-status",children:[e.jsx(Cs,{size:24,className:"status-icon running"}),e.jsxs("div",{className:"status-content",children:[e.jsx("h3",{children:"MigraciÃ³n en progreso..."}),e.jsx("p",{children:N.currentStep})]})]}),e.jsxs("div",{className:"progress-controls",children:[c===_.RUNNING&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-icon",onClick:U,children:e.jsx(Js,{size:16})}),e.jsx("button",{className:"btn-icon danger",onClick:J,children:e.jsx(pa,{size:16})})]}),c===_.PAUSED&&e.jsxs("button",{className:"btn-primary",onClick:F,children:[e.jsx(Ne,{size:16}),"Reanudar"]})]})]}),e.jsxs("div",{className:"main-progress",children:[e.jsxs("div",{className:"progress-info",children:[e.jsxs("span",{children:[N.processedRows," / ",N.totalRows," filas procesadas"]}),e.jsxs("span",{children:[Math.round(N.progress),"%"]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${N.progress}%`}})})]}),e.jsxs("div",{className:"real-time-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx(Ps,{size:16}),e.jsxs("span",{children:["Tiempo transcurrido: ",m(w)]})]}),j!==null&&e.jsxs("div",{className:"stat-item",children:[e.jsx(Ye,{size:16}),e.jsxs("span",{children:["Tiempo estimado restante: ",m(j)]})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx(ye,{size:16}),e.jsxs("span",{children:["Velocidad: ",Math.round(N.processedRows/(w/1e3)*10)/10," filas/seg"]})]})]}),e.jsxs("div",{className:"execution-logs",children:[e.jsxs("div",{className:"logs-header",children:[e.jsxs("h4",{children:[e.jsx(Ce,{size:16}),"Registro de ejecuciÃ³n"]}),e.jsxs("button",{className:"btn-secondary",onClick:()=>q(!O),children:[O?"Ocultar":"Mostrar"," detalles"]})]}),e.jsx("div",{className:`logs-container ${O?"detailed":"compact"}`,children:z.slice(-10).map(y=>e.jsxs("div",{className:`log-entry ${y.type}`,children:[e.jsx("span",{className:"log-time",children:y.timestamp.toLocaleTimeString("es-CO")}),e.jsx("span",{className:"log-message",children:y.message})]},y.id))})]})]}),W=()=>{const y=c===_.COMPLETED,P=u?.statistics;return e.jsxs("div",{className:"execution-results",children:[e.jsxs("div",{className:"results-header",children:[e.jsxs("div",{className:"results-status",children:[y?e.jsx(H,{size:48,className:"success"}):e.jsx(B,{size:48,className:"error"}),e.jsxs("div",{className:"status-content",children:[e.jsx("h3",{children:y?"ðŸŽ‰ Â¡MigraciÃ³n completada exitosamente!":"âŒ MigraciÃ³n fallÃ³"}),e.jsx("p",{children:y?`Se procesaron ${P?.processedRows||0} filas con ${P?.successfulRows||0} movimientos creados`:"La migraciÃ³n no pudo completarse. Revisa los errores para mÃ¡s informaciÃ³n."})]})]}),e.jsxs("div",{className:"results-actions",children:[e.jsxs("button",{className:"btn-secondary",onClick:l,children:[e.jsx(Ge,{size:16}),"Exportar logs"]}),e.jsxs("button",{className:"btn-secondary",onClick:g,children:[e.jsx(ia,{size:16}),"Nueva migraciÃ³n"]}),e.jsxs("button",{className:"btn-primary",onClick:()=>window.location.href="/combustibles",children:[e.jsx(Ys,{size:16}),"Ir al sistema"]})]})]}),y&&P&&e.jsxs("div",{className:"results-stats",children:[e.jsx("h4",{children:"ðŸ“Š EstadÃ­sticas finales"}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(H,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:P.successfulRows}),e.jsx("p",{children:"Movimientos creados"})]})]}),e.jsxs("div",{className:"stat-card info",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(we,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:P.newVehiclesCreated}),e.jsx("p",{children:"VehÃ­culos creados"})]})]}),e.jsxs("div",{className:"stat-card info",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(fe,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:P.newProductsCreated}),e.jsx("p",{children:"Productos creados"})]})]}),P.failedRows>0&&e.jsxs("div",{className:"stat-card warning",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(ee,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:P.failedRows}),e.jsx("p",{children:"Filas fallidas"})]})]})]}),v&&e.jsxs("div",{className:"performance-stats",children:[e.jsx("h5",{children:"âš¡ Rendimiento"}),e.jsxs("div",{className:"performance-grid",children:[e.jsxs("div",{className:"perf-item",children:[e.jsx("span",{className:"perf-label",children:"Tiempo total:"}),e.jsx("span",{className:"perf-value",children:v.totalTime})]}),e.jsxs("div",{className:"perf-item",children:[e.jsx("span",{className:"perf-label",children:"Velocidad promedio:"}),e.jsxs("span",{className:"perf-value",children:[v.rowsPerSecond," filas/seg"]})]}),e.jsxs("div",{className:"perf-item",children:[e.jsx("span",{className:"perf-label",children:"Tasa de Ã©xito:"}),e.jsxs("span",{className:"perf-value",children:[v.successRate,"%"]})]}),e.jsxs("div",{className:"perf-item",children:[e.jsx("span",{className:"perf-label",children:"Tiempo por fila:"}),e.jsxs("span",{className:"perf-value",children:[v.averageTimePerRow,"ms"]})]})]})]})]}),u?.errors&&u.errors.length>0&&e.jsxs("div",{className:"results-issues",children:[e.jsx("h4",{children:"âŒ Errores encontrados"}),e.jsxs("div",{className:"issues-list",children:[u.errors.slice(0,10).map((V,Y)=>e.jsx("div",{className:"issue-item error",children:V},Y)),u.errors.length>10&&e.jsxs("div",{className:"issue-item info",children:["... y ",u.errors.length-10," errores mÃ¡s"]})]})]}),e.jsxs("div",{className:"complete-logs",children:[e.jsx("h4",{children:"ðŸ“‹ Registro completo"}),e.jsx("div",{className:"logs-container",children:z.map(V=>e.jsxs("div",{className:`log-entry ${V.type}`,children:[e.jsx("span",{className:"log-time",children:V.timestamp.toLocaleTimeString("es-CO")}),e.jsx("span",{className:"log-message",children:V.message})]},V.id))})]})]})};return e.jsxs("div",{className:"execution-step",children:[e.jsxs("div",{className:"step-info-card",children:[e.jsx(ae,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{children:"EjecuciÃ³n de migraciÃ³n"}),e.jsxs("p",{children:[c===_.READY&&"Confirma la ejecuciÃ³n para procesar los datos validados.",c===_.RUNNING&&"La migraciÃ³n estÃ¡ en progreso. No cierres esta ventana.",c===_.COMPLETED&&"MigraciÃ³n completada. Revisa los resultados.",c===_.FAILED&&"La migraciÃ³n fallÃ³. Revisa los errores reportados.",c===_.CANCELLED&&"MigraciÃ³n cancelada por el usuario."]})]})]}),c===_.READY&&T(),(c===_.RUNNING||c===_.PAUSED)&&L(),(c===_.COMPLETED||c===_.FAILED||c===_.CANCELLED)&&W(),r&&e.jsxs("div",{className:"error-message",children:[e.jsx(B,{size:20}),e.jsx("span",{children:r})]})]})},Q=[{id:$.FILE_UPLOAD,title:"Cargar Archivo",description:"Selecciona y carga tu archivo Excel o CSV",icon:Xe,component:"Step1_FileUpload"},{id:$.COLUMN_MAPPING,title:"Mapear Columnas",description:"Relaciona las columnas del archivo con los campos del sistema",icon:ie,component:"Step2_ColumnMapping"},{id:$.VALUE_MAPPING,title:"Mapear Valores",description:"Define alias para vehÃ­culos, productos y ubicaciones",icon:ie,component:"Step3_ValueMapping"},{id:$.VALIDATION,title:"Validar Datos",description:"Verifica que todos los datos sean correctos antes de migrar",icon:H,component:"Step4_Validation"},{id:$.EXECUTION,title:"Ejecutar MigraciÃ³n",description:"Procesa y carga los datos en el sistema",icon:je,component:"Step5_Execution"}],Me=({isOpen:a,onClose:i,onComplete:n,isFullPage:s=!1})=>{const[t,o]=x.useState(se.createMigrationContext()),[r,c]=x.useState(!1),[d,u]=x.useState(null),b=x.useMemo(()=>Q.find(p=>p.id===t.step)||Q[0],[t.step]),N=x.useMemo(()=>(t.step-1)/(Q.length-1)*100,[t.step]),M=x.useMemo(()=>{switch(t.step){case $.FILE_UPLOAD:return t.fileData&&t.fileData.success;case $.COLUMN_MAPPING:{const p=["fecha","cantidad","vehiculo","producto"],S=Object.keys(t.columnMapping||{});return p.every(h=>S.includes(h))}case $.VALUE_MAPPING:return!0;case $.VALIDATION:return t.validationResult&&t.validationResult.isValid;case $.EXECUTION:return!1;default:return!1}},[t]),C=x.useMemo(()=>t.step>$.FILE_UPLOAD&&t.step!==$.EXECUTION,[t.step]),E=x.useCallback(p=>{o(S=>({...S,...p,metadata:{...S.metadata,...p.metadata}}))},[]),w=async(p,S={})=>{c(!0),u(null);try{const h=await se.processFile(p,S);h.success?E({fileData:h,metadata:{fileName:p.name,totalRows:h.metadata.rowCount}}):u(h.error)}catch(h){u(`Error procesando archivo: ${h.message}`)}finally{c(!1)}},R=p=>{c(!0),u(null);try{const S=t.fileData?.preview?.headers||[],h=se.configureColumnMapping(S,p);h.success?E({columnMapping:h.mapping}):u(h.error)}catch(S){u(`Error en mapeo de columnas: ${S.message}`)}finally{c(!1)}},z=p=>{E({valueMapping:p})},D=()=>{M&&t.step<Q.length&&(E({step:t.step+1}),u(null))},O=()=>{C&&(E({step:t.step-1}),u(null))},q=()=>{i&&i()},j=()=>{o(se.createMigrationContext()),u(null)};return a?s?e.jsxs("div",{className:"migration-wizard migration-wizard-fullpage",children:[e.jsx("div",{className:"wizard-header",children:e.jsxs("div",{className:"wizard-title",children:[e.jsx("h2",{children:"Asistente de MigraciÃ³n de Datos"}),e.jsx("p",{children:"Importa datos histÃ³ricos de forma segura y validada"})]})}),e.jsxs("div",{className:"wizard-progress",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${N}%`}})}),e.jsx("div",{className:"progress-steps",children:Q.map(p=>e.jsxs("div",{className:`progress-step ${t.step>p.id?"completed":t.step===p.id?"active":"pending"}`,children:[e.jsx("div",{className:"step-circle",children:t.step>p.id?e.jsx(H,{size:16}):e.jsx("span",{children:p.id})}),e.jsx("span",{className:"step-title",children:p.title})]},p.id))})]}),e.jsxs("div",{className:"wizard-content",children:[e.jsxs("div",{className:"step-header",children:[e.jsx("div",{className:"step-icon",children:e.jsx(b.icon,{size:32})}),e.jsxs("div",{className:"step-info",children:[e.jsx("h3",{children:b.title}),e.jsx("p",{children:b.description})]})]}),d&&e.jsxs("div",{className:"wizard-error",children:[e.jsx(B,{size:20}),e.jsx("span",{children:d}),e.jsx("button",{onClick:()=>u(null),children:"Ã—"})]}),e.jsxs("div",{className:"step-content",children:[t.step===$.FILE_UPLOAD&&e.jsx(Ie,{onFileProcessed:w,currentFile:t.fileData,isLoading:r,error:d}),t.step===$.COLUMN_MAPPING&&e.jsx(Ve,{fileHeaders:t.fileData?.preview?.headers||[],currentMapping:t.columnMapping,columnSuggestions:t.fileData?.columnSuggestions||{},onMappingChange:R,previewData:t.fileData?.preview?.preview||[],isLoading:r,error:d}),t.step===$.VALUE_MAPPING&&e.jsx(Ue,{mappedData:t.fileData?.data||[],columnMapping:t.columnMapping,currentValueMapping:t.valueMapping,onValueMappingChange:z,isLoading:r,error:d}),t.step===$.VALIDATION&&e.jsx(qe,{fileData:t.fileData?.data||[],columnMapping:t.columnMapping,valueMapping:t.valueMapping,currentValidation:t.validationResult,isValidating:r,onValidationComplete:p=>E({validationResult:p}),error:d}),t.step===$.EXECUTION&&e.jsx(Fe,{validationResult:t.validationResult,valueMapping:t.valueMapping,currentExecution:t.executionResult,canExecute:t.validationResult?.isValid||!1,onExecutionComplete:p=>{E({executionResult:p}),n&&n(p)},onNavigateToStep:p=>E({step:p}),error:d})]})]}),e.jsxs("div",{className:"wizard-footer",children:[e.jsx("div",{className:"footer-left",children:e.jsx("button",{className:"btn-secondary",onClick:j,disabled:r,children:"Reiniciar"})}),e.jsxs("div",{className:"footer-right",children:[e.jsxs("button",{className:"btn-secondary",onClick:O,disabled:!C||r,children:[e.jsx(Le,{size:16}),"Anterior"]}),t.step<Q.length?e.jsxs("button",{className:"btn-primary",onClick:D,disabled:!M||r,children:["Siguiente",e.jsx(ie,{size:16})]}):e.jsxs("button",{className:"btn-success",onClick:q,disabled:r,children:["Finalizar",e.jsx(H,{size:16})]})]})]}),r&&e.jsxs("div",{className:"wizard-loading",children:[e.jsx(je,{className:"spinner",size:32}),e.jsx("p",{children:"Procesando..."})]})]}):e.jsx("div",{className:"migration-wizard-overlay",children:e.jsxs("div",{className:"migration-wizard",children:[e.jsxs("div",{className:"wizard-header",children:[e.jsxs("div",{className:"wizard-title",children:[e.jsx("h2",{children:"Asistente de MigraciÃ³n de Datos"}),e.jsx("p",{children:"Importa datos histÃ³ricos de forma segura y validada"})]}),e.jsx("button",{className:"wizard-close",onClick:q,"aria-label":"Cerrar",children:e.jsx(oe,{size:24})})]}),e.jsxs("div",{className:"wizard-progress",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${N}%`}})}),e.jsx("div",{className:"progress-steps",children:Q.map(p=>e.jsxs("div",{className:`progress-step ${t.step>p.id?"completed":t.step===p.id?"active":"pending"}`,children:[e.jsx("div",{className:"step-circle",children:t.step>p.id?e.jsx(H,{size:16}):e.jsx("span",{children:p.id})}),e.jsx("span",{className:"step-title",children:p.title})]},p.id))})]}),e.jsxs("div",{className:"wizard-content",children:[e.jsxs("div",{className:"step-header",children:[e.jsx("div",{className:"step-icon",children:e.jsx(b.icon,{size:32})}),e.jsxs("div",{className:"step-info",children:[e.jsx("h3",{children:b.title}),e.jsx("p",{children:b.description})]})]}),d&&e.jsxs("div",{className:"wizard-error",children:[e.jsx(B,{size:20}),e.jsx("span",{children:d}),e.jsx("button",{onClick:()=>u(null),children:"Ã—"})]}),e.jsxs("div",{className:"step-content",children:[t.step===$.FILE_UPLOAD&&e.jsx(Ie,{onFileProcessed:w,currentFile:t.fileData,isLoading:r,error:d}),t.step===$.COLUMN_MAPPING&&e.jsx(Ve,{fileHeaders:t.fileData?.preview?.headers||[],currentMapping:t.columnMapping,columnSuggestions:t.fileData?.columnSuggestions||{},onMappingChange:R,previewData:t.fileData?.preview?.preview||[],isLoading:r,error:d}),t.step===$.VALUE_MAPPING&&e.jsx(Ue,{mappedData:t.fileData?.data||[],columnMapping:t.columnMapping,currentValueMapping:t.valueMapping,onValueMappingChange:z,isLoading:r,error:d}),t.step===$.VALIDATION&&e.jsx(qe,{fileData:t.fileData?.data||[],columnMapping:t.columnMapping,valueMapping:t.valueMapping,currentValidation:t.validationResult,isValidating:r,onValidationComplete:p=>E({validationResult:p}),error:d}),t.step===$.EXECUTION&&e.jsx(Fe,{validationResult:t.validationResult,valueMapping:t.valueMapping,currentExecution:t.executionResult,canExecute:t.validationResult?.isValid||!1,onExecutionComplete:p=>{E({executionResult:p}),n&&n(p)},onNavigateToStep:p=>E({step:p}),error:d})]})]}),e.jsxs("div",{className:"wizard-footer",children:[e.jsx("div",{className:"footer-left",children:e.jsx("button",{className:"btn-secondary",onClick:j,disabled:r,children:"Reiniciar"})}),e.jsxs("div",{className:"footer-right",children:[e.jsxs("button",{className:"btn-secondary",onClick:O,disabled:!C||r,children:[e.jsx(Le,{size:16}),"Anterior"]}),t.step<Q.length?e.jsxs("button",{className:"btn-primary",onClick:D,disabled:!M||r,children:["Siguiente",e.jsx(ie,{size:16})]}):e.jsxs("button",{className:"btn-success",onClick:q,disabled:r,children:["Finalizar",e.jsx(H,{size:16})]})]})]}),r&&e.jsxs("div",{className:"wizard-loading",children:[e.jsx(je,{className:"spinner",size:32}),e.jsx("p",{children:"Procesando..."})]})]})}):null};Me.propTypes={isOpen:ce.bool.isRequired,onClose:ce.func.isRequired,onComplete:ce.func,isFullPage:ce.bool};Me.defaultProps={isFullPage:!1,onComplete:null};function Ga(){return e.jsxs("div",{className:"migration-page-wrapper",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"MigraciÃ³n de Datos"}),e.jsx("p",{children:"Importa datos histÃ³ricos de combustibles de forma segura y validada"})]}),e.jsx("div",{className:"migration-content",children:e.jsx(Me,{isOpen:!0,isFullPage:!0,onClose:()=>{},onComplete:()=>{}})})]})}export{Ga as default};
