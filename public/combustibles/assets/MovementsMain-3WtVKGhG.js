import{j as e,f as V,a as B,l as i,M as F,r as p,O as M,z as $,A as se,B as ae,u as ee,C as te,D as ie,E as ne,G as le,H as ce}from"./index-BQoCA6St.js";import{g as re}from"./productsService-Dg4KaRGU.js";const oe=({stats:s,filters:m})=>{if(!s)return null;const k=(c,t)=>t===0?c>0?100:0:((c-t)/t*100).toFixed(1),f=c=>{switch(c){case i.ENTRADA:return"#10b981";case i.SALIDA:return"#ef4444";case i.TRANSFERENCIA:return"#3b82f6";case i.AJUSTE:return"#f59e0b";default:return"#6b7280"}},h=c=>{switch(c){case i.ENTRADA:return"📥";case i.SALIDA:return"📤";case i.TRANSFERENCIA:return"🔄";case i.AJUSTE:return"⚖️";default:return"📋"}},y=k(s.thisMonth,s.lastMonth);return e.jsxs("div",{className:"movements-stats",children:[e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card primary",children:[e.jsx("div",{className:"stat-icon",children:"📊"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:V(s.totalMovements)}),e.jsx("div",{className:"stat-label",children:"Total Movimientos"}),e.jsxs("div",{className:"stat-trend",children:[e.jsxs("span",{className:`trend ${y>=0?"positive":"negative"}`,children:[y>=0?"📈":"📉"," ",Math.abs(y),"%"]}),e.jsx("span",{className:"trend-label",children:"vs mes anterior"})]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"💰"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:B(s.totalValue)}),e.jsx("div",{className:"stat-label",children:"Valor Total"}),e.jsxs("div",{className:"stat-secondary",children:["Promedio: ",B(s.averageValue)]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"⛽"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:V(s.totalQuantity)}),e.jsx("div",{className:"stat-label",children:"Galones Total"}),e.jsxs("div",{className:"stat-secondary",children:["Promedio: ",V(s.totalQuantity/(s.totalMovements||1))," gal/mov"]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"📅"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:V(s.thisWeek)}),e.jsx("div",{className:"stat-label",children:"Esta Semana"}),e.jsxs("div",{className:"stat-secondary",children:[V(s.thisMonth)," este mes"]})]})]})]}),e.jsxs("div",{className:"stats-breakdown",children:[e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h4",{children:"📋 Por Tipo de Movimiento"}),e.jsx("div",{className:"breakdown-grid",children:Object.entries(s.byType).map(([c,t])=>{const j=(t/s.totalMovements*100).toFixed(1);return e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-header",children:[e.jsx("span",{className:"breakdown-icon",children:h(c)}),e.jsx("span",{className:"breakdown-label",children:c.charAt(0).toUpperCase()+c.slice(1)})]}),e.jsx("div",{className:"breakdown-value",children:t}),e.jsx("div",{className:"breakdown-bar",children:e.jsx("div",{className:"breakdown-fill",style:{width:`${j}%`,backgroundColor:f(c)}})}),e.jsxs("div",{className:"breakdown-percentage",children:[j,"%"]})]},c)})})]}),e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h4",{children:"⚡ Por Estado"}),e.jsx("div",{className:"breakdown-grid",children:Object.entries(s.byStatus).map(([c,t])=>{const j=(t/s.totalMovements*100).toFixed(1),x=l=>{switch(l){case F.COMPLETADO:return"#10b981";case F.PENDIENTE:return"#f59e0b";case F.CANCELADO:return"#ef4444";default:return"#6b7280"}},N=l=>{switch(l){case F.COMPLETADO:return"✅";case F.PENDIENTE:return"⏳";case F.CANCELADO:return"❌";default:return"❓"}};return e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-header",children:[e.jsx("span",{className:"breakdown-icon",children:N(c)}),e.jsx("span",{className:"breakdown-label",children:c.charAt(0).toUpperCase()+c.slice(1)})]}),e.jsx("div",{className:"breakdown-value",children:t}),e.jsx("div",{className:"breakdown-bar",children:e.jsx("div",{className:"breakdown-fill",style:{width:`${j}%`,backgroundColor:x(c)}})}),e.jsxs("div",{className:"breakdown-percentage",children:[j,"%"]})]},c)})})]}),e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h4",{children:"⛽ Por Tipo de Combustible"}),e.jsx("div",{className:"breakdown-grid",children:Object.entries(s.byFuelType).map(([c,t])=>{const j=(t/s.totalMovements*100).toFixed(1),x=N=>{switch(N?.toLowerCase()){case"diesel":return"🚛";case"gasolina":return"🚗";case"lubricante":return"🛢️";default:return"⛽"}};return e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-header",children:[e.jsx("span",{className:"breakdown-icon",children:x(c)}),e.jsx("span",{className:"breakdown-label",children:c})]}),e.jsx("div",{className:"breakdown-value",children:t}),e.jsx("div",{className:"breakdown-bar",children:e.jsx("div",{className:"breakdown-fill",style:{width:`${j}%`,backgroundColor:"#059669"}})}),e.jsxs("div",{className:"breakdown-percentage",children:[j,"%"]})]},c)})})]})]}),(m.type||m.status||m.fuelType||m.vehicleId)&&e.jsxs("div",{className:"active-filters",children:[e.jsx("h4",{children:"🔍 Filtros Activos"}),e.jsxs("div",{className:"filters-list",children:[m.type&&e.jsxs("span",{className:"filter-tag",children:["Tipo: ",m.type]}),m.status&&e.jsxs("span",{className:"filter-tag",children:["Estado: ",m.status]}),m.fuelType&&e.jsxs("span",{className:"filter-tag",children:["Combustible: ",m.fuelType]}),m.vehicleId&&e.jsxs("span",{className:"filter-tag",children:["Vehículo: ",m.vehicleId]})]})]})]})},de=({filters:s,onFilterChange:m,onClearFilters:k,searchTerm:f,onSearchChange:h,totalResults:y})=>{const[c,t]=p.useState(!1),j=[{value:"Diesel",label:"Diesel 🚛"},{value:"Gasolina",label:"Gasolina 🚗"},{value:"Lubricante",label:"Lubricante 🛢️"}],x=[{value:"all",label:"Todos los períodos"},{value:"today",label:"Hoy"},{value:"week",label:"Esta semana"},{value:"month",label:"Este mes"},{value:"quarter",label:"Este trimestre"},{value:"year",label:"Este año"}],N=Object.values(s).filter(d=>d&&d!==""&&d!=="all").length,l=(d,E)=>{m({[d]:E})},b=d=>{m(d)};return e.jsxs("div",{className:"movements-filters",children:[e.jsxs("div",{className:"filters-main",children:[e.jsx("div",{className:"search-section",children:e.jsxs("div",{className:"search-box",children:[e.jsx("span",{className:"search-icon",children:"🔍"}),e.jsx("input",{type:"text",placeholder:"Buscar por combustible, vehículo, referencia...",value:f,onChange:d=>h(d.target.value),className:"search-input"}),f&&e.jsx("button",{className:"search-clear",onClick:()=>h(""),title:"Limpiar búsqueda",children:"✕"})]})}),e.jsxs("div",{className:"filters-controls",children:[e.jsxs("div",{className:"quick-filters",children:[e.jsx("button",{className:`quick-filter ${s.type===i.ENTRADA?"active":""}`,onClick:()=>b({type:i.ENTRADA}),children:"📥 Entradas"}),e.jsx("button",{className:`quick-filter ${s.type===i.SALIDA?"active":""}`,onClick:()=>b({type:i.SALIDA}),children:"📤 Salidas"}),e.jsx("button",{className:`quick-filter ${s.status===F.PENDIENTE?"active":""}`,onClick:()=>b({status:F.PENDIENTE}),children:"⏳ Pendientes"})]}),e.jsxs("button",{className:`btn-advanced-filters ${c?"active":""}`,onClick:()=>t(!c),children:["🎛️ Filtros",N>0&&e.jsx("span",{className:"filters-count",children:N})]}),e.jsx("div",{className:"view-indicator",children:e.jsx("span",{className:"view-info",children:"📋 Vista Tabla"})})]})]}),c&&e.jsxs("div",{className:"filters-advanced",children:[e.jsxs("div",{className:"filters-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Tipo de Movimiento"}),e.jsxs("select",{value:s.type,onChange:d=>l("type",d.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"Todos los tipos"}),e.jsx("option",{value:i.ENTRADA,children:"📥 Entrada"}),e.jsx("option",{value:i.SALIDA,children:"📤 Salida"}),e.jsx("option",{value:i.TRANSFERENCIA,children:"🔄 Transferencia"}),e.jsx("option",{value:i.AJUSTE,children:"⚖️ Ajuste"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Estado"}),e.jsxs("select",{value:s.status,onChange:d=>l("status",d.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:F.PENDIENTE,children:"⏳ Pendiente"}),e.jsx("option",{value:F.COMPLETADO,children:"✅ Completado"}),e.jsx("option",{value:F.CANCELADO,children:"❌ Cancelado"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Tipo de Combustible"}),e.jsxs("select",{value:s.fuelType,onChange:d=>l("fuelType",d.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"Todos los combustibles"}),j.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Período"}),e.jsx("select",{value:s.dateRange,onChange:d=>l("dateRange",d.target.value),className:"filter-select",children:x.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Vehículo/Equipo"}),e.jsx("input",{type:"text",placeholder:"ID del vehículo...",value:s.vehicleId,onChange:d=>l("vehicleId",d.target.value),className:"filter-input"})]})]}),e.jsxs("div",{className:"filters-actions",children:[e.jsx("button",{className:"btn-clear-filters",onClick:k,disabled:N===0,children:"🗑️ Limpiar Filtros"}),e.jsxs("div",{className:"filters-info",children:[e.jsxs("span",{className:"results-count",children:[y," resultado",y!==1?"s":""]}),N>0&&e.jsxs("span",{className:"active-filters-text",children:["(",N," filtro",N!==1?"s":""," activo",N!==1?"s":"",")"]})]})]})]}),e.jsx("div",{className:"keyboard-shortcuts",style:{display:"none"},children:e.jsx("small",{children:"💡 Atajos: Ctrl+F (buscar), Ctrl+1 (entradas), Ctrl+2 (salidas), Ctrl+3 (pendientes)"})})]})},ue=({movements:s,onEdit:m,onView:k,onApprove:f,onReject:h,onDelete:y,userRole:c})=>{const[t,j]=p.useState("createdAt"),[x,N]=p.useState("desc"),l=n=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(n),b=n=>n?(n instanceof Date?n:new Date(n)).toLocaleDateString("es-CO",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):"Sin fecha",d=n=>{switch(n){case i.ENTRADA:return"📥";case i.SALIDA:return"📤";case i.TRANSFERENCIA:return"🔄";case i.AJUSTE:return"⚖️";default:return"📋"}},E=n=>{switch(n?.toLowerCase()){case"diesel":return"🚛";case"gasolina":return"🚗";case"lubricante":return"🛢️";default:return"⛽"}},w=n=>{switch(n){case F.COMPLETADO:return"✅";case F.PENDIENTE:return"⏳";case F.CANCELADO:return"❌";default:return"❓"}},C=n=>{switch(n){case F.COMPLETADO:return"status-completado";case F.PENDIENTE:return"status-pendiente";case F.CANCELADO:return"status-cancelado";default:return"status-default"}},a=n=>{t===n?N(x==="asc"?"desc":"asc"):(j(n),N("asc"))},r=[...s].sort((n,u)=>{let g=n[t],S=u[t];return(t.includes("Date")||t.includes("At"))&&(g=new Date(g),S=new Date(S)),typeof g=="number"&&typeof S=="number"?x==="asc"?g-S:S-g:typeof g=="string"&&typeof S=="string"?x==="asc"?g.localeCompare(S):S.localeCompare(g):g instanceof Date&&S instanceof Date?x==="asc"?g-S:S-g:0}),v=n=>t!==n?"↕️":x==="asc"?"↑":"↓";return e.jsxs("div",{className:"movements-table-container",children:[e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"movements-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{className:"sortable",onClick:()=>a("type"),children:["Tipo ",v("type")]}),e.jsxs("th",{className:"sortable",onClick:()=>a("fuelType"),children:["Combustible ",v("fuelType")]}),e.jsxs("th",{className:"sortable text-right",onClick:()=>a("quantity"),children:["Cantidad ",v("quantity")]}),e.jsxs("th",{className:"sortable text-right",onClick:()=>a("unitPrice"),children:["Precio/Gal ",v("unitPrice")]}),e.jsxs("th",{className:"sortable text-right",onClick:()=>a("totalValue"),children:["Valor Total ",v("totalValue")]}),e.jsx("th",{children:"Vehículo"}),e.jsx("th",{children:"Ubicación"}),e.jsxs("th",{className:"sortable",onClick:()=>a("status"),children:["Estado ",v("status")]}),e.jsxs("th",{className:"sortable",onClick:()=>a("createdAt"),children:["Fecha ",v("createdAt")]}),e.jsx("th",{className:"actions-column",children:"Acciones"})]})}),e.jsx("tbody",{children:r.map(n=>e.jsxs("tr",{className:`movement-row ${n.status===F.PENDIENTE?"pending-row":""}`,children:[e.jsx("td",{className:"type-cell",children:e.jsxs("div",{className:"type-content",children:[e.jsx("span",{className:"type-icon",children:d(n.type)}),e.jsx("span",{className:"type-text",children:n.type?n.type.charAt(0).toUpperCase()+n.type.slice(1):"Sin tipo"})]})}),e.jsx("td",{className:"fuel-cell",children:e.jsxs("div",{className:"fuel-content",children:[e.jsx("span",{className:"fuel-icon",children:E(n.fuelType)}),e.jsx("span",{className:"fuel-text",children:n.fuelType})]})}),e.jsxs("td",{className:"quantity-cell text-right",children:[e.jsx("span",{className:"quantity-value",children:n.quantity}),e.jsx("span",{className:"quantity-unit",children:"gal"})]}),e.jsx("td",{className:"price-cell text-right",children:l(n.unitPrice)}),e.jsx("td",{className:"value-cell text-right",children:e.jsx("strong",{children:l(n.totalValue)})}),e.jsx("td",{className:"vehicle-cell",children:n.vehicleId?e.jsxs("span",{className:"vehicle-id",children:["🚜 ",n.vehicleId]}):e.jsx("span",{className:"no-vehicle",children:"-"})}),e.jsx("td",{className:"location-cell",children:e.jsxs("span",{className:"location-text",children:["📍 ",n.type===i.ENTRADA?n.destinationLocation||"Sin ubicación":n.location||"Principal"]})}),e.jsx("td",{className:"status-cell",children:e.jsxs("div",{className:`status-badge ${C(n.status)}`,children:[e.jsx("span",{className:"status-icon",children:w(n.status)}),e.jsx("span",{className:"status-text",children:n.status?n.status.charAt(0).toUpperCase()+n.status.slice(1):"Sin estado"})]})}),e.jsx("td",{className:"date-cell",children:e.jsxs("div",{className:"date-content",children:[e.jsx("span",{className:"date-value",children:b(n.createdAt)}),n.reference&&e.jsxs("span",{className:"reference-small",children:["#",n.reference]})]})}),e.jsx("td",{className:"actions-cell",children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn-action btn-view",onClick:()=>k(n),title:"Ver detalles",children:"👁️"}),c==="admin"&&n.status===F.PENDIENTE&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-action btn-approve",onClick:()=>f(n.id),title:"Aprobar movimiento",children:"✓"}),e.jsx("button",{className:"btn-action btn-reject",onClick:()=>h(n.id),title:"Rechazar movimiento",children:"✗"})]}),m&&n.status===F.PENDIENTE&&e.jsx("button",{className:"btn-action btn-edit",onClick:()=>m(n),title:"Editar movimiento",children:"✏️"}),c==="admin"&&e.jsx("button",{className:"btn-action btn-delete",onClick:()=>{window.confirm("¿Estás seguro de que deseas eliminar este movimiento? Esta acción no se puede deshacer.")&&y(n.id)},title:"Eliminar movimiento",children:"🗑️"})]})})]},n.id))})]})}),e.jsxs("div",{className:"table-info",children:[e.jsxs("div",{className:"table-summary",children:[e.jsxs("span",{className:"total-rows",children:[s.length," movimiento",s.length!==1?"s":""]}),t&&e.jsxs("span",{className:"sort-info",children:["Ordenado por ",t," (",x==="asc"?"ascendente":"descendente",")"]})]}),e.jsxs("div",{className:"table-legend",children:[e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-icon",children:"⏳"})," Pendiente"]}),e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-icon",children:"✅"})," Completado"]}),e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-icon",children:"❌"})," Cancelado"]})]})]})]})},me=({movements:s,onEdit:m,onView:k,onApprove:f,onReject:h,onDelete:y,userRole:c})=>e.jsx(ue,{movements:s,onEdit:m,onView:k,onApprove:f,onReject:h,onDelete:y,userRole:c}),_=({formData:s,updateFormData:m,setError:k,isActive:f})=>{const h=[{type:i.ENTRADA,icon:"📥",title:"Entrada de Combustible",description:"Registrar combustible que llega de proveedores",color:"entrada",details:"Para compras, reabastecimientos y recepciones"},{type:i.SALIDA,icon:"⛽",title:"Salida de Combustible",description:"Asignar combustible a vehículos y equipos",color:"salida",details:"Para consumo y operaciones de campo"},{type:i.TRANSFERENCIA,icon:"🔄",title:"Transferencia",description:"Mover combustible entre ubicaciones",color:"transferencia",details:"Entre tanques, sitios o almacenes"},{type:i.AJUSTE,icon:"⚖️",title:"Ajuste de Inventario",description:"Corregir stock por diferencias o calibraciones",color:"ajuste",details:"Para mermas, pérdidas o correcciones"}],y=p.useCallback(c=>{m("type",c),k("")},[m,k]);return p.useEffect(()=>{if(!f)return;const c=t=>{const j=parseInt(t.key);if(j>=1&&j<=4){const x=h[j-1];y(x.type)}};return window.addEventListener("keypress",c),()=>window.removeEventListener("keypress",c)},[f,y,h]),e.jsx("div",{className:`wizard-step step-movement-type ${f?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h2",{children:"🌿 ¡Hola! ¿Qué operación necesitas registrar hoy?"}),e.jsx("p",{children:"Selecciona el tipo de movimiento que vas a realizar"})]}),e.jsx("div",{className:"typeform-options",children:h.map(c=>e.jsxs("div",{className:`typeform-option ${s.type===c.type?"selected":""} ${c.color}`,onClick:()=>y(c.type),children:[e.jsx("div",{className:"typeform-option-icon",children:c.icon}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsx("h4",{children:c.title}),e.jsx("p",{children:c.description})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"✓"})})})]},c.type))}),s.type&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card",children:[e.jsx("span",{className:"confirmation-icon",children:h.find(c=>c.type===s.type)?.icon}),e.jsxs("div",{className:"confirmation-text",children:[e.jsx("strong",{children:"Perfecto! Has seleccionado:"})," ",h.find(c=>c.type===s.type)?.title,e.jsx("br",{}),e.jsx("small",{children:h.find(c=>c.type===s.type)?.details})]})]})})]})})},pe=({formData:s,updateFormData:m,setError:k,isActive:f})=>{const[h,y]=p.useState(""),c=p.useRef(null),t=()=>new Date().toISOString().slice(0,16);if(p.useEffect(()=>{f&&c.current&&s.type===i.SALIDA&&setTimeout(()=>c.current.focus(),300)},[f,s.type]),p.useEffect(()=>{!s.effectiveDate&&s.type===i.SALIDA&&m("effectiveDate",t())},[s.effectiveDate,s.type,m]),s.type!==i.SALIDA)return null;const j=x=>{if(y(""),k(""),x){const N=new Date(x),l=new Date;if(N>l){y("La fecha no puede ser futura");return}const b=new Date;if(b.setFullYear(l.getFullYear()-1),N<b){y("La fecha no puede ser anterior a un año");return}}m("effectiveDate",x)};return e.jsx("div",{className:`wizard-step step-date ${f?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h2",{children:"📅 ¿Cuándo se realizó el consumo de combustible?"}),e.jsx("p",{children:"Selecciona la fecha y hora del movimiento de salida"})]}),e.jsxs("div",{className:"typeform-input-section",children:[e.jsx("input",{ref:c,type:"datetime-local",value:s.effectiveDate||t(),onChange:x=>j(x.target.value),className:`typeform-input date-input ${h?"error":""}`,max:new Date().toISOString().slice(0,16),autoComplete:"off"}),h&&e.jsx("div",{className:"validation-warning",children:h}),e.jsx("div",{className:"input-help",children:e.jsx("small",{children:"💡 Usa la fecha y hora exacta del consumo"})})]}),s.effectiveDate&&!h&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card",children:[e.jsx("span",{className:"confirmation-icon",children:"📅"}),e.jsxs("div",{className:"confirmation-text",children:[e.jsx("strong",{children:"Fecha registrada"}),e.jsx("br",{}),e.jsx("small",{children:new Date(s.effectiveDate).toLocaleString("es-CO",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})}),e.jsxs("div",{className:"quick-actions",children:[e.jsx("button",{type:"button",className:"quick-action-btn",onClick:()=>j(t()),children:"🕐 Ahora"}),e.jsx("button",{type:"button",className:"quick-action-btn",onClick:()=>{const x=new Date;x.setDate(x.getDate()-1),j(x.toISOString().slice(0,16))},children:"📅 Ayer"})]})]})})},J=({formData:s,updateFormData:m,systemData:k,setError:f,isActive:h})=>{const[y,c]=p.useState(!1),[t,j]=p.useState(null),{products:x}=k,N=p.useCallback(async(l,b)=>{c(!0),f("");try{await new Promise(d=>setTimeout(d,800)),m("fuelType",l),j(b),b.defaultPrice&&m("unitPrice",b.defaultPrice.toString()),console.log("🔄 [Step2] Combustible seleccionado:",l,"Precio:",b.defaultPrice)}catch(d){console.error("Error al cargar combustible:",d),f("Error al cargar información del combustible")}finally{c(!1)}},[m,f]);return p.useEffect(()=>{if(s.fuelType&&x.length>0){const l=x.find(b=>b.name===s.fuelType||b.displayName===s.fuelType);j(l),l&&l.defaultPrice&&!s.unitPrice&&m("unitPrice",l.defaultPrice.toString())}},[s.fuelType,s.unitPrice,x,m]),p.useEffect(()=>{if(!h)return;const l=b=>{const d=parseInt(b.key);if(d>=1&&d<=x.length){const E=x[d-1];N(E.name,E)}};return window.addEventListener("keypress",l),()=>window.removeEventListener("keypress",l)},[h,x,N]),x.length===0?e.jsx("div",{className:`wizard-step step-fuel-type ${h?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h2",{children:"⛽ Crear producto diesel manualmente"}),e.jsx("p",{children:"No hay productos disponibles. Creemos uno temporalmente."})]}),e.jsx("div",{className:"typeform-options",children:e.jsxs("div",{className:"typeform-option",onClick:()=>N("DIESEL",{name:"DIESEL",displayName:"Diesel 🚛",icon:"🚛",description:"Combustible diesel para vehículos pesados",defaultPrice:12500}),children:[e.jsx("div",{className:"typeform-option-icon",children:"🚛"}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsx("h4",{children:"Diesel 🚛"}),e.jsx("p",{children:"Combustible diesel para vehículos pesados"}),e.jsx("div",{className:"fuel-price",children:e.jsx("span",{className:"price-value",children:"$12,500 COP/galón"})})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"✓"})})})]})})]})}):e.jsx("div",{className:`wizard-step step-fuel-type ${h?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h2",{children:"⛽ ¿Qué tipo de combustible necesitas?"}),e.jsx("p",{children:"Elige el producto que vas a mover"})]}),y&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"📡 Actualizando precios..."})]}),e.jsx("div",{className:"typeform-options",children:x.map(l=>e.jsxs("div",{className:`typeform-option ${s.fuelType===l.name?"selected":""} ${y?"disabled":""}`,onClick:()=>!y&&N(l.name,l),children:[e.jsx("div",{className:"typeform-option-icon",children:l.icon||"🛢️"}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsx("h4",{children:l.displayName||l.name}),e.jsx("p",{children:l.description||"Combustible premium"}),l.defaultPrice&&e.jsx("div",{className:"fuel-price",children:e.jsxs("span",{className:"price-value",children:["$",l.defaultPrice.toLocaleString("es-CO")," COP/galón"]})})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"✓"})})})]},l.id))}),t&&s.fuelType&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card fuel-confirmation",children:[e.jsxs("div",{className:"confirmation-header",children:[e.jsx("span",{className:"confirmation-icon",children:t.icon||"🛢️"}),e.jsxs("div",{className:"confirmation-text",children:[e.jsxs("strong",{children:["Excelente! Has elegido ",t.displayName||t.name]}),e.jsx("br",{}),e.jsx("small",{children:t.description||"Combustible de calidad premium"})]})]}),t.defaultPrice&&e.jsxs("div",{className:"price-confirmation",children:[e.jsxs("div",{className:"price-info",children:[e.jsx("span",{className:"price-label",children:"💰 Precio actual:"}),e.jsxs("span",{className:"price-amount",children:["$",t.defaultPrice.toLocaleString("es-CO")," COP/galón"]})]}),e.jsx("small",{className:"price-note",children:"✨ Aplicamos el precio automáticamente (lo puedes ajustar después)"})]})]})})]})})},he=({formData:s,updateFormData:m,systemData:k,setError:f,isActive:h})=>{const[y,c]=p.useState(!1),[t,j]=p.useState({}),[x,N]=p.useState(!1),{suppliers:l,inventory:b}=k,d=s.type===i.ENTRADA,E=p.useCallback(async a=>{c(!0),f("");try{await new Promise(r=>setTimeout(r,400)),m(d?"supplierName":"location",a)}catch{f("Error al validar la ubicación")}finally{c(!1)}},[d,m,f]);p.useEffect(()=>{if(!h)return;const a=r=>{const v=parseInt(r.key);if(d){const n=l.filter(u=>u.status==="active");if(v>=1&&v<=n.length){const u=n[v-1];E(u.name)}}else if(v>=1&&v<=M.length){const n=M[v-1];E(n)}};return window.addEventListener("keypress",a),()=>window.removeEventListener("keypress",a)},[h,l,d,E]),p.useEffect(()=>{(async()=>{if(!d&&s.fuelType&&b.length>0){N(!0),await new Promise(v=>setTimeout(v,600));const r={};M.forEach(v=>{const n=b.filter(I=>I.fuelType===s.fuelType&&I.location?.toLowerCase()===v.toLowerCase()&&I.status==="active"),u=n.reduce((I,P)=>I+(parseFloat(P.currentStock)||0),0),g=n.reduce((I,P)=>I+(parseFloat(P.maxCapacity)||0),0);let S="available",L=`${u.toFixed(0)} galones disponibles`;u===0?(S="empty",L="Sin combustible disponible"):u<g*.2&&(S="low",L=`${u.toFixed(0)} gal (stock bajo)`),r[v]={available:u,maxCapacity:g,status:S,message:L,percentage:g>0?u/g*100:0}}),j(r),N(!1)}})()},[s.fuelType,d,b]);const w=a=>{switch(a.toLowerCase()){case"oficina principal":return"🏢";case"tanque central":return"⛽";case"almacén norte":return"🏭";case"zona sur":return"🌎";case"taller mecánico":return"🔧";default:return"📍"}},C=()=>{switch(s.type){case i.ENTRADA:return"¿De dónde viene el combustible?";case i.SALIDA:return"¿De qué ubicación tomarás el combustible?";case i.TRANSFERENCIA:return"¿Desde dónde quieres transferir?";case i.AJUSTE:return"¿En qué ubicación harás el ajuste?";default:return"¿Cuál es la ubicación?"}};if(d){const a=l.filter(r=>r.status==="active");return console.log("🔍 [Step3 DEBUG] Suppliers data:",{suppliersLength:l.length,activeSuppliersLength:a.length,suppliers:l}),e.jsx("div",{className:`wizard-step step-location ${h?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsxs("h2",{children:["🏪 ",C()]}),e.jsx("p",{children:"Selecciona el proveedor que está enviando el combustible"})]}),y&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"🔄 Validando proveedor..."})]}),l.length===0?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"🔄 Cargando proveedores..."})]}):a.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"🏪"}),e.jsx("h3",{children:"No hay proveedores disponibles"}),e.jsx("p",{children:"No se encontraron proveedores activos en el sistema."}),e.jsx("p",{children:"Contacta al administrador para agregar proveedores."})]}):e.jsx("div",{className:"typeform-options",children:a.map(r=>e.jsxs("div",{className:`typeform-option ${s.supplierName===r.name?"selected":""} ${y?"disabled":""}`,onClick:()=>!y&&E(r.name),children:[e.jsx("div",{className:"typeform-option-icon",children:"🏪"}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsx("h4",{children:r.name}),e.jsx("p",{children:r.location||"Proveedor de combustibles"}),r.contact&&e.jsxs("small",{className:"supplier-contact",children:["📞 ",r.contact]})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"✓"})})})]},r.id))}),s.supplierName&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card",children:[e.jsx("span",{className:"confirmation-icon",children:"🏪"}),e.jsxs("div",{className:"confirmation-text",children:[e.jsxs("strong",{children:["Genial! Recibirás combustible de ",s.supplierName]}),e.jsx("br",{}),e.jsx("small",{children:"El combustible será registrado en el inventario"})]})]})})]})})}return e.jsx("div",{className:`wizard-step step-location ${h?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsxs("h2",{children:["📍 ",C()]}),e.jsx("p",{children:"Elige la ubicación donde está almacenado el combustible"})]}),x&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"⚙️ Verificando stock por ubicación..."})]}),e.jsx("div",{className:"typeform-options",children:M.map(a=>{const r=t[a]||{},v=s.location===a;return e.jsxs("div",{className:`typeform-option ${v?"selected":""} ${r.status||""} ${y?"disabled":""}`,onClick:()=>!y&&E(a),children:[e.jsx("div",{className:"typeform-option-icon",children:w(a)}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsx("h4",{children:$(a)}),e.jsx("p",{children:r.message||"Verificando disponibilidad..."}),r.available>0&&e.jsx("div",{className:"stock-indicator",children:e.jsx("div",{className:"stock-bar-mini",children:e.jsx("div",{className:"stock-fill-mini",style:{width:`${Math.min(r.percentage,100)}%`}})})})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"✓"})})})]},a)})}),s.location&&t[s.location]&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card",children:[e.jsx("span",{className:"confirmation-icon",children:w(s.location)}),e.jsxs("div",{className:"confirmation-text",children:[e.jsxs("strong",{children:["Excelente! Usarás ",$(s.location)]}),e.jsx("br",{}),e.jsx("small",{children:t[s.location].message})]})]})})]})})},W=({formData:s,updateFormData:m,systemData:k,setError:f,isActive:h})=>{const[y,c]=p.useState(!1),[t,j]=p.useState(null),[x,N]=p.useState(""),l=p.useRef(null),{inventory:b}=k,d=s.type===i.SALIDA||s.type===i.TRANSFERENCIA;p.useEffect(()=>{h&&l.current&&setTimeout(()=>l.current.focus(),300)},[h]),p.useEffect(()=>{if(!h)return;const r=v=>{v.key==="Enter"&&s.quantity&&parseFloat(s.quantity)>0};return window.addEventListener("keypress",r),()=>window.removeEventListener("keypress",r)},[h,s.quantity]),p.useEffect(()=>{(async()=>{if(d&&s.fuelType&&s.location&&b.length>0){c(!0),await new Promise(P=>setTimeout(P,500));const v=b.filter(P=>P.fuelType===s.fuelType&&P.location?.toLowerCase()===s.location?.toLowerCase()&&P.status==="active").reduce((P,A)=>P+(parseFloat(A.currentStock)||0),0),n=parseFloat(s.quantity)||0,u=v-n;let g="available",S="✅",L="Stock Disponible",I="Perfecto, hay suficiente combustible.";if(n>0&&(v<n?(g="critical",S="🚫",L="Cantidad No Disponible",I=`Solo hay ${v.toFixed(2)} galones disponibles`):u<v*.2?(g="warning",S="⚠️",L="Stock Quedará Bajo",I=`Quedarán solo ${u.toFixed(2)} galones`):I=`Quedarán ${u.toFixed(2)} galones en stock`),j({available:v,required:n,remaining:Math.max(0,u),status:g,icon:S,title:L,message:I,isValid:v>=n}),n>0&&d){const P={type:s.type===i.SALIDA?"outbound":"transfer",fuelType:s.fuelType,quantity:s.quantity,sourceLocation:s.location},A=se(P,b);A.isValid?A.warning?N(`⚠️ ${A.warning}`):N(""):N(`🚫 ${A.error}`)}else d||N("");c(!1)}})()},[s.quantity,s.fuelType,s.location,s.type,d,b]);const E=r=>{const v=parseFloat(r);(r===""||!isNaN(v)&&v>=0)&&(m("quantity",r),f(""))},w=()=>{if(!t||!t.available)return[];const r=t.available;return[{label:"25 gal",value:"25"},{label:"50 gal",value:"50"},{label:"100 gal",value:"100"},{label:`${r.toFixed(0)} gal`,value:r.toFixed(1)}]},C=()=>{switch(s.type){case i.ENTRADA:return"📥";case i.SALIDA:return"⛽";case i.TRANSFERENCIA:return"🔄";case i.AJUSTE:return"⚖️";default:return"📊"}},a=()=>{switch(s.type){case i.ENTRADA:return"¿Cuántos galones estás recibiendo?";case i.SALIDA:return"¿Cuántos galones necesitas entregar?";case i.TRANSFERENCIA:return"¿Cuántos galones vas a transferir?";case i.AJUSTE:return"¿Cuál es la cantidad del ajuste?";default:return"¿Cuántos galones necesitas?"}};return e.jsx("div",{className:`wizard-step step-quantity ${h?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsxs("h2",{children:[C()," ",a()]}),e.jsx("p",{children:"Ingresa la cantidad en galones"})]}),e.jsxs("div",{className:"typeform-input-section",children:[e.jsx("input",{ref:l,id:"quantity",type:"number",step:"0.1",min:"0",value:s.quantity,onChange:r=>E(r.target.value),placeholder:"0",className:`typeform-input ${x?"error":""}`,autoComplete:"off"}),e.jsx("span",{className:"typeform-unit",children:"galones"})]}),t&&t.available>0&&e.jsxs("div",{className:"typeform-suggestions",children:[e.jsx("label",{className:"typeform-suggestions-label",children:"Cantidades comunes:"}),e.jsx("div",{className:"typeform-suggestions-buttons",children:w().map((r,v)=>e.jsx("button",{type:"button",className:"typeform-suggestion-btn",onClick:()=>E(r.value),children:r.label},v))})]}),y&&e.jsxs("div",{className:"calculating-indicator",children:[e.jsx("div",{className:"loading-spinner small"}),e.jsx("span",{children:"⚙️ Verificando disponibilidad..."})]}),t&&d&&!y&&e.jsxs("div",{className:`stock-info-container ${t.status}`,children:[e.jsxs("div",{className:"stock-info-header",children:[e.jsx("div",{className:"stock-info-icon",children:t.icon}),e.jsx("h4",{className:"stock-info-title",children:t.title})]}),e.jsx("div",{className:"stock-info-message",children:t.message})]}),x&&e.jsx("div",{className:"validation-warning",children:x}),s.quantity&&parseFloat(s.quantity)>0&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card",children:[e.jsx("span",{className:"confirmation-icon",children:C()}),e.jsxs("div",{className:"confirmation-text",children:[e.jsxs("strong",{children:["Perfecto! ",parseFloat(s.quantity).toLocaleString("es-CO")," galones"]}),e.jsx("br",{}),e.jsx("small",{children:d?`Saldrán del inventario de ${s.location}`:"Se agregarán al inventario"})]})]})})]})})},K=({formData:s,updateFormData:m,systemData:k,setError:f,isActive:h})=>{const[y,c]=p.useState(!1),[t,j]=p.useState(null),[x,N]=p.useState(!1),[l,b]=p.useState(""),d=p.useRef(null),{vehicles:E}=k,w=p.useCallback(u=>u?u.type==="heavy"||u.type==="construction"||u.category==="maquinaria":!1,[]),C=p.useCallback(()=>{if(!s.fuelType||E.length===0)return[];const u=s.fuelType.toLowerCase();return E.filter(g=>{const S=g.fuelType?.toLowerCase()||"";return g.status==="activo"&&(u==="diesel"&&S==="diesel"||u==="gasolina"&&S==="gasolina")})},[s.fuelType,E]),a=p.useCallback(async u=>{c(!0),f(""),b("");try{await new Promise(S=>setTimeout(S,400)),m("vehicleId",u.vehicleId),j(u);const g=w(u);N(g),g||m("currentHours","")}catch{f("Error al seleccionar vehículo")}finally{c(!1)}},[m,f,w]);if(p.useEffect(()=>{if(!h||s.type!==i.SALIDA)return;const u=g=>{const S=C(),L=parseInt(g.key);if(L>=1&&L<=S.length){const I=S[L-1];a(I)}};return window.addEventListener("keypress",u),()=>window.removeEventListener("keypress",u)},[h,E,s.fuelType,C,a]),p.useEffect(()=>{if(s.vehicleId&&E.length>0&&s.type===i.SALIDA){const u=E.find(S=>S.vehicleId===s.vehicleId);j(u);const g=w(u);N(g),g&&d.current&&setTimeout(()=>d.current.focus(),500)}},[s.vehicleId,E]),s.type!==i.SALIDA)return null;const r=u=>{const g=parseFloat(u);u===""||!isNaN(g)&&g>=0?(m("currentHours",u),b("")):b("Ingresa un valor válido de horómetro")},v=u=>{const g=u.category?.toLowerCase()||"",S=u.type?.toLowerCase()||"";return g.includes("tractor")||S.includes("tractor")?"🚜":g.includes("excavadora")||S.includes("excavadora")?"🦕":g.includes("volqueta")||S.includes("volqueta")?"🚛":g.includes("moto")||S.includes("moto")?"🏍️":g.includes("carro")||S.includes("carro")?"🚗":"🚙"},n=C();return n.length===0?e.jsx("div",{className:`wizard-step step-vehicle ${h?"active":""}`,children:e.jsx("div",{className:"typeform-layout",children:e.jsxs("div",{className:"typeform-question",children:[e.jsx("h2",{children:"🚫 No hay vehículos compatibles"}),e.jsxs("p",{children:["No se encontraron vehículos activos que usen ",s.fuelType]})]})})}):e.jsx("div",{className:`wizard-step step-vehicle ${h?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h2",{children:"🚗 ¿A qué vehículo le darás combustible?"}),e.jsxs("p",{children:["Selecciona el vehículo o equipo que recibirá el ",s.fuelType]})]}),y&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"🔄 Validando vehículo..."})]}),e.jsx("div",{className:"typeform-options",children:n.map(u=>e.jsxs("div",{className:`typeform-option ${s.vehicleId===u.vehicleId?"selected":""} ${y?"disabled":""}`,onClick:()=>!y&&a(u),children:[e.jsx("div",{className:"typeform-option-icon",children:v(u)}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsxs("h4",{children:[u.vehicleId," - ",u.brand||"Vehículo"]}),e.jsx("p",{children:u.model||u.type||"Equipo de trabajo"}),u.currentHours&&e.jsxs("small",{className:"vehicle-hours",children:["🕐 ",u.currentHours," horas registradas"]})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"✓"})})})]},u.id))}),x&&t&&e.jsxs("div",{className:"typeform-input-section",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h3",{children:"🕐 ¿Cuál es el horómetro actual?"}),e.jsxs("p",{children:["Ingresa las horas actuales de ",t.vehicleId]})]}),e.jsx("input",{ref:d,type:"number",step:"0.1",min:"0",value:s.currentHours||"",onChange:u=>r(u.target.value),placeholder:"0",className:`typeform-input ${l?"error":""}`,autoComplete:"off"}),e.jsx("span",{className:"typeform-unit",children:"horas"}),l&&e.jsx("div",{className:"validation-warning",children:l})]}),t&&s.vehicleId&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card",children:[e.jsx("span",{className:"confirmation-icon",children:v(t)}),e.jsxs("div",{className:"confirmation-text",children:[e.jsxs("strong",{children:["Perfecto! Combustible para ",t.vehicleId]}),e.jsx("br",{}),e.jsxs("small",{children:[t.brand," ",t.model,x&&s.currentHours&&` - Horómetro: ${s.currentHours} horas`]})]})]})})]})})},Y=({formData:s,updateFormData:m,systemData:k,setError:f,isEntryDestination:h=!1,isActive:y})=>{const[c,t]=p.useState(!1),[j,x]=p.useState({}),[N,l]=p.useState(!1),{inventory:b}=k;p.useEffect(()=>{(async()=>{if(s.fuelType&&s.quantity&&b.length>0&&!h){l(!0),await new Promise(r=>setTimeout(r,700));const C=parseFloat(s.quantity)||0,a={};M.filter(r=>h?!0:r!==s.location).forEach(r=>{const v=b.filter(A=>A.fuelType===s.fuelType&&A.location?.toLowerCase()===r.toLowerCase()&&A.status==="active").reduce((A,T)=>A+(parseFloat(T.currentStock)||0),0),n=b.filter(A=>A.fuelType===s.fuelType&&A.location?.toLowerCase()===r.toLowerCase()&&A.status==="active").reduce((A,T)=>A+(parseFloat(T.maxCapacity)||0),0),u=n-v,g=v+C,S=n>0?g/n*100:0;let L="available",I=`Capacidad: ${u.toFixed(1)} gal libres`,P=u>=C;n===0?(L="no_capacity",I="Sin tanques configurados",P=!1):u<C?(L="insufficient",I=`Insuficiente: faltan ${(C-u).toFixed(1)} gal`,P=!1):S>90&&(L="warning",I=`Quedará al ${S.toFixed(1)}% (casi lleno)`),a[r]={currentStock:v,maxCapacity:n,availableCapacity:u,afterTransfer:g,occupancyAfter:S,status:L,message:I,canAcceptTransfer:P}}),x(a),l(!1),console.log("🔍 Capacidad validada por destino:",a)}})()},[s.fuelType,s.quantity,s.location,b,h]);const d=async w=>{const C=j[w];if(!h&&!C?.canAcceptTransfer){f("Esta ubicación no puede recibir la cantidad solicitada");return}t(!0),f("");try{await new Promise(a=>setTimeout(a,500)),m("destinationLocation",w),console.log("🎯 Destino seleccionado:",w)}catch(a){console.error("Error al validar destino:",a),f("Error al validar el destino")}finally{t(!1)}};if(!h&&s.type!==i.TRANSFERENCIA)return null;const E=h?ae:M.filter(w=>w!==s.location);return e.jsx("div",{className:`wizard-step step-destination ${y?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsxs("h3",{children:["🎯 ",h?"¿A qué ubicación llegará el combustible?":"¿Hacia qué ubicación se transfiere?"]}),e.jsx("p",{children:"Selecciona la ubicación de destino:"})]}),N&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"🔍 Verificando capacidad disponible..."})]}),e.jsx("div",{className:"typeform-options",children:E.map(w=>{const C=j[w],a=!C||C.canAcceptTransfer;return e.jsxs("div",{className:`typeform-option ${s.destinationLocation===w?"selected":""} 
                           ${C?.status||"unknown"} ${!a||c?"disabled":""}`,onClick:()=>a&&!c&&d(w),children:[e.jsx("div",{className:"typeform-option-icon",children:"🎯"}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsx("h4",{children:$(w)}),C&&e.jsxs("div",{className:"capacity-info",children:[e.jsx("p",{className:"capacity-message",children:C.message}),C.maxCapacity>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"capacity-bar-mini",children:[e.jsx("div",{className:"capacity-current-mini",style:{width:`${Math.min(100,C.currentStock/C.maxCapacity*100)}%`}}),C.canAcceptTransfer&&e.jsx("div",{className:"capacity-after-mini",style:{width:`${Math.min(100,C.occupancyAfter)}%`,left:`${Math.min(100,C.currentStock/C.maxCapacity*100)}%`}})]}),e.jsxs("small",{className:"capacity-details",children:["Actual: ",C.currentStock.toFixed(1),"/",C.maxCapacity.toFixed(1)," gal"]})]})]})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"✓"})})})]},w)})}),s.location&&s.quantity&&e.jsx("div",{className:"transfer-summary",children:e.jsxs("div",{className:"transfer-flow",children:[e.jsxs("div",{className:"transfer-origin",children:[e.jsx("span",{className:"transfer-icon",children:"📍"}),e.jsxs("div",{className:"transfer-info",children:[e.jsx("strong",{children:$(s.location)}),e.jsx("small",{children:"Origen"})]})]}),e.jsxs("div",{className:"transfer-arrow",children:[e.jsx("span",{children:"→"}),e.jsxs("small",{children:[parseFloat(s.quantity).toFixed(1)," gal"]})]}),e.jsxs("div",{className:"transfer-destination",children:[e.jsx("span",{className:"transfer-icon",children:"🎯"}),e.jsxs("div",{className:"transfer-info",children:[e.jsx("strong",{children:s.destinationLocation?$(s.destinationLocation):"Seleccionar destino"}),e.jsx("small",{children:"Destino"})]})]})]})}),s.destinationLocation&&j[s.destinationLocation]&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card destination-confirmation",children:[e.jsxs("div",{className:"confirmation-header",children:[e.jsx("span",{className:"confirmation-icon",children:"🎯"}),e.jsxs("div",{className:"confirmation-text",children:[e.jsx("strong",{children:$(s.destinationLocation)}),e.jsx("br",{}),e.jsx("small",{children:"Ubicación de destino confirmada"})]})]}),e.jsxs("div",{className:"capacity-confirmation",children:[e.jsxs("div",{className:"capacity-detail",children:[e.jsx("span",{className:"capacity-label",children:"📊 Después de transferir:"}),e.jsxs("span",{className:"capacity-value",children:[j[s.destinationLocation].afterTransfer.toFixed(1)," gal"]})]}),e.jsx("div",{className:"occupancy-bar",children:e.jsx("div",{className:"occupancy-fill",style:{width:`${j[s.destinationLocation].occupancyAfter}%`}})}),e.jsxs("small",{className:"occupancy-text",children:[j[s.destinationLocation].occupancyAfter.toFixed(1),"% de capacidad ocupada"]})]})]})})]})})},Z=({formData:s,updateFormData:m,systemData:k,error:f,setError:h,isActive:y})=>{const[c,t]=p.useState(!1),[j,x]=p.useState(!1),{products:N}=k;p.useEffect(()=>{if(s.fuelType&&!s.unitPrice&&N.length>0){const a=N.find(r=>r.name===s.fuelType||r.displayName===s.fuelType);a&&a.defaultPrice&&(m("unitPrice",a.defaultPrice.toString()),x(!0))}},[s.fuelType,s.unitPrice,N,m]);const l=async a=>{const r=parseFloat(a);(a===""||!isNaN(r)&&r>=0)&&(t(!0),await new Promise(v=>setTimeout(v,300)),m("unitPrice",a),x(a!==""),h(""),t(!1))},b=a=>{m("effectiveDate",a)},d=a=>{m("description",a)},E=(parseFloat(s.quantity)||0)*(parseFloat(s.unitPrice)||0),w=a=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),C=()=>N.find(a=>a.name===s.fuelType||a.displayName===s.fuelType);return e.jsx("div",{className:`wizard-step step-details ${y?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h3",{children:"📋 Información adicional del movimiento"}),e.jsx("p",{children:"Completa los detalles restantes:"})]}),e.jsxs("div",{className:"typeform-input-section",children:[e.jsx("label",{htmlFor:"unitPrice",children:"💰 Precio por galón (COP) *"}),e.jsx("input",{id:"unitPrice",type:"number",step:"1",min:"0",value:s.unitPrice,onChange:a=>l(a.target.value),placeholder:"0",className:`typeform-input ${f?"error":""}`}),e.jsx("span",{className:"typeform-unit",children:"COP"}),c&&e.jsxs("div",{className:"calculating-price",children:[e.jsx("div",{className:"loading-spinner small"}),e.jsx("span",{children:"💰 Validando precio..."})]}),C()?.defaultPrice&&e.jsxs("small",{className:"price-suggestion",children:["💡 Precio sugerido: $",C().defaultPrice.toLocaleString("es-CO")," COP"]})]}),s.quantity&&s.unitPrice&&j&&e.jsx("div",{className:"total-value-section",children:e.jsxs("div",{className:"total-value-card",children:[e.jsx("div",{className:"total-icon",children:"📊"}),e.jsxs("div",{className:"total-content",children:[e.jsx("h4",{children:"Valor Total Calculado"}),e.jsxs("div",{className:"total-calculation",children:[e.jsxs("span",{className:"calculation-details",children:[parseFloat(s.quantity).toFixed(2)," gal × $",parseFloat(s.unitPrice).toLocaleString("es-CO")," COP"]}),e.jsx("div",{className:"total-amount",children:w(E)})]})]})]})}),e.jsxs("div",{className:"typeform-input-section",children:[e.jsx("label",{htmlFor:"effectiveDate",children:"📅 ¿Cuándo ocurrió este movimiento?"}),e.jsx("input",{id:"effectiveDate",type:"datetime-local",value:s.effectiveDate,onChange:a=>b(a.target.value),className:"typeform-input"}),e.jsx("small",{className:"typeform-unit",children:"💡 Por defecto se usa la fecha y hora actual"})]}),e.jsxs("div",{className:"typeform-input-section",children:[e.jsx("label",{htmlFor:"description",children:"📝 Detalles adicionales del movimiento (opcional)"}),e.jsx("textarea",{id:"description",value:s.description,onChange:a=>d(a.target.value),placeholder:"Ej: Combustible para operación en sector norte, mantenimiento programado, etc.",className:"typeform-input",rows:"3",maxLength:"500"}),e.jsxs("div",{className:"description-counter",children:[s.description.length,"/500 caracteres"]})]})]})})},X=({formData:s,systemData:m,error:k,onCommentsChange:f,confirmChecked:h,onConfirmChange:y})=>{const{vehicles:c,products:t}=m,j=r=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(r),x=()=>({[i.ENTRADA]:{icon:"📥",title:"Entrada de Combustible",color:"entrada"},[i.SALIDA]:{icon:"⛽",title:"Salida de Combustible",color:"salida"},[i.TRANSFERENCIA]:{icon:"🔄",title:"Transferencia",color:"transferencia"},[i.AJUSTE]:{icon:"⚖️",title:"Ajuste de Inventario",color:"ajuste"}})[s.type]||{icon:"❓",title:"Operación",color:"unknown"},N=()=>t.find(r=>r.name===s.fuelType||r.displayName===s.fuelType),l=()=>c.find(r=>r.vehicleId===s.vehicleId),b=()=>{const r=parseFloat(s.quantity).toLocaleString("es-CO"),v=N()?.displayName||s.fuelType,n=l();switch(s.type){case i.ENTRADA:return`Recibir ${r} galones de ${v} de ${s.supplierName}`;case i.SALIDA:return`Entregar ${r} galones de ${v} a ${n?.vehicleId||"vehículo"}`;case i.TRANSFERENCIA:return`Transferir ${r} galones de ${v} desde ${$(s.location)} hacia ${$(s.destinationLocation)}`;case i.AJUSTE:return`Ajustar ${r} galones de ${v} en ${$(s.location)}`;default:return`Procesar ${r} galones de ${v}`}},d=(parseFloat(s.quantity)||0)*(parseFloat(s.unitPrice)||0),E=x(),w=N(),C=l(),a=r=>{f(r.target.value)};return e.jsx("div",{className:"wizard-step step-summary",children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h2",{children:"🎯 ¡Perfecto! Vamos a confirmar"}),e.jsx("p",{children:"Revisa que todo esté correcto antes de procesar tu operación"})]}),e.jsxs("div",{className:"summary-main",children:[e.jsxs("div",{className:`summary-header ${E.color}`,children:[e.jsx("div",{className:"summary-icon",children:E.icon}),e.jsxs("div",{className:"summary-title",children:[e.jsx("h4",{children:E.title}),e.jsx("p",{children:b()})]}),e.jsx("div",{className:"summary-value",children:j(d)})]}),e.jsxs("div",{className:"summary-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"⛽"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Combustible"}),e.jsx("span",{className:"detail-value",children:w?.displayName||s.fuelType})]})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"📊"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Cantidad"}),e.jsxs("span",{className:"detail-value",children:[parseFloat(s.quantity).toLocaleString("es-CO")," galones"]})]})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"💰"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Precio unitario"}),e.jsx("span",{className:"detail-value",children:j(parseFloat(s.unitPrice))})]})]}),s.type===i.ENTRADA&&e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"🏪"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Proveedor"}),e.jsx("span",{className:"detail-value",children:s.supplierName})]})]}),(s.type===i.SALIDA||s.type===i.TRANSFERENCIA)&&e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"📍"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Ubicación origen"}),e.jsx("span",{className:"detail-value",children:$(s.location)})]})]}),s.type===i.SALIDA&&C&&e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"🚗"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Vehículo"}),e.jsxs("span",{className:"detail-value",children:[C.vehicleId,s.currentHours&&` - ${s.currentHours} hrs`]})]})]}),s.type===i.TRANSFERENCIA&&e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"🎯"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Destino"}),e.jsx("span",{className:"detail-value",children:$(s.destinationLocation)})]})]}),s.description&&e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"📝"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Descripción"}),e.jsx("span",{className:"detail-value description",children:s.description})]})]})]})]}),e.jsxs("div",{className:"typeform-input-section",children:[e.jsx("label",{htmlFor:"additional-comments",children:"💬 ¿Algún comentario adicional? (Opcional)"}),e.jsx("textarea",{id:"additional-comments",value:s.additionalComments||"",onChange:a,placeholder:"Escribe cualquier observación o detalle especial...",className:"typeform-textarea",rows:"3"})]}),e.jsxs("div",{className:"confirmation-section",children:[e.jsxs("div",{className:"confirmation-checkbox",children:[e.jsx("input",{type:"checkbox",id:"final-confirm",checked:h,onChange:r=>y(r.target.checked)}),e.jsx("label",{htmlFor:"final-confirm",children:"✅ Confirmo que toda la información es correcta y deseo procesar este movimiento"})]}),e.jsx("div",{className:"confirmation-warning",children:"⚠️ Este movimiento actualizará automáticamente el inventario de combustibles"})]}),k&&e.jsxs("div",{className:"validation-warning",children:["🚫 ",k]}),e.jsxs("div",{className:"final-message",children:[e.jsxs("p",{children:["🎉 ",e.jsx("strong",{children:"¡Listo para procesar!"})]}),e.jsx("p",{children:"Tu movimiento será registrado inmediatamente en el sistema."})]})]})})},xe=({isOpen:s,onClose:m,onSuccess:k})=>{const{inventory:f,vehicles:h,suppliers:y,subscribeToSuppliers:c}=ee(),[t,j]=p.useState(1),[x,N]=p.useState(!1),[l,b]=p.useState(!1),[d,E]=p.useState(""),[w,C]=p.useState(!1),[a,r]=p.useState({type:"",fuelType:"",quantity:"",unitPrice:"",location:"",supplierName:"",vehicleId:"",destinationLocation:"",description:"",reference:"",effectiveDate:new Date().toISOString().slice(0,16),currentHours:""}),[v,n]=p.useState({vehicles:[],inventory:[],suppliers:[],products:[],loadingData:!0}),u=()=>{j(1),E(""),C(!1),r({type:"",fuelType:"",quantity:"",unitPrice:"",location:"",supplierName:"",vehicleId:"",destinationLocation:"",description:"",reference:"",effectiveDate:new Date().toISOString().slice(0,16),currentHours:""})};p.useEffect(()=>((async()=>{if(s){document.body.style.overflow="hidden",u(),n(R=>({...R,loadingData:!0}));try{console.log("🔄 Cargando productos y sincronizando datos en tiempo real..."),y.length===0&&c&&(console.log("🔄 Suscribiéndose a suppliers..."),c()),console.log("🔍 [WIZARD DEBUG] Datos disponibles:",{vehicles:h?.length||0,inventory:f?.length||0,suppliers:y?.length||0});const R=await re();n({vehicles:h||[],inventory:f||[],suppliers:y||[],products:R||[],loadingData:!1}),console.log("✅ Datos sincronizados para wizard - inventario en tiempo real:",f?.length||0,"items"),console.log("✅ Suppliers cargados:",y?.length||0,"proveedores")}catch(R){console.error("❌ Error al cargar datos del sistema:",R),E("No se pudieron cargar los datos necesarios. Inténtalo de nuevo."),n(q=>({...q,loadingData:!1}))}}else document.body.style.overflow="unset"})(),()=>{document.body.style.overflow="unset"}),[s,f,h,y,c]);const g=()=>{if(!a.type)return 8;let o;return a.type===i.TRANSFERENCIA?o=8:a.type===i.SALIDA||a.type===i.ENTRADA?o=7:o=6,console.log("🔍 [TOTAL STEPS]",{type:a.type,totalSteps:o,currentStep:t}),o},S=(o,R)=>{r(q=>({...q,[o]:R})),E("")},L=p.useCallback(()=>{let o=!1;switch(t){case 1:o=!!a.type;break;case 2:a.type===i.SALIDA?o=!!a.effectiveDate:o=!!a.fuelType;break;case 3:a.type===i.SALIDA?o=!!a.fuelType:a.type===i.ENTRADA?o=!!a.supplierName:o=!!a.location;break;case"3b":o=!!a.destinationLocation;break;case 4:if(a.type===i.SALIDA){if(o=!!a.vehicleId,o&&a.vehicleId){const R=h.find(q=>q.vehicleId===a.vehicleId);R&&(R.fuelType==="diesel"||R.fuelType==="Diesel")&&(o=!!a.currentHours&&parseFloat(a.currentHours)>=0)}}else o=a.quantity&&parseFloat(a.quantity)>0;break;case 5:a.type===i.SALIDA?o=a.quantity&&parseFloat(a.quantity)>0:(a.type,i.TRANSFERENCIA,o=!0);break;case 6:a.type===i.SALIDA?o=!!a.unitPrice&&parseFloat(a.unitPrice)>=0:a.type===i.TRANSFERENCIA?o=!!a.destinationLocation:o=!0;break;case 7:a.type===i.SALIDA?o=!0:o=!!a.unitPrice&&parseFloat(a.unitPrice)>=0;break;case 8:o=!0;break;default:o=!1}return console.log("🔍 [DEBUG General] validateCurrentStep:",{currentStep:t,isValid:o,formDataKeys:Object.keys(a),formData:a}),o},[t,a,h]),I=p.useMemo(()=>L(),[L]),P=()=>{N(!0);const o=L();if(console.log("🔍 [DEBUG nextStep] Intentando navegar:",{currentStep:t,isValid:o,formData:a,type:a.type}),o){const R=g();let q=t+1;a.type===i.SALIDA?q=t+1:t===3&&a.type===i.ENTRADA?q="3b":t==="3b"?q=4:t===4&&a.type!==i.SALIDA?a.type===i.TRANSFERENCIA?q=6:(a.type,i.ENTRADA,q=7):t===5&&a.type!==i.TRANSFERENCIA&&a.type!==i.SALIDA&&(q=7),console.log("🔍 [DEBUG Navigation] Navegando:",{from:t,to:q,totalSteps:R,movementType:a.type}),(O=>a.type===i.SALIDA?O:a.type===i.ENTRADA?{1:1,2:2,3:3,"3b":4,4:5,7:6,8:7}[O]||O:{1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8}[O]||O)(q)<=R&&j(q)}else console.log("❌ [DEBUG] Validación falló, no se puede navegar"),E("Por favor completa este paso antes de continuar");setTimeout(()=>N(!1),300)},A=()=>{if(N(!0),t>1&&t!=="3b"){let o=t-1;a.type===i.SALIDA?o=t-1:t===4&&a.type===i.ENTRADA?o="3b":(t===7&&a.type===i.ENTRADA||t===7&&a.type!==i.TRANSFERENCIA&&a.type!==i.SALIDA||t===6&&a.type!==i.SALIDA)&&(o=4),j(o)}else t==="3b"&&j(3);setTimeout(()=>N(!1),300)},T=async()=>{b(!0),E("");try{const o={...a};console.log("🔍 [SUBMIT] Datos completos antes de crear movimiento:",o);const R={...o,quantity:parseFloat(o.quantity),unitPrice:parseFloat(o.unitPrice),effectiveDate:new Date(o.effectiveDate)};console.log("🔍 [SUBMIT] MovementData enviado a createMovement:",R),await te(R),k(),u()}catch(o){console.error("Error al crear movimiento:",o),E(o.message||"Error al crear el movimiento")}finally{b(!1)}},z=()=>{const o={formData:a,updateFormData:S,systemData:v,error:d,setError:E,isActive:!x};return a.type===i.SALIDA?{1:e.jsx(_,{...o}),2:e.jsx(pe,{...o}),3:e.jsx(J,{...o}),4:e.jsx(K,{...o}),5:e.jsx(W,{...o}),6:e.jsx(Z,{...o}),7:e.jsx(X,{...o,onSubmit:T,isLoading:l,onCommentsChange:Q=>S("additionalComments",Q),confirmChecked:w,onConfirmChange:C})}[t]||e.jsx("div",{children:"Paso no encontrado"}):{1:e.jsx(_,{...o}),2:e.jsx(J,{...o}),3:e.jsx(he,{...o}),"3b":e.jsx(Y,{...o,isEntryDestination:!0}),4:e.jsx(W,{...o}),5:e.jsx(K,{...o}),6:e.jsx(Y,{...o}),7:e.jsx(Z,{...o}),8:e.jsx(X,{...o,onSubmit:T,isLoading:l,onCommentsChange:q=>S("additionalComments",q),confirmChecked:w,onConfirmChange:C})}[t]||e.jsx("div",{children:"Paso no encontrado"})};if(!s)return null;const D=g(),U=(o=>a.type===i.SALIDA?o:a.type===i.ENTRADA?{1:1,2:2,3:3,"3b":4,4:5,7:6,8:7}[o]||o:{1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8}[o]||o)(t),G=U/D*100,H=U>=D;return console.log("🔍 [WIZARD DEBUG]",{type:a.type,currentStep:t,currentLogicalStep:U,totalSteps:D,progress:G,isLastStep:H,formDataKeys:Object.keys(a).filter(o=>a[o]),fuelType:a.fuelType}),e.jsx("div",{className:"modal-overlay wizard-overlay",onClick:m,children:e.jsxs("div",{className:`modal-content wizard-modal typeform-mode ${H?"is-last-step":""}`,onClick:o=>o.stopPropagation(),children:[e.jsx("button",{className:"typeform-escape",onClick:m,"aria-label":"Cerrar wizard",children:"✕"}),e.jsx("div",{className:"typeform-progress",children:e.jsx("div",{className:"typeform-progress-fill",style:{width:`${G}%`}})}),e.jsx("div",{className:"wizard-header typeform-mode",children:e.jsx("div",{className:"wizard-title",children:e.jsx("button",{className:"modal-close",onClick:m,children:"✕"})})}),e.jsx("div",{className:"wizard-body typeform-mode",children:v.loadingData?e.jsxs("div",{className:"wizard-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"🔄 Cargando datos del sistema..."})]}):e.jsx("div",{className:"wizard-step-container",children:z()})}),d&&e.jsxs("div",{className:"wizard-error",children:[e.jsx("span",{className:"error-icon",children:"⚠️"}),d]}),e.jsxs("div",{className:"typeform-navigation",children:[t>1&&e.jsx("button",{className:"typeform-nav-btn",onClick:A,disabled:x,"aria-label":"Paso anterior",children:"←"}),H?e.jsx("button",{className:"typeform-nav-btn",onClick:T,disabled:l||!w||x,"aria-label":"Confirmar movimiento",children:l?e.jsx("span",{className:"loading-spinner small"}):"✓"}):e.jsx("button",{className:"typeform-nav-btn",onClick:P,disabled:!I||x,"aria-label":"Siguiente paso",children:"→"})]}),e.jsxs("div",{className:"typeform-step-indicator",children:[e.jsx("div",{className:"step-number",children:U}),e.jsxs("span",{children:["de ",D]})]})]})})},be=()=>{const{user:s,userProfile:m,deleteMovement:k}=ee(),[f,h]=p.useState([]),[y,c]=p.useState(null),[t,j]=p.useState(!0),[x,N]=p.useState(null),[l,b]=p.useState({type:"",status:"",fuelType:"",vehicleId:"",dateRange:"all"}),[d,E]=p.useState(""),[w,C]=p.useState(!1);p.useEffect(()=>{if(!s)return;j(!0);const A=ie((T,z)=>{if(z){console.error("Error en suscripción de movimientos:",z),N("Error al cargar movimientos"),j(!1);return}h(T),N(null),j(!1)},l);return()=>A()},[s,l.type,l.status,l.fuelType,l.vehicleId,l.dateRange]),p.useEffect(()=>{s&&(async()=>{try{const T=await ne(l);c(T)}catch(T){console.error("Error al cargar estadísticas:",T)}})()},[s,f,l.type,l.status,l.fuelType,l.vehicleId,l.dateRange]);const a=f.filter(A=>{if(!d)return!0;const T=d.toLowerCase();return A.fuelType?.toLowerCase().includes(T)||A.type?.toLowerCase().includes(T)||A.location?.toLowerCase().includes(T)||A.vehicleId?.toLowerCase().includes(T)||A.description?.toLowerCase().includes(T)||A.reference?.toLowerCase().includes(T)}),r=()=>{C(!0)},v=A=>{alert(`📋 Detalles del movimiento:

Tipo: ${A.type}
Combustible: ${A.fuelType}
Cantidad: ${A.quantity} gal
Fecha: ${new Date(A.createdAt).toLocaleDateString("es-CO")}`)},n=()=>{C(!1)},u=A=>{b(T=>({...T,...A}))},g=()=>{b({type:"",status:"",fuelType:"",vehicleId:"",dateRange:"all"}),E("")},S=async A=>{if(window.confirm("¿Estás seguro de que quieres aprobar este movimiento? Esta acción actualizará el inventario."))try{await ce(A),alert("Movimiento aprobado y stock actualizado.")}catch(T){console.error("Error al aprobar movimiento:",T),alert(`Error al aprobar movimiento: ${T.message}`)}},L=async A=>{if(window.confirm("¿Estás seguro de que quieres rechazar este movimiento?"))try{await le(A,{status:F.CANCELADO}),alert("Movimiento rechazado.")}catch(T){console.error("Error al rechazar movimiento:",T),alert(`Error al rechazar movimiento: ${T.message}`)}},I=async A=>{try{const T=await k(A);if(T.success)alert("Movimiento eliminado exitosamente.");else throw new Error(T.error)}catch(T){console.error("Error al eliminar movimiento:",T),alert(`Error al eliminar movimiento: ${T.message}`)}},P=m?.role==="admin"||m?.role==="contador"||m?.role==="cliente";return t?e.jsx("div",{className:"movements-main",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Cargando movimientos..."})]})}):x?e.jsx("div",{className:"movements-main",children:e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:"⚠️"}),e.jsx("h3",{children:"Error al cargar movimientos"}),e.jsx("p",{children:x}),e.jsx("button",{className:"btn-retry",onClick:()=>window.location.reload(),children:"Reintentar"})]})}):e.jsxs("div",{className:"movements-main",children:[e.jsxs("div",{className:"movements-header",children:[e.jsxs("div",{className:"header-title",children:[e.jsx("h2",{children:"📊 Movimientos de Combustibles"}),e.jsx("p",{children:"Gestiona entradas, salidas, transferencias y ajustes de inventario"})]}),P&&e.jsx("div",{className:"create-movement-options",children:e.jsx("button",{className:"btn-create-movement primary",onClick:r,children:"➕ Nuevo Movimiento"})})]}),y&&e.jsx(oe,{stats:y,filters:l}),e.jsx(de,{filters:l,onFilterChange:u,onClearFilters:g,searchTerm:d,onSearchChange:E,totalResults:a.length}),a.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"📋"}),e.jsx("h3",{children:f.length===0?"No hay movimientos registrados":"No se encontraron movimientos"}),e.jsx("p",{children:f.length===0?"Comienza creando tu primer movimiento de combustible":"Intenta ajustar los filtros de búsqueda"}),f.length===0&&P&&e.jsx("div",{className:"create-first-options",children:e.jsx("button",{className:"btn-create-first primary",onClick:r,children:"➕ Crear Primer Movimiento"})})]}):e.jsx(me,{movements:a,onEdit:null,onView:v,onApprove:S,onReject:L,onDelete:I,userRole:m?.role}),w&&e.jsx(xe,{isOpen:w,onClose:n,onSuccess:()=>{n()}})]})};export{be as default};
