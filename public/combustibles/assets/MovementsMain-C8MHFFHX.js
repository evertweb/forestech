import{j as e,f as z,a as G,l as n,M as P,r as j,O as V,z as $,A as J,B as W,u as D,C as K,D as Y,E as Z,G as X,H as ee}from"./index-DGN-lksX.js";import{g as se}from"./productsService-C8bcaD2G.js";const ae=({stats:s,filters:x})=>{if(!s)return null;const k=(i,o)=>o===0?i>0?100:0:((i-o)/o*100).toFixed(1),S=i=>{switch(i){case n.ENTRADA:return"#10b981";case n.SALIDA:return"#ef4444";case n.TRANSFERENCIA:return"#3b82f6";case n.AJUSTE:return"#f59e0b";default:return"#6b7280"}},v=i=>{switch(i){case n.ENTRADA:return"📥";case n.SALIDA:return"📤";case n.TRANSFERENCIA:return"🔄";case n.AJUSTE:return"⚖️";default:return"📋"}},E=k(s.thisMonth,s.lastMonth);return e.jsxs("div",{className:"movements-stats",children:[e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card primary",children:[e.jsx("div",{className:"stat-icon",children:"📊"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:z(s.totalMovements)}),e.jsx("div",{className:"stat-label",children:"Total Movimientos"}),e.jsxs("div",{className:"stat-trend",children:[e.jsxs("span",{className:`trend ${E>=0?"positive":"negative"}`,children:[E>=0?"📈":"📉"," ",Math.abs(E),"%"]}),e.jsx("span",{className:"trend-label",children:"vs mes anterior"})]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"💰"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:G(s.totalValue)}),e.jsx("div",{className:"stat-label",children:"Valor Total"}),e.jsxs("div",{className:"stat-secondary",children:["Promedio: ",G(s.averageValue)]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"⛽"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:z(s.totalQuantity)}),e.jsx("div",{className:"stat-label",children:"Galones Total"}),e.jsxs("div",{className:"stat-secondary",children:["Promedio: ",z(s.totalQuantity/(s.totalMovements||1))," gal/mov"]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"📅"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:z(s.thisWeek)}),e.jsx("div",{className:"stat-label",children:"Esta Semana"}),e.jsxs("div",{className:"stat-secondary",children:[z(s.thisMonth)," este mes"]})]})]})]}),e.jsxs("div",{className:"stats-breakdown",children:[e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h4",{children:"📋 Por Tipo de Movimiento"}),e.jsx("div",{className:"breakdown-grid",children:Object.entries(s.byType).map(([i,o])=>{const y=(o/s.totalMovements*100).toFixed(1);return e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-header",children:[e.jsx("span",{className:"breakdown-icon",children:v(i)}),e.jsx("span",{className:"breakdown-label",children:i.charAt(0).toUpperCase()+i.slice(1)})]}),e.jsx("div",{className:"breakdown-value",children:o}),e.jsx("div",{className:"breakdown-bar",children:e.jsx("div",{className:"breakdown-fill",style:{width:`${y}%`,backgroundColor:S(i)}})}),e.jsxs("div",{className:"breakdown-percentage",children:[y,"%"]})]},i)})})]}),e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h4",{children:"⚡ Por Estado"}),e.jsx("div",{className:"breakdown-grid",children:Object.entries(s.byStatus).map(([i,o])=>{const y=(o/s.totalMovements*100).toFixed(1),f=u=>{switch(u){case P.COMPLETADO:return"#10b981";case P.PENDIENTE:return"#f59e0b";case P.CANCELADO:return"#ef4444";default:return"#6b7280"}},b=u=>{switch(u){case P.COMPLETADO:return"✅";case P.PENDIENTE:return"⏳";case P.CANCELADO:return"❌";default:return"❓"}};return e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-header",children:[e.jsx("span",{className:"breakdown-icon",children:b(i)}),e.jsx("span",{className:"breakdown-label",children:i.charAt(0).toUpperCase()+i.slice(1)})]}),e.jsx("div",{className:"breakdown-value",children:o}),e.jsx("div",{className:"breakdown-bar",children:e.jsx("div",{className:"breakdown-fill",style:{width:`${y}%`,backgroundColor:f(i)}})}),e.jsxs("div",{className:"breakdown-percentage",children:[y,"%"]})]},i)})})]}),e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h4",{children:"⛽ Por Tipo de Combustible"}),e.jsx("div",{className:"breakdown-grid",children:Object.entries(s.byFuelType).map(([i,o])=>{const y=(o/s.totalMovements*100).toFixed(1),f=b=>{switch(b?.toLowerCase()){case"diesel":return"🚛";case"gasolina":return"🚗";case"acpm":return"🚚";case"lubricante":return"🛢️";default:return"⛽"}};return e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-header",children:[e.jsx("span",{className:"breakdown-icon",children:f(i)}),e.jsx("span",{className:"breakdown-label",children:i})]}),e.jsx("div",{className:"breakdown-value",children:o}),e.jsx("div",{className:"breakdown-bar",children:e.jsx("div",{className:"breakdown-fill",style:{width:`${y}%`,backgroundColor:"#059669"}})}),e.jsxs("div",{className:"breakdown-percentage",children:[y,"%"]})]},i)})})]})]}),(x.type||x.status||x.fuelType||x.vehicleId)&&e.jsxs("div",{className:"active-filters",children:[e.jsx("h4",{children:"🔍 Filtros Activos"}),e.jsxs("div",{className:"filters-list",children:[x.type&&e.jsxs("span",{className:"filter-tag",children:["Tipo: ",x.type]}),x.status&&e.jsxs("span",{className:"filter-tag",children:["Estado: ",x.status]}),x.fuelType&&e.jsxs("span",{className:"filter-tag",children:["Combustible: ",x.fuelType]}),x.vehicleId&&e.jsxs("span",{className:"filter-tag",children:["Vehículo: ",x.vehicleId]})]})]})]})},te=({filters:s,onFilterChange:x,onClearFilters:k,searchTerm:S,onSearchChange:v,totalResults:E})=>{const[i,o]=j.useState(!1),y=[{value:"Diesel",label:"Diesel 🚛"},{value:"Gasolina",label:"Gasolina 🚗"},{value:"ACPM",label:"ACPM 🚚"},{value:"Lubricante",label:"Lubricante 🛢️"}],f=[{value:"all",label:"Todos los períodos"},{value:"today",label:"Hoy"},{value:"week",label:"Esta semana"},{value:"month",label:"Este mes"},{value:"quarter",label:"Este trimestre"},{value:"year",label:"Este año"}],b=Object.values(s).filter(l=>l&&l!==""&&l!=="all").length,u=(l,w)=>{x({[l]:w})},g=l=>{x(l)};return e.jsxs("div",{className:"movements-filters",children:[e.jsxs("div",{className:"filters-main",children:[e.jsx("div",{className:"search-section",children:e.jsxs("div",{className:"search-box",children:[e.jsx("span",{className:"search-icon",children:"🔍"}),e.jsx("input",{type:"text",placeholder:"Buscar por combustible, vehículo, referencia...",value:S,onChange:l=>v(l.target.value),className:"search-input"}),S&&e.jsx("button",{className:"search-clear",onClick:()=>v(""),title:"Limpiar búsqueda",children:"✕"})]})}),e.jsxs("div",{className:"filters-controls",children:[e.jsxs("div",{className:"quick-filters",children:[e.jsx("button",{className:`quick-filter ${s.type===n.ENTRADA?"active":""}`,onClick:()=>g({type:n.ENTRADA}),children:"📥 Entradas"}),e.jsx("button",{className:`quick-filter ${s.type===n.SALIDA?"active":""}`,onClick:()=>g({type:n.SALIDA}),children:"📤 Salidas"}),e.jsx("button",{className:`quick-filter ${s.status===P.PENDIENTE?"active":""}`,onClick:()=>g({status:P.PENDIENTE}),children:"⏳ Pendientes"})]}),e.jsxs("button",{className:`btn-advanced-filters ${i?"active":""}`,onClick:()=>o(!i),children:["🎛️ Filtros",b>0&&e.jsx("span",{className:"filters-count",children:b})]}),e.jsx("div",{className:"view-indicator",children:e.jsx("span",{className:"view-info",children:"📋 Vista Tabla"})})]})]}),i&&e.jsxs("div",{className:"filters-advanced",children:[e.jsxs("div",{className:"filters-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Tipo de Movimiento"}),e.jsxs("select",{value:s.type,onChange:l=>u("type",l.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"Todos los tipos"}),e.jsx("option",{value:n.ENTRADA,children:"📥 Entrada"}),e.jsx("option",{value:n.SALIDA,children:"📤 Salida"}),e.jsx("option",{value:n.TRANSFERENCIA,children:"🔄 Transferencia"}),e.jsx("option",{value:n.AJUSTE,children:"⚖️ Ajuste"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Estado"}),e.jsxs("select",{value:s.status,onChange:l=>u("status",l.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:P.PENDIENTE,children:"⏳ Pendiente"}),e.jsx("option",{value:P.COMPLETADO,children:"✅ Completado"}),e.jsx("option",{value:P.CANCELADO,children:"❌ Cancelado"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Tipo de Combustible"}),e.jsxs("select",{value:s.fuelType,onChange:l=>u("fuelType",l.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"Todos los combustibles"}),y.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Período"}),e.jsx("select",{value:s.dateRange,onChange:l=>u("dateRange",l.target.value),className:"filter-select",children:f.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Vehículo/Equipo"}),e.jsx("input",{type:"text",placeholder:"ID del vehículo...",value:s.vehicleId,onChange:l=>u("vehicleId",l.target.value),className:"filter-input"})]})]}),e.jsxs("div",{className:"filters-actions",children:[e.jsx("button",{className:"btn-clear-filters",onClick:k,disabled:b===0,children:"🗑️ Limpiar Filtros"}),e.jsxs("div",{className:"filters-info",children:[e.jsxs("span",{className:"results-count",children:[E," resultado",E!==1?"s":""]}),b>0&&e.jsxs("span",{className:"active-filters-text",children:["(",b," filtro",b!==1?"s":""," activo",b!==1?"s":"",")"]})]})]})]}),e.jsx("div",{className:"keyboard-shortcuts",style:{display:"none"},children:e.jsx("small",{children:"💡 Atajos: Ctrl+F (buscar), Ctrl+1 (entradas), Ctrl+2 (salidas), Ctrl+3 (pendientes)"})})]})},ie=({movements:s,onEdit:x,onView:k,onApprove:S,onReject:v,onDelete:E,userRole:i})=>{const[o,y]=j.useState("createdAt"),[f,b]=j.useState("desc"),u=a=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),g=a=>a?(a instanceof Date?a:new Date(a)).toLocaleDateString("es-CO",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):"Sin fecha",l=a=>{switch(a){case n.ENTRADA:return"📥";case n.SALIDA:return"📤";case n.TRANSFERENCIA:return"🔄";case n.AJUSTE:return"⚖️";default:return"📋"}},w=a=>{switch(a?.toLowerCase()){case"diesel":return"🚛";case"gasolina":return"🚗";case"acpm":return"🚚";case"lubricante":return"🛢️";default:return"⛽"}},T=a=>{switch(a){case P.COMPLETADO:return"✅";case P.PENDIENTE:return"⏳";case P.CANCELADO:return"❌";default:return"❓"}},t=a=>{switch(a){case P.COMPLETADO:return"status-completado";case P.PENDIENTE:return"status-pendiente";case P.CANCELADO:return"status-cancelado";default:return"status-default"}},c=a=>{o===a?b(f==="asc"?"desc":"asc"):(y(a),b("asc"))},m=[...s].sort((a,r)=>{let h=a[o],N=r[o];return(o.includes("Date")||o.includes("At"))&&(h=new Date(h),N=new Date(N)),typeof h=="number"&&typeof N=="number"?f==="asc"?h-N:N-h:typeof h=="string"&&typeof N=="string"?f==="asc"?h.localeCompare(N):N.localeCompare(h):h instanceof Date&&N instanceof Date?f==="asc"?h-N:N-h:0}),p=a=>o!==a?"↕️":f==="asc"?"↑":"↓";return e.jsxs("div",{className:"movements-table-container",children:[e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"movements-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{className:"sortable",onClick:()=>c("type"),children:["Tipo ",p("type")]}),e.jsxs("th",{className:"sortable",onClick:()=>c("fuelType"),children:["Combustible ",p("fuelType")]}),e.jsxs("th",{className:"sortable text-right",onClick:()=>c("quantity"),children:["Cantidad ",p("quantity")]}),e.jsxs("th",{className:"sortable text-right",onClick:()=>c("unitPrice"),children:["Precio/Gal ",p("unitPrice")]}),e.jsxs("th",{className:"sortable text-right",onClick:()=>c("totalValue"),children:["Valor Total ",p("totalValue")]}),e.jsx("th",{children:"Vehículo"}),e.jsx("th",{children:"Ubicación"}),e.jsxs("th",{className:"sortable",onClick:()=>c("status"),children:["Estado ",p("status")]}),e.jsxs("th",{className:"sortable",onClick:()=>c("createdAt"),children:["Fecha ",p("createdAt")]}),e.jsx("th",{className:"actions-column",children:"Acciones"})]})}),e.jsx("tbody",{children:m.map(a=>e.jsxs("tr",{className:`movement-row ${a.status===P.PENDIENTE?"pending-row":""}`,children:[e.jsx("td",{className:"type-cell",children:e.jsxs("div",{className:"type-content",children:[e.jsx("span",{className:"type-icon",children:l(a.type)}),e.jsx("span",{className:"type-text",children:a.type?a.type.charAt(0).toUpperCase()+a.type.slice(1):"Sin tipo"})]})}),e.jsx("td",{className:"fuel-cell",children:e.jsxs("div",{className:"fuel-content",children:[e.jsx("span",{className:"fuel-icon",children:w(a.fuelType)}),e.jsx("span",{className:"fuel-text",children:a.fuelType})]})}),e.jsxs("td",{className:"quantity-cell text-right",children:[e.jsx("span",{className:"quantity-value",children:a.quantity}),e.jsx("span",{className:"quantity-unit",children:"gal"})]}),e.jsx("td",{className:"price-cell text-right",children:u(a.unitPrice)}),e.jsx("td",{className:"value-cell text-right",children:e.jsx("strong",{children:u(a.totalValue)})}),e.jsx("td",{className:"vehicle-cell",children:a.vehicleId?e.jsxs("span",{className:"vehicle-id",children:["🚜 ",a.vehicleId]}):e.jsx("span",{className:"no-vehicle",children:"-"})}),e.jsx("td",{className:"location-cell",children:e.jsxs("span",{className:"location-text",children:["📍 ",a.type===n.ENTRADA?a.destinationLocation||"Sin ubicación":a.location||"Principal"]})}),e.jsx("td",{className:"status-cell",children:e.jsxs("div",{className:`status-badge ${t(a.status)}`,children:[e.jsx("span",{className:"status-icon",children:T(a.status)}),e.jsx("span",{className:"status-text",children:a.status?a.status.charAt(0).toUpperCase()+a.status.slice(1):"Sin estado"})]})}),e.jsx("td",{className:"date-cell",children:e.jsxs("div",{className:"date-content",children:[e.jsx("span",{className:"date-value",children:g(a.createdAt)}),a.reference&&e.jsxs("span",{className:"reference-small",children:["#",a.reference]})]})}),e.jsx("td",{className:"actions-cell",children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn-action btn-view",onClick:()=>k(a),title:"Ver detalles",children:"👁️"}),i==="admin"&&a.status===P.PENDIENTE&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-action btn-approve",onClick:()=>S(a.id),title:"Aprobar movimiento",children:"✓"}),e.jsx("button",{className:"btn-action btn-reject",onClick:()=>v(a.id),title:"Rechazar movimiento",children:"✗"})]}),x&&a.status===P.PENDIENTE&&e.jsx("button",{className:"btn-action btn-edit",onClick:()=>x(a),title:"Editar movimiento",children:"✏️"}),i==="admin"&&e.jsx("button",{className:"btn-action btn-delete",onClick:()=>{window.confirm("¿Estás seguro de que deseas eliminar este movimiento? Esta acción no se puede deshacer.")&&E(a.id)},title:"Eliminar movimiento",children:"🗑️"})]})})]},a.id))})]})}),e.jsxs("div",{className:"table-info",children:[e.jsxs("div",{className:"table-summary",children:[e.jsxs("span",{className:"total-rows",children:[s.length," movimiento",s.length!==1?"s":""]}),o&&e.jsxs("span",{className:"sort-info",children:["Ordenado por ",o," (",f==="asc"?"ascendente":"descendente",")"]})]}),e.jsxs("div",{className:"table-legend",children:[e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-icon",children:"⏳"})," Pendiente"]}),e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-icon",children:"✅"})," Completado"]}),e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-icon",children:"❌"})," Cancelado"]})]})]})]})},ne=({movements:s,onEdit:x,onView:k,onApprove:S,onReject:v,onDelete:E,userRole:i})=>e.jsx(ie,{movements:s,onEdit:x,onView:k,onApprove:S,onReject:v,onDelete:E,userRole:i}),le=({formData:s,updateFormData:x,setError:k,isActive:S})=>{const v=[{type:n.ENTRADA,icon:"📥",title:"Entrada de Combustible",description:"Registrar combustible que llega de proveedores",color:"entrada",details:"Para compras, reabastecimientos y recepciones"},{type:n.SALIDA,icon:"⛽",title:"Salida de Combustible",description:"Asignar combustible a vehículos y equipos",color:"salida",details:"Para consumo y operaciones de campo"},{type:n.TRANSFERENCIA,icon:"🔄",title:"Transferencia",description:"Mover combustible entre ubicaciones",color:"transferencia",details:"Entre tanques, sitios o almacenes"},{type:n.AJUSTE,icon:"⚖️",title:"Ajuste de Inventario",description:"Corregir stock por diferencias o calibraciones",color:"ajuste",details:"Para mermas, pérdidas o correcciones"}],E=i=>{x("type",i),k("")};return j.useEffect(()=>{if(!S)return;const i=o=>{const y=parseInt(o.key);if(y>=1&&y<=4){const f=v[y-1];E(f.type)}};return window.addEventListener("keypress",i),()=>window.removeEventListener("keypress",i)},[S]),e.jsx("div",{className:`wizard-step step-movement-type ${S?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h2",{children:"🌿 ¡Hola! ¿Qué operación necesitas registrar hoy?"}),e.jsx("p",{children:"Selecciona el tipo de movimiento que vas a realizar"})]}),e.jsx("div",{className:"typeform-options",children:v.map((i,o)=>e.jsxs("div",{className:`typeform-option ${s.type===i.type?"selected":""} ${i.color}`,onClick:()=>E(i.type),children:[e.jsx("div",{className:"typeform-option-icon",children:i.icon}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsx("h4",{children:i.title}),e.jsx("p",{children:i.description})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"✓"})})})]},i.type))}),s.type&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card",children:[e.jsx("span",{className:"confirmation-icon",children:v.find(i=>i.type===s.type)?.icon}),e.jsxs("div",{className:"confirmation-text",children:[e.jsx("strong",{children:"Perfecto! Has seleccionado:"})," ",v.find(i=>i.type===s.type)?.title,e.jsx("br",{}),e.jsx("small",{children:v.find(i=>i.type===s.type)?.details})]})]})})]})})},ce=({formData:s,updateFormData:x,systemData:k,setError:S,isActive:v})=>{const[E,i]=j.useState(!1),[o,y]=j.useState(null),{products:f}=k;j.useEffect(()=>{if(s.fuelType&&f.length>0){const u=f.find(g=>g.name===s.fuelType||g.displayName===s.fuelType);y(u),u&&u.defaultPrice&&!s.unitPrice&&x("unitPrice",u.defaultPrice.toString())}},[s.fuelType,s.unitPrice,f,x]),j.useEffect(()=>{if(!v)return;const u=g=>{const l=parseInt(g.key);if(l>=1&&l<=f.length){const w=f[l-1];b(w.name,w)}};return window.addEventListener("keypress",u),()=>window.removeEventListener("keypress",u)},[v,f]);const b=async(u,g)=>{i(!0),S("");try{await new Promise(l=>setTimeout(l,800)),x("fuelType",u),y(g),g.defaultPrice&&x("unitPrice",g.defaultPrice.toString()),console.log("🔄 [Step2] Combustible seleccionado:",u,"Precio:",g.defaultPrice)}catch(l){console.error("Error al cargar combustible:",l),S("Error al cargar información del combustible")}finally{i(!1)}};return f.length===0?e.jsx("div",{className:`wizard-step step-fuel-type ${v?"active":""}`,children:e.jsx("div",{className:"typeform-layout",children:e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"🔄 Cargando productos disponibles..."})]})})}):e.jsx("div",{className:`wizard-step step-fuel-type ${v?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h2",{children:"⛽ ¿Qué tipo de combustible necesitas?"}),e.jsx("p",{children:"Elige el producto que vas a mover"})]}),E&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"📡 Actualizando precios..."})]}),e.jsx("div",{className:"typeform-options",children:f.map((u,g)=>e.jsxs("div",{className:`typeform-option ${s.fuelType===u.name?"selected":""} ${E?"disabled":""}`,onClick:()=>!E&&b(u.name,u),children:[e.jsx("div",{className:"typeform-option-icon",children:u.icon||"🛢️"}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsx("h4",{children:u.displayName||u.name}),e.jsx("p",{children:u.description||"Combustible premium"}),u.defaultPrice&&e.jsx("div",{className:"fuel-price",children:e.jsxs("span",{className:"price-value",children:["$",u.defaultPrice.toLocaleString("es-CO")," COP/galón"]})})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"✓"})})})]},u.id))}),o&&s.fuelType&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card fuel-confirmation",children:[e.jsxs("div",{className:"confirmation-header",children:[e.jsx("span",{className:"confirmation-icon",children:o.icon||"🛢️"}),e.jsxs("div",{className:"confirmation-text",children:[e.jsxs("strong",{children:["Excelente! Has elegido ",o.displayName||o.name]}),e.jsx("br",{}),e.jsx("small",{children:o.description||"Combustible de calidad premium"})]})]}),o.defaultPrice&&e.jsxs("div",{className:"price-confirmation",children:[e.jsxs("div",{className:"price-info",children:[e.jsx("span",{className:"price-label",children:"💰 Precio actual:"}),e.jsxs("span",{className:"price-amount",children:["$",o.defaultPrice.toLocaleString("es-CO")," COP/galón"]})]}),e.jsx("small",{className:"price-note",children:"✨ Aplicamos el precio automáticamente (lo puedes ajustar después)"})]})]})})]})})},re=({formData:s,updateFormData:x,systemData:k,setError:S,isActive:v})=>{const[E,i]=j.useState(!1),[o,y]=j.useState({}),[f,b]=j.useState(!1),{suppliers:u,inventory:g}=k,l=s.type===n.ENTRADA;j.useEffect(()=>{if(!v)return;const c=m=>{const p=parseInt(m.key);if(l){const a=u.filter(r=>r.status==="active");if(p>=1&&p<=a.length){const r=a[p-1];w(r.name)}}else if(p>=1&&p<=V.length){const a=V[p-1];w(a)}};return window.addEventListener("keypress",c),()=>window.removeEventListener("keypress",c)},[v,u,l]),j.useEffect(()=>{(async()=>{if(!l&&s.fuelType&&g.length>0){b(!0),await new Promise(p=>setTimeout(p,600));const m={};V.forEach(p=>{const a=g.filter(I=>I.fuelType===s.fuelType&&I.location?.toLowerCase()===p.toLowerCase()&&I.status==="active"),r=a.reduce((I,L)=>I+(parseFloat(L.currentStock)||0),0),h=a.reduce((I,L)=>I+(parseFloat(L.maxCapacity)||0),0);let N="available",F=`${r.toFixed(0)} galones disponibles`;r===0?(N="empty",F="Sin combustible disponible"):r<h*.2&&(N="low",F=`${r.toFixed(0)} gal (stock bajo)`),m[p]={available:r,maxCapacity:h,status:N,message:F,percentage:h>0?r/h*100:0}}),y(m),b(!1)}})()},[s.fuelType,l,g]);const w=async c=>{i(!0),S("");try{await new Promise(m=>setTimeout(m,400)),x(l?"supplierName":"location",c)}catch{S("Error al validar la ubicación")}finally{i(!1)}},T=c=>{switch(c.toLowerCase()){case"oficina principal":return"🏢";case"tanque central":return"⛽";case"almacén norte":return"🏭";case"zona sur":return"🌎";case"taller mecánico":return"🔧";default:return"📍"}},t=()=>{switch(s.type){case n.ENTRADA:return"¿De dónde viene el combustible?";case n.SALIDA:return"¿De qué ubicación tomarás el combustible?";case n.TRANSFERENCIA:return"¿Desde dónde quieres transferir?";case n.AJUSTE:return"¿En qué ubicación harás el ajuste?";default:return"¿Cuál es la ubicación?"}};if(l){const c=u.filter(m=>m.status==="active");return e.jsx("div",{className:`wizard-step step-location ${v?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsxs("h2",{children:["🏪 ",t()]}),e.jsx("p",{children:"Selecciona el proveedor que está enviando el combustible"})]}),E&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"🔄 Validando proveedor..."})]}),e.jsx("div",{className:"typeform-options",children:c.map((m,p)=>e.jsxs("div",{className:`typeform-option ${s.supplierName===m.name?"selected":""} ${E?"disabled":""}`,onClick:()=>!E&&w(m.name),children:[e.jsx("div",{className:"typeform-option-icon",children:"🏪"}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsx("h4",{children:m.name}),e.jsx("p",{children:m.location||"Proveedor de combustibles"}),m.contact&&e.jsxs("small",{className:"supplier-contact",children:["📞 ",m.contact]})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"✓"})})})]},m.id))}),s.supplierName&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card",children:[e.jsx("span",{className:"confirmation-icon",children:"🏪"}),e.jsxs("div",{className:"confirmation-text",children:[e.jsxs("strong",{children:["Genial! Recibirás combustible de ",s.supplierName]}),e.jsx("br",{}),e.jsx("small",{children:"El combustible será registrado en el inventario"})]})]})})]})})}return e.jsx("div",{className:`wizard-step step-location ${v?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsxs("h2",{children:["📍 ",t()]}),e.jsx("p",{children:"Elige la ubicación donde está almacenado el combustible"})]}),f&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"⚙️ Verificando stock por ubicación..."})]}),e.jsx("div",{className:"typeform-options",children:V.map((c,m)=>{const p=o[c]||{},a=s.location===c;return e.jsxs("div",{className:`typeform-option ${a?"selected":""} ${p.status||""} ${E?"disabled":""}`,onClick:()=>!E&&w(c),children:[e.jsx("div",{className:"typeform-option-icon",children:T(c)}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsx("h4",{children:$(c)}),e.jsx("p",{children:p.message||"Verificando disponibilidad..."}),p.available>0&&e.jsx("div",{className:"stock-indicator",children:e.jsx("div",{className:"stock-bar-mini",children:e.jsx("div",{className:"stock-fill-mini",style:{width:`${Math.min(p.percentage,100)}%`}})})})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"✓"})})})]},c)})}),s.location&&o[s.location]&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card",children:[e.jsx("span",{className:"confirmation-icon",children:T(s.location)}),e.jsxs("div",{className:"confirmation-text",children:[e.jsxs("strong",{children:["Excelente! Usarás ",$(s.location)]}),e.jsx("br",{}),e.jsx("small",{children:o[s.location].message})]})]})})]})})},oe=({formData:s,updateFormData:x,systemData:k,setError:S,isActive:v})=>{const[E,i]=j.useState(!1),[o,y]=j.useState(null),[f,b]=j.useState(""),u=j.useRef(null),{inventory:g}=k,l=s.type===n.SALIDA||s.type===n.TRANSFERENCIA;j.useEffect(()=>{v&&u.current&&setTimeout(()=>u.current.focus(),300)},[v]),j.useEffect(()=>{if(!v)return;const m=p=>{p.key==="Enter"&&s.quantity&&parseFloat(s.quantity)>0};return window.addEventListener("keypress",m),()=>window.removeEventListener("keypress",m)},[v,s.quantity]),j.useEffect(()=>{(async()=>{if(l&&s.fuelType&&s.location&&g.length>0){i(!0),await new Promise(L=>setTimeout(L,500));const p=g.filter(L=>L.fuelType===s.fuelType&&L.location?.toLowerCase()===s.location?.toLowerCase()&&L.status==="active").reduce((L,C)=>L+(parseFloat(C.currentStock)||0),0),a=parseFloat(s.quantity)||0,r=p-a;let h="available",N="✅",F="Stock Disponible",I="Perfecto, hay suficiente combustible.";if(a>0&&(p<a?(h="critical",N="🚫",F="Cantidad No Disponible",I=`Solo hay ${p.toFixed(2)} galones disponibles`):r<p*.2?(h="warning",N="⚠️",F="Stock Quedará Bajo",I=`Quedarán solo ${r.toFixed(2)} galones`):I=`Quedarán ${r.toFixed(2)} galones en stock`),y({available:p,required:a,remaining:Math.max(0,r),status:h,icon:N,title:F,message:I,isValid:p>=a}),a>0&&l){const L={type:s.type===n.SALIDA?"outbound":"transfer",fuelType:s.fuelType,quantity:s.quantity,sourceLocation:s.location},C=J(L,g);C.isValid?C.warning?b(`⚠️ ${C.warning}`):b(""):b(`🚫 ${C.error}`)}else l||b("");i(!1)}})()},[s.quantity,s.fuelType,s.location,s.type,l,g]);const w=m=>{const p=parseFloat(m);(m===""||!isNaN(p)&&p>=0)&&(x("quantity",m),S(""))},T=()=>{if(!o||!o.available)return[];const m=o.available;return[{label:"25 gal",value:"25"},{label:"50 gal",value:"50"},{label:"100 gal",value:"100"},{label:`${m.toFixed(0)} gal`,value:m.toFixed(1)}]},t=()=>{switch(s.type){case n.ENTRADA:return"📥";case n.SALIDA:return"⛽";case n.TRANSFERENCIA:return"🔄";case n.AJUSTE:return"⚖️";default:return"📊"}},c=()=>{switch(s.type){case n.ENTRADA:return"¿Cuántos galones estás recibiendo?";case n.SALIDA:return"¿Cuántos galones necesitas entregar?";case n.TRANSFERENCIA:return"¿Cuántos galones vas a transferir?";case n.AJUSTE:return"¿Cuál es la cantidad del ajuste?";default:return"¿Cuántos galones necesitas?"}};return e.jsx("div",{className:`wizard-step step-quantity ${v?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsxs("h2",{children:[t()," ",c()]}),e.jsx("p",{children:"Ingresa la cantidad en galones"})]}),e.jsxs("div",{className:"typeform-input-section",children:[e.jsx("input",{ref:u,id:"quantity",type:"number",step:"0.1",min:"0",value:s.quantity,onChange:m=>w(m.target.value),placeholder:"0",className:`typeform-input ${f?"error":""}`,autoComplete:"off"}),e.jsx("span",{className:"typeform-unit",children:"galones"})]}),o&&o.available>0&&e.jsxs("div",{className:"typeform-suggestions",children:[e.jsx("label",{className:"typeform-suggestions-label",children:"Cantidades comunes:"}),e.jsx("div",{className:"typeform-suggestions-buttons",children:T().map((m,p)=>e.jsx("button",{type:"button",className:"typeform-suggestion-btn",onClick:()=>w(m.value),children:m.label},p))})]}),E&&e.jsxs("div",{className:"calculating-indicator",children:[e.jsx("div",{className:"loading-spinner small"}),e.jsx("span",{children:"⚙️ Verificando disponibilidad..."})]}),o&&l&&!E&&e.jsxs("div",{className:`stock-info-container ${o.status}`,children:[e.jsxs("div",{className:"stock-info-header",children:[e.jsx("div",{className:"stock-info-icon",children:o.icon}),e.jsx("h4",{className:"stock-info-title",children:o.title})]}),e.jsx("div",{className:"stock-info-message",children:o.message})]}),f&&e.jsx("div",{className:"validation-warning",children:f}),s.quantity&&parseFloat(s.quantity)>0&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card",children:[e.jsx("span",{className:"confirmation-icon",children:t()}),e.jsxs("div",{className:"confirmation-text",children:[e.jsxs("strong",{children:["Perfecto! ",parseFloat(s.quantity).toLocaleString("es-CO")," galones"]}),e.jsx("br",{}),e.jsx("small",{children:l?`Saldrán del inventario de ${s.location}`:"Se agregarán al inventario"})]})]})})]})})},de=({formData:s,updateFormData:x,systemData:k,setError:S,isActive:v})=>{const[E,i]=j.useState(!1),[o,y]=j.useState(null),[f,b]=j.useState(!1),[u,g]=j.useState(""),l=j.useRef(null),{vehicles:w}=k;if(s.type!==n.SALIDA)return null;j.useEffect(()=>{if(!v)return;const r=h=>{const N=t(),F=parseInt(h.key);if(F>=1&&F<=N.length){const I=N[F-1];c(I)}};return window.addEventListener("keypress",r),()=>window.removeEventListener("keypress",r)},[v,w,s.fuelType]),j.useEffect(()=>{if(s.vehicleId&&w.length>0){const r=w.find(N=>N.vehicleId===s.vehicleId);y(r);const h=T(r);b(h),h&&l.current&&setTimeout(()=>l.current.focus(),500)}},[s.vehicleId,w]);const T=r=>{if(!r)return!1;const h=r.fuelType==="diesel"||r.fuelType==="Diesel",N=r.category==="tractor"||r.type?.toLowerCase().includes("tractor");return h||N},t=()=>s.fuelType?w.filter(r=>{const h=r.fuelType?.toLowerCase(),N=s.fuelType?.toLowerCase();return h===N||N==="diesel"&&h==="diesel"||N==="gasolina"&&h==="gasolina"}):w,c=async r=>{i(!0),S(""),g("");try{await new Promise(N=>setTimeout(N,400)),x("vehicleId",r.vehicleId),y(r);const h=T(r);b(h),h||x("currentHours","")}catch{S("Error al seleccionar vehículo")}finally{i(!1)}},m=r=>{const h=parseFloat(r);r===""||!isNaN(h)&&h>=0?(x("currentHours",r),g("")):g("Ingresa un valor válido de horómetro")},p=r=>{const h=r.category?.toLowerCase()||"",N=r.type?.toLowerCase()||"";return h.includes("tractor")||N.includes("tractor")?"🚜":h.includes("excavadora")||N.includes("excavadora")?"🦕":h.includes("volqueta")||N.includes("volqueta")?"🚛":h.includes("moto")||N.includes("moto")?"🏍️":h.includes("carro")||N.includes("carro")?"🚗":"🚙"},a=t();return a.length===0?e.jsx("div",{className:`wizard-step step-vehicle ${v?"active":""}`,children:e.jsx("div",{className:"typeform-layout",children:e.jsxs("div",{className:"typeform-question",children:[e.jsx("h2",{children:"🚫 No hay vehículos compatibles"}),e.jsxs("p",{children:["No se encontraron vehículos que usen ",s.fuelType]})]})})}):e.jsx("div",{className:`wizard-step step-vehicle ${v?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h2",{children:"🚗 ¿A qué vehículo le darás combustible?"}),e.jsxs("p",{children:["Selecciona el vehículo o equipo que recibirá el ",s.fuelType]})]}),E&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"🔄 Validando vehículo..."})]}),e.jsx("div",{className:"typeform-options",children:a.map((r,h)=>e.jsxs("div",{className:`typeform-option ${s.vehicleId===r.vehicleId?"selected":""} ${E?"disabled":""}`,onClick:()=>!E&&c(r),children:[e.jsx("div",{className:"typeform-option-icon",children:p(r)}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsxs("h4",{children:[r.vehicleId," - ",r.brand||"Vehículo"]}),e.jsx("p",{children:r.model||r.type||"Equipo de trabajo"}),r.currentHours&&e.jsxs("small",{className:"vehicle-hours",children:["🕐 ",r.currentHours," horas registradas"]})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"✓"})})})]},r.id))}),f&&o&&e.jsxs("div",{className:"typeform-input-section",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h3",{children:"🕐 ¿Cuál es el horómetro actual?"}),e.jsxs("p",{children:["Ingresa las horas actuales de ",o.vehicleId]})]}),e.jsx("input",{ref:l,type:"number",step:"0.1",min:"0",value:s.currentHours||"",onChange:r=>m(r.target.value),placeholder:"0",className:`typeform-input ${u?"error":""}`,autoComplete:"off"}),e.jsx("span",{className:"typeform-unit",children:"horas"}),u&&e.jsx("div",{className:"validation-warning",children:u})]}),o&&s.vehicleId&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card",children:[e.jsx("span",{className:"confirmation-icon",children:p(o)}),e.jsxs("div",{className:"confirmation-text",children:[e.jsxs("strong",{children:["Perfecto! Combustible para ",o.vehicleId]}),e.jsx("br",{}),e.jsxs("small",{children:[o.brand," ",o.model,f&&s.currentHours&&` - Horómetro: ${s.currentHours} horas`]})]})]})})]})})},B=({formData:s,updateFormData:x,systemData:k,setError:S,isEntryDestination:v=!1,isActive:E})=>{const[i,o]=j.useState(!1),[y,f]=j.useState({}),[b,u]=j.useState(!1),{inventory:g}=k;j.useEffect(()=>{(async()=>{if(s.fuelType&&s.quantity&&g.length>0&&!v){u(!0),await new Promise(m=>setTimeout(m,700));const t=parseFloat(s.quantity)||0,c={};V.filter(m=>v?!0:m!==s.location).forEach(m=>{const p=g.filter(C=>C.fuelType===s.fuelType&&C.location?.toLowerCase()===m.toLowerCase()&&C.status==="active").reduce((C,A)=>C+(parseFloat(A.currentStock)||0),0),a=g.filter(C=>C.fuelType===s.fuelType&&C.location?.toLowerCase()===m.toLowerCase()&&C.status==="active").reduce((C,A)=>C+(parseFloat(A.maxCapacity)||0),0),r=a-p,h=p+t,N=a>0?h/a*100:0;let F="available",I=`Capacidad: ${r.toFixed(1)} gal libres`,L=r>=t;a===0?(F="no_capacity",I="Sin tanques configurados",L=!1):r<t?(F="insufficient",I=`Insuficiente: faltan ${(t-r).toFixed(1)} gal`,L=!1):N>90&&(F="warning",I=`Quedará al ${N.toFixed(1)}% (casi lleno)`),c[m]={currentStock:p,maxCapacity:a,availableCapacity:r,afterTransfer:h,occupancyAfter:N,status:F,message:I,canAcceptTransfer:L}}),f(c),u(!1),console.log("🔍 Capacidad validada por destino:",c)}})()},[s.fuelType,s.quantity,s.location,g,v]);const l=async T=>{const t=y[T];if(!v&&!t?.canAcceptTransfer){S("Esta ubicación no puede recibir la cantidad solicitada");return}o(!0),S("");try{await new Promise(c=>setTimeout(c,500)),x("destinationLocation",T),console.log("🎯 Destino seleccionado:",T)}catch(c){console.error("Error al validar destino:",c),S("Error al validar el destino")}finally{o(!1)}};if(!v&&s.type!==n.TRANSFERENCIA)return null;const w=v?W:V.filter(T=>T!==s.location);return e.jsx("div",{className:`wizard-step step-destination ${E?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsxs("h3",{children:["🎯 ",v?"¿A qué ubicación llegará el combustible?":"¿Hacia qué ubicación se transfiere?"]}),e.jsx("p",{children:"Selecciona la ubicación de destino:"})]}),b&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"🔍 Verificando capacidad disponible..."})]}),e.jsx("div",{className:"typeform-options",children:w.map(T=>{const t=y[T],c=!t||t.canAcceptTransfer;return e.jsxs("div",{className:`typeform-option ${s.destinationLocation===T?"selected":""} 
                           ${t?.status||"unknown"} ${!c||i?"disabled":""}`,onClick:()=>c&&!i&&l(T),children:[e.jsx("div",{className:"typeform-option-icon",children:"🎯"}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsx("h4",{children:$(T)}),t&&e.jsxs("div",{className:"capacity-info",children:[e.jsx("p",{className:"capacity-message",children:t.message}),t.maxCapacity>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"capacity-bar-mini",children:[e.jsx("div",{className:"capacity-current-mini",style:{width:`${Math.min(100,t.currentStock/t.maxCapacity*100)}%`}}),t.canAcceptTransfer&&e.jsx("div",{className:"capacity-after-mini",style:{width:`${Math.min(100,t.occupancyAfter)}%`,left:`${Math.min(100,t.currentStock/t.maxCapacity*100)}%`}})]}),e.jsxs("small",{className:"capacity-details",children:["Actual: ",t.currentStock.toFixed(1),"/",t.maxCapacity.toFixed(1)," gal"]})]})]})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"✓"})})})]},T)})}),s.location&&s.quantity&&e.jsx("div",{className:"transfer-summary",children:e.jsxs("div",{className:"transfer-flow",children:[e.jsxs("div",{className:"transfer-origin",children:[e.jsx("span",{className:"transfer-icon",children:"📍"}),e.jsxs("div",{className:"transfer-info",children:[e.jsx("strong",{children:$(s.location)}),e.jsx("small",{children:"Origen"})]})]}),e.jsxs("div",{className:"transfer-arrow",children:[e.jsx("span",{children:"→"}),e.jsxs("small",{children:[parseFloat(s.quantity).toFixed(1)," gal"]})]}),e.jsxs("div",{className:"transfer-destination",children:[e.jsx("span",{className:"transfer-icon",children:"🎯"}),e.jsxs("div",{className:"transfer-info",children:[e.jsx("strong",{children:s.destinationLocation?$(s.destinationLocation):"Seleccionar destino"}),e.jsx("small",{children:"Destino"})]})]})]})}),s.destinationLocation&&y[s.destinationLocation]&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card destination-confirmation",children:[e.jsxs("div",{className:"confirmation-header",children:[e.jsx("span",{className:"confirmation-icon",children:"🎯"}),e.jsxs("div",{className:"confirmation-text",children:[e.jsx("strong",{children:$(s.destinationLocation)}),e.jsx("br",{}),e.jsx("small",{children:"Ubicación de destino confirmada"})]})]}),e.jsxs("div",{className:"capacity-confirmation",children:[e.jsxs("div",{className:"capacity-detail",children:[e.jsx("span",{className:"capacity-label",children:"📊 Después de transferir:"}),e.jsxs("span",{className:"capacity-value",children:[y[s.destinationLocation].afterTransfer.toFixed(1)," gal"]})]}),e.jsx("div",{className:"occupancy-bar",children:e.jsx("div",{className:"occupancy-fill",style:{width:`${y[s.destinationLocation].occupancyAfter}%`}})}),e.jsxs("small",{className:"occupancy-text",children:[y[s.destinationLocation].occupancyAfter.toFixed(1),"% de capacidad ocupada"]})]})]})})]})})},ue=({formData:s,updateFormData:x,systemData:k,error:S,setError:v,isActive:E})=>{const[i,o]=j.useState(!1),[y,f]=j.useState(!1),{products:b}=k;j.useEffect(()=>{if(s.fuelType&&!s.unitPrice&&b.length>0){const c=b.find(m=>m.name===s.fuelType||m.displayName===s.fuelType);c&&c.defaultPrice&&(x("unitPrice",c.defaultPrice.toString()),f(!0))}},[s.fuelType,s.unitPrice,b,x]);const u=async c=>{const m=parseFloat(c);(c===""||!isNaN(m)&&m>=0)&&(o(!0),await new Promise(p=>setTimeout(p,300)),x("unitPrice",c),f(c!==""),v(""),o(!1))},g=c=>{x("effectiveDate",c)},l=c=>{x("description",c)},w=(parseFloat(s.quantity)||0)*(parseFloat(s.unitPrice)||0),T=c=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(c),t=()=>b.find(c=>c.name===s.fuelType||c.displayName===s.fuelType);return e.jsx("div",{className:`wizard-step step-details ${E?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h3",{children:"📋 Información adicional del movimiento"}),e.jsx("p",{children:"Completa los detalles restantes:"})]}),e.jsxs("div",{className:"typeform-input-section",children:[e.jsx("label",{htmlFor:"unitPrice",children:"💰 Precio por galón (COP) *"}),e.jsx("input",{id:"unitPrice",type:"number",step:"1",min:"0",value:s.unitPrice,onChange:c=>u(c.target.value),placeholder:"0",className:`typeform-input ${S?"error":""}`}),e.jsx("span",{className:"typeform-unit",children:"COP"}),i&&e.jsxs("div",{className:"calculating-price",children:[e.jsx("div",{className:"loading-spinner small"}),e.jsx("span",{children:"💰 Validando precio..."})]}),t()?.defaultPrice&&e.jsxs("small",{className:"price-suggestion",children:["💡 Precio sugerido: $",t().defaultPrice.toLocaleString("es-CO")," COP"]})]}),s.quantity&&s.unitPrice&&y&&e.jsx("div",{className:"total-value-section",children:e.jsxs("div",{className:"total-value-card",children:[e.jsx("div",{className:"total-icon",children:"📊"}),e.jsxs("div",{className:"total-content",children:[e.jsx("h4",{children:"Valor Total Calculado"}),e.jsxs("div",{className:"total-calculation",children:[e.jsxs("span",{className:"calculation-details",children:[parseFloat(s.quantity).toFixed(2)," gal × $",parseFloat(s.unitPrice).toLocaleString("es-CO")," COP"]}),e.jsx("div",{className:"total-amount",children:T(w)})]})]})]})}),e.jsxs("div",{className:"typeform-input-section",children:[e.jsx("label",{htmlFor:"effectiveDate",children:"📅 ¿Cuándo ocurrió este movimiento?"}),e.jsx("input",{id:"effectiveDate",type:"datetime-local",value:s.effectiveDate,onChange:c=>g(c.target.value),className:"typeform-input"}),e.jsx("small",{className:"typeform-unit",children:"💡 Por defecto se usa la fecha y hora actual"})]}),e.jsxs("div",{className:"typeform-input-section",children:[e.jsx("label",{htmlFor:"description",children:"📝 Detalles adicionales del movimiento (opcional)"}),e.jsx("textarea",{id:"description",value:s.description,onChange:c=>l(c.target.value),placeholder:"Ej: Combustible para operación en sector norte, mantenimiento programado, etc.",className:"typeform-input",rows:"3",maxLength:"500"}),e.jsxs("div",{className:"description-counter",children:[s.description.length,"/500 caracteres"]})]})]})})},me=({formData:s,systemData:x,isLoading:k,error:S,onCommentsChange:v,confirmChecked:E,onConfirmChange:i})=>{const{vehicles:o,products:y,suppliers:f}=x,b=a=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),u=()=>({[n.ENTRADA]:{icon:"📥",title:"Entrada de Combustible",color:"entrada"},[n.SALIDA]:{icon:"⛽",title:"Salida de Combustible",color:"salida"},[n.TRANSFERENCIA]:{icon:"🔄",title:"Transferencia",color:"transferencia"},[n.AJUSTE]:{icon:"⚖️",title:"Ajuste de Inventario",color:"ajuste"}})[s.type]||{icon:"❓",title:"Operación",color:"unknown"},g=()=>y.find(a=>a.name===s.fuelType||a.displayName===s.fuelType),l=()=>o.find(a=>a.vehicleId===s.vehicleId),w=()=>{const a=parseFloat(s.quantity).toLocaleString("es-CO"),r=g()?.displayName||s.fuelType;switch(s.type){case n.ENTRADA:return`Recibir ${a} galones de ${r} de ${s.supplierName}`;case n.SALIDA:const h=l();return`Entregar ${a} galones de ${r} a ${h?.vehicleId||"vehículo"}`;case n.TRANSFERENCIA:return`Transferir ${a} galones de ${r} desde ${$(s.location)} hacia ${$(s.destinationLocation)}`;case n.AJUSTE:return`Ajustar ${a} galones de ${r} en ${$(s.location)}`;default:return`Procesar ${a} galones de ${r}`}},T=(parseFloat(s.quantity)||0)*(parseFloat(s.unitPrice)||0),t=u(),c=g(),m=l(),p=a=>{v(a.target.value)};return e.jsx("div",{className:"wizard-step step-summary",children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h2",{children:"🎯 ¡Perfecto! Vamos a confirmar"}),e.jsx("p",{children:"Revisa que todo esté correcto antes de procesar tu operación"})]}),e.jsxs("div",{className:"summary-main",children:[e.jsxs("div",{className:`summary-header ${t.color}`,children:[e.jsx("div",{className:"summary-icon",children:t.icon}),e.jsxs("div",{className:"summary-title",children:[e.jsx("h4",{children:t.title}),e.jsx("p",{children:w()})]}),e.jsx("div",{className:"summary-value",children:b(T)})]}),e.jsxs("div",{className:"summary-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"⛽"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Combustible"}),e.jsx("span",{className:"detail-value",children:c?.displayName||s.fuelType})]})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"📊"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Cantidad"}),e.jsxs("span",{className:"detail-value",children:[parseFloat(s.quantity).toLocaleString("es-CO")," galones"]})]})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"💰"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Precio unitario"}),e.jsx("span",{className:"detail-value",children:b(parseFloat(s.unitPrice))})]})]}),s.type===n.ENTRADA&&e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"🏪"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Proveedor"}),e.jsx("span",{className:"detail-value",children:s.supplierName})]})]}),(s.type===n.SALIDA||s.type===n.TRANSFERENCIA)&&e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"📍"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Ubicación origen"}),e.jsx("span",{className:"detail-value",children:$(s.location)})]})]}),s.type===n.SALIDA&&m&&e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"🚗"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Vehículo"}),e.jsxs("span",{className:"detail-value",children:[m.vehicleId,s.currentHours&&` - ${s.currentHours} hrs`]})]})]}),s.type===n.TRANSFERENCIA&&e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"🎯"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Destino"}),e.jsx("span",{className:"detail-value",children:$(s.destinationLocation)})]})]}),s.description&&e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"📝"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Descripción"}),e.jsx("span",{className:"detail-value description",children:s.description})]})]})]})]}),e.jsxs("div",{className:"typeform-input-section",children:[e.jsx("label",{htmlFor:"additional-comments",children:"💬 ¿Algún comentario adicional? (Opcional)"}),e.jsx("textarea",{id:"additional-comments",value:s.additionalComments||"",onChange:p,placeholder:"Escribe cualquier observación o detalle especial...",className:"typeform-textarea",rows:"3"})]}),e.jsxs("div",{className:"confirmation-section",children:[e.jsxs("div",{className:"confirmation-checkbox",children:[e.jsx("input",{type:"checkbox",id:"final-confirm",checked:E,onChange:a=>i(a.target.checked)}),e.jsx("label",{htmlFor:"final-confirm",children:"✅ Confirmo que toda la información es correcta y deseo procesar este movimiento"})]}),e.jsx("div",{className:"confirmation-warning",children:"⚠️ Este movimiento actualizará automáticamente el inventario de combustibles"})]}),S&&e.jsxs("div",{className:"validation-warning",children:["🚫 ",S]}),e.jsxs("div",{className:"final-message",children:[e.jsxs("p",{children:["🎉 ",e.jsx("strong",{children:"¡Listo para procesar!"})]}),e.jsx("p",{children:"Tu movimiento será registrado inmediatamente en el sistema."})]})]})})},pe=({isOpen:s,onClose:x,onSuccess:k})=>{const{inventory:S,vehicles:v,suppliers:E}=D(),[i,o]=j.useState(1),[y,f]=j.useState(!1),[b,u]=j.useState(!1),[g,l]=j.useState(""),[w,T]=j.useState(!1),[t,c]=j.useState({type:"",fuelType:"",quantity:"",unitPrice:"",location:"",supplierName:"",vehicleId:"",destinationLocation:"",description:"",reference:"",effectiveDate:new Date().toISOString().slice(0,16),currentHours:""}),[m,p]=j.useState({vehicles:[],inventory:[],suppliers:[],products:[],loadingData:!0}),a=()=>{o(1),l(""),T(!1),c({type:"",fuelType:"",quantity:"",unitPrice:"",location:"",supplierName:"",vehicleId:"",destinationLocation:"",description:"",reference:"",effectiveDate:new Date().toISOString().slice(0,16),currentHours:""})};j.useEffect(()=>((async()=>{if(s){document.body.style.overflow="hidden",a(),p(M=>({...M,loadingData:!0}));try{console.log("🔄 Cargando productos y sincronizando datos en tiempo real...");const M=await se();p({vehicles:v||[],inventory:S||[],suppliers:E||[],products:M||[],loadingData:!1}),console.log("✅ Datos sincronizados para wizard - inventario en tiempo real:",S?.length||0,"items")}catch(M){console.error("❌ Error al cargar datos del sistema:",M),l("No se pudieron cargar los datos necesarios. Inténtalo de nuevo."),p(q=>({...q,loadingData:!1}))}}else document.body.style.overflow="unset"})(),()=>{document.body.style.overflow="unset"}),[s,S,v,E]);const r=()=>{if(!t.type)return 8;let d;return t.type===n.TRANSFERENCIA?d=8:t.type===n.SALIDA||t.type===n.ENTRADA?d=7:d=6,console.log("🔍 [TOTAL STEPS]",{type:t.type,totalSteps:d,currentStep:i}),d},h=(d,M)=>{c(q=>({...q,[d]:M})),l("")},N=j.useCallback(()=>{let d=!1;switch(i){case 1:d=!!t.type;break;case 2:d=!!t.fuelType,console.log("🔍 [STEP 2 VALIDATION]",{fuelType:t.fuelType,isValid:d,formData:t});break;case 3:t.type===n.ENTRADA?d=!!t.supplierName:d=!!t.location;break;case"3b":d=!!t.destinationLocation;break;case 4:d=t.quantity&&parseFloat(t.quantity)>0,console.log("🔍 [DEBUG Step 4] Validación cantidad:",{step:i,quantity:t.quantity,parsedQuantity:parseFloat(t.quantity),isQuantityValid:!!t.quantity,isParsedValid:parseFloat(t.quantity)>0,finalValidation:d,formData:t});break;case 5:if(t.type===n.SALIDA){if(d=!!t.vehicleId,d&&t.vehicleId){const M=v.find(q=>q.vehicleId===t.vehicleId);M&&(M.fuelType==="diesel"||M.fuelType==="Diesel")&&(d=!!t.currentHours&&parseFloat(t.currentHours)>=0)}}else d=!0;break;case 6:t.type===n.TRANSFERENCIA?d=!!t.destinationLocation:d=!0;break;case 7:d=!!t.unitPrice&&parseFloat(t.unitPrice)>=0;break;case 8:d=!0;break;default:d=!1}return console.log("🔍 [DEBUG General] validateCurrentStep:",{currentStep:i,isValid:d,formDataKeys:Object.keys(t),formData:t}),d},[i,t,v]),F=j.useMemo(()=>N(),[N]),I=()=>{f(!0);const d=N();if(console.log("🔍 [DEBUG nextStep] Intentando navegar:",{currentStep:i,isValid:d,formData:t,type:t.type}),d){const M=r();let q=i+1;i===3&&t.type===n.ENTRADA?q="3b":i==="3b"?q=4:i===4&&t.type!==n.SALIDA?t.type===n.TRANSFERENCIA?q=6:(t.type,n.ENTRADA,q=7):i===5&&t.type!==n.TRANSFERENCIA&&(q=7),console.log("🔍 [DEBUG Navigation] Navegando:",{from:i,to:q,totalSteps:M}),(O=>t.type===n.ENTRADA?{1:1,2:2,3:3,"3b":4,4:5,7:6,8:7}[O]||O:t.type===n.SALIDA?{1:1,2:2,3:3,4:4,5:5,7:6,8:7}[O]||O:{1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8}[O]||O)(q)<=M&&o(q)}else console.log("❌ [DEBUG] Validación falló, no se puede navegar"),l("Por favor completa este paso antes de continuar");setTimeout(()=>f(!1),300)},L=()=>{if(f(!0),i>1&&i!=="3b"){let d=i-1;i===4&&t.type===n.ENTRADA?d="3b":(i===7&&t.type===n.ENTRADA||i===7&&t.type!==n.TRANSFERENCIA&&t.type!==n.SALIDA||i===6&&t.type!==n.SALIDA)&&(d=4),o(d)}else i==="3b"&&o(3);setTimeout(()=>f(!1),300)},C=async()=>{u(!0),l("");try{const d={...t};console.log("🔍 [SUBMIT] Datos completos antes de crear movimiento:",d);const M={...d,quantity:parseFloat(d.quantity),unitPrice:parseFloat(d.unitPrice),effectiveDate:new Date(d.effectiveDate)};console.log("🔍 [SUBMIT] MovementData enviado a createMovement:",M),await K(M),k(),a()}catch(d){console.error("Error al crear movimiento:",d),l(d.message||"Error al crear el movimiento")}finally{u(!1)}},A=()=>{const d={formData:t,updateFormData:h,systemData:m,error:g,setError:l,isActive:!y};return{1:e.jsx(le,{...d}),2:e.jsx(ce,{...d}),3:e.jsx(re,{...d}),"3b":e.jsx(B,{...d,isEntryDestination:!0}),4:e.jsx(oe,{...d}),5:e.jsx(de,{...d}),6:e.jsx(B,{...d}),7:e.jsx(ue,{...d}),8:e.jsx(me,{...d,onSubmit:C,isLoading:b,onCommentsChange:q=>h("additionalComments",q),confirmChecked:w,onConfirmChange:T})}[i]||e.jsx("div",{children:"Paso no encontrado"})};if(!s)return null;const R=r(),H=(d=>t.type===n.ENTRADA?{1:1,2:2,3:3,"3b":4,4:5,7:6,8:7}[d]||d:t.type===n.SALIDA?{1:1,2:2,3:3,4:4,5:5,7:6,8:7}[d]||d:{1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8}[d]||d)(i),Q=H/R*100,U=H>=R;return console.log("🔍 [WIZARD DEBUG]",{type:t.type,currentStep:i,currentLogicalStep:H,totalSteps:R,progress:Q,isLastStep:U,formDataKeys:Object.keys(t).filter(d=>t[d]),fuelType:t.fuelType}),e.jsx("div",{className:"modal-overlay wizard-overlay",onClick:x,children:e.jsxs("div",{className:`modal-content wizard-modal typeform-mode ${U?"is-last-step":""}`,onClick:d=>d.stopPropagation(),children:[e.jsx("div",{className:"typeform-progress",children:e.jsx("div",{className:"typeform-progress-fill",style:{width:`${Q}%`}})}),e.jsx("div",{className:"wizard-header typeform-mode",children:e.jsxs("div",{className:"wizard-title",children:[e.jsx("h3",{children:"🧙‍♂️ Asistente de Movimientos"}),e.jsx("button",{className:"modal-close",onClick:x,children:"✕"})]})}),e.jsx("div",{className:"wizard-body typeform-mode",children:m.loadingData?e.jsxs("div",{className:"wizard-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"🔄 Cargando datos del sistema..."})]}):e.jsx("div",{className:"wizard-step-container",children:A()})}),g&&e.jsxs("div",{className:"wizard-error",children:[e.jsx("span",{className:"error-icon",children:"⚠️"}),g]}),e.jsxs("div",{className:"typeform-navigation",children:[i>1&&e.jsx("button",{className:"typeform-nav-btn",onClick:L,disabled:y,"aria-label":"Paso anterior",children:"←"}),U?e.jsx("button",{className:"typeform-nav-btn",onClick:C,disabled:b||!w||y,"aria-label":"Confirmar movimiento",children:b?e.jsx("span",{className:"loading-spinner small"}):"✓"}):e.jsx("button",{className:"typeform-nav-btn",onClick:I,disabled:!F||y,"aria-label":"Siguiente paso",children:"→"})]})]})})},fe=()=>{const{user:s,userProfile:x,deleteMovement:k}=D(),[S,v]=j.useState([]),[E,i]=j.useState(null),[o,y]=j.useState(!0),[f,b]=j.useState(null),[u,g]=j.useState({type:"",status:"",fuelType:"",vehicleId:"",dateRange:"all"}),[l,w]=j.useState(""),[T,t]=j.useState(!1);j.useEffect(()=>{if(!s)return;y(!0);const C=Y((A,R)=>{if(R){console.error("Error en suscripción de movimientos:",R),b("Error al cargar movimientos"),y(!1);return}v(A),b(null),y(!1)},u);return()=>C()},[s,u]),j.useEffect(()=>{s&&(async()=>{try{const A=await Z(u);i(A)}catch(A){console.error("Error al cargar estadísticas:",A)}})()},[s,S,u]);const c=S.filter(C=>{if(!l)return!0;const A=l.toLowerCase();return C.fuelType?.toLowerCase().includes(A)||C.type?.toLowerCase().includes(A)||C.location?.toLowerCase().includes(A)||C.vehicleId?.toLowerCase().includes(A)||C.description?.toLowerCase().includes(A)||C.reference?.toLowerCase().includes(A)}),m=()=>{t(!0)},p=C=>{alert(`📋 Detalles del movimiento:

Tipo: ${C.type}
Combustible: ${C.fuelType}
Cantidad: ${C.quantity} gal
Fecha: ${new Date(C.createdAt).toLocaleDateString("es-CO")}`)},a=()=>{t(!1)},r=C=>{g(A=>({...A,...C}))},h=()=>{g({type:"",status:"",fuelType:"",vehicleId:"",dateRange:"all"}),w("")},N=async C=>{if(window.confirm("¿Estás seguro de que quieres aprobar este movimiento? Esta acción actualizará el inventario."))try{await ee(C),alert("Movimiento aprobado y stock actualizado.")}catch(A){console.error("Error al aprobar movimiento:",A),alert(`Error al aprobar movimiento: ${A.message}`)}},F=async C=>{if(window.confirm("¿Estás seguro de que quieres rechazar este movimiento?"))try{await X(C,{status:P.CANCELADO}),alert("Movimiento rechazado.")}catch(A){console.error("Error al rechazar movimiento:",A),alert(`Error al rechazar movimiento: ${A.message}`)}},I=async C=>{try{const A=await k(C);if(A.success)alert("Movimiento eliminado exitosamente.");else throw new Error(A.error)}catch(A){console.error("Error al eliminar movimiento:",A),alert(`Error al eliminar movimiento: ${A.message}`)}},L=x?.role==="admin"||x?.role==="contador"||x?.role==="cliente";return o?e.jsx("div",{className:"movements-main",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Cargando movimientos..."})]})}):f?e.jsx("div",{className:"movements-main",children:e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:"⚠️"}),e.jsx("h3",{children:"Error al cargar movimientos"}),e.jsx("p",{children:f}),e.jsx("button",{className:"btn-retry",onClick:()=>window.location.reload(),children:"Reintentar"})]})}):e.jsxs("div",{className:"movements-main",children:[e.jsxs("div",{className:"movements-header",children:[e.jsxs("div",{className:"header-title",children:[e.jsx("h2",{children:"📊 Movimientos de Combustibles"}),e.jsx("p",{children:"Gestiona entradas, salidas, transferencias y ajustes de inventario"})]}),L&&e.jsx("div",{className:"create-movement-options",children:e.jsx("button",{className:"btn-create-movement primary",onClick:m,children:"➕ Nuevo Movimiento"})})]}),E&&e.jsx(ae,{stats:E,filters:u}),e.jsx(te,{filters:u,onFilterChange:r,onClearFilters:h,searchTerm:l,onSearchChange:w,totalResults:c.length}),c.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"📋"}),e.jsx("h3",{children:S.length===0?"No hay movimientos registrados":"No se encontraron movimientos"}),e.jsx("p",{children:S.length===0?"Comienza creando tu primer movimiento de combustible":"Intenta ajustar los filtros de búsqueda"}),S.length===0&&L&&e.jsx("div",{className:"create-first-options",children:e.jsx("button",{className:"btn-create-first primary",onClick:m,children:"➕ Crear Primer Movimiento"})})]}):e.jsx(ne,{movements:c,onEdit:null,onView:p,onApprove:N,onReject:F,onDelete:I,userRole:x?.role}),T&&e.jsx(pe,{isOpen:T,onClose:a,onSuccess:()=>{a()}})]})};export{fe as default};
