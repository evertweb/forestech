import{j as e,f as V,a as B,l,M as q,r as p,O,z as R,A as W,B as K,u as D,C as Z,D as Y,E as X,G as ee,H as se}from"./index-DFx8MrHh.js";import{g as ae}from"./productsService-ByRSWmU_.js";const te=({stats:s,filters:m})=>{if(!s)return null;const k=(r,t)=>t===0?r>0?100:0:((r-t)/t*100).toFixed(1),g=r=>{switch(r){case l.ENTRADA:return"#10b981";case l.SALIDA:return"#ef4444";case l.TRANSFERENCIA:return"#3b82f6";case l.AJUSTE:return"#f59e0b";default:return"#6b7280"}},h=r=>{switch(r){case l.ENTRADA:return"ğŸ“¥";case l.SALIDA:return"ğŸ“¤";case l.TRANSFERENCIA:return"ğŸ”„";case l.AJUSTE:return"âš–ï¸";default:return"ğŸ“‹"}},f=k(s.thisMonth,s.lastMonth);return e.jsxs("div",{className:"movements-stats",children:[e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card primary",children:[e.jsx("div",{className:"stat-icon",children:"ğŸ“Š"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:V(s.totalMovements)}),e.jsx("div",{className:"stat-label",children:"Total Movimientos"}),e.jsxs("div",{className:"stat-trend",children:[e.jsxs("span",{className:`trend ${f>=0?"positive":"negative"}`,children:[f>=0?"ğŸ“ˆ":"ğŸ“‰"," ",Math.abs(f),"%"]}),e.jsx("span",{className:"trend-label",children:"vs mes anterior"})]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"ğŸ’°"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:B(s.totalValue)}),e.jsx("div",{className:"stat-label",children:"Valor Total"}),e.jsxs("div",{className:"stat-secondary",children:["Promedio: ",B(s.averageValue)]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"â›½"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:V(s.totalQuantity)}),e.jsx("div",{className:"stat-label",children:"Galones Total"}),e.jsxs("div",{className:"stat-secondary",children:["Promedio: ",V(s.totalQuantity/(s.totalMovements||1))," gal/mov"]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"ğŸ“…"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:V(s.thisWeek)}),e.jsx("div",{className:"stat-label",children:"Esta Semana"}),e.jsxs("div",{className:"stat-secondary",children:[V(s.thisMonth)," este mes"]})]})]})]}),e.jsxs("div",{className:"stats-breakdown",children:[e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h4",{children:"ğŸ“‹ Por Tipo de Movimiento"}),e.jsx("div",{className:"breakdown-grid",children:Object.entries(s.byType).map(([r,t])=>{const j=(t/s.totalMovements*100).toFixed(1);return e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-header",children:[e.jsx("span",{className:"breakdown-icon",children:h(r)}),e.jsx("span",{className:"breakdown-label",children:r.charAt(0).toUpperCase()+r.slice(1)})]}),e.jsx("div",{className:"breakdown-value",children:t}),e.jsx("div",{className:"breakdown-bar",children:e.jsx("div",{className:"breakdown-fill",style:{width:`${j}%`,backgroundColor:g(r)}})}),e.jsxs("div",{className:"breakdown-percentage",children:[j,"%"]})]},r)})})]}),e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h4",{children:"âš¡ Por Estado"}),e.jsx("div",{className:"breakdown-grid",children:Object.entries(s.byStatus).map(([r,t])=>{const j=(t/s.totalMovements*100).toFixed(1),N=c=>{switch(c){case q.COMPLETADO:return"#10b981";case q.PENDIENTE:return"#f59e0b";case q.CANCELADO:return"#ef4444";default:return"#6b7280"}},y=c=>{switch(c){case q.COMPLETADO:return"âœ…";case q.PENDIENTE:return"â³";case q.CANCELADO:return"âŒ";default:return"â“"}};return e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-header",children:[e.jsx("span",{className:"breakdown-icon",children:y(r)}),e.jsx("span",{className:"breakdown-label",children:r.charAt(0).toUpperCase()+r.slice(1)})]}),e.jsx("div",{className:"breakdown-value",children:t}),e.jsx("div",{className:"breakdown-bar",children:e.jsx("div",{className:"breakdown-fill",style:{width:`${j}%`,backgroundColor:N(r)}})}),e.jsxs("div",{className:"breakdown-percentage",children:[j,"%"]})]},r)})})]}),e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h4",{children:"â›½ Por Tipo de Combustible"}),e.jsx("div",{className:"breakdown-grid",children:Object.entries(s.byFuelType).map(([r,t])=>{const j=(t/s.totalMovements*100).toFixed(1),N=y=>{switch(y?.toLowerCase()){case"diesel":return"ğŸš›";case"gasolina":return"ğŸš—";case"acpm":return"ğŸšš";case"lubricante":return"ğŸ›¢ï¸";default:return"â›½"}};return e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-header",children:[e.jsx("span",{className:"breakdown-icon",children:N(r)}),e.jsx("span",{className:"breakdown-label",children:r})]}),e.jsx("div",{className:"breakdown-value",children:t}),e.jsx("div",{className:"breakdown-bar",children:e.jsx("div",{className:"breakdown-fill",style:{width:`${j}%`,backgroundColor:"#059669"}})}),e.jsxs("div",{className:"breakdown-percentage",children:[j,"%"]})]},r)})})]})]}),(m.type||m.status||m.fuelType||m.vehicleId)&&e.jsxs("div",{className:"active-filters",children:[e.jsx("h4",{children:"ğŸ” Filtros Activos"}),e.jsxs("div",{className:"filters-list",children:[m.type&&e.jsxs("span",{className:"filter-tag",children:["Tipo: ",m.type]}),m.status&&e.jsxs("span",{className:"filter-tag",children:["Estado: ",m.status]}),m.fuelType&&e.jsxs("span",{className:"filter-tag",children:["Combustible: ",m.fuelType]}),m.vehicleId&&e.jsxs("span",{className:"filter-tag",children:["VehÃ­culo: ",m.vehicleId]})]})]})]})},ie=({filters:s,onFilterChange:m,onClearFilters:k,searchTerm:g,onSearchChange:h,totalResults:f})=>{const[r,t]=p.useState(!1),j=[{value:"Diesel",label:"Diesel ğŸš›"},{value:"Gasolina",label:"Gasolina ğŸš—"},{value:"ACPM",label:"ACPM ğŸšš"},{value:"Lubricante",label:"Lubricante ğŸ›¢ï¸"}],N=[{value:"all",label:"Todos los perÃ­odos"},{value:"today",label:"Hoy"},{value:"week",label:"Esta semana"},{value:"month",label:"Este mes"},{value:"quarter",label:"Este trimestre"},{value:"year",label:"Este aÃ±o"}],y=Object.values(s).filter(o=>o&&o!==""&&o!=="all").length,c=(o,w)=>{m({[o]:w})},S=o=>{m(o)};return e.jsxs("div",{className:"movements-filters",children:[e.jsxs("div",{className:"filters-main",children:[e.jsx("div",{className:"search-section",children:e.jsxs("div",{className:"search-box",children:[e.jsx("span",{className:"search-icon",children:"ğŸ”"}),e.jsx("input",{type:"text",placeholder:"Buscar por combustible, vehÃ­culo, referencia...",value:g,onChange:o=>h(o.target.value),className:"search-input"}),g&&e.jsx("button",{className:"search-clear",onClick:()=>h(""),title:"Limpiar bÃºsqueda",children:"âœ•"})]})}),e.jsxs("div",{className:"filters-controls",children:[e.jsxs("div",{className:"quick-filters",children:[e.jsx("button",{className:`quick-filter ${s.type===l.ENTRADA?"active":""}`,onClick:()=>S({type:l.ENTRADA}),children:"ğŸ“¥ Entradas"}),e.jsx("button",{className:`quick-filter ${s.type===l.SALIDA?"active":""}`,onClick:()=>S({type:l.SALIDA}),children:"ğŸ“¤ Salidas"}),e.jsx("button",{className:`quick-filter ${s.status===q.PENDIENTE?"active":""}`,onClick:()=>S({status:q.PENDIENTE}),children:"â³ Pendientes"})]}),e.jsxs("button",{className:`btn-advanced-filters ${r?"active":""}`,onClick:()=>t(!r),children:["ğŸ›ï¸ Filtros",y>0&&e.jsx("span",{className:"filters-count",children:y})]}),e.jsx("div",{className:"view-indicator",children:e.jsx("span",{className:"view-info",children:"ğŸ“‹ Vista Tabla"})})]})]}),r&&e.jsxs("div",{className:"filters-advanced",children:[e.jsxs("div",{className:"filters-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Tipo de Movimiento"}),e.jsxs("select",{value:s.type,onChange:o=>c("type",o.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"Todos los tipos"}),e.jsx("option",{value:l.ENTRADA,children:"ğŸ“¥ Entrada"}),e.jsx("option",{value:l.SALIDA,children:"ğŸ“¤ Salida"}),e.jsx("option",{value:l.TRANSFERENCIA,children:"ğŸ”„ Transferencia"}),e.jsx("option",{value:l.AJUSTE,children:"âš–ï¸ Ajuste"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Estado"}),e.jsxs("select",{value:s.status,onChange:o=>c("status",o.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:q.PENDIENTE,children:"â³ Pendiente"}),e.jsx("option",{value:q.COMPLETADO,children:"âœ… Completado"}),e.jsx("option",{value:q.CANCELADO,children:"âŒ Cancelado"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Tipo de Combustible"}),e.jsxs("select",{value:s.fuelType,onChange:o=>c("fuelType",o.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"Todos los combustibles"}),j.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"PerÃ­odo"}),e.jsx("select",{value:s.dateRange,onChange:o=>c("dateRange",o.target.value),className:"filter-select",children:N.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"VehÃ­culo/Equipo"}),e.jsx("input",{type:"text",placeholder:"ID del vehÃ­culo...",value:s.vehicleId,onChange:o=>c("vehicleId",o.target.value),className:"filter-input"})]})]}),e.jsxs("div",{className:"filters-actions",children:[e.jsx("button",{className:"btn-clear-filters",onClick:k,disabled:y===0,children:"ğŸ—‘ï¸ Limpiar Filtros"}),e.jsxs("div",{className:"filters-info",children:[e.jsxs("span",{className:"results-count",children:[f," resultado",f!==1?"s":""]}),y>0&&e.jsxs("span",{className:"active-filters-text",children:["(",y," filtro",y!==1?"s":""," activo",y!==1?"s":"",")"]})]})]})]}),e.jsx("div",{className:"keyboard-shortcuts",style:{display:"none"},children:e.jsx("small",{children:"ğŸ’¡ Atajos: Ctrl+F (buscar), Ctrl+1 (entradas), Ctrl+2 (salidas), Ctrl+3 (pendientes)"})})]})},ne=({movements:s,onEdit:m,onView:k,onApprove:g,onReject:h,onDelete:f,userRole:r})=>{const[t,j]=p.useState("createdAt"),[N,y]=p.useState("desc"),c=i=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(i),S=i=>i?(i instanceof Date?i:new Date(i)).toLocaleDateString("es-CO",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):"Sin fecha",o=i=>{switch(i){case l.ENTRADA:return"ğŸ“¥";case l.SALIDA:return"ğŸ“¤";case l.TRANSFERENCIA:return"ğŸ”„";case l.AJUSTE:return"âš–ï¸";default:return"ğŸ“‹"}},w=i=>{switch(i?.toLowerCase()){case"diesel":return"ğŸš›";case"gasolina":return"ğŸš—";case"acpm":return"ğŸšš";case"lubricante":return"ğŸ›¢ï¸";default:return"â›½"}},A=i=>{switch(i){case q.COMPLETADO:return"âœ…";case q.PENDIENTE:return"â³";case q.CANCELADO:return"âŒ";default:return"â“"}},b=i=>{switch(i){case q.COMPLETADO:return"status-completado";case q.PENDIENTE:return"status-pendiente";case q.CANCELADO:return"status-cancelado";default:return"status-default"}},a=i=>{t===i?y(N==="asc"?"desc":"asc"):(j(i),y("asc"))},n=[...s].sort((i,u)=>{let v=i[t],C=u[t];return(t.includes("Date")||t.includes("At"))&&(v=new Date(v),C=new Date(C)),typeof v=="number"&&typeof C=="number"?N==="asc"?v-C:C-v:typeof v=="string"&&typeof C=="string"?N==="asc"?v.localeCompare(C):C.localeCompare(v):v instanceof Date&&C instanceof Date?N==="asc"?v-C:C-v:0}),x=i=>t!==i?"â†•ï¸":N==="asc"?"â†‘":"â†“";return e.jsxs("div",{className:"movements-table-container",children:[e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"movements-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{className:"sortable",onClick:()=>a("type"),children:["Tipo ",x("type")]}),e.jsxs("th",{className:"sortable",onClick:()=>a("fuelType"),children:["Combustible ",x("fuelType")]}),e.jsxs("th",{className:"sortable text-right",onClick:()=>a("quantity"),children:["Cantidad ",x("quantity")]}),e.jsxs("th",{className:"sortable text-right",onClick:()=>a("unitPrice"),children:["Precio/Gal ",x("unitPrice")]}),e.jsxs("th",{className:"sortable text-right",onClick:()=>a("totalValue"),children:["Valor Total ",x("totalValue")]}),e.jsx("th",{children:"VehÃ­culo"}),e.jsx("th",{children:"UbicaciÃ³n"}),e.jsxs("th",{className:"sortable",onClick:()=>a("status"),children:["Estado ",x("status")]}),e.jsxs("th",{className:"sortable",onClick:()=>a("createdAt"),children:["Fecha ",x("createdAt")]}),e.jsx("th",{className:"actions-column",children:"Acciones"})]})}),e.jsx("tbody",{children:n.map(i=>e.jsxs("tr",{className:`movement-row ${i.status===q.PENDIENTE?"pending-row":""}`,children:[e.jsx("td",{className:"type-cell",children:e.jsxs("div",{className:"type-content",children:[e.jsx("span",{className:"type-icon",children:o(i.type)}),e.jsx("span",{className:"type-text",children:i.type?i.type.charAt(0).toUpperCase()+i.type.slice(1):"Sin tipo"})]})}),e.jsx("td",{className:"fuel-cell",children:e.jsxs("div",{className:"fuel-content",children:[e.jsx("span",{className:"fuel-icon",children:w(i.fuelType)}),e.jsx("span",{className:"fuel-text",children:i.fuelType})]})}),e.jsxs("td",{className:"quantity-cell text-right",children:[e.jsx("span",{className:"quantity-value",children:i.quantity}),e.jsx("span",{className:"quantity-unit",children:"gal"})]}),e.jsx("td",{className:"price-cell text-right",children:c(i.unitPrice)}),e.jsx("td",{className:"value-cell text-right",children:e.jsx("strong",{children:c(i.totalValue)})}),e.jsx("td",{className:"vehicle-cell",children:i.vehicleId?e.jsxs("span",{className:"vehicle-id",children:["ğŸšœ ",i.vehicleId]}):e.jsx("span",{className:"no-vehicle",children:"-"})}),e.jsx("td",{className:"location-cell",children:e.jsxs("span",{className:"location-text",children:["ğŸ“ ",i.type===l.ENTRADA?i.destinationLocation||"Sin ubicaciÃ³n":i.location||"Principal"]})}),e.jsx("td",{className:"status-cell",children:e.jsxs("div",{className:`status-badge ${b(i.status)}`,children:[e.jsx("span",{className:"status-icon",children:A(i.status)}),e.jsx("span",{className:"status-text",children:i.status?i.status.charAt(0).toUpperCase()+i.status.slice(1):"Sin estado"})]})}),e.jsx("td",{className:"date-cell",children:e.jsxs("div",{className:"date-content",children:[e.jsx("span",{className:"date-value",children:S(i.createdAt)}),i.reference&&e.jsxs("span",{className:"reference-small",children:["#",i.reference]})]})}),e.jsx("td",{className:"actions-cell",children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn-action btn-view",onClick:()=>k(i),title:"Ver detalles",children:"ğŸ‘ï¸"}),r==="admin"&&i.status===q.PENDIENTE&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-action btn-approve",onClick:()=>g(i.id),title:"Aprobar movimiento",children:"âœ“"}),e.jsx("button",{className:"btn-action btn-reject",onClick:()=>h(i.id),title:"Rechazar movimiento",children:"âœ—"})]}),m&&i.status===q.PENDIENTE&&e.jsx("button",{className:"btn-action btn-edit",onClick:()=>m(i),title:"Editar movimiento",children:"âœï¸"}),r==="admin"&&e.jsx("button",{className:"btn-action btn-delete",onClick:()=>{window.confirm("Â¿EstÃ¡s seguro de que deseas eliminar este movimiento? Esta acciÃ³n no se puede deshacer.")&&f(i.id)},title:"Eliminar movimiento",children:"ğŸ—‘ï¸"})]})})]},i.id))})]})}),e.jsxs("div",{className:"table-info",children:[e.jsxs("div",{className:"table-summary",children:[e.jsxs("span",{className:"total-rows",children:[s.length," movimiento",s.length!==1?"s":""]}),t&&e.jsxs("span",{className:"sort-info",children:["Ordenado por ",t," (",N==="asc"?"ascendente":"descendente",")"]})]}),e.jsxs("div",{className:"table-legend",children:[e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-icon",children:"â³"})," Pendiente"]}),e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-icon",children:"âœ…"})," Completado"]}),e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-icon",children:"âŒ"})," Cancelado"]})]})]})]})},le=({movements:s,onEdit:m,onView:k,onApprove:g,onReject:h,onDelete:f,userRole:r})=>e.jsx(ne,{movements:s,onEdit:m,onView:k,onApprove:g,onReject:h,onDelete:f,userRole:r}),ce=({formData:s,updateFormData:m,setError:k,isActive:g})=>{const h=[{type:l.ENTRADA,icon:"ğŸ“¥",title:"Entrada de Combustible",description:"Registrar combustible que llega de proveedores",color:"entrada",details:"Para compras, reabastecimientos y recepciones"},{type:l.SALIDA,icon:"â›½",title:"Salida de Combustible",description:"Asignar combustible a vehÃ­culos y equipos",color:"salida",details:"Para consumo y operaciones de campo"},{type:l.TRANSFERENCIA,icon:"ğŸ”„",title:"Transferencia",description:"Mover combustible entre ubicaciones",color:"transferencia",details:"Entre tanques, sitios o almacenes"},{type:l.AJUSTE,icon:"âš–ï¸",title:"Ajuste de Inventario",description:"Corregir stock por diferencias o calibraciones",color:"ajuste",details:"Para mermas, pÃ©rdidas o correcciones"}],f=p.useCallback(r=>{m("type",r),k("")},[m,k]);return p.useEffect(()=>{if(!g)return;const r=t=>{const j=parseInt(t.key);if(j>=1&&j<=4){const N=h[j-1];f(N.type)}};return window.addEventListener("keypress",r),()=>window.removeEventListener("keypress",r)},[g,f,h]),e.jsx("div",{className:`wizard-step step-movement-type ${g?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h2",{children:"ğŸŒ¿ Â¡Hola! Â¿QuÃ© operaciÃ³n necesitas registrar hoy?"}),e.jsx("p",{children:"Selecciona el tipo de movimiento que vas a realizar"})]}),e.jsx("div",{className:"typeform-options",children:h.map(r=>e.jsxs("div",{className:`typeform-option ${s.type===r.type?"selected":""} ${r.color}`,onClick:()=>f(r.type),children:[e.jsx("div",{className:"typeform-option-icon",children:r.icon}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsx("h4",{children:r.title}),e.jsx("p",{children:r.description})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"âœ“"})})})]},r.type))}),s.type&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card",children:[e.jsx("span",{className:"confirmation-icon",children:h.find(r=>r.type===s.type)?.icon}),e.jsxs("div",{className:"confirmation-text",children:[e.jsx("strong",{children:"Perfecto! Has seleccionado:"})," ",h.find(r=>r.type===s.type)?.title,e.jsx("br",{}),e.jsx("small",{children:h.find(r=>r.type===s.type)?.details})]})]})})]})})},re=({formData:s,updateFormData:m,systemData:k,setError:g,isActive:h})=>{const[f,r]=p.useState(!1),[t,j]=p.useState(null),{products:N}=k,y=p.useCallback(async(c,S)=>{r(!0),g("");try{await new Promise(o=>setTimeout(o,800)),m("fuelType",c),j(S),S.defaultPrice&&m("unitPrice",S.defaultPrice.toString()),console.log("ğŸ”„ [Step2] Combustible seleccionado:",c,"Precio:",S.defaultPrice)}catch(o){console.error("Error al cargar combustible:",o),g("Error al cargar informaciÃ³n del combustible")}finally{r(!1)}},[m,g]);return p.useEffect(()=>{if(s.fuelType&&N.length>0){const c=N.find(S=>S.name===s.fuelType||S.displayName===s.fuelType);j(c),c&&c.defaultPrice&&!s.unitPrice&&m("unitPrice",c.defaultPrice.toString())}},[s.fuelType,s.unitPrice,N,m]),p.useEffect(()=>{if(!h)return;const c=S=>{const o=parseInt(S.key);if(o>=1&&o<=N.length){const w=N[o-1];y(w.name,w)}};return window.addEventListener("keypress",c),()=>window.removeEventListener("keypress",c)},[h,N,y]),N.length===0?e.jsx("div",{className:`wizard-step step-fuel-type ${h?"active":""}`,children:e.jsx("div",{className:"typeform-layout",children:e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"ğŸ”„ Cargando productos disponibles..."})]})})}):e.jsx("div",{className:`wizard-step step-fuel-type ${h?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h2",{children:"â›½ Â¿QuÃ© tipo de combustible necesitas?"}),e.jsx("p",{children:"Elige el producto que vas a mover"})]}),f&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"ğŸ“¡ Actualizando precios..."})]}),e.jsx("div",{className:"typeform-options",children:N.map(c=>e.jsxs("div",{className:`typeform-option ${s.fuelType===c.name?"selected":""} ${f?"disabled":""}`,onClick:()=>!f&&y(c.name,c),children:[e.jsx("div",{className:"typeform-option-icon",children:c.icon||"ğŸ›¢ï¸"}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsx("h4",{children:c.displayName||c.name}),e.jsx("p",{children:c.description||"Combustible premium"}),c.defaultPrice&&e.jsx("div",{className:"fuel-price",children:e.jsxs("span",{className:"price-value",children:["$",c.defaultPrice.toLocaleString("es-CO")," COP/galÃ³n"]})})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"âœ“"})})})]},c.id))}),t&&s.fuelType&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card fuel-confirmation",children:[e.jsxs("div",{className:"confirmation-header",children:[e.jsx("span",{className:"confirmation-icon",children:t.icon||"ğŸ›¢ï¸"}),e.jsxs("div",{className:"confirmation-text",children:[e.jsxs("strong",{children:["Excelente! Has elegido ",t.displayName||t.name]}),e.jsx("br",{}),e.jsx("small",{children:t.description||"Combustible de calidad premium"})]})]}),t.defaultPrice&&e.jsxs("div",{className:"price-confirmation",children:[e.jsxs("div",{className:"price-info",children:[e.jsx("span",{className:"price-label",children:"ğŸ’° Precio actual:"}),e.jsxs("span",{className:"price-amount",children:["$",t.defaultPrice.toLocaleString("es-CO")," COP/galÃ³n"]})]}),e.jsx("small",{className:"price-note",children:"âœ¨ Aplicamos el precio automÃ¡ticamente (lo puedes ajustar despuÃ©s)"})]})]})})]})})},oe=({formData:s,updateFormData:m,systemData:k,setError:g,isActive:h})=>{const[f,r]=p.useState(!1),[t,j]=p.useState({}),[N,y]=p.useState(!1),{suppliers:c,inventory:S}=k,o=s.type===l.ENTRADA,w=p.useCallback(async a=>{r(!0),g("");try{await new Promise(n=>setTimeout(n,400)),m(o?"supplierName":"location",a)}catch{g("Error al validar la ubicaciÃ³n")}finally{r(!1)}},[o,m,g]);p.useEffect(()=>{if(!h)return;const a=n=>{const x=parseInt(n.key);if(o){const i=c.filter(u=>u.status==="active");if(x>=1&&x<=i.length){const u=i[x-1];w(u.name)}}else if(x>=1&&x<=O.length){const i=O[x-1];w(i)}};return window.addEventListener("keypress",a),()=>window.removeEventListener("keypress",a)},[h,c,o,w]),p.useEffect(()=>{(async()=>{if(!o&&s.fuelType&&S.length>0){y(!0),await new Promise(x=>setTimeout(x,600));const n={};O.forEach(x=>{const i=S.filter(I=>I.fuelType===s.fuelType&&I.location?.toLowerCase()===x.toLowerCase()&&I.status==="active"),u=i.reduce((I,P)=>I+(parseFloat(P.currentStock)||0),0),v=i.reduce((I,P)=>I+(parseFloat(P.maxCapacity)||0),0);let C="available",L=`${u.toFixed(0)} galones disponibles`;u===0?(C="empty",L="Sin combustible disponible"):u<v*.2&&(C="low",L=`${u.toFixed(0)} gal (stock bajo)`),n[x]={available:u,maxCapacity:v,status:C,message:L,percentage:v>0?u/v*100:0}}),j(n),y(!1)}})()},[s.fuelType,o,S]);const A=a=>{switch(a.toLowerCase()){case"oficina principal":return"ğŸ¢";case"tanque central":return"â›½";case"almacÃ©n norte":return"ğŸ­";case"zona sur":return"ğŸŒ";case"taller mecÃ¡nico":return"ğŸ”§";default:return"ğŸ“"}},b=()=>{switch(s.type){case l.ENTRADA:return"Â¿De dÃ³nde viene el combustible?";case l.SALIDA:return"Â¿De quÃ© ubicaciÃ³n tomarÃ¡s el combustible?";case l.TRANSFERENCIA:return"Â¿Desde dÃ³nde quieres transferir?";case l.AJUSTE:return"Â¿En quÃ© ubicaciÃ³n harÃ¡s el ajuste?";default:return"Â¿CuÃ¡l es la ubicaciÃ³n?"}};if(o){const a=c.filter(n=>n.status==="active");return console.log("ğŸ” [Step3 DEBUG] Suppliers data:",{suppliersLength:c.length,activeSuppliersLength:a.length,suppliers:c}),e.jsx("div",{className:`wizard-step step-location ${h?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsxs("h2",{children:["ğŸª ",b()]}),e.jsx("p",{children:"Selecciona el proveedor que estÃ¡ enviando el combustible"})]}),f&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"ğŸ”„ Validando proveedor..."})]}),c.length===0?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"ğŸ”„ Cargando proveedores..."})]}):a.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ğŸª"}),e.jsx("h3",{children:"No hay proveedores disponibles"}),e.jsx("p",{children:"No se encontraron proveedores activos en el sistema."}),e.jsx("p",{children:"Contacta al administrador para agregar proveedores."})]}):e.jsx("div",{className:"typeform-options",children:a.map(n=>e.jsxs("div",{className:`typeform-option ${s.supplierName===n.name?"selected":""} ${f?"disabled":""}`,onClick:()=>!f&&w(n.name),children:[e.jsx("div",{className:"typeform-option-icon",children:"ğŸª"}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsx("h4",{children:n.name}),e.jsx("p",{children:n.location||"Proveedor de combustibles"}),n.contact&&e.jsxs("small",{className:"supplier-contact",children:["ğŸ“ ",n.contact]})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"âœ“"})})})]},n.id))}),s.supplierName&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card",children:[e.jsx("span",{className:"confirmation-icon",children:"ğŸª"}),e.jsxs("div",{className:"confirmation-text",children:[e.jsxs("strong",{children:["Genial! RecibirÃ¡s combustible de ",s.supplierName]}),e.jsx("br",{}),e.jsx("small",{children:"El combustible serÃ¡ registrado en el inventario"})]})]})})]})})}return e.jsx("div",{className:`wizard-step step-location ${h?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsxs("h2",{children:["ğŸ“ ",b()]}),e.jsx("p",{children:"Elige la ubicaciÃ³n donde estÃ¡ almacenado el combustible"})]}),N&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"âš™ï¸ Verificando stock por ubicaciÃ³n..."})]}),e.jsx("div",{className:"typeform-options",children:O.map(a=>{const n=t[a]||{},x=s.location===a;return e.jsxs("div",{className:`typeform-option ${x?"selected":""} ${n.status||""} ${f?"disabled":""}`,onClick:()=>!f&&w(a),children:[e.jsx("div",{className:"typeform-option-icon",children:A(a)}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsx("h4",{children:R(a)}),e.jsx("p",{children:n.message||"Verificando disponibilidad..."}),n.available>0&&e.jsx("div",{className:"stock-indicator",children:e.jsx("div",{className:"stock-bar-mini",children:e.jsx("div",{className:"stock-fill-mini",style:{width:`${Math.min(n.percentage,100)}%`}})})})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"âœ“"})})})]},a)})}),s.location&&t[s.location]&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card",children:[e.jsx("span",{className:"confirmation-icon",children:A(s.location)}),e.jsxs("div",{className:"confirmation-text",children:[e.jsxs("strong",{children:["Excelente! UsarÃ¡s ",R(s.location)]}),e.jsx("br",{}),e.jsx("small",{children:t[s.location].message})]})]})})]})})},de=({formData:s,updateFormData:m,systemData:k,setError:g,isActive:h})=>{const[f,r]=p.useState(!1),[t,j]=p.useState(null),[N,y]=p.useState(""),c=p.useRef(null),{inventory:S}=k,o=s.type===l.SALIDA||s.type===l.TRANSFERENCIA;p.useEffect(()=>{h&&c.current&&setTimeout(()=>c.current.focus(),300)},[h]),p.useEffect(()=>{if(!h)return;const n=x=>{x.key==="Enter"&&s.quantity&&parseFloat(s.quantity)>0};return window.addEventListener("keypress",n),()=>window.removeEventListener("keypress",n)},[h,s.quantity]),p.useEffect(()=>{(async()=>{if(o&&s.fuelType&&s.location&&S.length>0){r(!0),await new Promise(P=>setTimeout(P,500));const x=S.filter(P=>P.fuelType===s.fuelType&&P.location?.toLowerCase()===s.location?.toLowerCase()&&P.status==="active").reduce((P,E)=>P+(parseFloat(E.currentStock)||0),0),i=parseFloat(s.quantity)||0,u=x-i;let v="available",C="âœ…",L="Stock Disponible",I="Perfecto, hay suficiente combustible.";if(i>0&&(x<i?(v="critical",C="ğŸš«",L="Cantidad No Disponible",I=`Solo hay ${x.toFixed(2)} galones disponibles`):u<x*.2?(v="warning",C="âš ï¸",L="Stock QuedarÃ¡ Bajo",I=`QuedarÃ¡n solo ${u.toFixed(2)} galones`):I=`QuedarÃ¡n ${u.toFixed(2)} galones en stock`),j({available:x,required:i,remaining:Math.max(0,u),status:v,icon:C,title:L,message:I,isValid:x>=i}),i>0&&o){const P={type:s.type===l.SALIDA?"outbound":"transfer",fuelType:s.fuelType,quantity:s.quantity,sourceLocation:s.location},E=W(P,S);E.isValid?E.warning?y(`âš ï¸ ${E.warning}`):y(""):y(`ğŸš« ${E.error}`)}else o||y("");r(!1)}})()},[s.quantity,s.fuelType,s.location,s.type,o,S]);const w=n=>{const x=parseFloat(n);(n===""||!isNaN(x)&&x>=0)&&(m("quantity",n),g(""))},A=()=>{if(!t||!t.available)return[];const n=t.available;return[{label:"25 gal",value:"25"},{label:"50 gal",value:"50"},{label:"100 gal",value:"100"},{label:`${n.toFixed(0)} gal`,value:n.toFixed(1)}]},b=()=>{switch(s.type){case l.ENTRADA:return"ğŸ“¥";case l.SALIDA:return"â›½";case l.TRANSFERENCIA:return"ğŸ”„";case l.AJUSTE:return"âš–ï¸";default:return"ğŸ“Š"}},a=()=>{switch(s.type){case l.ENTRADA:return"Â¿CuÃ¡ntos galones estÃ¡s recibiendo?";case l.SALIDA:return"Â¿CuÃ¡ntos galones necesitas entregar?";case l.TRANSFERENCIA:return"Â¿CuÃ¡ntos galones vas a transferir?";case l.AJUSTE:return"Â¿CuÃ¡l es la cantidad del ajuste?";default:return"Â¿CuÃ¡ntos galones necesitas?"}};return e.jsx("div",{className:`wizard-step step-quantity ${h?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsxs("h2",{children:[b()," ",a()]}),e.jsx("p",{children:"Ingresa la cantidad en galones"})]}),e.jsxs("div",{className:"typeform-input-section",children:[e.jsx("input",{ref:c,id:"quantity",type:"number",step:"0.1",min:"0",value:s.quantity,onChange:n=>w(n.target.value),placeholder:"0",className:`typeform-input ${N?"error":""}`,autoComplete:"off"}),e.jsx("span",{className:"typeform-unit",children:"galones"})]}),t&&t.available>0&&e.jsxs("div",{className:"typeform-suggestions",children:[e.jsx("label",{className:"typeform-suggestions-label",children:"Cantidades comunes:"}),e.jsx("div",{className:"typeform-suggestions-buttons",children:A().map((n,x)=>e.jsx("button",{type:"button",className:"typeform-suggestion-btn",onClick:()=>w(n.value),children:n.label},x))})]}),f&&e.jsxs("div",{className:"calculating-indicator",children:[e.jsx("div",{className:"loading-spinner small"}),e.jsx("span",{children:"âš™ï¸ Verificando disponibilidad..."})]}),t&&o&&!f&&e.jsxs("div",{className:`stock-info-container ${t.status}`,children:[e.jsxs("div",{className:"stock-info-header",children:[e.jsx("div",{className:"stock-info-icon",children:t.icon}),e.jsx("h4",{className:"stock-info-title",children:t.title})]}),e.jsx("div",{className:"stock-info-message",children:t.message})]}),N&&e.jsx("div",{className:"validation-warning",children:N}),s.quantity&&parseFloat(s.quantity)>0&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card",children:[e.jsx("span",{className:"confirmation-icon",children:b()}),e.jsxs("div",{className:"confirmation-text",children:[e.jsxs("strong",{children:["Perfecto! ",parseFloat(s.quantity).toLocaleString("es-CO")," galones"]}),e.jsx("br",{}),e.jsx("small",{children:o?`SaldrÃ¡n del inventario de ${s.location}`:"Se agregarÃ¡n al inventario"})]})]})})]})})},ue=({formData:s,updateFormData:m,systemData:k,setError:g,isActive:h})=>{const[f,r]=p.useState(!1),[t,j]=p.useState(null),[N,y]=p.useState(!1),[c,S]=p.useState(""),o=p.useRef(null),{vehicles:w}=k,A=p.useCallback(u=>u?u.type==="heavy"||u.type==="construction"||u.category==="maquinaria":!1,[]),b=p.useCallback(()=>{if(!s.fuelType||w.length===0)return[];const u=s.fuelType.toLowerCase();return w.filter(v=>{const C=v.fuelType?.toLowerCase()||"";return v.status==="active"&&u==="diesel"&&C==="diesel"||u==="gasolina"&&C==="gasolina"})},[s.fuelType,w]),a=p.useCallback(async u=>{r(!0),g(""),S("");try{await new Promise(C=>setTimeout(C,400)),m("vehicleId",u.vehicleId),j(u);const v=A(u);y(v),v||m("currentHours","")}catch{g("Error al seleccionar vehÃ­culo")}finally{r(!1)}},[m,g,A]);if(p.useEffect(()=>{if(!h||s.type!==l.SALIDA)return;const u=v=>{const C=b(),L=parseInt(v.key);if(L>=1&&L<=C.length){const I=C[L-1];a(I)}};return window.addEventListener("keypress",u),()=>window.removeEventListener("keypress",u)},[h,w,s.fuelType,b,a]),p.useEffect(()=>{if(s.vehicleId&&w.length>0&&s.type===l.SALIDA){const u=w.find(C=>C.vehicleId===s.vehicleId);j(u);const v=A(u);y(v),v&&o.current&&setTimeout(()=>o.current.focus(),500)}},[s.vehicleId,w]),s.type!==l.SALIDA)return null;const n=u=>{const v=parseFloat(u);u===""||!isNaN(v)&&v>=0?(m("currentHours",u),S("")):S("Ingresa un valor vÃ¡lido de horÃ³metro")},x=u=>{const v=u.category?.toLowerCase()||"",C=u.type?.toLowerCase()||"";return v.includes("tractor")||C.includes("tractor")?"ğŸšœ":v.includes("excavadora")||C.includes("excavadora")?"ğŸ¦•":v.includes("volqueta")||C.includes("volqueta")?"ğŸš›":v.includes("moto")||C.includes("moto")?"ğŸï¸":v.includes("carro")||C.includes("carro")?"ğŸš—":"ğŸš™"},i=b();return i.length===0?e.jsx("div",{className:`wizard-step step-vehicle ${h?"active":""}`,children:e.jsx("div",{className:"typeform-layout",children:e.jsxs("div",{className:"typeform-question",children:[e.jsx("h2",{children:"ğŸš« No hay vehÃ­culos compatibles"}),e.jsxs("p",{children:["No se encontraron vehÃ­culos que usen ",s.fuelType]})]})})}):e.jsx("div",{className:`wizard-step step-vehicle ${h?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h2",{children:"ğŸš— Â¿A quÃ© vehÃ­culo le darÃ¡s combustible?"}),e.jsxs("p",{children:["Selecciona el vehÃ­culo o equipo que recibirÃ¡ el ",s.fuelType]})]}),f&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"ğŸ”„ Validando vehÃ­culo..."})]}),e.jsx("div",{className:"typeform-options",children:i.map(u=>e.jsxs("div",{className:`typeform-option ${s.vehicleId===u.vehicleId?"selected":""} ${f?"disabled":""}`,onClick:()=>!f&&a(u),children:[e.jsx("div",{className:"typeform-option-icon",children:x(u)}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsxs("h4",{children:[u.vehicleId," - ",u.brand||"VehÃ­culo"]}),e.jsx("p",{children:u.model||u.type||"Equipo de trabajo"}),u.currentHours&&e.jsxs("small",{className:"vehicle-hours",children:["ğŸ• ",u.currentHours," horas registradas"]})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"âœ“"})})})]},u.id))}),N&&t&&e.jsxs("div",{className:"typeform-input-section",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h3",{children:"ğŸ• Â¿CuÃ¡l es el horÃ³metro actual?"}),e.jsxs("p",{children:["Ingresa las horas actuales de ",t.vehicleId]})]}),e.jsx("input",{ref:o,type:"number",step:"0.1",min:"0",value:s.currentHours||"",onChange:u=>n(u.target.value),placeholder:"0",className:`typeform-input ${c?"error":""}`,autoComplete:"off"}),e.jsx("span",{className:"typeform-unit",children:"horas"}),c&&e.jsx("div",{className:"validation-warning",children:c})]}),t&&s.vehicleId&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card",children:[e.jsx("span",{className:"confirmation-icon",children:x(t)}),e.jsxs("div",{className:"confirmation-text",children:[e.jsxs("strong",{children:["Perfecto! Combustible para ",t.vehicleId]}),e.jsx("br",{}),e.jsxs("small",{children:[t.brand," ",t.model,N&&s.currentHours&&` - HorÃ³metro: ${s.currentHours} horas`]})]})]})})]})})},_=({formData:s,updateFormData:m,systemData:k,setError:g,isEntryDestination:h=!1,isActive:f})=>{const[r,t]=p.useState(!1),[j,N]=p.useState({}),[y,c]=p.useState(!1),{inventory:S}=k;p.useEffect(()=>{(async()=>{if(s.fuelType&&s.quantity&&S.length>0&&!h){c(!0),await new Promise(n=>setTimeout(n,700));const b=parseFloat(s.quantity)||0,a={};O.filter(n=>h?!0:n!==s.location).forEach(n=>{const x=S.filter(E=>E.fuelType===s.fuelType&&E.location?.toLowerCase()===n.toLowerCase()&&E.status==="active").reduce((E,T)=>E+(parseFloat(T.currentStock)||0),0),i=S.filter(E=>E.fuelType===s.fuelType&&E.location?.toLowerCase()===n.toLowerCase()&&E.status==="active").reduce((E,T)=>E+(parseFloat(T.maxCapacity)||0),0),u=i-x,v=x+b,C=i>0?v/i*100:0;let L="available",I=`Capacidad: ${u.toFixed(1)} gal libres`,P=u>=b;i===0?(L="no_capacity",I="Sin tanques configurados",P=!1):u<b?(L="insufficient",I=`Insuficiente: faltan ${(b-u).toFixed(1)} gal`,P=!1):C>90&&(L="warning",I=`QuedarÃ¡ al ${C.toFixed(1)}% (casi lleno)`),a[n]={currentStock:x,maxCapacity:i,availableCapacity:u,afterTransfer:v,occupancyAfter:C,status:L,message:I,canAcceptTransfer:P}}),N(a),c(!1),console.log("ğŸ” Capacidad validada por destino:",a)}})()},[s.fuelType,s.quantity,s.location,S,h]);const o=async A=>{const b=j[A];if(!h&&!b?.canAcceptTransfer){g("Esta ubicaciÃ³n no puede recibir la cantidad solicitada");return}t(!0),g("");try{await new Promise(a=>setTimeout(a,500)),m("destinationLocation",A),console.log("ğŸ¯ Destino seleccionado:",A)}catch(a){console.error("Error al validar destino:",a),g("Error al validar el destino")}finally{t(!1)}};if(!h&&s.type!==l.TRANSFERENCIA)return null;const w=h?K:O.filter(A=>A!==s.location);return e.jsx("div",{className:`wizard-step step-destination ${f?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsxs("h3",{children:["ğŸ¯ ",h?"Â¿A quÃ© ubicaciÃ³n llegarÃ¡ el combustible?":"Â¿Hacia quÃ© ubicaciÃ³n se transfiere?"]}),e.jsx("p",{children:"Selecciona la ubicaciÃ³n de destino:"})]}),y&&e.jsxs("div",{className:"loading-overlay",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"ğŸ” Verificando capacidad disponible..."})]}),e.jsx("div",{className:"typeform-options",children:w.map(A=>{const b=j[A],a=!b||b.canAcceptTransfer;return e.jsxs("div",{className:`typeform-option ${s.destinationLocation===A?"selected":""} 
                           ${b?.status||"unknown"} ${!a||r?"disabled":""}`,onClick:()=>a&&!r&&o(A),children:[e.jsx("div",{className:"typeform-option-icon",children:"ğŸ¯"}),e.jsxs("div",{className:"typeform-option-content",children:[e.jsx("h4",{children:R(A)}),b&&e.jsxs("div",{className:"capacity-info",children:[e.jsx("p",{className:"capacity-message",children:b.message}),b.maxCapacity>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"capacity-bar-mini",children:[e.jsx("div",{className:"capacity-current-mini",style:{width:`${Math.min(100,b.currentStock/b.maxCapacity*100)}%`}}),b.canAcceptTransfer&&e.jsx("div",{className:"capacity-after-mini",style:{width:`${Math.min(100,b.occupancyAfter)}%`,left:`${Math.min(100,b.currentStock/b.maxCapacity*100)}%`}})]}),e.jsxs("small",{className:"capacity-details",children:["Actual: ",b.currentStock.toFixed(1),"/",b.maxCapacity.toFixed(1)," gal"]})]})]})]}),e.jsx("div",{className:"typeform-option-selector",children:e.jsx("div",{className:"typeform-check",children:e.jsx("span",{className:"typeform-check-icon",children:"âœ“"})})})]},A)})}),s.location&&s.quantity&&e.jsx("div",{className:"transfer-summary",children:e.jsxs("div",{className:"transfer-flow",children:[e.jsxs("div",{className:"transfer-origin",children:[e.jsx("span",{className:"transfer-icon",children:"ğŸ“"}),e.jsxs("div",{className:"transfer-info",children:[e.jsx("strong",{children:R(s.location)}),e.jsx("small",{children:"Origen"})]})]}),e.jsxs("div",{className:"transfer-arrow",children:[e.jsx("span",{children:"â†’"}),e.jsxs("small",{children:[parseFloat(s.quantity).toFixed(1)," gal"]})]}),e.jsxs("div",{className:"transfer-destination",children:[e.jsx("span",{className:"transfer-icon",children:"ğŸ¯"}),e.jsxs("div",{className:"transfer-info",children:[e.jsx("strong",{children:s.destinationLocation?R(s.destinationLocation):"Seleccionar destino"}),e.jsx("small",{children:"Destino"})]})]})]})}),s.destinationLocation&&j[s.destinationLocation]&&e.jsx("div",{className:"selection-confirmation",children:e.jsxs("div",{className:"confirmation-card destination-confirmation",children:[e.jsxs("div",{className:"confirmation-header",children:[e.jsx("span",{className:"confirmation-icon",children:"ğŸ¯"}),e.jsxs("div",{className:"confirmation-text",children:[e.jsx("strong",{children:R(s.destinationLocation)}),e.jsx("br",{}),e.jsx("small",{children:"UbicaciÃ³n de destino confirmada"})]})]}),e.jsxs("div",{className:"capacity-confirmation",children:[e.jsxs("div",{className:"capacity-detail",children:[e.jsx("span",{className:"capacity-label",children:"ğŸ“Š DespuÃ©s de transferir:"}),e.jsxs("span",{className:"capacity-value",children:[j[s.destinationLocation].afterTransfer.toFixed(1)," gal"]})]}),e.jsx("div",{className:"occupancy-bar",children:e.jsx("div",{className:"occupancy-fill",style:{width:`${j[s.destinationLocation].occupancyAfter}%`}})}),e.jsxs("small",{className:"occupancy-text",children:[j[s.destinationLocation].occupancyAfter.toFixed(1),"% de capacidad ocupada"]})]})]})})]})})},me=({formData:s,updateFormData:m,systemData:k,error:g,setError:h,isActive:f})=>{const[r,t]=p.useState(!1),[j,N]=p.useState(!1),{products:y}=k;p.useEffect(()=>{if(s.fuelType&&!s.unitPrice&&y.length>0){const a=y.find(n=>n.name===s.fuelType||n.displayName===s.fuelType);a&&a.defaultPrice&&(m("unitPrice",a.defaultPrice.toString()),N(!0))}},[s.fuelType,s.unitPrice,y,m]);const c=async a=>{const n=parseFloat(a);(a===""||!isNaN(n)&&n>=0)&&(t(!0),await new Promise(x=>setTimeout(x,300)),m("unitPrice",a),N(a!==""),h(""),t(!1))},S=a=>{m("effectiveDate",a)},o=a=>{m("description",a)},w=(parseFloat(s.quantity)||0)*(parseFloat(s.unitPrice)||0),A=a=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),b=()=>y.find(a=>a.name===s.fuelType||a.displayName===s.fuelType);return e.jsx("div",{className:`wizard-step step-details ${f?"active":""}`,children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h3",{children:"ğŸ“‹ InformaciÃ³n adicional del movimiento"}),e.jsx("p",{children:"Completa los detalles restantes:"})]}),e.jsxs("div",{className:"typeform-input-section",children:[e.jsx("label",{htmlFor:"unitPrice",children:"ğŸ’° Precio por galÃ³n (COP) *"}),e.jsx("input",{id:"unitPrice",type:"number",step:"1",min:"0",value:s.unitPrice,onChange:a=>c(a.target.value),placeholder:"0",className:`typeform-input ${g?"error":""}`}),e.jsx("span",{className:"typeform-unit",children:"COP"}),r&&e.jsxs("div",{className:"calculating-price",children:[e.jsx("div",{className:"loading-spinner small"}),e.jsx("span",{children:"ğŸ’° Validando precio..."})]}),b()?.defaultPrice&&e.jsxs("small",{className:"price-suggestion",children:["ğŸ’¡ Precio sugerido: $",b().defaultPrice.toLocaleString("es-CO")," COP"]})]}),s.quantity&&s.unitPrice&&j&&e.jsx("div",{className:"total-value-section",children:e.jsxs("div",{className:"total-value-card",children:[e.jsx("div",{className:"total-icon",children:"ğŸ“Š"}),e.jsxs("div",{className:"total-content",children:[e.jsx("h4",{children:"Valor Total Calculado"}),e.jsxs("div",{className:"total-calculation",children:[e.jsxs("span",{className:"calculation-details",children:[parseFloat(s.quantity).toFixed(2)," gal Ã— $",parseFloat(s.unitPrice).toLocaleString("es-CO")," COP"]}),e.jsx("div",{className:"total-amount",children:A(w)})]})]})]})}),e.jsxs("div",{className:"typeform-input-section",children:[e.jsx("label",{htmlFor:"effectiveDate",children:"ğŸ“… Â¿CuÃ¡ndo ocurriÃ³ este movimiento?"}),e.jsx("input",{id:"effectiveDate",type:"datetime-local",value:s.effectiveDate,onChange:a=>S(a.target.value),className:"typeform-input"}),e.jsx("small",{className:"typeform-unit",children:"ğŸ’¡ Por defecto se usa la fecha y hora actual"})]}),e.jsxs("div",{className:"typeform-input-section",children:[e.jsx("label",{htmlFor:"description",children:"ğŸ“ Detalles adicionales del movimiento (opcional)"}),e.jsx("textarea",{id:"description",value:s.description,onChange:a=>o(a.target.value),placeholder:"Ej: Combustible para operaciÃ³n en sector norte, mantenimiento programado, etc.",className:"typeform-input",rows:"3",maxLength:"500"}),e.jsxs("div",{className:"description-counter",children:[s.description.length,"/500 caracteres"]})]})]})})},pe=({formData:s,systemData:m,error:k,onCommentsChange:g,confirmChecked:h,onConfirmChange:f})=>{const{vehicles:r,products:t}=m,j=n=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(n),N=()=>({[l.ENTRADA]:{icon:"ğŸ“¥",title:"Entrada de Combustible",color:"entrada"},[l.SALIDA]:{icon:"â›½",title:"Salida de Combustible",color:"salida"},[l.TRANSFERENCIA]:{icon:"ğŸ”„",title:"Transferencia",color:"transferencia"},[l.AJUSTE]:{icon:"âš–ï¸",title:"Ajuste de Inventario",color:"ajuste"}})[s.type]||{icon:"â“",title:"OperaciÃ³n",color:"unknown"},y=()=>t.find(n=>n.name===s.fuelType||n.displayName===s.fuelType),c=()=>r.find(n=>n.vehicleId===s.vehicleId),S=()=>{const n=parseFloat(s.quantity).toLocaleString("es-CO"),x=y()?.displayName||s.fuelType,i=c();switch(s.type){case l.ENTRADA:return`Recibir ${n} galones de ${x} de ${s.supplierName}`;case l.SALIDA:return`Entregar ${n} galones de ${x} a ${i?.vehicleId||"vehÃ­culo"}`;case l.TRANSFERENCIA:return`Transferir ${n} galones de ${x} desde ${R(s.location)} hacia ${R(s.destinationLocation)}`;case l.AJUSTE:return`Ajustar ${n} galones de ${x} en ${R(s.location)}`;default:return`Procesar ${n} galones de ${x}`}},o=(parseFloat(s.quantity)||0)*(parseFloat(s.unitPrice)||0),w=N(),A=y(),b=c(),a=n=>{g(n.target.value)};return e.jsx("div",{className:"wizard-step step-summary",children:e.jsxs("div",{className:"typeform-layout",children:[e.jsxs("div",{className:"typeform-question",children:[e.jsx("h2",{children:"ğŸ¯ Â¡Perfecto! Vamos a confirmar"}),e.jsx("p",{children:"Revisa que todo estÃ© correcto antes de procesar tu operaciÃ³n"})]}),e.jsxs("div",{className:"summary-main",children:[e.jsxs("div",{className:`summary-header ${w.color}`,children:[e.jsx("div",{className:"summary-icon",children:w.icon}),e.jsxs("div",{className:"summary-title",children:[e.jsx("h4",{children:w.title}),e.jsx("p",{children:S()})]}),e.jsx("div",{className:"summary-value",children:j(o)})]}),e.jsxs("div",{className:"summary-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"â›½"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Combustible"}),e.jsx("span",{className:"detail-value",children:A?.displayName||s.fuelType})]})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"ğŸ“Š"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Cantidad"}),e.jsxs("span",{className:"detail-value",children:[parseFloat(s.quantity).toLocaleString("es-CO")," galones"]})]})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"ğŸ’°"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Precio unitario"}),e.jsx("span",{className:"detail-value",children:j(parseFloat(s.unitPrice))})]})]}),s.type===l.ENTRADA&&e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"ğŸª"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Proveedor"}),e.jsx("span",{className:"detail-value",children:s.supplierName})]})]}),(s.type===l.SALIDA||s.type===l.TRANSFERENCIA)&&e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"ğŸ“"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"UbicaciÃ³n origen"}),e.jsx("span",{className:"detail-value",children:R(s.location)})]})]}),s.type===l.SALIDA&&b&&e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"ğŸš—"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"VehÃ­culo"}),e.jsxs("span",{className:"detail-value",children:[b.vehicleId,s.currentHours&&` - ${s.currentHours} hrs`]})]})]}),s.type===l.TRANSFERENCIA&&e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"ğŸ¯"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"Destino"}),e.jsx("span",{className:"detail-value",children:R(s.destinationLocation)})]})]}),s.description&&e.jsxs("div",{className:"detail-row",children:[e.jsx("div",{className:"detail-icon",children:"ğŸ“"}),e.jsxs("div",{className:"detail-content",children:[e.jsx("span",{className:"detail-label",children:"DescripciÃ³n"}),e.jsx("span",{className:"detail-value description",children:s.description})]})]})]})]}),e.jsxs("div",{className:"typeform-input-section",children:[e.jsx("label",{htmlFor:"additional-comments",children:"ğŸ’¬ Â¿AlgÃºn comentario adicional? (Opcional)"}),e.jsx("textarea",{id:"additional-comments",value:s.additionalComments||"",onChange:a,placeholder:"Escribe cualquier observaciÃ³n o detalle especial...",className:"typeform-textarea",rows:"3"})]}),e.jsxs("div",{className:"confirmation-section",children:[e.jsxs("div",{className:"confirmation-checkbox",children:[e.jsx("input",{type:"checkbox",id:"final-confirm",checked:h,onChange:n=>f(n.target.checked)}),e.jsx("label",{htmlFor:"final-confirm",children:"âœ… Confirmo que toda la informaciÃ³n es correcta y deseo procesar este movimiento"})]}),e.jsx("div",{className:"confirmation-warning",children:"âš ï¸ Este movimiento actualizarÃ¡ automÃ¡ticamente el inventario de combustibles"})]}),k&&e.jsxs("div",{className:"validation-warning",children:["ğŸš« ",k]}),e.jsxs("div",{className:"final-message",children:[e.jsxs("p",{children:["ğŸ‰ ",e.jsx("strong",{children:"Â¡Listo para procesar!"})]}),e.jsx("p",{children:"Tu movimiento serÃ¡ registrado inmediatamente en el sistema."})]})]})})},he=({isOpen:s,onClose:m,onSuccess:k})=>{const{inventory:g,vehicles:h,suppliers:f,subscribeToSuppliers:r}=D(),[t,j]=p.useState(1),[N,y]=p.useState(!1),[c,S]=p.useState(!1),[o,w]=p.useState(""),[A,b]=p.useState(!1),[a,n]=p.useState({type:"",fuelType:"",quantity:"",unitPrice:"",location:"",supplierName:"",vehicleId:"",destinationLocation:"",description:"",reference:"",effectiveDate:new Date().toISOString().slice(0,16),currentHours:""}),[x,i]=p.useState({vehicles:[],inventory:[],suppliers:[],products:[],loadingData:!0}),u=()=>{j(1),w(""),b(!1),n({type:"",fuelType:"",quantity:"",unitPrice:"",location:"",supplierName:"",vehicleId:"",destinationLocation:"",description:"",reference:"",effectiveDate:new Date().toISOString().slice(0,16),currentHours:""})};p.useEffect(()=>((async()=>{if(s){document.body.style.overflow="hidden",u(),i(M=>({...M,loadingData:!0}));try{console.log("ğŸ”„ Cargando productos y sincronizando datos en tiempo real..."),f.length===0&&r&&(console.log("ğŸ”„ SuscribiÃ©ndose a suppliers..."),r()),console.log("ğŸ” [WIZARD DEBUG] Datos disponibles:",{vehicles:h?.length||0,inventory:g?.length||0,suppliers:f?.length||0});const M=await ae();i({vehicles:h||[],inventory:g||[],suppliers:f||[],products:M||[],loadingData:!1}),console.log("âœ… Datos sincronizados para wizard - inventario en tiempo real:",g?.length||0,"items"),console.log("âœ… Suppliers cargados:",f?.length||0,"proveedores")}catch(M){console.error("âŒ Error al cargar datos del sistema:",M),w("No se pudieron cargar los datos necesarios. IntÃ©ntalo de nuevo."),i(F=>({...F,loadingData:!1}))}}else document.body.style.overflow="unset"})(),()=>{document.body.style.overflow="unset"}),[s,g,h,f,r]);const v=()=>{if(!a.type)return 8;let d;return a.type===l.TRANSFERENCIA?d=8:a.type===l.SALIDA||a.type===l.ENTRADA?d=7:d=6,console.log("ğŸ” [TOTAL STEPS]",{type:a.type,totalSteps:d,currentStep:t}),d},C=(d,M)=>{n(F=>({...F,[d]:M})),w("")},L=p.useCallback(()=>{let d=!1;switch(t){case 1:d=!!a.type;break;case 2:d=!!a.fuelType,console.log("ğŸ” [STEP 2 VALIDATION]",{fuelType:a.fuelType,isValid:d,formData:a});break;case 3:a.type===l.ENTRADA?d=!!a.supplierName:d=!!a.location;break;case"3b":d=!!a.destinationLocation;break;case 4:d=a.quantity&&parseFloat(a.quantity)>0,console.log("ğŸ” [DEBUG Step 4] ValidaciÃ³n cantidad:",{step:t,quantity:a.quantity,parsedQuantity:parseFloat(a.quantity),isQuantityValid:!!a.quantity,isParsedValid:parseFloat(a.quantity)>0,finalValidation:d,formData:a});break;case 5:if(a.type===l.SALIDA){if(d=!!a.vehicleId,d&&a.vehicleId){const M=h.find(F=>F.vehicleId===a.vehicleId);M&&(M.fuelType==="diesel"||M.fuelType==="Diesel")&&(d=!!a.currentHours&&parseFloat(a.currentHours)>=0)}}else d=!0;break;case 6:a.type===l.TRANSFERENCIA?d=!!a.destinationLocation:d=!0;break;case 7:d=!!a.unitPrice&&parseFloat(a.unitPrice)>=0;break;case 8:d=!0;break;default:d=!1}return console.log("ğŸ” [DEBUG General] validateCurrentStep:",{currentStep:t,isValid:d,formDataKeys:Object.keys(a),formData:a}),d},[t,a,h]),I=p.useMemo(()=>L(),[L]),P=()=>{y(!0);const d=L();if(console.log("ğŸ” [DEBUG nextStep] Intentando navegar:",{currentStep:t,isValid:d,formData:a,type:a.type}),d){const M=v();let F=t+1;t===3&&a.type===l.ENTRADA?F="3b":t==="3b"?F=4:t===4&&a.type!==l.SALIDA?a.type===l.TRANSFERENCIA?F=6:(a.type,l.ENTRADA,F=7):t===5&&a.type!==l.TRANSFERENCIA&&(F=7),console.log("ğŸ” [DEBUG Navigation] Navegando:",{from:t,to:F,totalSteps:M}),($=>a.type===l.ENTRADA?{1:1,2:2,3:3,"3b":4,4:5,7:6,8:7}[$]||$:a.type===l.SALIDA?{1:1,2:2,3:3,4:4,5:5,7:6,8:7}[$]||$:{1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8}[$]||$)(F)<=M&&j(F)}else console.log("âŒ [DEBUG] ValidaciÃ³n fallÃ³, no se puede navegar"),w("Por favor completa este paso antes de continuar");setTimeout(()=>y(!1),300)},E=()=>{if(y(!0),t>1&&t!=="3b"){let d=t-1;t===4&&a.type===l.ENTRADA?d="3b":(t===7&&a.type===l.ENTRADA||t===7&&a.type!==l.TRANSFERENCIA&&a.type!==l.SALIDA||t===6&&a.type!==l.SALIDA)&&(d=4),j(d)}else t==="3b"&&j(3);setTimeout(()=>y(!1),300)},T=async()=>{S(!0),w("");try{const d={...a};console.log("ğŸ” [SUBMIT] Datos completos antes de crear movimiento:",d);const M={...d,quantity:parseFloat(d.quantity),unitPrice:parseFloat(d.unitPrice),effectiveDate:new Date(d.effectiveDate)};console.log("ğŸ” [SUBMIT] MovementData enviado a createMovement:",M),await Z(M),k(),u()}catch(d){console.error("Error al crear movimiento:",d),w(d.message||"Error al crear el movimiento")}finally{S(!1)}},z=()=>{const d={formData:a,updateFormData:C,systemData:x,error:o,setError:w,isActive:!N};return{1:e.jsx(ce,{...d}),2:e.jsx(re,{...d}),3:e.jsx(oe,{...d}),"3b":e.jsx(_,{...d,isEntryDestination:!0}),4:e.jsx(de,{...d}),5:e.jsx(ue,{...d}),6:e.jsx(_,{...d}),7:e.jsx(me,{...d}),8:e.jsx(pe,{...d,onSubmit:T,isLoading:c,onCommentsChange:F=>C("additionalComments",F),confirmChecked:A,onConfirmChange:b})}[t]||e.jsx("div",{children:"Paso no encontrado"})};if(!s)return null;const U=v(),H=(d=>a.type===l.ENTRADA?{1:1,2:2,3:3,"3b":4,4:5,7:6,8:7}[d]||d:a.type===l.SALIDA?{1:1,2:2,3:3,4:4,5:5,7:6,8:7}[d]||d:{1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8}[d]||d)(t),G=H/U*100,Q=H>=U;return console.log("ğŸ” [WIZARD DEBUG]",{type:a.type,currentStep:t,currentLogicalStep:H,totalSteps:U,progress:G,isLastStep:Q,formDataKeys:Object.keys(a).filter(d=>a[d]),fuelType:a.fuelType}),e.jsx("div",{className:"modal-overlay wizard-overlay",onClick:m,children:e.jsxs("div",{className:`modal-content wizard-modal typeform-mode ${Q?"is-last-step":""}`,onClick:d=>d.stopPropagation(),children:[e.jsx("button",{className:"typeform-escape",onClick:m,"aria-label":"Cerrar wizard",children:"âœ•"}),e.jsx("div",{className:"typeform-progress",children:e.jsx("div",{className:"typeform-progress-fill",style:{width:`${G}%`}})}),e.jsx("div",{className:"wizard-header typeform-mode",children:e.jsxs("div",{className:"wizard-title",children:[e.jsx("h3",{children:"ğŸ§™â€â™‚ï¸ Asistente de Movimientos"}),e.jsx("button",{className:"modal-close",onClick:m,children:"âœ•"})]})}),e.jsx("div",{className:"wizard-body typeform-mode",children:x.loadingData?e.jsxs("div",{className:"wizard-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"ğŸ”„ Cargando datos del sistema..."})]}):e.jsx("div",{className:"wizard-step-container",children:z()})}),o&&e.jsxs("div",{className:"wizard-error",children:[e.jsx("span",{className:"error-icon",children:"âš ï¸"}),o]}),e.jsxs("div",{className:"typeform-navigation",children:[t>1&&e.jsx("button",{className:"typeform-nav-btn",onClick:E,disabled:N,"aria-label":"Paso anterior",children:"â†"}),Q?e.jsx("button",{className:"typeform-nav-btn",onClick:T,disabled:c||!A||N,"aria-label":"Confirmar movimiento",children:c?e.jsx("span",{className:"loading-spinner small"}):"âœ“"}):e.jsx("button",{className:"typeform-nav-btn",onClick:P,disabled:!I||N,"aria-label":"Siguiente paso",children:"â†’"})]}),e.jsxs("div",{className:"typeform-step-indicator",children:[e.jsx("div",{className:"step-number",children:H}),e.jsxs("span",{children:["de ",U]})]})]})})},ge=()=>{const{user:s,userProfile:m,deleteMovement:k}=D(),[g,h]=p.useState([]),[f,r]=p.useState(null),[t,j]=p.useState(!0),[N,y]=p.useState(null),[c,S]=p.useState({type:"",status:"",fuelType:"",vehicleId:"",dateRange:"all"}),[o,w]=p.useState(""),[A,b]=p.useState(!1);p.useEffect(()=>{if(!s)return;j(!0);const E=Y((T,z)=>{if(z){console.error("Error en suscripciÃ³n de movimientos:",z),y("Error al cargar movimientos"),j(!1);return}h(T),y(null),j(!1)},c);return()=>E()},[s,c.type,c.status,c.fuelType,c.vehicleId,c.dateRange]),p.useEffect(()=>{s&&(async()=>{try{const T=await X(c);r(T)}catch(T){console.error("Error al cargar estadÃ­sticas:",T)}})()},[s,g,c.type,c.status,c.fuelType,c.vehicleId,c.dateRange]);const a=g.filter(E=>{if(!o)return!0;const T=o.toLowerCase();return E.fuelType?.toLowerCase().includes(T)||E.type?.toLowerCase().includes(T)||E.location?.toLowerCase().includes(T)||E.vehicleId?.toLowerCase().includes(T)||E.description?.toLowerCase().includes(T)||E.reference?.toLowerCase().includes(T)}),n=()=>{b(!0)},x=E=>{alert(`ğŸ“‹ Detalles del movimiento:

Tipo: ${E.type}
Combustible: ${E.fuelType}
Cantidad: ${E.quantity} gal
Fecha: ${new Date(E.createdAt).toLocaleDateString("es-CO")}`)},i=()=>{b(!1)},u=E=>{S(T=>({...T,...E}))},v=()=>{S({type:"",status:"",fuelType:"",vehicleId:"",dateRange:"all"}),w("")},C=async E=>{if(window.confirm("Â¿EstÃ¡s seguro de que quieres aprobar este movimiento? Esta acciÃ³n actualizarÃ¡ el inventario."))try{await se(E),alert("Movimiento aprobado y stock actualizado.")}catch(T){console.error("Error al aprobar movimiento:",T),alert(`Error al aprobar movimiento: ${T.message}`)}},L=async E=>{if(window.confirm("Â¿EstÃ¡s seguro de que quieres rechazar este movimiento?"))try{await ee(E,{status:q.CANCELADO}),alert("Movimiento rechazado.")}catch(T){console.error("Error al rechazar movimiento:",T),alert(`Error al rechazar movimiento: ${T.message}`)}},I=async E=>{try{const T=await k(E);if(T.success)alert("Movimiento eliminado exitosamente.");else throw new Error(T.error)}catch(T){console.error("Error al eliminar movimiento:",T),alert(`Error al eliminar movimiento: ${T.message}`)}},P=m?.role==="admin"||m?.role==="contador"||m?.role==="cliente";return t?e.jsx("div",{className:"movements-main",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Cargando movimientos..."})]})}):N?e.jsx("div",{className:"movements-main",children:e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:"âš ï¸"}),e.jsx("h3",{children:"Error al cargar movimientos"}),e.jsx("p",{children:N}),e.jsx("button",{className:"btn-retry",onClick:()=>window.location.reload(),children:"Reintentar"})]})}):e.jsxs("div",{className:"movements-main",children:[e.jsxs("div",{className:"movements-header",children:[e.jsxs("div",{className:"header-title",children:[e.jsx("h2",{children:"ğŸ“Š Movimientos de Combustibles"}),e.jsx("p",{children:"Gestiona entradas, salidas, transferencias y ajustes de inventario"})]}),P&&e.jsx("div",{className:"create-movement-options",children:e.jsx("button",{className:"btn-create-movement primary",onClick:n,children:"â• Nuevo Movimiento"})})]}),f&&e.jsx(te,{stats:f,filters:c}),e.jsx(ie,{filters:c,onFilterChange:u,onClearFilters:v,searchTerm:o,onSearchChange:w,totalResults:a.length}),a.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ğŸ“‹"}),e.jsx("h3",{children:g.length===0?"No hay movimientos registrados":"No se encontraron movimientos"}),e.jsx("p",{children:g.length===0?"Comienza creando tu primer movimiento de combustible":"Intenta ajustar los filtros de bÃºsqueda"}),g.length===0&&P&&e.jsx("div",{className:"create-first-options",children:e.jsx("button",{className:"btn-create-first primary",onClick:n,children:"â• Crear Primer Movimiento"})})]}):e.jsx(le,{movements:a,onEdit:null,onView:x,onApprove:C,onReject:L,onDelete:I,userRole:m?.role}),A&&e.jsx(he,{isOpen:A,onClose:i,onSuccess:()=>{i()}})]})};export{ge as default};
