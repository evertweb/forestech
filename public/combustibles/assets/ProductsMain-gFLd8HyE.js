import{r as p,j as e,D as K,f as w,a as z,P as ee,L as M,k as I,b as F,N as Y,i as R,a4 as H,Q as se,d as J,e as ae,s as G,W as re}from"./index-BQoCA6St.js";import{a as P,s as te,b as _,c as $,d as ce,u as ie}from"./productsService-Dg4KaRGU.js";const oe=({isOpen:m,onClose:d,product:i,mode:h="create",onSave:g,userRole:j})=>{const[o,E]=p.useState({name:"",displayName:"",category:P.COMBUSTIBLE,unit:"gal",defaultPrice:0,color:"#FF6B35",icon:"🛢️",description:"",isActive:!0,currentStock:0,minThreshold:10,maxCapacity:1e3}),[l,y]=p.useState({}),[b,k]=p.useState(!1),A=[{value:"gal",label:"Galones (gal)"},{value:"L",label:"Litros (L)"},{value:"kg",label:"Kilogramos (kg)"},{value:"und",label:"Unidades (und)"}],N={[P.COMBUSTIBLE]:["🛢️","🚛","🚗","⛽","🌿"],[P.ACEITE]:["🛢️","⚙️","🔧","🚜","🏭"],[P.LUBRICANTE]:["🟥","🟡","🔵","⚫","🟤"],[P.FLUIDO]:["🛑","💧","🔴","🟢","🔵"]},t=["#FF6B35","#4CAF50","#2196F3","#FF9800","#F44336","#9C27B0","#E91E63","#795548","#607D8B","#3F51B5"];p.useEffect(()=>{E(i&&(h==="edit"||h==="view")?{name:i.name||"",displayName:i.displayName||"",category:i.category||P.COMBUSTIBLE,unit:i.unit||"gal",defaultPrice:i.defaultPrice||0,color:i.color||"#FF6B35",icon:i.icon||"🛢️",description:i.description||"",isActive:i.isActive!==void 0?i.isActive:!0,currentStock:i.currentStock||0,minThreshold:i.minThreshold||10,maxCapacity:i.maxCapacity||1e3}:{name:"",displayName:"",category:P.COMBUSTIBLE,unit:"gal",defaultPrice:0,color:"#FF6B35",icon:"🛢️",description:"",isActive:!0,currentStock:0,minThreshold:10,maxCapacity:1e3}),y({})},[i,h,m]);const r=c=>{const{name:f,value:S,type:v,checked:T}=c.target;E(D=>({...D,[f]:v==="checkbox"?T:S})),l[f]&&y(D=>({...D,[f]:""}))},C=()=>{const c={};return o.name.trim()||(c.name="El nombre es requerido"),o.displayName.trim()||(c.displayName="El nombre de visualización es requerido"),o.category||(c.category="La categoría es requerida"),o.unit||(c.unit="La unidad es requerida"),o.defaultPrice<0&&(c.defaultPrice="El precio debe ser mayor o igual a 0"),o.currentStock<0&&(c.currentStock="El stock debe ser mayor o igual a 0"),o.minThreshold<0&&(c.minThreshold="El umbral mínimo debe ser mayor o igual a 0"),o.maxCapacity<=0&&(c.maxCapacity="La capacidad máxima debe ser mayor a 0"),o.minThreshold>=o.maxCapacity&&(c.minThreshold="El umbral mínimo debe ser menor que la capacidad máxima"),y(c),Object.keys(c).length===0},u=async c=>{if(c.preventDefault(),!!C()){k(!0);try{await g({...o,defaultPrice:parseFloat(o.defaultPrice),currentStock:parseFloat(o.currentStock),minThreshold:parseFloat(o.minThreshold),maxCapacity:parseFloat(o.maxCapacity)}),d()}catch(f){console.error("Error saving product:",f),y({submit:"Error al guardar el producto"})}finally{k(!1)}}};if(!m)return null;const n=["admin","supervisor"].includes(j)&&h!=="view";return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content product-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[h==="create"&&"➕ Crear Producto",h==="edit"&&"✏️ Editar Producto",h==="view"&&"👁️ Ver Producto"]}),e.jsx("button",{className:"modal-close",onClick:d,children:"✕"})]}),e.jsxs("form",{onSubmit:u,className:"modal-body",children:[e.jsx("div",{className:"product-preview",children:e.jsxs("div",{className:"preview-card",children:[e.jsx("div",{className:"preview-icon",style:{color:o.color},children:o.icon}),e.jsxs("div",{className:"preview-info",children:[e.jsx("h3",{children:o.displayName||"Nombre del producto"}),e.jsx("p",{className:"preview-category",children:o.category}),e.jsx("p",{className:"preview-description",children:o.description}),e.jsxs("div",{className:"preview-price",children:["$",new Intl.NumberFormat("es-CO").format(o.defaultPrice)," / ",o.unit]})]})]})}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"📝 Información Básica"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre Interno *"}),e.jsx("input",{type:"text",name:"name",value:o.name,onChange:r,disabled:!n,placeholder:"Ej: ACPM, GASOLINA"}),l.name&&e.jsx("span",{className:"error",children:l.name})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre de Visualización *"}),e.jsx("input",{type:"text",name:"displayName",value:o.displayName,onChange:r,disabled:!n,placeholder:"Ej: ACPM 🚛, Gasolina 🚗"}),l.displayName&&e.jsx("span",{className:"error",children:l.displayName})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Categoría *"}),e.jsx("select",{name:"category",value:o.category,onChange:r,disabled:!n,children:Object.values(P).map(c=>e.jsx("option",{value:c,children:c},c))}),l.category&&e.jsx("span",{className:"error",children:l.category})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Descripción"}),e.jsx("textarea",{name:"description",value:o.description,onChange:r,disabled:!n,placeholder:"Descripción del producto...",rows:"3"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"⚙️ Configuración"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Unidad de Medida *"}),e.jsx("select",{name:"unit",value:o.unit,onChange:r,disabled:!n,children:A.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))}),l.unit&&e.jsx("span",{className:"error",children:l.unit})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Precio por Defecto"}),e.jsx("input",{type:"number",name:"defaultPrice",value:o.defaultPrice,onChange:r,disabled:!n,min:"0",step:"0.01"}),l.defaultPrice&&e.jsx("span",{className:"error",children:l.defaultPrice})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"isActive",checked:o.isActive,onChange:r,disabled:!n}),"Producto Activo"]})})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"📊 Stock y Umbrales"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Stock Actual"}),e.jsx("input",{type:"number",name:"currentStock",value:o.currentStock,onChange:r,disabled:!n,min:"0",step:"0.01"}),l.currentStock&&e.jsx("span",{className:"error",children:l.currentStock})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Umbral Mínimo"}),e.jsx("input",{type:"number",name:"minThreshold",value:o.minThreshold,onChange:r,disabled:!n,min:"0",step:"0.01"}),l.minThreshold&&e.jsx("span",{className:"error",children:l.minThreshold})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Capacidad Máxima"}),e.jsx("input",{type:"number",name:"maxCapacity",value:o.maxCapacity,onChange:r,disabled:!n,min:"1",step:"0.01"}),l.maxCapacity&&e.jsx("span",{className:"error",children:l.maxCapacity})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"🎨 Apariencia"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Icono"}),e.jsx("div",{className:"icon-selector",children:N[o.category]?.map(c=>e.jsx("button",{type:"button",className:`icon-option ${o.icon===c?"selected":""}`,onClick:()=>E(f=>({...f,icon:c})),disabled:!n,children:c},c))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Color"}),e.jsx("div",{className:"color-selector",children:t.map(c=>e.jsx("button",{type:"button",className:`color-option ${o.color===c?"selected":""}`,style:{backgroundColor:c},onClick:()=>E(f=>({...f,color:c})),disabled:!n},c))})]})]})]}),l.submit&&e.jsx("div",{className:"error-message",children:l.submit})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:d,disabled:b,children:h==="view"?"Cerrar":"Cancelar"}),n&&e.jsx("button",{type:"submit",className:"btn-primary",onClick:u,disabled:b,children:b?"Guardando...":"Guardar"})]})]})})},ne=({products:m})=>{const[d,i]=p.useState([]),[h,g]=p.useState(!0);p.useEffect(()=>{const t=K(r=>{i(r),g(!1)},r=>{console.error("Error loading movements for stats:",r),g(!1)});return()=>t()},[]);const j=()=>m.map(r=>{const C=d.filter(v=>v.fuelType===r.name||v.fuelType===r.displayName),u=C.filter(v=>v.type==="entrada"),n=C.filter(v=>v.type==="salida"),c=u.reduce((v,T)=>v+(T.quantity||0),0),f=n.reduce((v,T)=>v+(T.quantity||0),0),S=(r.currentStock||0)*(r.defaultPrice||0);return{...r,totalEntries:c,totalExits:f,totalValue:S,entriesCount:u.length,exitsCount:n.length,stockStatus:o(r)}}),o=t=>{const r=t.currentStock||0,C=t.minThreshold||0,u=t.maxCapacity||1e3;return r===0?"empty":r<=C?"low":r>=u*.9?"high":"normal"},E=t=>{const r={};return Object.values(P).forEach(C=>{const u=t.filter(n=>n.category===C);r[C]={totalProducts:u.length,totalStock:u.reduce((n,c)=>n+(c.currentStock||0),0),totalValue:u.reduce((n,c)=>n+c.totalValue,0),totalEntries:u.reduce((n,c)=>n+c.totalEntries,0),totalExits:u.reduce((n,c)=>n+c.totalExits,0),lowStockCount:u.filter(n=>n.stockStatus==="low"||n.stockStatus==="empty").length}}),r};if(h)return e.jsxs("div",{className:"products-stats loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Cargando estadísticas..."})]});const l=j(),y=E(l),b=m.length,k=m.filter(t=>t.isActive).length,A=l.reduce((t,r)=>t+r.totalValue,0),N=l.filter(t=>t.stockStatus==="low"||t.stockStatus==="empty").length;return e.jsxs("div",{className:"products-stats",children:[e.jsx("h2",{children:"📊 Estadísticas de Productos"}),e.jsxs("div",{className:"stats-general",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"📦"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:w(b)}),e.jsx("p",{children:"Total Productos"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"✅"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:w(k)}),e.jsx("p",{children:"Productos Activos"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"💰"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:z(A)}),e.jsx("p",{children:"Valor Total Stock"})]})]}),e.jsxs("div",{className:`stat-card ${N>0?"alert":""}`,children:[e.jsx("div",{className:"stat-icon",children:"⚠️"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:w(N)}),e.jsx("p",{children:"Stock Bajo"})]})]})]}),e.jsxs("div",{className:"stats-categories",children:[e.jsx("h3",{children:"📈 Por Categoría"}),e.jsx("div",{className:"categories-grid",children:Object.entries(y).map(([t,r])=>e.jsxs("div",{className:"category-card",children:[e.jsx("h4",{children:t}),e.jsxs("div",{className:"category-stats",children:[e.jsxs("div",{className:"stat-row",children:[e.jsx("span",{children:"Productos:"}),e.jsx("span",{children:w(r.totalProducts)})]}),e.jsxs("div",{className:"stat-row",children:[e.jsx("span",{children:"Stock Total:"}),e.jsxs("span",{children:[w(r.totalStock)," unidades"]})]}),e.jsxs("div",{className:"stat-row",children:[e.jsx("span",{children:"Valor:"}),e.jsx("span",{children:z(r.totalValue)})]}),e.jsxs("div",{className:"stat-row",children:[e.jsx("span",{children:"Entradas:"}),e.jsx("span",{className:"positive",children:w(r.totalEntries)})]}),e.jsxs("div",{className:"stat-row",children:[e.jsx("span",{children:"Salidas:"}),e.jsx("span",{className:"negative",children:w(r.totalExits)})]}),r.lowStockCount>0&&e.jsxs("div",{className:"stat-row alert",children:[e.jsx("span",{children:"Stock Bajo:"}),e.jsx("span",{children:w(r.lowStockCount)})]})]})]},t))})]}),e.jsxs("div",{className:"stats-top-products",children:[e.jsx("h3",{children:"🏆 Top Productos por Stock"}),e.jsx("div",{className:"top-products-list",children:l.sort((t,r)=>(r.currentStock||0)-(t.currentStock||0)).slice(0,5).map((t,r)=>e.jsxs("div",{className:"top-product-item",children:[e.jsxs("div",{className:"rank",children:["#",r+1]}),e.jsx("div",{className:"product-icon",style:{color:t.color},children:t.icon}),e.jsxs("div",{className:"product-info",children:[e.jsx("span",{className:"product-name",children:t.displayName}),e.jsxs("span",{className:"product-stock",children:[w(t.currentStock||0)," ",t.unit]})]}),e.jsx("div",{className:"product-value",children:z(t.totalValue)})]},t.id))})]}),N>0&&e.jsxs("div",{className:"stats-alerts",children:[e.jsx("h3",{children:"⚠️ Alertas de Stock"}),e.jsx("div",{className:"alerts-list",children:l.filter(t=>t.stockStatus==="low"||t.stockStatus==="empty").map(t=>e.jsxs("div",{className:`alert-item ${t.stockStatus}`,children:[e.jsx("div",{className:"alert-icon",children:t.stockStatus==="empty"?"🔴":"🟡"}),e.jsxs("div",{className:"alert-info",children:[e.jsx("span",{className:"alert-product",children:t.displayName}),e.jsxs("span",{className:"alert-stock",children:["Stock: ",w(t.currentStock||0)," ",t.unit,t.stockStatus==="empty"&&" - ¡SIN STOCK!",t.stockStatus==="low"&&` - Mínimo: ${t.minThreshold}`]})]})]},t.id))})]})]})},O="productCategories",L=[{id:"combustible",name:"Combustible",description:"Combustibles líquidos como diesel, gasolina, mezclas",icon:"⛽",color:"#FF6B35",isDefault:!0,units:["gal","L"],fields:["octanage","density","supplier"]},{id:"aceite",name:"Aceite",description:"Aceites lubricantes y hidráulicos",icon:"🛢️",color:"#FF9800",isDefault:!0,units:["L","gal"],fields:["viscosity","temperature","application"]},{id:"lubricante",name:"Lubricante",description:"Grasas y lubricantes sólidos",icon:"🟥",color:"#F44336",isDefault:!0,units:["kg","g"],fields:["consistency","temperature","application"]},{id:"fluido",name:"Fluido",description:"Fluidos especializados (frenos, hidráulicos, etc.)",icon:"🛑",color:"#E91E63",isDefault:!0,units:["L","ml"],fields:["specification","temperature","compatibility"]}],W=[{key:"octanage",label:"Octanaje",icon:"🔥",type:"number"},{key:"density",label:"Densidad",icon:"⚖️",type:"number"},{key:"viscosity",label:"Viscosidad",icon:"🌊",type:"text"},{key:"temperature",label:"Temperatura Operación",icon:"🌡️",type:"text"},{key:"application",label:"Aplicación",icon:"🔧",type:"text"},{key:"supplier",label:"Proveedor",icon:"🏪",type:"text"},{key:"specification",label:"Especificación",icon:"📋",type:"text"},{key:"compatibility",label:"Compatibilidad",icon:"🔗",type:"text"},{key:"consistency",label:"Consistencia",icon:"💧",type:"text"}],le=(m,d=[])=>{const i=m.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"");let h=i,g=1;for(;d.some(j=>j.id===h);)h=`${i}_${g}`,g++;return h},de=async m=>{try{const d={...m,isDefault:!1,createdAt:G(),updatedAt:G()};return{id:(await re(I(F,O),d)).id,...d}}catch(d){throw console.error("Error creating category:",d),new Error("Error al crear la categoría: "+d.message)}},X=async()=>{try{const d=(await R(M(I(F,O),Y("name")))).docs.map(i=>({id:i.id,...i.data()}));return[...L,...d]}catch(m){return console.error("Error getting categories:",m),L}},ue=async(m,d)=>{try{if(L.some(h=>h.id===m))throw new Error("No se pueden editar las categorías predeterminadas");const i=J(F,O,m);return await ae(i,{...d,updatedAt:G()}),{success:!0}}catch(i){throw console.error("Error updating category:",i),new Error("Error al actualizar la categoría: "+i.message)}},me=async m=>{try{if(L.some(i=>i.id===m))throw new Error("No se pueden eliminar las categorías predeterminadas");if(!(await R(M(I(F,"products"),H("categoryId","==",m)))).empty)throw new Error("No se puede eliminar una categoría que tiene productos asociados");return await se(J(F,O,m)),{success:!0}}catch(d){throw console.error("Error deleting category:",d),new Error("Error al eliminar la categoría: "+d.message)}},he=m=>{try{return ee(M(I(F,O),Y("name")),i=>{const h=i.docs.map(j=>({id:j.id,...j.data()})),g=[...L,...h];m(g)},i=>{console.error("Error in categories subscription:",i),m(L)})}catch(d){return console.error("Error setting up categories subscription:",d),m(L),()=>{}}},Q=async()=>{try{const d=(await X()).map(async i=>{let h=0,g=0;try{const j=await R(M(I(F,"products"),H("category","==",i.name)));h=j.size,g=j.docs.filter(o=>o.data().isActive!==!1).length}catch(j){console.error(`Error getting stats for category ${i.id}:`,j)}return{id:i.id,productCount:h,activeProducts:g}});return await Promise.all(d)}catch(m){return console.error("Error getting category stats:",m),[]}},pe=({onClose:m,onCategoryCreated:d})=>{const[i,h]=p.useState([]),[g,j]=p.useState([]),[o,E]=p.useState(!0),[l,y]=p.useState(!1),[b,k]=p.useState(null),[A,N]=p.useState(!1),[t,r]=p.useState(""),C=["gal","L","kg","g","ml","oz","lb"],[u,n]=p.useState({name:"",description:"",icon:"📦",color:"#2E86AB",units:[],fields:[]});p.useEffect(()=>{c();const s=he(a=>{h(a),f()});return()=>s&&s()},[]);const c=async()=>{try{E(!0);const[s,a]=await Promise.all([X(),Q()]);h(s),j(a)}catch(s){console.error("Error cargando categorías:",s),r("Error al cargar categorías")}finally{E(!1)}},f=async()=>{try{const s=await Q();j(s)}catch(s){console.error("Error cargando estadísticas:",s)}},S=()=>{k(null),n({name:"",description:"",icon:"📦",color:"#2E86AB",units:[],fields:[]}),N(!0)},v=s=>{if(s.isDefault){r("No se pueden editar las categorías predeterminadas");return}k(s),n({name:s.name||"",description:s.description||"",icon:s.icon||"📦",color:s.color||"#2E86AB",units:s.units||[],fields:s.fields||[]}),N(!0)},T=async s=>{if(s.isDefault){r("No se pueden eliminar las categorías predeterminadas");return}if(window.confirm(`¿Está seguro de eliminar la categoría "${s.name}"?

Esta acción no se puede deshacer.`))try{y(!0),await me(s.id),r("")}catch(x){console.error("Error eliminando categoría:",x),r(x.message)}finally{y(!1)}},D=async s=>{if(s.preventDefault(),!u.name.trim()){r("El nombre de la categoría es requerido");return}try{y(!0),r("");const a={...u,name:u.name.trim(),description:u.description.trim()};if(b)await ue(b.id,a);else{a.id=le(a.name,i);const x=await de(a);d&&d(x)}N(!1)}catch(a){console.error("Error guardando categoría:",a),r(a.message)}finally{y(!1)}},q=s=>{n(a=>({...a,fields:a.fields.includes(s)?a.fields.filter(x=>x!==s):[...a.fields,s]}))},U=s=>{n(a=>({...a,units:a.units.includes(s)?a.units.filter(x=>x!==s):[...a.units,s]}))},B=s=>g.find(a=>a.id===s)||{productCount:0,activeProducts:0};return o?e.jsx("div",{className:"product-categories-manager",children:e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Cargando categorías..."})]})}):e.jsxs("div",{className:"product-categories-manager",children:[e.jsxs("div",{className:"categories-header",children:[e.jsx("h3",{children:"🏷️ Gestión de Categorías de Productos"}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{className:"btn-primary",onClick:S,disabled:l,children:"➕ Nueva Categoría"}),e.jsx("button",{className:"btn-secondary",onClick:m,children:"✕ Cerrar"})]})]}),t&&e.jsxs("div",{className:"error-message",children:[e.jsxs("span",{children:["⚠️ ",t]}),e.jsx("button",{onClick:()=>r(""),children:"✕"})]}),e.jsx("div",{className:"categories-grid",children:i.map(s=>{const a=B(s.id);return e.jsxs("div",{className:`category-card ${s.isDefault?"default":"custom"}`,style:{"--category-color":s.color},children:[e.jsxs("div",{className:"category-header",children:[e.jsx("div",{className:"category-icon",style:{color:s.color},children:s.icon}),e.jsxs("div",{className:"category-info",children:[e.jsx("h4",{children:s.name}),e.jsx("p",{children:s.description})]}),s.isDefault&&e.jsx("span",{className:"default-badge",children:"Predeterminada"})]}),e.jsxs("div",{className:"category-stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:a.productCount}),e.jsx("span",{className:"stat-label",children:"Productos"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:a.activeProducts}),e.jsx("span",{className:"stat-label",children:"Activos"})]})]}),e.jsxs("div",{className:"category-details",children:[e.jsxs("div",{className:"units",children:[e.jsx("strong",{children:"Unidades:"}),e.jsx("div",{className:"units-list",children:(s.units||[]).map(x=>e.jsx("span",{className:"unit-tag",children:x},x))})]}),e.jsxs("div",{className:"fields",children:[e.jsx("strong",{children:"Campos:"}),e.jsxs("div",{className:"fields-list",children:[(s.fields||[]).slice(0,3).map(x=>{const V=W.find(Z=>Z.key===x);return V?e.jsxs("span",{className:"field-tag",children:[V.icon," ",V.label]},x):null}),(s.fields||[]).length>3&&e.jsxs("span",{className:"more-fields",children:["+",(s.fields||[]).length-3," más"]})]})]})]}),e.jsxs("div",{className:"category-actions",children:[e.jsx("button",{className:"btn-edit",onClick:()=>v(s),disabled:s.isDefault||l,title:s.isDefault?"No se pueden editar categorías predeterminadas":"Editar categoría",children:"✏️ Editar"}),e.jsx("button",{className:"btn-delete",onClick:()=>T(s),disabled:s.isDefault||l||a.productCount>0,title:s.isDefault?"No se pueden eliminar categorías predeterminadas":a.productCount>0?"No se puede eliminar una categoría con productos asignados":"Eliminar categoría",children:"🗑️ Eliminar"})]})]},s.id)})}),A&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:b?"✏️ Editar Categoría":"➕ Nueva Categoría"}),e.jsx("button",{onClick:()=>N(!1),children:"✕"})]}),e.jsxs("form",{onSubmit:D,className:"category-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{children:"Información Básica"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre *"}),e.jsx("input",{type:"text",value:u.name,onChange:s=>n(a=>({...a,name:s.target.value})),placeholder:"Ej: Aditivos",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Icono"}),e.jsx("input",{type:"text",value:u.icon,onChange:s=>n(a=>({...a,icon:s.target.value})),placeholder:"📦",className:"icon-input"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Descripción"}),e.jsx("textarea",{value:u.description,onChange:s=>n(a=>({...a,description:s.target.value})),placeholder:"Describe el tipo de productos que incluye esta categoría",rows:"2"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Color"}),e.jsx("input",{type:"color",value:u.color,onChange:s=>n(a=>({...a,color:s.target.value})),className:"color-input"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{children:"Unidades de Medida"}),e.jsx("div",{className:"units-grid",children:C.map(s=>e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:u.units.includes(s),onChange:()=>U(s)}),e.jsx("span",{children:s})]},s))})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{children:"Campos Específicos"}),e.jsx("p",{className:"section-description",children:"Selecciona los campos que serán relevantes para esta categoría"}),e.jsx("div",{className:"fields-grid",children:W.map(s=>e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:u.fields.includes(s.key),onChange:()=>q(s.key)}),e.jsxs("span",{children:[s.icon," ",s.label]})]},s.key))})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{children:"Vista Previa"}),e.jsx("div",{className:"category-preview",style:{"--category-color":u.color},children:e.jsxs("div",{className:"category-header",children:[e.jsx("div",{className:"category-icon",style:{color:u.color},children:u.icon}),e.jsxs("div",{className:"category-info",children:[e.jsx("h4",{children:u.name||"Nombre de la categoría"}),e.jsx("p",{children:u.description||"Descripción de la categoría"})]})]})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>N(!1),disabled:l,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:l||!u.name.trim(),children:l?"Guardando...":b?"Actualizar":"Crear"})]})]})]})})]})},ge=({userProfile:m})=>{const[d,i]=p.useState([]),[h,g]=p.useState(!0),[j,o]=p.useState(null),[E,l]=p.useState(!1),[y,b]=p.useState(null),[k,A]=p.useState("create"),[N,t]=p.useState(""),[r,C]=p.useState(""),[u,n]=p.useState(!0),[c,f]=p.useState(!1),S=["admin","supervisor"].includes(m?.role);p.useEffect(()=>{g(!0);const s=te(a=>{i(a),g(!1),o(null)},a=>{console.error("Error loading products:",a),o("Error cargando productos"),g(!1)});return()=>s()},[]),p.useEffect(()=>{(async()=>{if(console.log("🔍 Debug - Inicializando productos:",{productsLength:d.length,loading:h,canManageProducts:S}),d.length===0&&!h&&S)try{console.log("🚀 Creando productos predefinidos...");const a=_();console.log("📦 Productos predefinidos:",a);for(const x of a)console.log("➕ Creando producto:",x.name),await $({name:x.name,displayName:x.displayName,category:x.category,unit:x.unit,defaultPrice:x.defaultPrice,color:x.color,icon:x.icon,description:x.description,isActive:!0,currentStock:0,minThreshold:10,maxCapacity:1e3});console.log("✅ Productos predefinidos creados exitosamente")}catch(a){console.error("❌ Error inicializando productos:",a)}else console.log("ℹ️ No se inicializan productos:",{reason:d.length>0?"Ya existen productos":h?"Está cargando":S?"Otra razón":"Sin permisos"})})()},[d.length,h,S]);const v=()=>{b(null),A("create"),l(!0)},T=s=>{b(s),A("edit"),l(!0)},D=s=>{b(s),A("view"),l(!0)},q=async s=>{if(window.confirm("¿Estás seguro de que deseas eliminar este producto?"))try{await ce(s)}catch(a){console.error("Error deleting product:",a),alert("Error al eliminar el producto")}},U=async s=>{try{k==="create"?await $(s):k==="edit"&&await ie(y.id,s),l(!1)}catch(a){throw console.error("Error saving product:",a),a}},B=d.filter(s=>{const a=s.displayName?.toLowerCase().includes(N.toLowerCase())||s.name?.toLowerCase().includes(N.toLowerCase()),x=!r||s.category===r;return a&&x});return h?e.jsx("div",{className:"products-main",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Cargando productos..."})]})}):j?e.jsx("div",{className:"products-main",children:e.jsxs("div",{className:"error-container",children:[e.jsxs("p",{children:["⚠️ ",j]}),e.jsx("button",{onClick:()=>window.location.reload(),children:"Reintentar"})]})}):e.jsxs("div",{className:"products-main",children:[e.jsxs("div",{className:"products-header",children:[e.jsxs("div",{className:"header-title",children:[e.jsx("h1",{children:"🛢️ Gestión de Productos"}),e.jsx("p",{children:"Administra los tipos de combustibles y productos disponibles"})]}),S&&e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{className:"btn-primary",onClick:v,children:"➕ Agregar Producto"}),e.jsx("button",{className:"btn-secondary",onClick:()=>f(!0),style:{marginLeft:"10px"},children:"🏷️ Gestionar Categorías"}),e.jsx("button",{className:"btn-secondary",onClick:async()=>{try{console.log("🧪 Forzando creación de productos predefinidos...");const s=_();for(const a of s)await $({name:a.name,displayName:a.displayName,category:a.category,unit:a.unit,defaultPrice:a.defaultPrice,color:a.color,icon:a.icon,description:a.description,isActive:!0,currentStock:0,minThreshold:10,maxCapacity:1e3});alert("Productos predefinidos creados exitosamente")}catch(s){console.error("Error:",s),alert("Error creando productos: "+s.message)}},style:{marginLeft:"10px"},children:"🧪 Crear Predefinidos"})]})]}),u&&e.jsx(ne,{products:d}),e.jsxs("div",{className:"products-filters",children:[e.jsx("div",{className:"filter-group",children:e.jsx("input",{type:"text",placeholder:"🔍 Buscar productos...",value:N,onChange:s=>t(s.target.value),className:"search-input"})}),e.jsx("div",{className:"filter-group",children:e.jsxs("select",{value:r,onChange:s=>C(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"🏷️ Todas las categorías"}),Object.values(P).map(s=>e.jsx("option",{value:s,children:s},s))]})}),e.jsx("div",{className:"filter-group",children:e.jsx("button",{className:`toggle-btn ${u?"active":""}`,onClick:()=>n(!u),children:"📊 Estadísticas"})})]}),e.jsx("div",{className:"products-grid",children:B.map(s=>e.jsxs("div",{className:"product-card",children:[e.jsx("div",{className:"product-icon",style:{color:s.color},children:s.icon}),e.jsxs("div",{className:"product-info",children:[e.jsx("h3",{children:s.displayName}),e.jsx("p",{className:"product-category",children:s.category}),e.jsx("p",{className:"product-description",children:s.description}),e.jsxs("div",{className:"product-stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Stock:"}),e.jsxs("span",{className:"stat-value",children:[s.currentStock||0," ",s.unit]})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Precio:"}),e.jsxs("span",{className:"stat-value",children:["$",new Intl.NumberFormat("es-CO").format(s.defaultPrice||0)]})]})]}),e.jsx("div",{className:`product-status ${s.isActive?"active":"inactive"}`,children:s.isActive?"✅ Activo":"❌ Inactivo"})]}),e.jsxs("div",{className:"product-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>D(s),children:"👁️ Ver"}),S&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-primary",onClick:()=>T(s),children:"✏️ Editar"}),e.jsx("button",{className:"btn-danger",onClick:()=>q(s.id),children:"🗑️ Eliminar"})]})]})]},s.id))}),B.length===0&&e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"📦"}),e.jsx("h3",{children:"No hay productos"}),e.jsx("p",{children:N||r?"No se encontraron productos con los filtros aplicados.":"Aún no hay productos registrados."}),S&&!N&&!r&&e.jsx("button",{className:"btn-primary",onClick:v,children:"➕ Crear primer producto"})]}),e.jsx(oe,{isOpen:E,onClose:()=>l(!1),product:y,mode:k,onSave:U,userRole:m?.role}),c&&e.jsx(pe,{onClose:()=>f(!1),onCategoryCreated:()=>{console.log("Nueva categoría creada")}})]})};export{ge as default};
