import{r as o,af as H,ag as $,ah as Q,ai as U,F as I,j as e,a as x,a7 as w,f as r,aj as B,ak as K,al as W,am as z,an as O,ao as _,l as E,ap as Y,aq as q,u as X}from"./index-xTTnogj4.js";const J=({inventory:N,movements:C})=>{const[u,M]=o.useState("all"),[R,b]=o.useState("stock_level"),A=o.useMemo(()=>u==="all"?N:N.filter(i=>i.location===u),[N,u]),y=o.useMemo(()=>[...new Set(N.map(d=>d.location))].filter(Boolean),[N]),h=o.useMemo(()=>H(A),[A]),p=o.useMemo(()=>$(A),[A]),f=o.useMemo(()=>Q(A),[A]),m=o.useMemo(()=>U(C),[C]),L=o.useMemo(()=>A.map(d=>{const g=I[d.fuelType]||{},t=parseFloat(d.currentStock)||0,s=parseFloat(d.maxCapacity)||0,a=s>0?t/s*100:0,c=t*(parseFloat(d.pricePerUnit)||0);return{...d,fuelInfo:g,percentage:a,value:c,stockLevel:a<15?"critical":a<30?"low":"good"}}).sort((d,g)=>{switch(R){case"stock_level":return d.percentage-g.percentage;case"value":return g.value-d.value;case"name":return d.productName.localeCompare(g.productName);case"location":return d.location.localeCompare(g.location);default:return 0}}),[A,R]),P=()=>{const i=["Producto","UbicaciÃ³n","Stock Actual","Capacidad","% Capacidad","Valor","Estado"],d=L.map(c=>[c.productName,c.location,r(c.currentStock),r(c.maxCapacity),w(c.percentage/100),x(c.value),c.stockLevel==="critical"?"CrÃ­tico":c.stockLevel==="low"?"Bajo":"Bueno"]),g=[i,...d].map(c=>c.join(",")).join(`
`),t=new Blob([g],{type:"text/csv"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`inventario_${new Date().toISOString().slice(0,10)}.csv`,a.click(),URL.revokeObjectURL(s)};return e.jsxs("div",{className:"inventory-reports",children:[e.jsxs("div",{className:"kpis-grid",children:[e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon inventory",children:"ðŸ’°"}),e.jsx("div",{className:"kpi-value",children:x(h.totalValue)}),e.jsx("div",{className:"kpi-label",children:"Valor Total"}),e.jsxs("div",{className:"kpi-trend neutral",children:[e.jsx("span",{className:"trend-icon",children:"ðŸ“¦"}),h.totalItems," productos"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon inventory",children:"ðŸ“Š"}),e.jsx("div",{className:"kpi-value",children:w(h.averageStockLevel/100)}),e.jsx("div",{className:"kpi-label",children:"Nivel Promedio"}),e.jsxs("div",{className:`kpi-trend ${h.averageStockLevel>60?"positive":h.averageStockLevel>30?"neutral":"negative"}`,children:[e.jsx("span",{className:"trend-icon",children:h.averageStockLevel>60?"ðŸ“ˆ":h.averageStockLevel>30?"âž¡ï¸":"ðŸ“‰"}),h.activeItems," activos"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon inventory",children:"âš ï¸"}),e.jsx("div",{className:"kpi-value",children:h.lowStockItems}),e.jsx("div",{className:"kpi-label",children:"Alertas de Stock"}),e.jsxs("div",{className:`kpi-trend ${h.criticalItems>0?"negative":"neutral"}`,children:[e.jsx("span",{className:"trend-icon",children:"ðŸš¨"}),h.criticalItems," crÃ­ticos"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon inventory",children:"ðŸŽ¯"}),e.jsxs("div",{className:"kpi-value",children:[r(m.confidence),"%"]}),e.jsx("div",{className:"kpi-label",children:"PrecisiÃ³n ProyecciÃ³n"}),e.jsxs("div",{className:"kpi-trend positive",children:[e.jsx("span",{className:"trend-icon",children:"ðŸ“Š"}),m.dataPoints," datos"]})]})]}),e.jsx("div",{className:"reports-filters",children:e.jsxs("div",{className:"filters-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"UbicaciÃ³n"}),e.jsxs("select",{className:"filter-select",value:u,onChange:i=>M(i.target.value),children:[e.jsx("option",{value:"all",children:"Todas las ubicaciones"}),y.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Ordenar por"}),e.jsxs("select",{className:"filter-select",value:R,onChange:i=>b(i.target.value),children:[e.jsx("option",{value:"stock_level",children:"Nivel de Stock"}),e.jsx("option",{value:"value",children:"Valor"}),e.jsx("option",{value:"name",children:"Nombre"}),e.jsx("option",{value:"location",children:"UbicaciÃ³n"})]})]}),e.jsx("div",{className:"filter-actions",children:e.jsx("button",{className:"filter-btn secondary",onClick:P,children:"ðŸ“Š Exportar CSV"})})]})}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"ðŸ›¢ï¸ Stock por Tipo de Combustible"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"stock-grid",children:Object.entries(f).map(([i,d])=>{const g=I[i]||{};return e.jsxs("div",{className:"stock-item",children:[e.jsxs("div",{className:"stock-header",children:[e.jsx("span",{className:"stock-icon",children:g.icon||"â›½"}),e.jsx("h4",{children:g.name||i.toUpperCase()})]}),e.jsxs("div",{className:"stock-value",children:[r(d)," ",g.unit||"L"]}),e.jsx("div",{className:"stock-status",children:d>1e3?e.jsx("span",{className:"badge success",children:"Stock Bueno"}):d>500?e.jsx("span",{className:"badge warning",children:"Stock Bajo"}):e.jsx("span",{className:"badge danger",children:"Stock CrÃ­tico"})})]},i)})})})]}),p.length>0&&e.jsxs("div",{className:"chart-container",children:[e.jsxs("div",{className:"chart-header",children:[e.jsx("h3",{className:"chart-title",children:"âš ï¸ Alertas de Stock Bajo"}),e.jsx("div",{className:"chart-actions",children:e.jsxs("span",{className:"badge danger",children:[p.length," alertas"]})})]}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"alerts-list",children:p.map((i,d)=>e.jsxs("div",{className:`alert ${i.stockLevel==="critical"?"critical":"warning"}`,children:[e.jsx("span",{className:"alert-icon",children:i.stockLevel==="critical"?"ðŸš¨":"âš ï¸"}),e.jsxs("div",{className:"alert-content",children:[e.jsxs("div",{className:"alert-title",children:[i.productName," - ",i.location]}),e.jsxs("div",{className:"alert-message",children:["Stock: ",r(i.currentStock)," ",i.unit,"(",w(i.percentage/100)," de capacidad mÃ¡xima)"]})]})]},d))})})]}),Object.keys(m.recommendedPurchases).length>0&&e.jsxs("div",{className:"chart-container",children:[e.jsxs("div",{className:"chart-header",children:[e.jsx("h3",{className:"chart-title",children:"ðŸ“ˆ Proyecciones de Compra (30 dÃ­as)"}),e.jsx("div",{className:"chart-actions",children:e.jsxs("span",{className:"badge info",children:["Confianza: ",r(m.confidence),"%"]})})]}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"projections-grid",children:Object.entries(m.recommendedPurchases).map(([i,d])=>{const g=I[i]||{},t=m.projectedConsumption[i];return e.jsxs("div",{className:"projection-item",children:[e.jsxs("div",{className:"projection-header",children:[e.jsx("span",{children:g.icon||"â›½"}),e.jsx("h4",{children:g.name||i.toUpperCase()})]}),e.jsxs("div",{className:"projection-value",children:[r(d)," ",g.unit||"L"]}),e.jsxs("div",{className:"projection-details",children:[e.jsxs("small",{children:["Consumo proyectado: ",r(t?.projectedTotal)," ",g.unit||"L"]}),e.jsxs("small",{children:["Promedio diario: ",r(t?.dailyAverage)," ",g.unit||"L"]})]})]},i)})})})]}),e.jsxs("div",{className:"report-table-container",children:[e.jsx("div",{className:"report-table-header",children:e.jsx("h3",{className:"report-table-title",children:"ðŸ“‹ Inventario Detallado"})}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{className:"report-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"UbicaciÃ³n"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Stock Actual"}),e.jsx("th",{children:"Capacidad"}),e.jsx("th",{children:"% Capacidad"}),e.jsx("th",{children:"Precio/Unidad"}),e.jsx("th",{children:"Valor Total"}),e.jsx("th",{children:"Estado"})]})}),e.jsx("tbody",{children:L.map((i,d)=>e.jsxs("tr",{children:[e.jsx("td",{children:i.productName}),e.jsx("td",{children:i.location}),e.jsxs("td",{children:[e.jsx("span",{style:{marginRight:"0.5rem"},children:i.fuelInfo.icon||"â›½"}),i.fuelInfo.name||i.fuelType]}),e.jsxs("td",{children:[r(i.currentStock)," ",i.unit]}),e.jsxs("td",{children:[r(i.maxCapacity)," ",i.unit]}),e.jsx("td",{children:e.jsx("span",{className:`text-${i.stockLevel==="critical"?"danger":i.stockLevel==="low"?"warning":"success"}`,children:w(i.percentage/100)})}),e.jsx("td",{children:x(i.pricePerUnit)}),e.jsx("td",{children:x(i.value)}),e.jsx("td",{children:e.jsx("span",{className:`badge ${i.stockLevel==="critical"?"danger":i.stockLevel==="low"?"warning":"success"}`,children:i.stockLevel==="critical"?"CrÃ­tico":i.stockLevel==="low"?"Bajo":"Bueno"})})]},d))})]})})]})]})},T={HARVESTING:"harvesting",TRANSPORT:"transport",MAINTENANCE:"maintenance",SUPPORT:"support"},S={CHAINSAW:"chainsaw",HARVESTER:"harvester",FORWARDER:"forwarder",SKIDDER:"skidder",LOG_TRUCK:"log_truck",PICKUP_TRUCK:"pickup_truck",CAR:"car",MOTORCYCLE:"motorcycle",ATV:"atv",BULLDOZER:"bulldozer",EXCAVATOR:"excavator",GRADER:"grader",LOADER:"loader",WATER_PUMP:"water_pump",FIRE_PUMP:"fire_pump",GENERATOR:"generator",COMPRESSOR:"compressor"},Z={[S.CHAINSAW]:{name:"Motosierra",category:T.HARVESTING,fuelType:"two_stroke",avgConsumption:2.5,icon:"ðŸªš",color:"#dc2626",description:"Herramienta para corte de Ã¡rboles"},[S.HARVESTER]:{name:"Cosechadora Forestal",category:T.HARVESTING,fuelType:"diesel",avgConsumption:25,icon:"ðŸšœ",color:"#059669",description:"MÃ¡quina para corte y procesamiento de Ã¡rboles"},[S.FORWARDER]:{name:"Forwarder",category:T.HARVESTING,fuelType:"diesel",avgConsumption:20,icon:"ðŸšš",color:"#0891b2",description:"Transporte de troncos dentro del bosque"},[S.LOG_TRUCK]:{name:"CamiÃ³n Maderero",category:T.TRANSPORT,fuelType:"acpm",avgConsumption:3.5,icon:"ðŸšš",color:"#ea580c",description:"Transporte de madera a destino"},[S.PICKUP_TRUCK]:{name:"Camioneta",category:T.TRANSPORT,fuelType:"gasoline",avgConsumption:8,icon:"ðŸš",color:"#2563eb",description:"Transporte de personal y herramientas"},[S.CAR]:{name:"AutomÃ³vil",category:T.TRANSPORT,fuelType:"gasoline",avgConsumption:12,icon:"ðŸš—",color:"#3b82f6",description:"VehÃ­culo liviano para transporte ejecutivo"},[S.MOTORCYCLE]:{name:"Motocicleta",category:T.TRANSPORT,fuelType:"gasoline",avgConsumption:25,icon:"ðŸï¸",color:"#6366f1",description:"Transporte Ã¡gil para terrenos difÃ­ciles"},[S.ATV]:{name:"Cuatrimoto",category:T.TRANSPORT,fuelType:"gasoline",avgConsumption:15,icon:"ðŸï¸",color:"#84cc16",description:"VehÃ­culo todo terreno para supervisiÃ³n"},[S.SKIDDER]:{name:"Skidder",category:T.HARVESTING,fuelType:"diesel",avgConsumption:22,icon:"ðŸšœ",color:"#f59e0b",description:"Arrastre de troncos desde el lugar de corte"},[S.BULLDOZER]:{name:"Bulldozer",category:T.MAINTENANCE,fuelType:"diesel",avgConsumption:30,icon:"ðŸšœ",color:"#f97316",description:"ConstrucciÃ³n y mantenimiento de caminos"},[S.EXCAVATOR]:{name:"Excavadora",category:T.MAINTENANCE,fuelType:"diesel",avgConsumption:28,icon:"ðŸ—ï¸",color:"#eab308",description:"ExcavaciÃ³n y movimiento de tierra"},[S.GRADER]:{name:"Motoniveladora",category:T.MAINTENANCE,fuelType:"diesel",avgConsumption:25,icon:"ðŸšœ",color:"#a3a3a3",description:"NivelaciÃ³n y mantenimiento de vÃ­as"},[S.LOADER]:{name:"Cargador Frontal",category:T.MAINTENANCE,fuelType:"diesel",avgConsumption:24,icon:"ðŸšœ",color:"#71717a",description:"Carga y descarga de materiales"},[S.WATER_PUMP]:{name:"Motobomba de Agua",category:T.SUPPORT,fuelType:"gasoline",avgConsumption:3.5,icon:"ðŸ’§",color:"#0891b2",description:"Bombeo de agua para operaciones"},[S.FIRE_PUMP]:{name:"Motobomba Contra Incendios",category:T.SUPPORT,fuelType:"gasoline",avgConsumption:4.2,icon:"ðŸ”¥",color:"#dc2626",description:"Equipo de emergencia contra incendios"},[S.GENERATOR]:{name:"Generador ElÃ©ctrico",category:T.SUPPORT,fuelType:"gasoline",avgConsumption:2.8,icon:"âš¡",color:"#7c3aed",description:"Suministro de energÃ­a elÃ©ctrica"},[S.COMPRESSOR]:{name:"Compresor de Aire",category:T.SUPPORT,fuelType:"gasoline",avgConsumption:2.5,icon:"ðŸ’¨",color:"#64748b",description:"Suministro de aire comprimido"}},ee=({vehicles:N,movements:C,dateRange:u})=>{const[M,R]=o.useState("all"),[b,A]=o.useState("all"),[y,h]=o.useState("efficiency"),p=o.useMemo(()=>{let s=N.filter(a=>a.status==="activo");return M!=="all"&&(s=s.filter(a=>a.category===M)),b!=="all"&&(s=s.filter(a=>a.fuelType===b)),s},[N,M,b]),f=o.useMemo(()=>!u.start&&!u.end?C:C.filter(s=>{const a=new Date(s.createdAt||s.date),c=u.start?new Date(u.start):new Date(0),n=u.end?new Date(u.end):new Date;return a>=c&&a<=n}),[C,u]),m=o.useMemo(()=>[...new Set(N.map(s=>s.category).filter(Boolean))],[N]),L=o.useMemo(()=>[...new Set(N.map(s=>s.fuelType).filter(Boolean))],[N]),P=o.useMemo(()=>B(p,f),[p,f]),i=o.useMemo(()=>p.map(a=>{const c=K(a,f),n=W(a,f),v=z(a,f),j=Z[a.type]||{},l=a.fuelType==="diesel"||a.fuelType==="Diesel",k=parseFloat(a.currentHours)||0,D=parseFloat(a.totalHoursWorked)||0,F=D>0?c.totalConsumption/D:0,V=j.avgConsumption||0,G=V>0&&F>0?(V-F)/V*100:0;return{...a,vehicleInfo:j,consumption:c,efficiency:n,costs:v,hasHourMeter:l,currentHours:k,totalHoursWorked:D,actualConsumptionPerHour:F,estimatedConsumption:V,efficiencyRating:G,nextMaintenanceHours:l?Math.ceil(k/250)*250:null,hoursToMaintenance:l?Math.ceil(k/250)*250-k:null}}).sort((a,c)=>{switch(y){case"efficiency":return c.efficiencyRating-a.efficiencyRating;case"consumption":return c.consumption.totalConsumption-a.consumption.totalConsumption;case"cost":return c.costs.totalCost-a.costs.totalCost;case"hours":return c.currentHours-a.currentHours;case"name":return a.name.localeCompare(c.name);default:return 0}}),[p,f,y]),d=o.useMemo(()=>{const s=[...i].sort((a,c)=>c.efficiencyRating-a.efficiencyRating);return{mostEfficient:s[0],leastEfficient:s[s.length-1],highestConsumption:[...i].sort((a,c)=>c.consumption.totalConsumption-a.consumption.totalConsumption)[0],nearMaintenance:i.filter(a=>a.hasHourMeter&&a.hoursToMaintenance<=50)}},[i]),g=o.useMemo(()=>{const s={};return L.forEach(a=>{const c=i.filter(l=>l.fuelType===a),n=c.reduce((l,k)=>l+k.consumption.totalConsumption,0),v=c.reduce((l,k)=>l+k.costs.totalCost,0),j=c.length>0?c.reduce((l,k)=>l+k.efficiencyRating,0)/c.length:0;s[a]={vehicleCount:c.length,totalConsumption:n,totalCost:v,avgEfficiency:j,avgConsumptionPerVehicle:c.length>0?n/c.length:0}}),s},[i,L]),t=()=>{const s=["VehÃ­culo","Tipo","Combustible","Horas Actuales","Consumo Total (L)","Consumo/Hora","Eficiencia (%)","Costo Total","PrÃ³ximo Mantenimiento"],a=i.map(l=>[l.vehicleId,l.type,l.fuelType,l.hasHourMeter?r(l.currentHours):"N/A",r(l.consumption.totalConsumption),r(l.actualConsumptionPerHour,2),r(l.efficiencyRating,1)+"%",x(l.costs.totalCost),l.hasHourMeter?`${l.nextMaintenanceHours}h`:"N/A"]),c=[s,...a].map(l=>l.join(",")).join(`
`),n=new Blob([c],{type:"text/csv"}),v=URL.createObjectURL(n),j=document.createElement("a");j.href=v,j.download=`vehiculos_${new Date().toISOString().slice(0,10)}.csv`,j.click(),URL.revokeObjectURL(v)};return e.jsxs("div",{className:"vehicle-reports",children:[e.jsxs("div",{className:"kpis-grid",children:[e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon vehicles",children:"ðŸšœ"}),e.jsx("div",{className:"kpi-value",children:P.activeVehicles}),e.jsx("div",{className:"kpi-label",children:"VehÃ­culos Activos"}),e.jsxs("div",{className:"kpi-trend positive",children:[e.jsx("span",{className:"trend-icon",children:"ðŸ“Š"}),r(P.totalHours)," horas total"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon vehicles",children:"â›½"}),e.jsx("div",{className:"kpi-value",children:r(P.totalConsumption)}),e.jsx("div",{className:"kpi-label",children:"Consumo Total (L)"}),e.jsxs("div",{className:"kpi-trend neutral",children:[e.jsx("span",{className:"trend-icon",children:"ðŸ“ˆ"}),r(P.averageEfficiency,1)," L/h promedio"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon vehicles",children:"âš¡"}),e.jsxs("div",{className:"kpi-value",children:[r(d.mostEfficient?.efficiencyRating||0,1),"%"]}),e.jsx("div",{className:"kpi-label",children:"Mejor Eficiencia"}),e.jsxs("div",{className:"kpi-trend positive",children:[e.jsx("span",{className:"trend-icon",children:"ðŸ†"}),d.mostEfficient?.vehicleId||"N/A"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon vehicles",children:"ðŸ”§"}),e.jsx("div",{className:"kpi-value",children:d.nearMaintenance.length}),e.jsx("div",{className:"kpi-label",children:"PrÃ³ximo Mantenimiento"}),e.jsxs("div",{className:`kpi-trend ${d.nearMaintenance.length>0?"negative":"positive"}`,children:[e.jsx("span",{className:"trend-icon",children:"âš ï¸"}),"â‰¤ 50 horas"]})]})]}),e.jsx("div",{className:"reports-filters",children:e.jsxs("div",{className:"filters-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"CategorÃ­a"}),e.jsxs("select",{className:"filter-select",value:M,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:"all",children:"Todas las categorÃ­as"}),m.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Tipo de Combustible"}),e.jsxs("select",{className:"filter-select",value:b,onChange:s=>A(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos los combustibles"}),L.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Ordenar por"}),e.jsxs("select",{className:"filter-select",value:y,onChange:s=>h(s.target.value),children:[e.jsx("option",{value:"efficiency",children:"Eficiencia"}),e.jsx("option",{value:"consumption",children:"Consumo"}),e.jsx("option",{value:"cost",children:"Costo"}),e.jsx("option",{value:"hours",children:"Horas"}),e.jsx("option",{value:"name",children:"Nombre"})]})]}),e.jsx("div",{className:"filter-actions",children:e.jsx("button",{className:"filter-btn secondary",onClick:t,children:"ðŸ“Š Exportar CSV"})})]})}),d.nearMaintenance.length>0&&e.jsx("div",{className:"alerts-container",children:d.nearMaintenance.map((s,a)=>e.jsxs("div",{className:"alert warning",children:[e.jsx("span",{className:"alert-icon",children:"ðŸ”§"}),e.jsxs("div",{className:"alert-content",children:[e.jsxs("div",{className:"alert-title",children:["Mantenimiento PrÃ³ximo: ",s.vehicleId]}),e.jsxs("div",{className:"alert-message",children:["Horas actuales: ",r(s.currentHours),"h | PrÃ³ximo mantenimiento: ",s.nextMaintenanceHours,"h | Faltan: ",r(s.hoursToMaintenance),"h"]})]})]},a))}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"â›½ AnÃ¡lisis por Tipo de Combustible"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"fuel-analysis-grid",children:Object.entries(g).map(([s,a])=>e.jsxs("div",{className:"fuel-analysis-item",children:[e.jsx("h4",{children:s.toUpperCase()}),e.jsxs("div",{className:"analysis-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"VehÃ­culos:"}),e.jsx("span",{className:"metric-value",children:a.vehicleCount})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Consumo Total:"}),e.jsxs("span",{className:"metric-value",children:[r(a.totalConsumption)," L"]})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Costo Total:"}),e.jsx("span",{className:"metric-value",children:x(a.totalCost)})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Eficiencia Promedio:"}),e.jsxs("span",{className:`metric-value ${a.avgEfficiency>10?"text-success":a.avgEfficiency>0?"text-warning":"text-danger"}`,children:[r(a.avgEfficiency,1),"%"]})]})]})]},s))})})]}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"ðŸ† AnÃ¡lisis de Rendimiento"})}),e.jsx("div",{className:"chart-content",children:e.jsxs("div",{className:"performers-grid",children:[e.jsxs("div",{className:"performer-item success",children:[e.jsx("h4",{children:"ðŸ¥‡ MÃ¡s Eficiente"}),e.jsx("div",{className:"performer-name",children:d.mostEfficient?.vehicleId||"N/A"}),e.jsxs("div",{className:"performer-metric",children:[r(d.mostEfficient?.efficiencyRating||0,1),"% eficiencia"]}),e.jsxs("div",{className:"performer-details",children:[r(d.mostEfficient?.actualConsumptionPerHour||0,2)," L/h"]})]}),e.jsxs("div",{className:"performer-item warning",children:[e.jsx("h4",{children:"âš ï¸ Mayor Consumo"}),e.jsx("div",{className:"performer-name",children:d.highestConsumption?.vehicleId||"N/A"}),e.jsxs("div",{className:"performer-metric",children:[r(d.highestConsumption?.consumption.totalConsumption||0)," L total"]}),e.jsxs("div",{className:"performer-details",children:[r(d.highestConsumption?.actualConsumptionPerHour||0,2)," L/h"]})]}),e.jsxs("div",{className:"performer-item danger",children:[e.jsx("h4",{children:"ðŸ“‰ Menos Eficiente"}),e.jsx("div",{className:"performer-name",children:d.leastEfficient?.vehicleId||"N/A"}),e.jsxs("div",{className:"performer-metric",children:[r(d.leastEfficient?.efficiencyRating||0,1),"% eficiencia"]}),e.jsxs("div",{className:"performer-details",children:[r(d.leastEfficient?.actualConsumptionPerHour||0,2)," L/h"]})]})]})})]}),e.jsxs("div",{className:"report-table-container",children:[e.jsx("div",{className:"report-table-header",children:e.jsx("h3",{className:"report-table-title",children:"ðŸšœ AnÃ¡lisis Detallado de VehÃ­culos"})}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{className:"report-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"VehÃ­culo"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Combustible"}),e.jsx("th",{children:"Horas Actuales"}),e.jsx("th",{children:"Horas Trabajadas"}),e.jsx("th",{children:"Consumo Total"}),e.jsx("th",{children:"L/Hora Real"}),e.jsx("th",{children:"L/Hora Estimado"}),e.jsx("th",{children:"Eficiencia"}),e.jsx("th",{children:"Costo Total"}),e.jsx("th",{children:"PrÃ³ximo Mantenimiento"})]})}),e.jsx("tbody",{children:i.map((s,a)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("strong",{children:s.vehicleId}),e.jsx("br",{}),e.jsx("small",{children:s.name})]}),e.jsx("td",{children:s.type}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.fuelType==="diesel"?"info":"secondary"}`,children:s.fuelType})}),e.jsx("td",{children:s.hasHourMeter?e.jsxs("span",{children:[r(s.currentHours),"h"]}):e.jsx("span",{className:"text-muted",children:"N/A"})}),e.jsxs("td",{children:[r(s.totalHoursWorked),"h"]}),e.jsxs("td",{children:[r(s.consumption.totalConsumption)," L"]}),e.jsx("td",{children:r(s.actualConsumptionPerHour,2)}),e.jsx("td",{children:r(s.estimatedConsumption,2)}),e.jsx("td",{children:e.jsxs("span",{className:`badge ${s.efficiencyRating>10?"success":s.efficiencyRating>0?"warning":"danger"}`,children:[r(s.efficiencyRating,1),"%"]})}),e.jsx("td",{children:x(s.costs.totalCost)}),e.jsx("td",{children:s.hasHourMeter?e.jsxs("span",{className:s.hoursToMaintenance<=50?"text-warning":"text-success",children:[s.nextMaintenanceHours,"h",e.jsx("br",{}),e.jsxs("small",{children:["(",r(s.hoursToMaintenance),"h restantes)"]})]}):e.jsx("span",{className:"text-muted",children:"N/A"})})]},a))})]})})]})]})},se=({movements:N,vehicles:C,dateRange:u,inventory:M})=>{const[R,b]=o.useState("month"),[A,y]=o.useState("previous"),h=o.useMemo(()=>!u.start&&!u.end?N:N.filter(t=>{const s=new Date(t.createdAt||t.date),a=u.start?new Date(u.start):new Date(0),c=u.end?new Date(u.end):new Date;return s>=a&&s<=c}),[N,u]),p=o.useMemo(()=>{if(!u.start||!u.end)return null;const t=new Date(u.start),s=new Date(u.end),a=Math.ceil((s-t)/(1e3*60*60*24)),c=new Date(t);c.setDate(c.getDate()-a);const n=new Date(t);return{movements:N.filter(j=>{const l=new Date(j.createdAt||j.date);return l>=c&&l<n}),period:`${c.toLocaleDateString()} - ${n.toLocaleDateString()}`}},[N,u]),f=o.useMemo(()=>{const t=O(h),s=_(h,u),a=h.filter(j=>j.type===E.ENTRADA),c=h.filter(j=>j.type===E.SALIDA),n=a.reduce((j,l)=>j+(parseFloat(l.quantity)||0)*(parseFloat(l.unitPrice)||0),0),v=c.reduce((j,l)=>j+(parseFloat(l.quantity)||0)*(parseFloat(l.unitPrice)||0),0);return{...t,...s,entradasValue:n,salidasValue:v,netFlow:n-v,turnoverRatio:n>0?v/n:0}},[h,u]),m=o.useMemo(()=>{if(!p)return null;const t=O(h),s=O(p.movements);return{costChange:t.totalCost-s.totalCost,costChangePercent:s.totalCost>0?(t.totalCost-s.totalCost)/s.totalCost*100:0,movementChange:h.length-p.movements.length,movementChangePercent:p.movements.length>0?(h.length-p.movements.length)/p.movements.length*100:0}},[h,p]),L=o.useMemo(()=>[...new Set(h.flatMap(s=>[s.location,s.sourceLocation,s.destinationLocation].filter(Boolean)))].map(s=>{const a=Y(h,s),c=h.filter(n=>n.location===s||n.sourceLocation===s||n.destinationLocation===s);return{location:s,...a,movementsPercentage:h.length>0?c.length/h.length*100:0}}).sort((s,a)=>a.totalCost-s.totalCost),[h]),P=o.useMemo(()=>{const t=h.filter(a=>a.type===E.ENTRADA&&a.supplierName),s={};return t.forEach(a=>{const c=a.supplierName,n=parseFloat(a.quantity)||0,v=n*(parseFloat(a.unitPrice)||0);s[c]||(s[c]={name:c,movementsCount:0,totalQuantity:0,totalValue:0,avgPrice:0,fuelTypes:new Set}),s[c].movementsCount++,s[c].totalQuantity+=n,s[c].totalValue+=v,s[c].fuelTypes.add(a.fuelType)}),Object.values(s).forEach(a=>{a.avgPrice=a.totalQuantity>0?a.totalValue/a.totalQuantity:0,a.fuelTypes=Array.from(a.fuelTypes)}),Object.values(s).sort((a,c)=>c.totalValue-a.totalValue)},[h]),i=o.useMemo(()=>{const t=U(N),s={};M.forEach(n=>{n.pricePerUnit&&(s[n.fuelType]=parseFloat(n.pricePerUnit))});const a={};Object.entries(t.recommendedPurchases).forEach(([n,v])=>{const j=s[n]||0;a[n]=v*j});const c=Object.values(a).reduce((n,v)=>n+v,0);return{...t,projectedCosts:a,totalProjectedCost:c,currentPrices:s}},[N,M]),d=o.useMemo(()=>{const t={};return h.forEach(s=>{let a=s.type;if(s.vehicleId){const n=C.find(v=>v.vehicleId===s.vehicleId);n&&(a=`${s.type}_${n.category||n.type}`)}const c=(parseFloat(s.quantity)||0)*(parseFloat(s.unitPrice)||0);t[a]||(t[a]=0),t[a]+=c}),Object.entries(t).map(([s,a])=>({category:s,cost:a})).sort((s,a)=>a.cost-s.cost).slice(0,10)},[h,C]),g=()=>{const t={period:`${u.start} a ${u.end}`,summary:f,locations:L,suppliers:P,projections:i,comparison:m},s=JSON.stringify(t,null,2),a=new Blob([s],{type:"application/json"}),c=URL.createObjectURL(a),n=document.createElement("a");n.href=c,n.download=`reporte_financiero_${new Date().toISOString().slice(0,10)}.json`,n.click(),URL.revokeObjectURL(c)};return e.jsxs("div",{className:"financial-reports",children:[e.jsxs("div",{className:"kpis-grid",children:[e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon financial",children:"ðŸ’°"}),e.jsx("div",{className:"kpi-value",children:x(f.totalCost)}),e.jsx("div",{className:"kpi-label",children:"Costo Total"}),e.jsxs("div",{className:`kpi-trend ${m?.costChangePercent>0?"negative":"positive"}`,children:[e.jsx("span",{className:"trend-icon",children:m?.costChangePercent>0?"ðŸ“ˆ":"ðŸ“‰"}),m?`${r(Math.abs(m.costChangePercent),1)}%`:"N/A"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon financial",children:"ðŸ“Š"}),e.jsx("div",{className:"kpi-value",children:x(f.averageCostPerMovement)}),e.jsx("div",{className:"kpi-label",children:"Costo Promedio"}),e.jsxs("div",{className:"kpi-trend neutral",children:[e.jsx("span",{className:"trend-icon",children:"ðŸ“‹"}),h.length," movimientos"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon financial",children:"ðŸ”„"}),e.jsx("div",{className:"kpi-value",children:x(f.netFlow)}),e.jsx("div",{className:"kpi-label",children:"Flujo Neto"}),e.jsxs("div",{className:`kpi-trend ${f.netFlow>0?"negative":"positive"}`,children:[e.jsx("span",{className:"trend-icon",children:f.netFlow>0?"ðŸ“¤":"ðŸ“¥"}),w(f.turnoverRatio)," rotaciÃ³n"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon financial",children:"ðŸ“ˆ"}),e.jsx("div",{className:"kpi-value",children:x(i.totalProjectedCost)}),e.jsx("div",{className:"kpi-label",children:"ProyecciÃ³n 30 dÃ­as"}),e.jsxs("div",{className:"kpi-trend info",children:[e.jsx("span",{className:"trend-icon",children:"ðŸŽ¯"}),r(i.confidence),"% confianza"]})]})]}),e.jsx("div",{className:"reports-filters",children:e.jsxs("div",{className:"filters-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"PerÃ­odo de AnÃ¡lisis"}),e.jsxs("select",{className:"filter-select",value:R,onChange:t=>b(t.target.value),children:[e.jsx("option",{value:"week",children:"Semanal"}),e.jsx("option",{value:"month",children:"Mensual"}),e.jsx("option",{value:"quarter",children:"Trimestral"}),e.jsx("option",{value:"year",children:"Anual"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Comparar con"}),e.jsxs("select",{className:"filter-select",value:A,onChange:t=>y(t.target.value),children:[e.jsx("option",{value:"previous",children:"PerÃ­odo anterior"}),e.jsx("option",{value:"year_ago",children:"Mismo perÃ­odo aÃ±o anterior"})]})]}),e.jsx("div",{className:"filter-actions",children:e.jsx("button",{className:"filter-btn secondary",onClick:g,children:"ðŸ“Š Exportar Reporte"})})]})}),m&&e.jsxs("div",{className:"chart-container",children:[e.jsxs("div",{className:"chart-header",children:[e.jsx("h3",{className:"chart-title",children:"ðŸ“Š ComparaciÃ³n con PerÃ­odo Anterior"}),e.jsx("div",{className:"chart-actions",children:e.jsxs("span",{className:"badge info",children:["vs ",p.period]})})]}),e.jsx("div",{className:"chart-content",children:e.jsxs("div",{className:"comparison-grid",children:[e.jsxs("div",{className:"comparison-item",children:[e.jsx("h4",{children:"ðŸ’° Cambio en Costos"}),e.jsxs("div",{className:`comparison-value ${m.costChangePercent>0?"negative":"positive"}`,children:[x(m.costChange),e.jsxs("span",{className:"comparison-percent",children:["(",m.costChangePercent>0?"+":"",r(m.costChangePercent,1),"%)"]})]})]}),e.jsxs("div",{className:"comparison-item",children:[e.jsx("h4",{children:"ðŸ“ˆ Cambio en Movimientos"}),e.jsxs("div",{className:`comparison-value ${m.movementChangePercent>0?"positive":"negative"}`,children:[m.movementChange>0?"+":"",m.movementChange,e.jsxs("span",{className:"comparison-percent",children:["(",m.movementChangePercent>0?"+":"",r(m.movementChangePercent,1),"%)"]})]})]})]})})]}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"ðŸ“ Costos por UbicaciÃ³n"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"location-analysis-grid",children:L.slice(0,6).map(t=>e.jsxs("div",{className:"location-item",children:[e.jsx("h4",{children:t.location}),e.jsxs("div",{className:"location-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Costo Total:"}),e.jsx("span",{className:"metric-value",children:x(t.totalCost)})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Movimientos:"}),e.jsx("span",{className:"metric-value",children:t.movementsCount})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"ParticipaciÃ³n:"}),e.jsxs("span",{className:"metric-value",children:[r(t.movementsPercentage,1),"%"]})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Promedio:"}),e.jsx("span",{className:"metric-value",children:x(t.averageCostPerMovement)})]})]})]},t.location))})})]}),P.length>0&&e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"ðŸª AnÃ¡lisis de Proveedores"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"suppliers-analysis",children:P.slice(0,5).map(t=>e.jsxs("div",{className:"supplier-item",children:[e.jsx("h4",{children:t.name}),e.jsxs("div",{className:"supplier-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Valor Total:"}),e.jsx("span",{className:"metric-value",children:x(t.totalValue)})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Cantidad:"}),e.jsxs("span",{className:"metric-value",children:[r(t.totalQuantity)," L"]})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Precio Promedio:"}),e.jsx("span",{className:"metric-value",children:x(t.avgPrice)})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Movimientos:"}),e.jsx("span",{className:"metric-value",children:t.movementsCount})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Combustibles:"}),e.jsx("span",{className:"metric-value",children:t.fuelTypes.join(", ")})]})]})]},t.name))})})]}),e.jsxs("div",{className:"chart-container",children:[e.jsxs("div",{className:"chart-header",children:[e.jsx("h3",{className:"chart-title",children:"ðŸ“ˆ Proyecciones Financieras (30 dÃ­as)"}),e.jsx("div",{className:"chart-actions",children:e.jsxs("span",{className:"badge success",children:["Confianza: ",r(i.confidence),"%"]})})]}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"projections-financial",children:Object.entries(i.projectedCosts).map(([t,s])=>{const a=i.recommendedPurchases[t],c=i.currentPrices[t],n=I[t]||{};return e.jsxs("div",{className:"projection-financial-item",children:[e.jsxs("h4",{children:[e.jsx("span",{style:{marginRight:"0.5rem"},children:n.icon||"â›½"}),n.name||t.toUpperCase()]}),e.jsxs("div",{className:"projection-financial-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Cantidad Proyectada:"}),e.jsxs("span",{className:"metric-value",children:[r(a)," ",n.unit||"L"]})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Precio Actual:"}),e.jsx("span",{className:"metric-value",children:x(c)})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Costo Proyectado:"}),e.jsx("span",{className:"metric-value highlight",children:x(s)})]})]})]},t)})})})]}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"ðŸ’¸ Top Costos por CategorÃ­a"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"top-costs-list",children:d.map((t,s)=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-rank",children:["#",s+1]}),e.jsxs("div",{className:"cost-info",children:[e.jsx("h4",{children:t.category.replace("_"," - ")}),e.jsxs("div",{className:"cost-percentage",children:[w(t.cost/f.totalCost)," del total"]})]}),e.jsx("div",{className:"cost-value",children:x(t.cost)})]},t.category))})})]}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"ðŸ“‹ Resumen Ejecutivo"})}),e.jsx("div",{className:"chart-content",children:e.jsxs("div",{className:"executive-summary",children:[e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"ðŸ’° Flujo de Efectivo"}),e.jsxs("div",{className:"summary-metrics",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Entradas:"}),e.jsx("span",{className:"text-success",children:x(f.entradasValue)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Salidas:"}),e.jsx("span",{className:"text-warning",children:x(f.salidasValue)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Balance:"}),e.jsx("span",{className:f.netFlow>0?"text-danger":"text-success",children:x(Math.abs(f.netFlow))})]})]})]}),e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"ðŸ“Š Eficiencia Operacional"}),e.jsxs("div",{className:"summary-metrics",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"RotaciÃ³n de Inventario:"}),e.jsx("span",{children:w(f.turnoverRatio)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Costo por Movimiento:"}),e.jsx("span",{children:x(f.averageCostPerMovement)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Total Movimientos:"}),e.jsx("span",{children:h.length})]})]})]})]})})]})]})},ae=({movements:N,dateRange:C,vehicles:u})=>{const[M,R]=o.useState("all"),[b,A]=o.useState("all"),[y,h]=o.useState("all"),p=o.useMemo(()=>{let s=N;return(C.start||C.end)&&(s=s.filter(a=>{const c=new Date(a.createdAt||a.date),n=C.start?new Date(C.start):new Date(0),v=C.end?new Date(C.end):new Date;return c>=n&&c<=v})),M!=="all"&&(s=s.filter(a=>a.type===M)),b!=="all"&&(s=s.filter(a=>a.fuelType===b)),y!=="all"&&(s=s.filter(a=>a.location===y||a.sourceLocation===y||a.destinationLocation===y)),s},[N,C,M,b,y]),f=o.useMemo(()=>{const s=[...new Set(N.map(c=>c.fuelType).filter(Boolean))],a=[...new Set(N.flatMap(c=>[c.location,c.sourceLocation,c.destinationLocation].filter(Boolean)))];return{fuelTypes:s,locations:a}},[N]),m=o.useMemo(()=>q(p),[p]),L=o.useMemo(()=>O(p),[p]);o.useMemo(()=>_(p,C),[p,C]);const P=o.useMemo(()=>Object.values(E).map(a=>{const c=p.filter(j=>j.type===a),n=c.reduce((j,l)=>j+(parseFloat(l.quantity)||0),0),v=c.reduce((j,l)=>j+(parseFloat(l.quantity)||0)*(parseFloat(l.unitPrice)||0),0);return{type:a,count:c.length,totalQuantity:n,totalValue:v,percentage:m.totalMovements>0?c.length/m.totalMovements*100:0}}),[p,m.totalMovements]),i=o.useMemo(()=>{const s={};return f.fuelTypes.forEach(a=>{const c=p.filter(l=>l.fuelType===a),n=c.reduce((l,k)=>l+(parseFloat(k.quantity)||0),0),v=c.reduce((l,k)=>l+(parseFloat(k.quantity)||0)*(parseFloat(k.unitPrice)||0),0),j=c.length>0?c.reduce((l,k)=>l+(parseFloat(k.unitPrice)||0),0)/c.length:0;s[a]={count:c.length,totalQuantity:n,totalValue:v,avgPrice:j,fuelInfo:I[a]||{}}}),s},[p,f.fuelTypes]),d=o.useMemo(()=>{const s={};return p.forEach(a=>{const c=new Date(a.createdAt||a.date),n=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`;s[n]||(s[n]={month:n,entradas:0,salidas:0,transferencias:0,ajustes:0,totalQuantity:0,totalValue:0});const v=parseFloat(a.quantity)||0,j=v*(parseFloat(a.unitPrice)||0);s[n][a.type]++,s[n].totalQuantity+=v,s[n].totalValue+=j}),Object.values(s).sort((a,c)=>a.month.localeCompare(c.month))},[p]),g=o.useMemo(()=>{const s={};return p.filter(a=>a.type===E.SALIDA&&a.vehicleId).forEach(a=>{const c=a.vehicleId,n=parseFloat(a.quantity)||0;s[c]||(s[c]={vehicleId:c,totalConsumption:0,movementsCount:0,vehicle:u.find(v=>v.vehicleId===c)}),s[c].totalConsumption+=n,s[c].movementsCount++}),Object.values(s).sort((a,c)=>c.totalConsumption-a.totalConsumption).slice(0,10)},[p,u]),t=()=>{const s=["Fecha","Tipo","Combustible","Cantidad","Precio Unitario","Valor Total","UbicaciÃ³n Origen","UbicaciÃ³n Destino","VehÃ­culo","Estado"],a=p.map(l=>[new Date(l.createdAt||l.date).toLocaleDateString(),l.type,l.fuelType,r(l.quantity),x(l.unitPrice),x((parseFloat(l.quantity)||0)*(parseFloat(l.unitPrice)||0)),l.sourceLocation||l.location||"",l.destinationLocation||"",l.vehicleId||"",l.status]),c=[s,...a].map(l=>l.join(",")).join(`
`),n=new Blob([c],{type:"text/csv"}),v=URL.createObjectURL(n),j=document.createElement("a");j.href=v,j.download=`movimientos_${new Date().toISOString().slice(0,10)}.csv`,j.click(),URL.revokeObjectURL(v)};return e.jsxs("div",{className:"movement-reports",children:[e.jsxs("div",{className:"kpis-grid",children:[e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon movements",children:"ðŸ“ˆ"}),e.jsx("div",{className:"kpi-value",children:m.totalMovements}),e.jsx("div",{className:"kpi-label",children:"Movimientos Totales"}),e.jsxs("div",{className:"kpi-trend positive",children:[e.jsx("span",{className:"trend-icon",children:"âœ…"}),m.completedMovements," completados"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon movements",children:"ðŸ›¢ï¸"}),e.jsx("div",{className:"kpi-value",children:r(m.totalQuantity)}),e.jsx("div",{className:"kpi-label",children:"Cantidad Total (L)"}),e.jsxs("div",{className:"kpi-trend neutral",children:[e.jsx("span",{className:"trend-icon",children:"ðŸ“Š"}),"Promedio: ",r(m.totalQuantity/(m.totalMovements||1),1)," L"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon financial",children:"ðŸ’°"}),e.jsx("div",{className:"kpi-value",children:x(L.totalCost)}),e.jsx("div",{className:"kpi-label",children:"Valor Total"}),e.jsxs("div",{className:"kpi-trend positive",children:[e.jsx("span",{className:"trend-icon",children:"ðŸ’µ"}),x(L.averageCostPerMovement)," promedio"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon movements",children:"âš ï¸"}),e.jsx("div",{className:"kpi-value",children:m.pendingMovements}),e.jsx("div",{className:"kpi-label",children:"Pendientes"}),e.jsxs("div",{className:`kpi-trend ${m.pendingMovements>0?"negative":"positive"}`,children:[e.jsx("span",{className:"trend-icon",children:m.pendingMovements>0?"â³":"âœ…"}),m.cancelledMovements," cancelados"]})]})]}),e.jsx("div",{className:"reports-filters",children:e.jsxs("div",{className:"filters-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Tipo de Movimiento"}),e.jsxs("select",{className:"filter-select",value:M,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos los tipos"}),e.jsx("option",{value:E.ENTRADA,children:"Entradas"}),e.jsx("option",{value:E.SALIDA,children:"Salidas"}),e.jsx("option",{value:E.TRANSFERENCIA,children:"Transferencias"}),e.jsx("option",{value:E.AJUSTE,children:"Ajustes"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Tipo de Combustible"}),e.jsxs("select",{className:"filter-select",value:b,onChange:s=>A(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos los combustibles"}),f.fuelTypes.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"UbicaciÃ³n"}),e.jsxs("select",{className:"filter-select",value:y,onChange:s=>h(s.target.value),children:[e.jsx("option",{value:"all",children:"Todas las ubicaciones"}),f.locations.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsx("div",{className:"filter-actions",children:e.jsx("button",{className:"filter-btn secondary",onClick:t,children:"ðŸ“Š Exportar CSV"})})]})}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"ðŸ“Š Movimientos por Tipo"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"movement-types-grid",children:P.map(s=>e.jsxs("div",{className:"movement-type-item",children:[e.jsxs("h4",{children:[s.type===E.ENTRADA&&"ðŸ“¥ Entradas",s.type===E.SALIDA&&"ðŸ“¤ Salidas",s.type===E.TRANSFERENCIA&&"ðŸ”„ Transferencias",s.type===E.AJUSTE&&"âš™ï¸ Ajustes"]}),e.jsxs("div",{className:"type-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-value",children:s.count}),e.jsx("span",{className:"metric-label",children:"Movimientos"})]}),e.jsxs("div",{className:"metric",children:[e.jsxs("span",{className:"metric-value",children:[r(s.totalQuantity)," L"]}),e.jsx("span",{className:"metric-label",children:"Cantidad"})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-value",children:x(s.totalValue)}),e.jsx("span",{className:"metric-label",children:"Valor"})]}),e.jsxs("div",{className:"metric",children:[e.jsxs("span",{className:"metric-value",children:[r(s.percentage,1),"%"]}),e.jsx("span",{className:"metric-label",children:"ParticipaciÃ³n"})]})]})]},s.type))})})]}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"â›½ AnÃ¡lisis por Tipo de Combustible"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"fuel-analysis-grid",children:Object.entries(i).map(([s,a])=>e.jsxs("div",{className:"fuel-analysis-item",children:[e.jsxs("h4",{children:[e.jsx("span",{style:{marginRight:"0.5rem"},children:a.fuelInfo.icon||"â›½"}),a.fuelInfo.name||s.toUpperCase()]}),e.jsxs("div",{className:"analysis-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Movimientos:"}),e.jsx("span",{className:"metric-value",children:a.count})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Cantidad:"}),e.jsxs("span",{className:"metric-value",children:[r(a.totalQuantity)," ",a.fuelInfo.unit||"L"]})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Valor:"}),e.jsx("span",{className:"metric-value",children:x(a.totalValue)})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Precio Promedio:"}),e.jsx("span",{className:"metric-value",children:x(a.avgPrice)})]})]})]},s))})})]}),g.length>0&&e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"ðŸšœ Top VehÃ­culos por Consumo"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"top-vehicles-list",children:g.slice(0,5).map((s,a)=>e.jsxs("div",{className:"top-vehicle-item",children:[e.jsxs("div",{className:"vehicle-rank",children:["#",a+1]}),e.jsxs("div",{className:"vehicle-info",children:[e.jsx("h4",{children:s.vehicleId}),e.jsx("p",{children:s.vehicle?.name||"Nombre no disponible"})]}),e.jsxs("div",{className:"vehicle-consumption",children:[e.jsxs("span",{className:"consumption-value",children:[r(s.totalConsumption)," L"]}),e.jsxs("span",{className:"consumption-movements",children:[s.movementsCount," movimientos"]})]})]},s.vehicleId))})})]}),d.length>0&&e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"ðŸ“ˆ Tendencia Temporal"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"temporal-analysis",children:d.map(s=>e.jsxs("div",{className:"month-data",children:[e.jsx("h4",{children:s.month}),e.jsxs("div",{className:"month-metrics",children:[e.jsxs("div",{className:"metric small",children:[e.jsx("span",{className:"metric-label",children:"ðŸ“¥ Entradas:"}),e.jsx("span",{className:"metric-value",children:s.entradas})]}),e.jsxs("div",{className:"metric small",children:[e.jsx("span",{className:"metric-label",children:"ðŸ“¤ Salidas:"}),e.jsx("span",{className:"metric-value",children:s.salidas})]}),e.jsxs("div",{className:"metric small",children:[e.jsx("span",{className:"metric-label",children:"ðŸ”„ Transferencias:"}),e.jsx("span",{className:"metric-value",children:s.transferencias})]}),e.jsxs("div",{className:"metric small",children:[e.jsx("span",{className:"metric-label",children:"ðŸ’° Valor:"}),e.jsx("span",{className:"metric-value",children:x(s.totalValue)})]})]})]},s.month))})})]}),e.jsxs("div",{className:"report-table-container",children:[e.jsx("div",{className:"report-table-header",children:e.jsx("h3",{className:"report-table-title",children:"ðŸ“‹ Movimientos Detallados"})}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{className:"report-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Combustible"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Precio Unit."}),e.jsx("th",{children:"Valor Total"}),e.jsx("th",{children:"Origen"}),e.jsx("th",{children:"Destino"}),e.jsx("th",{children:"VehÃ­culo"}),e.jsx("th",{children:"Estado"})]})}),e.jsx("tbody",{children:p.slice(0,100).map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:new Date(s.createdAt||s.date).toLocaleDateString()}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.type===E.ENTRADA?"success":s.type===E.SALIDA?"warning":s.type===E.TRANSFERENCIA?"info":"secondary"}`,children:s.type})}),e.jsx("td",{children:s.fuelType}),e.jsxs("td",{children:[r(s.quantity)," L"]}),e.jsx("td",{children:x(s.unitPrice)}),e.jsx("td",{children:x((parseFloat(s.quantity)||0)*(parseFloat(s.unitPrice)||0))}),e.jsx("td",{children:s.sourceLocation||s.location||"-"}),e.jsx("td",{children:s.destinationLocation||"-"}),e.jsx("td",{children:s.vehicleId||"-"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.status==="completado"?"success":s.status==="pendiente"?"warning":"danger"}`,children:s.status})})]},a))})]})}),p.length>100&&e.jsxs("div",{style:{padding:"1rem",textAlign:"center",color:"#64748b"},children:["Mostrando los primeros 100 de ",p.length," movimientos. Use los filtros para refinar la bÃºsqueda."]})]})]})},ie=()=>{const{inventory:N,movements:C,vehicles:u,suppliers:M,userProfile:R}=X(),[b,A]=o.useState("dashboard"),[y,h]=o.useState({start:new Date(Date.now()-30*24*60*60*1e3).toISOString().slice(0,10),end:new Date().toISOString().slice(0,10)}),p=o.useMemo(()=>H(N),[N]),f=o.useMemo(()=>q(C),[C]),m=o.useMemo(()=>B(u,C),[u,C]),L=o.useMemo(()=>$(N),[N]),P=o.useMemo(()=>U(C),[C]);if(!(R?.combustiblesPermissions?.canViewReports||R?.role==="admin"))return e.jsx("div",{className:"reports-main",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ”’"}),e.jsx("h3",{className:"empty-title",children:"Acceso Restringido"}),e.jsx("p",{className:"empty-message",children:"No tienes permisos para ver los reportes. Contacta a tu administrador."})]})});const d=[{id:"dashboard",title:"Dashboard",subtitle:"Vista ejecutiva",icon:"ðŸ“Š",component:null},{id:"inventory",title:"Inventario",subtitle:"Stock y alertas",icon:"ðŸ›¢ï¸",component:J},{id:"vehicles",title:"VehÃ­culos",subtitle:"Consumo y eficiencia",icon:"ðŸšœ",component:ee},{id:"movements",title:"Movimientos",subtitle:"Entradas y salidas",icon:"ðŸ“ˆ",component:ae},{id:"financial",title:"Financiero",subtitle:"Costos y ROI",icon:"ðŸ’°",component:se}],g=(a,c)=>{h(n=>({...n,[a]:c}))},t=()=>e.jsxs("div",{className:"dashboard-content",children:[L.length>0&&e.jsx("div",{className:"alerts-container",children:L.slice(0,3).map((a,c)=>e.jsxs("div",{className:`alert ${a.stockLevel==="critical"?"critical":"warning"}`,children:[e.jsx("span",{className:"alert-icon",children:"âš ï¸"}),e.jsxs("div",{className:"alert-content",children:[e.jsxs("div",{className:"alert-title",children:["Stock ",a.stockLevel==="critical"?"CrÃ­tico":"Bajo",": ",a.productName]}),e.jsxs("div",{className:"alert-message",children:[a.location," - ",r(a.currentStock)," ",a.unit,"(",w(a.percentage/100)," de capacidad)"]})]})]},c))}),e.jsxs("div",{className:"kpis-grid",children:[e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon inventory",children:"ðŸ›¢ï¸"}),e.jsx("div",{className:"kpi-value",children:x(p.totalValue)}),e.jsx("div",{className:"kpi-label",children:"Valor Total Inventario"}),e.jsxs("div",{className:"kpi-trend neutral",children:[e.jsx("span",{className:"trend-icon",children:"ðŸ“¦"}),p.totalItems," productos activos"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon vehicles",children:"ðŸšœ"}),e.jsx("div",{className:"kpi-value",children:m.activeVehicles}),e.jsx("div",{className:"kpi-label",children:"VehÃ­culos Activos"}),e.jsxs("div",{className:"kpi-trend positive",children:[e.jsx("span",{className:"trend-icon",children:"â±ï¸"}),r(m.totalHours)," horas trabajadas"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon movements",children:"ðŸ“ˆ"}),e.jsx("div",{className:"kpi-value",children:f.totalMovements}),e.jsx("div",{className:"kpi-label",children:"Movimientos del Mes"}),e.jsxs("div",{className:"kpi-trend positive",children:[e.jsx("span",{className:"trend-icon",children:"âœ…"}),f.completedMovements," completados"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon financial",children:"ðŸ’°"}),e.jsx("div",{className:"kpi-value",children:r(m.averageEfficiency,1)}),e.jsx("div",{className:"kpi-label",children:"Consumo Promedio (L/h)"}),e.jsxs("div",{className:"kpi-trend neutral",children:[e.jsx("span",{className:"trend-icon",children:"ðŸ“Š"}),r(m.totalConsumption)," L total"]})]})]}),P.confidence>0&&e.jsxs("div",{className:"chart-container",children:[e.jsxs("div",{className:"chart-header",children:[e.jsx("h3",{className:"chart-title",children:"ðŸ“ˆ Proyecciones de Consumo (30 dÃ­as)"}),e.jsx("div",{className:"chart-actions",children:e.jsxs("span",{className:"badge info",children:["Confianza: ",r(P.confidence),"%"]})})]}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"projections-grid",children:Object.entries(P.projectedConsumption).map(([a,c])=>e.jsxs("div",{className:"projection-item",children:[e.jsx("h4",{children:a.toUpperCase()}),e.jsxs("div",{className:"projection-value",children:[r(c.projectedTotal)," L"]}),e.jsxs("div",{className:"projection-daily",children:[r(c.dailyAverage)," L/dÃ­a promedio"]})]},a))})})]}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"ðŸ›¢ï¸ Stock Actual por Tipo de Combustible"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"stock-grid",children:Object.entries(p.stockByType).map(([a,c])=>e.jsxs("div",{className:"stock-item",children:[e.jsx("h4",{children:a.toUpperCase()}),e.jsxs("div",{className:"stock-value",children:[r(c)," L"]}),e.jsx("div",{className:"stock-status",children:c>1e3?e.jsx("span",{className:"badge success",children:"Stock Bueno"}):c>500?e.jsx("span",{className:"badge warning",children:"Stock Bajo"}):e.jsx("span",{className:"badge danger",children:"Stock CrÃ­tico"})})]},a))})})]})]}),s=()=>{const a=d.find(c=>c.id===b);if(b==="dashboard")return t();if(a?.component){const c=a.component;return e.jsx(c,{inventory:N,movements:C,vehicles:u,suppliers:M,dateRange:y,onDateRangeChange:g})}return e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸš§"}),e.jsx("h3",{className:"empty-title",children:"Reporte en Desarrollo"}),e.jsx("p",{className:"empty-message",children:"Este reporte estarÃ¡ disponible prÃ³ximamente."})]})};return e.jsxs("div",{className:"reports-main",children:[e.jsxs("div",{className:"reports-header",children:[e.jsxs("div",{className:"reports-title",children:[e.jsx("span",{className:"title-icon",children:"ðŸ“‹"}),e.jsx("h1",{children:"Reportes y AnÃ¡lisis"})]}),e.jsx("p",{className:"reports-subtitle",children:"Dashboard ejecutivo con anÃ¡lisis en tiempo real del sistema de combustibles"})]}),e.jsx("div",{className:"reports-filters",children:e.jsxs("div",{className:"filters-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Fecha Inicio"}),e.jsx("input",{type:"date",className:"filter-input",value:y.start,onChange:a=>g("start",a.target.value)})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Fecha Fin"}),e.jsx("input",{type:"date",className:"filter-input",value:y.end,onChange:a=>g("end",a.target.value)})]}),e.jsxs("div",{className:"filter-actions",children:[e.jsx("button",{className:"filter-btn secondary",onClick:()=>{const a=new Date,c=new Date(a.getFullYear(),a.getMonth()-1,a.getDate());h({start:c.toISOString().slice(0,10),end:a.toISOString().slice(0,10)})},children:"ðŸ“… Ãšltimo Mes"}),e.jsx("button",{className:"filter-btn primary",onClick:()=>window.location.reload(),children:"ðŸ”„ Actualizar"})]})]})}),e.jsx("div",{className:"reports-navigation",children:d.map(a=>e.jsxs("button",{className:`nav-tab ${b===a.id?"active":""}`,onClick:()=>A(a.id),children:[e.jsx("span",{className:"nav-tab-icon",children:a.icon}),e.jsxs("div",{className:"nav-tab-text",children:[e.jsx("span",{className:"nav-tab-title",children:a.title}),e.jsx("span",{className:"nav-tab-subtitle",children:a.subtitle})]})]},a.id))}),s()]})};export{ie as default};
