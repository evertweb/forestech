import{r as d,ac as H,ad as $,ae as Q,af as U,F as I,j as e,a as j,a4 as w,f as l,ag as B,ah as K,ai as W,aj as z,ak as O,al as _,k as A,am as Y,an as q,u as X}from"./index-CSyJsO2R.js";const J=({inventory:v,movements:f,dateRange:M})=>{const[x,E]=d.useState("all"),[k,L]=d.useState("stock_level"),y=d.useMemo(()=>x==="all"?v:v.filter(i=>i.location===x),[v,x]),R=d.useMemo(()=>[...new Set(v.map(m=>m.location))].filter(Boolean),[v]),r=d.useMemo(()=>H(y),[y]),N=d.useMemo(()=>$(y),[y]),p=d.useMemo(()=>Q(y),[y]),u=d.useMemo(()=>U(f),[f]),P=d.useMemo(()=>y.map(m=>{const g=I[m.fuelType]||{},s=parseFloat(m.currentStock)||0,a=parseFloat(m.maxCapacity)||0,c=a>0?s/a*100:0,t=s*(parseFloat(m.pricePerUnit)||0);return{...m,fuelInfo:g,percentage:c,value:t,stockLevel:c<15?"critical":c<30?"low":"good"}}).sort((m,g)=>{switch(k){case"stock_level":return m.percentage-g.percentage;case"value":return g.value-m.value;case"name":return m.productName.localeCompare(g.productName);case"location":return m.location.localeCompare(g.location);default:return 0}}),[y,k]),b=()=>{const i=["Producto","Ubicación","Stock Actual","Capacidad","% Capacidad","Valor","Estado"],m=P.map(t=>[t.productName,t.location,l(t.currentStock),l(t.maxCapacity),w(t.percentage/100),j(t.value),t.stockLevel==="critical"?"Crítico":t.stockLevel==="low"?"Bajo":"Bueno"]),g=[i,...m].map(t=>t.join(",")).join(`
`),s=new Blob([g],{type:"text/csv"}),a=URL.createObjectURL(s),c=document.createElement("a");c.href=a,c.download=`inventario_${new Date().toISOString().slice(0,10)}.csv`,c.click(),URL.revokeObjectURL(a)};return e.jsxs("div",{className:"inventory-reports",children:[e.jsxs("div",{className:"kpis-grid",children:[e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon inventory",children:"💰"}),e.jsx("div",{className:"kpi-value",children:j(r.totalValue)}),e.jsx("div",{className:"kpi-label",children:"Valor Total"}),e.jsxs("div",{className:"kpi-trend neutral",children:[e.jsx("span",{className:"trend-icon",children:"📦"}),r.totalItems," productos"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon inventory",children:"📊"}),e.jsx("div",{className:"kpi-value",children:w(r.averageStockLevel/100)}),e.jsx("div",{className:"kpi-label",children:"Nivel Promedio"}),e.jsxs("div",{className:`kpi-trend ${r.averageStockLevel>60?"positive":r.averageStockLevel>30?"neutral":"negative"}`,children:[e.jsx("span",{className:"trend-icon",children:r.averageStockLevel>60?"📈":r.averageStockLevel>30?"➡️":"📉"}),r.activeItems," activos"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon inventory",children:"⚠️"}),e.jsx("div",{className:"kpi-value",children:r.lowStockItems}),e.jsx("div",{className:"kpi-label",children:"Alertas de Stock"}),e.jsxs("div",{className:`kpi-trend ${r.criticalItems>0?"negative":"neutral"}`,children:[e.jsx("span",{className:"trend-icon",children:"🚨"}),r.criticalItems," críticos"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon inventory",children:"🎯"}),e.jsxs("div",{className:"kpi-value",children:[l(u.confidence),"%"]}),e.jsx("div",{className:"kpi-label",children:"Precisión Proyección"}),e.jsxs("div",{className:"kpi-trend positive",children:[e.jsx("span",{className:"trend-icon",children:"📊"}),u.dataPoints," datos"]})]})]}),e.jsx("div",{className:"reports-filters",children:e.jsxs("div",{className:"filters-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Ubicación"}),e.jsxs("select",{className:"filter-select",value:x,onChange:i=>E(i.target.value),children:[e.jsx("option",{value:"all",children:"Todas las ubicaciones"}),R.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Ordenar por"}),e.jsxs("select",{className:"filter-select",value:k,onChange:i=>L(i.target.value),children:[e.jsx("option",{value:"stock_level",children:"Nivel de Stock"}),e.jsx("option",{value:"value",children:"Valor"}),e.jsx("option",{value:"name",children:"Nombre"}),e.jsx("option",{value:"location",children:"Ubicación"})]})]}),e.jsx("div",{className:"filter-actions",children:e.jsx("button",{className:"filter-btn secondary",onClick:b,children:"📊 Exportar CSV"})})]})}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"🛢️ Stock por Tipo de Combustible"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"stock-grid",children:Object.entries(p).map(([i,m])=>{const g=I[i]||{};return e.jsxs("div",{className:"stock-item",children:[e.jsxs("div",{className:"stock-header",children:[e.jsx("span",{className:"stock-icon",children:g.icon||"⛽"}),e.jsx("h4",{children:g.name||i.toUpperCase()})]}),e.jsxs("div",{className:"stock-value",children:[l(m)," ",g.unit||"L"]}),e.jsx("div",{className:"stock-status",children:m>1e3?e.jsx("span",{className:"badge success",children:"Stock Bueno"}):m>500?e.jsx("span",{className:"badge warning",children:"Stock Bajo"}):e.jsx("span",{className:"badge danger",children:"Stock Crítico"})})]},i)})})})]}),N.length>0&&e.jsxs("div",{className:"chart-container",children:[e.jsxs("div",{className:"chart-header",children:[e.jsx("h3",{className:"chart-title",children:"⚠️ Alertas de Stock Bajo"}),e.jsx("div",{className:"chart-actions",children:e.jsxs("span",{className:"badge danger",children:[N.length," alertas"]})})]}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"alerts-list",children:N.map((i,m)=>e.jsxs("div",{className:`alert ${i.stockLevel==="critical"?"critical":"warning"}`,children:[e.jsx("span",{className:"alert-icon",children:i.stockLevel==="critical"?"🚨":"⚠️"}),e.jsxs("div",{className:"alert-content",children:[e.jsxs("div",{className:"alert-title",children:[i.productName," - ",i.location]}),e.jsxs("div",{className:"alert-message",children:["Stock: ",l(i.currentStock)," ",i.unit,"(",w(i.percentage/100)," de capacidad máxima)"]})]})]},m))})})]}),Object.keys(u.recommendedPurchases).length>0&&e.jsxs("div",{className:"chart-container",children:[e.jsxs("div",{className:"chart-header",children:[e.jsx("h3",{className:"chart-title",children:"📈 Proyecciones de Compra (30 días)"}),e.jsx("div",{className:"chart-actions",children:e.jsxs("span",{className:"badge info",children:["Confianza: ",l(u.confidence),"%"]})})]}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"projections-grid",children:Object.entries(u.recommendedPurchases).map(([i,m])=>{const g=I[i]||{},s=u.projectedConsumption[i];return e.jsxs("div",{className:"projection-item",children:[e.jsxs("div",{className:"projection-header",children:[e.jsx("span",{children:g.icon||"⛽"}),e.jsx("h4",{children:g.name||i.toUpperCase()})]}),e.jsxs("div",{className:"projection-value",children:[l(m)," ",g.unit||"L"]}),e.jsxs("div",{className:"projection-details",children:[e.jsxs("small",{children:["Consumo proyectado: ",l(s?.projectedTotal)," ",g.unit||"L"]}),e.jsxs("small",{children:["Promedio diario: ",l(s?.dailyAverage)," ",g.unit||"L"]})]})]},i)})})})]}),e.jsxs("div",{className:"report-table-container",children:[e.jsx("div",{className:"report-table-header",children:e.jsx("h3",{className:"report-table-title",children:"📋 Inventario Detallado"})}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{className:"report-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Ubicación"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Stock Actual"}),e.jsx("th",{children:"Capacidad"}),e.jsx("th",{children:"% Capacidad"}),e.jsx("th",{children:"Precio/Unidad"}),e.jsx("th",{children:"Valor Total"}),e.jsx("th",{children:"Estado"})]})}),e.jsx("tbody",{children:P.map((i,m)=>e.jsxs("tr",{children:[e.jsx("td",{children:i.productName}),e.jsx("td",{children:i.location}),e.jsxs("td",{children:[e.jsx("span",{style:{marginRight:"0.5rem"},children:i.fuelInfo.icon||"⛽"}),i.fuelInfo.name||i.fuelType]}),e.jsxs("td",{children:[l(i.currentStock)," ",i.unit]}),e.jsxs("td",{children:[l(i.maxCapacity)," ",i.unit]}),e.jsx("td",{children:e.jsx("span",{className:`text-${i.stockLevel==="critical"?"danger":i.stockLevel==="low"?"warning":"success"}`,children:w(i.percentage/100)})}),e.jsx("td",{children:j(i.pricePerUnit)}),e.jsx("td",{children:j(i.value)}),e.jsx("td",{children:e.jsx("span",{className:`badge ${i.stockLevel==="critical"?"danger":i.stockLevel==="low"?"warning":"success"}`,children:i.stockLevel==="critical"?"Crítico":i.stockLevel==="low"?"Bajo":"Bueno"})})]},m))})]})})]})]})},T={HARVESTING:"harvesting",TRANSPORT:"transport",MAINTENANCE:"maintenance",SUPPORT:"support"},S={CHAINSAW:"chainsaw",HARVESTER:"harvester",FORWARDER:"forwarder",SKIDDER:"skidder",LOG_TRUCK:"log_truck",PICKUP_TRUCK:"pickup_truck",CAR:"car",MOTORCYCLE:"motorcycle",ATV:"atv",BULLDOZER:"bulldozer",EXCAVATOR:"excavator",GRADER:"grader",LOADER:"loader",WATER_PUMP:"water_pump",FIRE_PUMP:"fire_pump",GENERATOR:"generator",COMPRESSOR:"compressor"},Z={[S.CHAINSAW]:{name:"Motosierra",category:T.HARVESTING,fuelType:"two_stroke",avgConsumption:2.5,icon:"🪚",color:"#dc2626",description:"Herramienta para corte de árboles"},[S.HARVESTER]:{name:"Cosechadora Forestal",category:T.HARVESTING,fuelType:"diesel",avgConsumption:25,icon:"🚜",color:"#059669",description:"Máquina para corte y procesamiento de árboles"},[S.FORWARDER]:{name:"Forwarder",category:T.HARVESTING,fuelType:"diesel",avgConsumption:20,icon:"🚚",color:"#0891b2",description:"Transporte de troncos dentro del bosque"},[S.LOG_TRUCK]:{name:"Camión Maderero",category:T.TRANSPORT,fuelType:"acpm",avgConsumption:3.5,icon:"🚚",color:"#ea580c",description:"Transporte de madera a destino"},[S.PICKUP_TRUCK]:{name:"Camioneta",category:T.TRANSPORT,fuelType:"gasoline",avgConsumption:8,icon:"🚐",color:"#2563eb",description:"Transporte de personal y herramientas"},[S.CAR]:{name:"Automóvil",category:T.TRANSPORT,fuelType:"gasoline",avgConsumption:12,icon:"🚗",color:"#3b82f6",description:"Vehículo liviano para transporte ejecutivo"},[S.MOTORCYCLE]:{name:"Motocicleta",category:T.TRANSPORT,fuelType:"gasoline",avgConsumption:25,icon:"🏍️",color:"#6366f1",description:"Transporte ágil para terrenos difíciles"},[S.ATV]:{name:"Cuatrimoto",category:T.TRANSPORT,fuelType:"gasoline",avgConsumption:15,icon:"🏍️",color:"#84cc16",description:"Vehículo todo terreno para supervisión"},[S.SKIDDER]:{name:"Skidder",category:T.HARVESTING,fuelType:"diesel",avgConsumption:22,icon:"🚜",color:"#f59e0b",description:"Arrastre de troncos desde el lugar de corte"},[S.BULLDOZER]:{name:"Bulldozer",category:T.MAINTENANCE,fuelType:"diesel",avgConsumption:30,icon:"🚜",color:"#f97316",description:"Construcción y mantenimiento de caminos"},[S.EXCAVATOR]:{name:"Excavadora",category:T.MAINTENANCE,fuelType:"diesel",avgConsumption:28,icon:"🏗️",color:"#eab308",description:"Excavación y movimiento de tierra"},[S.GRADER]:{name:"Motoniveladora",category:T.MAINTENANCE,fuelType:"diesel",avgConsumption:25,icon:"🚜",color:"#a3a3a3",description:"Nivelación y mantenimiento de vías"},[S.LOADER]:{name:"Cargador Frontal",category:T.MAINTENANCE,fuelType:"diesel",avgConsumption:24,icon:"🚜",color:"#71717a",description:"Carga y descarga de materiales"},[S.WATER_PUMP]:{name:"Motobomba de Agua",category:T.SUPPORT,fuelType:"gasoline",avgConsumption:3.5,icon:"💧",color:"#0891b2",description:"Bombeo de agua para operaciones"},[S.FIRE_PUMP]:{name:"Motobomba Contra Incendios",category:T.SUPPORT,fuelType:"gasoline",avgConsumption:4.2,icon:"🔥",color:"#dc2626",description:"Equipo de emergencia contra incendios"},[S.GENERATOR]:{name:"Generador Eléctrico",category:T.SUPPORT,fuelType:"gasoline",avgConsumption:2.8,icon:"⚡",color:"#7c3aed",description:"Suministro de energía eléctrica"},[S.COMPRESSOR]:{name:"Compresor de Aire",category:T.SUPPORT,fuelType:"gasoline",avgConsumption:2.5,icon:"💨",color:"#64748b",description:"Suministro de aire comprimido"}},ee=({vehicles:v,movements:f,dateRange:M})=>{const[x,E]=d.useState("all"),[k,L]=d.useState("all"),[y,R]=d.useState("efficiency"),r=d.useMemo(()=>{let s=v.filter(a=>a.status==="activo");return x!=="all"&&(s=s.filter(a=>a.category===x)),k!=="all"&&(s=s.filter(a=>a.fuelType===k)),s},[v,x,k]),N=d.useMemo(()=>!M.start&&!M.end?f:f.filter(s=>{const a=new Date(s.createdAt||s.date),c=M.start?new Date(M.start):new Date(0),t=M.end?new Date(M.end):new Date;return a>=c&&a<=t}),[f,M]),p=d.useMemo(()=>[...new Set(v.map(s=>s.category).filter(Boolean))],[v]),u=d.useMemo(()=>[...new Set(v.map(s=>s.fuelType).filter(Boolean))],[v]),P=d.useMemo(()=>B(r,N),[r,N]),b=d.useMemo(()=>r.map(a=>{const c=K(a,N),t=W(a,N),o=z(a,N),h=Z[a.type]||{},n=a.fuelType==="diesel"||a.fuelType==="Diesel",C=parseFloat(a.currentHours)||0,D=parseFloat(a.totalHoursWorked)||0,F=D>0?c.totalConsumption/D:0,V=h.avgConsumption||0,G=V>0&&F>0?(V-F)/V*100:0;return{...a,vehicleInfo:h,consumption:c,efficiency:t,costs:o,hasHourMeter:n,currentHours:C,totalHoursWorked:D,actualConsumptionPerHour:F,estimatedConsumption:V,efficiencyRating:G,nextMaintenanceHours:n?Math.ceil(C/250)*250:null,hoursToMaintenance:n?Math.ceil(C/250)*250-C:null}}).sort((a,c)=>{switch(y){case"efficiency":return c.efficiencyRating-a.efficiencyRating;case"consumption":return c.consumption.totalConsumption-a.consumption.totalConsumption;case"cost":return c.costs.totalCost-a.costs.totalCost;case"hours":return c.currentHours-a.currentHours;case"name":return a.name.localeCompare(c.name);default:return 0}}),[r,N,y]),i=d.useMemo(()=>{const s=[...b].sort((a,c)=>c.efficiencyRating-a.efficiencyRating);return{mostEfficient:s[0],leastEfficient:s[s.length-1],highestConsumption:[...b].sort((a,c)=>c.consumption.totalConsumption-a.consumption.totalConsumption)[0],nearMaintenance:b.filter(a=>a.hasHourMeter&&a.hoursToMaintenance<=50)}},[b]),m=d.useMemo(()=>{const s={};return u.forEach(a=>{const c=b.filter(n=>n.fuelType===a),t=c.reduce((n,C)=>n+C.consumption.totalConsumption,0),o=c.reduce((n,C)=>n+C.costs.totalCost,0),h=c.length>0?c.reduce((n,C)=>n+C.efficiencyRating,0)/c.length:0;s[a]={vehicleCount:c.length,totalConsumption:t,totalCost:o,avgEfficiency:h,avgConsumptionPerVehicle:c.length>0?t/c.length:0}}),s},[b,u]),g=()=>{const s=["Vehículo","Tipo","Combustible","Horas Actuales","Consumo Total (L)","Consumo/Hora","Eficiencia (%)","Costo Total","Próximo Mantenimiento"],a=b.map(n=>[n.vehicleId,n.type,n.fuelType,n.hasHourMeter?l(n.currentHours):"N/A",l(n.consumption.totalConsumption),l(n.actualConsumptionPerHour,2),l(n.efficiencyRating,1)+"%",j(n.costs.totalCost),n.hasHourMeter?`${n.nextMaintenanceHours}h`:"N/A"]),c=[s,...a].map(n=>n.join(",")).join(`
`),t=new Blob([c],{type:"text/csv"}),o=URL.createObjectURL(t),h=document.createElement("a");h.href=o,h.download=`vehiculos_${new Date().toISOString().slice(0,10)}.csv`,h.click(),URL.revokeObjectURL(o)};return e.jsxs("div",{className:"vehicle-reports",children:[e.jsxs("div",{className:"kpis-grid",children:[e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon vehicles",children:"🚜"}),e.jsx("div",{className:"kpi-value",children:P.activeVehicles}),e.jsx("div",{className:"kpi-label",children:"Vehículos Activos"}),e.jsxs("div",{className:"kpi-trend positive",children:[e.jsx("span",{className:"trend-icon",children:"📊"}),l(P.totalHours)," horas total"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon vehicles",children:"⛽"}),e.jsx("div",{className:"kpi-value",children:l(P.totalConsumption)}),e.jsx("div",{className:"kpi-label",children:"Consumo Total (L)"}),e.jsxs("div",{className:"kpi-trend neutral",children:[e.jsx("span",{className:"trend-icon",children:"📈"}),l(P.averageEfficiency,1)," L/h promedio"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon vehicles",children:"⚡"}),e.jsxs("div",{className:"kpi-value",children:[l(i.mostEfficient?.efficiencyRating||0,1),"%"]}),e.jsx("div",{className:"kpi-label",children:"Mejor Eficiencia"}),e.jsxs("div",{className:"kpi-trend positive",children:[e.jsx("span",{className:"trend-icon",children:"🏆"}),i.mostEfficient?.vehicleId||"N/A"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon vehicles",children:"🔧"}),e.jsx("div",{className:"kpi-value",children:i.nearMaintenance.length}),e.jsx("div",{className:"kpi-label",children:"Próximo Mantenimiento"}),e.jsxs("div",{className:`kpi-trend ${i.nearMaintenance.length>0?"negative":"positive"}`,children:[e.jsx("span",{className:"trend-icon",children:"⚠️"}),"≤ 50 horas"]})]})]}),e.jsx("div",{className:"reports-filters",children:e.jsxs("div",{className:"filters-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Categoría"}),e.jsxs("select",{className:"filter-select",value:x,onChange:s=>E(s.target.value),children:[e.jsx("option",{value:"all",children:"Todas las categorías"}),p.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Tipo de Combustible"}),e.jsxs("select",{className:"filter-select",value:k,onChange:s=>L(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos los combustibles"}),u.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Ordenar por"}),e.jsxs("select",{className:"filter-select",value:y,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:"efficiency",children:"Eficiencia"}),e.jsx("option",{value:"consumption",children:"Consumo"}),e.jsx("option",{value:"cost",children:"Costo"}),e.jsx("option",{value:"hours",children:"Horas"}),e.jsx("option",{value:"name",children:"Nombre"})]})]}),e.jsx("div",{className:"filter-actions",children:e.jsx("button",{className:"filter-btn secondary",onClick:g,children:"📊 Exportar CSV"})})]})}),i.nearMaintenance.length>0&&e.jsx("div",{className:"alerts-container",children:i.nearMaintenance.map((s,a)=>e.jsxs("div",{className:"alert warning",children:[e.jsx("span",{className:"alert-icon",children:"🔧"}),e.jsxs("div",{className:"alert-content",children:[e.jsxs("div",{className:"alert-title",children:["Mantenimiento Próximo: ",s.vehicleId]}),e.jsxs("div",{className:"alert-message",children:["Horas actuales: ",l(s.currentHours),"h | Próximo mantenimiento: ",s.nextMaintenanceHours,"h | Faltan: ",l(s.hoursToMaintenance),"h"]})]})]},a))}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"⛽ Análisis por Tipo de Combustible"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"fuel-analysis-grid",children:Object.entries(m).map(([s,a])=>e.jsxs("div",{className:"fuel-analysis-item",children:[e.jsx("h4",{children:s.toUpperCase()}),e.jsxs("div",{className:"analysis-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Vehículos:"}),e.jsx("span",{className:"metric-value",children:a.vehicleCount})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Consumo Total:"}),e.jsxs("span",{className:"metric-value",children:[l(a.totalConsumption)," L"]})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Costo Total:"}),e.jsx("span",{className:"metric-value",children:j(a.totalCost)})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Eficiencia Promedio:"}),e.jsxs("span",{className:`metric-value ${a.avgEfficiency>10?"text-success":a.avgEfficiency>0?"text-warning":"text-danger"}`,children:[l(a.avgEfficiency,1),"%"]})]})]})]},s))})})]}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"🏆 Análisis de Rendimiento"})}),e.jsx("div",{className:"chart-content",children:e.jsxs("div",{className:"performers-grid",children:[e.jsxs("div",{className:"performer-item success",children:[e.jsx("h4",{children:"🥇 Más Eficiente"}),e.jsx("div",{className:"performer-name",children:i.mostEfficient?.vehicleId||"N/A"}),e.jsxs("div",{className:"performer-metric",children:[l(i.mostEfficient?.efficiencyRating||0,1),"% eficiencia"]}),e.jsxs("div",{className:"performer-details",children:[l(i.mostEfficient?.actualConsumptionPerHour||0,2)," L/h"]})]}),e.jsxs("div",{className:"performer-item warning",children:[e.jsx("h4",{children:"⚠️ Mayor Consumo"}),e.jsx("div",{className:"performer-name",children:i.highestConsumption?.vehicleId||"N/A"}),e.jsxs("div",{className:"performer-metric",children:[l(i.highestConsumption?.consumption.totalConsumption||0)," L total"]}),e.jsxs("div",{className:"performer-details",children:[l(i.highestConsumption?.actualConsumptionPerHour||0,2)," L/h"]})]}),e.jsxs("div",{className:"performer-item danger",children:[e.jsx("h4",{children:"📉 Menos Eficiente"}),e.jsx("div",{className:"performer-name",children:i.leastEfficient?.vehicleId||"N/A"}),e.jsxs("div",{className:"performer-metric",children:[l(i.leastEfficient?.efficiencyRating||0,1),"% eficiencia"]}),e.jsxs("div",{className:"performer-details",children:[l(i.leastEfficient?.actualConsumptionPerHour||0,2)," L/h"]})]})]})})]}),e.jsxs("div",{className:"report-table-container",children:[e.jsx("div",{className:"report-table-header",children:e.jsx("h3",{className:"report-table-title",children:"🚜 Análisis Detallado de Vehículos"})}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{className:"report-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Vehículo"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Combustible"}),e.jsx("th",{children:"Horas Actuales"}),e.jsx("th",{children:"Horas Trabajadas"}),e.jsx("th",{children:"Consumo Total"}),e.jsx("th",{children:"L/Hora Real"}),e.jsx("th",{children:"L/Hora Estimado"}),e.jsx("th",{children:"Eficiencia"}),e.jsx("th",{children:"Costo Total"}),e.jsx("th",{children:"Próximo Mantenimiento"})]})}),e.jsx("tbody",{children:b.map((s,a)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("strong",{children:s.vehicleId}),e.jsx("br",{}),e.jsx("small",{children:s.name})]}),e.jsx("td",{children:s.type}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.fuelType==="diesel"?"info":"secondary"}`,children:s.fuelType})}),e.jsx("td",{children:s.hasHourMeter?e.jsxs("span",{children:[l(s.currentHours),"h"]}):e.jsx("span",{className:"text-muted",children:"N/A"})}),e.jsxs("td",{children:[l(s.totalHoursWorked),"h"]}),e.jsxs("td",{children:[l(s.consumption.totalConsumption)," L"]}),e.jsx("td",{children:l(s.actualConsumptionPerHour,2)}),e.jsx("td",{children:l(s.estimatedConsumption,2)}),e.jsx("td",{children:e.jsxs("span",{className:`badge ${s.efficiencyRating>10?"success":s.efficiencyRating>0?"warning":"danger"}`,children:[l(s.efficiencyRating,1),"%"]})}),e.jsx("td",{children:j(s.costs.totalCost)}),e.jsx("td",{children:s.hasHourMeter?e.jsxs("span",{className:s.hoursToMaintenance<=50?"text-warning":"text-success",children:[s.nextMaintenanceHours,"h",e.jsx("br",{}),e.jsxs("small",{children:["(",l(s.hoursToMaintenance),"h restantes)"]})]}):e.jsx("span",{className:"text-muted",children:"N/A"})})]},a))})]})})]})]})},se=({movements:v,vehicles:f,suppliers:M,dateRange:x,inventory:E})=>{const[k,L]=d.useState("month"),[y,R]=d.useState("previous"),r=d.useMemo(()=>!x.start&&!x.end?v:v.filter(s=>{const a=new Date(s.createdAt||s.date),c=x.start?new Date(x.start):new Date(0),t=x.end?new Date(x.end):new Date;return a>=c&&a<=t}),[v,x]),N=d.useMemo(()=>{if(!x.start||!x.end)return null;const s=new Date(x.start),a=new Date(x.end),c=Math.ceil((a-s)/(1e3*60*60*24)),t=new Date(s);t.setDate(t.getDate()-c);const o=new Date(s);return{movements:v.filter(n=>{const C=new Date(n.createdAt||n.date);return C>=t&&C<o}),period:`${t.toLocaleDateString()} - ${o.toLocaleDateString()}`}},[v,x]),p=d.useMemo(()=>{const s=O(r),a=_(r,x),c=r.filter(n=>n.type===A.ENTRADA),t=r.filter(n=>n.type===A.SALIDA),o=c.reduce((n,C)=>n+(parseFloat(C.quantity)||0)*(parseFloat(C.unitPrice)||0),0),h=t.reduce((n,C)=>n+(parseFloat(C.quantity)||0)*(parseFloat(C.unitPrice)||0),0);return{...s,...a,entradasValue:o,salidasValue:h,netFlow:o-h,turnoverRatio:o>0?h/o:0}},[r,x]),u=d.useMemo(()=>{if(!N)return null;const s=O(r),a=O(N.movements);return{costChange:s.totalCost-a.totalCost,costChangePercent:a.totalCost>0?(s.totalCost-a.totalCost)/a.totalCost*100:0,movementChange:r.length-N.movements.length,movementChangePercent:N.movements.length>0?(r.length-N.movements.length)/N.movements.length*100:0}},[r,N]),P=d.useMemo(()=>[...new Set(r.flatMap(a=>[a.location,a.sourceLocation,a.destinationLocation].filter(Boolean)))].map(a=>{const c=Y(r,a),t=r.filter(o=>o.location===a||o.sourceLocation===a||o.destinationLocation===a);return{location:a,...c,movementsPercentage:r.length>0?t.length/r.length*100:0}}).sort((a,c)=>c.totalCost-a.totalCost),[r]),b=d.useMemo(()=>{const s=r.filter(c=>c.type===A.ENTRADA&&c.supplierName),a={};return s.forEach(c=>{const t=c.supplierName,o=parseFloat(c.quantity)||0,h=o*(parseFloat(c.unitPrice)||0);a[t]||(a[t]={name:t,movementsCount:0,totalQuantity:0,totalValue:0,avgPrice:0,fuelTypes:new Set}),a[t].movementsCount++,a[t].totalQuantity+=o,a[t].totalValue+=h,a[t].fuelTypes.add(c.fuelType)}),Object.values(a).forEach(c=>{c.avgPrice=c.totalQuantity>0?c.totalValue/c.totalQuantity:0,c.fuelTypes=Array.from(c.fuelTypes)}),Object.values(a).sort((c,t)=>t.totalValue-c.totalValue)},[r]),i=d.useMemo(()=>{const s=U(v),a={};E.forEach(o=>{o.pricePerUnit&&(a[o.fuelType]=parseFloat(o.pricePerUnit))});const c={};Object.entries(s.recommendedPurchases).forEach(([o,h])=>{const n=a[o]||0;c[o]=h*n});const t=Object.values(c).reduce((o,h)=>o+h,0);return{...s,projectedCosts:c,totalProjectedCost:t,currentPrices:a}},[v,E]),m=d.useMemo(()=>{const s={};return r.forEach(a=>{let c=a.type;if(a.vehicleId){const o=f.find(h=>h.vehicleId===a.vehicleId);o&&(c=`${a.type}_${o.category||o.type}`)}const t=(parseFloat(a.quantity)||0)*(parseFloat(a.unitPrice)||0);s[c]||(s[c]=0),s[c]+=t}),Object.entries(s).map(([a,c])=>({category:a,cost:c})).sort((a,c)=>c.cost-a.cost).slice(0,10)},[r,f]),g=()=>{const s={period:`${x.start} a ${x.end}`,summary:p,locations:P,suppliers:b,projections:i,comparison:u},a=JSON.stringify(s,null,2),c=new Blob([a],{type:"application/json"}),t=URL.createObjectURL(c),o=document.createElement("a");o.href=t,o.download=`reporte_financiero_${new Date().toISOString().slice(0,10)}.json`,o.click(),URL.revokeObjectURL(t)};return e.jsxs("div",{className:"financial-reports",children:[e.jsxs("div",{className:"kpis-grid",children:[e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon financial",children:"💰"}),e.jsx("div",{className:"kpi-value",children:j(p.totalCost)}),e.jsx("div",{className:"kpi-label",children:"Costo Total"}),e.jsxs("div",{className:`kpi-trend ${u?.costChangePercent>0?"negative":"positive"}`,children:[e.jsx("span",{className:"trend-icon",children:u?.costChangePercent>0?"📈":"📉"}),u?`${l(Math.abs(u.costChangePercent),1)}%`:"N/A"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon financial",children:"📊"}),e.jsx("div",{className:"kpi-value",children:j(p.averageCostPerMovement)}),e.jsx("div",{className:"kpi-label",children:"Costo Promedio"}),e.jsxs("div",{className:"kpi-trend neutral",children:[e.jsx("span",{className:"trend-icon",children:"📋"}),r.length," movimientos"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon financial",children:"🔄"}),e.jsx("div",{className:"kpi-value",children:j(p.netFlow)}),e.jsx("div",{className:"kpi-label",children:"Flujo Neto"}),e.jsxs("div",{className:`kpi-trend ${p.netFlow>0?"negative":"positive"}`,children:[e.jsx("span",{className:"trend-icon",children:p.netFlow>0?"📤":"📥"}),w(p.turnoverRatio)," rotación"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon financial",children:"📈"}),e.jsx("div",{className:"kpi-value",children:j(i.totalProjectedCost)}),e.jsx("div",{className:"kpi-label",children:"Proyección 30 días"}),e.jsxs("div",{className:"kpi-trend info",children:[e.jsx("span",{className:"trend-icon",children:"🎯"}),l(i.confidence),"% confianza"]})]})]}),e.jsx("div",{className:"reports-filters",children:e.jsxs("div",{className:"filters-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Período de Análisis"}),e.jsxs("select",{className:"filter-select",value:k,onChange:s=>L(s.target.value),children:[e.jsx("option",{value:"week",children:"Semanal"}),e.jsx("option",{value:"month",children:"Mensual"}),e.jsx("option",{value:"quarter",children:"Trimestral"}),e.jsx("option",{value:"year",children:"Anual"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Comparar con"}),e.jsxs("select",{className:"filter-select",value:y,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:"previous",children:"Período anterior"}),e.jsx("option",{value:"year_ago",children:"Mismo período año anterior"})]})]}),e.jsx("div",{className:"filter-actions",children:e.jsx("button",{className:"filter-btn secondary",onClick:g,children:"📊 Exportar Reporte"})})]})}),u&&e.jsxs("div",{className:"chart-container",children:[e.jsxs("div",{className:"chart-header",children:[e.jsx("h3",{className:"chart-title",children:"📊 Comparación con Período Anterior"}),e.jsx("div",{className:"chart-actions",children:e.jsxs("span",{className:"badge info",children:["vs ",N.period]})})]}),e.jsx("div",{className:"chart-content",children:e.jsxs("div",{className:"comparison-grid",children:[e.jsxs("div",{className:"comparison-item",children:[e.jsx("h4",{children:"💰 Cambio en Costos"}),e.jsxs("div",{className:`comparison-value ${u.costChangePercent>0?"negative":"positive"}`,children:[j(u.costChange),e.jsxs("span",{className:"comparison-percent",children:["(",u.costChangePercent>0?"+":"",l(u.costChangePercent,1),"%)"]})]})]}),e.jsxs("div",{className:"comparison-item",children:[e.jsx("h4",{children:"📈 Cambio en Movimientos"}),e.jsxs("div",{className:`comparison-value ${u.movementChangePercent>0?"positive":"negative"}`,children:[u.movementChange>0?"+":"",u.movementChange,e.jsxs("span",{className:"comparison-percent",children:["(",u.movementChangePercent>0?"+":"",l(u.movementChangePercent,1),"%)"]})]})]})]})})]}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"📍 Costos por Ubicación"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"location-analysis-grid",children:P.slice(0,6).map(s=>e.jsxs("div",{className:"location-item",children:[e.jsx("h4",{children:s.location}),e.jsxs("div",{className:"location-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Costo Total:"}),e.jsx("span",{className:"metric-value",children:j(s.totalCost)})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Movimientos:"}),e.jsx("span",{className:"metric-value",children:s.movementsCount})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Participación:"}),e.jsxs("span",{className:"metric-value",children:[l(s.movementsPercentage,1),"%"]})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Promedio:"}),e.jsx("span",{className:"metric-value",children:j(s.averageCostPerMovement)})]})]})]},s.location))})})]}),b.length>0&&e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"🏪 Análisis de Proveedores"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"suppliers-analysis",children:b.slice(0,5).map(s=>e.jsxs("div",{className:"supplier-item",children:[e.jsx("h4",{children:s.name}),e.jsxs("div",{className:"supplier-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Valor Total:"}),e.jsx("span",{className:"metric-value",children:j(s.totalValue)})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Cantidad:"}),e.jsxs("span",{className:"metric-value",children:[l(s.totalQuantity)," L"]})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Precio Promedio:"}),e.jsx("span",{className:"metric-value",children:j(s.avgPrice)})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Movimientos:"}),e.jsx("span",{className:"metric-value",children:s.movementsCount})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Combustibles:"}),e.jsx("span",{className:"metric-value",children:s.fuelTypes.join(", ")})]})]})]},s.name))})})]}),e.jsxs("div",{className:"chart-container",children:[e.jsxs("div",{className:"chart-header",children:[e.jsx("h3",{className:"chart-title",children:"📈 Proyecciones Financieras (30 días)"}),e.jsx("div",{className:"chart-actions",children:e.jsxs("span",{className:"badge success",children:["Confianza: ",l(i.confidence),"%"]})})]}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"projections-financial",children:Object.entries(i.projectedCosts).map(([s,a])=>{const c=i.recommendedPurchases[s],t=i.currentPrices[s],o=I[s]||{};return e.jsxs("div",{className:"projection-financial-item",children:[e.jsxs("h4",{children:[e.jsx("span",{style:{marginRight:"0.5rem"},children:o.icon||"⛽"}),o.name||s.toUpperCase()]}),e.jsxs("div",{className:"projection-financial-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Cantidad Proyectada:"}),e.jsxs("span",{className:"metric-value",children:[l(c)," ",o.unit||"L"]})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Precio Actual:"}),e.jsx("span",{className:"metric-value",children:j(t)})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Costo Proyectado:"}),e.jsx("span",{className:"metric-value highlight",children:j(a)})]})]})]},s)})})})]}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"💸 Top Costos por Categoría"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"top-costs-list",children:m.map((s,a)=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-rank",children:["#",a+1]}),e.jsxs("div",{className:"cost-info",children:[e.jsx("h4",{children:s.category.replace("_"," - ")}),e.jsxs("div",{className:"cost-percentage",children:[w(s.cost/p.totalCost)," del total"]})]}),e.jsx("div",{className:"cost-value",children:j(s.cost)})]},s.category))})})]}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"📋 Resumen Ejecutivo"})}),e.jsx("div",{className:"chart-content",children:e.jsxs("div",{className:"executive-summary",children:[e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"💰 Flujo de Efectivo"}),e.jsxs("div",{className:"summary-metrics",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Entradas:"}),e.jsx("span",{className:"text-success",children:j(p.entradasValue)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Salidas:"}),e.jsx("span",{className:"text-warning",children:j(p.salidasValue)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Balance:"}),e.jsx("span",{className:p.netFlow>0?"text-danger":"text-success",children:j(Math.abs(p.netFlow))})]})]})]}),e.jsxs("div",{className:"summary-section",children:[e.jsx("h4",{children:"📊 Eficiencia Operacional"}),e.jsxs("div",{className:"summary-metrics",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Rotación de Inventario:"}),e.jsx("span",{children:w(p.turnoverRatio)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Costo por Movimiento:"}),e.jsx("span",{children:j(p.averageCostPerMovement)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{children:"Total Movimientos:"}),e.jsx("span",{children:r.length})]})]})]})]})})]})]})},ae=({movements:v,dateRange:f,vehicles:M})=>{const[x,E]=d.useState("all"),[k,L]=d.useState("all"),[y,R]=d.useState("all"),r=d.useMemo(()=>{let s=v;return(f.start||f.end)&&(s=s.filter(a=>{const c=new Date(a.createdAt||a.date),t=f.start?new Date(f.start):new Date(0),o=f.end?new Date(f.end):new Date;return c>=t&&c<=o})),x!=="all"&&(s=s.filter(a=>a.type===x)),k!=="all"&&(s=s.filter(a=>a.fuelType===k)),y!=="all"&&(s=s.filter(a=>a.location===y||a.sourceLocation===y||a.destinationLocation===y)),s},[v,f,x,k,y]),N=d.useMemo(()=>{const s=[...new Set(v.map(c=>c.fuelType).filter(Boolean))],a=[...new Set(v.flatMap(c=>[c.location,c.sourceLocation,c.destinationLocation].filter(Boolean)))];return{fuelTypes:s,locations:a}},[v]),p=d.useMemo(()=>q(r),[r]),u=d.useMemo(()=>O(r),[r]);d.useMemo(()=>_(r,f),[r,f]);const P=d.useMemo(()=>Object.values(A).map(a=>{const c=r.filter(h=>h.type===a),t=c.reduce((h,n)=>h+(parseFloat(n.quantity)||0),0),o=c.reduce((h,n)=>h+(parseFloat(n.quantity)||0)*(parseFloat(n.unitPrice)||0),0);return{type:a,count:c.length,totalQuantity:t,totalValue:o,percentage:p.totalMovements>0?c.length/p.totalMovements*100:0}}),[r,p.totalMovements]),b=d.useMemo(()=>{const s={};return N.fuelTypes.forEach(a=>{const c=r.filter(n=>n.fuelType===a),t=c.reduce((n,C)=>n+(parseFloat(C.quantity)||0),0),o=c.reduce((n,C)=>n+(parseFloat(C.quantity)||0)*(parseFloat(C.unitPrice)||0),0),h=c.length>0?c.reduce((n,C)=>n+(parseFloat(C.unitPrice)||0),0)/c.length:0;s[a]={count:c.length,totalQuantity:t,totalValue:o,avgPrice:h,fuelInfo:I[a]||{}}}),s},[r,N.fuelTypes]),i=d.useMemo(()=>{const s={};return r.forEach(a=>{const c=new Date(a.createdAt||a.date),t=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`;s[t]||(s[t]={month:t,entradas:0,salidas:0,transferencias:0,ajustes:0,totalQuantity:0,totalValue:0});const o=parseFloat(a.quantity)||0,h=o*(parseFloat(a.unitPrice)||0);s[t][a.type]++,s[t].totalQuantity+=o,s[t].totalValue+=h}),Object.values(s).sort((a,c)=>a.month.localeCompare(c.month))},[r]),m=d.useMemo(()=>{const s={};return r.filter(a=>a.type===A.SALIDA&&a.vehicleId).forEach(a=>{const c=a.vehicleId,t=parseFloat(a.quantity)||0;s[c]||(s[c]={vehicleId:c,totalConsumption:0,movementsCount:0,vehicle:M.find(o=>o.vehicleId===c)}),s[c].totalConsumption+=t,s[c].movementsCount++}),Object.values(s).sort((a,c)=>c.totalConsumption-a.totalConsumption).slice(0,10)},[r,M]),g=()=>{const s=["Fecha","Tipo","Combustible","Cantidad","Precio Unitario","Valor Total","Ubicación Origen","Ubicación Destino","Vehículo","Estado"],a=r.map(n=>[new Date(n.createdAt||n.date).toLocaleDateString(),n.type,n.fuelType,l(n.quantity),j(n.unitPrice),j((parseFloat(n.quantity)||0)*(parseFloat(n.unitPrice)||0)),n.sourceLocation||n.location||"",n.destinationLocation||"",n.vehicleId||"",n.status]),c=[s,...a].map(n=>n.join(",")).join(`
`),t=new Blob([c],{type:"text/csv"}),o=URL.createObjectURL(t),h=document.createElement("a");h.href=o,h.download=`movimientos_${new Date().toISOString().slice(0,10)}.csv`,h.click(),URL.revokeObjectURL(o)};return e.jsxs("div",{className:"movement-reports",children:[e.jsxs("div",{className:"kpis-grid",children:[e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon movements",children:"📈"}),e.jsx("div",{className:"kpi-value",children:p.totalMovements}),e.jsx("div",{className:"kpi-label",children:"Movimientos Totales"}),e.jsxs("div",{className:"kpi-trend positive",children:[e.jsx("span",{className:"trend-icon",children:"✅"}),p.completedMovements," completados"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon movements",children:"🛢️"}),e.jsx("div",{className:"kpi-value",children:l(p.totalQuantity)}),e.jsx("div",{className:"kpi-label",children:"Cantidad Total (L)"}),e.jsxs("div",{className:"kpi-trend neutral",children:[e.jsx("span",{className:"trend-icon",children:"📊"}),"Promedio: ",l(p.totalQuantity/(p.totalMovements||1),1)," L"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon financial",children:"💰"}),e.jsx("div",{className:"kpi-value",children:j(u.totalCost)}),e.jsx("div",{className:"kpi-label",children:"Valor Total"}),e.jsxs("div",{className:"kpi-trend positive",children:[e.jsx("span",{className:"trend-icon",children:"💵"}),j(u.averageCostPerMovement)," promedio"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon movements",children:"⚠️"}),e.jsx("div",{className:"kpi-value",children:p.pendingMovements}),e.jsx("div",{className:"kpi-label",children:"Pendientes"}),e.jsxs("div",{className:`kpi-trend ${p.pendingMovements>0?"negative":"positive"}`,children:[e.jsx("span",{className:"trend-icon",children:p.pendingMovements>0?"⏳":"✅"}),p.cancelledMovements," cancelados"]})]})]}),e.jsx("div",{className:"reports-filters",children:e.jsxs("div",{className:"filters-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Tipo de Movimiento"}),e.jsxs("select",{className:"filter-select",value:x,onChange:s=>E(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos los tipos"}),e.jsx("option",{value:A.ENTRADA,children:"Entradas"}),e.jsx("option",{value:A.SALIDA,children:"Salidas"}),e.jsx("option",{value:A.TRANSFERENCIA,children:"Transferencias"}),e.jsx("option",{value:A.AJUSTE,children:"Ajustes"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Tipo de Combustible"}),e.jsxs("select",{className:"filter-select",value:k,onChange:s=>L(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos los combustibles"}),N.fuelTypes.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Ubicación"}),e.jsxs("select",{className:"filter-select",value:y,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:"all",children:"Todas las ubicaciones"}),N.locations.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsx("div",{className:"filter-actions",children:e.jsx("button",{className:"filter-btn secondary",onClick:g,children:"📊 Exportar CSV"})})]})}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"📊 Movimientos por Tipo"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"movement-types-grid",children:P.map(s=>e.jsxs("div",{className:"movement-type-item",children:[e.jsxs("h4",{children:[s.type===A.ENTRADA&&"📥 Entradas",s.type===A.SALIDA&&"📤 Salidas",s.type===A.TRANSFERENCIA&&"🔄 Transferencias",s.type===A.AJUSTE&&"⚙️ Ajustes"]}),e.jsxs("div",{className:"type-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-value",children:s.count}),e.jsx("span",{className:"metric-label",children:"Movimientos"})]}),e.jsxs("div",{className:"metric",children:[e.jsxs("span",{className:"metric-value",children:[l(s.totalQuantity)," L"]}),e.jsx("span",{className:"metric-label",children:"Cantidad"})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-value",children:j(s.totalValue)}),e.jsx("span",{className:"metric-label",children:"Valor"})]}),e.jsxs("div",{className:"metric",children:[e.jsxs("span",{className:"metric-value",children:[l(s.percentage,1),"%"]}),e.jsx("span",{className:"metric-label",children:"Participación"})]})]})]},s.type))})})]}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"⛽ Análisis por Tipo de Combustible"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"fuel-analysis-grid",children:Object.entries(b).map(([s,a])=>e.jsxs("div",{className:"fuel-analysis-item",children:[e.jsxs("h4",{children:[e.jsx("span",{style:{marginRight:"0.5rem"},children:a.fuelInfo.icon||"⛽"}),a.fuelInfo.name||s.toUpperCase()]}),e.jsxs("div",{className:"analysis-metrics",children:[e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Movimientos:"}),e.jsx("span",{className:"metric-value",children:a.count})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Cantidad:"}),e.jsxs("span",{className:"metric-value",children:[l(a.totalQuantity)," ",a.fuelInfo.unit||"L"]})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Valor:"}),e.jsx("span",{className:"metric-value",children:j(a.totalValue)})]}),e.jsxs("div",{className:"metric",children:[e.jsx("span",{className:"metric-label",children:"Precio Promedio:"}),e.jsx("span",{className:"metric-value",children:j(a.avgPrice)})]})]})]},s))})})]}),m.length>0&&e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"🚜 Top Vehículos por Consumo"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"top-vehicles-list",children:m.slice(0,5).map((s,a)=>e.jsxs("div",{className:"top-vehicle-item",children:[e.jsxs("div",{className:"vehicle-rank",children:["#",a+1]}),e.jsxs("div",{className:"vehicle-info",children:[e.jsx("h4",{children:s.vehicleId}),e.jsx("p",{children:s.vehicle?.name||"Nombre no disponible"})]}),e.jsxs("div",{className:"vehicle-consumption",children:[e.jsxs("span",{className:"consumption-value",children:[l(s.totalConsumption)," L"]}),e.jsxs("span",{className:"consumption-movements",children:[s.movementsCount," movimientos"]})]})]},s.vehicleId))})})]}),i.length>0&&e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"📈 Tendencia Temporal"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"temporal-analysis",children:i.map(s=>e.jsxs("div",{className:"month-data",children:[e.jsx("h4",{children:s.month}),e.jsxs("div",{className:"month-metrics",children:[e.jsxs("div",{className:"metric small",children:[e.jsx("span",{className:"metric-label",children:"📥 Entradas:"}),e.jsx("span",{className:"metric-value",children:s.entradas})]}),e.jsxs("div",{className:"metric small",children:[e.jsx("span",{className:"metric-label",children:"📤 Salidas:"}),e.jsx("span",{className:"metric-value",children:s.salidas})]}),e.jsxs("div",{className:"metric small",children:[e.jsx("span",{className:"metric-label",children:"🔄 Transferencias:"}),e.jsx("span",{className:"metric-value",children:s.transferencias})]}),e.jsxs("div",{className:"metric small",children:[e.jsx("span",{className:"metric-label",children:"💰 Valor:"}),e.jsx("span",{className:"metric-value",children:j(s.totalValue)})]})]})]},s.month))})})]}),e.jsxs("div",{className:"report-table-container",children:[e.jsx("div",{className:"report-table-header",children:e.jsx("h3",{className:"report-table-title",children:"📋 Movimientos Detallados"})}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{className:"report-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Combustible"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Precio Unit."}),e.jsx("th",{children:"Valor Total"}),e.jsx("th",{children:"Origen"}),e.jsx("th",{children:"Destino"}),e.jsx("th",{children:"Vehículo"}),e.jsx("th",{children:"Estado"})]})}),e.jsx("tbody",{children:r.slice(0,100).map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:new Date(s.createdAt||s.date).toLocaleDateString()}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.type===A.ENTRADA?"success":s.type===A.SALIDA?"warning":s.type===A.TRANSFERENCIA?"info":"secondary"}`,children:s.type})}),e.jsx("td",{children:s.fuelType}),e.jsxs("td",{children:[l(s.quantity)," L"]}),e.jsx("td",{children:j(s.unitPrice)}),e.jsx("td",{children:j((parseFloat(s.quantity)||0)*(parseFloat(s.unitPrice)||0))}),e.jsx("td",{children:s.sourceLocation||s.location||"-"}),e.jsx("td",{children:s.destinationLocation||"-"}),e.jsx("td",{children:s.vehicleId||"-"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.status==="completado"?"success":s.status==="pendiente"?"warning":"danger"}`,children:s.status})})]},a))})]})}),r.length>100&&e.jsxs("div",{style:{padding:"1rem",textAlign:"center",color:"#64748b"},children:["Mostrando los primeros 100 de ",r.length," movimientos. Use los filtros para refinar la búsqueda."]})]})]})},ie=()=>{const{inventory:v,movements:f,vehicles:M,suppliers:x,userProfile:E}=X(),[k,L]=d.useState("dashboard"),[y,R]=d.useState({start:new Date(Date.now()-30*24*60*60*1e3).toISOString().slice(0,10),end:new Date().toISOString().slice(0,10)});if(!(E?.combustiblesPermissions?.canViewReports||E?.role==="admin"))return e.jsx("div",{className:"reports-main",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"🔒"}),e.jsx("h3",{className:"empty-title",children:"Acceso Restringido"}),e.jsx("p",{className:"empty-message",children:"No tienes permisos para ver los reportes. Contacta a tu administrador."})]})});const N=d.useMemo(()=>H(v),[v]),p=d.useMemo(()=>q(f),[f]),u=d.useMemo(()=>B(M,f),[M,f]),P=d.useMemo(()=>$(v),[v]),b=d.useMemo(()=>U(f),[f]),i=[{id:"dashboard",title:"Dashboard",subtitle:"Vista ejecutiva",icon:"📊",component:null},{id:"inventory",title:"Inventario",subtitle:"Stock y alertas",icon:"🛢️",component:J},{id:"vehicles",title:"Vehículos",subtitle:"Consumo y eficiencia",icon:"🚜",component:ee},{id:"movements",title:"Movimientos",subtitle:"Entradas y salidas",icon:"📈",component:ae},{id:"financial",title:"Financiero",subtitle:"Costos y ROI",icon:"💰",component:se}],m=(a,c)=>{R(t=>({...t,[a]:c}))},g=()=>e.jsxs("div",{className:"dashboard-content",children:[P.length>0&&e.jsx("div",{className:"alerts-container",children:P.slice(0,3).map((a,c)=>e.jsxs("div",{className:`alert ${a.stockLevel==="critical"?"critical":"warning"}`,children:[e.jsx("span",{className:"alert-icon",children:"⚠️"}),e.jsxs("div",{className:"alert-content",children:[e.jsxs("div",{className:"alert-title",children:["Stock ",a.stockLevel==="critical"?"Crítico":"Bajo",": ",a.productName]}),e.jsxs("div",{className:"alert-message",children:[a.location," - ",l(a.currentStock)," ",a.unit,"(",w(a.percentage/100)," de capacidad)"]})]})]},c))}),e.jsxs("div",{className:"kpis-grid",children:[e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon inventory",children:"🛢️"}),e.jsx("div",{className:"kpi-value",children:j(N.totalValue)}),e.jsx("div",{className:"kpi-label",children:"Valor Total Inventario"}),e.jsxs("div",{className:"kpi-trend neutral",children:[e.jsx("span",{className:"trend-icon",children:"📦"}),N.totalItems," productos activos"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon vehicles",children:"🚜"}),e.jsx("div",{className:"kpi-value",children:u.activeVehicles}),e.jsx("div",{className:"kpi-label",children:"Vehículos Activos"}),e.jsxs("div",{className:"kpi-trend positive",children:[e.jsx("span",{className:"trend-icon",children:"⏱️"}),l(u.totalHours)," horas trabajadas"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon movements",children:"📈"}),e.jsx("div",{className:"kpi-value",children:p.totalMovements}),e.jsx("div",{className:"kpi-label",children:"Movimientos del Mes"}),e.jsxs("div",{className:"kpi-trend positive",children:[e.jsx("span",{className:"trend-icon",children:"✅"}),p.completedMovements," completados"]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon financial",children:"💰"}),e.jsx("div",{className:"kpi-value",children:l(u.averageEfficiency,1)}),e.jsx("div",{className:"kpi-label",children:"Consumo Promedio (L/h)"}),e.jsxs("div",{className:"kpi-trend neutral",children:[e.jsx("span",{className:"trend-icon",children:"📊"}),l(u.totalConsumption)," L total"]})]})]}),b.confidence>0&&e.jsxs("div",{className:"chart-container",children:[e.jsxs("div",{className:"chart-header",children:[e.jsx("h3",{className:"chart-title",children:"📈 Proyecciones de Consumo (30 días)"}),e.jsx("div",{className:"chart-actions",children:e.jsxs("span",{className:"badge info",children:["Confianza: ",l(b.confidence),"%"]})})]}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"projections-grid",children:Object.entries(b.projectedConsumption).map(([a,c])=>e.jsxs("div",{className:"projection-item",children:[e.jsx("h4",{children:a.toUpperCase()}),e.jsxs("div",{className:"projection-value",children:[l(c.projectedTotal)," L"]}),e.jsxs("div",{className:"projection-daily",children:[l(c.dailyAverage)," L/día promedio"]})]},a))})})]}),e.jsxs("div",{className:"chart-container",children:[e.jsx("div",{className:"chart-header",children:e.jsx("h3",{className:"chart-title",children:"🛢️ Stock Actual por Tipo de Combustible"})}),e.jsx("div",{className:"chart-content",children:e.jsx("div",{className:"stock-grid",children:Object.entries(N.stockByType).map(([a,c])=>e.jsxs("div",{className:"stock-item",children:[e.jsx("h4",{children:a.toUpperCase()}),e.jsxs("div",{className:"stock-value",children:[l(c)," L"]}),e.jsx("div",{className:"stock-status",children:c>1e3?e.jsx("span",{className:"badge success",children:"Stock Bueno"}):c>500?e.jsx("span",{className:"badge warning",children:"Stock Bajo"}):e.jsx("span",{className:"badge danger",children:"Stock Crítico"})})]},a))})})]})]}),s=()=>{const a=i.find(c=>c.id===k);if(k==="dashboard")return g();if(a?.component){const c=a.component;return e.jsx(c,{inventory:v,movements:f,vehicles:M,suppliers:x,dateRange:y,onDateRangeChange:m})}return e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"🚧"}),e.jsx("h3",{className:"empty-title",children:"Reporte en Desarrollo"}),e.jsx("p",{className:"empty-message",children:"Este reporte estará disponible próximamente."})]})};return e.jsxs("div",{className:"reports-main",children:[e.jsxs("div",{className:"reports-header",children:[e.jsxs("div",{className:"reports-title",children:[e.jsx("span",{className:"title-icon",children:"📋"}),e.jsx("h1",{children:"Reportes y Análisis"})]}),e.jsx("p",{className:"reports-subtitle",children:"Dashboard ejecutivo con análisis en tiempo real del sistema de combustibles"})]}),e.jsx("div",{className:"reports-filters",children:e.jsxs("div",{className:"filters-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Fecha Inicio"}),e.jsx("input",{type:"date",className:"filter-input",value:y.start,onChange:a=>m("start",a.target.value)})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Fecha Fin"}),e.jsx("input",{type:"date",className:"filter-input",value:y.end,onChange:a=>m("end",a.target.value)})]}),e.jsxs("div",{className:"filter-actions",children:[e.jsx("button",{className:"filter-btn secondary",onClick:()=>{const a=new Date,c=new Date(a.getFullYear(),a.getMonth()-1,a.getDate());R({start:c.toISOString().slice(0,10),end:a.toISOString().slice(0,10)})},children:"📅 Último Mes"}),e.jsx("button",{className:"filter-btn primary",onClick:()=>window.location.reload(),children:"🔄 Actualizar"})]})]})}),e.jsx("div",{className:"reports-navigation",children:i.map(a=>e.jsxs("button",{className:`nav-tab ${k===a.id?"active":""}`,onClick:()=>L(a.id),children:[e.jsx("span",{className:"nav-tab-icon",children:a.icon}),e.jsxs("div",{className:"nav-tab-text",children:[e.jsx("span",{className:"nav-tab-title",children:a.title}),e.jsx("span",{className:"nav-tab-subtitle",children:a.subtitle})]})]},a.id))}),s()]})};export{ie as default};
