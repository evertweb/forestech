import{r as N,j as e,a as B,o as $,u as U,a5 as Y,a6 as H,f as I,a7 as A,a8 as J,a9 as K,aa as Q}from"./index-BX0KpfFq.js";const W=({suppliers:s,onEdit:f,onDelete:x,hasEditPermission:g,hasDeletePermission:b})=>{const[o,i]=N.useState("name"),[m,k]=N.useState("asc"),d=t=>{o===t?k(m==="asc"?"desc":"asc"):(i(t),k("asc"))},r=[...s].sort((t,p)=>{let v=t[o],a=p[o];switch(o){case"rating":v=v||0,a=a||0;break;case"totalOrders":case"totalPurchased":v=v||0,a=a||0;break;case"createdAt":case"lastOrderDate":v=v?v.toDate?v.toDate():new Date(v):new Date(0),a=a?a.toDate?a.toDate():new Date(a):new Date(0);break;default:v=(v||"").toString().toLowerCase(),a=(a||"").toString().toLowerCase()}return v<a?m==="asc"?-1:1:v>a?m==="asc"?1:-1:0}),S=t=>{switch(t){case"active":return"#22c55e";case"inactive":return"#ef4444";case"suspended":return"#f59e0b";default:return"#6b7280"}},w=t=>{switch(t){case"active":return"Activo";case"inactive":return"Inactivo";case"suspended":return"Suspendido";default:return"Desconocido"}},c=t=>t?(t.toDate?t.toDate():new Date(t)).toLocaleDateString("es-CO"):"-",n=t=>{const p=[];for(let v=1;v<=5;v++)p.push(e.jsx("span",{className:`star ${v<=t?"filled":""}`,children:"‚òÖ"},v));return e.jsx("div",{className:"rating-stars",children:p})},y=t=>!t||t.length===0?e.jsx("span",{className:"no-data",children:"-"}):e.jsxs("div",{className:"fuel-types-cell",children:[t.slice(0,2).map(p=>e.jsx("span",{className:"fuel-badge-sm",children:$[p]||p},p)),t.length>2&&e.jsxs("span",{className:"fuel-badge-sm more",title:t.slice(2).map(p=>$[p]||p).join(", "),children:["+",t.length-2]})]}),l=t=>o!==t?"icon-chevrons-up-down":m==="asc"?"icon-chevron-up":"icon-chevron-down";return e.jsxs("div",{className:"suppliers-table-container",children:[e.jsxs("div",{className:"table-wrapper",children:[e.jsxs("table",{className:"suppliers-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{className:`sortable ${o==="name"?"active":""}`,onClick:()=>d("name"),children:[e.jsx("span",{children:"Proveedor"}),e.jsx("i",{className:l("name")})]}),e.jsxs("th",{className:`sortable ${o==="status"?"active":""}`,onClick:()=>d("status"),children:[e.jsx("span",{children:"Estado"}),e.jsx("i",{className:l("status")})]}),e.jsxs("th",{className:`sortable ${o==="category"?"active":""}`,onClick:()=>d("category"),children:[e.jsx("span",{children:"Categor√≠a"}),e.jsx("i",{className:l("category")})]}),e.jsx("th",{children:e.jsx("span",{children:"Combustibles"})}),e.jsx("th",{children:e.jsx("span",{children:"Contacto"})}),e.jsxs("th",{className:`sortable ${o==="rating"?"active":""}`,onClick:()=>d("rating"),children:[e.jsx("span",{children:"Rating"}),e.jsx("i",{className:l("rating")})]}),e.jsxs("th",{className:`sortable ${o==="totalOrders"?"active":""}`,onClick:()=>d("totalOrders"),children:[e.jsx("span",{children:"√ìrdenes"}),e.jsx("i",{className:l("totalOrders")})]}),e.jsxs("th",{className:`sortable ${o==="totalPurchased"?"active":""}`,onClick:()=>d("totalPurchased"),children:[e.jsx("span",{children:"Total Comprado"}),e.jsx("i",{className:l("totalPurchased")})]}),e.jsxs("th",{className:`sortable ${o==="createdAt"?"active":""}`,onClick:()=>d("createdAt"),children:[e.jsx("span",{children:"Creado"}),e.jsx("i",{className:l("createdAt")})]}),e.jsx("th",{className:"actions-column",children:e.jsx("span",{children:"Acciones"})})]})}),e.jsx("tbody",{children:r.map(t=>e.jsxs("tr",{className:`supplier-row ${t.status}`,children:[e.jsx("td",{className:"supplier-info-cell",children:e.jsxs("div",{className:"supplier-main-info",children:[e.jsxs("div",{className:"supplier-name",children:[t.name,t.isPreferred&&e.jsx("span",{className:"preferred-badge",title:"Proveedor Preferido",children:e.jsx("i",{className:"icon-star"})})]}),t.taxId&&e.jsxs("div",{className:"supplier-tax-id",children:["NIT: ",t.taxId]}),t.type&&e.jsx("div",{className:"supplier-type",children:t.type.charAt(0).toUpperCase()+t.type.slice(1)})]})}),e.jsx("td",{className:"status-cell",children:e.jsxs("div",{className:"status-display",children:[e.jsx("span",{className:"status-dot",style:{backgroundColor:S(t.status)}}),e.jsx("span",{className:"status-label",children:w(t.status)})]})}),e.jsx("td",{className:"category-cell",children:e.jsx("span",{className:"category-label",children:t.category?.charAt(0).toUpperCase()+t.category?.slice(1)||"-"})}),e.jsx("td",{className:"fuel-types-cell",children:y(t.fuelTypes)}),e.jsx("td",{className:"contact-cell",children:e.jsxs("div",{className:"contact-info",children:[t.contactPerson&&e.jsxs("div",{className:"contact-person",children:[e.jsx("i",{className:"icon-user"}),e.jsx("span",{children:t.contactPerson})]}),t.phone&&e.jsxs("div",{className:"contact-item",children:[e.jsx("i",{className:"icon-phone"}),e.jsx("a",{href:`tel:${t.phone}`,children:t.phone})]}),t.email&&e.jsxs("div",{className:"contact-item",children:[e.jsx("i",{className:"icon-mail"}),e.jsx("a",{href:`mailto:${t.email}`,children:t.email})]}),t.city&&e.jsxs("div",{className:"contact-item",children:[e.jsx("i",{className:"icon-map-pin"}),e.jsx("span",{children:t.city})]})]})}),e.jsx("td",{className:"rating-cell",children:e.jsxs("div",{className:"rating-display",children:[n(t.rating||0),e.jsx("span",{className:"rating-value",children:(t.rating||0).toFixed(1)})]})}),e.jsx("td",{className:"orders-cell",children:e.jsx("span",{className:"orders-count",children:t.totalOrders||0})}),e.jsx("td",{className:"purchased-cell",children:e.jsx("span",{className:"purchased-amount",children:B(t.totalPurchased||0)})}),e.jsx("td",{className:"date-cell",children:e.jsx("span",{className:"date-value",children:c(t.createdAt)})}),e.jsx("td",{className:"actions-cell",children:e.jsxs("div",{className:"action-buttons",children:[g&&e.jsx("button",{className:"btn btn-sm btn-secondary",onClick:()=>f(t),title:"Editar proveedor",children:e.jsx("i",{className:"icon-edit"})}),b&&t.status==="active"&&e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>x(t.id,t.name),title:"Desactivar proveedor",children:e.jsx("i",{className:"icon-x-circle"})}),e.jsxs("div",{className:"quick-actions",children:[t.phone&&e.jsx("a",{href:`tel:${t.phone}`,className:"quick-action-btn",title:"Llamar",children:e.jsx("i",{className:"icon-phone"})}),t.email&&e.jsx("a",{href:`mailto:${t.email}`,className:"quick-action-btn",title:"Enviar email",children:e.jsx("i",{className:"icon-mail"})})]})]})})]},t.id))})]}),r.length===0&&e.jsxs("div",{className:"table-empty-state",children:[e.jsx("i",{className:"icon-truck"}),e.jsx("p",{children:"No hay proveedores para mostrar"})]})]}),e.jsxs("div",{className:"table-footer",children:[e.jsx("div",{className:"table-info",children:e.jsxs("span",{children:["Mostrando ",r.length," proveedor",r.length!==1?"es":""]})}),e.jsx("div",{className:"table-actions",children:e.jsxs("span",{className:"sort-info",children:["Ordenado por: ",o==="name"?"Nombre":o==="status"?"Estado":o==="category"?"Categor√≠a":o==="rating"?"Rating":o==="totalOrders"?"√ìrdenes":o==="totalPurchased"?"Total Comprado":o==="createdAt"?"Fecha de Creaci√≥n":o," (",m==="asc"?"Ascendente":"Descendente",")"]})})]})]})},X=({suppliers:s,onEdit:f,onDelete:x,hasEditPermission:g,hasDeletePermission:b})=>{const o=c=>{switch(c){case"active":return"#22c55e";case"inactive":return"#ef4444";case"suspended":return"#f59e0b";default:return"#6b7280"}},i=c=>{switch(c){case"active":return"Activo";case"inactive":return"Inactivo";case"suspended":return"Suspendido";default:return"Desconocido"}},m=c=>{switch(c){case"combustibles":return"‚õΩ";case"lubricantes":return"üõ¢Ô∏è";case"aditivos":return"üß™";default:return"üì¶"}},k=c=>{switch(c){case"proveedor":return"Proveedor";case"distribuidor":return"Distribuidor";case"mayorista":return"Mayorista";default:return"Sin especificar"}},d=c=>c?(c.toDate?c.toDate():new Date(c)).toLocaleDateString("es-CO"):"No disponible",r=c=>{const n=[];for(let y=1;y<=5;y++)n.push(e.jsx("span",{className:`star ${y<=c?"filled":""}`,children:"‚òÖ"},y));return e.jsx("div",{className:"rating-stars",children:n})},S=c=>!c||c.length===0?e.jsx("span",{className:"no-fuels",children:"Sin combustibles especificados"}):e.jsxs("div",{className:"fuel-types",children:[c.slice(0,3).map(n=>e.jsx("span",{className:"fuel-badge",title:$[n],children:$[n]||n},n)),c.length>3&&e.jsxs("span",{className:"fuel-badge more",title:`+${c.length-3} m√°s`,children:["+",c.length-3]})]}),w=c=>{const n=[];return c.phone&&n.push(e.jsxs("div",{className:"contact-item",children:[e.jsx("i",{className:"icon-phone"}),e.jsx("span",{children:c.phone})]},"phone")),c.email&&n.push(e.jsxs("div",{className:"contact-item",children:[e.jsx("i",{className:"icon-mail"}),e.jsx("span",{children:c.email})]},"email")),c.city&&n.push(e.jsxs("div",{className:"contact-item",children:[e.jsx("i",{className:"icon-map-pin"}),e.jsx("span",{children:c.city})]},"city")),n.length>0?n:e.jsxs("div",{className:"contact-item no-contact",children:[e.jsx("i",{className:"icon-info-circle"}),e.jsx("span",{children:"Sin informaci√≥n de contacto"})]})};return e.jsx("div",{className:"suppliers-cards",children:s.map(c=>e.jsxs("div",{className:`supplier-card ${c.status}`,children:[e.jsxs("div",{className:"card-header",children:[e.jsx("div",{className:"header-left",children:e.jsxs("div",{className:"supplier-info",children:[e.jsxs("h3",{className:"supplier-name",children:[c.name,c.isPreferred&&e.jsx("span",{className:"preferred-badge",title:"Proveedor Preferido",children:e.jsx("i",{className:"icon-star"})})]}),c.taxId&&e.jsxs("div",{className:"supplier-tax-id",children:["NIT: ",c.taxId]})]})}),e.jsx("div",{className:"header-right",children:e.jsxs("div",{className:"supplier-status",children:[e.jsx("span",{className:"status-dot",style:{backgroundColor:o(c.status)}}),e.jsx("span",{className:"status-label",children:i(c.status)})]})})]}),e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"supplier-meta",children:[e.jsxs("div",{className:"meta-item",children:[e.jsx("span",{className:"meta-icon",children:m(c.category)}),e.jsx("span",{className:"meta-label",children:c.category?.charAt(0).toUpperCase()+c.category?.slice(1)||"Sin categor√≠a"})]}),e.jsxs("div",{className:"meta-item",children:[e.jsx("i",{className:"icon-building meta-icon"}),e.jsx("span",{className:"meta-label",children:k(c.type)})]})]}),c.contactPerson&&e.jsxs("div",{className:"contact-person",children:[e.jsx("i",{className:"icon-user"}),e.jsx("span",{children:c.contactPerson})]}),e.jsx("div",{className:"contact-info",children:w(c)}),e.jsxs("div",{className:"fuel-types-section",children:[e.jsx("div",{className:"section-label",children:"Combustibles Suministrados:"}),S(c.fuelTypes)]}),e.jsxs("div",{className:"rating-section",children:[e.jsxs("div",{className:"rating-display",children:[r(c.rating||0),e.jsxs("span",{className:"rating-value",children:[(c.rating||0).toFixed(1),"/5"]})]}),c.evaluationNotes&&e.jsxs("div",{className:"evaluation-notes",title:c.evaluationNotes,children:[e.jsx("i",{className:"icon-message-square"}),e.jsx("span",{children:"Con evaluaci√≥n"})]})]}),c.paymentTerms&&e.jsxs("div",{className:"payment-terms",children:[e.jsx("i",{className:"icon-credit-card"}),e.jsxs("span",{children:["T√©rminos: ",c.paymentTerms==="contado"?"Contado":c.paymentTerms==="30dias"?"30 d√≠as":c.paymentTerms==="60dias"?"60 d√≠as":c.paymentTerms==="90dias"?"90 d√≠as":c.paymentTerms]})]}),e.jsxs("div",{className:"supplier-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"√ìrdenes:"}),e.jsx("span",{className:"stat-value",children:c.totalOrders||0})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Total Comprado:"}),e.jsx("span",{className:"stat-value",children:B(c.totalPurchased||0)})]}),c.lastOrderDate&&e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"√öltima Orden:"}),e.jsx("span",{className:"stat-value",children:d(c.lastOrderDate)})]})]})]}),e.jsxs("div",{className:"card-footer",children:[e.jsx("div",{className:"footer-info",children:e.jsxs("span",{className:"created-date",children:["Creado: ",d(c.createdAt)]})}),e.jsxs("div",{className:"card-actions",children:[g&&e.jsxs("button",{className:"btn btn-sm btn-secondary",onClick:()=>f(c),title:"Editar proveedor",children:[e.jsx("i",{className:"icon-edit"}),"Editar"]}),b&&c.status==="active"&&e.jsxs("button",{className:"btn btn-sm btn-danger",onClick:()=>x(c.id,c.name),title:"Desactivar proveedor",children:[e.jsx("i",{className:"icon-x-circle"}),"Desactivar"]}),e.jsxs("div",{className:"quick-actions",children:[c.phone&&e.jsx("a",{href:`tel:${c.phone}`,className:"quick-action-btn",title:"Llamar",children:e.jsx("i",{className:"icon-phone"})}),c.email&&e.jsx("a",{href:`mailto:${c.email}`,className:"quick-action-btn",title:"Enviar email",children:e.jsx("i",{className:"icon-mail"})})]})]})]})]},c.id))})},Z=({supplier:s,onClose:f,onSuccess:x,onError:g})=>{const{userProfile:b}=U(),o=!!s,[i,m]=N.useState({name:"",taxId:"",type:"proveedor",category:"combustibles",contactPerson:"",phone:"",email:"",address:"",city:"",state:"Colombia",fuelTypes:[],paymentTerms:"contado",creditLimit:"",priceList:{},rating:5,evaluationNotes:"",status:"active",isPreferred:!1}),[k,d]=N.useState(!1),[r,S]=N.useState({}),[w,c]=N.useState("basic");N.useEffect(()=>{o&&s&&m({name:s.name||"",taxId:s.taxId||"",type:s.type||"proveedor",category:s.category||"combustibles",contactPerson:s.contactPerson||"",phone:s.phone||"",email:s.email||"",address:s.address||"",city:s.city||"",state:s.state||"Colombia",fuelTypes:s.fuelTypes||[],paymentTerms:s.paymentTerms||"contado",creditLimit:s.creditLimit||"",priceList:s.priceList||{},rating:s.rating||5,evaluationNotes:s.evaluationNotes||"",status:s.status||"active",isPreferred:s.isPreferred||!1})},[o,s]);const n=(a,h)=>{m(u=>({...u,[a]:h})),r[a]&&S(u=>({...u,[a]:null}))},y=a=>{m(h=>({...h,fuelTypes:h.fuelTypes.includes(a)?h.fuelTypes.filter(u=>u!==a):[...h.fuelTypes,a]}))},l=(a,h)=>{m(u=>({...u,priceList:{...u.priceList,[a]:parseFloat(h)||0}}))},t=()=>{const a={};return i.name.trim()||(a.name="El nombre del proveedor es requerido"),i.category||(a.category="La categor√≠a es requerida"),i.type||(a.type="El tipo de proveedor es requerido"),i.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.email)&&(a.email="El formato del email no es v√°lido"),i.phone&&!/^[\d\s\-+()]+$/.test(i.phone)&&(a.phone="El formato del tel√©fono no es v√°lido"),i.creditLimit&&(isNaN(i.creditLimit)||parseFloat(i.creditLimit)<0)&&(a.creditLimit="El l√≠mite de cr√©dito debe ser un n√∫mero positivo"),(i.rating<1||i.rating>5)&&(a.rating="El rating debe estar entre 1 y 5"),i.fuelTypes.forEach(h=>{i.priceList[h]&&(isNaN(i.priceList[h])||parseFloat(i.priceList[h])<0)&&(a[`price_${h}`]=`El precio de ${$[h]} debe ser un n√∫mero positivo`)}),S(a),Object.keys(a).length===0},p=async a=>{if(a.preventDefault(),!!t()){d(!0);try{const h={...i,creditLimit:parseFloat(i.creditLimit)||0,rating:parseFloat(i.rating)||5,priceList:Object.fromEntries(Object.entries(i.priceList).filter(([O,E])=>i.fuelTypes.includes(O)&&E>0))};let u;o?u=await Y(s.id,h,b?.email):u=await H(h,b?.email),u.success?x():g(u.error||"Error al guardar proveedor")}catch(h){console.error("Error saving supplier:",h),g("Error inesperado al guardar proveedor")}finally{d(!1)}}},v=[{id:"basic",label:"Informaci√≥n B√°sica",icon:"icon-info"},{id:"contact",label:"Contacto",icon:"icon-phone"},{id:"products",label:"Productos",icon:"icon-package"},{id:"commercial",label:"Comercial",icon:"icon-credit-card"}];return e.jsx("div",{className:"modal-overlay",onClick:f,children:e.jsxs("div",{className:"modal-container large",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx("i",{className:"icon-truck"}),o?"Editar Proveedor":"Nuevo Proveedor"]}),e.jsx("button",{className:"modal-close",onClick:f,children:e.jsx("i",{className:"icon-x"})})]}),e.jsxs("form",{onSubmit:p,children:[e.jsx("div",{className:"modal-tabs",children:v.map(a=>e.jsxs("button",{type:"button",className:`tab-button ${w===a.id?"active":""}`,onClick:()=>c(a.id),children:[e.jsx("i",{className:a.icon}),a.label]},a.id))}),e.jsxs("div",{className:"modal-body",children:[w==="basic"&&e.jsx("div",{className:"tab-content",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"required",children:"Nombre del Proveedor"}),e.jsx("input",{type:"text",value:i.name,onChange:a=>n("name",a.target.value),placeholder:"Ingresa el nombre del proveedor",className:r.name?"error":""}),r.name&&e.jsx("span",{className:"error-message",children:r.name})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"NIT / Documento"}),e.jsx("input",{type:"text",value:i.taxId,onChange:a=>n("taxId",a.target.value),placeholder:"123456789-0",className:r.taxId?"error":""}),r.taxId&&e.jsx("span",{className:"error-message",children:r.taxId})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"required",children:"Tipo de Proveedor"}),e.jsxs("select",{value:i.type,onChange:a=>n("type",a.target.value),className:r.type?"error":"",children:[e.jsx("option",{value:"proveedor",children:"Proveedor"}),e.jsx("option",{value:"distribuidor",children:"Distribuidor"}),e.jsx("option",{value:"mayorista",children:"Mayorista"})]}),r.type&&e.jsx("span",{className:"error-message",children:r.type})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"required",children:"Categor√≠a"}),e.jsxs("select",{value:i.category,onChange:a=>n("category",a.target.value),className:r.category?"error":"",children:[e.jsx("option",{value:"combustibles",children:"Combustibles"}),e.jsx("option",{value:"lubricantes",children:"Lubricantes"}),e.jsx("option",{value:"aditivos",children:"Aditivos"})]}),r.category&&e.jsx("span",{className:"error-message",children:r.category})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Estado"}),e.jsxs("select",{value:i.status,onChange:a=>n("status",a.target.value),children:[e.jsx("option",{value:"active",children:"Activo"}),e.jsx("option",{value:"inactive",children:"Inactivo"}),e.jsx("option",{value:"suspended",children:"Suspendido"})]})]}),e.jsx("div",{className:"form-group checkbox",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:i.isPreferred,onChange:a=>n("isPreferred",a.target.checked)}),e.jsx("span",{className:"checkbox-mark"}),"Proveedor Preferido"]})})]})}),w==="contact"&&e.jsx("div",{className:"tab-content",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Persona de Contacto"}),e.jsx("input",{type:"text",value:i.contactPerson,onChange:a=>n("contactPerson",a.target.value),placeholder:"Nombre del contacto principal"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tel√©fono"}),e.jsx("input",{type:"tel",value:i.phone,onChange:a=>n("phone",a.target.value),placeholder:"+57 300 123 4567",className:r.phone?"error":""}),r.phone&&e.jsx("span",{className:"error-message",children:r.phone})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email"}),e.jsx("input",{type:"email",value:i.email,onChange:a=>n("email",a.target.value),placeholder:"contacto@proveedor.com",className:r.email?"error":""}),r.email&&e.jsx("span",{className:"error-message",children:r.email})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Ciudad"}),e.jsx("input",{type:"text",value:i.city,onChange:a=>n("city",a.target.value),placeholder:"Bogot√°"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Estado/Pa√≠s"}),e.jsx("input",{type:"text",value:i.state,onChange:a=>n("state",a.target.value),placeholder:"Colombia"})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Direcci√≥n"}),e.jsx("textarea",{value:i.address,onChange:a=>n("address",a.target.value),placeholder:"Direcci√≥n completa del proveedor",rows:"3"})]})]})}),w==="products"&&e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{className:"section",children:[e.jsx("h3",{children:"Tipos de Combustible que Suministra"}),e.jsx("div",{className:"fuel-types-grid",children:Object.entries($).map(([a,h])=>e.jsx("div",{className:"fuel-type-item",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:i.fuelTypes.includes(a),onChange:()=>y(a)}),e.jsx("span",{className:"checkbox-mark"}),h]})},a))})]}),i.fuelTypes.length>0&&e.jsxs("div",{className:"section",children:[e.jsx("h3",{children:"Precios por Litro (Opcional)"}),e.jsx("div",{className:"prices-grid",children:i.fuelTypes.map(a=>e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:$[a]}),e.jsxs("div",{className:"input-with-currency",children:[e.jsx("span",{className:"currency-symbol",children:"$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:i.priceList[a]||"",onChange:h=>l(a,h.target.value),placeholder:"0.00",className:r[`price_${a}`]?"error":""})]}),r[`price_${a}`]&&e.jsx("span",{className:"error-message",children:r[`price_${a}`]})]},a))})]})]}),w==="commercial"&&e.jsx("div",{className:"tab-content",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"T√©rminos de Pago"}),e.jsxs("select",{value:i.paymentTerms,onChange:a=>n("paymentTerms",a.target.value),children:[e.jsx("option",{value:"contado",children:"Contado"}),e.jsx("option",{value:"30dias",children:"30 d√≠as"}),e.jsx("option",{value:"60dias",children:"60 d√≠as"}),e.jsx("option",{value:"90dias",children:"90 d√≠as"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"L√≠mite de Cr√©dito"}),e.jsxs("div",{className:"input-with-currency",children:[e.jsx("span",{className:"currency-symbol",children:"$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:i.creditLimit,onChange:a=>n("creditLimit",a.target.value),placeholder:"0.00",className:r.creditLimit?"error":""})]}),r.creditLimit&&e.jsx("span",{className:"error-message",children:r.creditLimit})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Rating"}),e.jsxs("div",{className:"rating-input",children:[e.jsx("input",{type:"range",min:"1",max:"5",step:"0.1",value:i.rating,onChange:a=>n("rating",parseFloat(a.target.value)),className:r.rating?"error":""}),e.jsxs("div",{className:"rating-display",children:[e.jsx("span",{className:"rating-value",children:i.rating.toFixed(1)}),e.jsx("div",{className:"rating-stars",children:[1,2,3,4,5].map(a=>e.jsx("span",{className:`star ${a<=Math.round(i.rating)?"filled":""}`,children:"‚òÖ"},a))})]})]}),r.rating&&e.jsx("span",{className:"error-message",children:r.rating})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Notas de Evaluaci√≥n"}),e.jsx("textarea",{value:i.evaluationNotes,onChange:a=>n("evaluationNotes",a.target.value),placeholder:"Comentarios sobre el desempe√±o del proveedor...",rows:"4"})]})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:f,disabled:k,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:k,children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"loading-spinner small"}),o?"Actualizando...":"Creando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"icon-save"}),o?"Actualizar Proveedor":"Crear Proveedor"]})})]})]})]})})},ee=({stats:s,suppliersCount:f,totalSuppliers:x})=>{if(!s)return null;const g=i=>{switch(i){case"active":return"#22c55e";case"inactive":return"#ef4444";case"suspended":return"#f59e0b";default:return"#6b7280"}},b=i=>{switch(i){case"combustibles":return"‚õΩ";case"lubricantes":return"üõ¢Ô∏è";case"aditivos":return"üß™";default:return"üì¶"}},o=i=>{switch(i){case"proveedor":return"üè™";case"distribuidor":return"üöõ";case"mayorista":return"üè≠";default:return"üè¢"}};return e.jsxs("div",{className:"suppliers-stats",children:[e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card primary",children:[e.jsx("div",{className:"stat-icon",children:e.jsx("i",{className:"icon-truck"})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:I(s.total)}),e.jsx("div",{className:"stat-label",children:"Total Proveedores"}),x!==f&&e.jsxs("div",{className:"stat-sublabel",children:[I(f)," mostrados"]})]})]}),e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-icon",children:e.jsx("i",{className:"icon-check-circle"})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:I(s.active)}),e.jsx("div",{className:"stat-label",children:"Activos"}),e.jsx("div",{className:"stat-sublabel",children:A(s.total>0?s.active/s.total:0)})]})]}),e.jsxs("div",{className:"stat-card warning",children:[e.jsx("div",{className:"stat-icon",children:e.jsx("i",{className:"icon-star"})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:I(s.preferred)}),e.jsx("div",{className:"stat-label",children:"Preferidos"}),e.jsx("div",{className:"stat-sublabel",children:A(s.active>0?s.preferred/s.active:0)})]})]}),e.jsxs("div",{className:"stat-card info",children:[e.jsx("div",{className:"stat-icon",children:e.jsx("i",{className:"icon-award"})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:s.averageRating.toFixed(1)}),e.jsx("div",{className:"stat-label",children:"Rating Promedio"}),e.jsx("div",{className:"stat-sublabel",children:e.jsx("div",{className:"rating-stars",children:[1,2,3,4,5].map(i=>e.jsx("span",{className:`star ${i<=Math.round(s.averageRating)?"filled":""}`,children:"‚òÖ"},i))})})]})]})]}),e.jsxs("div",{className:"stats-details",children:[e.jsxs("div",{className:"stats-section",children:[e.jsx("h3",{children:"Estado de Proveedores"}),e.jsxs("div",{className:"stats-breakdown",children:[e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-label",children:[e.jsx("span",{className:"status-dot",style:{backgroundColor:g("active")}}),"Activos"]}),e.jsx("div",{className:"breakdown-value",children:s.active}),e.jsx("div",{className:"breakdown-percentage",children:A(s.total>0?s.active/s.total:0)})]}),s.inactive>0&&e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-label",children:[e.jsx("span",{className:"status-dot",style:{backgroundColor:g("inactive")}}),"Inactivos"]}),e.jsx("div",{className:"breakdown-value",children:s.inactive}),e.jsx("div",{className:"breakdown-percentage",children:A(s.total>0?s.inactive/s.total:0)})]}),s.suspended>0&&e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-label",children:[e.jsx("span",{className:"status-dot",style:{backgroundColor:g("suspended")}}),"Suspendidos"]}),e.jsx("div",{className:"breakdown-value",children:s.suspended}),e.jsx("div",{className:"breakdown-percentage",children:A(s.total>0?s.suspended/s.total:0)})]})]})]}),Object.keys(s.byCategory).length>0&&e.jsxs("div",{className:"stats-section",children:[e.jsx("h3",{children:"Por Categor√≠a"}),e.jsx("div",{className:"stats-breakdown",children:Object.entries(s.byCategory).sort(([,i],[,m])=>m-i).map(([i,m])=>e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-label",children:[e.jsx("span",{className:"category-icon",children:b(i)}),i.charAt(0).toUpperCase()+i.slice(1).replace("_"," ")]}),e.jsx("div",{className:"breakdown-value",children:m}),e.jsx("div",{className:"breakdown-percentage",children:A(s.total>0?m/s.total:0)})]},i))})]}),Object.keys(s.byType).length>0&&e.jsxs("div",{className:"stats-section",children:[e.jsx("h3",{children:"Por Tipo"}),e.jsx("div",{className:"stats-breakdown",children:Object.entries(s.byType).sort(([,i],[,m])=>m-i).map(([i,m])=>e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-label",children:[e.jsx("span",{className:"type-icon",children:o(i)}),i.charAt(0).toUpperCase()+i.slice(1)]}),e.jsx("div",{className:"breakdown-value",children:m}),e.jsx("div",{className:"breakdown-percentage",children:A(s.total>0?m/s.total:0)})]},i))})]})]}),e.jsxs("div",{className:"stats-insights",children:[e.jsx("h3",{children:"Informaci√≥n R√°pida"}),e.jsxs("div",{className:"insights-grid",children:[e.jsxs("div",{className:"insight-item",children:[e.jsx("div",{className:"insight-label",children:"Nivel de Satisfacci√≥n"}),e.jsx("div",{className:"insight-value",children:s.averageRating>=4.5?"Excelente":s.averageRating>=4?"Muy Bueno":s.averageRating>=3.5?"Bueno":s.averageRating>=3?"Regular":"Necesita Mejora"})]}),e.jsxs("div",{className:"insight-item",children:[e.jsx("div",{className:"insight-label",children:"Estado General"}),e.jsx("div",{className:"insight-value",children:s.active/s.total>=.9?"Excelente":s.active/s.total>=.8?"Bueno":s.active/s.total>=.7?"Regular":"Revisar"})]}),e.jsxs("div",{className:"insight-item",children:[e.jsx("div",{className:"insight-label",children:"Proveedores Preferidos"}),e.jsx("div",{className:"insight-value",children:s.preferred===0?"Ninguno":s.preferred/s.active>=.3?"Suficientes":s.preferred/s.active>=.2?"Buenos":"Pocos"})]}),e.jsxs("div",{className:"insight-item",children:[e.jsx("div",{className:"insight-label",children:"Diversificaci√≥n"}),e.jsx("div",{className:"insight-value",children:Object.keys(s.byCategory).length>=3?"Alta":Object.keys(s.byCategory).length>=2?"Media":"Baja"})]})]})]})]})},se=({searchTerm:s,setSearchTerm:f,filterStatus:x,setFilterStatus:g,filterCategory:b,setFilterCategory:o,filterFuelType:i,setFilterFuelType:m,viewMode:k,setViewMode:d,onClearFilters:r,resultsCount:S})=>{const w=[{value:"all",label:"Todos los Estados",icon:"list"},{value:"active",label:"Activos",icon:"check-circle"},{value:"inactive",label:"Inactivos",icon:"x-circle"},{value:"suspended",label:"Suspendidos",icon:"alert-circle"},{value:"preferred",label:"Preferidos",icon:"star"}],c=[{value:"all",label:"Todas las Categor√≠as",icon:"grid"},{value:"combustibles",label:"Combustibles",icon:"fuel"},{value:"lubricantes",label:"Lubricantes",icon:"droplets"},{value:"aditivos",label:"Aditivos",icon:"flask"}],n=[{value:"all",label:"Todos los Combustibles",icon:"fuel"},...Object.entries($).map(([l,t])=>({value:l,label:t,icon:"droplet"}))],y=s||x!=="all"||b!=="all"||i!=="all";return e.jsxs("div",{className:"suppliers-filters",children:[e.jsxs("div",{className:"filters-top",children:[e.jsx("div",{className:"search-container",children:e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("i",{className:"icon-search search-icon"}),e.jsx("input",{type:"text",placeholder:"Buscar por nombre, NIT, contacto, ciudad...",value:s,onChange:l=>f(l.target.value),className:"search-input"}),s&&e.jsx("button",{className:"search-clear",onClick:()=>f(""),title:"Limpiar b√∫squeda",children:e.jsx("i",{className:"icon-x"})})]})}),e.jsxs("div",{className:"view-controls",children:[e.jsxs("div",{className:"view-mode-toggle",children:[e.jsx("button",{className:`view-btn ${k==="cards"?"active":""}`,onClick:()=>d("cards"),title:"Vista de tarjetas",children:e.jsx("i",{className:"icon-grid"})}),e.jsx("button",{className:`view-btn ${k==="table"?"active":""}`,onClick:()=>d("table"),title:"Vista de tabla",children:e.jsx("i",{className:"icon-list"})})]}),y&&e.jsxs("button",{className:"btn btn-secondary clear-filters",onClick:r,title:"Limpiar todos los filtros",children:[e.jsx("i",{className:"icon-filter-x"}),"Limpiar"]})]})]}),e.jsxs("div",{className:"filters-dropdowns",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Estado"}),e.jsxs("div",{className:"select-wrapper",children:[e.jsx("select",{value:x,onChange:l=>g(l.target.value),className:"filter-select",children:w.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))}),e.jsx("i",{className:"icon-chevron-down select-arrow"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Categor√≠a"}),e.jsxs("div",{className:"select-wrapper",children:[e.jsx("select",{value:b,onChange:l=>o(l.target.value),className:"filter-select",children:c.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))}),e.jsx("i",{className:"icon-chevron-down select-arrow"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"Tipo de Combustible"}),e.jsxs("div",{className:"select-wrapper",children:[e.jsx("select",{value:i,onChange:l=>m(l.target.value),className:"filter-select",children:n.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))}),e.jsx("i",{className:"icon-chevron-down select-arrow"})]})]})]}),e.jsxs("div",{className:"filters-summary",children:[e.jsxs("div",{className:"results-count",children:[e.jsx("i",{className:"icon-info-circle"}),e.jsx("span",{children:S===0?"No se encontraron proveedores":`Mostrando ${S} proveedor${S!==1?"es":""}`})]}),y&&e.jsxs("div",{className:"active-filters",children:[e.jsx("span",{className:"filters-label",children:"Filtros activos:"}),e.jsxs("div",{className:"filter-tags",children:[s&&e.jsxs("span",{className:"filter-tag",children:[e.jsx("i",{className:"icon-search"}),s,e.jsx("button",{onClick:()=>f(""),children:e.jsx("i",{className:"icon-x"})})]}),x!=="all"&&e.jsxs("span",{className:"filter-tag",children:[e.jsx("i",{className:"icon-filter"}),w.find(l=>l.value===x)?.label,e.jsx("button",{onClick:()=>g("all"),children:e.jsx("i",{className:"icon-x"})})]}),b!=="all"&&e.jsxs("span",{className:"filter-tag",children:[e.jsx("i",{className:"icon-tag"}),c.find(l=>l.value===b)?.label,e.jsx("button",{onClick:()=>o("all"),children:e.jsx("i",{className:"icon-x"})})]}),i!=="all"&&e.jsxs("span",{className:"filter-tag",children:[e.jsx("i",{className:"icon-droplet"}),n.find(l=>l.value===i)?.label,e.jsx("button",{onClick:()=>m("all"),children:e.jsx("i",{className:"icon-x"})})]})]})]})]}),e.jsxs("div",{className:"quick-filters",children:[e.jsx("span",{className:"quick-filters-label",children:"Acceso r√°pido:"}),e.jsxs("div",{className:"quick-filter-buttons",children:[e.jsxs("button",{className:`quick-filter-btn ${x==="preferred"?"active":""}`,onClick:()=>g(x==="preferred"?"all":"preferred"),children:[e.jsx("i",{className:"icon-star"}),"Preferidos"]}),e.jsxs("button",{className:`quick-filter-btn ${x==="active"?"active":""}`,onClick:()=>g(x==="active"?"all":"active"),children:[e.jsx("i",{className:"icon-check-circle"}),"Activos"]}),e.jsxs("button",{className:`quick-filter-btn ${b==="combustibles"?"active":""}`,onClick:()=>o(b==="combustibles"?"all":"combustibles"),children:[e.jsx("i",{className:"icon-fuel"}),"Combustibles"]}),e.jsxs("button",{className:`quick-filter-btn ${i==="diesel"?"active":""}`,onClick:()=>m(i==="diesel"?"all":"diesel"),children:[e.jsx("i",{className:"icon-droplet"}),"Di√©sel"]})]})]})]})},ce=()=>{const{hasPermission:s,userProfile:f}=U(),[x,g]=N.useState([]),[b,o]=N.useState(null),[i,m]=N.useState(!0),[k,d]=N.useState(null),[r,S]=N.useState("cards"),[w,c]=N.useState(!1),[n,y]=N.useState(null),[l,t]=N.useState("all"),[p,v]=N.useState("all"),[a,h]=N.useState("all"),[u,O]=N.useState("");N.useEffect(()=>{let j=null;return(()=>{j=J(P=>{g(P||[]),m(!1)})})(),()=>{j&&j()}},[]),N.useEffect(()=>{const j=async()=>{const L=await K();L.success&&o(L.data)};x.length>0&&j()},[x]);const E=x.filter(j=>{const L=!u||j.name?.toLowerCase().includes(u.toLowerCase())||j.taxId?.toLowerCase().includes(u.toLowerCase())||j.contactPerson?.toLowerCase().includes(u.toLowerCase())||j.city?.toLowerCase().includes(u.toLowerCase()),P=l==="all"||(l==="preferred"?j.isPreferred:j.status===l),D=p==="all"||j.category===p,T=a==="all"||j.fuelTypes&&j.fuelTypes.includes(a);return L&&P&&D&&T}),q=()=>{if(!s("canManageSuppliers")){d("No tienes permisos para agregar proveedores");return}y(null),c(!0)},M=j=>{if(!s("canManageSuppliers")){d("No tienes permisos para editar proveedores");return}y(j),c(!0)},R=async(j,L)=>{if(!s("canManageSuppliers")){d("No tienes permisos para eliminar proveedores");return}if(window.confirm(`¬øEst√°s seguro de que deseas desactivar el proveedor "${L}"?

Esta acci√≥n se puede revertir cambiando su estado a activo.`))try{const P=await Q(j,f?.email);P.success?d(null):d(P.error||"Error al desactivar proveedor")}catch(P){console.error("Error deleting supplier:",P),d("Error inesperado al eliminar proveedor")}},_=()=>{c(!1),y(null),d(null)},V=()=>{c(!1),y(null),d(null)},F=()=>{t("all"),v("all"),h("all"),O("")},z=()=>{if(!s("canExportReports")){d("No tienes permisos para exportar datos");return}try{const j=E.map(C=>({Nombre:C.name,"NIT/Documento":C.taxId,Tipo:C.type,Categor√≠a:C.category,"Persona de Contacto":C.contactPerson,Tel√©fono:C.phone,Email:C.email,Ciudad:C.city,Combustibles:C.fuelTypes?.join(", "),Rating:C.rating,Estado:C.status,Preferido:C.isPreferred?"S√≠":"No","Fecha Creaci√≥n":C.createdAt?.toDate?.()?.toLocaleDateString()||"N/A"})),L=[Object.keys(j[0]).join(","),...j.map(C=>Object.values(C).map(G=>`"${G||""}"`).join(","))].join(`
`),P=new Blob([L],{type:"text/csv;charset=utf-8;"}),D=document.createElement("a"),T=URL.createObjectURL(P);D.setAttribute("href",T),D.setAttribute("download",`proveedores_${new Date().toISOString().split("T")[0]}.csv`),D.style.visibility="hidden",document.body.appendChild(D),D.click(),document.body.removeChild(D)}catch(j){console.error("Error exporting suppliers:",j),d("Error al exportar proveedores")}};return i?e.jsx("div",{className:"suppliers-main",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Cargando proveedores..."})]})}):e.jsxs("div",{className:"suppliers-main",children:[e.jsxs("div",{className:"suppliers-header",children:[e.jsxs("div",{className:"header-content",children:[e.jsx("h1",{children:"Gesti√≥n de Proveedores"}),e.jsx("p",{className:"header-subtitle",children:"Administra los proveedores de combustibles y materiales"})]}),e.jsxs("div",{className:"header-actions",children:[s("canManageSuppliers")&&e.jsxs("button",{className:"btn btn-primary",onClick:q,children:[e.jsx("i",{className:"icon-plus"}),"Agregar Proveedor"]}),s("canExportReports")&&e.jsxs("button",{className:"btn btn-secondary",onClick:z,disabled:E.length===0,children:[e.jsx("i",{className:"icon-download"}),"Exportar"]})]})]}),k&&e.jsxs("div",{className:"alert alert-error",children:[e.jsx("i",{className:"icon-alert-circle"}),e.jsx("span",{children:k}),e.jsx("button",{onClick:()=>d(null),className:"alert-close",children:e.jsx("i",{className:"icon-x"})})]}),b&&e.jsx(ee,{stats:b,suppliersCount:E.length,totalSuppliers:x.length}),e.jsx(se,{searchTerm:u,setSearchTerm:O,filterStatus:l,setFilterStatus:t,filterCategory:p,setFilterCategory:v,filterFuelType:a,setFilterFuelType:h,viewMode:r,setViewMode:S,onClearFilters:F,resultsCount:E.length}),E.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:e.jsx("i",{className:"icon-truck"})}),e.jsx("h3",{children:"No hay proveedores"}),e.jsx("p",{children:x.length===0?"Comienza agregando tu primer proveedor de combustibles.":"No se encontraron proveedores que coincidan con los filtros aplicados."}),x.length===0&&s("canManageSuppliers")&&e.jsxs("button",{className:"btn btn-primary",onClick:q,children:[e.jsx("i",{className:"icon-plus"}),"Agregar Primer Proveedor"]}),x.length>0&&e.jsxs("button",{className:"btn btn-secondary",onClick:F,children:[e.jsx("i",{className:"icon-filter-x"}),"Limpiar Filtros"]})]}):e.jsx("div",{className:"suppliers-content",children:r==="cards"?e.jsx(X,{suppliers:E,onEdit:M,onDelete:R,hasEditPermission:s("canManageSuppliers"),hasDeletePermission:s("canManageSuppliers")}):e.jsx(W,{suppliers:E,onEdit:M,onDelete:R,hasEditPermission:s("canManageSuppliers"),hasDeletePermission:s("canManageSuppliers")})}),w&&e.jsx(Z,{supplier:n,onClose:_,onSuccess:V,onError:d})]})};export{ce as default};
