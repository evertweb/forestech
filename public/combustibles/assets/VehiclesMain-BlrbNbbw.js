const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DFx8MrHh.js","assets/index-DtEL_iC7.css"])))=>i.map(i=>d[i]);
import{V as y,j as e,f as B,I as O,r as v,J as ae,K as $,L as se,k as K,b as z,N as te,P as ue,_ as re,i as he,d as ne,Q as xe,T as le,s as Y,e as pe,h as je,U as ie,W as Ne,X as Q,Y as ge,Z,u as ve,$ as fe,a0 as be,a1 as Ce,a2 as ye}from"./index-DFx8MrHh.js";const we=({stats:t,filters:m})=>{if(!t)return null;const n=x=>`${B(x)} gal`,i=x=>`${B(x)} hrs`,p=x=>`${x.toFixed(2)} gal/hr`,o=x=>{let N=0;for(let j=0;j<x.length;j++)N=(N<<5)-N+x.charCodeAt(j)&4294967295;const w=["#059669","#dc2626","#2563eb","#7c3aed","#ea580c","#16a34a","#ca8a04","#9333ea"];return w[Math.abs(N)%w.length]},C=x=>{if(!x)return"🚗";const N=x.toLowerCase();return N.includes("excavadora")?"🚚":N.includes("bulldozer")?"🚜":N.includes("cargador")?"🏗️":N.includes("camion")?"🚛":N.includes("grua")?"🏗️":N.includes("motosierra")?"🪚":N.includes("tractor")?"🚜":N.includes("volqueta")?"🚛":"🚗"},f=x=>{switch(x){case y.ACTIVO:return"#10b981";case y.MANTENIMIENTO:return"#f59e0b";case y.INACTIVO:return"#6b7280";case y.REPARACION:return"#ef4444";default:return"#6b7280"}},l=x=>{switch(x){case y.ACTIVO:return"✅";case y.MANTENIMIENTO:return"🔧";case y.INACTIVO:return"⏸️";case y.REPARACION:return"🔴";default:return"❓"}},I=x=>{switch(x){case O.DIESEL:return"🚛";case O.GASOLINA:return"🚗";case O.ACPM:return"🚚";case O.MIXTO:return"⛽";default:return"⛽"}},u=t.totalVehicles>0?((t.byStatus[y.ACTIVO]||0)/t.totalVehicles*100).toFixed(1):0;return e.jsxs("div",{className:"vehicles-stats",children:[e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card primary",children:[e.jsx("div",{className:"stat-icon",children:"🚜"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:B(t.totalVehicles)}),e.jsx("div",{className:"stat-label",children:"Total Vehículos"}),e.jsx("div",{className:"stat-trend",children:e.jsxs("span",{className:`trend ${u>=80?"positive":"warning"}`,children:[u>=80?"📈":"⚠️"," ",u,"% activos"]})})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"⛽"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:n(t.totalFuelConsumed)}),e.jsx("div",{className:"stat-label",children:"Combustible Consumido"}),e.jsxs("div",{className:"stat-secondary",children:["Promedio: ",p(t.averageConsumption||0)]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"⏰"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:i(t.totalHoursWorked)}),e.jsx("div",{className:"stat-label",children:"Horas Trabajadas"}),e.jsxs("div",{className:"stat-secondary",children:["Promedio: ",i(t.totalHoursWorked/(t.totalVehicles||1))]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"🏆"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:t.mostActiveVehicle?t.mostActiveVehicle.vehicleId:"N/A"}),e.jsx("div",{className:"stat-label",children:"Más Activo"}),e.jsx("div",{className:"stat-secondary",children:t.mostActiveVehicle?`${t.mostActiveVehicle.totalMovements||0} movimientos`:"Sin datos"})]})]})]}),e.jsxs("div",{className:"stats-breakdown",children:[e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h4",{children:"🚜 Por Tipo de Vehículo"}),e.jsx("div",{className:"breakdown-grid",children:Object.entries(t.byType).map(([x,N])=>{const w=(N/t.totalVehicles*100).toFixed(1);return e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-header",children:[e.jsx("span",{className:"breakdown-icon",children:C(x)}),e.jsx("span",{className:"breakdown-label",children:x.charAt(0).toUpperCase()+x.slice(1)})]}),e.jsx("div",{className:"breakdown-value",children:N}),e.jsx("div",{className:"breakdown-bar",children:e.jsx("div",{className:"breakdown-fill",style:{width:`${w}%`,backgroundColor:o(x)}})}),e.jsxs("div",{className:"breakdown-percentage",children:[w,"%"]})]},x)})})]}),e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h4",{children:"⚡ Por Estado"}),e.jsx("div",{className:"breakdown-grid",children:Object.entries(t.byStatus).map(([x,N])=>{const w=(N/t.totalVehicles*100).toFixed(1);return e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-header",children:[e.jsx("span",{className:"breakdown-icon",children:l(x)}),e.jsx("span",{className:"breakdown-label",children:x.charAt(0).toUpperCase()+x.slice(1)})]}),e.jsx("div",{className:"breakdown-value",children:N}),e.jsx("div",{className:"breakdown-bar",children:e.jsx("div",{className:"breakdown-fill",style:{width:`${w}%`,backgroundColor:f(x)}})}),e.jsxs("div",{className:"breakdown-percentage",children:[w,"%"]})]},x)})})]}),e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h4",{children:"⛽ Por Tipo de Combustible"}),e.jsx("div",{className:"breakdown-grid",children:Object.entries(t.byFuelType).map(([x,N])=>{const w=(N/t.totalVehicles*100).toFixed(1);return e.jsxs("div",{className:"breakdown-item",children:[e.jsxs("div",{className:"breakdown-header",children:[e.jsx("span",{className:"breakdown-icon",children:I(x)}),e.jsx("span",{className:"breakdown-label",children:x})]}),e.jsx("div",{className:"breakdown-value",children:N}),e.jsx("div",{className:"breakdown-bar",children:e.jsx("div",{className:"breakdown-fill",style:{width:`${w}%`,backgroundColor:"#059669"}})}),e.jsxs("div",{className:"breakdown-percentage",children:[w,"%"]})]},x)})})]})]}),(t.totalFuelConsumed>0||t.totalHoursWorked>0)&&e.jsxs("div",{className:"performance-metrics",children:[e.jsx("h4",{children:"📊 Métricas de Rendimiento"}),e.jsxs("div",{className:"metrics-grid",children:[e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",children:"⚡"}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"Eficiencia de Flota"}),e.jsxs("div",{className:"metric-value",children:[u,"%"]}),e.jsxs("div",{className:"metric-description",children:[t.byStatus[y.ACTIVO]||0," de ",t.totalVehicles," activos"]})]})]}),t.averageConsumption>0&&e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",children:"📈"}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"Consumo Promedio"}),e.jsx("div",{className:"metric-value",children:p(t.averageConsumption)}),e.jsx("div",{className:"metric-description",children:"Por vehículo por hora trabajada"})]})]}),t.mostActiveVehicle&&e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",children:"🏆"}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"Mayor Utilización"}),e.jsx("div",{className:"metric-value",children:t.mostActiveVehicle.vehicleId}),e.jsxs("div",{className:"metric-description",children:[n(t.mostActiveVehicle.totalFuelConsumed||0)," consumidos"]})]})]}),t.leastActiveVehicle&&e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",children:"📉"}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-label",children:"Menor Utilización"}),e.jsx("div",{className:"metric-value",children:t.leastActiveVehicle.vehicleId}),e.jsxs("div",{className:"metric-description",children:[n(t.leastActiveVehicle.totalFuelConsumed||0)," consumidos"]})]})]})]})]}),(m.type||m.status||m.fuelType||m.location)&&e.jsxs("div",{className:"active-filters",children:[e.jsx("h4",{children:"🔍 Filtros Activos"}),e.jsxs("div",{className:"filters-list",children:[m.type&&e.jsxs("span",{className:"filter-tag",children:["Tipo: ",m.type]}),m.status&&e.jsxs("span",{className:"filter-tag",children:["Estado: ",m.status]}),m.fuelType&&e.jsxs("span",{className:"filter-tag",children:["Combustible: ",m.fuelType]}),m.location&&e.jsxs("span",{className:"filter-tag",children:["Ubicación: ",m.location]})]})]})]})},De=({filters:t,onFilterChange:m,onClearFilters:n,searchTerm:i,onSearchChange:p,viewMode:o,onViewModeChange:C,totalResults:f})=>{const[l,I]=v.useState(!1),u=["Oficina Principal","Bodega Norte","Bodega Sur","Campo Operativo","Taller Mecánico","Proyecto A","Proyecto B","En Reparación","Otros"],x=Object.values(t).filter(j=>j&&j!==""&&j!=="all").length,N=(j,b)=>{m({[j]:b})},w=j=>{m(j)};return e.jsxs("div",{className:"vehicles-filters",children:[e.jsxs("div",{className:"filters-main",children:[e.jsx("div",{className:"search-section",children:e.jsxs("div",{className:"search-box",children:[e.jsx("span",{className:"search-icon",children:"🔍"}),e.jsx("input",{type:"text",placeholder:"Buscar por ID, nombre, marca, modelo, ubicación...",value:i,onChange:j=>p(j.target.value),className:"search-input"}),i&&e.jsx("button",{className:"search-clear",onClick:()=>p(""),title:"Limpiar búsqueda",children:"✕"})]})}),e.jsxs("div",{className:"filters-controls",children:[e.jsxs("div",{className:"quick-filters",children:[e.jsx("button",{className:`quick-filter ${t.status==="activo"?"active":""}`,onClick:()=>w({status:"activo"}),children:"✅ Activos"}),e.jsx("button",{className:`quick-filter ${t.status==="mantenimiento"?"active":""}`,onClick:()=>w({status:"mantenimiento"}),children:"🔧 Mantenimiento"}),e.jsx("button",{className:`quick-filter ${t.type==="excavadora"?"active":""}`,onClick:()=>w({type:"excavadora"}),children:"🚚 Excavadoras"}),e.jsx("button",{className:`quick-filter ${t.type==="tractor"?"active":""}`,onClick:()=>w({type:"tractor"}),children:"🚜 Tractores"})]}),e.jsxs("button",{className:`btn-advanced-filters ${l?"active":""}`,onClick:()=>I(!l),children:["🎛️ Filtros",x>0&&e.jsx("span",{className:"filters-count",children:x})]}),e.jsxs("div",{className:"view-modes",children:[e.jsx("button",{className:`view-mode ${o==="cards"?"active":""}`,onClick:()=>C("cards"),title:"Vista en tarjetas",children:"🎴"}),e.jsx("button",{className:`view-mode ${o==="table"?"active":""}`,onClick:()=>C("table"),title:"Vista en tabla",children:"📋"})]})]})]}),l&&e.jsxs("div",{className:"filters-advanced",children:[e.jsxs("div",{className:"filters-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Tipo de Vehículo"}),e.jsxs("select",{value:t.type,onChange:j=>N("type",j.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"Todos los tipos"}),e.jsx("option",{value:"excavadora",children:"🚚 Excavadora"}),e.jsx("option",{value:"bulldozer",children:"🚜 Bulldozer"}),e.jsx("option",{value:"cargador",children:"🏗️ Cargador"}),e.jsx("option",{value:"camion",children:"🚛 Camión"}),e.jsx("option",{value:"grua",children:"🏗️ Grúa"}),e.jsx("option",{value:"motosierra",children:"🪚 Motosierra"}),e.jsx("option",{value:"tractor",children:"🚜 Tractor"}),e.jsx("option",{value:"volqueta",children:"🚛 Volqueta"}),e.jsx("option",{value:"otros",children:"🚗 Otros"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Estado"}),e.jsxs("select",{value:t.status,onChange:j=>N("status",j.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:y.ACTIVO,children:"✅ Activo"}),e.jsx("option",{value:y.MANTENIMIENTO,children:"🔧 Mantenimiento"}),e.jsx("option",{value:y.INACTIVO,children:"⏸️ Inactivo"}),e.jsx("option",{value:y.REPARACION,children:"🔴 Reparación"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Tipo de Combustible"}),e.jsxs("select",{value:t.fuelType,onChange:j=>N("fuelType",j.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"Todos los combustibles"}),e.jsx("option",{value:O.DIESEL,children:"🚛 Diesel"}),e.jsx("option",{value:O.GASOLINA,children:"🚗 Gasolina"}),e.jsx("option",{value:O.ACPM,children:"🚚 ACPM"}),e.jsx("option",{value:O.MIXTO,children:"⛽ Mixto"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Ubicación Actual"}),e.jsxs("select",{value:t.location,onChange:j=>N("location",j.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"Todas las ubicaciones"}),u.map(j=>e.jsxs("option",{value:j,children:["📍 ",j]},j))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Mantenimiento"}),e.jsxs("select",{value:t.maintenance,onChange:j=>N("maintenance",j.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"Todos"}),e.jsx("option",{value:"due",children:"Mantenimiento debido"}),e.jsx("option",{value:"overdue",children:"Mantenimiento vencido"}),e.jsx("option",{value:"recent",children:"Mantenimiento reciente"})]})]})]}),e.jsxs("div",{className:"filters-actions",children:[e.jsx("button",{className:"btn-clear-filters",onClick:n,disabled:x===0,children:"🗑️ Limpiar Filtros"}),e.jsxs("div",{className:"filters-info",children:[e.jsxs("span",{className:"results-count",children:[f," resultado",f!==1?"s":""]}),x>0&&e.jsxs("span",{className:"active-filters-text",children:["(",x," filtro",x!==1?"s":""," activo",x!==1?"s":"",")"]})]})]})]}),x>0&&e.jsx("div",{className:"active-filters-summary",children:e.jsxs("div",{className:"summary-content",children:[e.jsx("span",{className:"summary-label",children:"Filtros activos:"}),e.jsxs("div",{className:"summary-tags",children:[t.type&&e.jsxs("span",{className:"summary-tag",onClick:()=>N("type",""),children:["Tipo: ",t.type," ✕"]}),t.status&&e.jsxs("span",{className:"summary-tag",onClick:()=>N("status",""),children:["Estado: ",t.status," ✕"]}),t.fuelType&&e.jsxs("span",{className:"summary-tag",onClick:()=>N("fuelType",""),children:["Combustible: ",t.fuelType," ✕"]}),t.location&&e.jsxs("span",{className:"summary-tag",onClick:()=>N("location",""),children:["Ubicación: ",t.location," ✕"]}),t.maintenance!=="all"&&e.jsxs("span",{className:"summary-tag",onClick:()=>N("maintenance","all"),children:["Mantenimiento: ",t.maintenance," ✕"]})]})]})}),e.jsx("div",{className:"keyboard-shortcuts",style:{display:"none"},children:e.jsx("small",{children:"💡 Atajos: Ctrl+F (buscar), Ctrl+1 (activos), Ctrl+2 (mantenimiento), Ctrl+T (tractores)"})})]})},Ee=({vehicles:t,onEdit:m,onView:n,onMaintenance:i})=>{const p=s=>new Intl.NumberFormat("es-CO").format(s),o=s=>`${p(s)} gal`,C=s=>`${p(s)} hrs`,f=s=>s?(s instanceof Date?s:new Date(s)).toLocaleDateString("es-CO",{day:"2-digit",month:"2-digit",year:"numeric"}):"Sin fecha",l=s=>{if(!s)return"";const g=new Date,c=s instanceof Date?s:new Date(s),V=Math.abs(g-c),k=Math.ceil(V/(1e3*60*60*24));return k===1?"hace 1 día":k<7?`hace ${k} días`:k<30?`hace ${Math.ceil(k/7)} semanas`:k<365?`hace ${Math.ceil(k/30)} meses`:`hace ${Math.ceil(k/365)} años`},I=s=>{if(!s)return"vehicle-default";const g=s.toLowerCase();return g.includes("excavadora")?"vehicle-excavadora":g.includes("bulldozer")?"vehicle-bulldozer":g.includes("cargador")?"vehicle-cargador":g.includes("camion")?"vehicle-camion":g.includes("grua")?"vehicle-grua":g.includes("motosierra")?"vehicle-motosierra":g.includes("tractor")?"vehicle-tractor":g.includes("volqueta")?"vehicle-volqueta":"vehicle-default"},u=s=>{switch(s){case y.ACTIVO:return"status-activo";case y.MANTENIMIENTO:return"status-mantenimiento";case y.INACTIVO:return"status-inactivo";case y.REPARACION:return"status-reparacion";default:return"status-default"}},x=s=>{if(!s)return"🚗";const g=s.toLowerCase();return g.includes("excavadora")?"🚚":g.includes("bulldozer")?"🚜":g.includes("cargador")?"🏗️":g.includes("camion")?"🚛":g.includes("grua")?"🏗️":g.includes("motosierra")?"🪚":g.includes("tractor")?"🚜":g.includes("volqueta")?"🚛":"🚗"},N=s=>{switch(s){case O.DIESEL:return"🚛";case O.GASOLINA:return"🚗";case O.ACPM:return"🚚";case O.MIXTO:return"⛽";default:return"⛽"}},w=s=>{switch(s){case y.ACTIVO:return"✅";case y.MANTENIMIENTO:return"🔧";case y.INACTIVO:return"⏸️";case y.REPARACION:return"🔴";default:return"❓"}},j=s=>!s.totalHoursWorked||s.totalHoursWorked===0?s.estimatedConsumptionPerHour||0:s.totalFuelConsumed/s.totalHoursWorked,b=s=>s.lastMaintenanceDate?Math.floor((new Date-new Date(s.lastMaintenanceDate))/(1e3*60*60*24))>90:!0;return e.jsx("div",{className:"vehicles-cards",children:t.map(s=>e.jsxs("div",{className:`vehicle-card ${I(s.type)}`,children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"vehicle-info",children:[e.jsxs("div",{className:"vehicle-id-section",children:[e.jsx("span",{className:"vehicle-icon",children:x(s.type)}),e.jsxs("div",{className:"vehicle-details",children:[e.jsx("span",{className:"vehicle-id",children:s.vehicleId}),e.jsx("span",{className:"vehicle-name",children:s.name})]})]}),e.jsxs("div",{className:`status-badge ${u(s.status)}`,children:[e.jsx("span",{className:"status-icon",children:w(s.status)}),e.jsx("span",{className:"status-label",children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})]})]})}),e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"basic-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Tipo:"}),e.jsxs("span",{className:"info-value",children:[x(s.type)," ",s.type.charAt(0).toUpperCase()+s.type.slice(1)]})]}),s.brand&&s.model&&e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Marca/Modelo:"}),e.jsxs("span",{className:"info-value",children:[s.brand," ",s.model]})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Combustible:"}),e.jsxs("span",{className:"info-value",children:[N(s.fuelType)," ",s.fuelType]})]}),s.currentLocation&&e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Ubicación:"}),e.jsxs("span",{className:"info-value",children:["📍 ",s.currentLocation]})]})]}),e.jsxs("div",{className:"consumption-metrics",children:[e.jsxs("div",{className:"metric-item",children:[e.jsx("div",{className:"metric-icon",children:"⛽"}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-value",children:o(s.totalFuelConsumed||0)}),e.jsx("div",{className:"metric-label",children:"Consumido"})]})]}),e.jsxs("div",{className:"metric-item",children:[e.jsx("div",{className:"metric-icon",children:"⏰"}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-value",children:C(s.totalHoursWorked||0)}),e.jsx("div",{className:"metric-label",children:"Trabajadas"})]})]}),e.jsxs("div",{className:"metric-item",children:[e.jsx("div",{className:"metric-icon",children:"📊"}),e.jsxs("div",{className:"metric-content",children:[e.jsxs("div",{className:"metric-value",children:[j(s).toFixed(1)," gal/hr"]}),e.jsx("div",{className:"metric-label",children:"Consumo"})]})]}),e.jsxs("div",{className:"metric-item",children:[e.jsx("div",{className:"metric-icon",children:"🔄"}),e.jsxs("div",{className:"metric-content",children:[e.jsx("div",{className:"metric-value",children:s.totalMovements||0}),e.jsx("div",{className:"metric-label",children:"Movimientos"})]})]})]}),(s.enginePower||s.fuelCapacity||s.year)&&e.jsxs("div",{className:"technical-specs",children:[s.enginePower&&e.jsxs("div",{className:"spec-item",children:[e.jsx("span",{className:"spec-icon",children:"⚡"}),e.jsxs("span",{className:"spec-value",children:[s.enginePower," HP"]})]}),s.fuelCapacity&&e.jsxs("div",{className:"spec-item",children:[e.jsx("span",{className:"spec-icon",children:"🛢️"}),e.jsxs("span",{className:"spec-value",children:[s.fuelCapacity," gal"]})]}),s.year&&e.jsxs("div",{className:"spec-item",children:[e.jsx("span",{className:"spec-icon",children:"📅"}),e.jsx("span",{className:"spec-value",children:s.year})]})]}),s.description&&e.jsx("div",{className:"description",children:e.jsx("p",{children:s.description})})]}),e.jsxs("div",{className:"card-footer",children:[e.jsxs("div",{className:"date-info",children:[s.lastMovementDate&&e.jsxs("div",{className:"date-item",children:[e.jsx("span",{className:"date-label",children:"Último movimiento:"}),e.jsx("span",{className:"date-value",children:f(s.lastMovementDate)}),e.jsx("span",{className:"date-relative",children:l(s.lastMovementDate)})]}),s.lastMaintenanceDate&&e.jsxs("div",{className:"date-item",children:[e.jsx("span",{className:"date-label",children:"Último mantenimiento:"}),e.jsx("span",{className:"date-value",children:f(s.lastMaintenanceDate)}),e.jsx("span",{className:"date-relative",children:l(s.lastMaintenanceDate)})]})]}),e.jsxs("div",{className:"card-actions",children:[e.jsx("button",{className:"btn-view",onClick:()=>n(s),title:"Ver detalles",children:"👁️"}),m&&s.status!==y.REPARACION&&e.jsx("button",{className:"btn-edit",onClick:()=>m(s),title:"Editar vehículo",children:"✏️"}),i&&e.jsx("button",{className:"btn-maintenance",onClick:()=>i(s),title:"Registrar mantenimiento",children:"🔧"})]})]}),s.status===y.MANTENIMIENTO&&e.jsx("div",{className:"maintenance-indicator",children:e.jsx("div",{className:"maintenance-pulse"})}),b(s)&&s.status===y.ACTIVO&&e.jsx("div",{className:"maintenance-due-badge",children:e.jsx("span",{children:"Mantenimiento Debido"})}),s.status===y.REPARACION&&e.jsx("div",{className:"repair-badge",children:e.jsx("span",{children:"En Reparación"})}),s.totalHoursWorked>0&&e.jsxs("div",{className:"efficiency-indicator",children:[e.jsx("div",{className:"efficiency-bar",children:e.jsx("div",{className:"efficiency-fill",style:{width:`${Math.min(s.totalHoursWorked/2e3*100,100)}%`}})}),e.jsxs("span",{className:"efficiency-label",children:[(s.totalHoursWorked/2e3*100).toFixed(1),"% utilización anual"]})]})]},s.id))})},Ae=({vehicles:t,onEdit:m,onView:n,onMaintenance:i})=>{const[p,o]=v.useState("vehicleId"),[C,f]=v.useState("asc"),l=d=>new Intl.NumberFormat("es-CO").format(d),I=d=>`${l(d)} gal`,u=d=>`${l(d)} hrs`,x=d=>d?(d instanceof Date?d:new Date(d)).toLocaleDateString("es-CO",{day:"2-digit",month:"2-digit",year:"2-digit"}):"-",N=d=>{if(!d)return"🚗";const D=d.toLowerCase();return D.includes("excavadora")?"🚚":D.includes("bulldozer")?"🚜":D.includes("cargador")?"🏗️":D.includes("camion")?"🚛":D.includes("grua")?"🏗️":D.includes("motosierra")?"🪚":D.includes("tractor")?"🚜":D.includes("volqueta")?"🚛":"🚗"},w=d=>{switch(d){case O.DIESEL:return"🚛";case O.GASOLINA:return"🚗";case O.ACPM:return"🚚";case O.MIXTO:return"⛽";default:return"⛽"}},j=d=>{switch(d){case y.ACTIVO:return"✅";case y.MANTENIMIENTO:return"🔧";case y.INACTIVO:return"⏸️";case y.REPARACION:return"🔴";default:return"❓"}},b=d=>{switch(d){case y.ACTIVO:return"status-activo";case y.MANTENIMIENTO:return"status-mantenimiento";case y.INACTIVO:return"status-inactivo";case y.REPARACION:return"status-reparacion";default:return"status-default"}},s=d=>{p===d?f(C==="asc"?"desc":"asc"):(o(d),f("asc"))},g=[...t].sort((d,D)=>{let T=d[p],M=D[p];return(p.includes("Date")||p.includes("At"))&&(T=new Date(T||0),M=new Date(M||0)),typeof T=="number"&&typeof M=="number"?C==="asc"?T-M:M-T:typeof T=="string"&&typeof M=="string"?C==="asc"?T.localeCompare(M):M.localeCompare(T):T instanceof Date&&M instanceof Date?C==="asc"?T-M:M-T:!T&&!M?0:T?M?0:C==="asc"?-1:1:C==="asc"?1:-1}),c=d=>p!==d?"↕️":C==="asc"?"↑":"↓",V=d=>!d.totalHoursWorked||d.totalHoursWorked===0?d.estimatedConsumptionPerHour||0:d.totalFuelConsumed/d.totalHoursWorked,k=d=>d.lastMaintenanceDate?Math.floor((new Date-new Date(d.lastMaintenanceDate))/(1e3*60*60*24))>90:!0;return e.jsxs("div",{className:"vehicles-table-container",children:[e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"vehicles-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{className:"sortable",onClick:()=>s("vehicleId"),children:["ID Vehículo ",c("vehicleId")]}),e.jsxs("th",{className:"sortable",onClick:()=>s("name"),children:["Nombre ",c("name")]}),e.jsxs("th",{className:"sortable",onClick:()=>s("type"),children:["Tipo ",c("type")]}),e.jsx("th",{children:"Marca/Modelo"}),e.jsxs("th",{className:"sortable",onClick:()=>s("fuelType"),children:["Combustible ",c("fuelType")]}),e.jsxs("th",{className:"sortable text-right",onClick:()=>s("totalFuelConsumed"),children:["Consumido ",c("totalFuelConsumed")]}),e.jsxs("th",{className:"sortable text-right",onClick:()=>s("totalHoursWorked"),children:["Horas ",c("totalHoursWorked")]}),e.jsx("th",{className:"text-right",children:"Consumo/Hr"}),e.jsx("th",{children:"Ubicación"}),e.jsxs("th",{className:"sortable",onClick:()=>s("status"),children:["Estado ",c("status")]}),e.jsxs("th",{className:"sortable",onClick:()=>s("lastMovementDate"),children:["Último Mov. ",c("lastMovementDate")]}),e.jsx("th",{className:"actions-column",children:"Acciones"})]})}),e.jsx("tbody",{children:g.map(d=>e.jsxs("tr",{className:`vehicle-row ${d.status===y.MANTENIMIENTO?"maintenance-row":""} ${k(d)?"needs-maintenance":""}`,children:[e.jsx("td",{className:"vehicle-id-cell",children:e.jsxs("div",{className:"id-content",children:[e.jsx("span",{className:"vehicle-icon",children:N(d.type)}),e.jsx("span",{className:"vehicle-id",children:d.vehicleId})]})}),e.jsx("td",{className:"name-cell",children:e.jsx("span",{className:"vehicle-name",children:d.name})}),e.jsx("td",{className:"type-cell",children:e.jsx("span",{className:"type-text",children:d.type.charAt(0).toUpperCase()+d.type.slice(1)})}),e.jsx("td",{className:"brand-model-cell",children:d.brand&&d.model?e.jsxs("span",{className:"brand-model",children:[d.brand," ",d.model]}):e.jsx("span",{className:"no-data",children:"-"})}),e.jsx("td",{className:"fuel-cell",children:e.jsxs("div",{className:"fuel-content",children:[e.jsx("span",{className:"fuel-icon",children:w(d.fuelType)}),e.jsx("span",{className:"fuel-text",children:d.fuelType})]})}),e.jsx("td",{className:"consumption-cell text-right",children:e.jsx("span",{className:"consumption-value",children:I(d.totalFuelConsumed||0)})}),e.jsx("td",{className:"hours-cell text-right",children:e.jsx("span",{className:"hours-value",children:u(d.totalHoursWorked||0)})}),e.jsx("td",{className:"rate-cell text-right",children:e.jsxs("span",{className:"rate-value",children:[V(d).toFixed(1)," gal/hr"]})}),e.jsx("td",{className:"location-cell",children:e.jsxs("span",{className:"location-text",children:["📍 ",d.currentLocation||"Sin ubicación"]})}),e.jsx("td",{className:"status-cell",children:e.jsxs("div",{className:`status-badge ${b(d.status)}`,children:[e.jsx("span",{className:"status-icon",children:j(d.status)}),e.jsx("span",{className:"status-text",children:d.status.charAt(0).toUpperCase()+d.status.slice(1)})]})}),e.jsx("td",{className:"date-cell",children:e.jsxs("div",{className:"date-content",children:[e.jsx("span",{className:"date-value",children:x(d.lastMovementDate)}),k(d)&&e.jsx("span",{className:"maintenance-warning",children:"⚠️"})]})}),e.jsx("td",{className:"actions-cell",children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn-action btn-view",onClick:()=>n(d),title:"Ver detalles",children:"👁️"}),m&&d.status!==y.REPARACION&&e.jsx("button",{className:"btn-action btn-edit",onClick:()=>m(d),title:"Editar vehículo",children:"✏️"}),i&&e.jsx("button",{className:"btn-action btn-maintenance",onClick:()=>i(d),title:"Registrar mantenimiento",children:"🔧"})]})})]},d.id))})]})}),e.jsxs("div",{className:"table-info",children:[e.jsxs("div",{className:"table-summary",children:[e.jsxs("span",{className:"total-rows",children:[t.length," vehículo",t.length!==1?"s":""]}),p&&e.jsxs("span",{className:"sort-info",children:["Ordenado por ",p," (",C==="asc"?"ascendente":"descendente",")"]})]}),e.jsxs("div",{className:"table-legend",children:[e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-icon",children:"✅"})," Activo"]}),e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-icon",children:"🔧"})," Mantenimiento"]}),e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-icon",children:"⏸️"})," Inactivo"]}),e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-icon",children:"🔴"})," Reparación"]}),e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-icon",children:"⚠️"})," Mantto. Debido"]})]})]})]})},Te=({vehicles:t,viewMode:m,onEdit:n,onView:i,onMaintenance:p})=>m==="table"?e.jsx(Ae,{vehicles:t,onEdit:n,onView:i,onMaintenance:p}):e.jsx(Ee,{vehicles:t,onEdit:n,onView:i,onMaintenance:p}),W="combustibles_vehicle_categories",Ie=async t=>{try{const m=le(t);if(!m.isValid)throw new Error(`Datos inválidos: ${m.errors.join(", ")}`);const n=await ce();if(n.some(C=>C.id===t.id||C.name.toLowerCase()===t.name.toLowerCase()))throw new Error("Ya existe una categoría con ese nombre o ID");t.id||(t.id=ie(t.name,n));const p={...t,createdAt:Y(),updatedAt:Y(),isCustom:!0,vehicleCount:0},o=await Ne(K(z,W),p);return console.log("✅ Categoría creada:",t.name),{id:o.id,...p,createdAt:new Date,updatedAt:new Date}}catch(m){throw console.error("❌ Error al crear categoría:",m),new Error(`Error al crear categoría: ${m.message}`)}},ce=async()=>{try{const t=se(K(z,W),te("name","asc")),m=await he(t),n=[];return m.forEach(i=>{n.push({id:i.id,...i.data(),createdAt:i.data().createdAt?.toDate?.()||i.data().createdAt,updatedAt:i.data().updatedAt?.toDate?.()||i.data().updatedAt})}),n}catch(t){throw console.error("❌ Error al obtener categorías personalizadas:",t),new Error(`Error al obtener categorías: ${t.message}`)}},X=async()=>{try{const t=await ce();return ae(t)}catch(t){return console.error("❌ Error al obtener todas las categorías:",t),$}},Me=async(t,m)=>{try{if(!t)throw new Error("ID de categoría requerido");if($.some(C=>C.id===t))throw new Error("No se pueden modificar las categorías predeterminadas");if(m.name||m.fuelTypes||m.fields){const C=le({...m,id:t});if(!C.isValid)throw new Error(`Datos inválidos: ${C.errors.join(", ")}`)}const i={...m,updatedAt:Y()},p=ne(z,W,t);await pe(p,i),console.log("✅ Categoría actualizada:",t);const o=await je(p);return{id:o.id,...o.data(),createdAt:o.data().createdAt?.toDate?.()||o.data().createdAt,updatedAt:o.data().updatedAt?.toDate?.()||o.data().updatedAt}}catch(n){throw console.error("❌ Error al actualizar categoría:",n),new Error(`Error al actualizar categoría: ${n.message}`)}},Se=async t=>{try{if(!t)throw new Error("ID de categoría requerido");if($.some(o=>o.id===t))throw new Error("No se pueden eliminar las categorías predeterminadas");const{countVehiclesByCategory:n}=await re(async()=>{const{countVehiclesByCategory:o}=await import("./index-DFx8MrHh.js").then(C=>C.ar);return{countVehiclesByCategory:o}},__vite__mapDeps([0,1])),i=await n(t);if(i>0)throw new Error(`No se puede eliminar la categoría porque tiene ${i} vehículo(s) asignado(s)`);const p=ne(z,W,t);return await xe(p),console.log("✅ Categoría eliminada:",t),!0}catch(m){throw console.error("❌ Error al eliminar categoría:",m),new Error(`Error al eliminar categoría: ${m.message}`)}},ke=t=>{try{const m=se(K(z,W),te("name","asc"));return ue(m,n=>{const i=[];n.forEach(o=>{i.push({id:o.id,...o.data(),createdAt:o.data().createdAt?.toDate?.()||o.data().createdAt,updatedAt:o.data().updatedAt?.toDate?.()||o.data().updatedAt})});const p=ae(i);t(p)},n=>{console.error("❌ Error en suscripción a categorías:",n),t($)})}catch(m){return console.error("❌ Error al suscribirse a categorías:",m),t($),()=>{}}},ee=async()=>{try{const{getAllVehicles:t}=await re(async()=>{const{getAllVehicles:i}=await import("./index-DFx8MrHh.js").then(p=>p.ar);return{getAllVehicles:i}},__vite__mapDeps([0,1])),m=await t();return(await X()).map(i=>{const p=m.filter(o=>o.category===i.id);return{...i,vehicleCount:p.length,activeVehicles:p.filter(o=>o.status==="activo").length,totalFuelCapacity:p.reduce((o,C)=>o+(C.fuelCapacity||0),0),avgEnginepower:p.length>0?p.reduce((o,C)=>o+(C.enginePower||0),0)/p.length:0}}).sort((i,p)=>p.vehicleCount-i.vehicleCount)}catch(t){return console.error("❌ Error al obtener estadísticas de categorías:",t),[]}},oe=({onClose:t,onCategoryCreated:m})=>{const[n,i]=v.useState([]),[p,o]=v.useState([]),[C,f]=v.useState(!0),[l,I]=v.useState(!1),[u,x]=v.useState(null),[N,w]=v.useState(!1),[j,b]=v.useState(""),[s,g]=v.useState({name:"",description:"",icon:"🚗",color:"#2E86AB",fuelTypes:[],fields:[]});v.useEffect(()=>{c();const a=ke(r=>{i(r),V()});return()=>a&&a()},[]);const c=async()=>{try{f(!0);const[a,r]=await Promise.all([X(),ee()]);i(a),o(r)}catch(a){console.error("Error cargando categorías:",a),b("Error al cargar categorías")}finally{f(!1)}},V=async()=>{try{const a=await ee();o(a)}catch(a){console.error("Error cargando estadísticas:",a)}},k=()=>{x(null),g({name:"",description:"",icon:"🚗",color:"#2E86AB",fuelTypes:[],fields:[]}),w(!0)},d=a=>{if($.some(r=>r.id===a.id)){b("No se pueden editar las categorías predeterminadas");return}x(a),g({name:a.name||"",description:a.description||"",icon:a.icon||"🚗",color:a.color||"#2E86AB",fuelTypes:a.fuelTypes||[],fields:a.fields||[]}),w(!0)},D=async a=>{if($.some(h=>h.id===a.id)){b("No se pueden eliminar las categorías predeterminadas");return}if(window.confirm(`¿Está seguro de eliminar la categoría "${a.name}"?

Esta acción no se puede deshacer.`))try{I(!0),await Se(a.id),b("")}catch(h){console.error("Error eliminando categoría:",h),b(h.message)}finally{I(!1)}},T=async a=>{if(a.preventDefault(),!s.name.trim()){b("El nombre de la categoría es requerido");return}try{I(!0),b("");const r={...s,name:s.name.trim(),description:s.description.trim()};if(u)await Me(u.id,r);else{r.id=ie(r.name,n);const h=await Ie(r);m&&m(h)}w(!1)}catch(r){console.error("Error guardando categoría:",r),b(r.message)}finally{I(!1)}},M=a=>{g(r=>({...r,fields:r.fields.includes(a)?r.fields.filter(h=>h!==a):[...r.fields,a]}))},L=a=>{g(r=>({...r,fuelTypes:r.fuelTypes.includes(a)?r.fuelTypes.filter(h=>h!==a):[...r.fuelTypes,a]}))},E=a=>p.find(r=>r.id===a)||{vehicleCount:0,activeVehicles:0};return C?e.jsx("div",{className:"categories-manager",children:e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Cargando categorías..."})]})}):e.jsxs("div",{className:"categories-manager",children:[e.jsxs("div",{className:"categories-header",children:[e.jsx("h3",{children:"📋 Gestión de Categorías"}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{className:"btn-primary",onClick:k,disabled:l,children:"➕ Nueva Categoría"}),e.jsx("button",{className:"btn-secondary",onClick:t,children:"✕ Cerrar"})]})]}),j&&e.jsxs("div",{className:"error-message",children:[e.jsxs("span",{children:["⚠️ ",j]}),e.jsx("button",{onClick:()=>b(""),children:"✕"})]}),e.jsx("div",{className:"categories-grid",children:n.map(a=>{const r=$.some(A=>A.id===a.id),h=E(a.id);return e.jsxs("div",{className:`category-card ${r?"default":"custom"}`,style:{"--category-color":a.color},children:[e.jsxs("div",{className:"category-header",children:[e.jsx("div",{className:"category-icon",style:{color:a.color},children:a.icon}),e.jsxs("div",{className:"category-info",children:[e.jsx("h4",{children:a.name}),e.jsx("p",{children:a.description})]}),r&&e.jsx("span",{className:"default-badge",children:"Predeterminada"})]}),e.jsxs("div",{className:"category-stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:h.vehicleCount}),e.jsx("span",{className:"stat-label",children:"Vehículos"})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:h.activeVehicles}),e.jsx("span",{className:"stat-label",children:"Activos"})]})]}),e.jsxs("div",{className:"category-details",children:[e.jsxs("div",{className:"fuel-types",children:[e.jsx("strong",{children:"Combustibles:"}),e.jsx("div",{className:"fuel-list",children:(a.fuelTypes||[]).map(A=>e.jsx("span",{className:"fuel-tag",children:A},A))})]}),e.jsxs("div",{className:"fields",children:[e.jsx("strong",{children:"Campos:"}),e.jsxs("div",{className:"fields-list",children:[(a.fields||[]).slice(0,3).map(A=>{const F=Q.find(H=>H.key===A);return F?e.jsxs("span",{className:"field-tag",children:[F.icon," ",F.label]},A):null}),(a.fields||[]).length>3&&e.jsxs("span",{className:"more-fields",children:["+",(a.fields||[]).length-3," más"]})]})]})]}),e.jsxs("div",{className:"category-actions",children:[e.jsx("button",{className:"btn-edit",onClick:()=>d(a),disabled:r||l,title:r?"No se pueden editar categorías predeterminadas":"Editar categoría",children:"✏️ Editar"}),e.jsx("button",{className:"btn-delete",onClick:()=>D(a),disabled:r||l||h.vehicleCount>0,title:r?"No se pueden eliminar categorías predeterminadas":h.vehicleCount>0?"No se puede eliminar una categoría con vehículos asignados":"Eliminar categoría",children:"🗑️ Eliminar"})]})]},a.id)})}),N&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:u?"✏️ Editar Categoría":"➕ Nueva Categoría"}),e.jsx("button",{onClick:()=>w(!1),children:"✕"})]}),e.jsxs("form",{onSubmit:T,className:"category-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{children:"Información Básica"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre *"}),e.jsx("input",{type:"text",value:s.name,onChange:a=>g(r=>({...r,name:a.target.value})),placeholder:"Ej: Maquinaria Pesada",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Icono"}),e.jsx("input",{type:"text",value:s.icon,onChange:a=>g(r=>({...r,icon:a.target.value})),placeholder:"🚗",className:"icon-input"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Descripción"}),e.jsx("textarea",{value:s.description,onChange:a=>g(r=>({...r,description:a.target.value})),placeholder:"Describe el tipo de vehículos que incluye esta categoría",rows:"2"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Color"}),e.jsx("input",{type:"color",value:s.color,onChange:a=>g(r=>({...r,color:a.target.value})),className:"color-input"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{children:"Tipos de Combustible Compatibles"}),e.jsx("div",{className:"fuel-types-grid",children:Object.values(ge).map(a=>e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s.fuelTypes.includes(a),onChange:()=>L(a)}),e.jsx("span",{children:a})]},a))})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{children:"Campos Específicos"}),e.jsx("p",{className:"section-description",children:"Selecciona los campos que serán relevantes para esta categoría"}),e.jsx("div",{className:"fields-grid",children:Q.map(a=>e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s.fields.includes(a.key),onChange:()=>M(a.key)}),e.jsxs("span",{children:[a.icon," ",a.label]})]},a.key))})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{children:"Vista Previa"}),e.jsx("div",{className:"category-preview",style:{"--category-color":s.color},children:e.jsxs("div",{className:"category-header",children:[e.jsx("div",{className:"category-icon",style:{color:s.color},children:s.icon}),e.jsxs("div",{className:"category-info",children:[e.jsx("h4",{children:s.name||"Nombre de la categoría"}),e.jsx("p",{children:s.description||"Descripción de la categoría"})]})]})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>w(!1),disabled:l,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:l||!s.name.trim(),children:l?"Guardando...":u?"Actualizar":"Crear"})]})]})]})})]})},Oe=({isOpen:t,onClose:m,vehicle:n,onSave:i,mode:p="create"})=>{const[o,C]=v.useState([]),[f,l]=v.useState(null),[I,u]=v.useState(!1),[x,N]=v.useState(!1),[w,j]=v.useState(!1),[b,s]=v.useState({}),g=v.useCallback(()=>({vehicleId:n?.vehicleId||"",name:n?.name||"",category:n?.category||"",brand:n?.brand||"",model:n?.model||"",year:n?.year||new Date().getFullYear(),fuelType:n?.fuelType||O.DIESEL,status:n?.status||y.ACTIVO,currentLocation:n?.currentLocation||"",description:n?.description||"",plateNumber:n?.plateNumber||"",enginePower:n?.enginePower||"",fuelCapacity:n?.fuelCapacity||"",operatingWeight:n?.operatingWeight||"",loadCapacity:n?.loadCapacity||"",bucketCapacity:n?.bucketCapacity||"",hasHourMeter:n?.hasHourMeter||!1,currentHours:n?.currentHours||"",implementType:n?.implementType||"",flow:n?.flow||"",pressure:n?.pressure||"",weight:n?.weight||"",lastMaintenanceDate:n?.lastMaintenanceDate?new Date(n.lastMaintenanceDate).toISOString().split("T")[0]:"",purchaseDate:n?.purchaseDate?new Date(n.purchaseDate).toISOString().split("T")[0]:""}),[n]),[c,V]=v.useState(g()),k=v.useCallback(async()=>{try{j(!0);const a=await X();if(C(a),p==="create"&&a.length>0){const r=a[0];l(r),V(h=>({...h,category:r.id}))}}catch(a){console.error("Error cargando categorías:",a)}finally{j(!1)}},[p]);v.useEffect(()=>(t?(k(),document.body.style.overflow="hidden"):document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t,k]),v.useEffect(()=>{if(n&&o.length>0){const a=Z(n.category,o);l(a),V(g())}},[n,o,g]);const d=a=>{const r=Z(a,o);l(r),V(h=>{const A=p==="create"&&h.name&&r?T(h.name,r):h.vehicleId;return{...h,category:a,vehicleId:A,fuelType:r?.fuelTypes?.includes(h.fuelType)?h.fuelType:r?.fuelTypes?.[0]||O.DIESEL}}),s({})},D=(a,r)=>{if(V(h=>({...h,[a]:r})),b[a]&&s(h=>({...h,[a]:null})),a==="name"&&p==="create"){const h=T(r,f);V(A=>({...A,vehicleId:h}))}if(a==="category"&&p==="create"&&c.name){const h=f;if(h){const A=T(c.name,h);V(F=>({...F,vehicleId:A}))}}},T=(a,r)=>{if(!a||!r)return"";const h=r.name.split(" ").map(R=>R.charAt(0).toUpperCase()).join("").substring(0,3),A=a.replace(/[^a-zA-Z0-9]/g,"").substring(0,4).toUpperCase(),H=Date.now().toString().slice(-3);return`${h}${A}${H}`},M=()=>{const a={};return c.vehicleId?.trim()||(a.vehicleId="Código del vehículo es requerido"),c.name?.trim()||(a.name="Nombre del vehículo es requerido"),c.category||(a.category="Categoría es requerida"),c.fuelType||(a.fuelType="Tipo de combustible es requerido"),f&&c.fuelType&&(f.fuelTypes?.includes(c.fuelType)||(a.fuelType=`Este combustible no es compatible con la categoría ${f.name}`)),["enginePower","fuelCapacity","operatingWeight","loadCapacity","bucketCapacity","flow","pressure","weight"].forEach(h=>{c[h]&&(isNaN(c[h])||Number(c[h])<0)&&(a[h]="Debe ser un número válido mayor o igual a 0")}),c.year&&(c.year<1900||c.year>new Date().getFullYear()+1)&&(a.year=`Año debe estar entre 1900 y ${new Date().getFullYear()+1}`),c.hasHourMeter&&c.currentHours&&(isNaN(c.currentHours)||Number(c.currentHours)<0)&&(a.currentHours="Horas actuales debe ser un número válido mayor o igual a 0"),s(a),Object.keys(a).length===0},L=async a=>{if(a.preventDefault(),!!M())try{j(!0);const r={...c,type:f?.name||c.category||"Otro",enginePower:c.enginePower?Number(c.enginePower):null,fuelCapacity:c.fuelCapacity?Number(c.fuelCapacity):null,operatingWeight:c.operatingWeight?Number(c.operatingWeight):null,loadCapacity:c.loadCapacity?Number(c.loadCapacity):null,bucketCapacity:c.bucketCapacity?Number(c.bucketCapacity):null,currentHours:c.currentHours?Number(c.currentHours):null,flow:c.flow?Number(c.flow):null,pressure:c.pressure?Number(c.pressure):null,weight:c.weight?Number(c.weight):null,year:Number(c.year),lastMaintenanceDate:c.lastMaintenanceDate?new Date(c.lastMaintenanceDate):null,purchaseDate:c.purchaseDate?new Date(c.purchaseDate):null,categoryName:f?.name,categoryIcon:f?.icon,categoryColor:f?.color};await i(r),m()}catch(r){console.error("Error guardando vehículo:",r),s({submit:r.message})}finally{j(!1)}},E=()=>f?f.fuelTypes||Object.values(O):Object.values(O);return t?e.jsxs("div",{className:"modal-overlay",children:[e.jsxs("div",{className:"modal-container",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:p==="create"?"🚗 Nuevo Vehículo":"✏️ Editar Vehículo"}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>u(!0),disabled:w,children:"📋 Gestionar Categorías"}),e.jsx("button",{type:"button",className:"btn-close",onClick:m,children:"✕"})]})]}),e.jsxs("form",{onSubmit:L,className:"modal-body",children:[b.submit&&e.jsxs("div",{className:"error-banner",children:["⚠️ ",b.submit]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"📂 Categoría del Vehículo"}),w?e.jsxs("div",{className:"loading-categories",children:[e.jsx("div",{className:"spinner"}),e.jsx("span",{children:"Cargando categorías..."})]}):e.jsxs("div",{className:"categories-selector",children:[e.jsxs("select",{value:c.category,onChange:a=>d(a.target.value),className:`category-select ${b.category?"error":""}`,children:[e.jsx("option",{value:"",children:"Seleccionar categoría del vehículo..."}),o.map(a=>e.jsxs("option",{value:a.id,children:[a.icon," ",a.name,$.some(r=>r.id===a.id)&&" (Predeterminada)"]},a.id))]}),f&&e.jsx(Ve,{category:f,isExpanded:x,onToggle:()=>N(!x)})]}),b.category&&e.jsx("span",{className:"field-error",children:b.category})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"📝 Información Básica"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"vehicleId",className:"form-label",children:"🏷️ Código del Vehículo *"}),e.jsx("input",{type:"text",id:"vehicleId",value:c.vehicleId,className:`form-input ${b.vehicleId?"error":""} ${p==="create"?"readonly":""}`,placeholder:"Se genera automáticamente",readOnly:p==="create",onChange:p==="edit"?a=>D("vehicleId",a.target.value):void 0,required:!0}),b.vehicleId&&e.jsx("span",{className:"field-error",children:b.vehicleId})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"📛 Nombre del Vehículo *"}),e.jsx("input",{type:"text",id:"name",value:c.name,onChange:a=>D("name",a.target.value),className:`form-input ${b.name?"error":""}`,placeholder:"Ej: Excavadora Principal, Tractor TR1",required:!0}),b.name&&e.jsx("span",{className:"field-error",children:b.name})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"brand",className:"form-label",children:"🏭 Marca"}),e.jsx("input",{type:"text",id:"brand",value:c.brand,onChange:a=>D("brand",a.target.value),className:"form-input",placeholder:"Ej: Caterpillar, John Deere"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"year",className:"form-label",children:"📅 Año"}),e.jsx("input",{type:"number",id:"year",value:c.year,onChange:a=>D("year",a.target.value),className:`form-input ${b.year?"error":""}`,min:"1900",max:new Date().getFullYear()+1}),b.year&&e.jsx("span",{className:"field-error",children:b.year})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"fuelType",className:"form-label",children:"⛽ Tipo de Combustible *"}),e.jsx("select",{id:"fuelType",value:c.fuelType,onChange:a=>D("fuelType",a.target.value),className:`form-input ${b.fuelType?"error":""}`,required:!0,children:E().map(a=>e.jsx("option",{value:a,children:a},a))}),b.fuelType&&e.jsx("span",{className:"field-error",children:b.fuelType})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",className:"form-label",children:"🚦 Estado"}),e.jsx("select",{id:"status",value:c.status,onChange:a=>D("status",a.target.value),className:"form-input",children:Object.entries(y).map(([a,r])=>e.jsx("option",{value:r,children:r.charAt(0).toUpperCase()+r.slice(1)},a))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"currentLocation",className:"form-label",children:"📍 Ubicación Actual"}),e.jsx("input",{type:"text",id:"currentLocation",value:c.currentLocation,onChange:a=>D("currentLocation",a.target.value),className:"form-input",placeholder:"Ej: Sector Norte, Patio Principal"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"📄 Descripción"}),e.jsx("textarea",{id:"description",value:c.description,onChange:a=>D("description",a.target.value),className:"form-input",rows:"3",placeholder:"Descripción adicional del vehículo, características especiales, etc."})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"📅 Fechas Importantes"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"purchaseDate",className:"form-label",children:"💰 Fecha de Compra"}),e.jsx("input",{type:"date",id:"purchaseDate",value:c.purchaseDate,onChange:a=>D("purchaseDate",a.target.value),className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"lastMaintenanceDate",className:"form-label",children:"🔧 Último Mantenimiento"}),e.jsx("input",{type:"date",id:"lastMaintenanceDate",value:c.lastMaintenanceDate,onChange:a=>D("lastMaintenanceDate",a.target.value),className:"form-input"})]})]})]}),f&&e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"👁️ Vista Previa"}),e.jsx("div",{className:"vehicle-preview",style:{"--category-color":f.color},children:e.jsxs("div",{className:"preview-header",children:[e.jsx("div",{className:"preview-icon",style:{color:f.color},children:f.icon}),e.jsxs("div",{className:"preview-info",children:[e.jsx("h4",{children:c.name||"Nombre del vehículo"}),e.jsxs("p",{children:[c.vehicleId||"Código del vehículo"," • ",f.name]}),e.jsxs("p",{children:[c.brand," ",c.year]})]})]})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:m,disabled:w,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:w||!f,children:w?"Guardando...":p==="create"?"Crear Vehículo":"Actualizar Vehículo"})]})]})]}),I&&e.jsx(oe,{onClose:()=>u(!1),onCategoryCreated:a=>{C(r=>[...r,a]),u(!1)}})]}):null},Ve=({category:t,isExpanded:m,onToggle:n})=>t?e.jsxs("div",{className:"category-info-panel",children:[e.jsxs("div",{className:"category-compact",children:[e.jsxs("div",{className:"category-summary",children:[e.jsx("span",{className:"category-icon",style:{color:t.color},children:t.icon}),e.jsxs("div",{className:"category-basic-info",children:[e.jsx("span",{className:"category-name",children:t.name}),e.jsx("span",{className:"category-short-desc",children:t.description?.length>50?t.description.substring(0,50)+"...":t.description})]})]}),e.jsx("button",{type:"button",className:"category-toggle-btn",onClick:n,"aria-label":m?"Contraer información":"Expandir información",children:m?"▲":"▼"})]}),m&&e.jsxs("div",{className:"category-expanded",children:[e.jsxs("div",{className:"category-detail-section",children:[e.jsx("h4",{children:"📋 Descripción Completa"}),e.jsx("p",{children:t.description})]}),t.fuelTypes&&t.fuelTypes.length>0&&e.jsxs("div",{className:"category-detail-section",children:[e.jsx("h4",{children:"⛽ Combustibles Compatibles"}),e.jsx("div",{className:"fuel-types-list",children:t.fuelTypes.map(i=>e.jsx("span",{className:"fuel-type-badge",children:i},i))})]}),t.fields&&t.fields.length>0&&e.jsxs("div",{className:"category-detail-section",children:[e.jsx("h4",{children:"🔧 Campos Específicos"}),e.jsx("div",{className:"fields-list",children:t.fields.map(i=>e.jsx("span",{className:"field-badge",children:i},i))})]}),t.isCustom&&e.jsx("div",{className:"category-detail-section",children:e.jsx("span",{className:"custom-badge",children:"✨ Categoría Personalizada"})})]})]}):null,_={PREVENTIVO:"preventivo",CORRECTIVO:"correctivo",PREDICTIVO:"predictivo",EMERGENCIA:"emergencia"},q={PROGRAMADO:"programado",EN_PROCESO:"en_proceso",COMPLETADO:"completado",CANCELADO:"cancelado"},U={BAJA:"baja",MEDIA:"media",ALTA:"alta",CRITICA:"critica"},Fe=({isOpen:t,onClose:m,vehicle:n,maintenance:i,onSave:p,mode:o="create",userRole:C})=>{const f=v.useCallback(()=>({vehicleId:n?.vehicleId||"",vehicleName:n?.name||"",type:i?.type||_.PREVENTIVO,title:i?.title||"",description:i?.description||"",priority:i?.priority||U.MEDIA,status:i?.status||q.PROGRAMADO,scheduledDate:i?.scheduledDate?new Date(i.scheduledDate).toISOString().split("T")[0]:"",startDate:i?.startDate?new Date(i.startDate).toISOString().split("T")[0]:"",completedDate:i?.completedDate?new Date(i.completedDate).toISOString().split("T")[0]:"",estimatedHours:i?.estimatedHours||0,actualHours:i?.actualHours||0,estimatedCost:i?.estimatedCost||0,actualCost:i?.actualCost||0,technician:i?.technician||"",workshop:i?.workshop||"",parts:i?.parts||[],notes:i?.notes||"",nextMaintenanceKm:i?.nextMaintenanceKm||0,nextMaintenanceHours:i?.nextMaintenanceHours||0,nextMaintenanceDate:i?.nextMaintenanceDate?new Date(i.nextMaintenanceDate).toISOString().split("T")[0]:""}),[i,n]),[l,I]=v.useState(f()),[u,x]=v.useState({}),[N,w]=v.useState(!1),[j,b]=v.useState({name:"",quantity:1,cost:0});v.useEffect(()=>{t&&(I(f()),x({}))},[t,i,n,f]);const s=r=>{const{name:h,value:A,type:F}=r.target,H=F==="number"?parseFloat(A)||0:A;I(R=>({...R,[h]:H})),u[h]&&x(R=>({...R,[h]:null}))},g=r=>{const{name:h,value:A,type:F}=r.target,H=F==="number"?parseFloat(A)||0:A;b(R=>({...R,[h]:H}))},c=()=>{if(!j.name.trim())return;const r={id:Date.now().toString(),name:j.name.trim(),quantity:j.quantity,cost:j.cost,total:j.quantity*j.cost};I(h=>({...h,parts:[...h.parts,r]})),b({name:"",quantity:1,cost:0})},V=r=>{I(h=>({...h,parts:h.parts.filter(A=>A.id!==r)}))},k=()=>{const r={};if(l.title.trim()||(r.title="El título del mantenimiento es obligatorio"),l.description.trim()||(r.description="La descripción es obligatoria"),l.scheduledDate||(r.scheduledDate="La fecha programada es obligatoria"),l.startDate&&l.completedDate){const h=new Date(l.startDate);new Date(l.completedDate)<h&&(r.completedDate="La fecha de finalización debe ser posterior al inicio")}return l.scheduledDate&&l.startDate&&(new Date(l.scheduledDate),new Date(l.startDate)),l.estimatedHours<0&&(r.estimatedHours="Las horas estimadas no pueden ser negativas"),l.actualHours<0&&(r.actualHours="Las horas reales no pueden ser negativas"),l.estimatedCost<0&&(r.estimatedCost="El costo estimado no puede ser negativo"),l.actualCost<0&&(r.actualCost="El costo real no puede ser negativo"),l.status===q.COMPLETADO&&!l.completedDate&&(r.completedDate="La fecha de finalización es obligatoria para mantenimientos completados"),l.status===q.EN_PROCESO&&!l.startDate&&(r.startDate="La fecha de inicio es obligatoria para mantenimientos en proceso"),x(r),Object.keys(r).length===0},d=async r=>{if(r.preventDefault(),!!k()){w(!0);try{const h=l.parts.reduce((R,G)=>R+G.total,0),A=l.estimatedCost+h,F=l.actualCost+h,H={...l,vehicleId:n.id,vehicleName:n.name,totalPartsCost:h,totalEstimatedCost:A,totalActualCost:F,scheduledDate:l.scheduledDate||null,startDate:l.startDate||null,completedDate:l.completedDate||null,nextMaintenanceDate:l.nextMaintenanceDate||null,createdAt:i?.createdAt||new Date,updatedAt:new Date};await p(H),m()}catch(h){console.error("Error guardando mantenimiento:",h),x({general:"Error al guardar el mantenimiento. Intenta nuevamente."})}finally{w(!1)}}},D=r=>{switch(r){case _.PREVENTIVO:return"🔧";case _.CORRECTIVO:return"🛠️";case _.PREDICTIVO:return"📊";case _.EMERGENCIA:return"🚨";default:return"⚙️"}},T=r=>{switch(r){case U.BAJA:return"priority-low";case U.MEDIA:return"priority-medium";case U.ALTA:return"priority-high";case U.CRITICA:return"priority-critical";default:return"priority-medium"}},M=r=>{switch(r){case q.PROGRAMADO:return"status-scheduled";case q.EN_PROCESO:return"status-in-progress";case q.COMPLETADO:return"status-completed";case q.CANCELADO:return"status-cancelled";default:return"status-scheduled"}},L=()=>l.parts.reduce((r,h)=>r+h.total,0),E=o==="view",a=C==="admin"||C==="supervisor";return t?e.jsx("div",{className:"modal-overlay",onClick:m,children:e.jsxs("div",{className:"modal-content maintenance-modal",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"modal-title",children:[e.jsx("span",{className:"title-icon",children:o==="create"?"➕":o==="edit"?"✏️":"👁️"}),e.jsxs("div",{className:"title-text",children:[e.jsxs("h3",{children:[o==="create"&&"Registrar Mantenimiento",o==="edit"&&"Editar Mantenimiento",o==="view"&&"Detalles del Mantenimiento"]}),e.jsxs("p",{children:["Vehículo: ",n?.vehicleId," - ",n?.name]})]})]}),e.jsx("button",{className:"btn-close",onClick:m,type:"button",children:"✕"})]}),e.jsxs("form",{onSubmit:d,className:"modal-form",children:[e.jsxs("div",{className:"form-content",children:[u.general&&e.jsxs("div",{className:"error-message general-error",children:["⚠️ ",u.general]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{className:"section-title",children:"📋 Información del Mantenimiento"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"type",children:"Tipo de Mantenimiento"}),e.jsx("select",{id:"type",name:"type",value:l.type,onChange:s,disabled:E||o==="edit"&&!a,children:Object.values(_).map(r=>e.jsxs("option",{value:r,children:[D(r)," ",r.charAt(0).toUpperCase()+r.slice(1)]},r))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"priority",children:"Prioridad"}),e.jsx("select",{id:"priority",name:"priority",value:l.priority,onChange:s,className:T(l.priority),disabled:E||o==="edit"&&!a,children:Object.values(U).map(r=>e.jsx("option",{value:r,children:r.charAt(0).toUpperCase()+r.slice(1)},r))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Estado"}),e.jsx("select",{id:"status",name:"status",value:l.status,onChange:s,className:M(l.status),disabled:E||o==="edit"&&!a,children:Object.values(q).map(r=>e.jsx("option",{value:r,children:r.charAt(0).toUpperCase()+r.slice(1).replace("_"," ")},r))})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{htmlFor:"title",children:"Título del Mantenimiento *"}),e.jsx("input",{type:"text",id:"title",name:"title",value:l.title,onChange:s,placeholder:"Ej: Cambio de aceite y filtros",className:u.title?"error":"",disabled:E||o==="edit"&&!a,maxLength:100}),u.title&&e.jsx("span",{className:"error-text",children:u.title})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{className:"section-title",children:"📅 Programación"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"scheduledDate",children:"Fecha Programada *"}),e.jsx("input",{type:"date",id:"scheduledDate",name:"scheduledDate",value:l.scheduledDate,onChange:s,className:u.scheduledDate?"error":"",disabled:E||o==="edit"&&!a}),u.scheduledDate&&e.jsx("span",{className:"error-text",children:u.scheduledDate})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"startDate",children:"Fecha de Inicio"}),e.jsx("input",{type:"date",id:"startDate",name:"startDate",value:l.startDate,onChange:s,className:u.startDate?"error":"",disabled:E||o==="edit"&&!a}),u.startDate&&e.jsx("span",{className:"error-text",children:u.startDate})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"completedDate",children:"Fecha de Finalización"}),e.jsx("input",{type:"date",id:"completedDate",name:"completedDate",value:l.completedDate,onChange:s,className:u.completedDate?"error":"",disabled:E||o==="edit"&&!a}),u.completedDate&&e.jsx("span",{className:"error-text",children:u.completedDate})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"nextMaintenanceDate",children:"Próximo Mantenimiento"}),e.jsx("input",{type:"date",id:"nextMaintenanceDate",name:"nextMaintenanceDate",value:l.nextMaintenanceDate,onChange:s,disabled:E||o==="edit"&&!a})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{className:"section-title",children:"💰 Recursos y Costos"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"technician",children:"Técnico Responsable"}),e.jsx("input",{type:"text",id:"technician",name:"technician",value:l.technician,onChange:s,placeholder:"Nombre del técnico",disabled:E||o==="edit"&&!a,maxLength:100})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"workshop",children:"Taller/Ubicación"}),e.jsx("input",{type:"text",id:"workshop",name:"workshop",value:l.workshop,onChange:s,placeholder:"Taller donde se realiza",disabled:E||o==="edit"&&!a,maxLength:100})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"estimatedHours",children:"Horas Estimadas"}),e.jsx("input",{type:"number",id:"estimatedHours",name:"estimatedHours",value:l.estimatedHours,onChange:s,min:"0",step:"0.5",className:u.estimatedHours?"error":"",disabled:E||o==="edit"&&!a}),u.estimatedHours&&e.jsx("span",{className:"error-text",children:u.estimatedHours})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"actualHours",children:"Horas Reales"}),e.jsx("input",{type:"number",id:"actualHours",name:"actualHours",value:l.actualHours,onChange:s,min:"0",step:"0.5",className:u.actualHours?"error":"",disabled:E||o==="edit"&&!a}),u.actualHours&&e.jsx("span",{className:"error-text",children:u.actualHours})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"estimatedCost",children:"Costo Estimado (COP)"}),e.jsx("input",{type:"number",id:"estimatedCost",name:"estimatedCost",value:l.estimatedCost,onChange:s,min:"0",step:"1000",className:u.estimatedCost?"error":"",disabled:E||o==="edit"&&!a}),u.estimatedCost&&e.jsx("span",{className:"error-text",children:u.estimatedCost})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"actualCost",children:"Costo Real (COP)"}),e.jsx("input",{type:"number",id:"actualCost",name:"actualCost",value:l.actualCost,onChange:s,min:"0",step:"1000",className:u.actualCost?"error":"",disabled:E||o==="edit"&&!a}),u.actualCost&&e.jsx("span",{className:"error-text",children:u.actualCost})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{className:"section-title",children:"🔧 Partes y Repuestos"}),!E&&a&&e.jsx("div",{className:"parts-form",children:e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"partName",children:"Nombre de la Parte"}),e.jsx("input",{type:"text",id:"partName",name:"name",value:j.name,onChange:g,placeholder:"Ej: Filtro de aceite",maxLength:100})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"partQuantity",children:"Cantidad"}),e.jsx("input",{type:"number",id:"partQuantity",name:"quantity",value:j.quantity,onChange:g,min:"1",step:"1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"partCost",children:"Costo Unitario (COP)"}),e.jsx("input",{type:"number",id:"partCost",name:"cost",value:j.cost,onChange:g,min:"0",step:"1000"})]}),e.jsx("div",{className:"form-group",children:e.jsx("button",{type:"button",className:"btn-add-part",onClick:c,disabled:!j.name.trim(),children:"➕ Agregar"})})]})}),l.parts.length>0&&e.jsx("div",{className:"parts-list",children:e.jsxs("table",{className:"parts-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Parte"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Costo Unit."}),e.jsx("th",{children:"Total"}),!E&&a&&e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:l.parts.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:r.name}),e.jsx("td",{children:r.quantity}),e.jsxs("td",{children:["$",r.cost.toLocaleString("es-CO")]}),e.jsxs("td",{children:["$",r.total.toLocaleString("es-CO")]}),!E&&a&&e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn-remove-part",onClick:()=>V(r.id),title:"Eliminar parte",children:"🗑️"})})]},r.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"total-row",children:[e.jsx("td",{colSpan:"3",children:e.jsx("strong",{children:"Total Partes:"})}),e.jsx("td",{children:e.jsxs("strong",{children:["$",L().toLocaleString("es-CO")]})}),!E&&a&&e.jsx("td",{})]})})]})})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{className:"section-title",children:"🔄 Próximo Mantenimiento"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"nextMaintenanceKm",children:"Próximo Mantenimiento (Km)"}),e.jsx("input",{type:"number",id:"nextMaintenanceKm",name:"nextMaintenanceKm",value:l.nextMaintenanceKm,onChange:s,min:"0",step:"1000",placeholder:"0 = No aplica",disabled:E||o==="edit"&&!a})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"nextMaintenanceHours",children:"Próximo Mantenimiento (Horas)"}),e.jsx("input",{type:"number",id:"nextMaintenanceHours",name:"nextMaintenanceHours",value:l.nextMaintenanceHours,onChange:s,min:"0",step:"100",placeholder:"0 = No aplica",disabled:E||o==="edit"&&!a})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{className:"section-title",children:"📝 Descripción y Notas"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Descripción del Trabajo *"}),e.jsx("textarea",{id:"description",name:"description",value:l.description,onChange:s,placeholder:"Describe el trabajo a realizar o realizado...",rows:"3",maxLength:"500",className:u.description?"error":"",disabled:E||o==="edit"&&!a}),u.description&&e.jsx("span",{className:"error-text",children:u.description})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"notes",children:"Notas Adicionales"}),e.jsx("textarea",{id:"notes",name:"notes",value:l.notes,onChange:s,placeholder:"Observaciones, recomendaciones, problemas encontrados...",rows:"3",maxLength:"500",disabled:E||o==="edit"&&!a}),e.jsxs("span",{className:"char-count",children:[l.notes.length,"/500 caracteres"]})]})]}),e.jsxs("div",{className:"cost-summary",children:[e.jsx("h4",{children:"💰 Resumen de Costos"}),e.jsxs("div",{className:"cost-grid",children:[e.jsxs("div",{className:"cost-item",children:[e.jsx("span",{className:"cost-label",children:"Mano de Obra:"}),e.jsxs("span",{className:"cost-value",children:["$",l.actualCost.toLocaleString("es-CO")]})]}),e.jsxs("div",{className:"cost-item",children:[e.jsx("span",{className:"cost-label",children:"Partes:"}),e.jsxs("span",{className:"cost-value",children:["$",L().toLocaleString("es-CO")]})]}),e.jsxs("div",{className:"cost-item total-cost",children:[e.jsx("span",{className:"cost-label",children:"Total:"}),e.jsxs("span",{className:"cost-value",children:["$",(l.actualCost+L()).toLocaleString("es-CO")]})]})]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:m,disabled:N,children:o==="view"?"Cerrar":"Cancelar"}),!E&&a&&e.jsx("button",{type:"submit",className:"btn-primary",disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading-spinner"}),"Guardando..."]}):e.jsx(e.Fragment,{children:o==="create"?"➕ Registrar Mantenimiento":"💾 Guardar Cambios"})})]})]})]})}):null},Le=()=>{const{user:t,userProfile:m}=ve(),[n,i]=v.useState([]),[p,o]=v.useState(null),[C,f]=v.useState(!0),[l,I]=v.useState(null),[u,x]=v.useState({type:"",status:"",fuelType:"",location:"",maintenance:"all"}),[N,w]=v.useState("cards"),[j,b]=v.useState(""),[s,g]=v.useState(!1),[c,V]=v.useState(!1),[k,d]=v.useState(!1),[D,T]=v.useState(null),[M,L]=v.useState("create");v.useEffect(()=>{if(!t)return;f(!0);const S=fe((P,J)=>{if(J){console.error("Error en suscripción de vehículos:",J),I("Error al cargar vehículos"),f(!1);return}i(P),I(null),f(!1)},u);return()=>S()},[t,u.type,u.status,u.fuelType,u.location,u.maintenance]),v.useEffect(()=>{t&&(async()=>{try{const P=await ye(u);o(P)}catch(P){console.error("Error al cargar estadísticas:",P)}})()},[t,n,u.type,u.status,u.fuelType,u.location,u.maintenance]);const E=n.filter(S=>{if(!j)return!0;const P=j.toLowerCase();return S.vehicleId?.toLowerCase().includes(P)||S.name?.toLowerCase().includes(P)||S.type?.toLowerCase().includes(P)||S.brand?.toLowerCase().includes(P)||S.model?.toLowerCase().includes(P)||S.currentLocation?.toLowerCase().includes(P)||S.description?.toLowerCase().includes(P)}),a=()=>{T(null),L("create"),g(!0)},r=S=>{T(S),L("edit"),g(!0)},h=S=>{T(S),L("view"),g(!0)},A=S=>{T(S),V(!0)},F=()=>{g(!1),V(!1),T(null)},H=S=>{x(P=>({...P,...S}))},R=()=>{x({type:"",status:"",fuelType:"",location:"",maintenance:"all"}),b("")},G=m?.role==="admin"||m?.role==="contador"||m?.role==="cliente",de=m?.role==="admin",me=m?.role==="admin"||m?.role==="contador";return C?e.jsx("div",{className:"vehicles-main",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Cargando vehículos..."})]})}):l?e.jsx("div",{className:"vehicles-main",children:e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:"⚠️"}),e.jsx("h3",{children:"Error al cargar vehículos"}),e.jsx("p",{children:l}),e.jsx("button",{className:"btn-retry",onClick:()=>window.location.reload(),children:"Reintentar"})]})}):e.jsxs("div",{className:"vehicles-main",children:[e.jsxs("div",{className:"vehicles-header",children:[e.jsxs("div",{className:"header-title",children:[e.jsx("h2",{children:"🚜 Gestión de Vehículos"}),e.jsx("p",{children:"Administra la maquinaria y vehículos forestales"})]}),G&&e.jsx("button",{className:"btn-create-vehicle",onClick:a,children:"➕ Nuevo Vehículo"})]}),p&&e.jsx(we,{stats:p,filters:u}),e.jsx(De,{filters:u,onFilterChange:H,onClearFilters:R,searchTerm:j,onSearchChange:b,viewMode:N,onViewModeChange:w,totalResults:E.length}),E.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"🚜"}),e.jsx("h3",{children:n.length===0?"No hay vehículos registrados":"No se encontraron vehículos"}),e.jsx("p",{children:n.length===0?"Comienza registrando tu primer vehículo o maquinaria forestal":"Intenta ajustar los filtros de búsqueda"}),n.length===0&&G&&e.jsx("button",{className:"btn-create-first",onClick:a,children:"➕ Registrar Primer Vehículo"})]}):e.jsx(Te,{vehicles:E,viewMode:N,onEdit:de?r:null,onView:h,onMaintenance:me?A:null,userRole:t?.role}),s&&e.jsx(Oe,{isOpen:s,onClose:F,vehicle:D,mode:M,onSave:async S=>{M==="create"?await be(S):await Ce(D.id,S),F()},userRole:m?.role}),k&&e.jsx(oe,{onClose:()=>d(!1),onCategoryCreated:()=>{}}),c&&e.jsx(Fe,{isOpen:c,onClose:F,vehicle:D,onSuccess:()=>{F()}})]})};export{Le as default};
