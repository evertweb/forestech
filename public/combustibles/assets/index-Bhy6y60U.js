(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(o){if(o.ep)return;o.ep=!0;const c=t(o);fetch(o.href,c)}})();var wp={exports:{}},Cc={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yN;function Sw(){if(yN)return Cc;yN=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,o,c){var d=null;if(c!==void 0&&(d=""+c),o.key!==void 0&&(d=""+o.key),"key"in o){c={};for(var f in o)f!=="key"&&(c[f]=o[f])}else c=o;return o=c.ref,{$$typeof:n,type:i,key:d,ref:o!==void 0?o:null,props:c}}return Cc.Fragment=e,Cc.jsx=t,Cc.jsxs=t,Cc}var xN;function Iw(){return xN||(xN=1,wp.exports=Sw()),wp.exports}var a=Iw(),Sp={exports:{}},Le={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bN;function Rw(){if(bN)return Le;bN=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),d=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),b=Symbol.iterator;function E(H){return H===null||typeof H!="object"?null:(H=b&&H[b]||H["@@iterator"],typeof H=="function"?H:null)}var j={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N=Object.assign,w={};function T(H,ee,ce){this.props=H,this.context=ee,this.refs=w,this.updater=ce||j}T.prototype.isReactComponent={},T.prototype.setState=function(H,ee){if(typeof H!="object"&&typeof H!="function"&&H!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,H,ee,"setState")},T.prototype.forceUpdate=function(H){this.updater.enqueueForceUpdate(this,H,"forceUpdate")};function S(){}S.prototype=T.prototype;function q(H,ee,ce){this.props=H,this.context=ee,this.refs=w,this.updater=ce||j}var I=q.prototype=new S;I.constructor=q,N(I,T.prototype),I.isPureReactComponent=!0;var O=Array.isArray,U={H:null,A:null,T:null,S:null,V:null},$=Object.prototype.hasOwnProperty;function F(H,ee,ce,ue,Te,Be){return ce=Be.ref,{$$typeof:n,type:H,key:ee,ref:ce!==void 0?ce:null,props:Be}}function R(H,ee){return F(H.type,ee,void 0,void 0,void 0,H.props)}function V(H){return typeof H=="object"&&H!==null&&H.$$typeof===n}function P(H){var ee={"=":"=0",":":"=2"};return"$"+H.replace(/[=:]/g,function(ce){return ee[ce]})}var C=/\/+/g;function M(H,ee){return typeof H=="object"&&H!==null&&H.key!=null?P(""+H.key):ee.toString(36)}function D(){}function le(H){switch(H.status){case"fulfilled":return H.value;case"rejected":throw H.reason;default:switch(typeof H.status=="string"?H.then(D,D):(H.status="pending",H.then(function(ee){H.status==="pending"&&(H.status="fulfilled",H.value=ee)},function(ee){H.status==="pending"&&(H.status="rejected",H.reason=ee)})),H.status){case"fulfilled":return H.value;case"rejected":throw H.reason}}throw H}function ve(H,ee,ce,ue,Te){var Be=typeof H;(Be==="undefined"||Be==="boolean")&&(H=null);var Me=!1;if(H===null)Me=!0;else switch(Be){case"bigint":case"string":case"number":Me=!0;break;case"object":switch(H.$$typeof){case n:case e:Me=!0;break;case y:return Me=H._init,ve(Me(H._payload),ee,ce,ue,Te)}}if(Me)return Te=Te(H),Me=ue===""?"."+M(H,0):ue,O(Te)?(ce="",Me!=null&&(ce=Me.replace(C,"$&/")+"/"),ve(Te,ee,ce,"",function(Cs){return Cs})):Te!=null&&(V(Te)&&(Te=R(Te,ce+(Te.key==null||H&&H.key===Te.key?"":(""+Te.key).replace(C,"$&/")+"/")+Me)),ee.push(Te)),1;Me=0;var $t=ue===""?".":ue+":";if(O(H))for(var mt=0;mt<H.length;mt++)ue=H[mt],Be=$t+M(ue,mt),Me+=ve(ue,ee,ce,Be,Te);else if(mt=E(H),typeof mt=="function")for(H=mt.call(H),mt=0;!(ue=H.next()).done;)ue=ue.value,Be=$t+M(ue,mt++),Me+=ve(ue,ee,ce,Be,Te);else if(Be==="object"){if(typeof H.then=="function")return ve(le(H),ee,ce,ue,Te);throw ee=String(H),Error("Objects are not valid as a React child (found: "+(ee==="[object Object]"?"object with keys {"+Object.keys(H).join(", ")+"}":ee)+"). If you meant to render a collection of children, use an array instead.")}return Me}function Q(H,ee,ce){if(H==null)return H;var ue=[],Te=0;return ve(H,ue,"","",function(Be){return ee.call(ce,Be,Te++)}),ue}function se(H){if(H._status===-1){var ee=H._result;ee=ee(),ee.then(function(ce){(H._status===0||H._status===-1)&&(H._status=1,H._result=ce)},function(ce){(H._status===0||H._status===-1)&&(H._status=2,H._result=ce)}),H._status===-1&&(H._status=0,H._result=ee)}if(H._status===1)return H._result.default;throw H._result}var me=typeof reportError=="function"?reportError:function(H){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ee=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof H=="object"&&H!==null&&typeof H.message=="string"?String(H.message):String(H),error:H});if(!window.dispatchEvent(ee))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",H);return}console.error(H)};function Oe(){}return Le.Children={map:Q,forEach:function(H,ee,ce){Q(H,function(){ee.apply(this,arguments)},ce)},count:function(H){var ee=0;return Q(H,function(){ee++}),ee},toArray:function(H){return Q(H,function(ee){return ee})||[]},only:function(H){if(!V(H))throw Error("React.Children.only expected to receive a single React element child.");return H}},Le.Component=T,Le.Fragment=t,Le.Profiler=o,Le.PureComponent=q,Le.StrictMode=i,Le.Suspense=p,Le.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=U,Le.__COMPILER_RUNTIME={__proto__:null,c:function(H){return U.H.useMemoCache(H)}},Le.cache=function(H){return function(){return H.apply(null,arguments)}},Le.cloneElement=function(H,ee,ce){if(H==null)throw Error("The argument must be a React element, but you passed "+H+".");var ue=N({},H.props),Te=H.key,Be=void 0;if(ee!=null)for(Me in ee.ref!==void 0&&(Be=void 0),ee.key!==void 0&&(Te=""+ee.key),ee)!$.call(ee,Me)||Me==="key"||Me==="__self"||Me==="__source"||Me==="ref"&&ee.ref===void 0||(ue[Me]=ee[Me]);var Me=arguments.length-2;if(Me===1)ue.children=ce;else if(1<Me){for(var $t=Array(Me),mt=0;mt<Me;mt++)$t[mt]=arguments[mt+2];ue.children=$t}return F(H.type,Te,void 0,void 0,Be,ue)},Le.createContext=function(H){return H={$$typeof:d,_currentValue:H,_currentValue2:H,_threadCount:0,Provider:null,Consumer:null},H.Provider=H,H.Consumer={$$typeof:c,_context:H},H},Le.createElement=function(H,ee,ce){var ue,Te={},Be=null;if(ee!=null)for(ue in ee.key!==void 0&&(Be=""+ee.key),ee)$.call(ee,ue)&&ue!=="key"&&ue!=="__self"&&ue!=="__source"&&(Te[ue]=ee[ue]);var Me=arguments.length-2;if(Me===1)Te.children=ce;else if(1<Me){for(var $t=Array(Me),mt=0;mt<Me;mt++)$t[mt]=arguments[mt+2];Te.children=$t}if(H&&H.defaultProps)for(ue in Me=H.defaultProps,Me)Te[ue]===void 0&&(Te[ue]=Me[ue]);return F(H,Be,void 0,void 0,null,Te)},Le.createRef=function(){return{current:null}},Le.forwardRef=function(H){return{$$typeof:f,render:H}},Le.isValidElement=V,Le.lazy=function(H){return{$$typeof:y,_payload:{_status:-1,_result:H},_init:se}},Le.memo=function(H,ee){return{$$typeof:g,type:H,compare:ee===void 0?null:ee}},Le.startTransition=function(H){var ee=U.T,ce={};U.T=ce;try{var ue=H(),Te=U.S;Te!==null&&Te(ce,ue),typeof ue=="object"&&ue!==null&&typeof ue.then=="function"&&ue.then(Oe,me)}catch(Be){me(Be)}finally{U.T=ee}},Le.unstable_useCacheRefresh=function(){return U.H.useCacheRefresh()},Le.use=function(H){return U.H.use(H)},Le.useActionState=function(H,ee,ce){return U.H.useActionState(H,ee,ce)},Le.useCallback=function(H,ee){return U.H.useCallback(H,ee)},Le.useContext=function(H){return U.H.useContext(H)},Le.useDebugValue=function(){},Le.useDeferredValue=function(H,ee){return U.H.useDeferredValue(H,ee)},Le.useEffect=function(H,ee,ce){var ue=U.H;if(typeof ce=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ue.useEffect(H,ee)},Le.useId=function(){return U.H.useId()},Le.useImperativeHandle=function(H,ee,ce){return U.H.useImperativeHandle(H,ee,ce)},Le.useInsertionEffect=function(H,ee){return U.H.useInsertionEffect(H,ee)},Le.useLayoutEffect=function(H,ee){return U.H.useLayoutEffect(H,ee)},Le.useMemo=function(H,ee){return U.H.useMemo(H,ee)},Le.useOptimistic=function(H,ee){return U.H.useOptimistic(H,ee)},Le.useReducer=function(H,ee,ce){return U.H.useReducer(H,ee,ce)},Le.useRef=function(H){return U.H.useRef(H)},Le.useState=function(H){return U.H.useState(H)},Le.useSyncExternalStore=function(H,ee,ce){return U.H.useSyncExternalStore(H,ee,ce)},Le.useTransition=function(){return U.H.useTransition()},Le.version="19.1.0",Le}var NN;function Mg(){return NN||(NN=1,Sp.exports=Rw()),Sp.exports}var z=Mg(),Ip={exports:{}},wc={},Rp={exports:{}},Dp={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var EN;function Dw(){return EN||(EN=1,function(n){function e(Q,se){var me=Q.length;Q.push(se);e:for(;0<me;){var Oe=me-1>>>1,H=Q[Oe];if(0<o(H,se))Q[Oe]=se,Q[me]=H,me=Oe;else break e}}function t(Q){return Q.length===0?null:Q[0]}function i(Q){if(Q.length===0)return null;var se=Q[0],me=Q.pop();if(me!==se){Q[0]=me;e:for(var Oe=0,H=Q.length,ee=H>>>1;Oe<ee;){var ce=2*(Oe+1)-1,ue=Q[ce],Te=ce+1,Be=Q[Te];if(0>o(ue,me))Te<H&&0>o(Be,ue)?(Q[Oe]=Be,Q[Te]=me,Oe=Te):(Q[Oe]=ue,Q[ce]=me,Oe=ce);else if(Te<H&&0>o(Be,me))Q[Oe]=Be,Q[Te]=me,Oe=Te;else break e}}return se}function o(Q,se){var me=Q.sortIndex-se.sortIndex;return me!==0?me:Q.id-se.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;n.unstable_now=function(){return c.now()}}else{var d=Date,f=d.now();n.unstable_now=function(){return d.now()-f}}var p=[],g=[],y=1,b=null,E=3,j=!1,N=!1,w=!1,T=!1,S=typeof setTimeout=="function"?setTimeout:null,q=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function O(Q){for(var se=t(g);se!==null;){if(se.callback===null)i(g);else if(se.startTime<=Q)i(g),se.sortIndex=se.expirationTime,e(p,se);else break;se=t(g)}}function U(Q){if(w=!1,O(Q),!N)if(t(p)!==null)N=!0,$||($=!0,M());else{var se=t(g);se!==null&&ve(U,se.startTime-Q)}}var $=!1,F=-1,R=5,V=-1;function P(){return T?!0:!(n.unstable_now()-V<R)}function C(){if(T=!1,$){var Q=n.unstable_now();V=Q;var se=!0;try{e:{N=!1,w&&(w=!1,q(F),F=-1),j=!0;var me=E;try{t:{for(O(Q),b=t(p);b!==null&&!(b.expirationTime>Q&&P());){var Oe=b.callback;if(typeof Oe=="function"){b.callback=null,E=b.priorityLevel;var H=Oe(b.expirationTime<=Q);if(Q=n.unstable_now(),typeof H=="function"){b.callback=H,O(Q),se=!0;break t}b===t(p)&&i(p),O(Q)}else i(p);b=t(p)}if(b!==null)se=!0;else{var ee=t(g);ee!==null&&ve(U,ee.startTime-Q),se=!1}}break e}finally{b=null,E=me,j=!1}se=void 0}}finally{se?M():$=!1}}}var M;if(typeof I=="function")M=function(){I(C)};else if(typeof MessageChannel<"u"){var D=new MessageChannel,le=D.port2;D.port1.onmessage=C,M=function(){le.postMessage(null)}}else M=function(){S(C,0)};function ve(Q,se){F=S(function(){Q(n.unstable_now())},se)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Q){Q.callback=null},n.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<Q?Math.floor(1e3/Q):5},n.unstable_getCurrentPriorityLevel=function(){return E},n.unstable_next=function(Q){switch(E){case 1:case 2:case 3:var se=3;break;default:se=E}var me=E;E=se;try{return Q()}finally{E=me}},n.unstable_requestPaint=function(){T=!0},n.unstable_runWithPriority=function(Q,se){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var me=E;E=Q;try{return se()}finally{E=me}},n.unstable_scheduleCallback=function(Q,se,me){var Oe=n.unstable_now();switch(typeof me=="object"&&me!==null?(me=me.delay,me=typeof me=="number"&&0<me?Oe+me:Oe):me=Oe,Q){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=me+H,Q={id:y++,callback:se,priorityLevel:Q,startTime:me,expirationTime:H,sortIndex:-1},me>Oe?(Q.sortIndex=me,e(g,Q),t(p)===null&&Q===t(g)&&(w?(q(F),F=-1):w=!0,ve(U,me-Oe))):(Q.sortIndex=H,e(p,Q),N||j||(N=!0,$||($=!0,M()))),Q},n.unstable_shouldYield=P,n.unstable_wrapCallback=function(Q){var se=E;return function(){var me=E;E=se;try{return Q.apply(this,arguments)}finally{E=me}}}}(Dp)),Dp}var _N;function Mw(){return _N||(_N=1,Rp.exports=Dw()),Rp.exports}var Mp={exports:{}},fn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TN;function kw(){if(TN)return fn;TN=1;var n=Mg();function e(p){var g="https://react.dev/errors/"+p;if(1<arguments.length){g+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)g+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+p+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},o=Symbol.for("react.portal");function c(p,g,y){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:b==null?null:""+b,children:p,containerInfo:g,implementation:y}}var d=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(p,g){if(p==="font")return"";if(typeof g=="string")return g==="use-credentials"?g:""}return fn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,fn.createPortal=function(p,g){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!g||g.nodeType!==1&&g.nodeType!==9&&g.nodeType!==11)throw Error(e(299));return c(p,g,null,y)},fn.flushSync=function(p){var g=d.T,y=i.p;try{if(d.T=null,i.p=2,p)return p()}finally{d.T=g,i.p=y,i.d.f()}},fn.preconnect=function(p,g){typeof p=="string"&&(g?(g=g.crossOrigin,g=typeof g=="string"?g==="use-credentials"?g:"":void 0):g=null,i.d.C(p,g))},fn.prefetchDNS=function(p){typeof p=="string"&&i.d.D(p)},fn.preinit=function(p,g){if(typeof p=="string"&&g&&typeof g.as=="string"){var y=g.as,b=f(y,g.crossOrigin),E=typeof g.integrity=="string"?g.integrity:void 0,j=typeof g.fetchPriority=="string"?g.fetchPriority:void 0;y==="style"?i.d.S(p,typeof g.precedence=="string"?g.precedence:void 0,{crossOrigin:b,integrity:E,fetchPriority:j}):y==="script"&&i.d.X(p,{crossOrigin:b,integrity:E,fetchPriority:j,nonce:typeof g.nonce=="string"?g.nonce:void 0})}},fn.preinitModule=function(p,g){if(typeof p=="string")if(typeof g=="object"&&g!==null){if(g.as==null||g.as==="script"){var y=f(g.as,g.crossOrigin);i.d.M(p,{crossOrigin:y,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0})}}else g==null&&i.d.M(p)},fn.preload=function(p,g){if(typeof p=="string"&&typeof g=="object"&&g!==null&&typeof g.as=="string"){var y=g.as,b=f(y,g.crossOrigin);i.d.L(p,y,{crossOrigin:b,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0,type:typeof g.type=="string"?g.type:void 0,fetchPriority:typeof g.fetchPriority=="string"?g.fetchPriority:void 0,referrerPolicy:typeof g.referrerPolicy=="string"?g.referrerPolicy:void 0,imageSrcSet:typeof g.imageSrcSet=="string"?g.imageSrcSet:void 0,imageSizes:typeof g.imageSizes=="string"?g.imageSizes:void 0,media:typeof g.media=="string"?g.media:void 0})}},fn.preloadModule=function(p,g){if(typeof p=="string")if(g){var y=f(g.as,g.crossOrigin);i.d.m(p,{as:typeof g.as=="string"&&g.as!=="script"?g.as:void 0,crossOrigin:y,integrity:typeof g.integrity=="string"?g.integrity:void 0})}else i.d.m(p)},fn.requestFormReset=function(p){i.d.r(p)},fn.unstable_batchedUpdates=function(p,g){return p(g)},fn.useFormState=function(p,g,y){return d.H.useFormState(p,g,y)},fn.useFormStatus=function(){return d.H.useHostTransitionStatus()},fn.version="19.1.0",fn}var jN;function Ow(){if(jN)return Mp.exports;jN=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Mp.exports=kw(),Mp.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AN;function Pw(){if(AN)return wc;AN=1;var n=Mw(),e=Mg(),t=Ow();function i(s){var r="https://react.dev/errors/"+s;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)r+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+s+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function c(s){var r=s,l=s;if(s.alternate)for(;r.return;)r=r.return;else{s=r;do r=s,(r.flags&4098)!==0&&(l=r.return),s=r.return;while(s)}return r.tag===3?l:null}function d(s){if(s.tag===13){var r=s.memoizedState;if(r===null&&(s=s.alternate,s!==null&&(r=s.memoizedState)),r!==null)return r.dehydrated}return null}function f(s){if(c(s)!==s)throw Error(i(188))}function p(s){var r=s.alternate;if(!r){if(r=c(s),r===null)throw Error(i(188));return r!==s?null:s}for(var l=s,u=r;;){var m=l.return;if(m===null)break;var v=m.alternate;if(v===null){if(u=m.return,u!==null){l=u;continue}break}if(m.child===v.child){for(v=m.child;v;){if(v===l)return f(m),s;if(v===u)return f(m),r;v=v.sibling}throw Error(i(188))}if(l.return!==u.return)l=m,u=v;else{for(var A=!1,k=m.child;k;){if(k===l){A=!0,l=m,u=v;break}if(k===u){A=!0,u=m,l=v;break}k=k.sibling}if(!A){for(k=v.child;k;){if(k===l){A=!0,l=v,u=m;break}if(k===u){A=!0,u=v,l=m;break}k=k.sibling}if(!A)throw Error(i(189))}}if(l.alternate!==u)throw Error(i(190))}if(l.tag!==3)throw Error(i(188));return l.stateNode.current===l?s:r}function g(s){var r=s.tag;if(r===5||r===26||r===27||r===6)return s;for(s=s.child;s!==null;){if(r=g(s),r!==null)return r;s=s.sibling}return null}var y=Object.assign,b=Symbol.for("react.element"),E=Symbol.for("react.transitional.element"),j=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),q=Symbol.for("react.consumer"),I=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),U=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),F=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),V=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),C=Symbol.iterator;function M(s){return s===null||typeof s!="object"?null:(s=C&&s[C]||s["@@iterator"],typeof s=="function"?s:null)}var D=Symbol.for("react.client.reference");function le(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===D?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case N:return"Fragment";case T:return"Profiler";case w:return"StrictMode";case U:return"Suspense";case $:return"SuspenseList";case V:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case j:return"Portal";case I:return(s.displayName||"Context")+".Provider";case q:return(s._context.displayName||"Context")+".Consumer";case O:var r=s.render;return s=s.displayName,s||(s=r.displayName||r.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case F:return r=s.displayName||null,r!==null?r:le(s.type)||"Memo";case R:r=s._payload,s=s._init;try{return le(s(r))}catch{}}return null}var ve=Array.isArray,Q=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,me={pending:!1,data:null,method:null,action:null},Oe=[],H=-1;function ee(s){return{current:s}}function ce(s){0>H||(s.current=Oe[H],Oe[H]=null,H--)}function ue(s,r){H++,Oe[H]=s.current,s.current=r}var Te=ee(null),Be=ee(null),Me=ee(null),$t=ee(null);function mt(s,r){switch(ue(Me,r),ue(Be,s),ue(Te,null),r.nodeType){case 9:case 11:s=(s=r.documentElement)&&(s=s.namespaceURI)?$b(s):0;break;default:if(s=r.tagName,r=r.namespaceURI)r=$b(r),s=Yb(r,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}ce(Te),ue(Te,s)}function Cs(){ce(Te),ce(Be),ce(Me)}function Va(s){s.memoizedState!==null&&ue($t,s);var r=Te.current,l=Yb(r,s.type);r!==l&&(ue(Be,s),ue(Te,l))}function ta(s){Be.current===s&&(ce(Te),ce(Be)),$t.current===s&&(ce($t),Ec._currentValue=me)}var zi=Object.prototype.hasOwnProperty,Hi=n.unstable_scheduleCallback,Gi=n.unstable_cancelCallback,xl=n.unstable_shouldYield,Cu=n.unstable_requestPaint,Kn=n.unstable_now,wf=n.unstable_getCurrentPriorityLevel,bl=n.unstable_ImmediatePriority,Gr=n.unstable_UserBlockingPriority,$i=n.unstable_NormalPriority,Sf=n.unstable_LowPriority,$r=n.unstable_IdlePriority,Nl=n.log,wu=n.unstable_setDisableYieldValue,Tt=null,at=null;function kn(s){if(typeof Nl=="function"&&wu(s),at&&typeof at.setStrictMode=="function")try{at.setStrictMode(Tt,s)}catch{}}var dn=Math.clz32?Math.clz32:Yi,Su=Math.log,If=Math.LN2;function Yi(s){return s>>>=0,s===0?32:31-(Su(s)/If|0)|0}var Qi=256,Ki=4194304;function fs(s){var r=s&42;if(r!==0)return r;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Yr(s,r,l){var u=s.pendingLanes;if(u===0)return 0;var m=0,v=s.suspendedLanes,A=s.pingedLanes;s=s.warmLanes;var k=u&134217727;return k!==0?(u=k&~v,u!==0?m=fs(u):(A&=k,A!==0?m=fs(A):l||(l=k&~s,l!==0&&(m=fs(l))))):(k=u&~v,k!==0?m=fs(k):A!==0?m=fs(A):l||(l=u&~s,l!==0&&(m=fs(l)))),m===0?0:r!==0&&r!==m&&(r&v)===0&&(v=m&-m,l=r&-r,v>=l||v===32&&(l&4194048)!==0)?r:m}function Xi(s,r){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&r)===0}function El(s,r){switch(s){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _l(){var s=Qi;return Qi<<=1,(Qi&4194048)===0&&(Qi=256),s}function Tl(){var s=Ki;return Ki<<=1,(Ki&62914560)===0&&(Ki=4194304),s}function na(s){for(var r=[],l=0;31>l;l++)r.push(s);return r}function sa(s,r){s.pendingLanes|=r,r!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function jl(s,r,l,u,m,v){var A=s.pendingLanes;s.pendingLanes=l,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=l,s.entangledLanes&=l,s.errorRecoveryDisabledLanes&=l,s.shellSuspendCounter=0;var k=s.entanglements,B=s.expirationTimes,W=s.hiddenUpdates;for(l=A&~l;0<l;){var ne=31-dn(l),re=1<<ne;k[ne]=0,B[ne]=-1;var Z=W[ne];if(Z!==null)for(W[ne]=null,ne=0;ne<Z.length;ne++){var J=Z[ne];J!==null&&(J.lane&=-536870913)}l&=~re}u!==0&&ws(s,u,0),v!==0&&m===0&&s.tag!==0&&(s.suspendedLanes|=v&~(A&~r))}function ws(s,r,l){s.pendingLanes|=r,s.suspendedLanes&=~r;var u=31-dn(r);s.entangledLanes|=r,s.entanglements[u]=s.entanglements[u]|1073741824|l&4194090}function Al(s,r){var l=s.entangledLanes|=r;for(s=s.entanglements;l;){var u=31-dn(l),m=1<<u;m&r|s[u]&r&&(s[u]|=r),l&=~m}}function Ua(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Qr(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function Fa(){var s=se.p;return s!==0?s:(s=window.event,s===void 0?32:hN(s.type))}function Iu(s,r){var l=se.p;try{return se.p=s,r()}finally{se.p=l}}var xt=Math.random().toString(36).slice(2),Vt="__reactFiber$"+xt,Dt="__reactProps$"+xt,Xn="__reactContainer$"+xt,Cl="__reactEvents$"+xt,Rf="__reactListeners$"+xt,qa="__reactHandles$"+xt,Ru="__reactResources$"+xt,Wi="__reactMarker$"+xt;function Ba(s){delete s[Vt],delete s[Dt],delete s[Cl],delete s[Rf],delete s[qa]}function aa(s){var r=s[Vt];if(r)return r;for(var l=s.parentNode;l;){if(r=l[Xn]||l[Vt]){if(l=r.alternate,r.child!==null||l!==null&&l.child!==null)for(s=Wb(s);s!==null;){if(l=s[Vt])return l;s=Wb(s)}return r}s=l,l=s.parentNode}return null}function Ss(s){if(s=s[Vt]||s[Xn]){var r=s.tag;if(r===5||r===6||r===13||r===26||r===27||r===3)return s}return null}function Is(s){var r=s.tag;if(r===5||r===26||r===27||r===6)return s.stateNode;throw Error(i(33))}function xn(s){var r=s[Ru];return r||(r=s[Ru]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function Ct(s){s[Wi]=!0}var wl=new Set,Kr={};function ms(s,r){ia(s,r),ia(s+"Capture",r)}function ia(s,r){for(Kr[s]=r,s=0;s<r.length;s++)wl.add(r[s])}var Du=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Mu={},Zi={};function ku(s){return zi.call(Zi,s)?!0:zi.call(Mu,s)?!1:Du.test(s)?Zi[s]=!0:(Mu[s]=!0,!1)}function za(s,r,l){if(ku(r))if(l===null)s.removeAttribute(r);else{switch(typeof l){case"undefined":case"function":case"symbol":s.removeAttribute(r);return;case"boolean":var u=r.toLowerCase().slice(0,5);if(u!=="data-"&&u!=="aria-"){s.removeAttribute(r);return}}s.setAttribute(r,""+l)}}function Rs(s,r,l){if(l===null)s.removeAttribute(r);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(r);return}s.setAttribute(r,""+l)}}function en(s,r,l,u){if(u===null)s.removeAttribute(l);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(l);return}s.setAttributeNS(r,l,""+u)}}var Ji,Ou;function ra(s){if(Ji===void 0)try{throw Error()}catch(l){var r=l.stack.trim().match(/\n( *(at )?)/);Ji=r&&r[1]||"",Ou=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ji+s+Ou}var Xr=!1;function Wr(s,r){if(!s||Xr)return"";Xr=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var u={DetermineComponentFrameRoot:function(){try{if(r){var re=function(){throw Error()};if(Object.defineProperty(re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(re,[])}catch(J){var Z=J}Reflect.construct(s,[],re)}else{try{re.call()}catch(J){Z=J}s.call(re.prototype)}}else{try{throw Error()}catch(J){Z=J}(re=s())&&typeof re.catch=="function"&&re.catch(function(){})}}catch(J){if(J&&Z&&typeof J.stack=="string")return[J.stack,Z.stack]}return[null,null]}};u.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(u.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(u.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var v=u.DetermineComponentFrameRoot(),A=v[0],k=v[1];if(A&&k){var B=A.split(`
`),W=k.split(`
`);for(m=u=0;u<B.length&&!B[u].includes("DetermineComponentFrameRoot");)u++;for(;m<W.length&&!W[m].includes("DetermineComponentFrameRoot");)m++;if(u===B.length||m===W.length)for(u=B.length-1,m=W.length-1;1<=u&&0<=m&&B[u]!==W[m];)m--;for(;1<=u&&0<=m;u--,m--)if(B[u]!==W[m]){if(u!==1||m!==1)do if(u--,m--,0>m||B[u]!==W[m]){var ne=`
`+B[u].replace(" at new "," at ");return s.displayName&&ne.includes("<anonymous>")&&(ne=ne.replace("<anonymous>",s.displayName)),ne}while(1<=u&&0<=m);break}}}finally{Xr=!1,Error.prepareStackTrace=l}return(l=s?s.displayName||s.name:"")?ra(l):""}function Sl(s){switch(s.tag){case 26:case 27:case 5:return ra(s.type);case 16:return ra("Lazy");case 13:return ra("Suspense");case 19:return ra("SuspenseList");case 0:case 15:return Wr(s.type,!1);case 11:return Wr(s.type.render,!1);case 1:return Wr(s.type,!0);case 31:return ra("Activity");default:return""}}function Zr(s){try{var r="";do r+=Sl(s),s=s.return;while(s);return r}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}function bn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Il(s){var r=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function Df(s){var r=Il(s)?"checked":"value",l=Object.getOwnPropertyDescriptor(s.constructor.prototype,r),u=""+s[r];if(!s.hasOwnProperty(r)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var m=l.get,v=l.set;return Object.defineProperty(s,r,{configurable:!0,get:function(){return m.call(this)},set:function(A){u=""+A,v.call(this,A)}}),Object.defineProperty(s,r,{enumerable:l.enumerable}),{getValue:function(){return u},setValue:function(A){u=""+A},stopTracking:function(){s._valueTracker=null,delete s[r]}}}}function Jr(s){s._valueTracker||(s._valueTracker=Df(s))}function Rl(s){if(!s)return!1;var r=s._valueTracker;if(!r)return!0;var l=r.getValue(),u="";return s&&(u=Il(s)?s.checked?"true":"false":s.value),s=u,s!==l?(r.setValue(s),!0):!1}function er(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Mf=/[\n"\\]/g;function Mt(s){return s.replace(Mf,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function On(s,r,l,u,m,v,A,k){s.name="",A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?s.type=A:s.removeAttribute("type"),r!=null?A==="number"?(r===0&&s.value===""||s.value!=r)&&(s.value=""+bn(r)):s.value!==""+bn(r)&&(s.value=""+bn(r)):A!=="submit"&&A!=="reset"||s.removeAttribute("value"),r!=null?Ha(s,A,bn(r)):l!=null?Ha(s,A,bn(l)):u!=null&&s.removeAttribute("value"),m==null&&v!=null&&(s.defaultChecked=!!v),m!=null&&(s.checked=m&&typeof m!="function"&&typeof m!="symbol"),k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?s.name=""+bn(k):s.removeAttribute("name")}function tr(s,r,l,u,m,v,A,k){if(v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(s.type=v),r!=null||l!=null){if(!(v!=="submit"&&v!=="reset"||r!=null))return;l=l!=null?""+bn(l):"",r=r!=null?""+bn(r):l,k||r===s.value||(s.value=r),s.defaultValue=r}u=u??m,u=typeof u!="function"&&typeof u!="symbol"&&!!u,s.checked=k?s.checked:!!u,s.defaultChecked=!!u,A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"&&(s.name=A)}function Ha(s,r,l){r==="number"&&er(s.ownerDocument)===s||s.defaultValue===""+l||(s.defaultValue=""+l)}function oa(s,r,l,u){if(s=s.options,r){r={};for(var m=0;m<l.length;m++)r["$"+l[m]]=!0;for(l=0;l<s.length;l++)m=r.hasOwnProperty("$"+s[l].value),s[l].selected!==m&&(s[l].selected=m),m&&u&&(s[l].defaultSelected=!0)}else{for(l=""+bn(l),r=null,m=0;m<s.length;m++){if(s[m].value===l){s[m].selected=!0,u&&(s[m].defaultSelected=!0);return}r!==null||s[m].disabled||(r=s[m])}r!==null&&(r.selected=!0)}}function ot(s,r,l){if(r!=null&&(r=""+bn(r),r!==s.value&&(s.value=r),l==null)){s.defaultValue!==r&&(s.defaultValue=r);return}s.defaultValue=l!=null?""+bn(l):""}function nr(s,r,l,u){if(r==null){if(u!=null){if(l!=null)throw Error(i(92));if(ve(u)){if(1<u.length)throw Error(i(93));u=u[0]}l=u}l==null&&(l=""),r=l}l=bn(r),s.defaultValue=l,u=s.textContent,u===l&&u!==""&&u!==null&&(s.value=u)}function Wn(s,r){if(r){var l=s.firstChild;if(l&&l===s.lastChild&&l.nodeType===3){l.nodeValue=r;return}}s.textContent=r}var sr=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Pu(s,r,l){var u=r.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?u?s.setProperty(r,""):r==="float"?s.cssFloat="":s[r]="":u?s.setProperty(r,l):typeof l!="number"||l===0||sr.has(r)?r==="float"?s.cssFloat=l:s[r]=(""+l).trim():s[r]=l+"px"}function Dl(s,r,l){if(r!=null&&typeof r!="object")throw Error(i(62));if(s=s.style,l!=null){for(var u in l)!l.hasOwnProperty(u)||r!=null&&r.hasOwnProperty(u)||(u.indexOf("--")===0?s.setProperty(u,""):u==="float"?s.cssFloat="":s[u]="");for(var m in r)u=r[m],r.hasOwnProperty(m)&&l[m]!==u&&Pu(s,m,u)}else for(var v in r)r.hasOwnProperty(v)&&Pu(s,v,r[v])}function Ml(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kf=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Of=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function eo(s){return Of.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var la=null;function Zn(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var ca=null,ua=null;function kl(s){var r=Ss(s);if(r&&(s=r.stateNode)){var l=s[Dt]||null;e:switch(s=r.stateNode,r.type){case"input":if(On(s,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),r=l.name,l.type==="radio"&&r!=null){for(l=s;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+Mt(""+r)+'"][type="radio"]'),r=0;r<l.length;r++){var u=l[r];if(u!==s&&u.form===s.form){var m=u[Dt]||null;if(!m)throw Error(i(90));On(u,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(r=0;r<l.length;r++)u=l[r],u.form===s.form&&Rl(u)}break e;case"textarea":ot(s,l.value,l.defaultValue);break e;case"select":r=l.value,r!=null&&oa(s,!!l.multiple,r,!1)}}}var Ds=!1;function Lu(s,r,l){if(Ds)return s(r,l);Ds=!0;try{var u=s(r);return u}finally{if(Ds=!1,(ca!==null||ua!==null)&&(Id(),ca&&(r=ca,s=ua,ua=ca=null,kl(r),s)))for(r=0;r<s.length;r++)kl(s[r])}}function ar(s,r){var l=s.stateNode;if(l===null)return null;var u=l[Dt]||null;if(u===null)return null;l=u[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(s=s.type,u=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!u;break e;default:s=!1}if(s)return null;if(l&&typeof l!="function")throw Error(i(231,r,typeof l));return l}var ps=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Jn=!1;if(ps)try{var ir={};Object.defineProperty(ir,"passive",{get:function(){Jn=!0}}),window.addEventListener("test",ir,ir),window.removeEventListener("test",ir,ir)}catch{Jn=!1}var Ms=null,Ga=null,da=null;function Ol(){if(da)return da;var s,r=Ga,l=r.length,u,m="value"in Ms?Ms.value:Ms.textContent,v=m.length;for(s=0;s<l&&r[s]===m[s];s++);var A=l-s;for(u=1;u<=A&&r[l-u]===m[v-u];u++);return da=m.slice(s,1<u?1-u:void 0)}function ks(s){var r=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&r===13&&(s=13)):s=r,s===10&&(s=13),32<=s||s===13?s:0}function Os(){return!0}function Pl(){return!1}function Yt(s){function r(l,u,m,v,A){this._reactName=l,this._targetInst=m,this.type=u,this.nativeEvent=v,this.target=A,this.currentTarget=null;for(var k in s)s.hasOwnProperty(k)&&(l=s[k],this[k]=l?l(v):v[k]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?Os:Pl,this.isPropagationStopped=Pl,this}return y(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Os)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Os)},persist:function(){},isPersistent:Os}),r}var st={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},to=Yt(st),rr=y({},st,{view:0,detail:0}),Vu=Yt(rr),no,so,Ps,or=y({},rr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ur,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Ps&&(Ps&&s.type==="mousemove"?(no=s.screenX-Ps.screenX,so=s.screenY-Ps.screenY):so=no=0,Ps=s),no)},movementY:function(s){return"movementY"in s?s.movementY:so}}),es=Yt(or),Uu=y({},or,{dataTransfer:0}),Pf=Yt(Uu),lr=y({},rr,{relatedTarget:0}),ao=Yt(lr),Ll=y({},st,{animationName:0,elapsedTime:0,pseudoElement:0}),io=Yt(Ll),Fu=y({},st,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),ro=Yt(Fu),Lf=y({},st,{data:0}),Vl=Yt(Lf),cr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qu={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Bu={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ul(s){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(s):(s=Bu[s])?!!r[s]:!1}function ur(){return Ul}var zu=y({},rr,{key:function(s){if(s.key){var r=cr[s.key]||s.key;if(r!=="Unidentified")return r}return s.type==="keypress"?(s=ks(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?qu[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ur,charCode:function(s){return s.type==="keypress"?ks(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?ks(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),oo=Yt(zu),Hu=y({},or,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fl=Yt(Hu),ha=y({},rr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ur}),Gu=Yt(ha),$u=y({},st,{propertyName:0,elapsedTime:0,pseudoElement:0}),Yu=Yt($u),Qu=y({},or,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),lo=Yt(Qu),Nn=y({},st,{newState:0,oldState:0}),Ku=Yt(Nn),Xu=[9,13,27,32],Ls=ps&&"CompositionEvent"in window,h=null;ps&&"documentMode"in document&&(h=document.documentMode);var x=ps&&"TextEvent"in window&&!h,_=ps&&(!Ls||h&&8<h&&11>=h),L=" ",K=!1;function te(s,r){switch(s){case"keyup":return Xu.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fe(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Ke=!1;function Ut(s,r){switch(s){case"compositionend":return fe(r);case"keypress":return r.which!==32?null:(K=!0,L);case"textInput":return s=r.data,s===L&&K?null:s;default:return null}}function Xe(s,r){if(Ke)return s==="compositionend"||!Ls&&te(s,r)?(s=Ol(),da=Ga=Ms=null,Ke=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return _&&r.locale!=="ko"?null:r.data;default:return null}}var Qt={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ft(s){var r=s&&s.nodeName&&s.nodeName.toLowerCase();return r==="input"?!!Qt[s.type]:r==="textarea"}function fa(s,r,l,u){ca?ua?ua.push(u):ua=[u]:ca=u,r=Pd(r,"onChange"),0<r.length&&(l=new to("onChange","change",null,l,u),s.push({event:l,listeners:r}))}var tn=null,Vs=null;function ql(s){qb(s,0)}function Wu(s){var r=Is(s);if(Rl(r))return s}function ly(s,r){if(s==="change")return r}var cy=!1;if(ps){var Vf;if(ps){var Uf="oninput"in document;if(!Uf){var uy=document.createElement("div");uy.setAttribute("oninput","return;"),Uf=typeof uy.oninput=="function"}Vf=Uf}else Vf=!1;cy=Vf&&(!document.documentMode||9<document.documentMode)}function dy(){tn&&(tn.detachEvent("onpropertychange",hy),Vs=tn=null)}function hy(s){if(s.propertyName==="value"&&Wu(Vs)){var r=[];fa(r,Vs,s,Zn(s)),Lu(ql,r)}}function iC(s,r,l){s==="focusin"?(dy(),tn=r,Vs=l,tn.attachEvent("onpropertychange",hy)):s==="focusout"&&dy()}function rC(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Wu(Vs)}function oC(s,r){if(s==="click")return Wu(r)}function lC(s,r){if(s==="input"||s==="change")return Wu(r)}function cC(s,r){return s===r&&(s!==0||1/s===1/r)||s!==s&&r!==r}var Pn=typeof Object.is=="function"?Object.is:cC;function Bl(s,r){if(Pn(s,r))return!0;if(typeof s!="object"||s===null||typeof r!="object"||r===null)return!1;var l=Object.keys(s),u=Object.keys(r);if(l.length!==u.length)return!1;for(u=0;u<l.length;u++){var m=l[u];if(!zi.call(r,m)||!Pn(s[m],r[m]))return!1}return!0}function fy(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function my(s,r){var l=fy(s);s=0;for(var u;l;){if(l.nodeType===3){if(u=s+l.textContent.length,s<=r&&u>=r)return{node:l,offset:r-s};s=u}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=fy(l)}}function py(s,r){return s&&r?s===r?!0:s&&s.nodeType===3?!1:r&&r.nodeType===3?py(s,r.parentNode):"contains"in s?s.contains(r):s.compareDocumentPosition?!!(s.compareDocumentPosition(r)&16):!1:!1}function gy(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var r=er(s.document);r instanceof s.HTMLIFrameElement;){try{var l=typeof r.contentWindow.location.href=="string"}catch{l=!1}if(l)s=r.contentWindow;else break;r=er(s.document)}return r}function Ff(s){var r=s&&s.nodeName&&s.nodeName.toLowerCase();return r&&(r==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||r==="textarea"||s.contentEditable==="true")}var uC=ps&&"documentMode"in document&&11>=document.documentMode,co=null,qf=null,zl=null,Bf=!1;function vy(s,r,l){var u=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Bf||co==null||co!==er(u)||(u=co,"selectionStart"in u&&Ff(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),zl&&Bl(zl,u)||(zl=u,u=Pd(qf,"onSelect"),0<u.length&&(r=new to("onSelect","select",null,r,l),s.push({event:r,listeners:u}),r.target=co)))}function dr(s,r){var l={};return l[s.toLowerCase()]=r.toLowerCase(),l["Webkit"+s]="webkit"+r,l["Moz"+s]="moz"+r,l}var uo={animationend:dr("Animation","AnimationEnd"),animationiteration:dr("Animation","AnimationIteration"),animationstart:dr("Animation","AnimationStart"),transitionrun:dr("Transition","TransitionRun"),transitionstart:dr("Transition","TransitionStart"),transitioncancel:dr("Transition","TransitionCancel"),transitionend:dr("Transition","TransitionEnd")},zf={},yy={};ps&&(yy=document.createElement("div").style,"AnimationEvent"in window||(delete uo.animationend.animation,delete uo.animationiteration.animation,delete uo.animationstart.animation),"TransitionEvent"in window||delete uo.transitionend.transition);function hr(s){if(zf[s])return zf[s];if(!uo[s])return s;var r=uo[s],l;for(l in r)if(r.hasOwnProperty(l)&&l in yy)return zf[s]=r[l];return s}var xy=hr("animationend"),by=hr("animationiteration"),Ny=hr("animationstart"),dC=hr("transitionrun"),hC=hr("transitionstart"),fC=hr("transitioncancel"),Ey=hr("transitionend"),_y=new Map,Hf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Hf.push("scrollEnd");function gs(s,r){_y.set(s,r),ms(r,[s])}var Ty=new WeakMap;function ts(s,r){if(typeof s=="object"&&s!==null){var l=Ty.get(s);return l!==void 0?l:(r={value:s,source:r,stack:Zr(r)},Ty.set(s,r),r)}return{value:s,source:r,stack:Zr(r)}}var ns=[],ho=0,Gf=0;function Zu(){for(var s=ho,r=Gf=ho=0;r<s;){var l=ns[r];ns[r++]=null;var u=ns[r];ns[r++]=null;var m=ns[r];ns[r++]=null;var v=ns[r];if(ns[r++]=null,u!==null&&m!==null){var A=u.pending;A===null?m.next=m:(m.next=A.next,A.next=m),u.pending=m}v!==0&&jy(l,m,v)}}function Ju(s,r,l,u){ns[ho++]=s,ns[ho++]=r,ns[ho++]=l,ns[ho++]=u,Gf|=u,s.lanes|=u,s=s.alternate,s!==null&&(s.lanes|=u)}function $f(s,r,l,u){return Ju(s,r,l,u),ed(s)}function fo(s,r){return Ju(s,null,null,r),ed(s)}function jy(s,r,l){s.lanes|=l;var u=s.alternate;u!==null&&(u.lanes|=l);for(var m=!1,v=s.return;v!==null;)v.childLanes|=l,u=v.alternate,u!==null&&(u.childLanes|=l),v.tag===22&&(s=v.stateNode,s===null||s._visibility&1||(m=!0)),s=v,v=v.return;return s.tag===3?(v=s.stateNode,m&&r!==null&&(m=31-dn(l),s=v.hiddenUpdates,u=s[m],u===null?s[m]=[r]:u.push(r),r.lane=l|536870912),v):null}function ed(s){if(50<mc)throw mc=0,Zm=null,Error(i(185));for(var r=s.return;r!==null;)s=r,r=s.return;return s.tag===3?s.stateNode:null}var mo={};function mC(s,r,l,u){this.tag=s,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ln(s,r,l,u){return new mC(s,r,l,u)}function Yf(s){return s=s.prototype,!(!s||!s.isReactComponent)}function ma(s,r){var l=s.alternate;return l===null?(l=Ln(s.tag,r,s.key,s.mode),l.elementType=s.elementType,l.type=s.type,l.stateNode=s.stateNode,l.alternate=s,s.alternate=l):(l.pendingProps=r,l.type=s.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=s.flags&65011712,l.childLanes=s.childLanes,l.lanes=s.lanes,l.child=s.child,l.memoizedProps=s.memoizedProps,l.memoizedState=s.memoizedState,l.updateQueue=s.updateQueue,r=s.dependencies,l.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},l.sibling=s.sibling,l.index=s.index,l.ref=s.ref,l.refCleanup=s.refCleanup,l}function Ay(s,r){s.flags&=65011714;var l=s.alternate;return l===null?(s.childLanes=0,s.lanes=r,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,r=l.dependencies,s.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),s}function td(s,r,l,u,m,v){var A=0;if(u=s,typeof s=="function")Yf(s)&&(A=1);else if(typeof s=="string")A=gw(s,l,Te.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case V:return s=Ln(31,l,r,m),s.elementType=V,s.lanes=v,s;case N:return fr(l.children,m,v,r);case w:A=8,m|=24;break;case T:return s=Ln(12,l,r,m|2),s.elementType=T,s.lanes=v,s;case U:return s=Ln(13,l,r,m),s.elementType=U,s.lanes=v,s;case $:return s=Ln(19,l,r,m),s.elementType=$,s.lanes=v,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case S:case I:A=10;break e;case q:A=9;break e;case O:A=11;break e;case F:A=14;break e;case R:A=16,u=null;break e}A=29,l=Error(i(130,s===null?"null":typeof s,"")),u=null}return r=Ln(A,l,r,m),r.elementType=s,r.type=u,r.lanes=v,r}function fr(s,r,l,u){return s=Ln(7,s,u,r),s.lanes=l,s}function Qf(s,r,l){return s=Ln(6,s,null,r),s.lanes=l,s}function Kf(s,r,l){return r=Ln(4,s.children!==null?s.children:[],s.key,r),r.lanes=l,r.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},r}var po=[],go=0,nd=null,sd=0,ss=[],as=0,mr=null,pa=1,ga="";function pr(s,r){po[go++]=sd,po[go++]=nd,nd=s,sd=r}function Cy(s,r,l){ss[as++]=pa,ss[as++]=ga,ss[as++]=mr,mr=s;var u=pa;s=ga;var m=32-dn(u)-1;u&=~(1<<m),l+=1;var v=32-dn(r)+m;if(30<v){var A=m-m%5;v=(u&(1<<A)-1).toString(32),u>>=A,m-=A,pa=1<<32-dn(r)+m|l<<m|u,ga=v+s}else pa=1<<v|l<<m|u,ga=s}function Xf(s){s.return!==null&&(pr(s,1),Cy(s,1,0))}function Wf(s){for(;s===nd;)nd=po[--go],po[go]=null,sd=po[--go],po[go]=null;for(;s===mr;)mr=ss[--as],ss[as]=null,ga=ss[--as],ss[as]=null,pa=ss[--as],ss[as]=null}var En=null,jt=null,nt=!1,gr=null,Us=!1,Zf=Error(i(519));function vr(s){var r=Error(i(418,""));throw $l(ts(r,s)),Zf}function wy(s){var r=s.stateNode,l=s.type,u=s.memoizedProps;switch(r[Vt]=s,r[Dt]=u,l){case"dialog":$e("cancel",r),$e("close",r);break;case"iframe":case"object":case"embed":$e("load",r);break;case"video":case"audio":for(l=0;l<gc.length;l++)$e(gc[l],r);break;case"source":$e("error",r);break;case"img":case"image":case"link":$e("error",r),$e("load",r);break;case"details":$e("toggle",r);break;case"input":$e("invalid",r),tr(r,u.value,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name,!0),Jr(r);break;case"select":$e("invalid",r);break;case"textarea":$e("invalid",r),nr(r,u.value,u.defaultValue,u.children),Jr(r)}l=u.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||r.textContent===""+l||u.suppressHydrationWarning===!0||Gb(r.textContent,l)?(u.popover!=null&&($e("beforetoggle",r),$e("toggle",r)),u.onScroll!=null&&$e("scroll",r),u.onScrollEnd!=null&&$e("scrollend",r),u.onClick!=null&&(r.onclick=Ld),r=!0):r=!1,r||vr(s)}function Sy(s){for(En=s.return;En;)switch(En.tag){case 5:case 13:Us=!1;return;case 27:case 3:Us=!0;return;default:En=En.return}}function Hl(s){if(s!==En)return!1;if(!nt)return Sy(s),nt=!0,!1;var r=s.tag,l;if((l=r!==3&&r!==27)&&((l=r===5)&&(l=s.type,l=!(l!=="form"&&l!=="button")||mp(s.type,s.memoizedProps)),l=!l),l&&jt&&vr(s),Sy(s),r===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(317));e:{for(s=s.nextSibling,r=0;s;){if(s.nodeType===8)if(l=s.data,l==="/$"){if(r===0){jt=ys(s.nextSibling);break e}r--}else l!=="$"&&l!=="$!"&&l!=="$?"||r++;s=s.nextSibling}jt=null}}else r===27?(r=jt,oi(s.type)?(s=yp,yp=null,jt=s):jt=r):jt=En?ys(s.stateNode.nextSibling):null;return!0}function Gl(){jt=En=null,nt=!1}function Iy(){var s=gr;return s!==null&&(In===null?In=s:In.push.apply(In,s),gr=null),s}function $l(s){gr===null?gr=[s]:gr.push(s)}var Jf=ee(null),yr=null,va=null;function $a(s,r,l){ue(Jf,r._currentValue),r._currentValue=l}function ya(s){s._currentValue=Jf.current,ce(Jf)}function em(s,r,l){for(;s!==null;){var u=s.alternate;if((s.childLanes&r)!==r?(s.childLanes|=r,u!==null&&(u.childLanes|=r)):u!==null&&(u.childLanes&r)!==r&&(u.childLanes|=r),s===l)break;s=s.return}}function tm(s,r,l,u){var m=s.child;for(m!==null&&(m.return=s);m!==null;){var v=m.dependencies;if(v!==null){var A=m.child;v=v.firstContext;e:for(;v!==null;){var k=v;v=m;for(var B=0;B<r.length;B++)if(k.context===r[B]){v.lanes|=l,k=v.alternate,k!==null&&(k.lanes|=l),em(v.return,l,s),u||(A=null);break e}v=k.next}}else if(m.tag===18){if(A=m.return,A===null)throw Error(i(341));A.lanes|=l,v=A.alternate,v!==null&&(v.lanes|=l),em(A,l,s),A=null}else A=m.child;if(A!==null)A.return=m;else for(A=m;A!==null;){if(A===s){A=null;break}if(m=A.sibling,m!==null){m.return=A.return,A=m;break}A=A.return}m=A}}function Yl(s,r,l,u){s=null;for(var m=r,v=!1;m!==null;){if(!v){if((m.flags&524288)!==0)v=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var A=m.alternate;if(A===null)throw Error(i(387));if(A=A.memoizedProps,A!==null){var k=m.type;Pn(m.pendingProps.value,A.value)||(s!==null?s.push(k):s=[k])}}else if(m===$t.current){if(A=m.alternate,A===null)throw Error(i(387));A.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(s!==null?s.push(Ec):s=[Ec])}m=m.return}s!==null&&tm(r,s,l,u),r.flags|=262144}function ad(s){for(s=s.firstContext;s!==null;){if(!Pn(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function xr(s){yr=s,va=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function hn(s){return Ry(yr,s)}function id(s,r){return yr===null&&xr(s),Ry(s,r)}function Ry(s,r){var l=r._currentValue;if(r={context:r,memoizedValue:l,next:null},va===null){if(s===null)throw Error(i(308));va=r,s.dependencies={lanes:0,firstContext:r},s.flags|=524288}else va=va.next=r;return l}var pC=typeof AbortController<"u"?AbortController:function(){var s=[],r=this.signal={aborted:!1,addEventListener:function(l,u){s.push(u)}};this.abort=function(){r.aborted=!0,s.forEach(function(l){return l()})}},gC=n.unstable_scheduleCallback,vC=n.unstable_NormalPriority,qt={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function nm(){return{controller:new pC,data:new Map,refCount:0}}function Ql(s){s.refCount--,s.refCount===0&&gC(vC,function(){s.controller.abort()})}var Kl=null,sm=0,vo=0,yo=null;function yC(s,r){if(Kl===null){var l=Kl=[];sm=0,vo=ip(),yo={status:"pending",value:void 0,then:function(u){l.push(u)}}}return sm++,r.then(Dy,Dy),r}function Dy(){if(--sm===0&&Kl!==null){yo!==null&&(yo.status="fulfilled");var s=Kl;Kl=null,vo=0,yo=null;for(var r=0;r<s.length;r++)(0,s[r])()}}function xC(s,r){var l=[],u={status:"pending",value:null,reason:null,then:function(m){l.push(m)}};return s.then(function(){u.status="fulfilled",u.value=r;for(var m=0;m<l.length;m++)(0,l[m])(r)},function(m){for(u.status="rejected",u.reason=m,m=0;m<l.length;m++)(0,l[m])(void 0)}),u}var My=Q.S;Q.S=function(s,r){typeof r=="object"&&r!==null&&typeof r.then=="function"&&yC(s,r),My!==null&&My(s,r)};var br=ee(null);function am(){var s=br.current;return s!==null?s:pt.pooledCache}function rd(s,r){r===null?ue(br,br.current):ue(br,r.pool)}function ky(){var s=am();return s===null?null:{parent:qt._currentValue,pool:s}}var Xl=Error(i(460)),Oy=Error(i(474)),od=Error(i(542)),im={then:function(){}};function Py(s){return s=s.status,s==="fulfilled"||s==="rejected"}function ld(){}function Ly(s,r,l){switch(l=s[l],l===void 0?s.push(r):l!==r&&(r.then(ld,ld),r=l),r.status){case"fulfilled":return r.value;case"rejected":throw s=r.reason,Uy(s),s;default:if(typeof r.status=="string")r.then(ld,ld);else{if(s=pt,s!==null&&100<s.shellSuspendCounter)throw Error(i(482));s=r,s.status="pending",s.then(function(u){if(r.status==="pending"){var m=r;m.status="fulfilled",m.value=u}},function(u){if(r.status==="pending"){var m=r;m.status="rejected",m.reason=u}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw s=r.reason,Uy(s),s}throw Wl=r,Xl}}var Wl=null;function Vy(){if(Wl===null)throw Error(i(459));var s=Wl;return Wl=null,s}function Uy(s){if(s===Xl||s===od)throw Error(i(483))}var Ya=!1;function rm(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function om(s,r){s=s.updateQueue,r.updateQueue===s&&(r.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Qa(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Ka(s,r,l){var u=s.updateQueue;if(u===null)return null;if(u=u.shared,(it&2)!==0){var m=u.pending;return m===null?r.next=r:(r.next=m.next,m.next=r),u.pending=r,r=ed(s),jy(s,null,l),r}return Ju(s,u,r,l),ed(s)}function Zl(s,r,l){if(r=r.updateQueue,r!==null&&(r=r.shared,(l&4194048)!==0)){var u=r.lanes;u&=s.pendingLanes,l|=u,r.lanes=l,Al(s,l)}}function lm(s,r){var l=s.updateQueue,u=s.alternate;if(u!==null&&(u=u.updateQueue,l===u)){var m=null,v=null;if(l=l.firstBaseUpdate,l!==null){do{var A={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};v===null?m=v=A:v=v.next=A,l=l.next}while(l!==null);v===null?m=v=r:v=v.next=r}else m=v=r;l={baseState:u.baseState,firstBaseUpdate:m,lastBaseUpdate:v,shared:u.shared,callbacks:u.callbacks},s.updateQueue=l;return}s=l.lastBaseUpdate,s===null?l.firstBaseUpdate=r:s.next=r,l.lastBaseUpdate=r}var cm=!1;function Jl(){if(cm){var s=yo;if(s!==null)throw s}}function ec(s,r,l,u){cm=!1;var m=s.updateQueue;Ya=!1;var v=m.firstBaseUpdate,A=m.lastBaseUpdate,k=m.shared.pending;if(k!==null){m.shared.pending=null;var B=k,W=B.next;B.next=null,A===null?v=W:A.next=W,A=B;var ne=s.alternate;ne!==null&&(ne=ne.updateQueue,k=ne.lastBaseUpdate,k!==A&&(k===null?ne.firstBaseUpdate=W:k.next=W,ne.lastBaseUpdate=B))}if(v!==null){var re=m.baseState;A=0,ne=W=B=null,k=v;do{var Z=k.lane&-536870913,J=Z!==k.lane;if(J?(We&Z)===Z:(u&Z)===Z){Z!==0&&Z===vo&&(cm=!0),ne!==null&&(ne=ne.next={lane:0,tag:k.tag,payload:k.payload,callback:null,next:null});e:{var Re=s,Ce=k;Z=r;var ut=l;switch(Ce.tag){case 1:if(Re=Ce.payload,typeof Re=="function"){re=Re.call(ut,re,Z);break e}re=Re;break e;case 3:Re.flags=Re.flags&-65537|128;case 0:if(Re=Ce.payload,Z=typeof Re=="function"?Re.call(ut,re,Z):Re,Z==null)break e;re=y({},re,Z);break e;case 2:Ya=!0}}Z=k.callback,Z!==null&&(s.flags|=64,J&&(s.flags|=8192),J=m.callbacks,J===null?m.callbacks=[Z]:J.push(Z))}else J={lane:Z,tag:k.tag,payload:k.payload,callback:k.callback,next:null},ne===null?(W=ne=J,B=re):ne=ne.next=J,A|=Z;if(k=k.next,k===null){if(k=m.shared.pending,k===null)break;J=k,k=J.next,J.next=null,m.lastBaseUpdate=J,m.shared.pending=null}}while(!0);ne===null&&(B=re),m.baseState=B,m.firstBaseUpdate=W,m.lastBaseUpdate=ne,v===null&&(m.shared.lanes=0),si|=A,s.lanes=A,s.memoizedState=re}}function Fy(s,r){if(typeof s!="function")throw Error(i(191,s));s.call(r)}function qy(s,r){var l=s.callbacks;if(l!==null)for(s.callbacks=null,s=0;s<l.length;s++)Fy(l[s],r)}var xo=ee(null),cd=ee(0);function By(s,r){s=ja,ue(cd,s),ue(xo,r),ja=s|r.baseLanes}function um(){ue(cd,ja),ue(xo,xo.current)}function dm(){ja=cd.current,ce(xo),ce(cd)}var Xa=0,Fe=null,lt=null,kt=null,ud=!1,bo=!1,Nr=!1,dd=0,tc=0,No=null,bC=0;function wt(){throw Error(i(321))}function hm(s,r){if(r===null)return!1;for(var l=0;l<r.length&&l<s.length;l++)if(!Pn(s[l],r[l]))return!1;return!0}function fm(s,r,l,u,m,v){return Xa=v,Fe=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,Q.H=s===null||s.memoizedState===null?jx:Ax,Nr=!1,v=l(u,m),Nr=!1,bo&&(v=Hy(r,l,u,m)),zy(s),v}function zy(s){Q.H=vd;var r=lt!==null&&lt.next!==null;if(Xa=0,kt=lt=Fe=null,ud=!1,tc=0,No=null,r)throw Error(i(300));s===null||Kt||(s=s.dependencies,s!==null&&ad(s)&&(Kt=!0))}function Hy(s,r,l,u){Fe=s;var m=0;do{if(bo&&(No=null),tc=0,bo=!1,25<=m)throw Error(i(301));if(m+=1,kt=lt=null,s.updateQueue!=null){var v=s.updateQueue;v.lastEffect=null,v.events=null,v.stores=null,v.memoCache!=null&&(v.memoCache.index=0)}Q.H=CC,v=r(l,u)}while(bo);return v}function NC(){var s=Q.H,r=s.useState()[0];return r=typeof r.then=="function"?nc(r):r,s=s.useState()[0],(lt!==null?lt.memoizedState:null)!==s&&(Fe.flags|=1024),r}function mm(){var s=dd!==0;return dd=0,s}function pm(s,r,l){r.updateQueue=s.updateQueue,r.flags&=-2053,s.lanes&=~l}function gm(s){if(ud){for(s=s.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}ud=!1}Xa=0,kt=lt=Fe=null,bo=!1,tc=dd=0,No=null}function wn(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return kt===null?Fe.memoizedState=kt=s:kt=kt.next=s,kt}function Ot(){if(lt===null){var s=Fe.alternate;s=s!==null?s.memoizedState:null}else s=lt.next;var r=kt===null?Fe.memoizedState:kt.next;if(r!==null)kt=r,lt=s;else{if(s===null)throw Fe.alternate===null?Error(i(467)):Error(i(310));lt=s,s={memoizedState:lt.memoizedState,baseState:lt.baseState,baseQueue:lt.baseQueue,queue:lt.queue,next:null},kt===null?Fe.memoizedState=kt=s:kt=kt.next=s}return kt}function vm(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function nc(s){var r=tc;return tc+=1,No===null&&(No=[]),s=Ly(No,s,r),r=Fe,(kt===null?r.memoizedState:kt.next)===null&&(r=r.alternate,Q.H=r===null||r.memoizedState===null?jx:Ax),s}function hd(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return nc(s);if(s.$$typeof===I)return hn(s)}throw Error(i(438,String(s)))}function ym(s){var r=null,l=Fe.updateQueue;if(l!==null&&(r=l.memoCache),r==null){var u=Fe.alternate;u!==null&&(u=u.updateQueue,u!==null&&(u=u.memoCache,u!=null&&(r={data:u.data.map(function(m){return m.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),l===null&&(l=vm(),Fe.updateQueue=l),l.memoCache=r,l=r.data[r.index],l===void 0)for(l=r.data[r.index]=Array(s),u=0;u<s;u++)l[u]=P;return r.index++,l}function xa(s,r){return typeof r=="function"?r(s):r}function fd(s){var r=Ot();return xm(r,lt,s)}function xm(s,r,l){var u=s.queue;if(u===null)throw Error(i(311));u.lastRenderedReducer=l;var m=s.baseQueue,v=u.pending;if(v!==null){if(m!==null){var A=m.next;m.next=v.next,v.next=A}r.baseQueue=m=v,u.pending=null}if(v=s.baseState,m===null)s.memoizedState=v;else{r=m.next;var k=A=null,B=null,W=r,ne=!1;do{var re=W.lane&-536870913;if(re!==W.lane?(We&re)===re:(Xa&re)===re){var Z=W.revertLane;if(Z===0)B!==null&&(B=B.next={lane:0,revertLane:0,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null}),re===vo&&(ne=!0);else if((Xa&Z)===Z){W=W.next,Z===vo&&(ne=!0);continue}else re={lane:0,revertLane:W.revertLane,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null},B===null?(k=B=re,A=v):B=B.next=re,Fe.lanes|=Z,si|=Z;re=W.action,Nr&&l(v,re),v=W.hasEagerState?W.eagerState:l(v,re)}else Z={lane:re,revertLane:W.revertLane,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null},B===null?(k=B=Z,A=v):B=B.next=Z,Fe.lanes|=re,si|=re;W=W.next}while(W!==null&&W!==r);if(B===null?A=v:B.next=k,!Pn(v,s.memoizedState)&&(Kt=!0,ne&&(l=yo,l!==null)))throw l;s.memoizedState=v,s.baseState=A,s.baseQueue=B,u.lastRenderedState=v}return m===null&&(u.lanes=0),[s.memoizedState,u.dispatch]}function bm(s){var r=Ot(),l=r.queue;if(l===null)throw Error(i(311));l.lastRenderedReducer=s;var u=l.dispatch,m=l.pending,v=r.memoizedState;if(m!==null){l.pending=null;var A=m=m.next;do v=s(v,A.action),A=A.next;while(A!==m);Pn(v,r.memoizedState)||(Kt=!0),r.memoizedState=v,r.baseQueue===null&&(r.baseState=v),l.lastRenderedState=v}return[v,u]}function Gy(s,r,l){var u=Fe,m=Ot(),v=nt;if(v){if(l===void 0)throw Error(i(407));l=l()}else l=r();var A=!Pn((lt||m).memoizedState,l);A&&(m.memoizedState=l,Kt=!0),m=m.queue;var k=Qy.bind(null,u,m,s);if(sc(2048,8,k,[s]),m.getSnapshot!==r||A||kt!==null&&kt.memoizedState.tag&1){if(u.flags|=2048,Eo(9,md(),Yy.bind(null,u,m,l,r),null),pt===null)throw Error(i(349));v||(Xa&124)!==0||$y(u,r,l)}return l}function $y(s,r,l){s.flags|=16384,s={getSnapshot:r,value:l},r=Fe.updateQueue,r===null?(r=vm(),Fe.updateQueue=r,r.stores=[s]):(l=r.stores,l===null?r.stores=[s]:l.push(s))}function Yy(s,r,l,u){r.value=l,r.getSnapshot=u,Ky(r)&&Xy(s)}function Qy(s,r,l){return l(function(){Ky(r)&&Xy(s)})}function Ky(s){var r=s.getSnapshot;s=s.value;try{var l=r();return!Pn(s,l)}catch{return!0}}function Xy(s){var r=fo(s,2);r!==null&&Bn(r,s,2)}function Nm(s){var r=wn();if(typeof s=="function"){var l=s;if(s=l(),Nr){kn(!0);try{l()}finally{kn(!1)}}}return r.memoizedState=r.baseState=s,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:xa,lastRenderedState:s},r}function Wy(s,r,l,u){return s.baseState=l,xm(s,lt,typeof u=="function"?u:xa)}function EC(s,r,l,u,m){if(gd(s))throw Error(i(485));if(s=r.action,s!==null){var v={payload:m,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(A){v.listeners.push(A)}};Q.T!==null?l(!0):v.isTransition=!1,u(v),l=r.pending,l===null?(v.next=r.pending=v,Zy(r,v)):(v.next=l.next,r.pending=l.next=v)}}function Zy(s,r){var l=r.action,u=r.payload,m=s.state;if(r.isTransition){var v=Q.T,A={};Q.T=A;try{var k=l(m,u),B=Q.S;B!==null&&B(A,k),Jy(s,r,k)}catch(W){Em(s,r,W)}finally{Q.T=v}}else try{v=l(m,u),Jy(s,r,v)}catch(W){Em(s,r,W)}}function Jy(s,r,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(u){ex(s,r,u)},function(u){return Em(s,r,u)}):ex(s,r,l)}function ex(s,r,l){r.status="fulfilled",r.value=l,tx(r),s.state=l,r=s.pending,r!==null&&(l=r.next,l===r?s.pending=null:(l=l.next,r.next=l,Zy(s,l)))}function Em(s,r,l){var u=s.pending;if(s.pending=null,u!==null){u=u.next;do r.status="rejected",r.reason=l,tx(r),r=r.next;while(r!==u)}s.action=null}function tx(s){s=s.listeners;for(var r=0;r<s.length;r++)(0,s[r])()}function nx(s,r){return r}function sx(s,r){if(nt){var l=pt.formState;if(l!==null){e:{var u=Fe;if(nt){if(jt){t:{for(var m=jt,v=Us;m.nodeType!==8;){if(!v){m=null;break t}if(m=ys(m.nextSibling),m===null){m=null;break t}}v=m.data,m=v==="F!"||v==="F"?m:null}if(m){jt=ys(m.nextSibling),u=m.data==="F!";break e}}vr(u)}u=!1}u&&(r=l[0])}}return l=wn(),l.memoizedState=l.baseState=r,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:nx,lastRenderedState:r},l.queue=u,l=Ex.bind(null,Fe,u),u.dispatch=l,u=Nm(!1),v=Cm.bind(null,Fe,!1,u.queue),u=wn(),m={state:r,dispatch:null,action:s,pending:null},u.queue=m,l=EC.bind(null,Fe,m,v,l),m.dispatch=l,u.memoizedState=s,[r,l,!1]}function ax(s){var r=Ot();return ix(r,lt,s)}function ix(s,r,l){if(r=xm(s,r,nx)[0],s=fd(xa)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var u=nc(r)}catch(A){throw A===Xl?od:A}else u=r;r=Ot();var m=r.queue,v=m.dispatch;return l!==r.memoizedState&&(Fe.flags|=2048,Eo(9,md(),_C.bind(null,m,l),null)),[u,v,s]}function _C(s,r){s.action=r}function rx(s){var r=Ot(),l=lt;if(l!==null)return ix(r,l,s);Ot(),r=r.memoizedState,l=Ot();var u=l.queue.dispatch;return l.memoizedState=s,[r,u,!1]}function Eo(s,r,l,u){return s={tag:s,create:l,deps:u,inst:r,next:null},r=Fe.updateQueue,r===null&&(r=vm(),Fe.updateQueue=r),l=r.lastEffect,l===null?r.lastEffect=s.next=s:(u=l.next,l.next=s,s.next=u,r.lastEffect=s),s}function md(){return{destroy:void 0,resource:void 0}}function ox(){return Ot().memoizedState}function pd(s,r,l,u){var m=wn();u=u===void 0?null:u,Fe.flags|=s,m.memoizedState=Eo(1|r,md(),l,u)}function sc(s,r,l,u){var m=Ot();u=u===void 0?null:u;var v=m.memoizedState.inst;lt!==null&&u!==null&&hm(u,lt.memoizedState.deps)?m.memoizedState=Eo(r,v,l,u):(Fe.flags|=s,m.memoizedState=Eo(1|r,v,l,u))}function lx(s,r){pd(8390656,8,s,r)}function cx(s,r){sc(2048,8,s,r)}function ux(s,r){return sc(4,2,s,r)}function dx(s,r){return sc(4,4,s,r)}function hx(s,r){if(typeof r=="function"){s=s();var l=r(s);return function(){typeof l=="function"?l():r(null)}}if(r!=null)return s=s(),r.current=s,function(){r.current=null}}function fx(s,r,l){l=l!=null?l.concat([s]):null,sc(4,4,hx.bind(null,r,s),l)}function _m(){}function mx(s,r){var l=Ot();r=r===void 0?null:r;var u=l.memoizedState;return r!==null&&hm(r,u[1])?u[0]:(l.memoizedState=[s,r],s)}function px(s,r){var l=Ot();r=r===void 0?null:r;var u=l.memoizedState;if(r!==null&&hm(r,u[1]))return u[0];if(u=s(),Nr){kn(!0);try{s()}finally{kn(!1)}}return l.memoizedState=[u,r],u}function Tm(s,r,l){return l===void 0||(Xa&1073741824)!==0?s.memoizedState=r:(s.memoizedState=l,s=yb(),Fe.lanes|=s,si|=s,l)}function gx(s,r,l,u){return Pn(l,r)?l:xo.current!==null?(s=Tm(s,l,u),Pn(s,r)||(Kt=!0),s):(Xa&42)===0?(Kt=!0,s.memoizedState=l):(s=yb(),Fe.lanes|=s,si|=s,r)}function vx(s,r,l,u,m){var v=se.p;se.p=v!==0&&8>v?v:8;var A=Q.T,k={};Q.T=k,Cm(s,!1,r,l);try{var B=m(),W=Q.S;if(W!==null&&W(k,B),B!==null&&typeof B=="object"&&typeof B.then=="function"){var ne=xC(B,u);ac(s,r,ne,qn(s))}else ac(s,r,u,qn(s))}catch(re){ac(s,r,{then:function(){},status:"rejected",reason:re},qn())}finally{se.p=v,Q.T=A}}function TC(){}function jm(s,r,l,u){if(s.tag!==5)throw Error(i(476));var m=yx(s).queue;vx(s,m,r,me,l===null?TC:function(){return xx(s),l(u)})}function yx(s){var r=s.memoizedState;if(r!==null)return r;r={memoizedState:me,baseState:me,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xa,lastRenderedState:me},next:null};var l={};return r.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xa,lastRenderedState:l},next:null},s.memoizedState=r,s=s.alternate,s!==null&&(s.memoizedState=r),r}function xx(s){var r=yx(s).next.queue;ac(s,r,{},qn())}function Am(){return hn(Ec)}function bx(){return Ot().memoizedState}function Nx(){return Ot().memoizedState}function jC(s){for(var r=s.return;r!==null;){switch(r.tag){case 24:case 3:var l=qn();s=Qa(l);var u=Ka(r,s,l);u!==null&&(Bn(u,r,l),Zl(u,r,l)),r={cache:nm()},s.payload=r;return}r=r.return}}function AC(s,r,l){var u=qn();l={lane:u,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null},gd(s)?_x(r,l):(l=$f(s,r,l,u),l!==null&&(Bn(l,s,u),Tx(l,r,u)))}function Ex(s,r,l){var u=qn();ac(s,r,l,u)}function ac(s,r,l,u){var m={lane:u,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null};if(gd(s))_x(r,m);else{var v=s.alternate;if(s.lanes===0&&(v===null||v.lanes===0)&&(v=r.lastRenderedReducer,v!==null))try{var A=r.lastRenderedState,k=v(A,l);if(m.hasEagerState=!0,m.eagerState=k,Pn(k,A))return Ju(s,r,m,0),pt===null&&Zu(),!1}catch{}finally{}if(l=$f(s,r,m,u),l!==null)return Bn(l,s,u),Tx(l,r,u),!0}return!1}function Cm(s,r,l,u){if(u={lane:2,revertLane:ip(),action:u,hasEagerState:!1,eagerState:null,next:null},gd(s)){if(r)throw Error(i(479))}else r=$f(s,l,u,2),r!==null&&Bn(r,s,2)}function gd(s){var r=s.alternate;return s===Fe||r!==null&&r===Fe}function _x(s,r){bo=ud=!0;var l=s.pending;l===null?r.next=r:(r.next=l.next,l.next=r),s.pending=r}function Tx(s,r,l){if((l&4194048)!==0){var u=r.lanes;u&=s.pendingLanes,l|=u,r.lanes=l,Al(s,l)}}var vd={readContext:hn,use:hd,useCallback:wt,useContext:wt,useEffect:wt,useImperativeHandle:wt,useLayoutEffect:wt,useInsertionEffect:wt,useMemo:wt,useReducer:wt,useRef:wt,useState:wt,useDebugValue:wt,useDeferredValue:wt,useTransition:wt,useSyncExternalStore:wt,useId:wt,useHostTransitionStatus:wt,useFormState:wt,useActionState:wt,useOptimistic:wt,useMemoCache:wt,useCacheRefresh:wt},jx={readContext:hn,use:hd,useCallback:function(s,r){return wn().memoizedState=[s,r===void 0?null:r],s},useContext:hn,useEffect:lx,useImperativeHandle:function(s,r,l){l=l!=null?l.concat([s]):null,pd(4194308,4,hx.bind(null,r,s),l)},useLayoutEffect:function(s,r){return pd(4194308,4,s,r)},useInsertionEffect:function(s,r){pd(4,2,s,r)},useMemo:function(s,r){var l=wn();r=r===void 0?null:r;var u=s();if(Nr){kn(!0);try{s()}finally{kn(!1)}}return l.memoizedState=[u,r],u},useReducer:function(s,r,l){var u=wn();if(l!==void 0){var m=l(r);if(Nr){kn(!0);try{l(r)}finally{kn(!1)}}}else m=r;return u.memoizedState=u.baseState=m,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:m},u.queue=s,s=s.dispatch=AC.bind(null,Fe,s),[u.memoizedState,s]},useRef:function(s){var r=wn();return s={current:s},r.memoizedState=s},useState:function(s){s=Nm(s);var r=s.queue,l=Ex.bind(null,Fe,r);return r.dispatch=l,[s.memoizedState,l]},useDebugValue:_m,useDeferredValue:function(s,r){var l=wn();return Tm(l,s,r)},useTransition:function(){var s=Nm(!1);return s=vx.bind(null,Fe,s.queue,!0,!1),wn().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,r,l){var u=Fe,m=wn();if(nt){if(l===void 0)throw Error(i(407));l=l()}else{if(l=r(),pt===null)throw Error(i(349));(We&124)!==0||$y(u,r,l)}m.memoizedState=l;var v={value:l,getSnapshot:r};return m.queue=v,lx(Qy.bind(null,u,v,s),[s]),u.flags|=2048,Eo(9,md(),Yy.bind(null,u,v,l,r),null),l},useId:function(){var s=wn(),r=pt.identifierPrefix;if(nt){var l=ga,u=pa;l=(u&~(1<<32-dn(u)-1)).toString(32)+l,r="«"+r+"R"+l,l=dd++,0<l&&(r+="H"+l.toString(32)),r+="»"}else l=bC++,r="«"+r+"r"+l.toString(32)+"»";return s.memoizedState=r},useHostTransitionStatus:Am,useFormState:sx,useActionState:sx,useOptimistic:function(s){var r=wn();r.memoizedState=r.baseState=s;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=l,r=Cm.bind(null,Fe,!0,l),l.dispatch=r,[s,r]},useMemoCache:ym,useCacheRefresh:function(){return wn().memoizedState=jC.bind(null,Fe)}},Ax={readContext:hn,use:hd,useCallback:mx,useContext:hn,useEffect:cx,useImperativeHandle:fx,useInsertionEffect:ux,useLayoutEffect:dx,useMemo:px,useReducer:fd,useRef:ox,useState:function(){return fd(xa)},useDebugValue:_m,useDeferredValue:function(s,r){var l=Ot();return gx(l,lt.memoizedState,s,r)},useTransition:function(){var s=fd(xa)[0],r=Ot().memoizedState;return[typeof s=="boolean"?s:nc(s),r]},useSyncExternalStore:Gy,useId:bx,useHostTransitionStatus:Am,useFormState:ax,useActionState:ax,useOptimistic:function(s,r){var l=Ot();return Wy(l,lt,s,r)},useMemoCache:ym,useCacheRefresh:Nx},CC={readContext:hn,use:hd,useCallback:mx,useContext:hn,useEffect:cx,useImperativeHandle:fx,useInsertionEffect:ux,useLayoutEffect:dx,useMemo:px,useReducer:bm,useRef:ox,useState:function(){return bm(xa)},useDebugValue:_m,useDeferredValue:function(s,r){var l=Ot();return lt===null?Tm(l,s,r):gx(l,lt.memoizedState,s,r)},useTransition:function(){var s=bm(xa)[0],r=Ot().memoizedState;return[typeof s=="boolean"?s:nc(s),r]},useSyncExternalStore:Gy,useId:bx,useHostTransitionStatus:Am,useFormState:rx,useActionState:rx,useOptimistic:function(s,r){var l=Ot();return lt!==null?Wy(l,lt,s,r):(l.baseState=s,[s,l.queue.dispatch])},useMemoCache:ym,useCacheRefresh:Nx},_o=null,ic=0;function yd(s){var r=ic;return ic+=1,_o===null&&(_o=[]),Ly(_o,s,r)}function rc(s,r){r=r.props.ref,s.ref=r!==void 0?r:null}function xd(s,r){throw r.$$typeof===b?Error(i(525)):(s=Object.prototype.toString.call(r),Error(i(31,s==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":s)))}function Cx(s){var r=s._init;return r(s._payload)}function wx(s){function r(Y,G){if(s){var X=Y.deletions;X===null?(Y.deletions=[G],Y.flags|=16):X.push(G)}}function l(Y,G){if(!s)return null;for(;G!==null;)r(Y,G),G=G.sibling;return null}function u(Y){for(var G=new Map;Y!==null;)Y.key!==null?G.set(Y.key,Y):G.set(Y.index,Y),Y=Y.sibling;return G}function m(Y,G){return Y=ma(Y,G),Y.index=0,Y.sibling=null,Y}function v(Y,G,X){return Y.index=X,s?(X=Y.alternate,X!==null?(X=X.index,X<G?(Y.flags|=67108866,G):X):(Y.flags|=67108866,G)):(Y.flags|=1048576,G)}function A(Y){return s&&Y.alternate===null&&(Y.flags|=67108866),Y}function k(Y,G,X,ae){return G===null||G.tag!==6?(G=Qf(X,Y.mode,ae),G.return=Y,G):(G=m(G,X),G.return=Y,G)}function B(Y,G,X,ae){var xe=X.type;return xe===N?ne(Y,G,X.props.children,ae,X.key):G!==null&&(G.elementType===xe||typeof xe=="object"&&xe!==null&&xe.$$typeof===R&&Cx(xe)===G.type)?(G=m(G,X.props),rc(G,X),G.return=Y,G):(G=td(X.type,X.key,X.props,null,Y.mode,ae),rc(G,X),G.return=Y,G)}function W(Y,G,X,ae){return G===null||G.tag!==4||G.stateNode.containerInfo!==X.containerInfo||G.stateNode.implementation!==X.implementation?(G=Kf(X,Y.mode,ae),G.return=Y,G):(G=m(G,X.children||[]),G.return=Y,G)}function ne(Y,G,X,ae,xe){return G===null||G.tag!==7?(G=fr(X,Y.mode,ae,xe),G.return=Y,G):(G=m(G,X),G.return=Y,G)}function re(Y,G,X){if(typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint")return G=Qf(""+G,Y.mode,X),G.return=Y,G;if(typeof G=="object"&&G!==null){switch(G.$$typeof){case E:return X=td(G.type,G.key,G.props,null,Y.mode,X),rc(X,G),X.return=Y,X;case j:return G=Kf(G,Y.mode,X),G.return=Y,G;case R:var ae=G._init;return G=ae(G._payload),re(Y,G,X)}if(ve(G)||M(G))return G=fr(G,Y.mode,X,null),G.return=Y,G;if(typeof G.then=="function")return re(Y,yd(G),X);if(G.$$typeof===I)return re(Y,id(Y,G),X);xd(Y,G)}return null}function Z(Y,G,X,ae){var xe=G!==null?G.key:null;if(typeof X=="string"&&X!==""||typeof X=="number"||typeof X=="bigint")return xe!==null?null:k(Y,G,""+X,ae);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case E:return X.key===xe?B(Y,G,X,ae):null;case j:return X.key===xe?W(Y,G,X,ae):null;case R:return xe=X._init,X=xe(X._payload),Z(Y,G,X,ae)}if(ve(X)||M(X))return xe!==null?null:ne(Y,G,X,ae,null);if(typeof X.then=="function")return Z(Y,G,yd(X),ae);if(X.$$typeof===I)return Z(Y,G,id(Y,X),ae);xd(Y,X)}return null}function J(Y,G,X,ae,xe){if(typeof ae=="string"&&ae!==""||typeof ae=="number"||typeof ae=="bigint")return Y=Y.get(X)||null,k(G,Y,""+ae,xe);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case E:return Y=Y.get(ae.key===null?X:ae.key)||null,B(G,Y,ae,xe);case j:return Y=Y.get(ae.key===null?X:ae.key)||null,W(G,Y,ae,xe);case R:var ze=ae._init;return ae=ze(ae._payload),J(Y,G,X,ae,xe)}if(ve(ae)||M(ae))return Y=Y.get(X)||null,ne(G,Y,ae,xe,null);if(typeof ae.then=="function")return J(Y,G,X,yd(ae),xe);if(ae.$$typeof===I)return J(Y,G,X,id(G,ae),xe);xd(G,ae)}return null}function Re(Y,G,X,ae){for(var xe=null,ze=null,Ne=G,we=G=0,Wt=null;Ne!==null&&we<X.length;we++){Ne.index>we?(Wt=Ne,Ne=null):Wt=Ne.sibling;var tt=Z(Y,Ne,X[we],ae);if(tt===null){Ne===null&&(Ne=Wt);break}s&&Ne&&tt.alternate===null&&r(Y,Ne),G=v(tt,G,we),ze===null?xe=tt:ze.sibling=tt,ze=tt,Ne=Wt}if(we===X.length)return l(Y,Ne),nt&&pr(Y,we),xe;if(Ne===null){for(;we<X.length;we++)Ne=re(Y,X[we],ae),Ne!==null&&(G=v(Ne,G,we),ze===null?xe=Ne:ze.sibling=Ne,ze=Ne);return nt&&pr(Y,we),xe}for(Ne=u(Ne);we<X.length;we++)Wt=J(Ne,Y,we,X[we],ae),Wt!==null&&(s&&Wt.alternate!==null&&Ne.delete(Wt.key===null?we:Wt.key),G=v(Wt,G,we),ze===null?xe=Wt:ze.sibling=Wt,ze=Wt);return s&&Ne.forEach(function(hi){return r(Y,hi)}),nt&&pr(Y,we),xe}function Ce(Y,G,X,ae){if(X==null)throw Error(i(151));for(var xe=null,ze=null,Ne=G,we=G=0,Wt=null,tt=X.next();Ne!==null&&!tt.done;we++,tt=X.next()){Ne.index>we?(Wt=Ne,Ne=null):Wt=Ne.sibling;var hi=Z(Y,Ne,tt.value,ae);if(hi===null){Ne===null&&(Ne=Wt);break}s&&Ne&&hi.alternate===null&&r(Y,Ne),G=v(hi,G,we),ze===null?xe=hi:ze.sibling=hi,ze=hi,Ne=Wt}if(tt.done)return l(Y,Ne),nt&&pr(Y,we),xe;if(Ne===null){for(;!tt.done;we++,tt=X.next())tt=re(Y,tt.value,ae),tt!==null&&(G=v(tt,G,we),ze===null?xe=tt:ze.sibling=tt,ze=tt);return nt&&pr(Y,we),xe}for(Ne=u(Ne);!tt.done;we++,tt=X.next())tt=J(Ne,Y,we,tt.value,ae),tt!==null&&(s&&tt.alternate!==null&&Ne.delete(tt.key===null?we:tt.key),G=v(tt,G,we),ze===null?xe=tt:ze.sibling=tt,ze=tt);return s&&Ne.forEach(function(ww){return r(Y,ww)}),nt&&pr(Y,we),xe}function ut(Y,G,X,ae){if(typeof X=="object"&&X!==null&&X.type===N&&X.key===null&&(X=X.props.children),typeof X=="object"&&X!==null){switch(X.$$typeof){case E:e:{for(var xe=X.key;G!==null;){if(G.key===xe){if(xe=X.type,xe===N){if(G.tag===7){l(Y,G.sibling),ae=m(G,X.props.children),ae.return=Y,Y=ae;break e}}else if(G.elementType===xe||typeof xe=="object"&&xe!==null&&xe.$$typeof===R&&Cx(xe)===G.type){l(Y,G.sibling),ae=m(G,X.props),rc(ae,X),ae.return=Y,Y=ae;break e}l(Y,G);break}else r(Y,G);G=G.sibling}X.type===N?(ae=fr(X.props.children,Y.mode,ae,X.key),ae.return=Y,Y=ae):(ae=td(X.type,X.key,X.props,null,Y.mode,ae),rc(ae,X),ae.return=Y,Y=ae)}return A(Y);case j:e:{for(xe=X.key;G!==null;){if(G.key===xe)if(G.tag===4&&G.stateNode.containerInfo===X.containerInfo&&G.stateNode.implementation===X.implementation){l(Y,G.sibling),ae=m(G,X.children||[]),ae.return=Y,Y=ae;break e}else{l(Y,G);break}else r(Y,G);G=G.sibling}ae=Kf(X,Y.mode,ae),ae.return=Y,Y=ae}return A(Y);case R:return xe=X._init,X=xe(X._payload),ut(Y,G,X,ae)}if(ve(X))return Re(Y,G,X,ae);if(M(X)){if(xe=M(X),typeof xe!="function")throw Error(i(150));return X=xe.call(X),Ce(Y,G,X,ae)}if(typeof X.then=="function")return ut(Y,G,yd(X),ae);if(X.$$typeof===I)return ut(Y,G,id(Y,X),ae);xd(Y,X)}return typeof X=="string"&&X!==""||typeof X=="number"||typeof X=="bigint"?(X=""+X,G!==null&&G.tag===6?(l(Y,G.sibling),ae=m(G,X),ae.return=Y,Y=ae):(l(Y,G),ae=Qf(X,Y.mode,ae),ae.return=Y,Y=ae),A(Y)):l(Y,G)}return function(Y,G,X,ae){try{ic=0;var xe=ut(Y,G,X,ae);return _o=null,xe}catch(Ne){if(Ne===Xl||Ne===od)throw Ne;var ze=Ln(29,Ne,null,Y.mode);return ze.lanes=ae,ze.return=Y,ze}finally{}}}var To=wx(!0),Sx=wx(!1),is=ee(null),Fs=null;function Wa(s){var r=s.alternate;ue(Bt,Bt.current&1),ue(is,s),Fs===null&&(r===null||xo.current!==null||r.memoizedState!==null)&&(Fs=s)}function Ix(s){if(s.tag===22){if(ue(Bt,Bt.current),ue(is,s),Fs===null){var r=s.alternate;r!==null&&r.memoizedState!==null&&(Fs=s)}}else Za()}function Za(){ue(Bt,Bt.current),ue(is,is.current)}function ba(s){ce(is),Fs===s&&(Fs=null),ce(Bt)}var Bt=ee(0);function bd(s){for(var r=s;r!==null;){if(r.tag===13){var l=r.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||vp(l)))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break;for(;r.sibling===null;){if(r.return===null||r.return===s)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}function wm(s,r,l,u){r=s.memoizedState,l=l(u,r),l=l==null?r:y({},r,l),s.memoizedState=l,s.lanes===0&&(s.updateQueue.baseState=l)}var Sm={enqueueSetState:function(s,r,l){s=s._reactInternals;var u=qn(),m=Qa(u);m.payload=r,l!=null&&(m.callback=l),r=Ka(s,m,u),r!==null&&(Bn(r,s,u),Zl(r,s,u))},enqueueReplaceState:function(s,r,l){s=s._reactInternals;var u=qn(),m=Qa(u);m.tag=1,m.payload=r,l!=null&&(m.callback=l),r=Ka(s,m,u),r!==null&&(Bn(r,s,u),Zl(r,s,u))},enqueueForceUpdate:function(s,r){s=s._reactInternals;var l=qn(),u=Qa(l);u.tag=2,r!=null&&(u.callback=r),r=Ka(s,u,l),r!==null&&(Bn(r,s,l),Zl(r,s,l))}};function Rx(s,r,l,u,m,v,A){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(u,v,A):r.prototype&&r.prototype.isPureReactComponent?!Bl(l,u)||!Bl(m,v):!0}function Dx(s,r,l,u){s=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(l,u),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(l,u),r.state!==s&&Sm.enqueueReplaceState(r,r.state,null)}function Er(s,r){var l=r;if("ref"in r){l={};for(var u in r)u!=="ref"&&(l[u]=r[u])}if(s=s.defaultProps){l===r&&(l=y({},l));for(var m in s)l[m]===void 0&&(l[m]=s[m])}return l}var Nd=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function Mx(s){Nd(s)}function kx(s){console.error(s)}function Ox(s){Nd(s)}function Ed(s,r){try{var l=s.onUncaughtError;l(r.value,{componentStack:r.stack})}catch(u){setTimeout(function(){throw u})}}function Px(s,r,l){try{var u=s.onCaughtError;u(l.value,{componentStack:l.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function Im(s,r,l){return l=Qa(l),l.tag=3,l.payload={element:null},l.callback=function(){Ed(s,r)},l}function Lx(s){return s=Qa(s),s.tag=3,s}function Vx(s,r,l,u){var m=l.type.getDerivedStateFromError;if(typeof m=="function"){var v=u.value;s.payload=function(){return m(v)},s.callback=function(){Px(r,l,u)}}var A=l.stateNode;A!==null&&typeof A.componentDidCatch=="function"&&(s.callback=function(){Px(r,l,u),typeof m!="function"&&(ai===null?ai=new Set([this]):ai.add(this));var k=u.stack;this.componentDidCatch(u.value,{componentStack:k!==null?k:""})})}function wC(s,r,l,u,m){if(l.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){if(r=l.alternate,r!==null&&Yl(r,l,m,!0),l=is.current,l!==null){switch(l.tag){case 13:return Fs===null?ep():l.alternate===null&&At===0&&(At=3),l.flags&=-257,l.flags|=65536,l.lanes=m,u===im?l.flags|=16384:(r=l.updateQueue,r===null?l.updateQueue=new Set([u]):r.add(u),np(s,u,m)),!1;case 22:return l.flags|=65536,u===im?l.flags|=16384:(r=l.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([u])},l.updateQueue=r):(l=r.retryQueue,l===null?r.retryQueue=new Set([u]):l.add(u)),np(s,u,m)),!1}throw Error(i(435,l.tag))}return np(s,u,m),ep(),!1}if(nt)return r=is.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=m,u!==Zf&&(s=Error(i(422),{cause:u}),$l(ts(s,l)))):(u!==Zf&&(r=Error(i(423),{cause:u}),$l(ts(r,l))),s=s.current.alternate,s.flags|=65536,m&=-m,s.lanes|=m,u=ts(u,l),m=Im(s.stateNode,u,m),lm(s,m),At!==4&&(At=2)),!1;var v=Error(i(520),{cause:u});if(v=ts(v,l),fc===null?fc=[v]:fc.push(v),At!==4&&(At=2),r===null)return!0;u=ts(u,l),l=r;do{switch(l.tag){case 3:return l.flags|=65536,s=m&-m,l.lanes|=s,s=Im(l.stateNode,u,s),lm(l,s),!1;case 1:if(r=l.type,v=l.stateNode,(l.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(ai===null||!ai.has(v))))return l.flags|=65536,m&=-m,l.lanes|=m,m=Lx(m),Vx(m,s,l,u),lm(l,m),!1}l=l.return}while(l!==null);return!1}var Ux=Error(i(461)),Kt=!1;function nn(s,r,l,u){r.child=s===null?Sx(r,null,l,u):To(r,s.child,l,u)}function Fx(s,r,l,u,m){l=l.render;var v=r.ref;if("ref"in u){var A={};for(var k in u)k!=="ref"&&(A[k]=u[k])}else A=u;return xr(r),u=fm(s,r,l,A,v,m),k=mm(),s!==null&&!Kt?(pm(s,r,m),Na(s,r,m)):(nt&&k&&Xf(r),r.flags|=1,nn(s,r,u,m),r.child)}function qx(s,r,l,u,m){if(s===null){var v=l.type;return typeof v=="function"&&!Yf(v)&&v.defaultProps===void 0&&l.compare===null?(r.tag=15,r.type=v,Bx(s,r,v,u,m)):(s=td(l.type,null,u,r,r.mode,m),s.ref=r.ref,s.return=r,r.child=s)}if(v=s.child,!Vm(s,m)){var A=v.memoizedProps;if(l=l.compare,l=l!==null?l:Bl,l(A,u)&&s.ref===r.ref)return Na(s,r,m)}return r.flags|=1,s=ma(v,u),s.ref=r.ref,s.return=r,r.child=s}function Bx(s,r,l,u,m){if(s!==null){var v=s.memoizedProps;if(Bl(v,u)&&s.ref===r.ref)if(Kt=!1,r.pendingProps=u=v,Vm(s,m))(s.flags&131072)!==0&&(Kt=!0);else return r.lanes=s.lanes,Na(s,r,m)}return Rm(s,r,l,u,m)}function zx(s,r,l){var u=r.pendingProps,m=u.children,v=s!==null?s.memoizedState:null;if(u.mode==="hidden"){if((r.flags&128)!==0){if(u=v!==null?v.baseLanes|l:l,s!==null){for(m=r.child=s.child,v=0;m!==null;)v=v|m.lanes|m.childLanes,m=m.sibling;r.childLanes=v&~u}else r.childLanes=0,r.child=null;return Hx(s,r,u,l)}if((l&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},s!==null&&rd(r,v!==null?v.cachePool:null),v!==null?By(r,v):um(),Ix(r);else return r.lanes=r.childLanes=536870912,Hx(s,r,v!==null?v.baseLanes|l:l,l)}else v!==null?(rd(r,v.cachePool),By(r,v),Za(),r.memoizedState=null):(s!==null&&rd(r,null),um(),Za());return nn(s,r,m,l),r.child}function Hx(s,r,l,u){var m=am();return m=m===null?null:{parent:qt._currentValue,pool:m},r.memoizedState={baseLanes:l,cachePool:m},s!==null&&rd(r,null),um(),Ix(r),s!==null&&Yl(s,r,u,!0),null}function _d(s,r){var l=r.ref;if(l===null)s!==null&&s.ref!==null&&(r.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(i(284));(s===null||s.ref!==l)&&(r.flags|=4194816)}}function Rm(s,r,l,u,m){return xr(r),l=fm(s,r,l,u,void 0,m),u=mm(),s!==null&&!Kt?(pm(s,r,m),Na(s,r,m)):(nt&&u&&Xf(r),r.flags|=1,nn(s,r,l,m),r.child)}function Gx(s,r,l,u,m,v){return xr(r),r.updateQueue=null,l=Hy(r,u,l,m),zy(s),u=mm(),s!==null&&!Kt?(pm(s,r,v),Na(s,r,v)):(nt&&u&&Xf(r),r.flags|=1,nn(s,r,l,v),r.child)}function $x(s,r,l,u,m){if(xr(r),r.stateNode===null){var v=mo,A=l.contextType;typeof A=="object"&&A!==null&&(v=hn(A)),v=new l(u,v),r.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=Sm,r.stateNode=v,v._reactInternals=r,v=r.stateNode,v.props=u,v.state=r.memoizedState,v.refs={},rm(r),A=l.contextType,v.context=typeof A=="object"&&A!==null?hn(A):mo,v.state=r.memoizedState,A=l.getDerivedStateFromProps,typeof A=="function"&&(wm(r,l,A,u),v.state=r.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(A=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),A!==v.state&&Sm.enqueueReplaceState(v,v.state,null),ec(r,u,v,m),Jl(),v.state=r.memoizedState),typeof v.componentDidMount=="function"&&(r.flags|=4194308),u=!0}else if(s===null){v=r.stateNode;var k=r.memoizedProps,B=Er(l,k);v.props=B;var W=v.context,ne=l.contextType;A=mo,typeof ne=="object"&&ne!==null&&(A=hn(ne));var re=l.getDerivedStateFromProps;ne=typeof re=="function"||typeof v.getSnapshotBeforeUpdate=="function",k=r.pendingProps!==k,ne||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(k||W!==A)&&Dx(r,v,u,A),Ya=!1;var Z=r.memoizedState;v.state=Z,ec(r,u,v,m),Jl(),W=r.memoizedState,k||Z!==W||Ya?(typeof re=="function"&&(wm(r,l,re,u),W=r.memoizedState),(B=Ya||Rx(r,l,B,u,Z,W,A))?(ne||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(r.flags|=4194308)):(typeof v.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=u,r.memoizedState=W),v.props=u,v.state=W,v.context=A,u=B):(typeof v.componentDidMount=="function"&&(r.flags|=4194308),u=!1)}else{v=r.stateNode,om(s,r),A=r.memoizedProps,ne=Er(l,A),v.props=ne,re=r.pendingProps,Z=v.context,W=l.contextType,B=mo,typeof W=="object"&&W!==null&&(B=hn(W)),k=l.getDerivedStateFromProps,(W=typeof k=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(A!==re||Z!==B)&&Dx(r,v,u,B),Ya=!1,Z=r.memoizedState,v.state=Z,ec(r,u,v,m),Jl();var J=r.memoizedState;A!==re||Z!==J||Ya||s!==null&&s.dependencies!==null&&ad(s.dependencies)?(typeof k=="function"&&(wm(r,l,k,u),J=r.memoizedState),(ne=Ya||Rx(r,l,ne,u,Z,J,B)||s!==null&&s.dependencies!==null&&ad(s.dependencies))?(W||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(u,J,B),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(u,J,B)),typeof v.componentDidUpdate=="function"&&(r.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof v.componentDidUpdate!="function"||A===s.memoizedProps&&Z===s.memoizedState||(r.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||A===s.memoizedProps&&Z===s.memoizedState||(r.flags|=1024),r.memoizedProps=u,r.memoizedState=J),v.props=u,v.state=J,v.context=B,u=ne):(typeof v.componentDidUpdate!="function"||A===s.memoizedProps&&Z===s.memoizedState||(r.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||A===s.memoizedProps&&Z===s.memoizedState||(r.flags|=1024),u=!1)}return v=u,_d(s,r),u=(r.flags&128)!==0,v||u?(v=r.stateNode,l=u&&typeof l.getDerivedStateFromError!="function"?null:v.render(),r.flags|=1,s!==null&&u?(r.child=To(r,s.child,null,m),r.child=To(r,null,l,m)):nn(s,r,l,m),r.memoizedState=v.state,s=r.child):s=Na(s,r,m),s}function Yx(s,r,l,u){return Gl(),r.flags|=256,nn(s,r,l,u),r.child}var Dm={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Mm(s){return{baseLanes:s,cachePool:ky()}}function km(s,r,l){return s=s!==null?s.childLanes&~l:0,r&&(s|=rs),s}function Qx(s,r,l){var u=r.pendingProps,m=!1,v=(r.flags&128)!==0,A;if((A=v)||(A=s!==null&&s.memoizedState===null?!1:(Bt.current&2)!==0),A&&(m=!0,r.flags&=-129),A=(r.flags&32)!==0,r.flags&=-33,s===null){if(nt){if(m?Wa(r):Za(),nt){var k=jt,B;if(B=k){e:{for(B=k,k=Us;B.nodeType!==8;){if(!k){k=null;break e}if(B=ys(B.nextSibling),B===null){k=null;break e}}k=B}k!==null?(r.memoizedState={dehydrated:k,treeContext:mr!==null?{id:pa,overflow:ga}:null,retryLane:536870912,hydrationErrors:null},B=Ln(18,null,null,0),B.stateNode=k,B.return=r,r.child=B,En=r,jt=null,B=!0):B=!1}B||vr(r)}if(k=r.memoizedState,k!==null&&(k=k.dehydrated,k!==null))return vp(k)?r.lanes=32:r.lanes=536870912,null;ba(r)}return k=u.children,u=u.fallback,m?(Za(),m=r.mode,k=Td({mode:"hidden",children:k},m),u=fr(u,m,l,null),k.return=r,u.return=r,k.sibling=u,r.child=k,m=r.child,m.memoizedState=Mm(l),m.childLanes=km(s,A,l),r.memoizedState=Dm,u):(Wa(r),Om(r,k))}if(B=s.memoizedState,B!==null&&(k=B.dehydrated,k!==null)){if(v)r.flags&256?(Wa(r),r.flags&=-257,r=Pm(s,r,l)):r.memoizedState!==null?(Za(),r.child=s.child,r.flags|=128,r=null):(Za(),m=u.fallback,k=r.mode,u=Td({mode:"visible",children:u.children},k),m=fr(m,k,l,null),m.flags|=2,u.return=r,m.return=r,u.sibling=m,r.child=u,To(r,s.child,null,l),u=r.child,u.memoizedState=Mm(l),u.childLanes=km(s,A,l),r.memoizedState=Dm,r=m);else if(Wa(r),vp(k)){if(A=k.nextSibling&&k.nextSibling.dataset,A)var W=A.dgst;A=W,u=Error(i(419)),u.stack="",u.digest=A,$l({value:u,source:null,stack:null}),r=Pm(s,r,l)}else if(Kt||Yl(s,r,l,!1),A=(l&s.childLanes)!==0,Kt||A){if(A=pt,A!==null&&(u=l&-l,u=(u&42)!==0?1:Ua(u),u=(u&(A.suspendedLanes|l))!==0?0:u,u!==0&&u!==B.retryLane))throw B.retryLane=u,fo(s,u),Bn(A,s,u),Ux;k.data==="$?"||ep(),r=Pm(s,r,l)}else k.data==="$?"?(r.flags|=192,r.child=s.child,r=null):(s=B.treeContext,jt=ys(k.nextSibling),En=r,nt=!0,gr=null,Us=!1,s!==null&&(ss[as++]=pa,ss[as++]=ga,ss[as++]=mr,pa=s.id,ga=s.overflow,mr=r),r=Om(r,u.children),r.flags|=4096);return r}return m?(Za(),m=u.fallback,k=r.mode,B=s.child,W=B.sibling,u=ma(B,{mode:"hidden",children:u.children}),u.subtreeFlags=B.subtreeFlags&65011712,W!==null?m=ma(W,m):(m=fr(m,k,l,null),m.flags|=2),m.return=r,u.return=r,u.sibling=m,r.child=u,u=m,m=r.child,k=s.child.memoizedState,k===null?k=Mm(l):(B=k.cachePool,B!==null?(W=qt._currentValue,B=B.parent!==W?{parent:W,pool:W}:B):B=ky(),k={baseLanes:k.baseLanes|l,cachePool:B}),m.memoizedState=k,m.childLanes=km(s,A,l),r.memoizedState=Dm,u):(Wa(r),l=s.child,s=l.sibling,l=ma(l,{mode:"visible",children:u.children}),l.return=r,l.sibling=null,s!==null&&(A=r.deletions,A===null?(r.deletions=[s],r.flags|=16):A.push(s)),r.child=l,r.memoizedState=null,l)}function Om(s,r){return r=Td({mode:"visible",children:r},s.mode),r.return=s,s.child=r}function Td(s,r){return s=Ln(22,s,null,r),s.lanes=0,s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},s}function Pm(s,r,l){return To(r,s.child,null,l),s=Om(r,r.pendingProps.children),s.flags|=2,r.memoizedState=null,s}function Kx(s,r,l){s.lanes|=r;var u=s.alternate;u!==null&&(u.lanes|=r),em(s.return,r,l)}function Lm(s,r,l,u,m){var v=s.memoizedState;v===null?s.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:u,tail:l,tailMode:m}:(v.isBackwards=r,v.rendering=null,v.renderingStartTime=0,v.last=u,v.tail=l,v.tailMode=m)}function Xx(s,r,l){var u=r.pendingProps,m=u.revealOrder,v=u.tail;if(nn(s,r,u.children,l),u=Bt.current,(u&2)!==0)u=u&1|2,r.flags|=128;else{if(s!==null&&(s.flags&128)!==0)e:for(s=r.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Kx(s,l,r);else if(s.tag===19)Kx(s,l,r);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}u&=1}switch(ue(Bt,u),m){case"forwards":for(l=r.child,m=null;l!==null;)s=l.alternate,s!==null&&bd(s)===null&&(m=l),l=l.sibling;l=m,l===null?(m=r.child,r.child=null):(m=l.sibling,l.sibling=null),Lm(r,!1,m,l,v);break;case"backwards":for(l=null,m=r.child,r.child=null;m!==null;){if(s=m.alternate,s!==null&&bd(s)===null){r.child=m;break}s=m.sibling,m.sibling=l,l=m,m=s}Lm(r,!0,l,null,v);break;case"together":Lm(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function Na(s,r,l){if(s!==null&&(r.dependencies=s.dependencies),si|=r.lanes,(l&r.childLanes)===0)if(s!==null){if(Yl(s,r,l,!1),(l&r.childLanes)===0)return null}else return null;if(s!==null&&r.child!==s.child)throw Error(i(153));if(r.child!==null){for(s=r.child,l=ma(s,s.pendingProps),r.child=l,l.return=r;s.sibling!==null;)s=s.sibling,l=l.sibling=ma(s,s.pendingProps),l.return=r;l.sibling=null}return r.child}function Vm(s,r){return(s.lanes&r)!==0?!0:(s=s.dependencies,!!(s!==null&&ad(s)))}function SC(s,r,l){switch(r.tag){case 3:mt(r,r.stateNode.containerInfo),$a(r,qt,s.memoizedState.cache),Gl();break;case 27:case 5:Va(r);break;case 4:mt(r,r.stateNode.containerInfo);break;case 10:$a(r,r.type,r.memoizedProps.value);break;case 13:var u=r.memoizedState;if(u!==null)return u.dehydrated!==null?(Wa(r),r.flags|=128,null):(l&r.child.childLanes)!==0?Qx(s,r,l):(Wa(r),s=Na(s,r,l),s!==null?s.sibling:null);Wa(r);break;case 19:var m=(s.flags&128)!==0;if(u=(l&r.childLanes)!==0,u||(Yl(s,r,l,!1),u=(l&r.childLanes)!==0),m){if(u)return Xx(s,r,l);r.flags|=128}if(m=r.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),ue(Bt,Bt.current),u)break;return null;case 22:case 23:return r.lanes=0,zx(s,r,l);case 24:$a(r,qt,s.memoizedState.cache)}return Na(s,r,l)}function Wx(s,r,l){if(s!==null)if(s.memoizedProps!==r.pendingProps)Kt=!0;else{if(!Vm(s,l)&&(r.flags&128)===0)return Kt=!1,SC(s,r,l);Kt=(s.flags&131072)!==0}else Kt=!1,nt&&(r.flags&1048576)!==0&&Cy(r,sd,r.index);switch(r.lanes=0,r.tag){case 16:e:{s=r.pendingProps;var u=r.elementType,m=u._init;if(u=m(u._payload),r.type=u,typeof u=="function")Yf(u)?(s=Er(u,s),r.tag=1,r=$x(null,r,u,s,l)):(r.tag=0,r=Rm(null,r,u,s,l));else{if(u!=null){if(m=u.$$typeof,m===O){r.tag=11,r=Fx(null,r,u,s,l);break e}else if(m===F){r.tag=14,r=qx(null,r,u,s,l);break e}}throw r=le(u)||u,Error(i(306,r,""))}}return r;case 0:return Rm(s,r,r.type,r.pendingProps,l);case 1:return u=r.type,m=Er(u,r.pendingProps),$x(s,r,u,m,l);case 3:e:{if(mt(r,r.stateNode.containerInfo),s===null)throw Error(i(387));u=r.pendingProps;var v=r.memoizedState;m=v.element,om(s,r),ec(r,u,null,l);var A=r.memoizedState;if(u=A.cache,$a(r,qt,u),u!==v.cache&&tm(r,[qt],l,!0),Jl(),u=A.element,v.isDehydrated)if(v={element:u,isDehydrated:!1,cache:A.cache},r.updateQueue.baseState=v,r.memoizedState=v,r.flags&256){r=Yx(s,r,u,l);break e}else if(u!==m){m=ts(Error(i(424)),r),$l(m),r=Yx(s,r,u,l);break e}else{switch(s=r.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(jt=ys(s.firstChild),En=r,nt=!0,gr=null,Us=!0,l=Sx(r,null,u,l),r.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(Gl(),u===m){r=Na(s,r,l);break e}nn(s,r,u,l)}r=r.child}return r;case 26:return _d(s,r),s===null?(l=tN(r.type,null,r.pendingProps,null))?r.memoizedState=l:nt||(l=r.type,s=r.pendingProps,u=Vd(Me.current).createElement(l),u[Vt]=r,u[Dt]=s,an(u,l,s),Ct(u),r.stateNode=u):r.memoizedState=tN(r.type,s.memoizedProps,r.pendingProps,s.memoizedState),null;case 27:return Va(r),s===null&&nt&&(u=r.stateNode=Zb(r.type,r.pendingProps,Me.current),En=r,Us=!0,m=jt,oi(r.type)?(yp=m,jt=ys(u.firstChild)):jt=m),nn(s,r,r.pendingProps.children,l),_d(s,r),s===null&&(r.flags|=4194304),r.child;case 5:return s===null&&nt&&((m=u=jt)&&(u=sw(u,r.type,r.pendingProps,Us),u!==null?(r.stateNode=u,En=r,jt=ys(u.firstChild),Us=!1,m=!0):m=!1),m||vr(r)),Va(r),m=r.type,v=r.pendingProps,A=s!==null?s.memoizedProps:null,u=v.children,mp(m,v)?u=null:A!==null&&mp(m,A)&&(r.flags|=32),r.memoizedState!==null&&(m=fm(s,r,NC,null,null,l),Ec._currentValue=m),_d(s,r),nn(s,r,u,l),r.child;case 6:return s===null&&nt&&((s=l=jt)&&(l=aw(l,r.pendingProps,Us),l!==null?(r.stateNode=l,En=r,jt=null,s=!0):s=!1),s||vr(r)),null;case 13:return Qx(s,r,l);case 4:return mt(r,r.stateNode.containerInfo),u=r.pendingProps,s===null?r.child=To(r,null,u,l):nn(s,r,u,l),r.child;case 11:return Fx(s,r,r.type,r.pendingProps,l);case 7:return nn(s,r,r.pendingProps,l),r.child;case 8:return nn(s,r,r.pendingProps.children,l),r.child;case 12:return nn(s,r,r.pendingProps.children,l),r.child;case 10:return u=r.pendingProps,$a(r,r.type,u.value),nn(s,r,u.children,l),r.child;case 9:return m=r.type._context,u=r.pendingProps.children,xr(r),m=hn(m),u=u(m),r.flags|=1,nn(s,r,u,l),r.child;case 14:return qx(s,r,r.type,r.pendingProps,l);case 15:return Bx(s,r,r.type,r.pendingProps,l);case 19:return Xx(s,r,l);case 31:return u=r.pendingProps,l=r.mode,u={mode:u.mode,children:u.children},s===null?(l=Td(u,l),l.ref=r.ref,r.child=l,l.return=r,r=l):(l=ma(s.child,u),l.ref=r.ref,r.child=l,l.return=r,r=l),r;case 22:return zx(s,r,l);case 24:return xr(r),u=hn(qt),s===null?(m=am(),m===null&&(m=pt,v=nm(),m.pooledCache=v,v.refCount++,v!==null&&(m.pooledCacheLanes|=l),m=v),r.memoizedState={parent:u,cache:m},rm(r),$a(r,qt,m)):((s.lanes&l)!==0&&(om(s,r),ec(r,null,null,l),Jl()),m=s.memoizedState,v=r.memoizedState,m.parent!==u?(m={parent:u,cache:u},r.memoizedState=m,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=m),$a(r,qt,u)):(u=v.cache,$a(r,qt,u),u!==m.cache&&tm(r,[qt],l,!0))),nn(s,r,r.pendingProps.children,l),r.child;case 29:throw r.pendingProps}throw Error(i(156,r.tag))}function Ea(s){s.flags|=4}function Zx(s,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!rN(r)){if(r=is.current,r!==null&&((We&4194048)===We?Fs!==null:(We&62914560)!==We&&(We&536870912)===0||r!==Fs))throw Wl=im,Oy;s.flags|=8192}}function jd(s,r){r!==null&&(s.flags|=4),s.flags&16384&&(r=s.tag!==22?Tl():536870912,s.lanes|=r,wo|=r)}function oc(s,r){if(!nt)switch(s.tailMode){case"hidden":r=s.tail;for(var l=null;r!==null;)r.alternate!==null&&(l=r),r=r.sibling;l===null?s.tail=null:l.sibling=null;break;case"collapsed":l=s.tail;for(var u=null;l!==null;)l.alternate!==null&&(u=l),l=l.sibling;u===null?r||s.tail===null?s.tail=null:s.tail.sibling=null:u.sibling=null}}function Et(s){var r=s.alternate!==null&&s.alternate.child===s.child,l=0,u=0;if(r)for(var m=s.child;m!==null;)l|=m.lanes|m.childLanes,u|=m.subtreeFlags&65011712,u|=m.flags&65011712,m.return=s,m=m.sibling;else for(m=s.child;m!==null;)l|=m.lanes|m.childLanes,u|=m.subtreeFlags,u|=m.flags,m.return=s,m=m.sibling;return s.subtreeFlags|=u,s.childLanes=l,r}function IC(s,r,l){var u=r.pendingProps;switch(Wf(r),r.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Et(r),null;case 1:return Et(r),null;case 3:return l=r.stateNode,u=null,s!==null&&(u=s.memoizedState.cache),r.memoizedState.cache!==u&&(r.flags|=2048),ya(qt),Cs(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(s===null||s.child===null)&&(Hl(r)?Ea(r):s===null||s.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,Iy())),Et(r),null;case 26:return l=r.memoizedState,s===null?(Ea(r),l!==null?(Et(r),Zx(r,l)):(Et(r),r.flags&=-16777217)):l?l!==s.memoizedState?(Ea(r),Et(r),Zx(r,l)):(Et(r),r.flags&=-16777217):(s.memoizedProps!==u&&Ea(r),Et(r),r.flags&=-16777217),null;case 27:ta(r),l=Me.current;var m=r.type;if(s!==null&&r.stateNode!=null)s.memoizedProps!==u&&Ea(r);else{if(!u){if(r.stateNode===null)throw Error(i(166));return Et(r),null}s=Te.current,Hl(r)?wy(r):(s=Zb(m,u,l),r.stateNode=s,Ea(r))}return Et(r),null;case 5:if(ta(r),l=r.type,s!==null&&r.stateNode!=null)s.memoizedProps!==u&&Ea(r);else{if(!u){if(r.stateNode===null)throw Error(i(166));return Et(r),null}if(s=Te.current,Hl(r))wy(r);else{switch(m=Vd(Me.current),s){case 1:s=m.createElementNS("http://www.w3.org/2000/svg",l);break;case 2:s=m.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;default:switch(l){case"svg":s=m.createElementNS("http://www.w3.org/2000/svg",l);break;case"math":s=m.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;case"script":s=m.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof u.is=="string"?m.createElement("select",{is:u.is}):m.createElement("select"),u.multiple?s.multiple=!0:u.size&&(s.size=u.size);break;default:s=typeof u.is=="string"?m.createElement(l,{is:u.is}):m.createElement(l)}}s[Vt]=r,s[Dt]=u;e:for(m=r.child;m!==null;){if(m.tag===5||m.tag===6)s.appendChild(m.stateNode);else if(m.tag!==4&&m.tag!==27&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===r)break e;for(;m.sibling===null;){if(m.return===null||m.return===r)break e;m=m.return}m.sibling.return=m.return,m=m.sibling}r.stateNode=s;e:switch(an(s,l,u),l){case"button":case"input":case"select":case"textarea":s=!!u.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&Ea(r)}}return Et(r),r.flags&=-16777217,null;case 6:if(s&&r.stateNode!=null)s.memoizedProps!==u&&Ea(r);else{if(typeof u!="string"&&r.stateNode===null)throw Error(i(166));if(s=Me.current,Hl(r)){if(s=r.stateNode,l=r.memoizedProps,u=null,m=En,m!==null)switch(m.tag){case 27:case 5:u=m.memoizedProps}s[Vt]=r,s=!!(s.nodeValue===l||u!==null&&u.suppressHydrationWarning===!0||Gb(s.nodeValue,l)),s||vr(r)}else s=Vd(s).createTextNode(u),s[Vt]=r,r.stateNode=s}return Et(r),null;case 13:if(u=r.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(m=Hl(r),u!==null&&u.dehydrated!==null){if(s===null){if(!m)throw Error(i(318));if(m=r.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(i(317));m[Vt]=r}else Gl(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Et(r),m=!1}else m=Iy(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=m),m=!0;if(!m)return r.flags&256?(ba(r),r):(ba(r),null)}if(ba(r),(r.flags&128)!==0)return r.lanes=l,r;if(l=u!==null,s=s!==null&&s.memoizedState!==null,l){u=r.child,m=null,u.alternate!==null&&u.alternate.memoizedState!==null&&u.alternate.memoizedState.cachePool!==null&&(m=u.alternate.memoizedState.cachePool.pool);var v=null;u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(v=u.memoizedState.cachePool.pool),v!==m&&(u.flags|=2048)}return l!==s&&l&&(r.child.flags|=8192),jd(r,r.updateQueue),Et(r),null;case 4:return Cs(),s===null&&cp(r.stateNode.containerInfo),Et(r),null;case 10:return ya(r.type),Et(r),null;case 19:if(ce(Bt),m=r.memoizedState,m===null)return Et(r),null;if(u=(r.flags&128)!==0,v=m.rendering,v===null)if(u)oc(m,!1);else{if(At!==0||s!==null&&(s.flags&128)!==0)for(s=r.child;s!==null;){if(v=bd(s),v!==null){for(r.flags|=128,oc(m,!1),s=v.updateQueue,r.updateQueue=s,jd(r,s),r.subtreeFlags=0,s=l,l=r.child;l!==null;)Ay(l,s),l=l.sibling;return ue(Bt,Bt.current&1|2),r.child}s=s.sibling}m.tail!==null&&Kn()>wd&&(r.flags|=128,u=!0,oc(m,!1),r.lanes=4194304)}else{if(!u)if(s=bd(v),s!==null){if(r.flags|=128,u=!0,s=s.updateQueue,r.updateQueue=s,jd(r,s),oc(m,!0),m.tail===null&&m.tailMode==="hidden"&&!v.alternate&&!nt)return Et(r),null}else 2*Kn()-m.renderingStartTime>wd&&l!==536870912&&(r.flags|=128,u=!0,oc(m,!1),r.lanes=4194304);m.isBackwards?(v.sibling=r.child,r.child=v):(s=m.last,s!==null?s.sibling=v:r.child=v,m.last=v)}return m.tail!==null?(r=m.tail,m.rendering=r,m.tail=r.sibling,m.renderingStartTime=Kn(),r.sibling=null,s=Bt.current,ue(Bt,u?s&1|2:s&1),r):(Et(r),null);case 22:case 23:return ba(r),dm(),u=r.memoizedState!==null,s!==null?s.memoizedState!==null!==u&&(r.flags|=8192):u&&(r.flags|=8192),u?(l&536870912)!==0&&(r.flags&128)===0&&(Et(r),r.subtreeFlags&6&&(r.flags|=8192)):Et(r),l=r.updateQueue,l!==null&&jd(r,l.retryQueue),l=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),u=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(u=r.memoizedState.cachePool.pool),u!==l&&(r.flags|=2048),s!==null&&ce(br),null;case 24:return l=null,s!==null&&(l=s.memoizedState.cache),r.memoizedState.cache!==l&&(r.flags|=2048),ya(qt),Et(r),null;case 25:return null;case 30:return null}throw Error(i(156,r.tag))}function RC(s,r){switch(Wf(r),r.tag){case 1:return s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 3:return ya(qt),Cs(),s=r.flags,(s&65536)!==0&&(s&128)===0?(r.flags=s&-65537|128,r):null;case 26:case 27:case 5:return ta(r),null;case 13:if(ba(r),s=r.memoizedState,s!==null&&s.dehydrated!==null){if(r.alternate===null)throw Error(i(340));Gl()}return s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 19:return ce(Bt),null;case 4:return Cs(),null;case 10:return ya(r.type),null;case 22:case 23:return ba(r),dm(),s!==null&&ce(br),s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 24:return ya(qt),null;case 25:return null;default:return null}}function Jx(s,r){switch(Wf(r),r.tag){case 3:ya(qt),Cs();break;case 26:case 27:case 5:ta(r);break;case 4:Cs();break;case 13:ba(r);break;case 19:ce(Bt);break;case 10:ya(r.type);break;case 22:case 23:ba(r),dm(),s!==null&&ce(br);break;case 24:ya(qt)}}function lc(s,r){try{var l=r.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var m=u.next;l=m;do{if((l.tag&s)===s){u=void 0;var v=l.create,A=l.inst;u=v(),A.destroy=u}l=l.next}while(l!==m)}}catch(k){dt(r,r.return,k)}}function Ja(s,r,l){try{var u=r.updateQueue,m=u!==null?u.lastEffect:null;if(m!==null){var v=m.next;u=v;do{if((u.tag&s)===s){var A=u.inst,k=A.destroy;if(k!==void 0){A.destroy=void 0,m=r;var B=l,W=k;try{W()}catch(ne){dt(m,B,ne)}}}u=u.next}while(u!==v)}}catch(ne){dt(r,r.return,ne)}}function eb(s){var r=s.updateQueue;if(r!==null){var l=s.stateNode;try{qy(r,l)}catch(u){dt(s,s.return,u)}}}function tb(s,r,l){l.props=Er(s.type,s.memoizedProps),l.state=s.memoizedState;try{l.componentWillUnmount()}catch(u){dt(s,r,u)}}function cc(s,r){try{var l=s.ref;if(l!==null){switch(s.tag){case 26:case 27:case 5:var u=s.stateNode;break;case 30:u=s.stateNode;break;default:u=s.stateNode}typeof l=="function"?s.refCleanup=l(u):l.current=u}}catch(m){dt(s,r,m)}}function qs(s,r){var l=s.ref,u=s.refCleanup;if(l!==null)if(typeof u=="function")try{u()}catch(m){dt(s,r,m)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(m){dt(s,r,m)}else l.current=null}function nb(s){var r=s.type,l=s.memoizedProps,u=s.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":l.autoFocus&&u.focus();break e;case"img":l.src?u.src=l.src:l.srcSet&&(u.srcset=l.srcSet)}}catch(m){dt(s,s.return,m)}}function Um(s,r,l){try{var u=s.stateNode;ZC(u,s.type,l,r),u[Dt]=r}catch(m){dt(s,s.return,m)}}function sb(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&oi(s.type)||s.tag===4}function Fm(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||sb(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&oi(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function qm(s,r,l){var u=s.tag;if(u===5||u===6)s=s.stateNode,r?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(s,r):(r=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,r.appendChild(s),l=l._reactRootContainer,l!=null||r.onclick!==null||(r.onclick=Ld));else if(u!==4&&(u===27&&oi(s.type)&&(l=s.stateNode,r=null),s=s.child,s!==null))for(qm(s,r,l),s=s.sibling;s!==null;)qm(s,r,l),s=s.sibling}function Ad(s,r,l){var u=s.tag;if(u===5||u===6)s=s.stateNode,r?l.insertBefore(s,r):l.appendChild(s);else if(u!==4&&(u===27&&oi(s.type)&&(l=s.stateNode),s=s.child,s!==null))for(Ad(s,r,l),s=s.sibling;s!==null;)Ad(s,r,l),s=s.sibling}function ab(s){var r=s.stateNode,l=s.memoizedProps;try{for(var u=s.type,m=r.attributes;m.length;)r.removeAttributeNode(m[0]);an(r,u,l),r[Vt]=s,r[Dt]=l}catch(v){dt(s,s.return,v)}}var _a=!1,St=!1,Bm=!1,ib=typeof WeakSet=="function"?WeakSet:Set,Xt=null;function DC(s,r){if(s=s.containerInfo,hp=Hd,s=gy(s),Ff(s)){if("selectionStart"in s)var l={start:s.selectionStart,end:s.selectionEnd};else e:{l=(l=s.ownerDocument)&&l.defaultView||window;var u=l.getSelection&&l.getSelection();if(u&&u.rangeCount!==0){l=u.anchorNode;var m=u.anchorOffset,v=u.focusNode;u=u.focusOffset;try{l.nodeType,v.nodeType}catch{l=null;break e}var A=0,k=-1,B=-1,W=0,ne=0,re=s,Z=null;t:for(;;){for(var J;re!==l||m!==0&&re.nodeType!==3||(k=A+m),re!==v||u!==0&&re.nodeType!==3||(B=A+u),re.nodeType===3&&(A+=re.nodeValue.length),(J=re.firstChild)!==null;)Z=re,re=J;for(;;){if(re===s)break t;if(Z===l&&++W===m&&(k=A),Z===v&&++ne===u&&(B=A),(J=re.nextSibling)!==null)break;re=Z,Z=re.parentNode}re=J}l=k===-1||B===-1?null:{start:k,end:B}}else l=null}l=l||{start:0,end:0}}else l=null;for(fp={focusedElem:s,selectionRange:l},Hd=!1,Xt=r;Xt!==null;)if(r=Xt,s=r.child,(r.subtreeFlags&1024)!==0&&s!==null)s.return=r,Xt=s;else for(;Xt!==null;){switch(r=Xt,v=r.alternate,s=r.flags,r.tag){case 0:break;case 11:case 15:break;case 1:if((s&1024)!==0&&v!==null){s=void 0,l=r,m=v.memoizedProps,v=v.memoizedState,u=l.stateNode;try{var Re=Er(l.type,m,l.elementType===l.type);s=u.getSnapshotBeforeUpdate(Re,v),u.__reactInternalSnapshotBeforeUpdate=s}catch(Ce){dt(l,l.return,Ce)}}break;case 3:if((s&1024)!==0){if(s=r.stateNode.containerInfo,l=s.nodeType,l===9)gp(s);else if(l===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":gp(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(i(163))}if(s=r.sibling,s!==null){s.return=r.return,Xt=s;break}Xt=r.return}}function rb(s,r,l){var u=l.flags;switch(l.tag){case 0:case 11:case 15:ei(s,l),u&4&&lc(5,l);break;case 1:if(ei(s,l),u&4)if(s=l.stateNode,r===null)try{s.componentDidMount()}catch(A){dt(l,l.return,A)}else{var m=Er(l.type,r.memoizedProps);r=r.memoizedState;try{s.componentDidUpdate(m,r,s.__reactInternalSnapshotBeforeUpdate)}catch(A){dt(l,l.return,A)}}u&64&&eb(l),u&512&&cc(l,l.return);break;case 3:if(ei(s,l),u&64&&(s=l.updateQueue,s!==null)){if(r=null,l.child!==null)switch(l.child.tag){case 27:case 5:r=l.child.stateNode;break;case 1:r=l.child.stateNode}try{qy(s,r)}catch(A){dt(l,l.return,A)}}break;case 27:r===null&&u&4&&ab(l);case 26:case 5:ei(s,l),r===null&&u&4&&nb(l),u&512&&cc(l,l.return);break;case 12:ei(s,l);break;case 13:ei(s,l),u&4&&cb(s,l),u&64&&(s=l.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(l=qC.bind(null,l),iw(s,l))));break;case 22:if(u=l.memoizedState!==null||_a,!u){r=r!==null&&r.memoizedState!==null||St,m=_a;var v=St;_a=u,(St=r)&&!v?ti(s,l,(l.subtreeFlags&8772)!==0):ei(s,l),_a=m,St=v}break;case 30:break;default:ei(s,l)}}function ob(s){var r=s.alternate;r!==null&&(s.alternate=null,ob(r)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(r=s.stateNode,r!==null&&Ba(r)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var bt=null,Sn=!1;function Ta(s,r,l){for(l=l.child;l!==null;)lb(s,r,l),l=l.sibling}function lb(s,r,l){if(at&&typeof at.onCommitFiberUnmount=="function")try{at.onCommitFiberUnmount(Tt,l)}catch{}switch(l.tag){case 26:St||qs(l,r),Ta(s,r,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:St||qs(l,r);var u=bt,m=Sn;oi(l.type)&&(bt=l.stateNode,Sn=!1),Ta(s,r,l),yc(l.stateNode),bt=u,Sn=m;break;case 5:St||qs(l,r);case 6:if(u=bt,m=Sn,bt=null,Ta(s,r,l),bt=u,Sn=m,bt!==null)if(Sn)try{(bt.nodeType===9?bt.body:bt.nodeName==="HTML"?bt.ownerDocument.body:bt).removeChild(l.stateNode)}catch(v){dt(l,r,v)}else try{bt.removeChild(l.stateNode)}catch(v){dt(l,r,v)}break;case 18:bt!==null&&(Sn?(s=bt,Xb(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,l.stateNode),Ac(s)):Xb(bt,l.stateNode));break;case 4:u=bt,m=Sn,bt=l.stateNode.containerInfo,Sn=!0,Ta(s,r,l),bt=u,Sn=m;break;case 0:case 11:case 14:case 15:St||Ja(2,l,r),St||Ja(4,l,r),Ta(s,r,l);break;case 1:St||(qs(l,r),u=l.stateNode,typeof u.componentWillUnmount=="function"&&tb(l,r,u)),Ta(s,r,l);break;case 21:Ta(s,r,l);break;case 22:St=(u=St)||l.memoizedState!==null,Ta(s,r,l),St=u;break;default:Ta(s,r,l)}}function cb(s,r){if(r.memoizedState===null&&(s=r.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Ac(s)}catch(l){dt(r,r.return,l)}}function MC(s){switch(s.tag){case 13:case 19:var r=s.stateNode;return r===null&&(r=s.stateNode=new ib),r;case 22:return s=s.stateNode,r=s._retryCache,r===null&&(r=s._retryCache=new ib),r;default:throw Error(i(435,s.tag))}}function zm(s,r){var l=MC(s);r.forEach(function(u){var m=BC.bind(null,s,u);l.has(u)||(l.add(u),u.then(m,m))})}function Vn(s,r){var l=r.deletions;if(l!==null)for(var u=0;u<l.length;u++){var m=l[u],v=s,A=r,k=A;e:for(;k!==null;){switch(k.tag){case 27:if(oi(k.type)){bt=k.stateNode,Sn=!1;break e}break;case 5:bt=k.stateNode,Sn=!1;break e;case 3:case 4:bt=k.stateNode.containerInfo,Sn=!0;break e}k=k.return}if(bt===null)throw Error(i(160));lb(v,A,m),bt=null,Sn=!1,v=m.alternate,v!==null&&(v.return=null),m.return=null}if(r.subtreeFlags&13878)for(r=r.child;r!==null;)ub(r,s),r=r.sibling}var vs=null;function ub(s,r){var l=s.alternate,u=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:Vn(r,s),Un(s),u&4&&(Ja(3,s,s.return),lc(3,s),Ja(5,s,s.return));break;case 1:Vn(r,s),Un(s),u&512&&(St||l===null||qs(l,l.return)),u&64&&_a&&(s=s.updateQueue,s!==null&&(u=s.callbacks,u!==null&&(l=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=l===null?u:l.concat(u))));break;case 26:var m=vs;if(Vn(r,s),Un(s),u&512&&(St||l===null||qs(l,l.return)),u&4){var v=l!==null?l.memoizedState:null;if(u=s.memoizedState,l===null)if(u===null)if(s.stateNode===null){e:{u=s.type,l=s.memoizedProps,m=m.ownerDocument||m;t:switch(u){case"title":v=m.getElementsByTagName("title")[0],(!v||v[Wi]||v[Vt]||v.namespaceURI==="http://www.w3.org/2000/svg"||v.hasAttribute("itemprop"))&&(v=m.createElement(u),m.head.insertBefore(v,m.querySelector("head > title"))),an(v,u,l),v[Vt]=s,Ct(v),u=v;break e;case"link":var A=aN("link","href",m).get(u+(l.href||""));if(A){for(var k=0;k<A.length;k++)if(v=A[k],v.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&v.getAttribute("rel")===(l.rel==null?null:l.rel)&&v.getAttribute("title")===(l.title==null?null:l.title)&&v.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){A.splice(k,1);break t}}v=m.createElement(u),an(v,u,l),m.head.appendChild(v);break;case"meta":if(A=aN("meta","content",m).get(u+(l.content||""))){for(k=0;k<A.length;k++)if(v=A[k],v.getAttribute("content")===(l.content==null?null:""+l.content)&&v.getAttribute("name")===(l.name==null?null:l.name)&&v.getAttribute("property")===(l.property==null?null:l.property)&&v.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&v.getAttribute("charset")===(l.charSet==null?null:l.charSet)){A.splice(k,1);break t}}v=m.createElement(u),an(v,u,l),m.head.appendChild(v);break;default:throw Error(i(468,u))}v[Vt]=s,Ct(v),u=v}s.stateNode=u}else iN(m,s.type,s.stateNode);else s.stateNode=sN(m,u,s.memoizedProps);else v!==u?(v===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):v.count--,u===null?iN(m,s.type,s.stateNode):sN(m,u,s.memoizedProps)):u===null&&s.stateNode!==null&&Um(s,s.memoizedProps,l.memoizedProps)}break;case 27:Vn(r,s),Un(s),u&512&&(St||l===null||qs(l,l.return)),l!==null&&u&4&&Um(s,s.memoizedProps,l.memoizedProps);break;case 5:if(Vn(r,s),Un(s),u&512&&(St||l===null||qs(l,l.return)),s.flags&32){m=s.stateNode;try{Wn(m,"")}catch(J){dt(s,s.return,J)}}u&4&&s.stateNode!=null&&(m=s.memoizedProps,Um(s,m,l!==null?l.memoizedProps:m)),u&1024&&(Bm=!0);break;case 6:if(Vn(r,s),Un(s),u&4){if(s.stateNode===null)throw Error(i(162));u=s.memoizedProps,l=s.stateNode;try{l.nodeValue=u}catch(J){dt(s,s.return,J)}}break;case 3:if(qd=null,m=vs,vs=Ud(r.containerInfo),Vn(r,s),vs=m,Un(s),u&4&&l!==null&&l.memoizedState.isDehydrated)try{Ac(r.containerInfo)}catch(J){dt(s,s.return,J)}Bm&&(Bm=!1,db(s));break;case 4:u=vs,vs=Ud(s.stateNode.containerInfo),Vn(r,s),Un(s),vs=u;break;case 12:Vn(r,s),Un(s);break;case 13:Vn(r,s),Un(s),s.child.flags&8192&&s.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Km=Kn()),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,zm(s,u)));break;case 22:m=s.memoizedState!==null;var B=l!==null&&l.memoizedState!==null,W=_a,ne=St;if(_a=W||m,St=ne||B,Vn(r,s),St=ne,_a=W,Un(s),u&8192)e:for(r=s.stateNode,r._visibility=m?r._visibility&-2:r._visibility|1,m&&(l===null||B||_a||St||_r(s)),l=null,r=s;;){if(r.tag===5||r.tag===26){if(l===null){B=l=r;try{if(v=B.stateNode,m)A=v.style,typeof A.setProperty=="function"?A.setProperty("display","none","important"):A.display="none";else{k=B.stateNode;var re=B.memoizedProps.style,Z=re!=null&&re.hasOwnProperty("display")?re.display:null;k.style.display=Z==null||typeof Z=="boolean"?"":(""+Z).trim()}}catch(J){dt(B,B.return,J)}}}else if(r.tag===6){if(l===null){B=r;try{B.stateNode.nodeValue=m?"":B.memoizedProps}catch(J){dt(B,B.return,J)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===s)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;l===r&&(l=null),r=r.return}l===r&&(l=null),r.sibling.return=r.return,r=r.sibling}u&4&&(u=s.updateQueue,u!==null&&(l=u.retryQueue,l!==null&&(u.retryQueue=null,zm(s,l))));break;case 19:Vn(r,s),Un(s),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,zm(s,u)));break;case 30:break;case 21:break;default:Vn(r,s),Un(s)}}function Un(s){var r=s.flags;if(r&2){try{for(var l,u=s.return;u!==null;){if(sb(u)){l=u;break}u=u.return}if(l==null)throw Error(i(160));switch(l.tag){case 27:var m=l.stateNode,v=Fm(s);Ad(s,v,m);break;case 5:var A=l.stateNode;l.flags&32&&(Wn(A,""),l.flags&=-33);var k=Fm(s);Ad(s,k,A);break;case 3:case 4:var B=l.stateNode.containerInfo,W=Fm(s);qm(s,W,B);break;default:throw Error(i(161))}}catch(ne){dt(s,s.return,ne)}s.flags&=-3}r&4096&&(s.flags&=-4097)}function db(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var r=s;db(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),s=s.sibling}}function ei(s,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)rb(s,r.alternate,r),r=r.sibling}function _r(s){for(s=s.child;s!==null;){var r=s;switch(r.tag){case 0:case 11:case 14:case 15:Ja(4,r,r.return),_r(r);break;case 1:qs(r,r.return);var l=r.stateNode;typeof l.componentWillUnmount=="function"&&tb(r,r.return,l),_r(r);break;case 27:yc(r.stateNode);case 26:case 5:qs(r,r.return),_r(r);break;case 22:r.memoizedState===null&&_r(r);break;case 30:_r(r);break;default:_r(r)}s=s.sibling}}function ti(s,r,l){for(l=l&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var u=r.alternate,m=s,v=r,A=v.flags;switch(v.tag){case 0:case 11:case 15:ti(m,v,l),lc(4,v);break;case 1:if(ti(m,v,l),u=v,m=u.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch(W){dt(u,u.return,W)}if(u=v,m=u.updateQueue,m!==null){var k=u.stateNode;try{var B=m.shared.hiddenCallbacks;if(B!==null)for(m.shared.hiddenCallbacks=null,m=0;m<B.length;m++)Fy(B[m],k)}catch(W){dt(u,u.return,W)}}l&&A&64&&eb(v),cc(v,v.return);break;case 27:ab(v);case 26:case 5:ti(m,v,l),l&&u===null&&A&4&&nb(v),cc(v,v.return);break;case 12:ti(m,v,l);break;case 13:ti(m,v,l),l&&A&4&&cb(m,v);break;case 22:v.memoizedState===null&&ti(m,v,l),cc(v,v.return);break;case 30:break;default:ti(m,v,l)}r=r.sibling}}function Hm(s,r){var l=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),s=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(s=r.memoizedState.cachePool.pool),s!==l&&(s!=null&&s.refCount++,l!=null&&Ql(l))}function Gm(s,r){s=null,r.alternate!==null&&(s=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==s&&(r.refCount++,s!=null&&Ql(s))}function Bs(s,r,l,u){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)hb(s,r,l,u),r=r.sibling}function hb(s,r,l,u){var m=r.flags;switch(r.tag){case 0:case 11:case 15:Bs(s,r,l,u),m&2048&&lc(9,r);break;case 1:Bs(s,r,l,u);break;case 3:Bs(s,r,l,u),m&2048&&(s=null,r.alternate!==null&&(s=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==s&&(r.refCount++,s!=null&&Ql(s)));break;case 12:if(m&2048){Bs(s,r,l,u),s=r.stateNode;try{var v=r.memoizedProps,A=v.id,k=v.onPostCommit;typeof k=="function"&&k(A,r.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(B){dt(r,r.return,B)}}else Bs(s,r,l,u);break;case 13:Bs(s,r,l,u);break;case 23:break;case 22:v=r.stateNode,A=r.alternate,r.memoizedState!==null?v._visibility&2?Bs(s,r,l,u):uc(s,r):v._visibility&2?Bs(s,r,l,u):(v._visibility|=2,jo(s,r,l,u,(r.subtreeFlags&10256)!==0)),m&2048&&Hm(A,r);break;case 24:Bs(s,r,l,u),m&2048&&Gm(r.alternate,r);break;default:Bs(s,r,l,u)}}function jo(s,r,l,u,m){for(m=m&&(r.subtreeFlags&10256)!==0,r=r.child;r!==null;){var v=s,A=r,k=l,B=u,W=A.flags;switch(A.tag){case 0:case 11:case 15:jo(v,A,k,B,m),lc(8,A);break;case 23:break;case 22:var ne=A.stateNode;A.memoizedState!==null?ne._visibility&2?jo(v,A,k,B,m):uc(v,A):(ne._visibility|=2,jo(v,A,k,B,m)),m&&W&2048&&Hm(A.alternate,A);break;case 24:jo(v,A,k,B,m),m&&W&2048&&Gm(A.alternate,A);break;default:jo(v,A,k,B,m)}r=r.sibling}}function uc(s,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var l=s,u=r,m=u.flags;switch(u.tag){case 22:uc(l,u),m&2048&&Hm(u.alternate,u);break;case 24:uc(l,u),m&2048&&Gm(u.alternate,u);break;default:uc(l,u)}r=r.sibling}}var dc=8192;function Ao(s){if(s.subtreeFlags&dc)for(s=s.child;s!==null;)fb(s),s=s.sibling}function fb(s){switch(s.tag){case 26:Ao(s),s.flags&dc&&s.memoizedState!==null&&yw(vs,s.memoizedState,s.memoizedProps);break;case 5:Ao(s);break;case 3:case 4:var r=vs;vs=Ud(s.stateNode.containerInfo),Ao(s),vs=r;break;case 22:s.memoizedState===null&&(r=s.alternate,r!==null&&r.memoizedState!==null?(r=dc,dc=16777216,Ao(s),dc=r):Ao(s));break;default:Ao(s)}}function mb(s){var r=s.alternate;if(r!==null&&(s=r.child,s!==null)){r.child=null;do r=s.sibling,s.sibling=null,s=r;while(s!==null)}}function hc(s){var r=s.deletions;if((s.flags&16)!==0){if(r!==null)for(var l=0;l<r.length;l++){var u=r[l];Xt=u,gb(u,s)}mb(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)pb(s),s=s.sibling}function pb(s){switch(s.tag){case 0:case 11:case 15:hc(s),s.flags&2048&&Ja(9,s,s.return);break;case 3:hc(s);break;case 12:hc(s);break;case 22:var r=s.stateNode;s.memoizedState!==null&&r._visibility&2&&(s.return===null||s.return.tag!==13)?(r._visibility&=-3,Cd(s)):hc(s);break;default:hc(s)}}function Cd(s){var r=s.deletions;if((s.flags&16)!==0){if(r!==null)for(var l=0;l<r.length;l++){var u=r[l];Xt=u,gb(u,s)}mb(s)}for(s=s.child;s!==null;){switch(r=s,r.tag){case 0:case 11:case 15:Ja(8,r,r.return),Cd(r);break;case 22:l=r.stateNode,l._visibility&2&&(l._visibility&=-3,Cd(r));break;default:Cd(r)}s=s.sibling}}function gb(s,r){for(;Xt!==null;){var l=Xt;switch(l.tag){case 0:case 11:case 15:Ja(8,l,r);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var u=l.memoizedState.cachePool.pool;u!=null&&u.refCount++}break;case 24:Ql(l.memoizedState.cache)}if(u=l.child,u!==null)u.return=l,Xt=u;else e:for(l=s;Xt!==null;){u=Xt;var m=u.sibling,v=u.return;if(ob(u),u===l){Xt=null;break e}if(m!==null){m.return=v,Xt=m;break e}Xt=v}}}var kC={getCacheForType:function(s){var r=hn(qt),l=r.data.get(s);return l===void 0&&(l=s(),r.data.set(s,l)),l}},OC=typeof WeakMap=="function"?WeakMap:Map,it=0,pt=null,Ge=null,We=0,rt=0,Fn=null,ni=!1,Co=!1,$m=!1,ja=0,At=0,si=0,Tr=0,Ym=0,rs=0,wo=0,fc=null,In=null,Qm=!1,Km=0,wd=1/0,Sd=null,ai=null,sn=0,ii=null,So=null,Io=0,Xm=0,Wm=null,vb=null,mc=0,Zm=null;function qn(){if((it&2)!==0&&We!==0)return We&-We;if(Q.T!==null){var s=vo;return s!==0?s:ip()}return Fa()}function yb(){rs===0&&(rs=(We&536870912)===0||nt?_l():536870912);var s=is.current;return s!==null&&(s.flags|=32),rs}function Bn(s,r,l){(s===pt&&(rt===2||rt===9)||s.cancelPendingCommit!==null)&&(Ro(s,0),ri(s,We,rs,!1)),sa(s,l),((it&2)===0||s!==pt)&&(s===pt&&((it&2)===0&&(Tr|=l),At===4&&ri(s,We,rs,!1)),zs(s))}function xb(s,r,l){if((it&6)!==0)throw Error(i(327));var u=!l&&(r&124)===0&&(r&s.expiredLanes)===0||Xi(s,r),m=u?VC(s,r):tp(s,r,!0),v=u;do{if(m===0){Co&&!u&&ri(s,r,0,!1);break}else{if(l=s.current.alternate,v&&!PC(l)){m=tp(s,r,!1),v=!1;continue}if(m===2){if(v=r,s.errorRecoveryDisabledLanes&v)var A=0;else A=s.pendingLanes&-536870913,A=A!==0?A:A&536870912?536870912:0;if(A!==0){r=A;e:{var k=s;m=fc;var B=k.current.memoizedState.isDehydrated;if(B&&(Ro(k,A).flags|=256),A=tp(k,A,!1),A!==2){if($m&&!B){k.errorRecoveryDisabledLanes|=v,Tr|=v,m=4;break e}v=In,In=m,v!==null&&(In===null?In=v:In.push.apply(In,v))}m=A}if(v=!1,m!==2)continue}}if(m===1){Ro(s,0),ri(s,r,0,!0);break}e:{switch(u=s,v=m,v){case 0:case 1:throw Error(i(345));case 4:if((r&4194048)!==r)break;case 6:ri(u,r,rs,!ni);break e;case 2:In=null;break;case 3:case 5:break;default:throw Error(i(329))}if((r&62914560)===r&&(m=Km+300-Kn(),10<m)){if(ri(u,r,rs,!ni),Yr(u,0,!0)!==0)break e;u.timeoutHandle=Qb(bb.bind(null,u,l,In,Sd,Qm,r,rs,Tr,wo,ni,v,2,-0,0),m);break e}bb(u,l,In,Sd,Qm,r,rs,Tr,wo,ni,v,0,-0,0)}}break}while(!0);zs(s)}function bb(s,r,l,u,m,v,A,k,B,W,ne,re,Z,J){if(s.timeoutHandle=-1,re=r.subtreeFlags,(re&8192||(re&16785408)===16785408)&&(Nc={stylesheets:null,count:0,unsuspend:vw},fb(r),re=xw(),re!==null)){s.cancelPendingCommit=re(Cb.bind(null,s,r,v,l,u,m,A,k,B,ne,1,Z,J)),ri(s,v,A,!W);return}Cb(s,r,v,l,u,m,A,k,B)}function PC(s){for(var r=s;;){var l=r.tag;if((l===0||l===11||l===15)&&r.flags&16384&&(l=r.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var u=0;u<l.length;u++){var m=l[u],v=m.getSnapshot;m=m.value;try{if(!Pn(v(),m))return!1}catch{return!1}}if(l=r.child,r.subtreeFlags&16384&&l!==null)l.return=r,r=l;else{if(r===s)break;for(;r.sibling===null;){if(r.return===null||r.return===s)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function ri(s,r,l,u){r&=~Ym,r&=~Tr,s.suspendedLanes|=r,s.pingedLanes&=~r,u&&(s.warmLanes|=r),u=s.expirationTimes;for(var m=r;0<m;){var v=31-dn(m),A=1<<v;u[v]=-1,m&=~A}l!==0&&ws(s,l,r)}function Id(){return(it&6)===0?(pc(0),!1):!0}function Jm(){if(Ge!==null){if(rt===0)var s=Ge.return;else s=Ge,va=yr=null,gm(s),_o=null,ic=0,s=Ge;for(;s!==null;)Jx(s.alternate,s),s=s.return;Ge=null}}function Ro(s,r){var l=s.timeoutHandle;l!==-1&&(s.timeoutHandle=-1,ew(l)),l=s.cancelPendingCommit,l!==null&&(s.cancelPendingCommit=null,l()),Jm(),pt=s,Ge=l=ma(s.current,null),We=r,rt=0,Fn=null,ni=!1,Co=Xi(s,r),$m=!1,wo=rs=Ym=Tr=si=At=0,In=fc=null,Qm=!1,(r&8)!==0&&(r|=r&32);var u=s.entangledLanes;if(u!==0)for(s=s.entanglements,u&=r;0<u;){var m=31-dn(u),v=1<<m;r|=s[m],u&=~v}return ja=r,Zu(),l}function Nb(s,r){Fe=null,Q.H=vd,r===Xl||r===od?(r=Vy(),rt=3):r===Oy?(r=Vy(),rt=4):rt=r===Ux?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,Fn=r,Ge===null&&(At=1,Ed(s,ts(r,s.current)))}function Eb(){var s=Q.H;return Q.H=vd,s===null?vd:s}function _b(){var s=Q.A;return Q.A=kC,s}function ep(){At=4,ni||(We&4194048)!==We&&is.current!==null||(Co=!0),(si&134217727)===0&&(Tr&134217727)===0||pt===null||ri(pt,We,rs,!1)}function tp(s,r,l){var u=it;it|=2;var m=Eb(),v=_b();(pt!==s||We!==r)&&(Sd=null,Ro(s,r)),r=!1;var A=At;e:do try{if(rt!==0&&Ge!==null){var k=Ge,B=Fn;switch(rt){case 8:Jm(),A=6;break e;case 3:case 2:case 9:case 6:is.current===null&&(r=!0);var W=rt;if(rt=0,Fn=null,Do(s,k,B,W),l&&Co){A=0;break e}break;default:W=rt,rt=0,Fn=null,Do(s,k,B,W)}}LC(),A=At;break}catch(ne){Nb(s,ne)}while(!0);return r&&s.shellSuspendCounter++,va=yr=null,it=u,Q.H=m,Q.A=v,Ge===null&&(pt=null,We=0,Zu()),A}function LC(){for(;Ge!==null;)Tb(Ge)}function VC(s,r){var l=it;it|=2;var u=Eb(),m=_b();pt!==s||We!==r?(Sd=null,wd=Kn()+500,Ro(s,r)):Co=Xi(s,r);e:do try{if(rt!==0&&Ge!==null){r=Ge;var v=Fn;t:switch(rt){case 1:rt=0,Fn=null,Do(s,r,v,1);break;case 2:case 9:if(Py(v)){rt=0,Fn=null,jb(r);break}r=function(){rt!==2&&rt!==9||pt!==s||(rt=7),zs(s)},v.then(r,r);break e;case 3:rt=7;break e;case 4:rt=5;break e;case 7:Py(v)?(rt=0,Fn=null,jb(r)):(rt=0,Fn=null,Do(s,r,v,7));break;case 5:var A=null;switch(Ge.tag){case 26:A=Ge.memoizedState;case 5:case 27:var k=Ge;if(!A||rN(A)){rt=0,Fn=null;var B=k.sibling;if(B!==null)Ge=B;else{var W=k.return;W!==null?(Ge=W,Rd(W)):Ge=null}break t}}rt=0,Fn=null,Do(s,r,v,5);break;case 6:rt=0,Fn=null,Do(s,r,v,6);break;case 8:Jm(),At=6;break e;default:throw Error(i(462))}}UC();break}catch(ne){Nb(s,ne)}while(!0);return va=yr=null,Q.H=u,Q.A=m,it=l,Ge!==null?0:(pt=null,We=0,Zu(),At)}function UC(){for(;Ge!==null&&!xl();)Tb(Ge)}function Tb(s){var r=Wx(s.alternate,s,ja);s.memoizedProps=s.pendingProps,r===null?Rd(s):Ge=r}function jb(s){var r=s,l=r.alternate;switch(r.tag){case 15:case 0:r=Gx(l,r,r.pendingProps,r.type,void 0,We);break;case 11:r=Gx(l,r,r.pendingProps,r.type.render,r.ref,We);break;case 5:gm(r);default:Jx(l,r),r=Ge=Ay(r,ja),r=Wx(l,r,ja)}s.memoizedProps=s.pendingProps,r===null?Rd(s):Ge=r}function Do(s,r,l,u){va=yr=null,gm(r),_o=null,ic=0;var m=r.return;try{if(wC(s,m,r,l,We)){At=1,Ed(s,ts(l,s.current)),Ge=null;return}}catch(v){if(m!==null)throw Ge=m,v;At=1,Ed(s,ts(l,s.current)),Ge=null;return}r.flags&32768?(nt||u===1?s=!0:Co||(We&536870912)!==0?s=!1:(ni=s=!0,(u===2||u===9||u===3||u===6)&&(u=is.current,u!==null&&u.tag===13&&(u.flags|=16384))),Ab(r,s)):Rd(r)}function Rd(s){var r=s;do{if((r.flags&32768)!==0){Ab(r,ni);return}s=r.return;var l=IC(r.alternate,r,ja);if(l!==null){Ge=l;return}if(r=r.sibling,r!==null){Ge=r;return}Ge=r=s}while(r!==null);At===0&&(At=5)}function Ab(s,r){do{var l=RC(s.alternate,s);if(l!==null){l.flags&=32767,Ge=l;return}if(l=s.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!r&&(s=s.sibling,s!==null)){Ge=s;return}Ge=s=l}while(s!==null);At=6,Ge=null}function Cb(s,r,l,u,m,v,A,k,B){s.cancelPendingCommit=null;do Dd();while(sn!==0);if((it&6)!==0)throw Error(i(327));if(r!==null){if(r===s.current)throw Error(i(177));if(v=r.lanes|r.childLanes,v|=Gf,jl(s,l,v,A,k,B),s===pt&&(Ge=pt=null,We=0),So=r,ii=s,Io=l,Xm=v,Wm=m,vb=u,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,zC($i,function(){return Db(),null})):(s.callbackNode=null,s.callbackPriority=0),u=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||u){u=Q.T,Q.T=null,m=se.p,se.p=2,A=it,it|=4;try{DC(s,r,l)}finally{it=A,se.p=m,Q.T=u}}sn=1,wb(),Sb(),Ib()}}function wb(){if(sn===1){sn=0;var s=ii,r=So,l=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||l){l=Q.T,Q.T=null;var u=se.p;se.p=2;var m=it;it|=4;try{ub(r,s);var v=fp,A=gy(s.containerInfo),k=v.focusedElem,B=v.selectionRange;if(A!==k&&k&&k.ownerDocument&&py(k.ownerDocument.documentElement,k)){if(B!==null&&Ff(k)){var W=B.start,ne=B.end;if(ne===void 0&&(ne=W),"selectionStart"in k)k.selectionStart=W,k.selectionEnd=Math.min(ne,k.value.length);else{var re=k.ownerDocument||document,Z=re&&re.defaultView||window;if(Z.getSelection){var J=Z.getSelection(),Re=k.textContent.length,Ce=Math.min(B.start,Re),ut=B.end===void 0?Ce:Math.min(B.end,Re);!J.extend&&Ce>ut&&(A=ut,ut=Ce,Ce=A);var Y=my(k,Ce),G=my(k,ut);if(Y&&G&&(J.rangeCount!==1||J.anchorNode!==Y.node||J.anchorOffset!==Y.offset||J.focusNode!==G.node||J.focusOffset!==G.offset)){var X=re.createRange();X.setStart(Y.node,Y.offset),J.removeAllRanges(),Ce>ut?(J.addRange(X),J.extend(G.node,G.offset)):(X.setEnd(G.node,G.offset),J.addRange(X))}}}}for(re=[],J=k;J=J.parentNode;)J.nodeType===1&&re.push({element:J,left:J.scrollLeft,top:J.scrollTop});for(typeof k.focus=="function"&&k.focus(),k=0;k<re.length;k++){var ae=re[k];ae.element.scrollLeft=ae.left,ae.element.scrollTop=ae.top}}Hd=!!hp,fp=hp=null}finally{it=m,se.p=u,Q.T=l}}s.current=r,sn=2}}function Sb(){if(sn===2){sn=0;var s=ii,r=So,l=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||l){l=Q.T,Q.T=null;var u=se.p;se.p=2;var m=it;it|=4;try{rb(s,r.alternate,r)}finally{it=m,se.p=u,Q.T=l}}sn=3}}function Ib(){if(sn===4||sn===3){sn=0,Cu();var s=ii,r=So,l=Io,u=vb;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?sn=5:(sn=0,So=ii=null,Rb(s,s.pendingLanes));var m=s.pendingLanes;if(m===0&&(ai=null),Qr(l),r=r.stateNode,at&&typeof at.onCommitFiberRoot=="function")try{at.onCommitFiberRoot(Tt,r,void 0,(r.current.flags&128)===128)}catch{}if(u!==null){r=Q.T,m=se.p,se.p=2,Q.T=null;try{for(var v=s.onRecoverableError,A=0;A<u.length;A++){var k=u[A];v(k.value,{componentStack:k.stack})}}finally{Q.T=r,se.p=m}}(Io&3)!==0&&Dd(),zs(s),m=s.pendingLanes,(l&4194090)!==0&&(m&42)!==0?s===Zm?mc++:(mc=0,Zm=s):mc=0,pc(0)}}function Rb(s,r){(s.pooledCacheLanes&=r)===0&&(r=s.pooledCache,r!=null&&(s.pooledCache=null,Ql(r)))}function Dd(s){return wb(),Sb(),Ib(),Db()}function Db(){if(sn!==5)return!1;var s=ii,r=Xm;Xm=0;var l=Qr(Io),u=Q.T,m=se.p;try{se.p=32>l?32:l,Q.T=null,l=Wm,Wm=null;var v=ii,A=Io;if(sn=0,So=ii=null,Io=0,(it&6)!==0)throw Error(i(331));var k=it;if(it|=4,pb(v.current),hb(v,v.current,A,l),it=k,pc(0,!1),at&&typeof at.onPostCommitFiberRoot=="function")try{at.onPostCommitFiberRoot(Tt,v)}catch{}return!0}finally{se.p=m,Q.T=u,Rb(s,r)}}function Mb(s,r,l){r=ts(l,r),r=Im(s.stateNode,r,2),s=Ka(s,r,2),s!==null&&(sa(s,2),zs(s))}function dt(s,r,l){if(s.tag===3)Mb(s,s,l);else for(;r!==null;){if(r.tag===3){Mb(r,s,l);break}else if(r.tag===1){var u=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(ai===null||!ai.has(u))){s=ts(l,s),l=Lx(2),u=Ka(r,l,2),u!==null&&(Vx(l,u,r,s),sa(u,2),zs(u));break}}r=r.return}}function np(s,r,l){var u=s.pingCache;if(u===null){u=s.pingCache=new OC;var m=new Set;u.set(r,m)}else m=u.get(r),m===void 0&&(m=new Set,u.set(r,m));m.has(l)||($m=!0,m.add(l),s=FC.bind(null,s,r,l),r.then(s,s))}function FC(s,r,l){var u=s.pingCache;u!==null&&u.delete(r),s.pingedLanes|=s.suspendedLanes&l,s.warmLanes&=~l,pt===s&&(We&l)===l&&(At===4||At===3&&(We&62914560)===We&&300>Kn()-Km?(it&2)===0&&Ro(s,0):Ym|=l,wo===We&&(wo=0)),zs(s)}function kb(s,r){r===0&&(r=Tl()),s=fo(s,r),s!==null&&(sa(s,r),zs(s))}function qC(s){var r=s.memoizedState,l=0;r!==null&&(l=r.retryLane),kb(s,l)}function BC(s,r){var l=0;switch(s.tag){case 13:var u=s.stateNode,m=s.memoizedState;m!==null&&(l=m.retryLane);break;case 19:u=s.stateNode;break;case 22:u=s.stateNode._retryCache;break;default:throw Error(i(314))}u!==null&&u.delete(r),kb(s,l)}function zC(s,r){return Hi(s,r)}var Md=null,Mo=null,sp=!1,kd=!1,ap=!1,jr=0;function zs(s){s!==Mo&&s.next===null&&(Mo===null?Md=Mo=s:Mo=Mo.next=s),kd=!0,sp||(sp=!0,GC())}function pc(s,r){if(!ap&&kd){ap=!0;do for(var l=!1,u=Md;u!==null;){if(s!==0){var m=u.pendingLanes;if(m===0)var v=0;else{var A=u.suspendedLanes,k=u.pingedLanes;v=(1<<31-dn(42|s)+1)-1,v&=m&~(A&~k),v=v&201326741?v&201326741|1:v?v|2:0}v!==0&&(l=!0,Vb(u,v))}else v=We,v=Yr(u,u===pt?v:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),(v&3)===0||Xi(u,v)||(l=!0,Vb(u,v));u=u.next}while(l);ap=!1}}function HC(){Ob()}function Ob(){kd=sp=!1;var s=0;jr!==0&&(JC()&&(s=jr),jr=0);for(var r=Kn(),l=null,u=Md;u!==null;){var m=u.next,v=Pb(u,r);v===0?(u.next=null,l===null?Md=m:l.next=m,m===null&&(Mo=l)):(l=u,(s!==0||(v&3)!==0)&&(kd=!0)),u=m}pc(s)}function Pb(s,r){for(var l=s.suspendedLanes,u=s.pingedLanes,m=s.expirationTimes,v=s.pendingLanes&-62914561;0<v;){var A=31-dn(v),k=1<<A,B=m[A];B===-1?((k&l)===0||(k&u)!==0)&&(m[A]=El(k,r)):B<=r&&(s.expiredLanes|=k),v&=~k}if(r=pt,l=We,l=Yr(s,s===r?l:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),u=s.callbackNode,l===0||s===r&&(rt===2||rt===9)||s.cancelPendingCommit!==null)return u!==null&&u!==null&&Gi(u),s.callbackNode=null,s.callbackPriority=0;if((l&3)===0||Xi(s,l)){if(r=l&-l,r===s.callbackPriority)return r;switch(u!==null&&Gi(u),Qr(l)){case 2:case 8:l=Gr;break;case 32:l=$i;break;case 268435456:l=$r;break;default:l=$i}return u=Lb.bind(null,s),l=Hi(l,u),s.callbackPriority=r,s.callbackNode=l,r}return u!==null&&u!==null&&Gi(u),s.callbackPriority=2,s.callbackNode=null,2}function Lb(s,r){if(sn!==0&&sn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var l=s.callbackNode;if(Dd()&&s.callbackNode!==l)return null;var u=We;return u=Yr(s,s===pt?u:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),u===0?null:(xb(s,u,r),Pb(s,Kn()),s.callbackNode!=null&&s.callbackNode===l?Lb.bind(null,s):null)}function Vb(s,r){if(Dd())return null;xb(s,r,!0)}function GC(){tw(function(){(it&6)!==0?Hi(bl,HC):Ob()})}function ip(){return jr===0&&(jr=_l()),jr}function Ub(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:eo(""+s)}function Fb(s,r){var l=r.ownerDocument.createElement("input");return l.name=r.name,l.value=r.value,s.id&&l.setAttribute("form",s.id),r.parentNode.insertBefore(l,r),s=new FormData(s),l.parentNode.removeChild(l),s}function $C(s,r,l,u,m){if(r==="submit"&&l&&l.stateNode===m){var v=Ub((m[Dt]||null).action),A=u.submitter;A&&(r=(r=A[Dt]||null)?Ub(r.formAction):A.getAttribute("formAction"),r!==null&&(v=r,A=null));var k=new to("action","action",null,u,m);s.push({event:k,listeners:[{instance:null,listener:function(){if(u.defaultPrevented){if(jr!==0){var B=A?Fb(m,A):new FormData(m);jm(l,{pending:!0,data:B,method:m.method,action:v},null,B)}}else typeof v=="function"&&(k.preventDefault(),B=A?Fb(m,A):new FormData(m),jm(l,{pending:!0,data:B,method:m.method,action:v},v,B))},currentTarget:m}]})}}for(var rp=0;rp<Hf.length;rp++){var op=Hf[rp],YC=op.toLowerCase(),QC=op[0].toUpperCase()+op.slice(1);gs(YC,"on"+QC)}gs(xy,"onAnimationEnd"),gs(by,"onAnimationIteration"),gs(Ny,"onAnimationStart"),gs("dblclick","onDoubleClick"),gs("focusin","onFocus"),gs("focusout","onBlur"),gs(dC,"onTransitionRun"),gs(hC,"onTransitionStart"),gs(fC,"onTransitionCancel"),gs(Ey,"onTransitionEnd"),ia("onMouseEnter",["mouseout","mouseover"]),ia("onMouseLeave",["mouseout","mouseover"]),ia("onPointerEnter",["pointerout","pointerover"]),ia("onPointerLeave",["pointerout","pointerover"]),ms("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ms("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ms("onBeforeInput",["compositionend","keypress","textInput","paste"]),ms("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ms("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ms("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var gc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),KC=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(gc));function qb(s,r){r=(r&4)!==0;for(var l=0;l<s.length;l++){var u=s[l],m=u.event;u=u.listeners;e:{var v=void 0;if(r)for(var A=u.length-1;0<=A;A--){var k=u[A],B=k.instance,W=k.currentTarget;if(k=k.listener,B!==v&&m.isPropagationStopped())break e;v=k,m.currentTarget=W;try{v(m)}catch(ne){Nd(ne)}m.currentTarget=null,v=B}else for(A=0;A<u.length;A++){if(k=u[A],B=k.instance,W=k.currentTarget,k=k.listener,B!==v&&m.isPropagationStopped())break e;v=k,m.currentTarget=W;try{v(m)}catch(ne){Nd(ne)}m.currentTarget=null,v=B}}}}function $e(s,r){var l=r[Cl];l===void 0&&(l=r[Cl]=new Set);var u=s+"__bubble";l.has(u)||(Bb(r,s,2,!1),l.add(u))}function lp(s,r,l){var u=0;r&&(u|=4),Bb(l,s,u,r)}var Od="_reactListening"+Math.random().toString(36).slice(2);function cp(s){if(!s[Od]){s[Od]=!0,wl.forEach(function(l){l!=="selectionchange"&&(KC.has(l)||lp(l,!1,s),lp(l,!0,s))});var r=s.nodeType===9?s:s.ownerDocument;r===null||r[Od]||(r[Od]=!0,lp("selectionchange",!1,r))}}function Bb(s,r,l,u){switch(hN(r)){case 2:var m=Ew;break;case 8:m=_w;break;default:m=_p}l=m.bind(null,r,l,s),m=void 0,!Jn||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(m=!0),u?m!==void 0?s.addEventListener(r,l,{capture:!0,passive:m}):s.addEventListener(r,l,!0):m!==void 0?s.addEventListener(r,l,{passive:m}):s.addEventListener(r,l,!1)}function up(s,r,l,u,m){var v=u;if((r&1)===0&&(r&2)===0&&u!==null)e:for(;;){if(u===null)return;var A=u.tag;if(A===3||A===4){var k=u.stateNode.containerInfo;if(k===m)break;if(A===4)for(A=u.return;A!==null;){var B=A.tag;if((B===3||B===4)&&A.stateNode.containerInfo===m)return;A=A.return}for(;k!==null;){if(A=aa(k),A===null)return;if(B=A.tag,B===5||B===6||B===26||B===27){u=v=A;continue e}k=k.parentNode}}u=u.return}Lu(function(){var W=v,ne=Zn(l),re=[];e:{var Z=_y.get(s);if(Z!==void 0){var J=to,Re=s;switch(s){case"keypress":if(ks(l)===0)break e;case"keydown":case"keyup":J=oo;break;case"focusin":Re="focus",J=ao;break;case"focusout":Re="blur",J=ao;break;case"beforeblur":case"afterblur":J=ao;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":J=es;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":J=Pf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":J=Gu;break;case xy:case by:case Ny:J=io;break;case Ey:J=Yu;break;case"scroll":case"scrollend":J=Vu;break;case"wheel":J=lo;break;case"copy":case"cut":case"paste":J=ro;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":J=Fl;break;case"toggle":case"beforetoggle":J=Ku}var Ce=(r&4)!==0,ut=!Ce&&(s==="scroll"||s==="scrollend"),Y=Ce?Z!==null?Z+"Capture":null:Z;Ce=[];for(var G=W,X;G!==null;){var ae=G;if(X=ae.stateNode,ae=ae.tag,ae!==5&&ae!==26&&ae!==27||X===null||Y===null||(ae=ar(G,Y),ae!=null&&Ce.push(vc(G,ae,X))),ut)break;G=G.return}0<Ce.length&&(Z=new J(Z,Re,null,l,ne),re.push({event:Z,listeners:Ce}))}}if((r&7)===0){e:{if(Z=s==="mouseover"||s==="pointerover",J=s==="mouseout"||s==="pointerout",Z&&l!==la&&(Re=l.relatedTarget||l.fromElement)&&(aa(Re)||Re[Xn]))break e;if((J||Z)&&(Z=ne.window===ne?ne:(Z=ne.ownerDocument)?Z.defaultView||Z.parentWindow:window,J?(Re=l.relatedTarget||l.toElement,J=W,Re=Re?aa(Re):null,Re!==null&&(ut=c(Re),Ce=Re.tag,Re!==ut||Ce!==5&&Ce!==27&&Ce!==6)&&(Re=null)):(J=null,Re=W),J!==Re)){if(Ce=es,ae="onMouseLeave",Y="onMouseEnter",G="mouse",(s==="pointerout"||s==="pointerover")&&(Ce=Fl,ae="onPointerLeave",Y="onPointerEnter",G="pointer"),ut=J==null?Z:Is(J),X=Re==null?Z:Is(Re),Z=new Ce(ae,G+"leave",J,l,ne),Z.target=ut,Z.relatedTarget=X,ae=null,aa(ne)===W&&(Ce=new Ce(Y,G+"enter",Re,l,ne),Ce.target=X,Ce.relatedTarget=ut,ae=Ce),ut=ae,J&&Re)t:{for(Ce=J,Y=Re,G=0,X=Ce;X;X=ko(X))G++;for(X=0,ae=Y;ae;ae=ko(ae))X++;for(;0<G-X;)Ce=ko(Ce),G--;for(;0<X-G;)Y=ko(Y),X--;for(;G--;){if(Ce===Y||Y!==null&&Ce===Y.alternate)break t;Ce=ko(Ce),Y=ko(Y)}Ce=null}else Ce=null;J!==null&&zb(re,Z,J,Ce,!1),Re!==null&&ut!==null&&zb(re,ut,Re,Ce,!0)}}e:{if(Z=W?Is(W):window,J=Z.nodeName&&Z.nodeName.toLowerCase(),J==="select"||J==="input"&&Z.type==="file")var xe=ly;else if(Ft(Z))if(cy)xe=lC;else{xe=rC;var ze=iC}else J=Z.nodeName,!J||J.toLowerCase()!=="input"||Z.type!=="checkbox"&&Z.type!=="radio"?W&&Ml(W.elementType)&&(xe=ly):xe=oC;if(xe&&(xe=xe(s,W))){fa(re,xe,l,ne);break e}ze&&ze(s,Z,W),s==="focusout"&&W&&Z.type==="number"&&W.memoizedProps.value!=null&&Ha(Z,"number",Z.value)}switch(ze=W?Is(W):window,s){case"focusin":(Ft(ze)||ze.contentEditable==="true")&&(co=ze,qf=W,zl=null);break;case"focusout":zl=qf=co=null;break;case"mousedown":Bf=!0;break;case"contextmenu":case"mouseup":case"dragend":Bf=!1,vy(re,l,ne);break;case"selectionchange":if(uC)break;case"keydown":case"keyup":vy(re,l,ne)}var Ne;if(Ls)e:{switch(s){case"compositionstart":var we="onCompositionStart";break e;case"compositionend":we="onCompositionEnd";break e;case"compositionupdate":we="onCompositionUpdate";break e}we=void 0}else Ke?te(s,l)&&(we="onCompositionEnd"):s==="keydown"&&l.keyCode===229&&(we="onCompositionStart");we&&(_&&l.locale!=="ko"&&(Ke||we!=="onCompositionStart"?we==="onCompositionEnd"&&Ke&&(Ne=Ol()):(Ms=ne,Ga="value"in Ms?Ms.value:Ms.textContent,Ke=!0)),ze=Pd(W,we),0<ze.length&&(we=new Vl(we,s,null,l,ne),re.push({event:we,listeners:ze}),Ne?we.data=Ne:(Ne=fe(l),Ne!==null&&(we.data=Ne)))),(Ne=x?Ut(s,l):Xe(s,l))&&(we=Pd(W,"onBeforeInput"),0<we.length&&(ze=new Vl("onBeforeInput","beforeinput",null,l,ne),re.push({event:ze,listeners:we}),ze.data=Ne)),$C(re,s,W,l,ne)}qb(re,r)})}function vc(s,r,l){return{instance:s,listener:r,currentTarget:l}}function Pd(s,r){for(var l=r+"Capture",u=[];s!==null;){var m=s,v=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||v===null||(m=ar(s,l),m!=null&&u.unshift(vc(s,m,v)),m=ar(s,r),m!=null&&u.push(vc(s,m,v))),s.tag===3)return u;s=s.return}return[]}function ko(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function zb(s,r,l,u,m){for(var v=r._reactName,A=[];l!==null&&l!==u;){var k=l,B=k.alternate,W=k.stateNode;if(k=k.tag,B!==null&&B===u)break;k!==5&&k!==26&&k!==27||W===null||(B=W,m?(W=ar(l,v),W!=null&&A.unshift(vc(l,W,B))):m||(W=ar(l,v),W!=null&&A.push(vc(l,W,B)))),l=l.return}A.length!==0&&s.push({event:r,listeners:A})}var XC=/\r\n?/g,WC=/\u0000|\uFFFD/g;function Hb(s){return(typeof s=="string"?s:""+s).replace(XC,`
`).replace(WC,"")}function Gb(s,r){return r=Hb(r),Hb(s)===r}function Ld(){}function ct(s,r,l,u,m,v){switch(l){case"children":typeof u=="string"?r==="body"||r==="textarea"&&u===""||Wn(s,u):(typeof u=="number"||typeof u=="bigint")&&r!=="body"&&Wn(s,""+u);break;case"className":Rs(s,"class",u);break;case"tabIndex":Rs(s,"tabindex",u);break;case"dir":case"role":case"viewBox":case"width":case"height":Rs(s,l,u);break;case"style":Dl(s,u,v);break;case"data":if(r!=="object"){Rs(s,"data",u);break}case"src":case"href":if(u===""&&(r!=="a"||l!=="href")){s.removeAttribute(l);break}if(u==null||typeof u=="function"||typeof u=="symbol"||typeof u=="boolean"){s.removeAttribute(l);break}u=eo(""+u),s.setAttribute(l,u);break;case"action":case"formAction":if(typeof u=="function"){s.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof v=="function"&&(l==="formAction"?(r!=="input"&&ct(s,r,"name",m.name,m,null),ct(s,r,"formEncType",m.formEncType,m,null),ct(s,r,"formMethod",m.formMethod,m,null),ct(s,r,"formTarget",m.formTarget,m,null)):(ct(s,r,"encType",m.encType,m,null),ct(s,r,"method",m.method,m,null),ct(s,r,"target",m.target,m,null)));if(u==null||typeof u=="symbol"||typeof u=="boolean"){s.removeAttribute(l);break}u=eo(""+u),s.setAttribute(l,u);break;case"onClick":u!=null&&(s.onclick=Ld);break;case"onScroll":u!=null&&$e("scroll",s);break;case"onScrollEnd":u!=null&&$e("scrollend",s);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(i(61));if(l=u.__html,l!=null){if(m.children!=null)throw Error(i(60));s.innerHTML=l}}break;case"multiple":s.multiple=u&&typeof u!="function"&&typeof u!="symbol";break;case"muted":s.muted=u&&typeof u!="function"&&typeof u!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(u==null||typeof u=="function"||typeof u=="boolean"||typeof u=="symbol"){s.removeAttribute("xlink:href");break}l=eo(""+u),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":u!=null&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,""+u):s.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":u&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,""):s.removeAttribute(l);break;case"capture":case"download":u===!0?s.setAttribute(l,""):u!==!1&&u!=null&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(l,u):s.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":u!=null&&typeof u!="function"&&typeof u!="symbol"&&!isNaN(u)&&1<=u?s.setAttribute(l,u):s.removeAttribute(l);break;case"rowSpan":case"start":u==null||typeof u=="function"||typeof u=="symbol"||isNaN(u)?s.removeAttribute(l):s.setAttribute(l,u);break;case"popover":$e("beforetoggle",s),$e("toggle",s),za(s,"popover",u);break;case"xlinkActuate":en(s,"http://www.w3.org/1999/xlink","xlink:actuate",u);break;case"xlinkArcrole":en(s,"http://www.w3.org/1999/xlink","xlink:arcrole",u);break;case"xlinkRole":en(s,"http://www.w3.org/1999/xlink","xlink:role",u);break;case"xlinkShow":en(s,"http://www.w3.org/1999/xlink","xlink:show",u);break;case"xlinkTitle":en(s,"http://www.w3.org/1999/xlink","xlink:title",u);break;case"xlinkType":en(s,"http://www.w3.org/1999/xlink","xlink:type",u);break;case"xmlBase":en(s,"http://www.w3.org/XML/1998/namespace","xml:base",u);break;case"xmlLang":en(s,"http://www.w3.org/XML/1998/namespace","xml:lang",u);break;case"xmlSpace":en(s,"http://www.w3.org/XML/1998/namespace","xml:space",u);break;case"is":za(s,"is",u);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=kf.get(l)||l,za(s,l,u))}}function dp(s,r,l,u,m,v){switch(l){case"style":Dl(s,u,v);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(i(61));if(l=u.__html,l!=null){if(m.children!=null)throw Error(i(60));s.innerHTML=l}}break;case"children":typeof u=="string"?Wn(s,u):(typeof u=="number"||typeof u=="bigint")&&Wn(s,""+u);break;case"onScroll":u!=null&&$e("scroll",s);break;case"onScrollEnd":u!=null&&$e("scrollend",s);break;case"onClick":u!=null&&(s.onclick=Ld);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Kr.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(m=l.endsWith("Capture"),r=l.slice(2,m?l.length-7:void 0),v=s[Dt]||null,v=v!=null?v[l]:null,typeof v=="function"&&s.removeEventListener(r,v,m),typeof u=="function")){typeof v!="function"&&v!==null&&(l in s?s[l]=null:s.hasAttribute(l)&&s.removeAttribute(l)),s.addEventListener(r,u,m);break e}l in s?s[l]=u:u===!0?s.setAttribute(l,""):za(s,l,u)}}}function an(s,r,l){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":$e("error",s),$e("load",s);var u=!1,m=!1,v;for(v in l)if(l.hasOwnProperty(v)){var A=l[v];if(A!=null)switch(v){case"src":u=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:ct(s,r,v,A,l,null)}}m&&ct(s,r,"srcSet",l.srcSet,l,null),u&&ct(s,r,"src",l.src,l,null);return;case"input":$e("invalid",s);var k=v=A=m=null,B=null,W=null;for(u in l)if(l.hasOwnProperty(u)){var ne=l[u];if(ne!=null)switch(u){case"name":m=ne;break;case"type":A=ne;break;case"checked":B=ne;break;case"defaultChecked":W=ne;break;case"value":v=ne;break;case"defaultValue":k=ne;break;case"children":case"dangerouslySetInnerHTML":if(ne!=null)throw Error(i(137,r));break;default:ct(s,r,u,ne,l,null)}}tr(s,v,k,B,W,A,m,!1),Jr(s);return;case"select":$e("invalid",s),u=A=v=null;for(m in l)if(l.hasOwnProperty(m)&&(k=l[m],k!=null))switch(m){case"value":v=k;break;case"defaultValue":A=k;break;case"multiple":u=k;default:ct(s,r,m,k,l,null)}r=v,l=A,s.multiple=!!u,r!=null?oa(s,!!u,r,!1):l!=null&&oa(s,!!u,l,!0);return;case"textarea":$e("invalid",s),v=m=u=null;for(A in l)if(l.hasOwnProperty(A)&&(k=l[A],k!=null))switch(A){case"value":u=k;break;case"defaultValue":m=k;break;case"children":v=k;break;case"dangerouslySetInnerHTML":if(k!=null)throw Error(i(91));break;default:ct(s,r,A,k,l,null)}nr(s,u,m,v),Jr(s);return;case"option":for(B in l)if(l.hasOwnProperty(B)&&(u=l[B],u!=null))switch(B){case"selected":s.selected=u&&typeof u!="function"&&typeof u!="symbol";break;default:ct(s,r,B,u,l,null)}return;case"dialog":$e("beforetoggle",s),$e("toggle",s),$e("cancel",s),$e("close",s);break;case"iframe":case"object":$e("load",s);break;case"video":case"audio":for(u=0;u<gc.length;u++)$e(gc[u],s);break;case"image":$e("error",s),$e("load",s);break;case"details":$e("toggle",s);break;case"embed":case"source":case"link":$e("error",s),$e("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(W in l)if(l.hasOwnProperty(W)&&(u=l[W],u!=null))switch(W){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:ct(s,r,W,u,l,null)}return;default:if(Ml(r)){for(ne in l)l.hasOwnProperty(ne)&&(u=l[ne],u!==void 0&&dp(s,r,ne,u,l,void 0));return}}for(k in l)l.hasOwnProperty(k)&&(u=l[k],u!=null&&ct(s,r,k,u,l,null))}function ZC(s,r,l,u){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,v=null,A=null,k=null,B=null,W=null,ne=null;for(J in l){var re=l[J];if(l.hasOwnProperty(J)&&re!=null)switch(J){case"checked":break;case"value":break;case"defaultValue":B=re;default:u.hasOwnProperty(J)||ct(s,r,J,null,u,re)}}for(var Z in u){var J=u[Z];if(re=l[Z],u.hasOwnProperty(Z)&&(J!=null||re!=null))switch(Z){case"type":v=J;break;case"name":m=J;break;case"checked":W=J;break;case"defaultChecked":ne=J;break;case"value":A=J;break;case"defaultValue":k=J;break;case"children":case"dangerouslySetInnerHTML":if(J!=null)throw Error(i(137,r));break;default:J!==re&&ct(s,r,Z,J,u,re)}}On(s,A,k,B,W,ne,v,m);return;case"select":J=A=k=Z=null;for(v in l)if(B=l[v],l.hasOwnProperty(v)&&B!=null)switch(v){case"value":break;case"multiple":J=B;default:u.hasOwnProperty(v)||ct(s,r,v,null,u,B)}for(m in u)if(v=u[m],B=l[m],u.hasOwnProperty(m)&&(v!=null||B!=null))switch(m){case"value":Z=v;break;case"defaultValue":k=v;break;case"multiple":A=v;default:v!==B&&ct(s,r,m,v,u,B)}r=k,l=A,u=J,Z!=null?oa(s,!!l,Z,!1):!!u!=!!l&&(r!=null?oa(s,!!l,r,!0):oa(s,!!l,l?[]:"",!1));return;case"textarea":J=Z=null;for(k in l)if(m=l[k],l.hasOwnProperty(k)&&m!=null&&!u.hasOwnProperty(k))switch(k){case"value":break;case"children":break;default:ct(s,r,k,null,u,m)}for(A in u)if(m=u[A],v=l[A],u.hasOwnProperty(A)&&(m!=null||v!=null))switch(A){case"value":Z=m;break;case"defaultValue":J=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(i(91));break;default:m!==v&&ct(s,r,A,m,u,v)}ot(s,Z,J);return;case"option":for(var Re in l)if(Z=l[Re],l.hasOwnProperty(Re)&&Z!=null&&!u.hasOwnProperty(Re))switch(Re){case"selected":s.selected=!1;break;default:ct(s,r,Re,null,u,Z)}for(B in u)if(Z=u[B],J=l[B],u.hasOwnProperty(B)&&Z!==J&&(Z!=null||J!=null))switch(B){case"selected":s.selected=Z&&typeof Z!="function"&&typeof Z!="symbol";break;default:ct(s,r,B,Z,u,J)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ce in l)Z=l[Ce],l.hasOwnProperty(Ce)&&Z!=null&&!u.hasOwnProperty(Ce)&&ct(s,r,Ce,null,u,Z);for(W in u)if(Z=u[W],J=l[W],u.hasOwnProperty(W)&&Z!==J&&(Z!=null||J!=null))switch(W){case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(i(137,r));break;default:ct(s,r,W,Z,u,J)}return;default:if(Ml(r)){for(var ut in l)Z=l[ut],l.hasOwnProperty(ut)&&Z!==void 0&&!u.hasOwnProperty(ut)&&dp(s,r,ut,void 0,u,Z);for(ne in u)Z=u[ne],J=l[ne],!u.hasOwnProperty(ne)||Z===J||Z===void 0&&J===void 0||dp(s,r,ne,Z,u,J);return}}for(var Y in l)Z=l[Y],l.hasOwnProperty(Y)&&Z!=null&&!u.hasOwnProperty(Y)&&ct(s,r,Y,null,u,Z);for(re in u)Z=u[re],J=l[re],!u.hasOwnProperty(re)||Z===J||Z==null&&J==null||ct(s,r,re,Z,u,J)}var hp=null,fp=null;function Vd(s){return s.nodeType===9?s:s.ownerDocument}function $b(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Yb(s,r){if(s===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&r==="foreignObject"?0:s}function mp(s,r){return s==="textarea"||s==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var pp=null;function JC(){var s=window.event;return s&&s.type==="popstate"?s===pp?!1:(pp=s,!0):(pp=null,!1)}var Qb=typeof setTimeout=="function"?setTimeout:void 0,ew=typeof clearTimeout=="function"?clearTimeout:void 0,Kb=typeof Promise=="function"?Promise:void 0,tw=typeof queueMicrotask=="function"?queueMicrotask:typeof Kb<"u"?function(s){return Kb.resolve(null).then(s).catch(nw)}:Qb;function nw(s){setTimeout(function(){throw s})}function oi(s){return s==="head"}function Xb(s,r){var l=r,u=0,m=0;do{var v=l.nextSibling;if(s.removeChild(l),v&&v.nodeType===8)if(l=v.data,l==="/$"){if(0<u&&8>u){l=u;var A=s.ownerDocument;if(l&1&&yc(A.documentElement),l&2&&yc(A.body),l&4)for(l=A.head,yc(l),A=l.firstChild;A;){var k=A.nextSibling,B=A.nodeName;A[Wi]||B==="SCRIPT"||B==="STYLE"||B==="LINK"&&A.rel.toLowerCase()==="stylesheet"||l.removeChild(A),A=k}}if(m===0){s.removeChild(v),Ac(r);return}m--}else l==="$"||l==="$?"||l==="$!"?m++:u=l.charCodeAt(0)-48;else u=0;l=v}while(l);Ac(r)}function gp(s){var r=s.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var l=r;switch(r=r.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":gp(l),Ba(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}s.removeChild(l)}}function sw(s,r,l,u){for(;s.nodeType===1;){var m=l;if(s.nodeName.toLowerCase()!==r.toLowerCase()){if(!u&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(u){if(!s[Wi])switch(r){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(v=s.getAttribute("rel"),v==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(v!==m.rel||s.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||s.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||s.getAttribute("title")!==(m.title==null?null:m.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(v=s.getAttribute("src"),(v!==(m.src==null?null:m.src)||s.getAttribute("type")!==(m.type==null?null:m.type)||s.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&v&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(r==="input"&&s.type==="hidden"){var v=m.name==null?null:""+m.name;if(m.type==="hidden"&&s.getAttribute("name")===v)return s}else return s;if(s=ys(s.nextSibling),s===null)break}return null}function aw(s,r,l){if(r==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!l||(s=ys(s.nextSibling),s===null))return null;return s}function vp(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState==="complete"}function iw(s,r){var l=s.ownerDocument;if(s.data!=="$?"||l.readyState==="complete")r();else{var u=function(){r(),l.removeEventListener("DOMContentLoaded",u)};l.addEventListener("DOMContentLoaded",u),s._reactRetry=u}}function ys(s){for(;s!=null;s=s.nextSibling){var r=s.nodeType;if(r===1||r===3)break;if(r===8){if(r=s.data,r==="$"||r==="$!"||r==="$?"||r==="F!"||r==="F")break;if(r==="/$")return null}}return s}var yp=null;function Wb(s){s=s.previousSibling;for(var r=0;s;){if(s.nodeType===8){var l=s.data;if(l==="$"||l==="$!"||l==="$?"){if(r===0)return s;r--}else l==="/$"&&r++}s=s.previousSibling}return null}function Zb(s,r,l){switch(r=Vd(l),s){case"html":if(s=r.documentElement,!s)throw Error(i(452));return s;case"head":if(s=r.head,!s)throw Error(i(453));return s;case"body":if(s=r.body,!s)throw Error(i(454));return s;default:throw Error(i(451))}}function yc(s){for(var r=s.attributes;r.length;)s.removeAttributeNode(r[0]);Ba(s)}var os=new Map,Jb=new Set;function Ud(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var Aa=se.d;se.d={f:rw,r:ow,D:lw,C:cw,L:uw,m:dw,X:fw,S:hw,M:mw};function rw(){var s=Aa.f(),r=Id();return s||r}function ow(s){var r=Ss(s);r!==null&&r.tag===5&&r.type==="form"?xx(r):Aa.r(s)}var Oo=typeof document>"u"?null:document;function eN(s,r,l){var u=Oo;if(u&&typeof r=="string"&&r){var m=Mt(r);m='link[rel="'+s+'"][href="'+m+'"]',typeof l=="string"&&(m+='[crossorigin="'+l+'"]'),Jb.has(m)||(Jb.add(m),s={rel:s,crossOrigin:l,href:r},u.querySelector(m)===null&&(r=u.createElement("link"),an(r,"link",s),Ct(r),u.head.appendChild(r)))}}function lw(s){Aa.D(s),eN("dns-prefetch",s,null)}function cw(s,r){Aa.C(s,r),eN("preconnect",s,r)}function uw(s,r,l){Aa.L(s,r,l);var u=Oo;if(u&&s&&r){var m='link[rel="preload"][as="'+Mt(r)+'"]';r==="image"&&l&&l.imageSrcSet?(m+='[imagesrcset="'+Mt(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(m+='[imagesizes="'+Mt(l.imageSizes)+'"]')):m+='[href="'+Mt(s)+'"]';var v=m;switch(r){case"style":v=Po(s);break;case"script":v=Lo(s)}os.has(v)||(s=y({rel:"preload",href:r==="image"&&l&&l.imageSrcSet?void 0:s,as:r},l),os.set(v,s),u.querySelector(m)!==null||r==="style"&&u.querySelector(xc(v))||r==="script"&&u.querySelector(bc(v))||(r=u.createElement("link"),an(r,"link",s),Ct(r),u.head.appendChild(r)))}}function dw(s,r){Aa.m(s,r);var l=Oo;if(l&&s){var u=r&&typeof r.as=="string"?r.as:"script",m='link[rel="modulepreload"][as="'+Mt(u)+'"][href="'+Mt(s)+'"]',v=m;switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":v=Lo(s)}if(!os.has(v)&&(s=y({rel:"modulepreload",href:s},r),os.set(v,s),l.querySelector(m)===null)){switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(bc(v)))return}u=l.createElement("link"),an(u,"link",s),Ct(u),l.head.appendChild(u)}}}function hw(s,r,l){Aa.S(s,r,l);var u=Oo;if(u&&s){var m=xn(u).hoistableStyles,v=Po(s);r=r||"default";var A=m.get(v);if(!A){var k={loading:0,preload:null};if(A=u.querySelector(xc(v)))k.loading=5;else{s=y({rel:"stylesheet",href:s,"data-precedence":r},l),(l=os.get(v))&&xp(s,l);var B=A=u.createElement("link");Ct(B),an(B,"link",s),B._p=new Promise(function(W,ne){B.onload=W,B.onerror=ne}),B.addEventListener("load",function(){k.loading|=1}),B.addEventListener("error",function(){k.loading|=2}),k.loading|=4,Fd(A,r,u)}A={type:"stylesheet",instance:A,count:1,state:k},m.set(v,A)}}}function fw(s,r){Aa.X(s,r);var l=Oo;if(l&&s){var u=xn(l).hoistableScripts,m=Lo(s),v=u.get(m);v||(v=l.querySelector(bc(m)),v||(s=y({src:s,async:!0},r),(r=os.get(m))&&bp(s,r),v=l.createElement("script"),Ct(v),an(v,"link",s),l.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},u.set(m,v))}}function mw(s,r){Aa.M(s,r);var l=Oo;if(l&&s){var u=xn(l).hoistableScripts,m=Lo(s),v=u.get(m);v||(v=l.querySelector(bc(m)),v||(s=y({src:s,async:!0,type:"module"},r),(r=os.get(m))&&bp(s,r),v=l.createElement("script"),Ct(v),an(v,"link",s),l.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},u.set(m,v))}}function tN(s,r,l,u){var m=(m=Me.current)?Ud(m):null;if(!m)throw Error(i(446));switch(s){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(r=Po(l.href),l=xn(m).hoistableStyles,u=l.get(r),u||(u={type:"style",instance:null,count:0,state:null},l.set(r,u)),u):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){s=Po(l.href);var v=xn(m).hoistableStyles,A=v.get(s);if(A||(m=m.ownerDocument||m,A={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},v.set(s,A),(v=m.querySelector(xc(s)))&&!v._p&&(A.instance=v,A.state.loading=5),os.has(s)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},os.set(s,l),v||pw(m,s,l,A.state))),r&&u===null)throw Error(i(528,""));return A}if(r&&u!==null)throw Error(i(529,""));return null;case"script":return r=l.async,l=l.src,typeof l=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=Lo(l),l=xn(m).hoistableScripts,u=l.get(r),u||(u={type:"script",instance:null,count:0,state:null},l.set(r,u)),u):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,s))}}function Po(s){return'href="'+Mt(s)+'"'}function xc(s){return'link[rel="stylesheet"]['+s+"]"}function nN(s){return y({},s,{"data-precedence":s.precedence,precedence:null})}function pw(s,r,l,u){s.querySelector('link[rel="preload"][as="style"]['+r+"]")?u.loading=1:(r=s.createElement("link"),u.preload=r,r.addEventListener("load",function(){return u.loading|=1}),r.addEventListener("error",function(){return u.loading|=2}),an(r,"link",l),Ct(r),s.head.appendChild(r))}function Lo(s){return'[src="'+Mt(s)+'"]'}function bc(s){return"script[async]"+s}function sN(s,r,l){if(r.count++,r.instance===null)switch(r.type){case"style":var u=s.querySelector('style[data-href~="'+Mt(l.href)+'"]');if(u)return r.instance=u,Ct(u),u;var m=y({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return u=(s.ownerDocument||s).createElement("style"),Ct(u),an(u,"style",m),Fd(u,l.precedence,s),r.instance=u;case"stylesheet":m=Po(l.href);var v=s.querySelector(xc(m));if(v)return r.state.loading|=4,r.instance=v,Ct(v),v;u=nN(l),(m=os.get(m))&&xp(u,m),v=(s.ownerDocument||s).createElement("link"),Ct(v);var A=v;return A._p=new Promise(function(k,B){A.onload=k,A.onerror=B}),an(v,"link",u),r.state.loading|=4,Fd(v,l.precedence,s),r.instance=v;case"script":return v=Lo(l.src),(m=s.querySelector(bc(v)))?(r.instance=m,Ct(m),m):(u=l,(m=os.get(v))&&(u=y({},l),bp(u,m)),s=s.ownerDocument||s,m=s.createElement("script"),Ct(m),an(m,"link",u),s.head.appendChild(m),r.instance=m);case"void":return null;default:throw Error(i(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(u=r.instance,r.state.loading|=4,Fd(u,l.precedence,s));return r.instance}function Fd(s,r,l){for(var u=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=u.length?u[u.length-1]:null,v=m,A=0;A<u.length;A++){var k=u[A];if(k.dataset.precedence===r)v=k;else if(v!==m)break}v?v.parentNode.insertBefore(s,v.nextSibling):(r=l.nodeType===9?l.head:l,r.insertBefore(s,r.firstChild))}function xp(s,r){s.crossOrigin==null&&(s.crossOrigin=r.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=r.referrerPolicy),s.title==null&&(s.title=r.title)}function bp(s,r){s.crossOrigin==null&&(s.crossOrigin=r.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=r.referrerPolicy),s.integrity==null&&(s.integrity=r.integrity)}var qd=null;function aN(s,r,l){if(qd===null){var u=new Map,m=qd=new Map;m.set(l,u)}else m=qd,u=m.get(l),u||(u=new Map,m.set(l,u));if(u.has(s))return u;for(u.set(s,null),l=l.getElementsByTagName(s),m=0;m<l.length;m++){var v=l[m];if(!(v[Wi]||v[Vt]||s==="link"&&v.getAttribute("rel")==="stylesheet")&&v.namespaceURI!=="http://www.w3.org/2000/svg"){var A=v.getAttribute(r)||"";A=s+A;var k=u.get(A);k?k.push(v):u.set(A,[v])}}return u}function iN(s,r,l){s=s.ownerDocument||s,s.head.insertBefore(l,r==="title"?s.querySelector("head > title"):null)}function gw(s,r,l){if(l===1||r.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;switch(r.rel){case"stylesheet":return s=r.disabled,typeof r.precedence=="string"&&s==null;default:return!0}case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function rN(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}var Nc=null;function vw(){}function yw(s,r,l){if(Nc===null)throw Error(i(475));var u=Nc;if(r.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&(r.state.loading&4)===0){if(r.instance===null){var m=Po(l.href),v=s.querySelector(xc(m));if(v){s=v._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(u.count++,u=Bd.bind(u),s.then(u,u)),r.state.loading|=4,r.instance=v,Ct(v);return}v=s.ownerDocument||s,l=nN(l),(m=os.get(m))&&xp(l,m),v=v.createElement("link"),Ct(v);var A=v;A._p=new Promise(function(k,B){A.onload=k,A.onerror=B}),an(v,"link",l),r.instance=v}u.stylesheets===null&&(u.stylesheets=new Map),u.stylesheets.set(r,s),(s=r.state.preload)&&(r.state.loading&3)===0&&(u.count++,r=Bd.bind(u),s.addEventListener("load",r),s.addEventListener("error",r))}}function xw(){if(Nc===null)throw Error(i(475));var s=Nc;return s.stylesheets&&s.count===0&&Np(s,s.stylesheets),0<s.count?function(r){var l=setTimeout(function(){if(s.stylesheets&&Np(s,s.stylesheets),s.unsuspend){var u=s.unsuspend;s.unsuspend=null,u()}},6e4);return s.unsuspend=r,function(){s.unsuspend=null,clearTimeout(l)}}:null}function Bd(){if(this.count--,this.count===0){if(this.stylesheets)Np(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var zd=null;function Np(s,r){s.stylesheets=null,s.unsuspend!==null&&(s.count++,zd=new Map,r.forEach(bw,s),zd=null,Bd.call(s))}function bw(s,r){if(!(r.state.loading&4)){var l=zd.get(s);if(l)var u=l.get(null);else{l=new Map,zd.set(s,l);for(var m=s.querySelectorAll("link[data-precedence],style[data-precedence]"),v=0;v<m.length;v++){var A=m[v];(A.nodeName==="LINK"||A.getAttribute("media")!=="not all")&&(l.set(A.dataset.precedence,A),u=A)}u&&l.set(null,u)}m=r.instance,A=m.getAttribute("data-precedence"),v=l.get(A)||u,v===u&&l.set(null,m),l.set(A,m),this.count++,u=Bd.bind(this),m.addEventListener("load",u),m.addEventListener("error",u),v?v.parentNode.insertBefore(m,v.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(m,s.firstChild)),r.state.loading|=4}}var Ec={$$typeof:I,Provider:null,Consumer:null,_currentValue:me,_currentValue2:me,_threadCount:0};function Nw(s,r,l,u,m,v,A,k){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=na(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=na(0),this.hiddenUpdates=na(null),this.identifierPrefix=u,this.onUncaughtError=m,this.onCaughtError=v,this.onRecoverableError=A,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=k,this.incompleteTransitions=new Map}function oN(s,r,l,u,m,v,A,k,B,W,ne,re){return s=new Nw(s,r,l,A,k,B,W,re),r=1,v===!0&&(r|=24),v=Ln(3,null,null,r),s.current=v,v.stateNode=s,r=nm(),r.refCount++,s.pooledCache=r,r.refCount++,v.memoizedState={element:u,isDehydrated:l,cache:r},rm(v),s}function lN(s){return s?(s=mo,s):mo}function cN(s,r,l,u,m,v){m=lN(m),u.context===null?u.context=m:u.pendingContext=m,u=Qa(r),u.payload={element:l},v=v===void 0?null:v,v!==null&&(u.callback=v),l=Ka(s,u,r),l!==null&&(Bn(l,s,r),Zl(l,s,r))}function uN(s,r){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var l=s.retryLane;s.retryLane=l!==0&&l<r?l:r}}function Ep(s,r){uN(s,r),(s=s.alternate)&&uN(s,r)}function dN(s){if(s.tag===13){var r=fo(s,67108864);r!==null&&Bn(r,s,67108864),Ep(s,67108864)}}var Hd=!0;function Ew(s,r,l,u){var m=Q.T;Q.T=null;var v=se.p;try{se.p=2,_p(s,r,l,u)}finally{se.p=v,Q.T=m}}function _w(s,r,l,u){var m=Q.T;Q.T=null;var v=se.p;try{se.p=8,_p(s,r,l,u)}finally{se.p=v,Q.T=m}}function _p(s,r,l,u){if(Hd){var m=Tp(u);if(m===null)up(s,r,u,Gd,l),fN(s,u);else if(jw(m,s,r,l,u))u.stopPropagation();else if(fN(s,u),r&4&&-1<Tw.indexOf(s)){for(;m!==null;){var v=Ss(m);if(v!==null)switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var A=fs(v.pendingLanes);if(A!==0){var k=v;for(k.pendingLanes|=2,k.entangledLanes|=2;A;){var B=1<<31-dn(A);k.entanglements[1]|=B,A&=~B}zs(v),(it&6)===0&&(wd=Kn()+500,pc(0))}}break;case 13:k=fo(v,2),k!==null&&Bn(k,v,2),Id(),Ep(v,2)}if(v=Tp(u),v===null&&up(s,r,u,Gd,l),v===m)break;m=v}m!==null&&u.stopPropagation()}else up(s,r,u,null,l)}}function Tp(s){return s=Zn(s),jp(s)}var Gd=null;function jp(s){if(Gd=null,s=aa(s),s!==null){var r=c(s);if(r===null)s=null;else{var l=r.tag;if(l===13){if(s=d(r),s!==null)return s;s=null}else if(l===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;s=null}else r!==s&&(s=null)}}return Gd=s,null}function hN(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(wf()){case bl:return 2;case Gr:return 8;case $i:case Sf:return 32;case $r:return 268435456;default:return 32}default:return 32}}var Ap=!1,li=null,ci=null,ui=null,_c=new Map,Tc=new Map,di=[],Tw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function fN(s,r){switch(s){case"focusin":case"focusout":li=null;break;case"dragenter":case"dragleave":ci=null;break;case"mouseover":case"mouseout":ui=null;break;case"pointerover":case"pointerout":_c.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Tc.delete(r.pointerId)}}function jc(s,r,l,u,m,v){return s===null||s.nativeEvent!==v?(s={blockedOn:r,domEventName:l,eventSystemFlags:u,nativeEvent:v,targetContainers:[m]},r!==null&&(r=Ss(r),r!==null&&dN(r)),s):(s.eventSystemFlags|=u,r=s.targetContainers,m!==null&&r.indexOf(m)===-1&&r.push(m),s)}function jw(s,r,l,u,m){switch(r){case"focusin":return li=jc(li,s,r,l,u,m),!0;case"dragenter":return ci=jc(ci,s,r,l,u,m),!0;case"mouseover":return ui=jc(ui,s,r,l,u,m),!0;case"pointerover":var v=m.pointerId;return _c.set(v,jc(_c.get(v)||null,s,r,l,u,m)),!0;case"gotpointercapture":return v=m.pointerId,Tc.set(v,jc(Tc.get(v)||null,s,r,l,u,m)),!0}return!1}function mN(s){var r=aa(s.target);if(r!==null){var l=c(r);if(l!==null){if(r=l.tag,r===13){if(r=d(l),r!==null){s.blockedOn=r,Iu(s.priority,function(){if(l.tag===13){var u=qn();u=Ua(u);var m=fo(l,u);m!==null&&Bn(m,l,u),Ep(l,u)}});return}}else if(r===3&&l.stateNode.current.memoizedState.isDehydrated){s.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}s.blockedOn=null}function $d(s){if(s.blockedOn!==null)return!1;for(var r=s.targetContainers;0<r.length;){var l=Tp(s.nativeEvent);if(l===null){l=s.nativeEvent;var u=new l.constructor(l.type,l);la=u,l.target.dispatchEvent(u),la=null}else return r=Ss(l),r!==null&&dN(r),s.blockedOn=l,!1;r.shift()}return!0}function pN(s,r,l){$d(s)&&l.delete(r)}function Aw(){Ap=!1,li!==null&&$d(li)&&(li=null),ci!==null&&$d(ci)&&(ci=null),ui!==null&&$d(ui)&&(ui=null),_c.forEach(pN),Tc.forEach(pN)}function Yd(s,r){s.blockedOn===r&&(s.blockedOn=null,Ap||(Ap=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,Aw)))}var Qd=null;function gN(s){Qd!==s&&(Qd=s,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Qd===s&&(Qd=null);for(var r=0;r<s.length;r+=3){var l=s[r],u=s[r+1],m=s[r+2];if(typeof u!="function"){if(jp(u||l)===null)continue;break}var v=Ss(l);v!==null&&(s.splice(r,3),r-=3,jm(v,{pending:!0,data:m,method:l.method,action:u},u,m))}}))}function Ac(s){function r(B){return Yd(B,s)}li!==null&&Yd(li,s),ci!==null&&Yd(ci,s),ui!==null&&Yd(ui,s),_c.forEach(r),Tc.forEach(r);for(var l=0;l<di.length;l++){var u=di[l];u.blockedOn===s&&(u.blockedOn=null)}for(;0<di.length&&(l=di[0],l.blockedOn===null);)mN(l),l.blockedOn===null&&di.shift();if(l=(s.ownerDocument||s).$$reactFormReplay,l!=null)for(u=0;u<l.length;u+=3){var m=l[u],v=l[u+1],A=m[Dt]||null;if(typeof v=="function")A||gN(l);else if(A){var k=null;if(v&&v.hasAttribute("formAction")){if(m=v,A=v[Dt]||null)k=A.formAction;else if(jp(m)!==null)continue}else k=A.action;typeof k=="function"?l[u+1]=k:(l.splice(u,3),u-=3),gN(l)}}}function Cp(s){this._internalRoot=s}Kd.prototype.render=Cp.prototype.render=function(s){var r=this._internalRoot;if(r===null)throw Error(i(409));var l=r.current,u=qn();cN(l,u,s,r,null,null)},Kd.prototype.unmount=Cp.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var r=s.containerInfo;cN(s.current,2,null,s,null,null),Id(),r[Xn]=null}};function Kd(s){this._internalRoot=s}Kd.prototype.unstable_scheduleHydration=function(s){if(s){var r=Fa();s={blockedOn:null,target:s,priority:r};for(var l=0;l<di.length&&r!==0&&r<di[l].priority;l++);di.splice(l,0,s),l===0&&mN(s)}};var vN=e.version;if(vN!=="19.1.0")throw Error(i(527,vN,"19.1.0"));se.findDOMNode=function(s){var r=s._reactInternals;if(r===void 0)throw typeof s.render=="function"?Error(i(188)):(s=Object.keys(s).join(","),Error(i(268,s)));return s=p(r),s=s!==null?g(s):null,s=s===null?null:s.stateNode,s};var Cw={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:Q,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Xd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Xd.isDisabled&&Xd.supportsFiber)try{Tt=Xd.inject(Cw),at=Xd}catch{}}return wc.createRoot=function(s,r){if(!o(s))throw Error(i(299));var l=!1,u="",m=Mx,v=kx,A=Ox,k=null;return r!=null&&(r.unstable_strictMode===!0&&(l=!0),r.identifierPrefix!==void 0&&(u=r.identifierPrefix),r.onUncaughtError!==void 0&&(m=r.onUncaughtError),r.onCaughtError!==void 0&&(v=r.onCaughtError),r.onRecoverableError!==void 0&&(A=r.onRecoverableError),r.unstable_transitionCallbacks!==void 0&&(k=r.unstable_transitionCallbacks)),r=oN(s,1,!1,null,null,l,u,m,v,A,k,null),s[Xn]=r.current,cp(s),new Cp(r)},wc.hydrateRoot=function(s,r,l){if(!o(s))throw Error(i(299));var u=!1,m="",v=Mx,A=kx,k=Ox,B=null,W=null;return l!=null&&(l.unstable_strictMode===!0&&(u=!0),l.identifierPrefix!==void 0&&(m=l.identifierPrefix),l.onUncaughtError!==void 0&&(v=l.onUncaughtError),l.onCaughtError!==void 0&&(A=l.onCaughtError),l.onRecoverableError!==void 0&&(k=l.onRecoverableError),l.unstable_transitionCallbacks!==void 0&&(B=l.unstable_transitionCallbacks),l.formState!==void 0&&(W=l.formState)),r=oN(s,1,!0,r,l??null,u,m,v,A,k,B,W),r.context=lN(null),l=r.current,u=qn(),u=Ua(u),m=Qa(u),m.callback=null,Ka(l,m,u),l=u,r.current.lanes=l,sa(r,l),zs(r),s[Xn]=r.current,cp(s),new Kd(r)},wc.version="19.1.0",wc}var CN;function Lw(){if(CN)return Ip.exports;CN=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Ip.exports=Pw(),Ip.exports}var Vw=Lw();const Uw=()=>{};var wN={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X_=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let o=n.charCodeAt(i);o<128?e[t++]=o:o<2048?(e[t++]=o>>6|192,e[t++]=o&63|128):(o&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(o=65536+((o&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=o>>18|240,e[t++]=o>>12&63|128,e[t++]=o>>6&63|128,e[t++]=o&63|128):(e[t++]=o>>12|224,e[t++]=o>>6&63|128,e[t++]=o&63|128)}return e},Fw=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const o=n[t++];if(o<128)e[i++]=String.fromCharCode(o);else if(o>191&&o<224){const c=n[t++];e[i++]=String.fromCharCode((o&31)<<6|c&63)}else if(o>239&&o<365){const c=n[t++],d=n[t++],f=n[t++],p=((o&7)<<18|(c&63)<<12|(d&63)<<6|f&63)-65536;e[i++]=String.fromCharCode(55296+(p>>10)),e[i++]=String.fromCharCode(56320+(p&1023))}else{const c=n[t++],d=n[t++];e[i++]=String.fromCharCode((o&15)<<12|(c&63)<<6|d&63)}}return e.join("")},W_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let o=0;o<n.length;o+=3){const c=n[o],d=o+1<n.length,f=d?n[o+1]:0,p=o+2<n.length,g=p?n[o+2]:0,y=c>>2,b=(c&3)<<4|f>>4;let E=(f&15)<<2|g>>6,j=g&63;p||(j=64,d||(E=64)),i.push(t[y],t[b],t[E],t[j])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(X_(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Fw(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let o=0;o<n.length;){const c=t[n.charAt(o++)],f=o<n.length?t[n.charAt(o)]:0;++o;const g=o<n.length?t[n.charAt(o)]:64;++o;const b=o<n.length?t[n.charAt(o)]:64;if(++o,c==null||f==null||g==null||b==null)throw new qw;const E=c<<2|f>>4;if(i.push(E),g!==64){const j=f<<4&240|g>>2;if(i.push(j),b!==64){const N=g<<6&192|b;i.push(N)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class qw extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Bw=function(n){const e=X_(n);return W_.encodeByteArray(e,!0)},xh=function(n){return Bw(n).replace(/\./g,"")},Z_=function(n){try{return W_.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zw(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hw=()=>zw().__FIREBASE_DEFAULTS__,Gw=()=>{if(typeof process>"u"||typeof wN>"u")return;const n=wN.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},$w=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Z_(n[1]);return e&&JSON.parse(e)},$h=()=>{try{return Uw()||Hw()||Gw()||$w()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},J_=n=>{var e,t;return(t=(e=$h())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},eT=n=>{const e=J_(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},tT=()=>{var n;return(n=$h())===null||n===void 0?void 0:n.config},nT=n=>{var e;return(e=$h())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yw{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ur(n){return n.endsWith(".cloudworkstations.dev")}async function kg(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sT(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",o=n.iat||0,c=n.sub||n.user_id;if(!c)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const d=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:o,exp:o+3600,auth_time:o,sub:c,user_id:c,firebase:{sign_in_provider:"custom",identities:{}}},n);return[xh(JSON.stringify(t)),xh(JSON.stringify(d)),""].join(".")}const Oc={};function Qw(){const n={prod:[],emulator:[]};for(const e of Object.keys(Oc))Oc[e]?n.emulator.push(e):n.prod.push(e);return n}function Kw(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let SN=!1;function Og(n,e){if(typeof window>"u"||typeof document>"u"||!Ur(window.location.host)||Oc[n]===e||Oc[n]||SN)return;Oc[n]=e;function t(E){return`__firebase__banner__${E}`}const i="__firebase__banner",c=Qw().prod.length>0;function d(){const E=document.getElementById(i);E&&E.remove()}function f(E){E.style.display="flex",E.style.background="#7faaf0",E.style.position="fixed",E.style.bottom="5px",E.style.left="5px",E.style.padding=".5em",E.style.borderRadius="5px",E.style.alignItems="center"}function p(E,j){E.setAttribute("width","24"),E.setAttribute("id",j),E.setAttribute("height","24"),E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","none"),E.style.marginLeft="-6px"}function g(){const E=document.createElement("span");return E.style.cursor="pointer",E.style.marginLeft="16px",E.style.fontSize="24px",E.innerHTML=" &times;",E.onclick=()=>{SN=!0,d()},E}function y(E,j){E.setAttribute("id",j),E.innerText="Learn more",E.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",E.setAttribute("target","__blank"),E.style.paddingLeft="5px",E.style.textDecoration="underline"}function b(){const E=Kw(i),j=t("text"),N=document.getElementById(j)||document.createElement("span"),w=t("learnmore"),T=document.getElementById(w)||document.createElement("a"),S=t("preprendIcon"),q=document.getElementById(S)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(E.created){const I=E.element;f(I),y(T,w);const O=g();p(q,S),I.append(q,N,T,O),document.body.appendChild(I)}c?(N.innerText="Preview backend disconnected.",q.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(q.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,N.innerText="Preview backend running in this workspace."),N.setAttribute("id",j)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",b):b()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Xw(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(yn())}function Ww(){var n;const e=(n=$h())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Zw(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Pg(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Jw(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function eS(){const n=yn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function tS(){return!Ww()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Yh(){try{return typeof indexedDB=="object"}catch{return!1}}function Qh(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",o=self.indexedDB.open(i);o.onsuccess=()=>{o.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},o.onupgradeneeded=()=>{t=!1},o.onerror=()=>{var c;e(((c=o.error)===null||c===void 0?void 0:c.message)||"")}}catch(t){e(t)}})}function Lg(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nS="FirebaseError";class hs extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=nS,Object.setPrototypeOf(this,hs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Pi.prototype.create)}}class Pi{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},o=`${this.service}/${e}`,c=this.errors[e],d=c?sS(c,i):"Error",f=`${this.serviceName}: ${d} (${o}).`;return new hs(o,f,i)}}function sS(n,e){return n.replace(aS,(t,i)=>{const o=e[i];return o!=null?String(o):`<${i}?>`})}const aS=/\{\$([^}]+)}/g;function iS(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ai(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const o of t){if(!i.includes(o))return!1;const c=n[o],d=e[o];if(IN(c)&&IN(d)){if(!Ai(c,d))return!1}else if(c!==d)return!1}for(const o of i)if(!t.includes(o))return!1;return!0}function IN(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ou(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(o=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(o))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function Sc(n){const e={};return n.replace(/^\?/,"").split("&").forEach(i=>{if(i){const[o,c]=i.split("=");e[decodeURIComponent(o)]=decodeURIComponent(c)}}),e}function Ic(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function rS(n,e){const t=new oS(n,e);return t.subscribe.bind(t)}class oS{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let o;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");lS(e,["next","error","complete"])?o=e:o={next:e,error:t,complete:i},o.next===void 0&&(o.next=kp),o.error===void 0&&(o.error=kp),o.complete===void 0&&(o.complete=kp);const c=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?o.error(this.finalError):o.complete()}catch{}}),this.observers.push(o),c}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function lS(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function kp(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cS=1e3,uS=2,dS=4*60*60*1e3,hS=.5;function RN(n,e=cS,t=uS){const i=e*Math.pow(t,n),o=Math.round(hS*i*(Math.random()-.5)*2);return Math.min(dS,i+o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yt(n){return n&&n._delegate?n._delegate:n}class Yn{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cr="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fS{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new Yw;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const o=this.getOrInitializeService({instanceIdentifier:t});o&&i.resolve(o)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e?.identifier),o=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(c){if(o)return null;throw c}else{if(o)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(pS(e))try{this.getOrInitializeService({instanceIdentifier:Cr})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(t);try{const c=this.getOrInitializeService({instanceIdentifier:o});i.resolve(c)}catch{}}}}clearInstance(e=Cr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Cr){return this.instances.has(e)}getOptions(e=Cr){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const o=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[c,d]of this.instancesDeferred.entries()){const f=this.normalizeInstanceIdentifier(c);i===f&&d.resolve(o)}return o}onInit(e,t){var i;const o=this.normalizeInstanceIdentifier(t),c=(i=this.onInitCallbacks.get(o))!==null&&i!==void 0?i:new Set;c.add(e),this.onInitCallbacks.set(o,c);const d=this.instances.get(o);return d&&e(d,o),()=>{c.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const o of i)try{o(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:mS(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Cr){return this.component?this.component.multipleInstances?e:Cr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function mS(n){return n===Cr?void 0:n}function pS(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gS{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new fS(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ye;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Ye||(Ye={}));const vS={debug:Ye.DEBUG,verbose:Ye.VERBOSE,info:Ye.INFO,warn:Ye.WARN,error:Ye.ERROR,silent:Ye.SILENT},yS=Ye.INFO,xS={[Ye.DEBUG]:"log",[Ye.VERBOSE]:"log",[Ye.INFO]:"info",[Ye.WARN]:"warn",[Ye.ERROR]:"error"},bS=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),o=xS[e];if(o)console[o](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class lu{constructor(e){this.name=e,this._logLevel=yS,this._logHandler=bS,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ye))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?vS[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ye.DEBUG,...e),this._logHandler(this,Ye.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ye.VERBOSE,...e),this._logHandler(this,Ye.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ye.INFO,...e),this._logHandler(this,Ye.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ye.WARN,...e),this._logHandler(this,Ye.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ye.ERROR,...e),this._logHandler(this,Ye.ERROR,...e)}}const NS=(n,e)=>e.some(t=>n instanceof t);let DN,MN;function ES(){return DN||(DN=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function _S(){return MN||(MN=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const aT=new WeakMap,ng=new WeakMap,iT=new WeakMap,Op=new WeakMap,Vg=new WeakMap;function TS(n){const e=new Promise((t,i)=>{const o=()=>{n.removeEventListener("success",c),n.removeEventListener("error",d)},c=()=>{t(bi(n.result)),o()},d=()=>{i(n.error),o()};n.addEventListener("success",c),n.addEventListener("error",d)});return e.then(t=>{t instanceof IDBCursor&&aT.set(t,n)}).catch(()=>{}),Vg.set(e,n),e}function jS(n){if(ng.has(n))return;const e=new Promise((t,i)=>{const o=()=>{n.removeEventListener("complete",c),n.removeEventListener("error",d),n.removeEventListener("abort",d)},c=()=>{t(),o()},d=()=>{i(n.error||new DOMException("AbortError","AbortError")),o()};n.addEventListener("complete",c),n.addEventListener("error",d),n.addEventListener("abort",d)});ng.set(n,e)}let sg={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ng.get(n);if(e==="objectStoreNames")return n.objectStoreNames||iT.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return bi(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function AS(n){sg=n(sg)}function CS(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(Pp(this),e,...t);return iT.set(i,e.sort?e.sort():[e]),bi(i)}:_S().includes(n)?function(...e){return n.apply(Pp(this),e),bi(aT.get(this))}:function(...e){return bi(n.apply(Pp(this),e))}}function wS(n){return typeof n=="function"?CS(n):(n instanceof IDBTransaction&&jS(n),NS(n,ES())?new Proxy(n,sg):n)}function bi(n){if(n instanceof IDBRequest)return TS(n);if(Op.has(n))return Op.get(n);const e=wS(n);return e!==n&&(Op.set(n,e),Vg.set(e,n)),e}const Pp=n=>Vg.get(n);function rT(n,e,{blocked:t,upgrade:i,blocking:o,terminated:c}={}){const d=indexedDB.open(n,e),f=bi(d);return i&&d.addEventListener("upgradeneeded",p=>{i(bi(d.result),p.oldVersion,p.newVersion,bi(d.transaction),p)}),t&&d.addEventListener("blocked",p=>t(p.oldVersion,p.newVersion,p)),f.then(p=>{c&&p.addEventListener("close",()=>c()),o&&p.addEventListener("versionchange",g=>o(g.oldVersion,g.newVersion,g))}).catch(()=>{}),f}const SS=["get","getKey","getAll","getAllKeys","count"],IS=["put","add","delete","clear"],Lp=new Map;function kN(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Lp.get(e))return Lp.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,o=IS.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(o||SS.includes(t)))return;const c=async function(d,...f){const p=this.transaction(d,o?"readwrite":"readonly");let g=p.store;return i&&(g=g.index(f.shift())),(await Promise.all([g[t](...f),o&&p.done]))[0]};return Lp.set(e,c),c}AS(n=>({...n,get:(e,t,i)=>kN(e,t)||n.get(e,t,i),has:(e,t)=>!!kN(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RS{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(DS(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function DS(n){const e=n.getComponent();return e?.type==="VERSION"}const ag="@firebase/app",ON="0.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Da=new lu("@firebase/app"),MS="@firebase/app-compat",kS="@firebase/analytics-compat",OS="@firebase/analytics",PS="@firebase/app-check-compat",LS="@firebase/app-check",VS="@firebase/auth",US="@firebase/auth-compat",FS="@firebase/database",qS="@firebase/data-connect",BS="@firebase/database-compat",zS="@firebase/functions",HS="@firebase/functions-compat",GS="@firebase/installations",$S="@firebase/installations-compat",YS="@firebase/messaging",QS="@firebase/messaging-compat",KS="@firebase/performance",XS="@firebase/performance-compat",WS="@firebase/remote-config",ZS="@firebase/remote-config-compat",JS="@firebase/storage",eI="@firebase/storage-compat",tI="@firebase/firestore",nI="@firebase/ai",sI="@firebase/firestore-compat",aI="firebase",iI="11.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ig="[DEFAULT]",rI={[ag]:"fire-core",[MS]:"fire-core-compat",[OS]:"fire-analytics",[kS]:"fire-analytics-compat",[LS]:"fire-app-check",[PS]:"fire-app-check-compat",[VS]:"fire-auth",[US]:"fire-auth-compat",[FS]:"fire-rtdb",[qS]:"fire-data-connect",[BS]:"fire-rtdb-compat",[zS]:"fire-fn",[HS]:"fire-fn-compat",[GS]:"fire-iid",[$S]:"fire-iid-compat",[YS]:"fire-fcm",[QS]:"fire-fcm-compat",[KS]:"fire-perf",[XS]:"fire-perf-compat",[WS]:"fire-rc",[ZS]:"fire-rc-compat",[JS]:"fire-gcs",[eI]:"fire-gcs-compat",[tI]:"fire-fst",[sI]:"fire-fst-compat",[nI]:"fire-vertex","fire-js":"fire-js",[aI]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bh=new Map,oI=new Map,rg=new Map;function PN(n,e){try{n.container.addComponent(e)}catch(t){Da.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function us(n){const e=n.name;if(rg.has(e))return Da.debug(`There were multiple attempts to register component ${e}.`),!1;rg.set(e,n);for(const t of bh.values())PN(t,n);for(const t of oI.values())PN(t,n);return!0}function Pa(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Dn(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ni=new Pi("app","Firebase",lI);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cI{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Yn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ni.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fr=iI;function oT(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i=Object.assign({name:ig,automaticDataCollectionEnabled:!0},e),o=i.name;if(typeof o!="string"||!o)throw Ni.create("bad-app-name",{appName:String(o)});if(t||(t=tT()),!t)throw Ni.create("no-options");const c=bh.get(o);if(c){if(Ai(t,c.options)&&Ai(i,c.config))return c;throw Ni.create("duplicate-app",{appName:o})}const d=new gS(o);for(const p of rg.values())d.addComponent(p);const f=new cI(t,i,d);return bh.set(o,f),f}function cu(n=ig){const e=bh.get(n);if(!e&&n===ig&&tT())return oT();if(!e)throw Ni.create("no-app",{appName:n});return e}function vn(n,e,t){var i;let o=(i=rI[n])!==null&&i!==void 0?i:n;t&&(o+=`-${t}`);const c=o.match(/\s|\//),d=e.match(/\s|\//);if(c||d){const f=[`Unable to register library "${o}" with version "${e}":`];c&&f.push(`library name "${o}" contains illegal characters (whitespace or "/")`),c&&d&&f.push("and"),d&&f.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Da.warn(f.join(" "));return}us(new Yn(`${o}-version`,()=>({library:o,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uI="firebase-heartbeat-database",dI=1,Yc="firebase-heartbeat-store";let Vp=null;function lT(){return Vp||(Vp=rT(uI,dI,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Yc)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ni.create("idb-open",{originalErrorMessage:n.message})})),Vp}async function hI(n){try{const t=(await lT()).transaction(Yc),i=await t.objectStore(Yc).get(cT(n));return await t.done,i}catch(e){if(e instanceof hs)Da.warn(e.message);else{const t=Ni.create("idb-get",{originalErrorMessage:e?.message});Da.warn(t.message)}}}async function LN(n,e){try{const i=(await lT()).transaction(Yc,"readwrite");await i.objectStore(Yc).put(e,cT(n)),await i.done}catch(t){if(t instanceof hs)Da.warn(t.message);else{const i=Ni.create("idb-set",{originalErrorMessage:t?.message});Da.warn(i.message)}}}function cT(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fI=1024,mI=30;class pI{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new vI(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const o=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),c=VN();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===c||this._heartbeatsCache.heartbeats.some(d=>d.date===c))return;if(this._heartbeatsCache.heartbeats.push({date:c,agent:o}),this._heartbeatsCache.heartbeats.length>mI){const d=yI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(d,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){Da.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=VN(),{heartbeatsToSend:i,unsentEntries:o}=gI(this._heartbeatsCache.heartbeats),c=xh(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,o.length>0?(this._heartbeatsCache.heartbeats=o,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),c}catch(t){return Da.warn(t),""}}}function VN(){return new Date().toISOString().substring(0,10)}function gI(n,e=fI){const t=[];let i=n.slice();for(const o of n){const c=t.find(d=>d.agent===o.agent);if(c){if(c.dates.push(o.date),UN(t)>e){c.dates.pop();break}}else if(t.push({agent:o.agent,dates:[o.date]}),UN(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class vI{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Yh()?Qh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await hI(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const o=await this.read();return LN(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:o.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const o=await this.read();return LN(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:o.lastSentHeartbeatDate,heartbeats:[...o.heartbeats,...e.heartbeats]})}else return}}function UN(n){return xh(JSON.stringify({version:2,heartbeats:n})).length}function yI(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xI(n){us(new Yn("platform-logger",e=>new RS(e),"PRIVATE")),us(new Yn("heartbeat",e=>new pI(e),"PRIVATE")),vn(ag,ON,n),vn(ag,ON,"esm2017"),vn("fire-js","")}xI("");function Ug(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,i=Object.getOwnPropertySymbols(n);o<i.length;o++)e.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(n,i[o])&&(t[i[o]]=n[i[o]]);return t}function uT(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const bI=uT,dT=new Pi("auth","Firebase",uT());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nh=new lu("@firebase/auth");function NI(n,...e){Nh.logLevel<=Ye.WARN&&Nh.warn(`Auth (${Fr}): ${n}`,...e)}function rh(n,...e){Nh.logLevel<=Ye.ERROR&&Nh.error(`Auth (${Fr}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ds(n,...e){throw qg(n,...e)}function Ts(n,...e){return qg(n,...e)}function Fg(n,e,t){const i=Object.assign(Object.assign({},bI()),{[e]:t});return new Pi("auth","Firebase",i).create(e,{appName:n.name})}function Ra(n){return Fg(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function EI(n,e,t){const i=t;if(!(e instanceof i))throw i.name!==e.constructor.name&&ds(n,"argument-error"),Fg(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function qg(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return dT.create(n,...e)}function Ie(n,e,...t){if(!n)throw qg(e,...t)}function Sa(n){const e="INTERNAL ASSERTION FAILED: "+n;throw rh(e),new Error(e)}function Ma(n,e){n||Sa(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function og(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function _I(){return FN()==="http:"||FN()==="https:"}function FN(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(_I()||Pg()||"connection"in navigator)?navigator.onLine:!0}function jI(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uu{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ma(t>e,"Short delay should be less than long delay!"),this.isMobile=Xw()||Jw()}get(){return TI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bg(n,e){Ma(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hT{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Sa("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Sa("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Sa("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CI=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],wI=new uu(3e4,6e4);function Li(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Vi(n,e,t,i,o={}){return fT(n,o,async()=>{let c={},d={};i&&(e==="GET"?d=i:c={body:JSON.stringify(i)});const f=ou(Object.assign({key:n.config.apiKey},d)).slice(1),p=await n._getAdditionalHeaders();p["Content-Type"]="application/json",n.languageCode&&(p["X-Firebase-Locale"]=n.languageCode);const g=Object.assign({method:e,headers:p},c);return Zw()||(g.referrerPolicy="no-referrer"),n.emulatorConfig&&Ur(n.emulatorConfig.host)&&(g.credentials="include"),hT.fetch()(await mT(n,n.config.apiHost,t,f),g)})}async function fT(n,e,t){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},AI),e);try{const o=new II(n),c=await Promise.race([t(),o.promise]);o.clearNetworkTimeout();const d=await c.json();if("needConfirmation"in d)throw Wd(n,"account-exists-with-different-credential",d);if(c.ok&&!("errorMessage"in d))return d;{const f=c.ok?d.errorMessage:d.error.message,[p,g]=f.split(" : ");if(p==="FEDERATED_USER_ID_ALREADY_LINKED")throw Wd(n,"credential-already-in-use",d);if(p==="EMAIL_EXISTS")throw Wd(n,"email-already-in-use",d);if(p==="USER_DISABLED")throw Wd(n,"user-disabled",d);const y=i[p]||p.toLowerCase().replace(/[_\s]+/g,"-");if(g)throw Fg(n,y,g);ds(n,y)}}catch(o){if(o instanceof hs)throw o;ds(n,"network-request-failed",{message:String(o)})}}async function du(n,e,t,i,o={}){const c=await Vi(n,e,t,i,o);return"mfaPendingCredential"in c&&ds(n,"multi-factor-auth-required",{_serverResponse:c}),c}async function mT(n,e,t,i){const o=`${e}${t}?${i}`,c=n,d=c.config.emulator?Bg(n.config,o):`${n.config.apiScheme}://${o}`;return CI.includes(t)&&(await c._persistenceManagerAvailable,c._getPersistenceType()==="COOKIE")?c._getPersistence()._getFinalTarget(d).toString():d}function SI(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class II{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(Ts(this.auth,"network-request-failed")),wI.get())})}}function Wd(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const o=Ts(n,e,i);return o.customData._tokenResponse=t,o}function qN(n){return n!==void 0&&n.enterprise!==void 0}class RI{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return SI(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function DI(n,e){return Vi(n,"GET","/v2/recaptchaConfig",Li(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MI(n,e){return Vi(n,"POST","/v1/accounts:delete",e)}async function Eh(n,e){return Vi(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pc(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function kI(n,e=!1){const t=yt(n),i=await t.getIdToken(e),o=zg(i);Ie(o&&o.exp&&o.auth_time&&o.iat,t.auth,"internal-error");const c=typeof o.firebase=="object"?o.firebase:void 0,d=c?.sign_in_provider;return{claims:o,token:i,authTime:Pc(Up(o.auth_time)),issuedAtTime:Pc(Up(o.iat)),expirationTime:Pc(Up(o.exp)),signInProvider:d||null,signInSecondFactor:c?.sign_in_second_factor||null}}function Up(n){return Number(n)*1e3}function zg(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return rh("JWT malformed, contained fewer than 3 sections"),null;try{const o=Z_(t);return o?JSON.parse(o):(rh("Failed to decode base64 JWT payload"),null)}catch(o){return rh("Caught error parsing JWT payload as JSON",o?.toString()),null}}function BN(n){const e=zg(n);return Ie(e,"internal-error"),Ie(typeof e.exp<"u","internal-error"),Ie(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qc(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof hs&&OI(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function OI({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PI{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const o=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,o)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lg{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Pc(this.lastLoginAt),this.creationTime=Pc(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _h(n){var e;const t=n.auth,i=await n.getIdToken(),o=await Qc(n,Eh(t,{idToken:i}));Ie(o?.users.length,t,"internal-error");const c=o.users[0];n._notifyReloadListener(c);const d=!((e=c.providerUserInfo)===null||e===void 0)&&e.length?pT(c.providerUserInfo):[],f=VI(n.providerData,d),p=n.isAnonymous,g=!(n.email&&c.passwordHash)&&!f?.length,y=p?g:!1,b={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:f,metadata:new lg(c.createdAt,c.lastLoginAt),isAnonymous:y};Object.assign(n,b)}async function LI(n){const e=yt(n);await _h(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function VI(n,e){return[...n.filter(i=>!e.some(o=>o.providerId===i.providerId)),...e]}function pT(n){return n.map(e=>{var{providerId:t}=e,i=Ug(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UI(n,e){const t=await fT(n,{},async()=>{const i=ou({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:o,apiKey:c}=n.config,d=await mT(n,o,"/v1/token",`key=${c}`),f=await n._getAdditionalHeaders();f["Content-Type"]="application/x-www-form-urlencoded";const p={method:"POST",headers:f,body:i};return n.emulatorConfig&&Ur(n.emulatorConfig.host)&&(p.credentials="include"),hT.fetch()(d,p)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function FI(n,e){return Vi(n,"POST","/v2/accounts:revokeToken",Li(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qo{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ie(e.idToken,"internal-error"),Ie(typeof e.idToken<"u","internal-error"),Ie(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):BN(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ie(e.length!==0,"internal-error");const t=BN(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ie(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:o,expiresIn:c}=await UI(e,t);this.updateTokensAndExpiration(i,o,Number(c))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:o,expirationTime:c}=t,d=new Qo;return i&&(Ie(typeof i=="string","internal-error",{appName:e}),d.refreshToken=i),o&&(Ie(typeof o=="string","internal-error",{appName:e}),d.accessToken=o),c&&(Ie(typeof c=="number","internal-error",{appName:e}),d.expirationTime=c),d}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Qo,this.toJSON())}_performRefresh(){return Sa("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fi(n,e){Ie(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Es{constructor(e){var{uid:t,auth:i,stsTokenManager:o}=e,c=Ug(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new PI(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=o,this.accessToken=o.accessToken,this.displayName=c.displayName||null,this.email=c.email||null,this.emailVerified=c.emailVerified||!1,this.phoneNumber=c.phoneNumber||null,this.photoURL=c.photoURL||null,this.isAnonymous=c.isAnonymous||!1,this.tenantId=c.tenantId||null,this.providerData=c.providerData?[...c.providerData]:[],this.metadata=new lg(c.createdAt||void 0,c.lastLoginAt||void 0)}async getIdToken(e){const t=await Qc(this,this.stsTokenManager.getToken(this.auth,e));return Ie(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return kI(this,e)}reload(){return LI(this)}_assign(e){this!==e&&(Ie(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Es(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ie(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await _h(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Dn(this.auth.app))return Promise.reject(Ra(this.auth));const e=await this.getIdToken();return await Qc(this,MI(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,o,c,d,f,p,g,y;const b=(i=t.displayName)!==null&&i!==void 0?i:void 0,E=(o=t.email)!==null&&o!==void 0?o:void 0,j=(c=t.phoneNumber)!==null&&c!==void 0?c:void 0,N=(d=t.photoURL)!==null&&d!==void 0?d:void 0,w=(f=t.tenantId)!==null&&f!==void 0?f:void 0,T=(p=t._redirectEventId)!==null&&p!==void 0?p:void 0,S=(g=t.createdAt)!==null&&g!==void 0?g:void 0,q=(y=t.lastLoginAt)!==null&&y!==void 0?y:void 0,{uid:I,emailVerified:O,isAnonymous:U,providerData:$,stsTokenManager:F}=t;Ie(I&&F,e,"internal-error");const R=Qo.fromJSON(this.name,F);Ie(typeof I=="string",e,"internal-error"),fi(b,e.name),fi(E,e.name),Ie(typeof O=="boolean",e,"internal-error"),Ie(typeof U=="boolean",e,"internal-error"),fi(j,e.name),fi(N,e.name),fi(w,e.name),fi(T,e.name),fi(S,e.name),fi(q,e.name);const V=new Es({uid:I,auth:e,email:E,emailVerified:O,displayName:b,isAnonymous:U,photoURL:N,phoneNumber:j,tenantId:w,stsTokenManager:R,createdAt:S,lastLoginAt:q});return $&&Array.isArray($)&&(V.providerData=$.map(P=>Object.assign({},P))),T&&(V._redirectEventId=T),V}static async _fromIdTokenResponse(e,t,i=!1){const o=new Qo;o.updateFromServerResponse(t);const c=new Es({uid:t.localId,auth:e,stsTokenManager:o,isAnonymous:i});return await _h(c),c}static async _fromGetAccountInfoResponse(e,t,i){const o=t.users[0];Ie(o.localId!==void 0,"internal-error");const c=o.providerUserInfo!==void 0?pT(o.providerUserInfo):[],d=!(o.email&&o.passwordHash)&&!c?.length,f=new Qo;f.updateFromIdToken(i);const p=new Es({uid:o.localId,auth:e,stsTokenManager:f,isAnonymous:d}),g={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:c,metadata:new lg(o.createdAt,o.lastLoginAt),isAnonymous:!(o.email&&o.passwordHash)&&!c?.length};return Object.assign(p,g),p}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zN=new Map;function Ia(n){Ma(n instanceof Function,"Expected a class definition");let e=zN.get(n);return e?(Ma(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,zN.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gT{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}gT.type="NONE";const HN=gT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oh(n,e,t){return`firebase:${n}:${e}:${t}`}class Ko{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:o,name:c}=this.auth;this.fullUserKey=oh(this.userKey,o.apiKey,c),this.fullPersistenceKey=oh("persistence",o.apiKey,c),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Eh(this.auth,{idToken:e}).catch(()=>{});return t?Es._fromGetAccountInfoResponse(this.auth,t,e):null}return Es._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new Ko(Ia(HN),e,i);const o=(await Promise.all(t.map(async g=>{if(await g._isAvailable())return g}))).filter(g=>g);let c=o[0]||Ia(HN);const d=oh(i,e.config.apiKey,e.name);let f=null;for(const g of t)try{const y=await g._get(d);if(y){let b;if(typeof y=="string"){const E=await Eh(e,{idToken:y}).catch(()=>{});if(!E)break;b=await Es._fromGetAccountInfoResponse(e,E,y)}else b=Es._fromJSON(e,y);g!==c&&(f=b),c=g;break}}catch{}const p=o.filter(g=>g._shouldAllowMigration);return!c._shouldAllowMigration||!p.length?new Ko(c,e,i):(c=p[0],f&&await c._set(d,f.toJSON()),await Promise.all(t.map(async g=>{if(g!==c)try{await g._remove(d)}catch{}})),new Ko(c,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GN(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(bT(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(vT(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(ET(e))return"Blackberry";if(_T(e))return"Webos";if(yT(e))return"Safari";if((e.includes("chrome/")||xT(e))&&!e.includes("edge/"))return"Chrome";if(NT(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if(i?.length===2)return i[1]}return"Other"}function vT(n=yn()){return/firefox\//i.test(n)}function yT(n=yn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function xT(n=yn()){return/crios\//i.test(n)}function bT(n=yn()){return/iemobile/i.test(n)}function NT(n=yn()){return/android/i.test(n)}function ET(n=yn()){return/blackberry/i.test(n)}function _T(n=yn()){return/webos/i.test(n)}function Hg(n=yn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function qI(n=yn()){var e;return Hg(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function BI(){return eS()&&document.documentMode===10}function TT(n=yn()){return Hg(n)||NT(n)||_T(n)||ET(n)||/windows phone/i.test(n)||bT(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jT(n,e=[]){let t;switch(n){case"Browser":t=GN(yn());break;case"Worker":t=`${GN(yn())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Fr}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zI{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=c=>new Promise((d,f)=>{try{const p=e(c);d(p)}catch(p){f(p)}});i.onAbort=t,this.queue.push(i);const o=this.queue.length-1;return()=>{this.queue[o]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const o of t)try{o()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HI(n,e={}){return Vi(n,"GET","/v2/passwordPolicy",Li(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GI=6;class $I{constructor(e){var t,i,o,c;const d=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=d.minPasswordLength)!==null&&t!==void 0?t:GI,d.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=d.maxPasswordLength),d.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=d.containsLowercaseCharacter),d.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=d.containsUppercaseCharacter),d.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=d.containsNumericCharacter),d.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=d.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(o=(i=e.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&o!==void 0?o:"",this.forceUpgradeOnSignin=(c=e.forceUpgradeOnSignin)!==null&&c!==void 0?c:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,o,c,d,f;const p={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,p),this.validatePasswordCharacterOptions(e,p),p.isValid&&(p.isValid=(t=p.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),p.isValid&&(p.isValid=(i=p.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),p.isValid&&(p.isValid=(o=p.containsLowercaseLetter)!==null&&o!==void 0?o:!0),p.isValid&&(p.isValid=(c=p.containsUppercaseLetter)!==null&&c!==void 0?c:!0),p.isValid&&(p.isValid=(d=p.containsNumericCharacter)!==null&&d!==void 0?d:!0),p.isValid&&(p.isValid=(f=p.containsNonAlphanumericCharacter)!==null&&f!==void 0?f:!0),p}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,o=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),o&&(t.meetsMaxPasswordLength=e.length<=o)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let o=0;o<e.length;o++)i=e.charAt(o),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,o,c){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=o)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YI{constructor(e,t,i,o){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=o,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new $N(this),this.idTokenSubscription=new $N(this),this.beforeStateQueue=new zI(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=dT,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=o.sdkClientVersion,this._persistenceManagerAvailable=new Promise(c=>this._resolvePersistenceManagerAvailable=c)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ia(t)),this._initializationPromise=this.queue(async()=>{var i,o,c;if(!this._deleted&&(this.persistenceManager=await Ko.create(this,e),(i=this._resolvePersistenceManagerAvailable)===null||i===void 0||i.call(this),!this._deleted)){if(!((o=this._popupRedirectResolver)===null||o===void 0)&&o._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((c=this.currentUser)===null||c===void 0?void 0:c.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Eh(this,{idToken:e}),i=await Es._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Dn(this.app)){const d=this.app.settings.authIdToken;return d?new Promise(f=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(d).then(f,f))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let o=i,c=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const d=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,f=o?._redirectEventId,p=await this.tryRedirectSignIn(e);(!d||d===f)&&p?.user&&(o=p.user,c=!0)}if(!o)return this.directlySetCurrentUser(null);if(!o._redirectEventId){if(c)try{await this.beforeStateQueue.runMiddleware(o)}catch(d){o=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(d))}return o?this.reloadAndSetCurrentUserOrClear(o):this.directlySetCurrentUser(null)}return Ie(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===o._redirectEventId?this.directlySetCurrentUser(o):this.reloadAndSetCurrentUserOrClear(o)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await _h(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=jI()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Dn(this.app))return Promise.reject(Ra(this));const t=e?yt(e):null;return t&&Ie(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ie(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Dn(this.app)?Promise.reject(Ra(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Dn(this.app)?Promise.reject(Ra(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ia(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await HI(this),t=new $I(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Pi("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await FI(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ia(e)||this._popupRedirectResolver;Ie(t,this,"argument-error"),this.redirectPersistenceManager=await Ko.create(this,[Ia(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,o){if(this._deleted)return()=>{};const c=typeof t=="function"?t:t.next.bind(t);let d=!1;const f=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ie(f,this,"internal-error"),f.then(()=>{d||c(this.currentUser)}),typeof t=="function"){const p=e.addObserver(t,i,o);return()=>{d=!0,p()}}else{const p=e.addObserver(t);return()=>{d=!0,p()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ie(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=jT(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const i=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());i&&(t["X-Firebase-Client"]=i);const o=await this._getAppCheckToken();return o&&(t["X-Firebase-AppCheck"]=o),t}async _getAppCheckToken(){var e;if(Dn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t?.error&&NI(`Error while retrieving App Check token: ${t.error}`),t?.token}}function Ui(n){return yt(n)}class $N{constructor(e){this.auth=e,this.observer=null,this.addObserver=rS(t=>this.observer=t)}get next(){return Ie(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Kh={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function QI(n){Kh=n}function AT(n){return Kh.loadJS(n)}function KI(){return Kh.recaptchaEnterpriseScript}function XI(){return Kh.gapiScript}function WI(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class ZI{constructor(){this.enterprise=new JI}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class JI{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const eR="recaptcha-enterprise",CT="NO_RECAPTCHA";class tR{constructor(e){this.type=eR,this.auth=Ui(e)}async verify(e="verify",t=!1){async function i(c){if(!t){if(c.tenantId==null&&c._agentRecaptchaConfig!=null)return c._agentRecaptchaConfig.siteKey;if(c.tenantId!=null&&c._tenantRecaptchaConfigs[c.tenantId]!==void 0)return c._tenantRecaptchaConfigs[c.tenantId].siteKey}return new Promise(async(d,f)=>{DI(c,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(p=>{if(p.recaptchaKey===void 0)f(new Error("recaptcha Enterprise site key undefined"));else{const g=new RI(p);return c.tenantId==null?c._agentRecaptchaConfig=g:c._tenantRecaptchaConfigs[c.tenantId]=g,d(g.siteKey)}}).catch(p=>{f(p)})})}function o(c,d,f){const p=window.grecaptcha;qN(p)?p.enterprise.ready(()=>{p.enterprise.execute(c,{action:e}).then(g=>{d(g)}).catch(()=>{d(CT)})}):f(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new ZI().execute("siteKey",{action:"verify"}):new Promise((c,d)=>{i(this.auth).then(f=>{if(!t&&qN(window.grecaptcha))o(f,c,d);else{if(typeof window>"u"){d(new Error("RecaptchaVerifier is only supported in browser"));return}let p=KI();p.length!==0&&(p+=f),AT(p).then(()=>{o(f,c,d)}).catch(g=>{d(g)})}}).catch(f=>{d(f)})})}}async function YN(n,e,t,i=!1,o=!1){const c=new tR(n);let d;if(o)d=CT;else try{d=await c.verify(t)}catch{d=await c.verify(t,!0)}const f=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in f){const p=f.phoneEnrollmentInfo.phoneNumber,g=f.phoneEnrollmentInfo.recaptchaToken;Object.assign(f,{phoneEnrollmentInfo:{phoneNumber:p,recaptchaToken:g,captchaResponse:d,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in f){const p=f.phoneSignInInfo.recaptchaToken;Object.assign(f,{phoneSignInInfo:{recaptchaToken:p,captchaResponse:d,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return f}return i?Object.assign(f,{captchaResp:d}):Object.assign(f,{captchaResponse:d}),Object.assign(f,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(f,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),f}async function cg(n,e,t,i,o){var c;if(!((c=n._getRecaptchaConfig())===null||c===void 0)&&c.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const d=await YN(n,e,t,t==="getOobCode");return i(n,d)}else return i(n,e).catch(async d=>{if(d.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const f=await YN(n,e,t,t==="getOobCode");return i(n,f)}else return Promise.reject(d)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nR(n,e){const t=Pa(n,"auth");if(t.isInitialized()){const o=t.getImmediate(),c=t.getOptions();if(Ai(c,e??{}))return o;ds(o,"already-initialized")}return t.initialize({options:e})}function sR(n,e){const t=e?.persistence||[],i=(Array.isArray(t)?t:[t]).map(Ia);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e?.popupRedirectResolver)}function aR(n,e,t){const i=Ui(n);Ie(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const o=!1,c=wT(e),{host:d,port:f}=iR(e),p=f===null?"":`:${f}`,g={url:`${c}//${d}${p}/`},y=Object.freeze({host:d,port:f,protocol:c.replace(":",""),options:Object.freeze({disableWarnings:o})});if(!i._canInitEmulator){Ie(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),Ie(Ai(g,i.config.emulator)&&Ai(y,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=g,i.emulatorConfig=y,i.settings.appVerificationDisabledForTesting=!0,Ur(d)?(kg(`${c}//${d}${p}`),Og("Auth",!0)):rR()}function wT(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function iR(n){const e=wT(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",o=/^(\[[^\]]+\])(:|$)/.exec(i);if(o){const c=o[1];return{host:c,port:QN(i.substr(c.length+1))}}else{const[c,d]=i.split(":");return{host:c,port:QN(d)}}}function QN(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function rR(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gg{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Sa("not implemented")}_getIdTokenResponse(e){return Sa("not implemented")}_linkToIdToken(e,t){return Sa("not implemented")}_getReauthenticationResolver(e){return Sa("not implemented")}}async function oR(n,e){return Vi(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lR(n,e){return du(n,"POST","/v1/accounts:signInWithPassword",Li(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cR(n,e){return du(n,"POST","/v1/accounts:signInWithEmailLink",Li(n,e))}async function uR(n,e){return du(n,"POST","/v1/accounts:signInWithEmailLink",Li(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc extends Gg{constructor(e,t,i,o=null){super("password",i),this._email=e,this._password=t,this._tenantId=o}static _fromEmailAndPassword(e,t){return new Kc(e,t,"password")}static _fromEmailAndCode(e,t,i=null){return new Kc(e,t,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return cg(e,t,"signInWithPassword",lR);case"emailLink":return cR(e,{email:this._email,oobCode:this._password});default:ds(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const i={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return cg(e,i,"signUpPassword",oR);case"emailLink":return uR(e,{idToken:t,email:this._email,oobCode:this._password});default:ds(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xo(n,e){return du(n,"POST","/v1/accounts:signInWithIdp",Li(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dR="http://localhost";class Dr extends Gg{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Dr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ds("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:o}=t,c=Ug(t,["providerId","signInMethod"]);if(!i||!o)return null;const d=new Dr(i,o);return d.idToken=c.idToken||void 0,d.accessToken=c.accessToken||void 0,d.secret=c.secret,d.nonce=c.nonce,d.pendingToken=c.pendingToken||null,d}_getIdTokenResponse(e){const t=this.buildRequest();return Xo(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,Xo(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Xo(e,t)}buildRequest(){const e={requestUri:dR,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ou(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hR(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function fR(n){const e=Sc(Ic(n)).link,t=e?Sc(Ic(e)).deep_link_id:null,i=Sc(Ic(n)).deep_link_id;return(i?Sc(Ic(i)).link:null)||i||t||e||n}class $g{constructor(e){var t,i,o,c,d,f;const p=Sc(Ic(e)),g=(t=p.apiKey)!==null&&t!==void 0?t:null,y=(i=p.oobCode)!==null&&i!==void 0?i:null,b=hR((o=p.mode)!==null&&o!==void 0?o:null);Ie(g&&y&&b,"argument-error"),this.apiKey=g,this.operation=b,this.code=y,this.continueUrl=(c=p.continueUrl)!==null&&c!==void 0?c:null,this.languageCode=(d=p.lang)!==null&&d!==void 0?d:null,this.tenantId=(f=p.tenantId)!==null&&f!==void 0?f:null}static parseLink(e){const t=fR(e);try{return new $g(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ul{constructor(){this.providerId=ul.PROVIDER_ID}static credential(e,t){return Kc._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const i=$g.parseLink(t);return Ie(i,"argument-error"),Kc._fromEmailAndCode(e,i.code,i.tenantId)}}ul.PROVIDER_ID="password";ul.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ul.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yg{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu extends Yg{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pi extends hu{constructor(){super("facebook.com")}static credential(e){return Dr._fromParams({providerId:pi.PROVIDER_ID,signInMethod:pi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return pi.credentialFromTaggedObject(e)}static credentialFromError(e){return pi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return pi.credential(e.oauthAccessToken)}catch{return null}}}pi.FACEBOOK_SIGN_IN_METHOD="facebook.com";pi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wa extends hu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Dr._fromParams({providerId:wa.PROVIDER_ID,signInMethod:wa.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return wa.credentialFromTaggedObject(e)}static credentialFromError(e){return wa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return wa.credential(t,i)}catch{return null}}}wa.GOOGLE_SIGN_IN_METHOD="google.com";wa.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi extends hu{constructor(){super("github.com")}static credential(e){return Dr._fromParams({providerId:gi.PROVIDER_ID,signInMethod:gi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return gi.credentialFromTaggedObject(e)}static credentialFromError(e){return gi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return gi.credential(e.oauthAccessToken)}catch{return null}}}gi.GITHUB_SIGN_IN_METHOD="github.com";gi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi extends hu{constructor(){super("twitter.com")}static credential(e,t){return Dr._fromParams({providerId:vi.PROVIDER_ID,signInMethod:vi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return vi.credentialFromTaggedObject(e)}static credentialFromError(e){return vi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return vi.credential(t,i)}catch{return null}}}vi.TWITTER_SIGN_IN_METHOD="twitter.com";vi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mR(n,e){return du(n,"POST","/v1/accounts:signUp",Li(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,o=!1){const c=await Es._fromIdTokenResponse(e,i,o),d=KN(i);return new Mr({user:c,providerId:d,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const o=KN(i);return new Mr({user:e,providerId:o,_tokenResponse:i,operationType:t})}}function KN(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Th extends hs{constructor(e,t,i,o){var c;super(t.code,t.message),this.operationType=i,this.user=o,Object.setPrototypeOf(this,Th.prototype),this.customData={appName:e.name,tenantId:(c=e.tenantId)!==null&&c!==void 0?c:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,o){return new Th(e,t,i,o)}}function ST(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(c=>{throw c.code==="auth/multi-factor-auth-required"?Th._fromErrorAndOperation(n,c,e,i):c})}async function pR(n,e,t=!1){const i=await Qc(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Mr._forOperation(n,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gR(n,e,t=!1){const{auth:i}=n;if(Dn(i.app))return Promise.reject(Ra(i));const o="reauthenticate";try{const c=await Qc(n,ST(i,o,e,n),t);Ie(c.idToken,i,"internal-error");const d=zg(c.idToken);Ie(d,i,"internal-error");const{sub:f}=d;return Ie(n.uid===f,i,"user-mismatch"),Mr._forOperation(n,o,c)}catch(c){throw c?.code==="auth/user-not-found"&&ds(i,"user-mismatch"),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IT(n,e,t=!1){if(Dn(n.app))return Promise.reject(Ra(n));const i="signIn",o=await ST(n,i,e),c=await Mr._fromIdTokenResponse(n,i,o);return t||await n._updateCurrentUser(c.user),c}async function vR(n,e){return IT(Ui(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RT(n){const e=Ui(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function yR(n,e,t){if(Dn(n.app))return Promise.reject(Ra(n));const i=Ui(n),d=await cg(i,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",mR).catch(p=>{throw p.code==="auth/password-does-not-meet-requirements"&&RT(n),p}),f=await Mr._fromIdTokenResponse(i,"signIn",d);return await i._updateCurrentUser(f.user),f}function xR(n,e,t){return Dn(n.app)?Promise.reject(Ra(n)):vR(yt(n),ul.credential(e,t)).catch(async i=>{throw i.code==="auth/password-does-not-meet-requirements"&&RT(n),i})}function bR(n,e,t,i){return yt(n).onIdTokenChanged(e,t,i)}function NR(n,e,t){return yt(n).beforeAuthStateChanged(e,t)}function ER(n,e,t,i){return yt(n).onAuthStateChanged(e,t,i)}function _R(n){return yt(n).signOut()}const jh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DT{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(jh,"1"),this.storage.removeItem(jh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TR=1e3,jR=10;class MT extends DT{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=TT(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),o=this.localCache[t];i!==o&&e(t,o,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((d,f,p)=>{this.notifyListeners(d,p)});return}const i=e.key;t?this.detachListener():this.stopPolling();const o=()=>{const d=this.storage.getItem(i);!t&&this.localCache[i]===d||this.notifyListeners(i,d)},c=this.storage.getItem(i);BI()&&c!==e.newValue&&e.newValue!==e.oldValue?setTimeout(o,jR):o()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const o of Array.from(i))o(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},TR)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}MT.type="LOCAL";const AR=MT;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kT extends DT{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}kT.type="SESSION";const OT=kT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CR(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(o=>o.isListeningto(e));if(t)return t;const i=new Xh(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:o,data:c}=t.data,d=this.handlersMap[o];if(!d?.size)return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:o});const f=Array.from(d).map(async g=>g(t.origin,c)),p=await CR(f);t.ports[0].postMessage({status:"done",eventId:i,eventType:o,response:p})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Xh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qg(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const o=typeof MessageChannel<"u"?new MessageChannel:null;if(!o)throw new Error("connection_unavailable");let c,d;return new Promise((f,p)=>{const g=Qg("",20);o.port1.start();const y=setTimeout(()=>{p(new Error("unsupported_event"))},i);d={messageChannel:o,onMessage(b){const E=b;if(E.data.eventId===g)switch(E.data.status){case"ack":clearTimeout(y),c=setTimeout(()=>{p(new Error("timeout"))},3e3);break;case"done":clearTimeout(c),f(E.data.response);break;default:clearTimeout(y),clearTimeout(c),p(new Error("invalid_response"));break}}},this.handlers.add(d),o.port1.addEventListener("message",d.onMessage),this.target.postMessage({eventType:e,eventId:g,data:t},[o.port2])}).finally(()=>{d&&this.removeMessageHandler(d)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qs(){return window}function SR(n){Qs().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PT(){return typeof Qs().WorkerGlobalScope<"u"&&typeof Qs().importScripts=="function"}async function IR(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function RR(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function DR(){return PT()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LT="firebaseLocalStorageDb",MR=1,Ah="firebaseLocalStorage",VT="fbase_key";class fu{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Wh(n,e){return n.transaction([Ah],e?"readwrite":"readonly").objectStore(Ah)}function kR(){const n=indexedDB.deleteDatabase(LT);return new fu(n).toPromise()}function ug(){const n=indexedDB.open(LT,MR);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(Ah,{keyPath:VT})}catch(o){t(o)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(Ah)?e(i):(i.close(),await kR(),e(await ug()))})})}async function XN(n,e,t){const i=Wh(n,!0).put({[VT]:e,value:t});return new fu(i).toPromise()}async function OR(n,e){const t=Wh(n,!1).get(e),i=await new fu(t).toPromise();return i===void 0?null:i.value}function WN(n,e){const t=Wh(n,!0).delete(e);return new fu(t).toPromise()}const PR=800,LR=3;class UT{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ug(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>LR)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return PT()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Xh._getInstance(DR()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await IR(),!this.activeServiceWorker)return;this.sender=new wR(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&!((e=i[0])===null||e===void 0)&&e.fulfilled&&!((t=i[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||RR()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ug();return await XN(e,jh,"1"),await WN(e,jh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>XN(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>OR(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>WN(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(o=>{const c=Wh(o,!1).getAll();return new fu(c).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:o,value:c}of e)i.add(o),JSON.stringify(this.localCache[o])!==JSON.stringify(c)&&(this.notifyListeners(o,c),t.push(o));for(const o of Object.keys(this.localCache))this.localCache[o]&&!i.has(o)&&(this.notifyListeners(o,null),t.push(o));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const o of Array.from(i))o(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),PR)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}UT.type="LOCAL";const VR=UT;new uu(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FT(n,e){return e?Ia(e):(Ie(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kg extends Gg{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Xo(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Xo(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Xo(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function UR(n){return IT(n.auth,new Kg(n),n.bypassAuthState)}function FR(n){const{auth:e,user:t}=n;return Ie(t,e,"internal-error"),gR(t,new Kg(n),n.bypassAuthState)}async function qR(n){const{auth:e,user:t}=n;return Ie(t,e,"internal-error"),pR(t,new Kg(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qT{constructor(e,t,i,o,c=!1){this.auth=e,this.resolver=i,this.user=o,this.bypassAuthState=c,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:o,tenantId:c,error:d,type:f}=e;if(d){this.reject(d);return}const p={auth:this.auth,requestUri:t,sessionId:i,tenantId:c||void 0,postBody:o||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(f)(p))}catch(g){this.reject(g)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return UR;case"linkViaPopup":case"linkViaRedirect":return qR;case"reauthViaPopup":case"reauthViaRedirect":return FR;default:ds(this.auth,"internal-error")}}resolve(e){Ma(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ma(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BR=new uu(2e3,1e4);async function zR(n,e,t){if(Dn(n.app))return Promise.reject(Ts(n,"operation-not-supported-in-this-environment"));const i=Ui(n);EI(n,e,Yg);const o=FT(i,t);return new wr(i,"signInViaPopup",e,o).executeNotNull()}class wr extends qT{constructor(e,t,i,o,c){super(e,t,o,c),this.provider=i,this.authWindow=null,this.pollId=null,wr.currentPopupAction&&wr.currentPopupAction.cancel(),wr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ie(e,this.auth,"internal-error"),e}async onExecution(){Ma(this.filter.length===1,"Popup operations only handle one event");const e=Qg();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Ts(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Ts(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,wr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if(!((i=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ts(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,BR.get())};e()}}wr.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HR="pendingRedirect",lh=new Map;class GR extends qT{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=lh.get(this.auth._key());if(!e){try{const i=await $R(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}lh.set(this.auth._key(),e)}return this.bypassAuthState||lh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function $R(n,e){const t=KR(e),i=QR(n);if(!await i._isAvailable())return!1;const o=await i._get(t)==="true";return await i._remove(t),o}function YR(n,e){lh.set(n._key(),e)}function QR(n){return Ia(n._redirectPersistence)}function KR(n){return oh(HR,n.config.apiKey,n.name)}async function XR(n,e,t=!1){if(Dn(n.app))return Promise.reject(Ra(n));const i=Ui(n),o=FT(i,e),d=await new GR(i,o,t).execute();return d&&!t&&(delete d.user._redirectEventId,await i._persistUserIfCurrent(d.user),await i._setRedirectUser(null,e)),d}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WR=10*60*1e3;class ZR{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!JR(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!BT(e)){const o=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(Ts(this.auth,o))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=WR&&this.cachedEventUids.clear(),this.cachedEventUids.has(ZN(e))}saveEventToCache(e){this.cachedEventUids.add(ZN(e)),this.lastProcessedEventTime=Date.now()}}function ZN(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function BT({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function JR(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return BT(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e1(n,e={}){return Vi(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t1=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,n1=/^https?/;async function s1(n){if(n.config.emulator)return;const{authorizedDomains:e}=await e1(n);for(const t of e)try{if(a1(t))return}catch{}ds(n,"unauthorized-domain")}function a1(n){const e=og(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const d=new URL(n);return d.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&d.hostname===i}if(!n1.test(t))return!1;if(t1.test(n))return i===n;const o=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+o+"|"+o+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i1=new uu(3e4,6e4);function JN(){const n=Qs().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function r1(n){return new Promise((e,t)=>{var i,o,c;function d(){JN(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{JN(),t(Ts(n,"network-request-failed"))},timeout:i1.get()})}if(!((o=(i=Qs().gapi)===null||i===void 0?void 0:i.iframes)===null||o===void 0)&&o.Iframe)e(gapi.iframes.getContext());else if(!((c=Qs().gapi)===null||c===void 0)&&c.load)d();else{const f=WI("iframefcb");return Qs()[f]=()=>{gapi.load?d():t(Ts(n,"network-request-failed"))},AT(`${XI()}?onload=${f}`).catch(p=>t(p))}}).catch(e=>{throw ch=null,e})}let ch=null;function o1(n){return ch=ch||r1(n),ch}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l1=new uu(5e3,15e3),c1="__/auth/iframe",u1="emulator/auth/iframe",d1={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},h1=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function f1(n){const e=n.config;Ie(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Bg(e,u1):`https://${n.config.authDomain}/${c1}`,i={apiKey:e.apiKey,appName:n.name,v:Fr},o=h1.get(n.config.apiHost);o&&(i.eid=o);const c=n._getFrameworks();return c.length&&(i.fw=c.join(",")),`${t}?${ou(i).slice(1)}`}async function m1(n){const e=await o1(n),t=Qs().gapi;return Ie(t,n,"internal-error"),e.open({where:document.body,url:f1(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:d1,dontclear:!0},i=>new Promise(async(o,c)=>{await i.restyle({setHideOnLeave:!1});const d=Ts(n,"network-request-failed"),f=Qs().setTimeout(()=>{c(d)},l1.get());function p(){Qs().clearTimeout(f),o(i)}i.ping(p).then(p,()=>{c(d)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p1={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},g1=500,v1=600,y1="_blank",x1="http://localhost";class eE{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function b1(n,e,t,i=g1,o=v1){const c=Math.max((window.screen.availHeight-o)/2,0).toString(),d=Math.max((window.screen.availWidth-i)/2,0).toString();let f="";const p=Object.assign(Object.assign({},p1),{width:i.toString(),height:o.toString(),top:c,left:d}),g=yn().toLowerCase();t&&(f=xT(g)?y1:t),vT(g)&&(e=e||x1,p.scrollbars="yes");const y=Object.entries(p).reduce((E,[j,N])=>`${E}${j}=${N},`,"");if(qI(g)&&f!=="_self")return N1(e||"",f),new eE(null);const b=window.open(e||"",f,y);Ie(b,n,"popup-blocked");try{b.focus()}catch{}return new eE(b)}function N1(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E1="__/auth/handler",_1="emulator/auth/handler",T1=encodeURIComponent("fac");async function tE(n,e,t,i,o,c){Ie(n.config.authDomain,n,"auth-domain-config-required"),Ie(n.config.apiKey,n,"invalid-api-key");const d={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:Fr,eventId:o};if(e instanceof Yg){e.setDefaultLanguage(n.languageCode),d.providerId=e.providerId||"",iS(e.getCustomParameters())||(d.customParameters=JSON.stringify(e.getCustomParameters()));for(const[y,b]of Object.entries({}))d[y]=b}if(e instanceof hu){const y=e.getScopes().filter(b=>b!=="");y.length>0&&(d.scopes=y.join(","))}n.tenantId&&(d.tid=n.tenantId);const f=d;for(const y of Object.keys(f))f[y]===void 0&&delete f[y];const p=await n._getAppCheckToken(),g=p?`#${T1}=${encodeURIComponent(p)}`:"";return`${j1(n)}?${ou(f).slice(1)}${g}`}function j1({config:n}){return n.emulator?Bg(n,_1):`https://${n.authDomain}/${E1}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fp="webStorageSupport";class A1{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=OT,this._completeRedirectFn=XR,this._overrideRedirectResult=YR}async _openPopup(e,t,i,o){var c;Ma((c=this.eventManagers[e._key()])===null||c===void 0?void 0:c.manager,"_initialize() not called before _openPopup()");const d=await tE(e,t,i,og(),o);return b1(e,d,Qg())}async _openRedirect(e,t,i,o){await this._originValidation(e);const c=await tE(e,t,i,og(),o);return SR(c),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:o,promise:c}=this.eventManagers[t];return o?Promise.resolve(o):(Ma(c,"If manager is not set, promise should be"),c)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await m1(e),i=new ZR(e);return t.register("authEvent",o=>(Ie(o?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(o.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Fp,{type:Fp},o=>{var c;const d=(c=o?.[0])===null||c===void 0?void 0:c[Fp];d!==void 0&&t(!!d),ds(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=s1(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return TT()||yT()||Hg()}}const C1=A1;var nE="@firebase/auth",sE="1.10.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w1{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ie(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S1(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function I1(n){us(new Yn("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),o=e.getProvider("heartbeat"),c=e.getProvider("app-check-internal"),{apiKey:d,authDomain:f}=i.options;Ie(d&&!d.includes(":"),"invalid-api-key",{appName:i.name});const p={apiKey:d,authDomain:f,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:jT(n)},g=new YI(i,o,c,p);return sR(g,t),g},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),us(new Yn("auth-internal",e=>{const t=Ui(e.getProvider("auth").getImmediate());return(i=>new w1(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),vn(nE,sE,S1(n)),vn(nE,sE,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R1=5*60,D1=nT("authIdTokenMaxAge")||R1;let aE=null;const M1=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>D1)return;const o=t?.token;aE!==o&&(aE=o,await fetch(n,{method:o?"POST":"DELETE",headers:o?{Authorization:`Bearer ${o}`}:{}}))};function k1(n=cu()){const e=Pa(n,"auth");if(e.isInitialized())return e.getImmediate();const t=nR(n,{popupRedirectResolver:C1,persistence:[VR,AR,OT]}),i=nT("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const c=new URL(i,location.origin);if(location.origin===c.origin){const d=M1(c.toString());NR(t,d,()=>d(t.currentUser)),bR(t,f=>d(f))}}const o=J_("auth");return o&&aR(t,`http://${o}`),t}function O1(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}QI({loadJS(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=o=>{const c=Ts("internal-error");c.customData=o,t(c)},i.type="text/javascript",i.charset="UTF-8",O1().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});I1("Browser");var P1="firebase",L1="11.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */vn(P1,L1,"app");var iE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ei,zT;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(F,R){function V(){}V.prototype=R.prototype,F.D=R.prototype,F.prototype=new V,F.prototype.constructor=F,F.C=function(P,C,M){for(var D=Array(arguments.length-2),le=2;le<arguments.length;le++)D[le-2]=arguments[le];return R.prototype[C].apply(P,D)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function o(F,R,V){V||(V=0);var P=Array(16);if(typeof R=="string")for(var C=0;16>C;++C)P[C]=R.charCodeAt(V++)|R.charCodeAt(V++)<<8|R.charCodeAt(V++)<<16|R.charCodeAt(V++)<<24;else for(C=0;16>C;++C)P[C]=R[V++]|R[V++]<<8|R[V++]<<16|R[V++]<<24;R=F.g[0],V=F.g[1],C=F.g[2];var M=F.g[3],D=R+(M^V&(C^M))+P[0]+3614090360&4294967295;R=V+(D<<7&4294967295|D>>>25),D=M+(C^R&(V^C))+P[1]+3905402710&4294967295,M=R+(D<<12&4294967295|D>>>20),D=C+(V^M&(R^V))+P[2]+606105819&4294967295,C=M+(D<<17&4294967295|D>>>15),D=V+(R^C&(M^R))+P[3]+3250441966&4294967295,V=C+(D<<22&4294967295|D>>>10),D=R+(M^V&(C^M))+P[4]+4118548399&4294967295,R=V+(D<<7&4294967295|D>>>25),D=M+(C^R&(V^C))+P[5]+1200080426&4294967295,M=R+(D<<12&4294967295|D>>>20),D=C+(V^M&(R^V))+P[6]+2821735955&4294967295,C=M+(D<<17&4294967295|D>>>15),D=V+(R^C&(M^R))+P[7]+4249261313&4294967295,V=C+(D<<22&4294967295|D>>>10),D=R+(M^V&(C^M))+P[8]+1770035416&4294967295,R=V+(D<<7&4294967295|D>>>25),D=M+(C^R&(V^C))+P[9]+2336552879&4294967295,M=R+(D<<12&4294967295|D>>>20),D=C+(V^M&(R^V))+P[10]+4294925233&4294967295,C=M+(D<<17&4294967295|D>>>15),D=V+(R^C&(M^R))+P[11]+2304563134&4294967295,V=C+(D<<22&4294967295|D>>>10),D=R+(M^V&(C^M))+P[12]+1804603682&4294967295,R=V+(D<<7&4294967295|D>>>25),D=M+(C^R&(V^C))+P[13]+4254626195&4294967295,M=R+(D<<12&4294967295|D>>>20),D=C+(V^M&(R^V))+P[14]+2792965006&4294967295,C=M+(D<<17&4294967295|D>>>15),D=V+(R^C&(M^R))+P[15]+1236535329&4294967295,V=C+(D<<22&4294967295|D>>>10),D=R+(C^M&(V^C))+P[1]+4129170786&4294967295,R=V+(D<<5&4294967295|D>>>27),D=M+(V^C&(R^V))+P[6]+3225465664&4294967295,M=R+(D<<9&4294967295|D>>>23),D=C+(R^V&(M^R))+P[11]+643717713&4294967295,C=M+(D<<14&4294967295|D>>>18),D=V+(M^R&(C^M))+P[0]+3921069994&4294967295,V=C+(D<<20&4294967295|D>>>12),D=R+(C^M&(V^C))+P[5]+3593408605&4294967295,R=V+(D<<5&4294967295|D>>>27),D=M+(V^C&(R^V))+P[10]+38016083&4294967295,M=R+(D<<9&4294967295|D>>>23),D=C+(R^V&(M^R))+P[15]+3634488961&4294967295,C=M+(D<<14&4294967295|D>>>18),D=V+(M^R&(C^M))+P[4]+3889429448&4294967295,V=C+(D<<20&4294967295|D>>>12),D=R+(C^M&(V^C))+P[9]+568446438&4294967295,R=V+(D<<5&4294967295|D>>>27),D=M+(V^C&(R^V))+P[14]+3275163606&4294967295,M=R+(D<<9&4294967295|D>>>23),D=C+(R^V&(M^R))+P[3]+4107603335&4294967295,C=M+(D<<14&4294967295|D>>>18),D=V+(M^R&(C^M))+P[8]+1163531501&4294967295,V=C+(D<<20&4294967295|D>>>12),D=R+(C^M&(V^C))+P[13]+2850285829&4294967295,R=V+(D<<5&4294967295|D>>>27),D=M+(V^C&(R^V))+P[2]+4243563512&4294967295,M=R+(D<<9&4294967295|D>>>23),D=C+(R^V&(M^R))+P[7]+1735328473&4294967295,C=M+(D<<14&4294967295|D>>>18),D=V+(M^R&(C^M))+P[12]+2368359562&4294967295,V=C+(D<<20&4294967295|D>>>12),D=R+(V^C^M)+P[5]+4294588738&4294967295,R=V+(D<<4&4294967295|D>>>28),D=M+(R^V^C)+P[8]+2272392833&4294967295,M=R+(D<<11&4294967295|D>>>21),D=C+(M^R^V)+P[11]+1839030562&4294967295,C=M+(D<<16&4294967295|D>>>16),D=V+(C^M^R)+P[14]+4259657740&4294967295,V=C+(D<<23&4294967295|D>>>9),D=R+(V^C^M)+P[1]+2763975236&4294967295,R=V+(D<<4&4294967295|D>>>28),D=M+(R^V^C)+P[4]+1272893353&4294967295,M=R+(D<<11&4294967295|D>>>21),D=C+(M^R^V)+P[7]+4139469664&4294967295,C=M+(D<<16&4294967295|D>>>16),D=V+(C^M^R)+P[10]+3200236656&4294967295,V=C+(D<<23&4294967295|D>>>9),D=R+(V^C^M)+P[13]+681279174&4294967295,R=V+(D<<4&4294967295|D>>>28),D=M+(R^V^C)+P[0]+3936430074&4294967295,M=R+(D<<11&4294967295|D>>>21),D=C+(M^R^V)+P[3]+3572445317&4294967295,C=M+(D<<16&4294967295|D>>>16),D=V+(C^M^R)+P[6]+76029189&4294967295,V=C+(D<<23&4294967295|D>>>9),D=R+(V^C^M)+P[9]+3654602809&4294967295,R=V+(D<<4&4294967295|D>>>28),D=M+(R^V^C)+P[12]+3873151461&4294967295,M=R+(D<<11&4294967295|D>>>21),D=C+(M^R^V)+P[15]+530742520&4294967295,C=M+(D<<16&4294967295|D>>>16),D=V+(C^M^R)+P[2]+3299628645&4294967295,V=C+(D<<23&4294967295|D>>>9),D=R+(C^(V|~M))+P[0]+4096336452&4294967295,R=V+(D<<6&4294967295|D>>>26),D=M+(V^(R|~C))+P[7]+1126891415&4294967295,M=R+(D<<10&4294967295|D>>>22),D=C+(R^(M|~V))+P[14]+2878612391&4294967295,C=M+(D<<15&4294967295|D>>>17),D=V+(M^(C|~R))+P[5]+4237533241&4294967295,V=C+(D<<21&4294967295|D>>>11),D=R+(C^(V|~M))+P[12]+1700485571&4294967295,R=V+(D<<6&4294967295|D>>>26),D=M+(V^(R|~C))+P[3]+2399980690&4294967295,M=R+(D<<10&4294967295|D>>>22),D=C+(R^(M|~V))+P[10]+4293915773&4294967295,C=M+(D<<15&4294967295|D>>>17),D=V+(M^(C|~R))+P[1]+2240044497&4294967295,V=C+(D<<21&4294967295|D>>>11),D=R+(C^(V|~M))+P[8]+1873313359&4294967295,R=V+(D<<6&4294967295|D>>>26),D=M+(V^(R|~C))+P[15]+4264355552&4294967295,M=R+(D<<10&4294967295|D>>>22),D=C+(R^(M|~V))+P[6]+2734768916&4294967295,C=M+(D<<15&4294967295|D>>>17),D=V+(M^(C|~R))+P[13]+1309151649&4294967295,V=C+(D<<21&4294967295|D>>>11),D=R+(C^(V|~M))+P[4]+4149444226&4294967295,R=V+(D<<6&4294967295|D>>>26),D=M+(V^(R|~C))+P[11]+3174756917&4294967295,M=R+(D<<10&4294967295|D>>>22),D=C+(R^(M|~V))+P[2]+718787259&4294967295,C=M+(D<<15&4294967295|D>>>17),D=V+(M^(C|~R))+P[9]+3951481745&4294967295,F.g[0]=F.g[0]+R&4294967295,F.g[1]=F.g[1]+(C+(D<<21&4294967295|D>>>11))&4294967295,F.g[2]=F.g[2]+C&4294967295,F.g[3]=F.g[3]+M&4294967295}i.prototype.u=function(F,R){R===void 0&&(R=F.length);for(var V=R-this.blockSize,P=this.B,C=this.h,M=0;M<R;){if(C==0)for(;M<=V;)o(this,F,M),M+=this.blockSize;if(typeof F=="string"){for(;M<R;)if(P[C++]=F.charCodeAt(M++),C==this.blockSize){o(this,P),C=0;break}}else for(;M<R;)if(P[C++]=F[M++],C==this.blockSize){o(this,P),C=0;break}}this.h=C,this.o+=R},i.prototype.v=function(){var F=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);F[0]=128;for(var R=1;R<F.length-8;++R)F[R]=0;var V=8*this.o;for(R=F.length-8;R<F.length;++R)F[R]=V&255,V/=256;for(this.u(F),F=Array(16),R=V=0;4>R;++R)for(var P=0;32>P;P+=8)F[V++]=this.g[R]>>>P&255;return F};function c(F,R){var V=f;return Object.prototype.hasOwnProperty.call(V,F)?V[F]:V[F]=R(F)}function d(F,R){this.h=R;for(var V=[],P=!0,C=F.length-1;0<=C;C--){var M=F[C]|0;P&&M==R||(V[C]=M,P=!1)}this.g=V}var f={};function p(F){return-128<=F&&128>F?c(F,function(R){return new d([R|0],0>R?-1:0)}):new d([F|0],0>F?-1:0)}function g(F){if(isNaN(F)||!isFinite(F))return b;if(0>F)return T(g(-F));for(var R=[],V=1,P=0;F>=V;P++)R[P]=F/V|0,V*=4294967296;return new d(R,0)}function y(F,R){if(F.length==0)throw Error("number format error: empty string");if(R=R||10,2>R||36<R)throw Error("radix out of range: "+R);if(F.charAt(0)=="-")return T(y(F.substring(1),R));if(0<=F.indexOf("-"))throw Error('number format error: interior "-" character');for(var V=g(Math.pow(R,8)),P=b,C=0;C<F.length;C+=8){var M=Math.min(8,F.length-C),D=parseInt(F.substring(C,C+M),R);8>M?(M=g(Math.pow(R,M)),P=P.j(M).add(g(D))):(P=P.j(V),P=P.add(g(D)))}return P}var b=p(0),E=p(1),j=p(16777216);n=d.prototype,n.m=function(){if(w(this))return-T(this).m();for(var F=0,R=1,V=0;V<this.g.length;V++){var P=this.i(V);F+=(0<=P?P:4294967296+P)*R,R*=4294967296}return F},n.toString=function(F){if(F=F||10,2>F||36<F)throw Error("radix out of range: "+F);if(N(this))return"0";if(w(this))return"-"+T(this).toString(F);for(var R=g(Math.pow(F,6)),V=this,P="";;){var C=O(V,R).g;V=S(V,C.j(R));var M=((0<V.g.length?V.g[0]:V.h)>>>0).toString(F);if(V=C,N(V))return M+P;for(;6>M.length;)M="0"+M;P=M+P}},n.i=function(F){return 0>F?0:F<this.g.length?this.g[F]:this.h};function N(F){if(F.h!=0)return!1;for(var R=0;R<F.g.length;R++)if(F.g[R]!=0)return!1;return!0}function w(F){return F.h==-1}n.l=function(F){return F=S(this,F),w(F)?-1:N(F)?0:1};function T(F){for(var R=F.g.length,V=[],P=0;P<R;P++)V[P]=~F.g[P];return new d(V,~F.h).add(E)}n.abs=function(){return w(this)?T(this):this},n.add=function(F){for(var R=Math.max(this.g.length,F.g.length),V=[],P=0,C=0;C<=R;C++){var M=P+(this.i(C)&65535)+(F.i(C)&65535),D=(M>>>16)+(this.i(C)>>>16)+(F.i(C)>>>16);P=D>>>16,M&=65535,D&=65535,V[C]=D<<16|M}return new d(V,V[V.length-1]&-2147483648?-1:0)};function S(F,R){return F.add(T(R))}n.j=function(F){if(N(this)||N(F))return b;if(w(this))return w(F)?T(this).j(T(F)):T(T(this).j(F));if(w(F))return T(this.j(T(F)));if(0>this.l(j)&&0>F.l(j))return g(this.m()*F.m());for(var R=this.g.length+F.g.length,V=[],P=0;P<2*R;P++)V[P]=0;for(P=0;P<this.g.length;P++)for(var C=0;C<F.g.length;C++){var M=this.i(P)>>>16,D=this.i(P)&65535,le=F.i(C)>>>16,ve=F.i(C)&65535;V[2*P+2*C]+=D*ve,q(V,2*P+2*C),V[2*P+2*C+1]+=M*ve,q(V,2*P+2*C+1),V[2*P+2*C+1]+=D*le,q(V,2*P+2*C+1),V[2*P+2*C+2]+=M*le,q(V,2*P+2*C+2)}for(P=0;P<R;P++)V[P]=V[2*P+1]<<16|V[2*P];for(P=R;P<2*R;P++)V[P]=0;return new d(V,0)};function q(F,R){for(;(F[R]&65535)!=F[R];)F[R+1]+=F[R]>>>16,F[R]&=65535,R++}function I(F,R){this.g=F,this.h=R}function O(F,R){if(N(R))throw Error("division by zero");if(N(F))return new I(b,b);if(w(F))return R=O(T(F),R),new I(T(R.g),T(R.h));if(w(R))return R=O(F,T(R)),new I(T(R.g),R.h);if(30<F.g.length){if(w(F)||w(R))throw Error("slowDivide_ only works with positive integers.");for(var V=E,P=R;0>=P.l(F);)V=U(V),P=U(P);var C=$(V,1),M=$(P,1);for(P=$(P,2),V=$(V,2);!N(P);){var D=M.add(P);0>=D.l(F)&&(C=C.add(V),M=D),P=$(P,1),V=$(V,1)}return R=S(F,C.j(R)),new I(C,R)}for(C=b;0<=F.l(R);){for(V=Math.max(1,Math.floor(F.m()/R.m())),P=Math.ceil(Math.log(V)/Math.LN2),P=48>=P?1:Math.pow(2,P-48),M=g(V),D=M.j(R);w(D)||0<D.l(F);)V-=P,M=g(V),D=M.j(R);N(M)&&(M=E),C=C.add(M),F=S(F,D)}return new I(C,F)}n.A=function(F){return O(this,F).h},n.and=function(F){for(var R=Math.max(this.g.length,F.g.length),V=[],P=0;P<R;P++)V[P]=this.i(P)&F.i(P);return new d(V,this.h&F.h)},n.or=function(F){for(var R=Math.max(this.g.length,F.g.length),V=[],P=0;P<R;P++)V[P]=this.i(P)|F.i(P);return new d(V,this.h|F.h)},n.xor=function(F){for(var R=Math.max(this.g.length,F.g.length),V=[],P=0;P<R;P++)V[P]=this.i(P)^F.i(P);return new d(V,this.h^F.h)};function U(F){for(var R=F.g.length+1,V=[],P=0;P<R;P++)V[P]=F.i(P)<<1|F.i(P-1)>>>31;return new d(V,F.h)}function $(F,R){var V=R>>5;R%=32;for(var P=F.g.length-V,C=[],M=0;M<P;M++)C[M]=0<R?F.i(M+V)>>>R|F.i(M+V+1)<<32-R:F.i(M+V);return new d(C,F.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,zT=i,d.prototype.add=d.prototype.add,d.prototype.multiply=d.prototype.j,d.prototype.modulo=d.prototype.A,d.prototype.compare=d.prototype.l,d.prototype.toNumber=d.prototype.m,d.prototype.toString=d.prototype.toString,d.prototype.getBits=d.prototype.i,d.fromNumber=g,d.fromString=y,Ei=d}).apply(typeof iE<"u"?iE:typeof self<"u"?self:typeof window<"u"?window:{});var Zd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var HT,Rc,GT,uh,dg,$T,YT,QT;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(h,x,_){return h==Array.prototype||h==Object.prototype||(h[x]=_.value),h};function t(h){h=[typeof globalThis=="object"&&globalThis,h,typeof window=="object"&&window,typeof self=="object"&&self,typeof Zd=="object"&&Zd];for(var x=0;x<h.length;++x){var _=h[x];if(_&&_.Math==Math)return _}throw Error("Cannot find global object")}var i=t(this);function o(h,x){if(x)e:{var _=i;h=h.split(".");for(var L=0;L<h.length-1;L++){var K=h[L];if(!(K in _))break e;_=_[K]}h=h[h.length-1],L=_[h],x=x(L),x!=L&&x!=null&&e(_,h,{configurable:!0,writable:!0,value:x})}}function c(h,x){h instanceof String&&(h+="");var _=0,L=!1,K={next:function(){if(!L&&_<h.length){var te=_++;return{value:x(te,h[te]),done:!1}}return L=!0,{done:!0,value:void 0}}};return K[Symbol.iterator]=function(){return K},K}o("Array.prototype.values",function(h){return h||function(){return c(this,function(x,_){return _})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var d=d||{},f=this||self;function p(h){var x=typeof h;return x=x!="object"?x:h?Array.isArray(h)?"array":x:"null",x=="array"||x=="object"&&typeof h.length=="number"}function g(h){var x=typeof h;return x=="object"&&h!=null||x=="function"}function y(h,x,_){return h.call.apply(h.bind,arguments)}function b(h,x,_){if(!h)throw Error();if(2<arguments.length){var L=Array.prototype.slice.call(arguments,2);return function(){var K=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(K,L),h.apply(x,K)}}return function(){return h.apply(x,arguments)}}function E(h,x,_){return E=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?y:b,E.apply(null,arguments)}function j(h,x){var _=Array.prototype.slice.call(arguments,1);return function(){var L=_.slice();return L.push.apply(L,arguments),h.apply(this,L)}}function N(h,x){function _(){}_.prototype=x.prototype,h.aa=x.prototype,h.prototype=new _,h.prototype.constructor=h,h.Qb=function(L,K,te){for(var fe=Array(arguments.length-2),Ke=2;Ke<arguments.length;Ke++)fe[Ke-2]=arguments[Ke];return x.prototype[K].apply(L,fe)}}function w(h){const x=h.length;if(0<x){const _=Array(x);for(let L=0;L<x;L++)_[L]=h[L];return _}return[]}function T(h,x){for(let _=1;_<arguments.length;_++){const L=arguments[_];if(p(L)){const K=h.length||0,te=L.length||0;h.length=K+te;for(let fe=0;fe<te;fe++)h[K+fe]=L[fe]}else h.push(L)}}class S{constructor(x,_){this.i=x,this.j=_,this.h=0,this.g=null}get(){let x;return 0<this.h?(this.h--,x=this.g,this.g=x.next,x.next=null):x=this.i(),x}}function q(h){return/^[\s\xa0]*$/.test(h)}function I(){var h=f.navigator;return h&&(h=h.userAgent)?h:""}function O(h){return O[" "](h),h}O[" "]=function(){};var U=I().indexOf("Gecko")!=-1&&!(I().toLowerCase().indexOf("webkit")!=-1&&I().indexOf("Edge")==-1)&&!(I().indexOf("Trident")!=-1||I().indexOf("MSIE")!=-1)&&I().indexOf("Edge")==-1;function $(h,x,_){for(const L in h)x.call(_,h[L],L,h)}function F(h,x){for(const _ in h)x.call(void 0,h[_],_,h)}function R(h){const x={};for(const _ in h)x[_]=h[_];return x}const V="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function P(h,x){let _,L;for(let K=1;K<arguments.length;K++){L=arguments[K];for(_ in L)h[_]=L[_];for(let te=0;te<V.length;te++)_=V[te],Object.prototype.hasOwnProperty.call(L,_)&&(h[_]=L[_])}}function C(h){var x=1;h=h.split(":");const _=[];for(;0<x&&h.length;)_.push(h.shift()),x--;return h.length&&_.push(h.join(":")),_}function M(h){f.setTimeout(()=>{throw h},0)}function D(){var h=Oe;let x=null;return h.g&&(x=h.g,h.g=h.g.next,h.g||(h.h=null),x.next=null),x}class le{constructor(){this.h=this.g=null}add(x,_){const L=ve.get();L.set(x,_),this.h?this.h.next=L:this.g=L,this.h=L}}var ve=new S(()=>new Q,h=>h.reset());class Q{constructor(){this.next=this.g=this.h=null}set(x,_){this.h=x,this.g=_,this.next=null}reset(){this.next=this.g=this.h=null}}let se,me=!1,Oe=new le,H=()=>{const h=f.Promise.resolve(void 0);se=()=>{h.then(ee)}};var ee=()=>{for(var h;h=D();){try{h.h.call(h.g)}catch(_){M(_)}var x=ve;x.j(h),100>x.h&&(x.h++,h.next=x.g,x.g=h)}me=!1};function ce(){this.s=this.s,this.C=this.C}ce.prototype.s=!1,ce.prototype.ma=function(){this.s||(this.s=!0,this.N())},ce.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ue(h,x){this.type=h,this.g=this.target=x,this.defaultPrevented=!1}ue.prototype.h=function(){this.defaultPrevented=!0};var Te=function(){if(!f.addEventListener||!Object.defineProperty)return!1;var h=!1,x=Object.defineProperty({},"passive",{get:function(){h=!0}});try{const _=()=>{};f.addEventListener("test",_,x),f.removeEventListener("test",_,x)}catch{}return h}();function Be(h,x){if(ue.call(this,h?h.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,h){var _=this.type=h.type,L=h.changedTouches&&h.changedTouches.length?h.changedTouches[0]:null;if(this.target=h.target||h.srcElement,this.g=x,x=h.relatedTarget){if(U){e:{try{O(x.nodeName);var K=!0;break e}catch{}K=!1}K||(x=null)}}else _=="mouseover"?x=h.fromElement:_=="mouseout"&&(x=h.toElement);this.relatedTarget=x,L?(this.clientX=L.clientX!==void 0?L.clientX:L.pageX,this.clientY=L.clientY!==void 0?L.clientY:L.pageY,this.screenX=L.screenX||0,this.screenY=L.screenY||0):(this.clientX=h.clientX!==void 0?h.clientX:h.pageX,this.clientY=h.clientY!==void 0?h.clientY:h.pageY,this.screenX=h.screenX||0,this.screenY=h.screenY||0),this.button=h.button,this.key=h.key||"",this.ctrlKey=h.ctrlKey,this.altKey=h.altKey,this.shiftKey=h.shiftKey,this.metaKey=h.metaKey,this.pointerId=h.pointerId||0,this.pointerType=typeof h.pointerType=="string"?h.pointerType:Me[h.pointerType]||"",this.state=h.state,this.i=h,h.defaultPrevented&&Be.aa.h.call(this)}}N(Be,ue);var Me={2:"touch",3:"pen",4:"mouse"};Be.prototype.h=function(){Be.aa.h.call(this);var h=this.i;h.preventDefault?h.preventDefault():h.returnValue=!1};var $t="closure_listenable_"+(1e6*Math.random()|0),mt=0;function Cs(h,x,_,L,K){this.listener=h,this.proxy=null,this.src=x,this.type=_,this.capture=!!L,this.ha=K,this.key=++mt,this.da=this.fa=!1}function Va(h){h.da=!0,h.listener=null,h.proxy=null,h.src=null,h.ha=null}function ta(h){this.src=h,this.g={},this.h=0}ta.prototype.add=function(h,x,_,L,K){var te=h.toString();h=this.g[te],h||(h=this.g[te]=[],this.h++);var fe=Hi(h,x,L,K);return-1<fe?(x=h[fe],_||(x.fa=!1)):(x=new Cs(x,this.src,te,!!L,K),x.fa=_,h.push(x)),x};function zi(h,x){var _=x.type;if(_ in h.g){var L=h.g[_],K=Array.prototype.indexOf.call(L,x,void 0),te;(te=0<=K)&&Array.prototype.splice.call(L,K,1),te&&(Va(x),h.g[_].length==0&&(delete h.g[_],h.h--))}}function Hi(h,x,_,L){for(var K=0;K<h.length;++K){var te=h[K];if(!te.da&&te.listener==x&&te.capture==!!_&&te.ha==L)return K}return-1}var Gi="closure_lm_"+(1e6*Math.random()|0),xl={};function Cu(h,x,_,L,K){if(Array.isArray(x)){for(var te=0;te<x.length;te++)Cu(h,x[te],_,L,K);return null}return _=wu(_),h&&h[$t]?h.K(x,_,g(L)?!!L.capture:!1,K):Kn(h,x,_,!1,L,K)}function Kn(h,x,_,L,K,te){if(!x)throw Error("Invalid event type");var fe=g(K)?!!K.capture:!!K,Ke=$r(h);if(Ke||(h[Gi]=Ke=new ta(h)),_=Ke.add(x,_,L,fe,te),_.proxy)return _;if(L=wf(),_.proxy=L,L.src=h,L.listener=_,h.addEventListener)Te||(K=fe),K===void 0&&(K=!1),h.addEventListener(x.toString(),L,K);else if(h.attachEvent)h.attachEvent($i(x.toString()),L);else if(h.addListener&&h.removeListener)h.addListener(L);else throw Error("addEventListener and attachEvent are unavailable.");return _}function wf(){function h(_){return x.call(h.src,h.listener,_)}const x=Sf;return h}function bl(h,x,_,L,K){if(Array.isArray(x))for(var te=0;te<x.length;te++)bl(h,x[te],_,L,K);else L=g(L)?!!L.capture:!!L,_=wu(_),h&&h[$t]?(h=h.i,x=String(x).toString(),x in h.g&&(te=h.g[x],_=Hi(te,_,L,K),-1<_&&(Va(te[_]),Array.prototype.splice.call(te,_,1),te.length==0&&(delete h.g[x],h.h--)))):h&&(h=$r(h))&&(x=h.g[x.toString()],h=-1,x&&(h=Hi(x,_,L,K)),(_=-1<h?x[h]:null)&&Gr(_))}function Gr(h){if(typeof h!="number"&&h&&!h.da){var x=h.src;if(x&&x[$t])zi(x.i,h);else{var _=h.type,L=h.proxy;x.removeEventListener?x.removeEventListener(_,L,h.capture):x.detachEvent?x.detachEvent($i(_),L):x.addListener&&x.removeListener&&x.removeListener(L),(_=$r(x))?(zi(_,h),_.h==0&&(_.src=null,x[Gi]=null)):Va(h)}}}function $i(h){return h in xl?xl[h]:xl[h]="on"+h}function Sf(h,x){if(h.da)h=!0;else{x=new Be(x,this);var _=h.listener,L=h.ha||h.src;h.fa&&Gr(h),h=_.call(L,x)}return h}function $r(h){return h=h[Gi],h instanceof ta?h:null}var Nl="__closure_events_fn_"+(1e9*Math.random()>>>0);function wu(h){return typeof h=="function"?h:(h[Nl]||(h[Nl]=function(x){return h.handleEvent(x)}),h[Nl])}function Tt(){ce.call(this),this.i=new ta(this),this.M=this,this.F=null}N(Tt,ce),Tt.prototype[$t]=!0,Tt.prototype.removeEventListener=function(h,x,_,L){bl(this,h,x,_,L)};function at(h,x){var _,L=h.F;if(L)for(_=[];L;L=L.F)_.push(L);if(h=h.M,L=x.type||x,typeof x=="string")x=new ue(x,h);else if(x instanceof ue)x.target=x.target||h;else{var K=x;x=new ue(L,h),P(x,K)}if(K=!0,_)for(var te=_.length-1;0<=te;te--){var fe=x.g=_[te];K=kn(fe,L,!0,x)&&K}if(fe=x.g=h,K=kn(fe,L,!0,x)&&K,K=kn(fe,L,!1,x)&&K,_)for(te=0;te<_.length;te++)fe=x.g=_[te],K=kn(fe,L,!1,x)&&K}Tt.prototype.N=function(){if(Tt.aa.N.call(this),this.i){var h=this.i,x;for(x in h.g){for(var _=h.g[x],L=0;L<_.length;L++)Va(_[L]);delete h.g[x],h.h--}}this.F=null},Tt.prototype.K=function(h,x,_,L){return this.i.add(String(h),x,!1,_,L)},Tt.prototype.L=function(h,x,_,L){return this.i.add(String(h),x,!0,_,L)};function kn(h,x,_,L){if(x=h.i.g[String(x)],!x)return!0;x=x.concat();for(var K=!0,te=0;te<x.length;++te){var fe=x[te];if(fe&&!fe.da&&fe.capture==_){var Ke=fe.listener,Ut=fe.ha||fe.src;fe.fa&&zi(h.i,fe),K=Ke.call(Ut,L)!==!1&&K}}return K&&!L.defaultPrevented}function dn(h,x,_){if(typeof h=="function")_&&(h=E(h,_));else if(h&&typeof h.handleEvent=="function")h=E(h.handleEvent,h);else throw Error("Invalid listener argument");return 2147483647<Number(x)?-1:f.setTimeout(h,x||0)}function Su(h){h.g=dn(()=>{h.g=null,h.i&&(h.i=!1,Su(h))},h.l);const x=h.h;h.h=null,h.m.apply(null,x)}class If extends ce{constructor(x,_){super(),this.m=x,this.l=_,this.h=null,this.i=!1,this.g=null}j(x){this.h=arguments,this.g?this.i=!0:Su(this)}N(){super.N(),this.g&&(f.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Yi(h){ce.call(this),this.h=h,this.g={}}N(Yi,ce);var Qi=[];function Ki(h){$(h.g,function(x,_){this.g.hasOwnProperty(_)&&Gr(x)},h),h.g={}}Yi.prototype.N=function(){Yi.aa.N.call(this),Ki(this)},Yi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var fs=f.JSON.stringify,Yr=f.JSON.parse,Xi=class{stringify(h){return f.JSON.stringify(h,void 0)}parse(h){return f.JSON.parse(h,void 0)}};function El(){}El.prototype.h=null;function _l(h){return h.h||(h.h=h.i())}function Tl(){}var na={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function sa(){ue.call(this,"d")}N(sa,ue);function jl(){ue.call(this,"c")}N(jl,ue);var ws={},Al=null;function Ua(){return Al=Al||new Tt}ws.La="serverreachability";function Qr(h){ue.call(this,ws.La,h)}N(Qr,ue);function Fa(h){const x=Ua();at(x,new Qr(x))}ws.STAT_EVENT="statevent";function Iu(h,x){ue.call(this,ws.STAT_EVENT,h),this.stat=x}N(Iu,ue);function xt(h){const x=Ua();at(x,new Iu(x,h))}ws.Ma="timingevent";function Vt(h,x){ue.call(this,ws.Ma,h),this.size=x}N(Vt,ue);function Dt(h,x){if(typeof h!="function")throw Error("Fn must not be null and must be a function");return f.setTimeout(function(){h()},x)}function Xn(){this.g=!0}Xn.prototype.xa=function(){this.g=!1};function Cl(h,x,_,L,K,te){h.info(function(){if(h.g)if(te)for(var fe="",Ke=te.split("&"),Ut=0;Ut<Ke.length;Ut++){var Xe=Ke[Ut].split("=");if(1<Xe.length){var Qt=Xe[0];Xe=Xe[1];var Ft=Qt.split("_");fe=2<=Ft.length&&Ft[1]=="type"?fe+(Qt+"="+Xe+"&"):fe+(Qt+"=redacted&")}}else fe=null;else fe=te;return"XMLHTTP REQ ("+L+") [attempt "+K+"]: "+x+`
`+_+`
`+fe})}function Rf(h,x,_,L,K,te,fe){h.info(function(){return"XMLHTTP RESP ("+L+") [ attempt "+K+"]: "+x+`
`+_+`
`+te+" "+fe})}function qa(h,x,_,L){h.info(function(){return"XMLHTTP TEXT ("+x+"): "+Wi(h,_)+(L?" "+L:"")})}function Ru(h,x){h.info(function(){return"TIMEOUT: "+x})}Xn.prototype.info=function(){};function Wi(h,x){if(!h.g)return x;if(!x)return null;try{var _=JSON.parse(x);if(_){for(h=0;h<_.length;h++)if(Array.isArray(_[h])){var L=_[h];if(!(2>L.length)){var K=L[1];if(Array.isArray(K)&&!(1>K.length)){var te=K[0];if(te!="noop"&&te!="stop"&&te!="close")for(var fe=1;fe<K.length;fe++)K[fe]=""}}}}return fs(_)}catch{return x}}var Ba={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},aa={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ss;function Is(){}N(Is,El),Is.prototype.g=function(){return new XMLHttpRequest},Is.prototype.i=function(){return{}},Ss=new Is;function xn(h,x,_,L){this.j=h,this.i=x,this.l=_,this.R=L||1,this.U=new Yi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ct}function Ct(){this.i=null,this.g="",this.h=!1}var wl={},Kr={};function ms(h,x,_){h.L=1,h.v=nr(On(x)),h.m=_,h.P=!0,ia(h,null)}function ia(h,x){h.F=Date.now(),Zi(h),h.A=On(h.v);var _=h.A,L=h.R;Array.isArray(L)||(L=[String(L)]),kl(_.i,"t",L),h.C=0,_=h.j.J,h.h=new Ct,h.g=Yu(h.j,_?x:null,!h.m),0<h.O&&(h.M=new If(E(h.Y,h,h.g),h.O)),x=h.U,_=h.g,L=h.ca;var K="readystatechange";Array.isArray(K)||(K&&(Qi[0]=K.toString()),K=Qi);for(var te=0;te<K.length;te++){var fe=Cu(_,K[te],L||x.handleEvent,!1,x.h||x);if(!fe)break;x.g[fe.key]=fe}x=h.H?R(h.H):{},h.m?(h.u||(h.u="POST"),x["Content-Type"]="application/x-www-form-urlencoded",h.g.ea(h.A,h.u,h.m,x)):(h.u="GET",h.g.ea(h.A,h.u,null,x)),Fa(),Cl(h.i,h.u,h.A,h.l,h.R,h.m)}xn.prototype.ca=function(h){h=h.target;const x=this.M;x&&es(h)==3?x.j():this.Y(h)},xn.prototype.Y=function(h){try{if(h==this.g)e:{const Ft=es(this.g);var x=this.g.Ba();const fa=this.g.Z();if(!(3>Ft)&&(Ft!=3||this.g&&(this.h.h||this.g.oa()||Uu(this.g)))){this.J||Ft!=4||x==7||(x==8||0>=fa?Fa(3):Fa(2)),za(this);var _=this.g.Z();this.X=_;t:if(Du(this)){var L=Uu(this.g);h="";var K=L.length,te=es(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){en(this),Rs(this);var fe="";break t}this.h.i=new f.TextDecoder}for(x=0;x<K;x++)this.h.h=!0,h+=this.h.i.decode(L[x],{stream:!(te&&x==K-1)});L.length=0,this.h.g+=h,this.C=0,fe=this.h.g}else fe=this.g.oa();if(this.o=_==200,Rf(this.i,this.u,this.A,this.l,this.R,Ft,_),this.o){if(this.T&&!this.K){t:{if(this.g){var Ke,Ut=this.g;if((Ke=Ut.g?Ut.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(Ke)){var Xe=Ke;break t}}Xe=null}if(_=Xe)qa(this.i,this.l,_,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ji(this,_);else{this.o=!1,this.s=3,xt(12),en(this),Rs(this);break e}}if(this.P){_=!0;let tn;for(;!this.J&&this.C<fe.length;)if(tn=Mu(this,fe),tn==Kr){Ft==4&&(this.s=4,xt(14),_=!1),qa(this.i,this.l,null,"[Incomplete Response]");break}else if(tn==wl){this.s=4,xt(15),qa(this.i,this.l,fe,"[Invalid Chunk]"),_=!1;break}else qa(this.i,this.l,tn,null),Ji(this,tn);if(Du(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ft!=4||fe.length!=0||this.h.h||(this.s=1,xt(16),_=!1),this.o=this.o&&_,!_)qa(this.i,this.l,fe,"[Invalid Chunked Response]"),en(this),Rs(this);else if(0<fe.length&&!this.W){this.W=!0;var Qt=this.j;Qt.g==this&&Qt.ba&&!Qt.M&&(Qt.j.info("Great, no buffering proxy detected. Bytes received: "+fe.length),ur(Qt),Qt.M=!0,xt(11))}}else qa(this.i,this.l,fe,null),Ji(this,fe);Ft==4&&en(this),this.o&&!this.J&&(Ft==4?Hu(this.j,this):(this.o=!1,Zi(this)))}else Pf(this.g),_==400&&0<fe.indexOf("Unknown SID")?(this.s=3,xt(12)):(this.s=0,xt(13)),en(this),Rs(this)}}}catch{}finally{}};function Du(h){return h.g?h.u=="GET"&&h.L!=2&&h.j.Ca:!1}function Mu(h,x){var _=h.C,L=x.indexOf(`
`,_);return L==-1?Kr:(_=Number(x.substring(_,L)),isNaN(_)?wl:(L+=1,L+_>x.length?Kr:(x=x.slice(L,L+_),h.C=L+_,x)))}xn.prototype.cancel=function(){this.J=!0,en(this)};function Zi(h){h.S=Date.now()+h.I,ku(h,h.I)}function ku(h,x){if(h.B!=null)throw Error("WatchDog timer not null");h.B=Dt(E(h.ba,h),x)}function za(h){h.B&&(f.clearTimeout(h.B),h.B=null)}xn.prototype.ba=function(){this.B=null;const h=Date.now();0<=h-this.S?(Ru(this.i,this.A),this.L!=2&&(Fa(),xt(17)),en(this),this.s=2,Rs(this)):ku(this,this.S-h)};function Rs(h){h.j.G==0||h.J||Hu(h.j,h)}function en(h){za(h);var x=h.M;x&&typeof x.ma=="function"&&x.ma(),h.M=null,Ki(h.U),h.g&&(x=h.g,h.g=null,x.abort(),x.ma())}function Ji(h,x){try{var _=h.j;if(_.G!=0&&(_.g==h||Sl(_.h,h))){if(!h.K&&Sl(_.h,h)&&_.G==3){try{var L=_.Da.g.parse(x)}catch{L=null}if(Array.isArray(L)&&L.length==3){var K=L;if(K[0]==0){e:if(!_.u){if(_.g)if(_.g.F+3e3<h.F)oo(_),io(_);else break e;Ul(_),xt(18)}}else _.za=K[1],0<_.za-_.T&&37500>K[2]&&_.F&&_.v==0&&!_.C&&(_.C=Dt(E(_.Za,_),6e3));if(1>=Wr(_.h)&&_.ca){try{_.ca()}catch{}_.ca=void 0}}else ha(_,11)}else if((h.K||_.g==h)&&oo(_),!q(x))for(K=_.Da.g.parse(x),x=0;x<K.length;x++){let Xe=K[x];if(_.T=Xe[0],Xe=Xe[1],_.G==2)if(Xe[0]=="c"){_.K=Xe[1],_.ia=Xe[2];const Qt=Xe[3];Qt!=null&&(_.la=Qt,_.j.info("VER="+_.la));const Ft=Xe[4];Ft!=null&&(_.Aa=Ft,_.j.info("SVER="+_.Aa));const fa=Xe[5];fa!=null&&typeof fa=="number"&&0<fa&&(L=1.5*fa,_.L=L,_.j.info("backChannelRequestTimeoutMs_="+L)),L=_;const tn=h.g;if(tn){const Vs=tn.g?tn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Vs){var te=L.h;te.g||Vs.indexOf("spdy")==-1&&Vs.indexOf("quic")==-1&&Vs.indexOf("h2")==-1||(te.j=te.l,te.g=new Set,te.h&&(Zr(te,te.h),te.h=null))}if(L.D){const ql=tn.g?tn.g.getResponseHeader("X-HTTP-Session-Id"):null;ql&&(L.ya=ql,ot(L.I,L.D,ql))}}_.G=3,_.l&&_.l.ua(),_.ba&&(_.R=Date.now()-h.F,_.j.info("Handshake RTT: "+_.R+"ms")),L=_;var fe=h;if(L.qa=$u(L,L.J?L.ia:null,L.W),fe.K){bn(L.h,fe);var Ke=fe,Ut=L.L;Ut&&(Ke.I=Ut),Ke.B&&(za(Ke),Zi(Ke)),L.g=fe}else Bu(L);0<_.i.length&&ro(_)}else Xe[0]!="stop"&&Xe[0]!="close"||ha(_,7);else _.G==3&&(Xe[0]=="stop"||Xe[0]=="close"?Xe[0]=="stop"?ha(_,7):Ll(_):Xe[0]!="noop"&&_.l&&_.l.ta(Xe),_.v=0)}}Fa(4)}catch{}}var Ou=class{constructor(h,x){this.g=h,this.map=x}};function ra(h){this.l=h||10,f.PerformanceNavigationTiming?(h=f.performance.getEntriesByType("navigation"),h=0<h.length&&(h[0].nextHopProtocol=="hq"||h[0].nextHopProtocol=="h2")):h=!!(f.chrome&&f.chrome.loadTimes&&f.chrome.loadTimes()&&f.chrome.loadTimes().wasFetchedViaSpdy),this.j=h?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Xr(h){return h.h?!0:h.g?h.g.size>=h.j:!1}function Wr(h){return h.h?1:h.g?h.g.size:0}function Sl(h,x){return h.h?h.h==x:h.g?h.g.has(x):!1}function Zr(h,x){h.g?h.g.add(x):h.h=x}function bn(h,x){h.h&&h.h==x?h.h=null:h.g&&h.g.has(x)&&h.g.delete(x)}ra.prototype.cancel=function(){if(this.i=Il(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const h of this.g.values())h.cancel();this.g.clear()}};function Il(h){if(h.h!=null)return h.i.concat(h.h.D);if(h.g!=null&&h.g.size!==0){let x=h.i;for(const _ of h.g.values())x=x.concat(_.D);return x}return w(h.i)}function Df(h){if(h.V&&typeof h.V=="function")return h.V();if(typeof Map<"u"&&h instanceof Map||typeof Set<"u"&&h instanceof Set)return Array.from(h.values());if(typeof h=="string")return h.split("");if(p(h)){for(var x=[],_=h.length,L=0;L<_;L++)x.push(h[L]);return x}x=[],_=0;for(L in h)x[_++]=h[L];return x}function Jr(h){if(h.na&&typeof h.na=="function")return h.na();if(!h.V||typeof h.V!="function"){if(typeof Map<"u"&&h instanceof Map)return Array.from(h.keys());if(!(typeof Set<"u"&&h instanceof Set)){if(p(h)||typeof h=="string"){var x=[];h=h.length;for(var _=0;_<h;_++)x.push(_);return x}x=[],_=0;for(const L in h)x[_++]=L;return x}}}function Rl(h,x){if(h.forEach&&typeof h.forEach=="function")h.forEach(x,void 0);else if(p(h)||typeof h=="string")Array.prototype.forEach.call(h,x,void 0);else for(var _=Jr(h),L=Df(h),K=L.length,te=0;te<K;te++)x.call(void 0,L[te],_&&_[te],h)}var er=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Mf(h,x){if(h){h=h.split("&");for(var _=0;_<h.length;_++){var L=h[_].indexOf("="),K=null;if(0<=L){var te=h[_].substring(0,L);K=h[_].substring(L+1)}else te=h[_];x(te,K?decodeURIComponent(K.replace(/\+/g," ")):"")}}}function Mt(h){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,h instanceof Mt){this.h=h.h,tr(this,h.j),this.o=h.o,this.g=h.g,Ha(this,h.s),this.l=h.l;var x=h.i,_=new la;_.i=x.i,x.g&&(_.g=new Map(x.g),_.h=x.h),oa(this,_),this.m=h.m}else h&&(x=String(h).match(er))?(this.h=!1,tr(this,x[1]||"",!0),this.o=Wn(x[2]||""),this.g=Wn(x[3]||"",!0),Ha(this,x[4]),this.l=Wn(x[5]||"",!0),oa(this,x[6]||"",!0),this.m=Wn(x[7]||"")):(this.h=!1,this.i=new la(null,this.h))}Mt.prototype.toString=function(){var h=[],x=this.j;x&&h.push(sr(x,Dl,!0),":");var _=this.g;return(_||x=="file")&&(h.push("//"),(x=this.o)&&h.push(sr(x,Dl,!0),"@"),h.push(encodeURIComponent(String(_)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),_=this.s,_!=null&&h.push(":",String(_))),(_=this.l)&&(this.g&&_.charAt(0)!="/"&&h.push("/"),h.push(sr(_,_.charAt(0)=="/"?kf:Ml,!0))),(_=this.i.toString())&&h.push("?",_),(_=this.m)&&h.push("#",sr(_,eo)),h.join("")};function On(h){return new Mt(h)}function tr(h,x,_){h.j=_?Wn(x,!0):x,h.j&&(h.j=h.j.replace(/:$/,""))}function Ha(h,x){if(x){if(x=Number(x),isNaN(x)||0>x)throw Error("Bad port number "+x);h.s=x}else h.s=null}function oa(h,x,_){x instanceof la?(h.i=x,Lu(h.i,h.h)):(_||(x=sr(x,Of)),h.i=new la(x,h.h))}function ot(h,x,_){h.i.set(x,_)}function nr(h){return ot(h,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),h}function Wn(h,x){return h?x?decodeURI(h.replace(/%25/g,"%2525")):decodeURIComponent(h):""}function sr(h,x,_){return typeof h=="string"?(h=encodeURI(h).replace(x,Pu),_&&(h=h.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h):null}function Pu(h){return h=h.charCodeAt(0),"%"+(h>>4&15).toString(16)+(h&15).toString(16)}var Dl=/[#\/\?@]/g,Ml=/[#\?:]/g,kf=/[#\?]/g,Of=/[#\?@]/g,eo=/#/g;function la(h,x){this.h=this.g=null,this.i=h||null,this.j=!!x}function Zn(h){h.g||(h.g=new Map,h.h=0,h.i&&Mf(h.i,function(x,_){h.add(decodeURIComponent(x.replace(/\+/g," ")),_)}))}n=la.prototype,n.add=function(h,x){Zn(this),this.i=null,h=Ds(this,h);var _=this.g.get(h);return _||this.g.set(h,_=[]),_.push(x),this.h+=1,this};function ca(h,x){Zn(h),x=Ds(h,x),h.g.has(x)&&(h.i=null,h.h-=h.g.get(x).length,h.g.delete(x))}function ua(h,x){return Zn(h),x=Ds(h,x),h.g.has(x)}n.forEach=function(h,x){Zn(this),this.g.forEach(function(_,L){_.forEach(function(K){h.call(x,K,L,this)},this)},this)},n.na=function(){Zn(this);const h=Array.from(this.g.values()),x=Array.from(this.g.keys()),_=[];for(let L=0;L<x.length;L++){const K=h[L];for(let te=0;te<K.length;te++)_.push(x[L])}return _},n.V=function(h){Zn(this);let x=[];if(typeof h=="string")ua(this,h)&&(x=x.concat(this.g.get(Ds(this,h))));else{h=Array.from(this.g.values());for(let _=0;_<h.length;_++)x=x.concat(h[_])}return x},n.set=function(h,x){return Zn(this),this.i=null,h=Ds(this,h),ua(this,h)&&(this.h-=this.g.get(h).length),this.g.set(h,[x]),this.h+=1,this},n.get=function(h,x){return h?(h=this.V(h),0<h.length?String(h[0]):x):x};function kl(h,x,_){ca(h,x),0<_.length&&(h.i=null,h.g.set(Ds(h,x),w(_)),h.h+=_.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const h=[],x=Array.from(this.g.keys());for(var _=0;_<x.length;_++){var L=x[_];const te=encodeURIComponent(String(L)),fe=this.V(L);for(L=0;L<fe.length;L++){var K=te;fe[L]!==""&&(K+="="+encodeURIComponent(String(fe[L]))),h.push(K)}}return this.i=h.join("&")};function Ds(h,x){return x=String(x),h.j&&(x=x.toLowerCase()),x}function Lu(h,x){x&&!h.j&&(Zn(h),h.i=null,h.g.forEach(function(_,L){var K=L.toLowerCase();L!=K&&(ca(this,L),kl(this,K,_))},h)),h.j=x}function ar(h,x){const _=new Xn;if(f.Image){const L=new Image;L.onload=j(Jn,_,"TestLoadImage: loaded",!0,x,L),L.onerror=j(Jn,_,"TestLoadImage: error",!1,x,L),L.onabort=j(Jn,_,"TestLoadImage: abort",!1,x,L),L.ontimeout=j(Jn,_,"TestLoadImage: timeout",!1,x,L),f.setTimeout(function(){L.ontimeout&&L.ontimeout()},1e4),L.src=h}else x(!1)}function ps(h,x){const _=new Xn,L=new AbortController,K=setTimeout(()=>{L.abort(),Jn(_,"TestPingServer: timeout",!1,x)},1e4);fetch(h,{signal:L.signal}).then(te=>{clearTimeout(K),te.ok?Jn(_,"TestPingServer: ok",!0,x):Jn(_,"TestPingServer: server error",!1,x)}).catch(()=>{clearTimeout(K),Jn(_,"TestPingServer: error",!1,x)})}function Jn(h,x,_,L,K){try{K&&(K.onload=null,K.onerror=null,K.onabort=null,K.ontimeout=null),L(_)}catch{}}function ir(){this.g=new Xi}function Ms(h,x,_){const L=_||"";try{Rl(h,function(K,te){let fe=K;g(K)&&(fe=fs(K)),x.push(L+te+"="+encodeURIComponent(fe))})}catch(K){throw x.push(L+"type="+encodeURIComponent("_badmap")),K}}function Ga(h){this.l=h.Ub||null,this.j=h.eb||!1}N(Ga,El),Ga.prototype.g=function(){return new da(this.l,this.j)},Ga.prototype.i=function(h){return function(){return h}}({});function da(h,x){Tt.call(this),this.D=h,this.o=x,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}N(da,Tt),n=da.prototype,n.open=function(h,x){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=h,this.A=x,this.readyState=1,Os(this)},n.send=function(h){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const x={headers:this.u,method:this.B,credentials:this.m,cache:void 0};h&&(x.body=h),(this.D||f).fetch(new Request(this.A,x)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ks(this)),this.readyState=0},n.Sa=function(h){if(this.g&&(this.l=h,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=h.headers,this.readyState=2,Os(this)),this.g&&(this.readyState=3,Os(this),this.g)))if(this.responseType==="arraybuffer")h.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof f.ReadableStream<"u"&&"body"in h){if(this.j=h.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ol(this)}else h.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ol(h){h.j.read().then(h.Pa.bind(h)).catch(h.ga.bind(h))}n.Pa=function(h){if(this.g){if(this.o&&h.value)this.response.push(h.value);else if(!this.o){var x=h.value?h.value:new Uint8Array(0);(x=this.v.decode(x,{stream:!h.done}))&&(this.response=this.responseText+=x)}h.done?ks(this):Os(this),this.readyState==3&&Ol(this)}},n.Ra=function(h){this.g&&(this.response=this.responseText=h,ks(this))},n.Qa=function(h){this.g&&(this.response=h,ks(this))},n.ga=function(){this.g&&ks(this)};function ks(h){h.readyState=4,h.l=null,h.j=null,h.v=null,Os(h)}n.setRequestHeader=function(h,x){this.u.append(h,x)},n.getResponseHeader=function(h){return this.h&&this.h.get(h.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const h=[],x=this.h.entries();for(var _=x.next();!_.done;)_=_.value,h.push(_[0]+": "+_[1]),_=x.next();return h.join(`\r
`)};function Os(h){h.onreadystatechange&&h.onreadystatechange.call(h)}Object.defineProperty(da.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(h){this.m=h?"include":"same-origin"}});function Pl(h){let x="";return $(h,function(_,L){x+=L,x+=":",x+=_,x+=`\r
`}),x}function Yt(h,x,_){e:{for(L in _){var L=!1;break e}L=!0}L||(_=Pl(_),typeof h=="string"?_!=null&&encodeURIComponent(String(_)):ot(h,x,_))}function st(h){Tt.call(this),this.headers=new Map,this.o=h||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}N(st,Tt);var to=/^https?$/i,rr=["POST","PUT"];n=st.prototype,n.Ha=function(h){this.J=h},n.ea=function(h,x,_,L){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+h);x=x?x.toUpperCase():"GET",this.D=h,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ss.g(),this.v=this.o?_l(this.o):_l(Ss),this.g.onreadystatechange=E(this.Ea,this);try{this.B=!0,this.g.open(x,String(h),!0),this.B=!1}catch(te){Vu(this,te);return}if(h=_||"",_=new Map(this.headers),L)if(Object.getPrototypeOf(L)===Object.prototype)for(var K in L)_.set(K,L[K]);else if(typeof L.keys=="function"&&typeof L.get=="function")for(const te of L.keys())_.set(te,L.get(te));else throw Error("Unknown input type for opt_headers: "+String(L));L=Array.from(_.keys()).find(te=>te.toLowerCase()=="content-type"),K=f.FormData&&h instanceof f.FormData,!(0<=Array.prototype.indexOf.call(rr,x,void 0))||L||K||_.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[te,fe]of _)this.g.setRequestHeader(te,fe);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{or(this),this.u=!0,this.g.send(h),this.u=!1}catch(te){Vu(this,te)}};function Vu(h,x){h.h=!1,h.g&&(h.j=!0,h.g.abort(),h.j=!1),h.l=x,h.m=5,no(h),Ps(h)}function no(h){h.A||(h.A=!0,at(h,"complete"),at(h,"error"))}n.abort=function(h){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=h||7,at(this,"complete"),at(this,"abort"),Ps(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ps(this,!0)),st.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?so(this):this.bb())},n.bb=function(){so(this)};function so(h){if(h.h&&typeof d<"u"&&(!h.v[1]||es(h)!=4||h.Z()!=2)){if(h.u&&es(h)==4)dn(h.Ea,0,h);else if(at(h,"readystatechange"),es(h)==4){h.h=!1;try{const fe=h.Z();e:switch(fe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var x=!0;break e;default:x=!1}var _;if(!(_=x)){var L;if(L=fe===0){var K=String(h.D).match(er)[1]||null;!K&&f.self&&f.self.location&&(K=f.self.location.protocol.slice(0,-1)),L=!to.test(K?K.toLowerCase():"")}_=L}if(_)at(h,"complete"),at(h,"success");else{h.m=6;try{var te=2<es(h)?h.g.statusText:""}catch{te=""}h.l=te+" ["+h.Z()+"]",no(h)}}finally{Ps(h)}}}}function Ps(h,x){if(h.g){or(h);const _=h.g,L=h.v[0]?()=>{}:null;h.g=null,h.v=null,x||at(h,"ready");try{_.onreadystatechange=L}catch{}}}function or(h){h.I&&(f.clearTimeout(h.I),h.I=null)}n.isActive=function(){return!!this.g};function es(h){return h.g?h.g.readyState:0}n.Z=function(){try{return 2<es(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(h){if(this.g){var x=this.g.responseText;return h&&x.indexOf(h)==0&&(x=x.substring(h.length)),Yr(x)}};function Uu(h){try{if(!h.g)return null;if("response"in h.g)return h.g.response;switch(h.H){case"":case"text":return h.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in h.g)return h.g.mozResponseArrayBuffer}return null}catch{return null}}function Pf(h){const x={};h=(h.g&&2<=es(h)&&h.g.getAllResponseHeaders()||"").split(`\r
`);for(let L=0;L<h.length;L++){if(q(h[L]))continue;var _=C(h[L]);const K=_[0];if(_=_[1],typeof _!="string")continue;_=_.trim();const te=x[K]||[];x[K]=te,te.push(_)}F(x,function(L){return L.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function lr(h,x,_){return _&&_.internalChannelParams&&_.internalChannelParams[h]||x}function ao(h){this.Aa=0,this.i=[],this.j=new Xn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=lr("failFast",!1,h),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=lr("baseRetryDelayMs",5e3,h),this.cb=lr("retryDelaySeedMs",1e4,h),this.Wa=lr("forwardChannelMaxRetries",2,h),this.wa=lr("forwardChannelRequestTimeoutMs",2e4,h),this.pa=h&&h.xmlHttpFactory||void 0,this.Xa=h&&h.Tb||void 0,this.Ca=h&&h.useFetchStreams||!1,this.L=void 0,this.J=h&&h.supportsCrossDomainXhr||!1,this.K="",this.h=new ra(h&&h.concurrentRequestLimit),this.Da=new ir,this.P=h&&h.fastHandshake||!1,this.O=h&&h.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=h&&h.Rb||!1,h&&h.xa&&this.j.xa(),h&&h.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&h&&h.detectBufferingProxy||!1,this.ja=void 0,h&&h.longPollingTimeout&&0<h.longPollingTimeout&&(this.ja=h.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=ao.prototype,n.la=8,n.G=1,n.connect=function(h,x,_,L){xt(0),this.W=h,this.H=x||{},_&&L!==void 0&&(this.H.OSID=_,this.H.OAID=L),this.F=this.X,this.I=$u(this,null,this.W),ro(this)};function Ll(h){if(Fu(h),h.G==3){var x=h.U++,_=On(h.I);if(ot(_,"SID",h.K),ot(_,"RID",x),ot(_,"TYPE","terminate"),cr(h,_),x=new xn(h,h.j,x),x.L=2,x.v=nr(On(_)),_=!1,f.navigator&&f.navigator.sendBeacon)try{_=f.navigator.sendBeacon(x.v.toString(),"")}catch{}!_&&f.Image&&(new Image().src=x.v,_=!0),_||(x.g=Yu(x.j,null),x.g.ea(x.v)),x.F=Date.now(),Zi(x)}Gu(h)}function io(h){h.g&&(ur(h),h.g.cancel(),h.g=null)}function Fu(h){io(h),h.u&&(f.clearTimeout(h.u),h.u=null),oo(h),h.h.cancel(),h.s&&(typeof h.s=="number"&&f.clearTimeout(h.s),h.s=null)}function ro(h){if(!Xr(h.h)&&!h.s){h.s=!0;var x=h.Ga;se||H(),me||(se(),me=!0),Oe.add(x,h),h.B=0}}function Lf(h,x){return Wr(h.h)>=h.h.j-(h.s?1:0)?!1:h.s?(h.i=x.D.concat(h.i),!0):h.G==1||h.G==2||h.B>=(h.Va?0:h.Wa)?!1:(h.s=Dt(E(h.Ga,h,x),Fl(h,h.B)),h.B++,!0)}n.Ga=function(h){if(this.s)if(this.s=null,this.G==1){if(!h){this.U=Math.floor(1e5*Math.random()),h=this.U++;const K=new xn(this,this.j,h);let te=this.o;if(this.S&&(te?(te=R(te),P(te,this.S)):te=this.S),this.m!==null||this.O||(K.H=te,te=null),this.P)e:{for(var x=0,_=0;_<this.i.length;_++){t:{var L=this.i[_];if("__data__"in L.map&&(L=L.map.__data__,typeof L=="string")){L=L.length;break t}L=void 0}if(L===void 0)break;if(x+=L,4096<x){x=_;break e}if(x===4096||_===this.i.length-1){x=_+1;break e}}x=1e3}else x=1e3;x=qu(this,K,x),_=On(this.I),ot(_,"RID",h),ot(_,"CVER",22),this.D&&ot(_,"X-HTTP-Session-Id",this.D),cr(this,_),te&&(this.O?x="headers="+encodeURIComponent(String(Pl(te)))+"&"+x:this.m&&Yt(_,this.m,te)),Zr(this.h,K),this.Ua&&ot(_,"TYPE","init"),this.P?(ot(_,"$req",x),ot(_,"SID","null"),K.T=!0,ms(K,_,null)):ms(K,_,x),this.G=2}}else this.G==3&&(h?Vl(this,h):this.i.length==0||Xr(this.h)||Vl(this))};function Vl(h,x){var _;x?_=x.l:_=h.U++;const L=On(h.I);ot(L,"SID",h.K),ot(L,"RID",_),ot(L,"AID",h.T),cr(h,L),h.m&&h.o&&Yt(L,h.m,h.o),_=new xn(h,h.j,_,h.B+1),h.m===null&&(_.H=h.o),x&&(h.i=x.D.concat(h.i)),x=qu(h,_,1e3),_.I=Math.round(.5*h.wa)+Math.round(.5*h.wa*Math.random()),Zr(h.h,_),ms(_,L,x)}function cr(h,x){h.H&&$(h.H,function(_,L){ot(x,L,_)}),h.l&&Rl({},function(_,L){ot(x,L,_)})}function qu(h,x,_){_=Math.min(h.i.length,_);var L=h.l?E(h.l.Na,h.l,h):null;e:{var K=h.i;let te=-1;for(;;){const fe=["count="+_];te==-1?0<_?(te=K[0].g,fe.push("ofs="+te)):te=0:fe.push("ofs="+te);let Ke=!0;for(let Ut=0;Ut<_;Ut++){let Xe=K[Ut].g;const Qt=K[Ut].map;if(Xe-=te,0>Xe)te=Math.max(0,K[Ut].g-100),Ke=!1;else try{Ms(Qt,fe,"req"+Xe+"_")}catch{L&&L(Qt)}}if(Ke){L=fe.join("&");break e}}}return h=h.i.splice(0,_),x.D=h,L}function Bu(h){if(!h.g&&!h.u){h.Y=1;var x=h.Fa;se||H(),me||(se(),me=!0),Oe.add(x,h),h.v=0}}function Ul(h){return h.g||h.u||3<=h.v?!1:(h.Y++,h.u=Dt(E(h.Fa,h),Fl(h,h.v)),h.v++,!0)}n.Fa=function(){if(this.u=null,zu(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var h=2*this.R;this.j.info("BP detection timer enabled: "+h),this.A=Dt(E(this.ab,this),h)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,xt(10),io(this),zu(this))};function ur(h){h.A!=null&&(f.clearTimeout(h.A),h.A=null)}function zu(h){h.g=new xn(h,h.j,"rpc",h.Y),h.m===null&&(h.g.H=h.o),h.g.O=0;var x=On(h.qa);ot(x,"RID","rpc"),ot(x,"SID",h.K),ot(x,"AID",h.T),ot(x,"CI",h.F?"0":"1"),!h.F&&h.ja&&ot(x,"TO",h.ja),ot(x,"TYPE","xmlhttp"),cr(h,x),h.m&&h.o&&Yt(x,h.m,h.o),h.L&&(h.g.I=h.L);var _=h.g;h=h.ia,_.L=1,_.v=nr(On(x)),_.m=null,_.P=!0,ia(_,h)}n.Za=function(){this.C!=null&&(this.C=null,io(this),Ul(this),xt(19))};function oo(h){h.C!=null&&(f.clearTimeout(h.C),h.C=null)}function Hu(h,x){var _=null;if(h.g==x){oo(h),ur(h),h.g=null;var L=2}else if(Sl(h.h,x))_=x.D,bn(h.h,x),L=1;else return;if(h.G!=0){if(x.o)if(L==1){_=x.m?x.m.length:0,x=Date.now()-x.F;var K=h.B;L=Ua(),at(L,new Vt(L,_)),ro(h)}else Bu(h);else if(K=x.s,K==3||K==0&&0<x.X||!(L==1&&Lf(h,x)||L==2&&Ul(h)))switch(_&&0<_.length&&(x=h.h,x.i=x.i.concat(_)),K){case 1:ha(h,5);break;case 4:ha(h,10);break;case 3:ha(h,6);break;default:ha(h,2)}}}function Fl(h,x){let _=h.Ta+Math.floor(Math.random()*h.cb);return h.isActive()||(_*=2),_*x}function ha(h,x){if(h.j.info("Error code "+x),x==2){var _=E(h.fb,h),L=h.Xa;const K=!L;L=new Mt(L||"//www.google.com/images/cleardot.gif"),f.location&&f.location.protocol=="http"||tr(L,"https"),nr(L),K?ar(L.toString(),_):ps(L.toString(),_)}else xt(2);h.G=0,h.l&&h.l.sa(x),Gu(h),Fu(h)}n.fb=function(h){h?(this.j.info("Successfully pinged google.com"),xt(2)):(this.j.info("Failed to ping google.com"),xt(1))};function Gu(h){if(h.G=0,h.ka=[],h.l){const x=Il(h.h);(x.length!=0||h.i.length!=0)&&(T(h.ka,x),T(h.ka,h.i),h.h.i.length=0,w(h.i),h.i.length=0),h.l.ra()}}function $u(h,x,_){var L=_ instanceof Mt?On(_):new Mt(_);if(L.g!="")x&&(L.g=x+"."+L.g),Ha(L,L.s);else{var K=f.location;L=K.protocol,x=x?x+"."+K.hostname:K.hostname,K=+K.port;var te=new Mt(null);L&&tr(te,L),x&&(te.g=x),K&&Ha(te,K),_&&(te.l=_),L=te}return _=h.D,x=h.ya,_&&x&&ot(L,_,x),ot(L,"VER",h.la),cr(h,L),L}function Yu(h,x,_){if(x&&!h.J)throw Error("Can't create secondary domain capable XhrIo object.");return x=h.Ca&&!h.pa?new st(new Ga({eb:_})):new st(h.pa),x.Ha(h.J),x}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Qu(){}n=Qu.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function lo(){}lo.prototype.g=function(h,x){return new Nn(h,x)};function Nn(h,x){Tt.call(this),this.g=new ao(x),this.l=h,this.h=x&&x.messageUrlParams||null,h=x&&x.messageHeaders||null,x&&x.clientProtocolHeaderRequired&&(h?h["X-Client-Protocol"]="webchannel":h={"X-Client-Protocol":"webchannel"}),this.g.o=h,h=x&&x.initMessageHeaders||null,x&&x.messageContentType&&(h?h["X-WebChannel-Content-Type"]=x.messageContentType:h={"X-WebChannel-Content-Type":x.messageContentType}),x&&x.va&&(h?h["X-WebChannel-Client-Profile"]=x.va:h={"X-WebChannel-Client-Profile":x.va}),this.g.S=h,(h=x&&x.Sb)&&!q(h)&&(this.g.m=h),this.v=x&&x.supportsCrossDomainXhr||!1,this.u=x&&x.sendRawJson||!1,(x=x&&x.httpSessionIdParam)&&!q(x)&&(this.g.D=x,h=this.h,h!==null&&x in h&&(h=this.h,x in h&&delete h[x])),this.j=new Ls(this)}N(Nn,Tt),Nn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Nn.prototype.close=function(){Ll(this.g)},Nn.prototype.o=function(h){var x=this.g;if(typeof h=="string"){var _={};_.__data__=h,h=_}else this.u&&(_={},_.__data__=fs(h),h=_);x.i.push(new Ou(x.Ya++,h)),x.G==3&&ro(x)},Nn.prototype.N=function(){this.g.l=null,delete this.j,Ll(this.g),delete this.g,Nn.aa.N.call(this)};function Ku(h){sa.call(this),h.__headers__&&(this.headers=h.__headers__,this.statusCode=h.__status__,delete h.__headers__,delete h.__status__);var x=h.__sm__;if(x){e:{for(const _ in x){h=_;break e}h=void 0}(this.i=h)&&(h=this.i,x=x!==null&&h in x?x[h]:void 0),this.data=x}else this.data=h}N(Ku,sa);function Xu(){jl.call(this),this.status=1}N(Xu,jl);function Ls(h){this.g=h}N(Ls,Qu),Ls.prototype.ua=function(){at(this.g,"a")},Ls.prototype.ta=function(h){at(this.g,new Ku(h))},Ls.prototype.sa=function(h){at(this.g,new Xu)},Ls.prototype.ra=function(){at(this.g,"b")},lo.prototype.createWebChannel=lo.prototype.g,Nn.prototype.send=Nn.prototype.o,Nn.prototype.open=Nn.prototype.m,Nn.prototype.close=Nn.prototype.close,QT=function(){return new lo},YT=function(){return Ua()},$T=ws,dg={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ba.NO_ERROR=0,Ba.TIMEOUT=8,Ba.HTTP_ERROR=6,uh=Ba,aa.COMPLETE="complete",GT=aa,Tl.EventType=na,na.OPEN="a",na.CLOSE="b",na.ERROR="c",na.MESSAGE="d",Tt.prototype.listen=Tt.prototype.K,Rc=Tl,st.prototype.listenOnce=st.prototype.L,st.prototype.getLastError=st.prototype.Ka,st.prototype.getLastErrorCode=st.prototype.Ba,st.prototype.getStatus=st.prototype.Z,st.prototype.getResponseJson=st.prototype.Oa,st.prototype.getResponseText=st.prototype.oa,st.prototype.send=st.prototype.ea,st.prototype.setWithCredentials=st.prototype.Ha,HT=st}).apply(typeof Zd<"u"?Zd:typeof self<"u"?self:typeof window<"u"?window:{});const rE="@firebase/firestore",oE="4.7.17";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}pn.UNAUTHENTICATED=new pn(null),pn.GOOGLE_CREDENTIALS=new pn("google-credentials-uid"),pn.FIRST_PARTY=new pn("first-party-uid"),pn.MOCK_USER=new pn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dl="11.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kr=new lu("@firebase/firestore");function Fo(){return kr.logLevel}function ye(n,...e){if(kr.logLevel<=Ye.DEBUG){const t=e.map(Xg);kr.debug(`Firestore (${dl}): ${n}`,...t)}}function ka(n,...e){if(kr.logLevel<=Ye.ERROR){const t=e.map(Xg);kr.error(`Firestore (${dl}): ${n}`,...t)}}function el(n,...e){if(kr.logLevel<=Ye.WARN){const t=e.map(Xg);kr.warn(`Firestore (${dl}): ${n}`,...t)}}function Xg(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function je(n,e,t){let i="Unexpected state";typeof e=="string"?i=e:t=e,KT(n,i,t)}function KT(n,e,t){let i=`FIRESTORE (${dl}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{i+=" CONTEXT: "+JSON.stringify(t)}catch{i+=" CONTEXT: "+t}throw ka(i),new Error(i)}function Je(n,e,t,i){let o="Unexpected state";typeof t=="string"?o=t:i=t,n||KT(e,o,i)}function ke(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ie={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ge extends hs{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ks{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XT{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class V1{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(pn.UNAUTHENTICATED))}shutdown(){}}class U1{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class F1{constructor(e){this.t=e,this.currentUser=pn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Je(this.o===void 0,42304);let i=this.i;const o=p=>this.i!==i?(i=this.i,t(p)):Promise.resolve();let c=new Ks;this.o=()=>{this.i++,this.currentUser=this.u(),c.resolve(),c=new Ks,e.enqueueRetryable(()=>o(this.currentUser))};const d=()=>{const p=c;e.enqueueRetryable(async()=>{await p.promise,await o(this.currentUser)})},f=p=>{ye("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=p,this.o&&(this.auth.addAuthTokenListener(this.o),d())};this.t.onInit(p=>f(p)),setTimeout(()=>{if(!this.auth){const p=this.t.getImmediate({optional:!0});p?f(p):(ye("FirebaseAuthCredentialsProvider","Auth not yet detected"),c.resolve(),c=new Ks)}},0),d()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(ye("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(Je(typeof i.accessToken=="string",31837,{l:i}),new XT(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Je(e===null||typeof e=="string",2055,{h:e}),new pn(e)}}class q1{constructor(e,t,i){this.P=e,this.T=t,this.I=i,this.type="FirstParty",this.user=pn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class B1{constructor(e,t,i){this.P=e,this.T=t,this.I=i}getToken(){return Promise.resolve(new q1(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(pn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class lE{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class z1{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Dn(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Je(this.o===void 0,3512);const i=c=>{c.error!=null&&ye("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${c.error.message}`);const d=c.token!==this.m;return this.m=c.token,ye("FirebaseAppCheckTokenProvider",`Received ${d?"new":"existing"} token.`),d?t(c.token):Promise.resolve()};this.o=c=>{e.enqueueRetryable(()=>i(c))};const o=c=>{ye("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=c,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(c=>o(c)),setTimeout(()=>{if(!this.appCheck){const c=this.V.getImmediate({optional:!0});c?o(c):ye("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new lE(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Je(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new lE(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H1(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WT(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZT{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const o=H1(40);for(let c=0;c<o.length;++c)i.length<20&&o[c]<t&&(i+=e.charAt(o[c]%62))}return i}}function qe(n,e){return n<e?-1:n>e?1:0}function hg(n,e){let t=0;for(;t<n.length&&t<e.length;){const i=n.codePointAt(t),o=e.codePointAt(t);if(i!==o){if(i<128&&o<128)return qe(i,o);{const c=WT(),d=G1(c.encode(cE(n,t)),c.encode(cE(e,t)));return d!==0?d:qe(i,o)}}t+=i>65535?2:1}return qe(n.length,e.length)}function cE(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function G1(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return qe(n[t],e[t]);return qe(n.length,e.length)}function tl(n,e,t){return n.length===e.length&&n.every((i,o)=>t(i,e[o]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uE=-62135596800,dE=1e6;class zt{static now(){return zt.fromMillis(Date.now())}static fromDate(e){return zt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor((e-1e3*t)*dE);return new zt(t,i)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ge(ie.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ge(ie.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<uE)throw new ge(ie.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ge(ie.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/dE}_compareTo(e){return this.seconds===e.seconds?qe(this.nanoseconds,e.nanoseconds):qe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-uE;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Se{static fromTimestamp(e){return new Se(e)}static min(){return new Se(new zt(0,0))}static max(){return new Se(new zt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hE="__name__";class Gs{constructor(e,t,i){t===void 0?t=0:t>e.length&&je(637,{offset:t,range:e.length}),i===void 0?i=e.length-t:i>e.length-t&&je(1746,{length:i,range:e.length-t}),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return Gs.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Gs?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let o=0;o<i;o++){const c=Gs.compareSegments(e.get(o),t.get(o));if(c!==0)return c}return qe(e.length,t.length)}static compareSegments(e,t){const i=Gs.isNumericId(e),o=Gs.isNumericId(t);return i&&!o?-1:!i&&o?1:i&&o?Gs.extractNumericId(e).compare(Gs.extractNumericId(t)):hg(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ei.fromString(e.substring(4,e.length-2))}}class ft extends Gs{construct(e,t,i){return new ft(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new ge(ie.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(o=>o.length>0))}return new ft(t)}static emptyPath(){return new ft([])}}const $1=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class on extends Gs{construct(e,t,i){return new on(e,t,i)}static isValidIdentifier(e){return $1.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),on.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===hE}static keyField(){return new on([hE])}static fromServerFormat(e){const t=[];let i="",o=0;const c=()=>{if(i.length===0)throw new ge(ie.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let d=!1;for(;o<e.length;){const f=e[o];if(f==="\\"){if(o+1===e.length)throw new ge(ie.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const p=e[o+1];if(p!=="\\"&&p!=="."&&p!=="`")throw new ge(ie.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=p,o+=2}else f==="`"?(d=!d,o++):f!=="."||d?(i+=f,o++):(c(),o++)}if(c(),d)throw new ge(ie.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new on(t)}static emptyPath(){return new on([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _e{constructor(e){this.path=e}static fromPath(e){return new _e(ft.fromString(e))}static fromName(e){return new _e(ft.fromString(e).popFirst(5))}static empty(){return new _e(ft.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ft.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ft.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new _e(new ft(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xc=-1;function Y1(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,o=Se.fromTimestamp(i===1e9?new zt(t+1,0):new zt(t,i));return new Ci(o,_e.empty(),e)}function Q1(n){return new Ci(n.readTime,n.key,Xc)}class Ci{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new Ci(Se.min(),_e.empty(),Xc)}static max(){return new Ci(Se.max(),_e.empty(),Xc)}}function K1(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=_e.comparator(n.documentKey,e.documentKey),t!==0?t:qe(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X1="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class W1{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hl(n){if(n.code!==ie.FAILED_PRECONDITION||n.message!==X1)throw n;ye("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oe{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&je(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new oe((i,o)=>{this.nextCallback=c=>{this.wrapSuccess(e,c).next(i,o)},this.catchCallback=c=>{this.wrapFailure(t,c).next(i,o)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof oe?t:oe.resolve(t)}catch(t){return oe.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):oe.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):oe.reject(t)}static resolve(e){return new oe((t,i)=>{t(e)})}static reject(e){return new oe((t,i)=>{i(e)})}static waitFor(e){return new oe((t,i)=>{let o=0,c=0,d=!1;e.forEach(f=>{++o,f.next(()=>{++c,d&&c===o&&t()},p=>i(p))}),d=!0,c===o&&t()})}static or(e){let t=oe.resolve(!1);for(const i of e)t=t.next(o=>o?oe.resolve(o):i());return t}static forEach(e,t){const i=[];return e.forEach((o,c)=>{i.push(t.call(this,o,c))}),this.waitFor(i)}static mapArray(e,t){return new oe((i,o)=>{const c=e.length,d=new Array(c);let f=0;for(let p=0;p<c;p++){const g=p;t(e[g]).next(y=>{d[g]=y,++f,f===c&&i(d)},y=>o(y))}})}static doWhile(e,t){return new oe((i,o)=>{const c=()=>{e()===!0?t().next(()=>{c()},o):i()};c()})}}function Z1(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function fl(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zh{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.ue(i),this.ce=i=>t.writeSequenceNumber(i))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ce&&this.ce(e),e}}Zh.le=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wg=-1;function mu(n){return n==null}function Ch(n){return n===0&&1/n==-1/0}function J1(n){return typeof n=="number"&&Number.isInteger(n)&&!Ch(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JT="";function eD(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=fE(e)),e=tD(n.get(t),e);return fE(e)}function tD(n,e){let t=e;const i=n.length;for(let o=0;o<i;o++){const c=n.charAt(o);switch(c){case"\0":t+="";break;case JT:t+="";break;default:t+=c}}return t}function fE(n){return n+JT+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mE(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Fi(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function ej(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _t{constructor(e,t){this.comparator=e,this.root=t||rn.EMPTY}insert(e,t){return new _t(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,rn.BLACK,null,null))}remove(e){return new _t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,rn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const o=this.comparator(e,i.key);if(o===0)return t+i.left.size;o<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){const e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Jd(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Jd(this.root,e,this.comparator,!1)}getReverseIterator(){return new Jd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Jd(this.root,e,this.comparator,!0)}}class Jd{constructor(e,t,i,o){this.isReverse=o,this.nodeStack=[];let c=1;for(;!e.isEmpty();)if(c=t?i(e.key,t):1,t&&o&&(c*=-1),c<0)e=this.isReverse?e.left:e.right;else{if(c===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class rn{constructor(e,t,i,o,c){this.key=e,this.value=t,this.color=i??rn.RED,this.left=o??rn.EMPTY,this.right=c??rn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,o,c){return new rn(e??this.key,t??this.value,i??this.color,o??this.left,c??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let o=this;const c=i(e,o.key);return o=c<0?o.copy(null,null,null,o.left.insert(e,t,i),null):c===0?o.copy(null,t,null,null,null):o.copy(null,null,null,null,o.right.insert(e,t,i)),o.fixUp()}removeMin(){if(this.left.isEmpty())return rn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,o=this;if(t(e,o.key)<0)o.left.isEmpty()||o.left.isRed()||o.left.left.isRed()||(o=o.moveRedLeft()),o=o.copy(null,null,null,o.left.remove(e,t),null);else{if(o.left.isRed()&&(o=o.rotateRight()),o.right.isEmpty()||o.right.isRed()||o.right.left.isRed()||(o=o.moveRedRight()),t(e,o.key)===0){if(o.right.isEmpty())return rn.EMPTY;i=o.right.min(),o=o.copy(i.key,i.value,null,null,o.right.removeMin())}o=o.copy(null,null,null,null,o.right.remove(e,t))}return o.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,rn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,rn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw je(43730,{key:this.key,value:this.value});if(this.right.isRed())throw je(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw je(27949);return e+(this.isRed()?0:1)}}rn.EMPTY=null,rn.RED=!0,rn.BLACK=!1;rn.EMPTY=new class{constructor(){this.size=0}get key(){throw je(57766)}get value(){throw je(16141)}get color(){throw je(16727)}get left(){throw je(29726)}get right(){throw je(36894)}copy(e,t,i,o,c){return this}insert(e,t,i){return new rn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht{constructor(e){this.comparator=e,this.data=new _t(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const o=i.getNext();if(this.comparator(o.key,e[1])>=0)return;t(o.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new pE(this.data.getIterator())}getIteratorFrom(e){return new pE(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof Ht)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const o=t.getNext().key,c=i.getNext().key;if(this.comparator(o,c)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ht(this.comparator);return t.data=e,t}}class pE{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{constructor(e){this.fields=e,e.sort(on.comparator)}static empty(){return new zn([])}unionWith(e){let t=new Ht(on.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new zn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return tl(this.fields,e.fields,(t,i)=>t.isEqual(i))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tj extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(o){try{return atob(o)}catch(c){throw typeof DOMException<"u"&&c instanceof DOMException?new tj("Invalid base64 string: "+c):c}}(e);return new un(t)}static fromUint8Array(e){const t=function(o){let c="";for(let d=0;d<o.length;++d)c+=String.fromCharCode(o[d]);return c}(e);return new un(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const i=new Uint8Array(t.length);for(let o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return qe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}un.EMPTY_BYTE_STRING=new un("");const nD=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function wi(n){if(Je(!!n,39018),typeof n=="string"){let e=0;const t=nD.exec(n);if(Je(!!t,46558,{timestamp:n}),t[1]){let o=t[1];o=(o+"000000000").substr(0,9),e=Number(o)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:It(n.seconds),nanos:It(n.nanos)}}function It(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Si(n){return typeof n=="string"?un.fromBase64String(n):un.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nj="server_timestamp",sj="__type__",aj="__previous_value__",ij="__local_write_time__";function Zg(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[sj])===null||t===void 0?void 0:t.stringValue)===nj}function Jh(n){const e=n.mapValue.fields[aj];return Zg(e)?Jh(e):e}function Wc(n){const e=wi(n.mapValue.fields[ij].timestampValue);return new zt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sD{constructor(e,t,i,o,c,d,f,p,g,y){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=o,this.ssl=c,this.forceLongPolling=d,this.autoDetectLongPolling=f,this.longPollingOptions=p,this.useFetchStreams=g,this.isUsingEmulator=y}}const wh="(default)";class Zc{constructor(e,t){this.projectId=e,this.database=t||wh}static empty(){return new Zc("","")}get isDefaultDatabase(){return this.database===wh}isEqual(e){return e instanceof Zc&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rj="__type__",aD="__max__",eh={mapValue:{}},oj="__vector__",Sh="value";function Ii(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Zg(n)?4:rD(n)?9007199254740991:iD(n)?10:11:je(28295,{value:n})}function Ws(n,e){if(n===e)return!0;const t=Ii(n);if(t!==Ii(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Wc(n).isEqual(Wc(e));case 3:return function(o,c){if(typeof o.timestampValue=="string"&&typeof c.timestampValue=="string"&&o.timestampValue.length===c.timestampValue.length)return o.timestampValue===c.timestampValue;const d=wi(o.timestampValue),f=wi(c.timestampValue);return d.seconds===f.seconds&&d.nanos===f.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(o,c){return Si(o.bytesValue).isEqual(Si(c.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(o,c){return It(o.geoPointValue.latitude)===It(c.geoPointValue.latitude)&&It(o.geoPointValue.longitude)===It(c.geoPointValue.longitude)}(n,e);case 2:return function(o,c){if("integerValue"in o&&"integerValue"in c)return It(o.integerValue)===It(c.integerValue);if("doubleValue"in o&&"doubleValue"in c){const d=It(o.doubleValue),f=It(c.doubleValue);return d===f?Ch(d)===Ch(f):isNaN(d)&&isNaN(f)}return!1}(n,e);case 9:return tl(n.arrayValue.values||[],e.arrayValue.values||[],Ws);case 10:case 11:return function(o,c){const d=o.mapValue.fields||{},f=c.mapValue.fields||{};if(mE(d)!==mE(f))return!1;for(const p in d)if(d.hasOwnProperty(p)&&(f[p]===void 0||!Ws(d[p],f[p])))return!1;return!0}(n,e);default:return je(52216,{left:n})}}function Jc(n,e){return(n.values||[]).find(t=>Ws(t,e))!==void 0}function nl(n,e){if(n===e)return 0;const t=Ii(n),i=Ii(e);if(t!==i)return qe(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return qe(n.booleanValue,e.booleanValue);case 2:return function(c,d){const f=It(c.integerValue||c.doubleValue),p=It(d.integerValue||d.doubleValue);return f<p?-1:f>p?1:f===p?0:isNaN(f)?isNaN(p)?0:-1:1}(n,e);case 3:return gE(n.timestampValue,e.timestampValue);case 4:return gE(Wc(n),Wc(e));case 5:return hg(n.stringValue,e.stringValue);case 6:return function(c,d){const f=Si(c),p=Si(d);return f.compareTo(p)}(n.bytesValue,e.bytesValue);case 7:return function(c,d){const f=c.split("/"),p=d.split("/");for(let g=0;g<f.length&&g<p.length;g++){const y=qe(f[g],p[g]);if(y!==0)return y}return qe(f.length,p.length)}(n.referenceValue,e.referenceValue);case 8:return function(c,d){const f=qe(It(c.latitude),It(d.latitude));return f!==0?f:qe(It(c.longitude),It(d.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return vE(n.arrayValue,e.arrayValue);case 10:return function(c,d){var f,p,g,y;const b=c.fields||{},E=d.fields||{},j=(f=b[Sh])===null||f===void 0?void 0:f.arrayValue,N=(p=E[Sh])===null||p===void 0?void 0:p.arrayValue,w=qe(((g=j?.values)===null||g===void 0?void 0:g.length)||0,((y=N?.values)===null||y===void 0?void 0:y.length)||0);return w!==0?w:vE(j,N)}(n.mapValue,e.mapValue);case 11:return function(c,d){if(c===eh.mapValue&&d===eh.mapValue)return 0;if(c===eh.mapValue)return 1;if(d===eh.mapValue)return-1;const f=c.fields||{},p=Object.keys(f),g=d.fields||{},y=Object.keys(g);p.sort(),y.sort();for(let b=0;b<p.length&&b<y.length;++b){const E=hg(p[b],y[b]);if(E!==0)return E;const j=nl(f[p[b]],g[y[b]]);if(j!==0)return j}return qe(p.length,y.length)}(n.mapValue,e.mapValue);default:throw je(23264,{Pe:t})}}function gE(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return qe(n,e);const t=wi(n),i=wi(e),o=qe(t.seconds,i.seconds);return o!==0?o:qe(t.nanos,i.nanos)}function vE(n,e){const t=n.values||[],i=e.values||[];for(let o=0;o<t.length&&o<i.length;++o){const c=nl(t[o],i[o]);if(c)return c}return qe(t.length,i.length)}function sl(n){return fg(n)}function fg(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const i=wi(t);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Si(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return _e.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let i="[",o=!0;for(const c of t.values||[])o?o=!1:i+=",",i+=fg(c);return i+"]"}(n.arrayValue):"mapValue"in n?function(t){const i=Object.keys(t.fields||{}).sort();let o="{",c=!0;for(const d of i)c?c=!1:o+=",",o+=`${d}:${fg(t.fields[d])}`;return o+"}"}(n.mapValue):je(61005,{value:n})}function dh(n){switch(Ii(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Jh(n);return e?16+dh(e):16;case 5:return 2*n.stringValue.length;case 6:return Si(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(i){return(i.values||[]).reduce((o,c)=>o+dh(c),0)}(n.arrayValue);case 10:case 11:return function(i){let o=0;return Fi(i.fields,(c,d)=>{o+=c.length+dh(d)}),o}(n.mapValue);default:throw je(13486,{value:n})}}function yE(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function mg(n){return!!n&&"integerValue"in n}function Jg(n){return!!n&&"arrayValue"in n}function xE(n){return!!n&&"nullValue"in n}function bE(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function hh(n){return!!n&&"mapValue"in n}function iD(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[rj])===null||t===void 0?void 0:t.stringValue)===oj}function Lc(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Fi(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=Lc(i)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Lc(n.arrayValue.values[t]);return e}return Object.assign({},n)}function rD(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===aD}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jn{constructor(e){this.value=e}static empty(){return new jn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!hh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Lc(t)}setAll(e){let t=on.emptyPath(),i={},o=[];e.forEach((d,f)=>{if(!t.isImmediateParentOf(f)){const p=this.getFieldsMap(t);this.applyChanges(p,i,o),i={},o=[],t=f.popLast()}d?i[f.lastSegment()]=Lc(d):o.push(f.lastSegment())});const c=this.getFieldsMap(t);this.applyChanges(c,i,o)}delete(e){const t=this.field(e.popLast());hh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ws(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let o=t.mapValue.fields[e.get(i)];hh(o)&&o.mapValue.fields||(o={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=o),t=o}return t.mapValue.fields}applyChanges(e,t,i){Fi(t,(o,c)=>e[o]=c);for(const o of i)delete e[o]}clone(){return new jn(Lc(this.value))}}function lj(n){const e=[];return Fi(n.fields,(t,i)=>{const o=new on([t]);if(hh(i)){const c=lj(i.mapValue).fields;if(c.length===0)e.push(o);else for(const d of c)e.push(o.child(d))}else e.push(o)}),new zn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jt{constructor(e,t,i,o,c,d,f){this.key=e,this.documentType=t,this.version=i,this.readTime=o,this.createTime=c,this.data=d,this.documentState=f}static newInvalidDocument(e){return new Jt(e,0,Se.min(),Se.min(),Se.min(),jn.empty(),0)}static newFoundDocument(e,t,i,o){return new Jt(e,1,t,Se.min(),i,o,0)}static newNoDocument(e,t){return new Jt(e,2,t,Se.min(),Se.min(),jn.empty(),0)}static newUnknownDocument(e,t){return new Jt(e,3,t,Se.min(),Se.min(),jn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Se.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=jn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=jn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Se.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Jt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Jt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ih{constructor(e,t){this.position=e,this.inclusive=t}}function NE(n,e,t){let i=0;for(let o=0;o<n.position.length;o++){const c=e[o],d=n.position[o];if(c.field.isKeyField()?i=_e.comparator(_e.fromName(d.referenceValue),t.key):i=nl(d,t.data.field(c.field)),c.dir==="desc"&&(i*=-1),i!==0)break}return i}function EE(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ws(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eu{constructor(e,t="asc"){this.field=e,this.dir=t}}function oD(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cj{}class Lt extends cj{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new cD(e,t,i):t==="array-contains"?new hD(e,i):t==="in"?new fD(e,i):t==="not-in"?new mD(e,i):t==="array-contains-any"?new pD(e,i):new Lt(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new uD(e,i):new dD(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(nl(t,this.value)):t!==null&&Ii(this.value)===Ii(t)&&this.matchesComparison(nl(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return je(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class js extends cj{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new js(e,t)}matches(e){return uj(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function uj(n){return n.op==="and"}function dj(n){return lD(n)&&uj(n)}function lD(n){for(const e of n.filters)if(e instanceof js)return!1;return!0}function pg(n){if(n instanceof Lt)return n.field.canonicalString()+n.op.toString()+sl(n.value);if(dj(n))return n.filters.map(e=>pg(e)).join(",");{const e=n.filters.map(t=>pg(t)).join(",");return`${n.op}(${e})`}}function hj(n,e){return n instanceof Lt?function(i,o){return o instanceof Lt&&i.op===o.op&&i.field.isEqual(o.field)&&Ws(i.value,o.value)}(n,e):n instanceof js?function(i,o){return o instanceof js&&i.op===o.op&&i.filters.length===o.filters.length?i.filters.reduce((c,d,f)=>c&&hj(d,o.filters[f]),!0):!1}(n,e):void je(19439)}function fj(n){return n instanceof Lt?function(t){return`${t.field.canonicalString()} ${t.op} ${sl(t.value)}`}(n):n instanceof js?function(t){return t.op.toString()+" {"+t.getFilters().map(fj).join(" ,")+"}"}(n):"Filter"}class cD extends Lt{constructor(e,t,i){super(e,t,i),this.key=_e.fromName(i.referenceValue)}matches(e){const t=_e.comparator(e.key,this.key);return this.matchesComparison(t)}}class uD extends Lt{constructor(e,t){super(e,"in",t),this.keys=mj("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class dD extends Lt{constructor(e,t){super(e,"not-in",t),this.keys=mj("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function mj(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>_e.fromName(i.referenceValue))}class hD extends Lt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Jg(t)&&Jc(t.arrayValue,this.value)}}class fD extends Lt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Jc(this.value.arrayValue,t)}}class mD extends Lt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Jc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Jc(this.value.arrayValue,t)}}class pD extends Lt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Jg(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>Jc(this.value.arrayValue,i))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gD{constructor(e,t=null,i=[],o=[],c=null,d=null,f=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=o,this.limit=c,this.startAt=d,this.endAt=f,this.Ie=null}}function _E(n,e=null,t=[],i=[],o=null,c=null,d=null){return new gD(n,e,t,i,o,c,d)}function ev(n){const e=ke(n);if(e.Ie===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>pg(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(c){return c.field.canonicalString()+c.dir}(i)).join(","),mu(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>sl(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>sl(i)).join(",")),e.Ie=t}return e.Ie}function tv(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!oD(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!hj(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!EE(n.startAt,e.startAt)&&EE(n.endAt,e.endAt)}function gg(n){return _e.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ml{constructor(e,t=null,i=[],o=[],c=null,d="F",f=null,p=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=o,this.limit=c,this.limitType=d,this.startAt=f,this.endAt=p,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function vD(n,e,t,i,o,c,d,f){return new ml(n,e,t,i,o,c,d,f)}function ef(n){return new ml(n)}function TE(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function pj(n){return n.collectionGroup!==null}function Vc(n){const e=ke(n);if(e.Ee===null){e.Ee=[];const t=new Set;for(const c of e.explicitOrderBy)e.Ee.push(c),t.add(c.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(d){let f=new Ht(on.comparator);return d.filters.forEach(p=>{p.getFlattenedFilters().forEach(g=>{g.isInequality()&&(f=f.add(g.field))})}),f})(e).forEach(c=>{t.has(c.canonicalString())||c.isKeyField()||e.Ee.push(new eu(c,i))}),t.has(on.keyField().canonicalString())||e.Ee.push(new eu(on.keyField(),i))}return e.Ee}function Xs(n){const e=ke(n);return e.de||(e.de=yD(e,Vc(n))),e.de}function yD(n,e){if(n.limitType==="F")return _E(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(o=>{const c=o.dir==="desc"?"asc":"desc";return new eu(o.field,c)});const t=n.endAt?new Ih(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new Ih(n.startAt.position,n.startAt.inclusive):null;return _E(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function vg(n,e){const t=n.filters.concat([e]);return new ml(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Rh(n,e,t){return new ml(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function tf(n,e){return tv(Xs(n),Xs(e))&&n.limitType===e.limitType}function gj(n){return`${ev(Xs(n))}|lt:${n.limitType}`}function qo(n){return`Query(target=${function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map(o=>fj(o)).join(", ")}]`),mu(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map(o=>function(d){return`${d.field.canonicalString()} (${d.dir})`}(o)).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(o=>sl(o)).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(o=>sl(o)).join(",")),`Target(${i})`}(Xs(n))}; limitType=${n.limitType})`}function nf(n,e){return e.isFoundDocument()&&function(i,o){const c=o.key.path;return i.collectionGroup!==null?o.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(c):_e.isDocumentKey(i.path)?i.path.isEqual(c):i.path.isImmediateParentOf(c)}(n,e)&&function(i,o){for(const c of Vc(i))if(!c.field.isKeyField()&&o.data.field(c.field)===null)return!1;return!0}(n,e)&&function(i,o){for(const c of i.filters)if(!c.matches(o))return!1;return!0}(n,e)&&function(i,o){return!(i.startAt&&!function(d,f,p){const g=NE(d,f,p);return d.inclusive?g<=0:g<0}(i.startAt,Vc(i),o)||i.endAt&&!function(d,f,p){const g=NE(d,f,p);return d.inclusive?g>=0:g>0}(i.endAt,Vc(i),o))}(n,e)}function xD(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function vj(n){return(e,t)=>{let i=!1;for(const o of Vc(n)){const c=bD(o,e,t);if(c!==0)return c;i=i||o.field.isKeyField()}return 0}}function bD(n,e,t){const i=n.field.isKeyField()?_e.comparator(e.key,t.key):function(c,d,f){const p=d.data.field(c),g=f.data.field(c);return p!==null&&g!==null?nl(p,g):je(42886)}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return je(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qr{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[o,c]of i)if(this.equalsFn(o,e))return c}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),o=this.inner[i];if(o===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let c=0;c<o.length;c++)if(this.equalsFn(o[c][0],e))return void(o[c]=[e,t]);o.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return i.length===1?delete this.inner[t]:i.splice(o,1),this.innerSize--,!0;return!1}forEach(e){Fi(this.inner,(t,i)=>{for(const[o,c]of i)e(o,c)})}isEmpty(){return ej(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ND=new _t(_e.comparator);function Oa(){return ND}const yj=new _t(_e.comparator);function Dc(...n){let e=yj;for(const t of n)e=e.insert(t.key,t);return e}function xj(n){let e=yj;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function Sr(){return Uc()}function bj(){return Uc()}function Uc(){return new qr(n=>n.toString(),(n,e)=>n.isEqual(e))}const ED=new _t(_e.comparator),_D=new Ht(_e.comparator);function Qe(...n){let e=_D;for(const t of n)e=e.add(t);return e}const TD=new Ht(qe);function jD(){return TD}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nv(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ch(e)?"-0":e}}function Nj(n){return{integerValue:""+n}}function AD(n,e){return J1(e)?Nj(e):nv(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sf{constructor(){this._=void 0}}function CD(n,e,t){return n instanceof tu?function(o,c){const d={fields:{[sj]:{stringValue:nj},[ij]:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return c&&Zg(c)&&(c=Jh(c)),c&&(d.fields[aj]=c),{mapValue:d}}(t,e):n instanceof nu?_j(n,e):n instanceof su?Tj(n,e):function(o,c){const d=Ej(o,c),f=jE(d)+jE(o.Re);return mg(d)&&mg(o.Re)?Nj(f):nv(o.serializer,f)}(n,e)}function wD(n,e,t){return n instanceof nu?_j(n,e):n instanceof su?Tj(n,e):t}function Ej(n,e){return n instanceof Dh?function(i){return mg(i)||function(c){return!!c&&"doubleValue"in c}(i)}(e)?e:{integerValue:0}:null}class tu extends sf{}class nu extends sf{constructor(e){super(),this.elements=e}}function _j(n,e){const t=jj(e);for(const i of n.elements)t.some(o=>Ws(o,i))||t.push(i);return{arrayValue:{values:t}}}class su extends sf{constructor(e){super(),this.elements=e}}function Tj(n,e){let t=jj(e);for(const i of n.elements)t=t.filter(o=>!Ws(o,i));return{arrayValue:{values:t}}}class Dh extends sf{constructor(e,t){super(),this.serializer=e,this.Re=t}}function jE(n){return It(n.integerValue||n.doubleValue)}function jj(n){return Jg(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SD{constructor(e,t){this.field=e,this.transform=t}}function ID(n,e){return n.field.isEqual(e.field)&&function(i,o){return i instanceof nu&&o instanceof nu||i instanceof su&&o instanceof su?tl(i.elements,o.elements,Ws):i instanceof Dh&&o instanceof Dh?Ws(i.Re,o.Re):i instanceof tu&&o instanceof tu}(n.transform,e.transform)}class RD{constructor(e,t){this.version=e,this.transformResults=t}}class ln{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ln}static exists(e){return new ln(void 0,e)}static updateTime(e){return new ln(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function fh(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class af{}function Aj(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new rf(n.key,ln.none()):new pu(n.key,n.data,ln.none());{const t=n.data,i=jn.empty();let o=new Ht(on.comparator);for(let c of e.fields)if(!o.has(c)){let d=t.field(c);d===null&&c.length>1&&(c=c.popLast(),d=t.field(c)),d===null?i.delete(c):i.set(c,d),o=o.add(c)}return new qi(n.key,i,new zn(o.toArray()),ln.none())}}function DD(n,e,t){n instanceof pu?function(o,c,d){const f=o.value.clone(),p=CE(o.fieldTransforms,c,d.transformResults);f.setAll(p),c.convertToFoundDocument(d.version,f).setHasCommittedMutations()}(n,e,t):n instanceof qi?function(o,c,d){if(!fh(o.precondition,c))return void c.convertToUnknownDocument(d.version);const f=CE(o.fieldTransforms,c,d.transformResults),p=c.data;p.setAll(Cj(o)),p.setAll(f),c.convertToFoundDocument(d.version,p).setHasCommittedMutations()}(n,e,t):function(o,c,d){c.convertToNoDocument(d.version).setHasCommittedMutations()}(0,e,t)}function Fc(n,e,t,i){return n instanceof pu?function(c,d,f,p){if(!fh(c.precondition,d))return f;const g=c.value.clone(),y=wE(c.fieldTransforms,p,d);return g.setAll(y),d.convertToFoundDocument(d.version,g).setHasLocalMutations(),null}(n,e,t,i):n instanceof qi?function(c,d,f,p){if(!fh(c.precondition,d))return f;const g=wE(c.fieldTransforms,p,d),y=d.data;return y.setAll(Cj(c)),y.setAll(g),d.convertToFoundDocument(d.version,y).setHasLocalMutations(),f===null?null:f.unionWith(c.fieldMask.fields).unionWith(c.fieldTransforms.map(b=>b.field))}(n,e,t,i):function(c,d,f){return fh(c.precondition,d)?(d.convertToNoDocument(d.version).setHasLocalMutations(),null):f}(n,e,t)}function MD(n,e){let t=null;for(const i of n.fieldTransforms){const o=e.data.field(i.field),c=Ej(i.transform,o||null);c!=null&&(t===null&&(t=jn.empty()),t.set(i.field,c))}return t||null}function AE(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(i,o){return i===void 0&&o===void 0||!(!i||!o)&&tl(i,o,(c,d)=>ID(c,d))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class pu extends af{constructor(e,t,i,o=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=o,this.type=0}getFieldMask(){return null}}class qi extends af{constructor(e,t,i,o,c=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=o,this.fieldTransforms=c,this.type=1}getFieldMask(){return this.fieldMask}}function Cj(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}}),e}function CE(n,e,t){const i=new Map;Je(n.length===t.length,32656,{Ve:t.length,me:n.length});for(let o=0;o<t.length;o++){const c=n[o],d=c.transform,f=e.data.field(c.field);i.set(c.field,wD(d,f,t[o]))}return i}function wE(n,e,t){const i=new Map;for(const o of n){const c=o.transform,d=t.data.field(o.field);i.set(o.field,CD(c,d,e))}return i}class rf extends af{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class wj extends af{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kD{constructor(e,t,i,o){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=o}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let o=0;o<this.mutations.length;o++){const c=this.mutations[o];c.key.isEqual(e.key)&&DD(c,e,i[o])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=Fc(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=Fc(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=bj();return this.mutations.forEach(o=>{const c=e.get(o.key),d=c.overlayedDocument;let f=this.applyToLocalView(d,c.mutatedFields);f=t.has(o.key)?null:f;const p=Aj(d,f);p!==null&&i.set(o.key,p),d.isValidDocument()||d.convertToNoDocument(Se.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Qe())}isEqual(e){return this.batchId===e.batchId&&tl(this.mutations,e.mutations,(t,i)=>AE(t,i))&&tl(this.baseMutations,e.baseMutations,(t,i)=>AE(t,i))}}class sv{constructor(e,t,i,o){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=o}static from(e,t,i){Je(e.mutations.length===i.length,58842,{fe:e.mutations.length,ge:i.length});let o=function(){return ED}();const c=e.mutations;for(let d=0;d<c.length;d++)o=o.insert(c[d].key,i[d].version);return new sv(e,t,i,o)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PD{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Pt,Ze;function Sj(n){switch(n){case ie.OK:return je(64938);case ie.CANCELLED:case ie.UNKNOWN:case ie.DEADLINE_EXCEEDED:case ie.RESOURCE_EXHAUSTED:case ie.INTERNAL:case ie.UNAVAILABLE:case ie.UNAUTHENTICATED:return!1;case ie.INVALID_ARGUMENT:case ie.NOT_FOUND:case ie.ALREADY_EXISTS:case ie.PERMISSION_DENIED:case ie.FAILED_PRECONDITION:case ie.ABORTED:case ie.OUT_OF_RANGE:case ie.UNIMPLEMENTED:case ie.DATA_LOSS:return!0;default:return je(15467,{code:n})}}function Ij(n){if(n===void 0)return ka("GRPC error has no .code"),ie.UNKNOWN;switch(n){case Pt.OK:return ie.OK;case Pt.CANCELLED:return ie.CANCELLED;case Pt.UNKNOWN:return ie.UNKNOWN;case Pt.DEADLINE_EXCEEDED:return ie.DEADLINE_EXCEEDED;case Pt.RESOURCE_EXHAUSTED:return ie.RESOURCE_EXHAUSTED;case Pt.INTERNAL:return ie.INTERNAL;case Pt.UNAVAILABLE:return ie.UNAVAILABLE;case Pt.UNAUTHENTICATED:return ie.UNAUTHENTICATED;case Pt.INVALID_ARGUMENT:return ie.INVALID_ARGUMENT;case Pt.NOT_FOUND:return ie.NOT_FOUND;case Pt.ALREADY_EXISTS:return ie.ALREADY_EXISTS;case Pt.PERMISSION_DENIED:return ie.PERMISSION_DENIED;case Pt.FAILED_PRECONDITION:return ie.FAILED_PRECONDITION;case Pt.ABORTED:return ie.ABORTED;case Pt.OUT_OF_RANGE:return ie.OUT_OF_RANGE;case Pt.UNIMPLEMENTED:return ie.UNIMPLEMENTED;case Pt.DATA_LOSS:return ie.DATA_LOSS;default:return je(39323,{code:n})}}(Ze=Pt||(Pt={}))[Ze.OK=0]="OK",Ze[Ze.CANCELLED=1]="CANCELLED",Ze[Ze.UNKNOWN=2]="UNKNOWN",Ze[Ze.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ze[Ze.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ze[Ze.NOT_FOUND=5]="NOT_FOUND",Ze[Ze.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ze[Ze.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ze[Ze.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ze[Ze.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ze[Ze.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ze[Ze.ABORTED=10]="ABORTED",Ze[Ze.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ze[Ze.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ze[Ze.INTERNAL=13]="INTERNAL",Ze[Ze.UNAVAILABLE=14]="UNAVAILABLE",Ze[Ze.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LD=new Ei([4294967295,4294967295],0);function SE(n){const e=WT().encode(n),t=new zT;return t.update(e),new Uint8Array(t.digest())}function IE(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),o=e.getUint32(8,!0),c=e.getUint32(12,!0);return[new Ei([t,i],0),new Ei([o,c],0)]}class av{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new Mc(`Invalid padding: ${t}`);if(i<0)throw new Mc(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new Mc(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new Mc(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=Ei.fromNumber(this.pe)}we(e,t,i){let o=e.add(t.multiply(Ei.fromNumber(i)));return o.compare(LD)===1&&(o=new Ei([o.getBits(0),o.getBits(1)],0)),o.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.pe===0)return!1;const t=SE(e),[i,o]=IE(t);for(let c=0;c<this.hashCount;c++){const d=this.we(i,o,c);if(!this.be(d))return!1}return!0}static create(e,t,i){const o=e%8==0?0:8-e%8,c=new Uint8Array(Math.ceil(e/8)),d=new av(c,o,t);return i.forEach(f=>d.insert(f)),d}insert(e){if(this.pe===0)return;const t=SE(e),[i,o]=IE(t);for(let c=0;c<this.hashCount;c++){const d=this.we(i,o,c);this.Se(d)}}Se(e){const t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}}class Mc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class of{constructor(e,t,i,o,c){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=o,this.resolvedLimboDocuments=c}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const o=new Map;return o.set(e,gu.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new of(Se.min(),o,new _t(qe),Oa(),Qe())}}class gu{constructor(e,t,i,o,c){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=o,this.removedDocuments=c}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new gu(i,t,Qe(),Qe(),Qe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mh{constructor(e,t,i,o){this.De=e,this.removedTargetIds=t,this.key=i,this.ve=o}}class Rj{constructor(e,t){this.targetId=e,this.Ce=t}}class Dj{constructor(e,t,i=un.EMPTY_BYTE_STRING,o=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=o}}class RE{constructor(){this.Fe=0,this.Me=DE(),this.xe=un.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=Qe(),t=Qe(),i=Qe();return this.Me.forEach((o,c)=>{switch(c){case 0:e=e.add(o);break;case 2:t=t.add(o);break;case 1:i=i.add(o);break;default:je(38017,{changeType:c})}}),new gu(this.xe,this.Oe,e,t,i)}Qe(){this.Ne=!1,this.Me=DE()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,Je(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class VD{constructor(e){this.ze=e,this.je=new Map,this.He=Oa(),this.Je=th(),this.Ye=th(),this.Ze=new _t(qe)}Xe(e){for(const t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(const t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,t=>{const i=this.rt(t);switch(e.state){case 0:this.it(t)&&i.ke(e.resumeToken);break;case 1:i.We(),i.Be||i.Qe(),i.ke(e.resumeToken);break;case 2:i.We(),i.Be||this.removeTarget(t);break;case 3:this.it(t)&&(i.Ge(),i.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),i.ke(e.resumeToken));break;default:je(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach((i,o)=>{this.it(o)&&t(o)})}ot(e){const t=e.targetId,i=e.Ce.count,o=this._t(t);if(o){const c=o.target;if(gg(c))if(i===0){const d=new _e(c.path);this.tt(t,d,Jt.newNoDocument(d,Se.min()))}else Je(i===1,20013,{expectedCount:i});else{const d=this.ut(t);if(d!==i){const f=this.ct(e),p=f?this.lt(f,e,d):1;if(p!==0){this.st(t);const g=p===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,g)}}}}}ct(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:i="",padding:o=0},hashCount:c=0}=t;let d,f;try{d=Si(i).toUint8Array()}catch(p){if(p instanceof tj)return el("Decoding the base64 bloom filter in existence filter failed ("+p.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw p}try{f=new av(d,o,c)}catch(p){return el(p instanceof Mc?"BloomFilter error: ":"Applying bloom filter failed: ",p),null}return f.pe===0?null:f}lt(e,t,i){return t.Ce.count===i-this.Tt(e,t.targetId)?0:2}Tt(e,t){const i=this.ze.getRemoteKeysForTarget(t);let o=0;return i.forEach(c=>{const d=this.ze.Pt(),f=`projects/${d.projectId}/databases/${d.database}/documents/${c.path.canonicalString()}`;e.mightContain(f)||(this.tt(t,c,null),o++)}),o}It(e){const t=new Map;this.je.forEach((c,d)=>{const f=this._t(d);if(f){if(c.current&&gg(f.target)){const p=new _e(f.target.path);this.Et(p).has(d)||this.dt(d,p)||this.tt(d,p,Jt.newNoDocument(p,e))}c.Le&&(t.set(d,c.qe()),c.Qe())}});let i=Qe();this.Ye.forEach((c,d)=>{let f=!0;d.forEachWhile(p=>{const g=this._t(p);return!g||g.purpose==="TargetPurposeLimboResolution"||(f=!1,!1)}),f&&(i=i.add(c))}),this.He.forEach((c,d)=>d.setReadTime(e));const o=new of(e,t,this.Ze,this.He,i);return this.He=Oa(),this.Je=th(),this.Ye=th(),this.Ze=new _t(qe),o}et(e,t){if(!this.it(e))return;const i=this.dt(e,t.key)?2:0;this.rt(e).$e(t.key,i),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,i){if(!this.it(e))return;const o=this.rt(e);this.dt(e,t)?o.$e(t,1):o.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),i&&(this.He=this.He.insert(t,i))}removeTarget(e){this.je.delete(e)}ut(e){const t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new RE,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new Ht(qe),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new Ht(qe),this.Je=this.Je.insert(e,t)),t}it(e){const t=this._t(e)!==null;return t||ye("WatchChangeAggregator","Detected inactive target",e),t}_t(e){const t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new RE),this.ze.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}}function th(){return new _t(_e.comparator)}function DE(){return new _t(_e.comparator)}const UD={asc:"ASCENDING",desc:"DESCENDING"},FD={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},qD={and:"AND",or:"OR"};class BD{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function yg(n,e){return n.useProto3Json||mu(e)?e:{value:e}}function Mh(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Mj(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function zD(n,e){return Mh(n,e.toTimestamp())}function Gn(n){return Je(!!n,49232),Se.fromTimestamp(function(t){const i=wi(t);return new zt(i.seconds,i.nanos)}(n))}function iv(n,e){return xg(n,e).canonicalString()}function xg(n,e){const t=function(o){return new ft(["projects",o.projectId,"databases",o.database])}(n).child("documents");return e===void 0?t:t.child(e)}function kj(n){const e=ft.fromString(n);return Je(Fj(e),10190,{key:e.toString()}),e}function kh(n,e){return iv(n.databaseId,e.path)}function qc(n,e){const t=kj(e);if(t.get(1)!==n.databaseId.projectId)throw new ge(ie.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new ge(ie.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new _e(Pj(t))}function Oj(n,e){return iv(n.databaseId,e)}function HD(n){const e=kj(n);return e.length===4?ft.emptyPath():Pj(e)}function bg(n){return new ft(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Pj(n){return Je(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function ME(n,e,t){return{name:kh(n,e),fields:t.value.mapValue.fields}}function GD(n,e){return"found"in e?function(i,o){Je(!!o.found,43571),o.found.name,o.found.updateTime;const c=qc(i,o.found.name),d=Gn(o.found.updateTime),f=o.found.createTime?Gn(o.found.createTime):Se.min(),p=new jn({mapValue:{fields:o.found.fields}});return Jt.newFoundDocument(c,d,f,p)}(n,e):"missing"in e?function(i,o){Je(!!o.missing,3894),Je(!!o.readTime,22933);const c=qc(i,o.missing),d=Gn(o.readTime);return Jt.newNoDocument(c,d)}(n,e):je(7234,{result:e})}function $D(n,e){let t;if("targetChange"in e){e.targetChange;const i=function(g){return g==="NO_CHANGE"?0:g==="ADD"?1:g==="REMOVE"?2:g==="CURRENT"?3:g==="RESET"?4:je(39313,{state:g})}(e.targetChange.targetChangeType||"NO_CHANGE"),o=e.targetChange.targetIds||[],c=function(g,y){return g.useProto3Json?(Je(y===void 0||typeof y=="string",58123),un.fromBase64String(y||"")):(Je(y===void 0||y instanceof Buffer||y instanceof Uint8Array,16193),un.fromUint8Array(y||new Uint8Array))}(n,e.targetChange.resumeToken),d=e.targetChange.cause,f=d&&function(g){const y=g.code===void 0?ie.UNKNOWN:Ij(g.code);return new ge(y,g.message||"")}(d);t=new Dj(i,o,c,f||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const o=qc(n,i.document.name),c=Gn(i.document.updateTime),d=i.document.createTime?Gn(i.document.createTime):Se.min(),f=new jn({mapValue:{fields:i.document.fields}}),p=Jt.newFoundDocument(o,c,d,f),g=i.targetIds||[],y=i.removedTargetIds||[];t=new mh(g,y,p.key,p)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const o=qc(n,i.document),c=i.readTime?Gn(i.readTime):Se.min(),d=Jt.newNoDocument(o,c),f=i.removedTargetIds||[];t=new mh([],f,d.key,d)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const o=qc(n,i.document),c=i.removedTargetIds||[];t=new mh([],c,o,null)}else{if(!("filter"in e))return je(11601,{Vt:e});{e.filter;const i=e.filter;i.targetId;const{count:o=0,unchangedNames:c}=i,d=new PD(o,c),f=i.targetId;t=new Rj(f,d)}}return t}function Lj(n,e){let t;if(e instanceof pu)t={update:ME(n,e.key,e.value)};else if(e instanceof rf)t={delete:kh(n,e.key)};else if(e instanceof qi)t={update:ME(n,e.key,e.data),updateMask:tM(e.fieldMask)};else{if(!(e instanceof wj))return je(16599,{ft:e.type});t={verify:kh(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(c,d){const f=d.transform;if(f instanceof tu)return{fieldPath:d.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(f instanceof nu)return{fieldPath:d.field.canonicalString(),appendMissingElements:{values:f.elements}};if(f instanceof su)return{fieldPath:d.field.canonicalString(),removeAllFromArray:{values:f.elements}};if(f instanceof Dh)return{fieldPath:d.field.canonicalString(),increment:f.Re};throw je(20930,{transform:d.transform})}(0,i))),e.precondition.isNone||(t.currentDocument=function(o,c){return c.updateTime!==void 0?{updateTime:zD(o,c.updateTime)}:c.exists!==void 0?{exists:c.exists}:je(27497)}(n,e.precondition)),t}function YD(n,e){return n&&n.length>0?(Je(e!==void 0,14353),n.map(t=>function(o,c){let d=o.updateTime?Gn(o.updateTime):Gn(c);return d.isEqual(Se.min())&&(d=Gn(c)),new RD(d,o.transformResults||[])}(t,e))):[]}function QD(n,e){return{documents:[Oj(n,e.path)]}}function KD(n,e){const t={structuredQuery:{}},i=e.path;let o;e.collectionGroup!==null?(o=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(o=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=Oj(n,o);const c=function(g){if(g.length!==0)return Uj(js.create(g,"and"))}(e.filters);c&&(t.structuredQuery.where=c);const d=function(g){if(g.length!==0)return g.map(y=>function(E){return{field:Bo(E.field),direction:ZD(E.dir)}}(y))}(e.orderBy);d&&(t.structuredQuery.orderBy=d);const f=yg(n,e.limit);return f!==null&&(t.structuredQuery.limit=f),e.startAt&&(t.structuredQuery.startAt=function(g){return{before:g.inclusive,values:g.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(g){return{before:!g.inclusive,values:g.position}}(e.endAt)),{gt:t,parent:o}}function XD(n){let e=HD(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let o=null;if(i>0){Je(i===1,65062);const y=t.from[0];y.allDescendants?o=y.collectionId:e=e.child(y.collectionId)}let c=[];t.where&&(c=function(b){const E=Vj(b);return E instanceof js&&dj(E)?E.getFilters():[E]}(t.where));let d=[];t.orderBy&&(d=function(b){return b.map(E=>function(N){return new eu(zo(N.field),function(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(N.direction))}(E))}(t.orderBy));let f=null;t.limit&&(f=function(b){let E;return E=typeof b=="object"?b.value:b,mu(E)?null:E}(t.limit));let p=null;t.startAt&&(p=function(b){const E=!!b.before,j=b.values||[];return new Ih(j,E)}(t.startAt));let g=null;return t.endAt&&(g=function(b){const E=!b.before,j=b.values||[];return new Ih(j,E)}(t.endAt)),vD(e,o,d,c,f,"F",p,g)}function WD(n,e){const t=function(o){switch(o){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return je(28987,{purpose:o})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Vj(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=zo(t.unaryFilter.field);return Lt.create(i,"==",{doubleValue:NaN});case"IS_NULL":const o=zo(t.unaryFilter.field);return Lt.create(o,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const c=zo(t.unaryFilter.field);return Lt.create(c,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const d=zo(t.unaryFilter.field);return Lt.create(d,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return je(61313);default:return je(60726)}}(n):n.fieldFilter!==void 0?function(t){return Lt.create(zo(t.fieldFilter.field),function(o){switch(o){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return je(58110);default:return je(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return js.create(t.compositeFilter.filters.map(i=>Vj(i)),function(o){switch(o){case"AND":return"and";case"OR":return"or";default:return je(1026)}}(t.compositeFilter.op))}(n):je(30097,{filter:n})}function ZD(n){return UD[n]}function JD(n){return FD[n]}function eM(n){return qD[n]}function Bo(n){return{fieldPath:n.canonicalString()}}function zo(n){return on.fromServerFormat(n.fieldPath)}function Uj(n){return n instanceof Lt?function(t){if(t.op==="=="){if(bE(t.value))return{unaryFilter:{field:Bo(t.field),op:"IS_NAN"}};if(xE(t.value))return{unaryFilter:{field:Bo(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(bE(t.value))return{unaryFilter:{field:Bo(t.field),op:"IS_NOT_NAN"}};if(xE(t.value))return{unaryFilter:{field:Bo(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Bo(t.field),op:JD(t.op),value:t.value}}}(n):n instanceof js?function(t){const i=t.getFilters().map(o=>Uj(o));return i.length===1?i[0]:{compositeFilter:{op:eM(t.op),filters:i}}}(n):je(54877,{filter:n})}function tM(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Fj(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(e,t,i,o,c=Se.min(),d=Se.min(),f=un.EMPTY_BYTE_STRING,p=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=o,this.snapshotVersion=c,this.lastLimboFreeSnapshotVersion=d,this.resumeToken=f,this.expectedCount=p}withSequenceNumber(e){return new xi(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new xi(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new xi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new xi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nM{constructor(e){this.wt=e}}function sM(n){const e=XD({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Rh(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aM{constructor(){this.Cn=new iM}addToCollectionParentIndex(e,t){return this.Cn.add(t),oe.resolve()}getCollectionParents(e,t){return oe.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return oe.resolve()}deleteFieldIndex(e,t){return oe.resolve()}deleteAllFieldIndexes(e){return oe.resolve()}createTargetIndexes(e,t){return oe.resolve()}getDocumentsMatchingTarget(e,t){return oe.resolve(null)}getIndexType(e,t){return oe.resolve(0)}getFieldIndexes(e,t){return oe.resolve([])}getNextCollectionGroupToUpdate(e){return oe.resolve(null)}getMinOffset(e,t){return oe.resolve(Ci.min())}getMinOffsetFromCollectionGroup(e,t){return oe.resolve(Ci.min())}updateCollectionGroup(e,t,i){return oe.resolve()}updateIndexEntries(e,t){return oe.resolve()}}class iM{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),o=this.index[t]||new Ht(ft.comparator),c=!o.has(i);return this.index[t]=o.add(i),c}has(e){const t=e.lastSegment(),i=e.popLast(),o=this.index[t];return o&&o.has(i)}getEntries(e){return(this.index[e]||new Ht(ft.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kE={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},qj=41943040;class Rn{static withCacheSize(e){return new Rn(e,Rn.DEFAULT_COLLECTION_PERCENTILE,Rn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Rn.DEFAULT_COLLECTION_PERCENTILE=10,Rn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Rn.DEFAULT=new Rn(qj,Rn.DEFAULT_COLLECTION_PERCENTILE,Rn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Rn.DISABLED=new Rn(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(e){this.ur=e}next(){return this.ur+=2,this.ur}static cr(){return new al(0)}static lr(){return new al(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OE="LruGarbageCollector",rM=1048576;function PE([n,e],[t,i]){const o=qe(n,t);return o===0?qe(e,i):o}class oM{constructor(e){this.Er=e,this.buffer=new Ht(PE),this.dr=0}Ar(){return++this.dr}Rr(e){const t=[e,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();PE(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class lM{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Vr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return this.Vr!==null}mr(e){ye(OE,`Garbage collection scheduled in ${e}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){fl(t)?ye(OE,"Ignoring IndexedDB error during garbage collection: ",t):await hl(t)}await this.mr(3e5)})}}class cM{constructor(e,t){this.gr=e,this.params=t}calculateTargetCount(e,t){return this.gr.pr(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return oe.resolve(Zh.le);const i=new oM(t);return this.gr.forEachTarget(e,o=>i.Rr(o.sequenceNumber)).next(()=>this.gr.yr(e,o=>i.Rr(o))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.gr.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.gr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(ye("LruGarbageCollector","Garbage collection skipped; disabled"),oe.resolve(kE)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(ye("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),kE):this.wr(e,t))}getCacheSize(e){return this.gr.getCacheSize(e)}wr(e,t){let i,o,c,d,f,p,g;const y=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(b=>(b>this.params.maximumSequenceNumbersToCollect?(ye("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${b}`),o=this.params.maximumSequenceNumbersToCollect):o=b,d=Date.now(),this.nthSequenceNumber(e,o))).next(b=>(i=b,f=Date.now(),this.removeTargets(e,i,t))).next(b=>(c=b,p=Date.now(),this.removeOrphanedDocuments(e,i))).next(b=>(g=Date.now(),Fo()<=Ye.DEBUG&&ye("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${d-y}ms
	Determined least recently used ${o} in `+(f-d)+`ms
	Removed ${c} targets in `+(p-f)+`ms
	Removed ${b} documents in `+(g-p)+`ms
Total Duration: ${g-y}ms`),oe.resolve({didRun:!0,sequenceNumbersCollected:o,targetsRemoved:c,documentsRemoved:b})))}}function uM(n,e){return new cM(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dM{constructor(){this.changes=new qr(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Jt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?oe.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hM{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fM{constructor(e,t,i,o){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=o}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(o=>(i=o,this.remoteDocumentCache.getEntry(e,t))).next(o=>(i!==null&&Fc(i.mutation,o,zn.empty(),zt.now()),o))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,Qe()).next(()=>i))}getLocalViewOfDocuments(e,t,i=Qe()){const o=Sr();return this.populateOverlays(e,o,t).next(()=>this.computeViews(e,t,o,i).next(c=>{let d=Dc();return c.forEach((f,p)=>{d=d.insert(f,p.overlayedDocument)}),d}))}getOverlayedDocuments(e,t){const i=Sr();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,Qe()))}populateOverlays(e,t,i){const o=[];return i.forEach(c=>{t.has(c)||o.push(c)}),this.documentOverlayCache.getOverlays(e,o).next(c=>{c.forEach((d,f)=>{t.set(d,f)})})}computeViews(e,t,i,o){let c=Oa();const d=Uc(),f=function(){return Uc()}();return t.forEach((p,g)=>{const y=i.get(g.key);o.has(g.key)&&(y===void 0||y.mutation instanceof qi)?c=c.insert(g.key,g):y!==void 0?(d.set(g.key,y.mutation.getFieldMask()),Fc(y.mutation,g,y.mutation.getFieldMask(),zt.now())):d.set(g.key,zn.empty())}),this.recalculateAndSaveOverlays(e,c).next(p=>(p.forEach((g,y)=>d.set(g,y)),t.forEach((g,y)=>{var b;return f.set(g,new hM(y,(b=d.get(g))!==null&&b!==void 0?b:null))}),f))}recalculateAndSaveOverlays(e,t){const i=Uc();let o=new _t((d,f)=>d-f),c=Qe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(d=>{for(const f of d)f.keys().forEach(p=>{const g=t.get(p);if(g===null)return;let y=i.get(p)||zn.empty();y=f.applyToLocalView(g,y),i.set(p,y);const b=(o.get(f.batchId)||Qe()).add(p);o=o.insert(f.batchId,b)})}).next(()=>{const d=[],f=o.getReverseIterator();for(;f.hasNext();){const p=f.getNext(),g=p.key,y=p.value,b=bj();y.forEach(E=>{if(!c.has(E)){const j=Aj(t.get(E),i.get(E));j!==null&&b.set(E,j),c=c.add(E)}}),d.push(this.documentOverlayCache.saveOverlays(e,g,b))}return oe.waitFor(d)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,o){return function(d){return _e.isDocumentKey(d.path)&&d.collectionGroup===null&&d.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):pj(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,o):this.getDocumentsMatchingCollectionQuery(e,t,i,o)}getNextDocuments(e,t,i,o){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,o).next(c=>{const d=o-c.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,o-c.size):oe.resolve(Sr());let f=Xc,p=c;return d.next(g=>oe.forEach(g,(y,b)=>(f<b.largestBatchId&&(f=b.largestBatchId),c.get(y)?oe.resolve():this.remoteDocumentCache.getEntry(e,y).next(E=>{p=p.insert(y,E)}))).next(()=>this.populateOverlays(e,g,c)).next(()=>this.computeViews(e,p,g,Qe())).next(y=>({batchId:f,changes:xj(y)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new _e(t)).next(i=>{let o=Dc();return i.isFoundDocument()&&(o=o.insert(i.key,i)),o})}getDocumentsMatchingCollectionGroupQuery(e,t,i,o){const c=t.collectionGroup;let d=Dc();return this.indexManager.getCollectionParents(e,c).next(f=>oe.forEach(f,p=>{const g=function(b,E){return new ml(E,null,b.explicitOrderBy.slice(),b.filters.slice(),b.limit,b.limitType,b.startAt,b.endAt)}(t,p.child(c));return this.getDocumentsMatchingCollectionQuery(e,g,i,o).next(y=>{y.forEach((b,E)=>{d=d.insert(b,E)})})}).next(()=>d))}getDocumentsMatchingCollectionQuery(e,t,i,o){let c;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(d=>(c=d,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,c,o))).next(d=>{c.forEach((p,g)=>{const y=g.getKey();d.get(y)===null&&(d=d.insert(y,Jt.newInvalidDocument(y)))});let f=Dc();return d.forEach((p,g)=>{const y=c.get(p);y!==void 0&&Fc(y.mutation,g,zn.empty(),zt.now()),nf(t,g)&&(f=f.insert(p,g))}),f})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mM{constructor(e){this.serializer=e,this.kr=new Map,this.qr=new Map}getBundleMetadata(e,t){return oe.resolve(this.kr.get(t))}saveBundleMetadata(e,t){return this.kr.set(t.id,function(o){return{id:o.id,version:o.version,createTime:Gn(o.createTime)}}(t)),oe.resolve()}getNamedQuery(e,t){return oe.resolve(this.qr.get(t))}saveNamedQuery(e,t){return this.qr.set(t.name,function(o){return{name:o.name,query:sM(o.bundledQuery),readTime:Gn(o.readTime)}}(t)),oe.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pM{constructor(){this.overlays=new _t(_e.comparator),this.Qr=new Map}getOverlay(e,t){return oe.resolve(this.overlays.get(t))}getOverlays(e,t){const i=Sr();return oe.forEach(t,o=>this.getOverlay(e,o).next(c=>{c!==null&&i.set(o,c)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((o,c)=>{this.St(e,t,c)}),oe.resolve()}removeOverlaysForBatchId(e,t,i){const o=this.Qr.get(i);return o!==void 0&&(o.forEach(c=>this.overlays=this.overlays.remove(c)),this.Qr.delete(i)),oe.resolve()}getOverlaysForCollection(e,t,i){const o=Sr(),c=t.length+1,d=new _e(t.child("")),f=this.overlays.getIteratorFrom(d);for(;f.hasNext();){const p=f.getNext().value,g=p.getKey();if(!t.isPrefixOf(g.path))break;g.path.length===c&&p.largestBatchId>i&&o.set(p.getKey(),p)}return oe.resolve(o)}getOverlaysForCollectionGroup(e,t,i,o){let c=new _t((g,y)=>g-y);const d=this.overlays.getIterator();for(;d.hasNext();){const g=d.getNext().value;if(g.getKey().getCollectionGroup()===t&&g.largestBatchId>i){let y=c.get(g.largestBatchId);y===null&&(y=Sr(),c=c.insert(g.largestBatchId,y)),y.set(g.getKey(),g)}}const f=Sr(),p=c.getIterator();for(;p.hasNext()&&(p.getNext().value.forEach((g,y)=>f.set(g,y)),!(f.size()>=o)););return oe.resolve(f)}St(e,t,i){const o=this.overlays.get(i.key);if(o!==null){const d=this.Qr.get(o.largestBatchId).delete(i.key);this.Qr.set(o.largestBatchId,d)}this.overlays=this.overlays.insert(i.key,new OD(t,i));let c=this.Qr.get(t);c===void 0&&(c=Qe(),this.Qr.set(t,c)),this.Qr.set(t,c.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gM{constructor(){this.sessionToken=un.EMPTY_BYTE_STRING}getSessionToken(e){return oe.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,oe.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rv{constructor(){this.$r=new Ht(Zt.Ur),this.Kr=new Ht(Zt.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(e,t){const i=new Zt(e,t);this.$r=this.$r.add(i),this.Kr=this.Kr.add(i)}Gr(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.zr(new Zt(e,t))}jr(e,t){e.forEach(i=>this.removeReference(i,t))}Hr(e){const t=new _e(new ft([])),i=new Zt(t,e),o=new Zt(t,e+1),c=[];return this.Kr.forEachInRange([i,o],d=>{this.zr(d),c.push(d.key)}),c}Jr(){this.$r.forEach(e=>this.zr(e))}zr(e){this.$r=this.$r.delete(e),this.Kr=this.Kr.delete(e)}Yr(e){const t=new _e(new ft([])),i=new Zt(t,e),o=new Zt(t,e+1);let c=Qe();return this.Kr.forEachInRange([i,o],d=>{c=c.add(d.key)}),c}containsKey(e){const t=new Zt(e,0),i=this.$r.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class Zt{constructor(e,t){this.key=e,this.Zr=t}static Ur(e,t){return _e.comparator(e.key,t.key)||qe(e.Zr,t.Zr)}static Wr(e,t){return qe(e.Zr,t.Zr)||_e.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vM{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nr=1,this.Xr=new Ht(Zt.Ur)}checkEmpty(e){return oe.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,o){const c=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const d=new kD(c,t,i,o);this.mutationQueue.push(d);for(const f of o)this.Xr=this.Xr.add(new Zt(f.key,c)),this.indexManager.addToCollectionParentIndex(e,f.key.path.popLast());return oe.resolve(d)}lookupMutationBatch(e,t){return oe.resolve(this.ei(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,o=this.ti(i),c=o<0?0:o;return oe.resolve(this.mutationQueue.length>c?this.mutationQueue[c]:null)}getHighestUnacknowledgedBatchId(){return oe.resolve(this.mutationQueue.length===0?Wg:this.nr-1)}getAllMutationBatches(e){return oe.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new Zt(t,0),o=new Zt(t,Number.POSITIVE_INFINITY),c=[];return this.Xr.forEachInRange([i,o],d=>{const f=this.ei(d.Zr);c.push(f)}),oe.resolve(c)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Ht(qe);return t.forEach(o=>{const c=new Zt(o,0),d=new Zt(o,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([c,d],f=>{i=i.add(f.Zr)})}),oe.resolve(this.ni(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,o=i.length+1;let c=i;_e.isDocumentKey(c)||(c=c.child(""));const d=new Zt(new _e(c),0);let f=new Ht(qe);return this.Xr.forEachWhile(p=>{const g=p.key.path;return!!i.isPrefixOf(g)&&(g.length===o&&(f=f.add(p.Zr)),!0)},d),oe.resolve(this.ni(f))}ni(e){const t=[];return e.forEach(i=>{const o=this.ei(i);o!==null&&t.push(o)}),t}removeMutationBatch(e,t){Je(this.ri(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Xr;return oe.forEach(t.mutations,o=>{const c=new Zt(o.key,t.batchId);return i=i.delete(c),this.referenceDelegate.markPotentiallyOrphaned(e,o.key)}).next(()=>{this.Xr=i})}sr(e){}containsKey(e,t){const i=new Zt(t,0),o=this.Xr.firstAfterOrEqual(i);return oe.resolve(t.isEqual(o&&o.key))}performConsistencyCheck(e){return this.mutationQueue.length,oe.resolve()}ri(e,t){return this.ti(e)}ti(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}ei(e){const t=this.ti(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yM{constructor(e){this.ii=e,this.docs=function(){return new _t(_e.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,o=this.docs.get(i),c=o?o.size:0,d=this.ii(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:d}),this.size+=d-c,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return oe.resolve(i?i.document.mutableCopy():Jt.newInvalidDocument(t))}getEntries(e,t){let i=Oa();return t.forEach(o=>{const c=this.docs.get(o);i=i.insert(o,c?c.document.mutableCopy():Jt.newInvalidDocument(o))}),oe.resolve(i)}getDocumentsMatchingQuery(e,t,i,o){let c=Oa();const d=t.path,f=new _e(d.child("__id-9223372036854775808__")),p=this.docs.getIteratorFrom(f);for(;p.hasNext();){const{key:g,value:{document:y}}=p.getNext();if(!d.isPrefixOf(g.path))break;g.path.length>d.length+1||K1(Q1(y),i)<=0||(o.has(y.key)||nf(t,y))&&(c=c.insert(y.key,y.mutableCopy()))}return oe.resolve(c)}getAllFromCollectionGroup(e,t,i,o){je(9500)}si(e,t){return oe.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new xM(this)}getSize(e){return oe.resolve(this.size)}}class xM extends dM{constructor(e){super(),this.Br=e}applyChanges(e){const t=[];return this.changes.forEach((i,o)=>{o.isValidDocument()?t.push(this.Br.addEntry(e,o)):this.Br.removeEntry(i)}),oe.waitFor(t)}getFromCache(e,t){return this.Br.getEntry(e,t)}getAllFromCache(e,t){return this.Br.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bM{constructor(e){this.persistence=e,this.oi=new qr(t=>ev(t),tv),this.lastRemoteSnapshotVersion=Se.min(),this.highestTargetId=0,this._i=0,this.ai=new rv,this.targetCount=0,this.ui=al.cr()}forEachTarget(e,t){return this.oi.forEach((i,o)=>t(o)),oe.resolve()}getLastRemoteSnapshotVersion(e){return oe.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return oe.resolve(this._i)}allocateTargetId(e){return this.highestTargetId=this.ui.next(),oe.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this._i&&(this._i=t),oe.resolve()}Tr(e){this.oi.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ui=new al(t),this.highestTargetId=t),e.sequenceNumber>this._i&&(this._i=e.sequenceNumber)}addTargetData(e,t){return this.Tr(t),this.targetCount+=1,oe.resolve()}updateTargetData(e,t){return this.Tr(t),oe.resolve()}removeTargetData(e,t){return this.oi.delete(t.target),this.ai.Hr(t.targetId),this.targetCount-=1,oe.resolve()}removeTargets(e,t,i){let o=0;const c=[];return this.oi.forEach((d,f)=>{f.sequenceNumber<=t&&i.get(f.targetId)===null&&(this.oi.delete(d),c.push(this.removeMatchingKeysForTargetId(e,f.targetId)),o++)}),oe.waitFor(c).next(()=>o)}getTargetCount(e){return oe.resolve(this.targetCount)}getTargetData(e,t){const i=this.oi.get(t)||null;return oe.resolve(i)}addMatchingKeys(e,t,i){return this.ai.Gr(t,i),oe.resolve()}removeMatchingKeys(e,t,i){this.ai.jr(t,i);const o=this.persistence.referenceDelegate,c=[];return o&&t.forEach(d=>{c.push(o.markPotentiallyOrphaned(e,d))}),oe.waitFor(c)}removeMatchingKeysForTargetId(e,t){return this.ai.Hr(t),oe.resolve()}getMatchingKeysForTargetId(e,t){const i=this.ai.Yr(t);return oe.resolve(i)}containsKey(e,t){return oe.resolve(this.ai.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bj{constructor(e,t){this.ci={},this.overlays={},this.li=new Zh(0),this.hi=!1,this.hi=!0,this.Pi=new gM,this.referenceDelegate=e(this),this.Ti=new bM(this),this.indexManager=new aM,this.remoteDocumentCache=function(o){return new yM(o)}(i=>this.referenceDelegate.Ii(i)),this.serializer=new nM(t),this.Ei=new mM(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new pM,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.ci[e.toKey()];return i||(i=new vM(t,this.referenceDelegate),this.ci[e.toKey()]=i),i}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(e,t,i){ye("MemoryPersistence","Starting transaction:",e);const o=new NM(this.li.next());return this.referenceDelegate.di(),i(o).next(c=>this.referenceDelegate.Ai(o).next(()=>c)).toPromise().then(c=>(o.raiseOnCommittedEvent(),c))}Ri(e,t){return oe.or(Object.values(this.ci).map(i=>()=>i.containsKey(e,t)))}}class NM extends W1{constructor(e){super(),this.currentSequenceNumber=e}}class ov{constructor(e){this.persistence=e,this.Vi=new rv,this.mi=null}static fi(e){return new ov(e)}get gi(){if(this.mi)return this.mi;throw je(60996)}addReference(e,t,i){return this.Vi.addReference(i,t),this.gi.delete(i.toString()),oe.resolve()}removeReference(e,t,i){return this.Vi.removeReference(i,t),this.gi.add(i.toString()),oe.resolve()}markPotentiallyOrphaned(e,t){return this.gi.add(t.toString()),oe.resolve()}removeTarget(e,t){this.Vi.Hr(t.targetId).forEach(o=>this.gi.add(o.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(o=>{o.forEach(c=>this.gi.add(c.toString()))}).next(()=>i.removeTargetData(e,t))}di(){this.mi=new Set}Ai(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return oe.forEach(this.gi,i=>{const o=_e.fromPath(i);return this.pi(e,o).next(c=>{c||t.removeEntry(o,Se.min())})}).next(()=>(this.mi=null,t.apply(e)))}updateLimboDocument(e,t){return this.pi(e,t).next(i=>{i?this.gi.delete(t.toString()):this.gi.add(t.toString())})}Ii(e){return 0}pi(e,t){return oe.or([()=>oe.resolve(this.Vi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ri(e,t)])}}class Oh{constructor(e,t){this.persistence=e,this.yi=new qr(i=>eD(i.path),(i,o)=>i.isEqual(o)),this.garbageCollector=uM(this,t)}static fi(e,t){return new Oh(e,t)}di(){}Ai(e){return oe.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}pr(e){const t=this.br(e);return this.persistence.getTargetCache().getTargetCount(e).next(i=>t.next(o=>i+o))}br(e){let t=0;return this.yr(e,i=>{t++}).next(()=>t)}yr(e,t){return oe.forEach(this.yi,(i,o)=>this.Dr(e,i,o).next(c=>c?oe.resolve():t(o)))}removeTargets(e,t,i){return this.persistence.getTargetCache().removeTargets(e,t,i)}removeOrphanedDocuments(e,t){let i=0;const o=this.persistence.getRemoteDocumentCache(),c=o.newChangeBuffer();return o.si(e,d=>this.Dr(e,d,t).next(f=>{f||(i++,c.removeEntry(d,Se.min()))})).next(()=>c.apply(e)).next(()=>i)}markPotentiallyOrphaned(e,t){return this.yi.set(t,e.currentSequenceNumber),oe.resolve()}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,i)}addReference(e,t,i){return this.yi.set(i,e.currentSequenceNumber),oe.resolve()}removeReference(e,t,i){return this.yi.set(i,e.currentSequenceNumber),oe.resolve()}updateLimboDocument(e,t){return this.yi.set(t,e.currentSequenceNumber),oe.resolve()}Ii(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=dh(e.data.value)),t}Dr(e,t,i){return oe.or([()=>this.persistence.Ri(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const o=this.yi.get(t);return oe.resolve(o!==void 0&&o>i)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lv{constructor(e,t,i,o){this.targetId=e,this.fromCache=t,this.ds=i,this.As=o}static Rs(e,t){let i=Qe(),o=Qe();for(const c of t.docChanges)switch(c.type){case 0:i=i.add(c.doc.key);break;case 1:o=o.add(c.doc.key)}return new lv(e,t.fromCache,i,o)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EM{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _M{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=function(){return tS()?8:Z1(yn())>0?6:4}()}initialize(e,t){this.ys=e,this.indexManager=t,this.Vs=!0}getDocumentsMatchingQuery(e,t,i,o){const c={result:null};return this.ws(e,t).next(d=>{c.result=d}).next(()=>{if(!c.result)return this.bs(e,t,o,i).next(d=>{c.result=d})}).next(()=>{if(c.result)return;const d=new EM;return this.Ss(e,t,d).next(f=>{if(c.result=f,this.fs)return this.Ds(e,t,d,f.size)})}).next(()=>c.result)}Ds(e,t,i,o){return i.documentReadCount<this.gs?(Fo()<=Ye.DEBUG&&ye("QueryEngine","SDK will not create cache indexes for query:",qo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),oe.resolve()):(Fo()<=Ye.DEBUG&&ye("QueryEngine","Query:",qo(t),"scans",i.documentReadCount,"local documents and returns",o,"documents as results."),i.documentReadCount>this.ps*o?(Fo()<=Ye.DEBUG&&ye("QueryEngine","The SDK decides to create cache indexes for query:",qo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Xs(t))):oe.resolve())}ws(e,t){if(TE(t))return oe.resolve(null);let i=Xs(t);return this.indexManager.getIndexType(e,i).next(o=>o===0?null:(t.limit!==null&&o===1&&(t=Rh(t,null,"F"),i=Xs(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(c=>{const d=Qe(...c);return this.ys.getDocuments(e,d).next(f=>this.indexManager.getMinOffset(e,i).next(p=>{const g=this.vs(t,f);return this.Cs(t,g,d,p.readTime)?this.ws(e,Rh(t,null,"F")):this.Fs(e,g,t,p)}))})))}bs(e,t,i,o){return TE(t)||o.isEqual(Se.min())?oe.resolve(null):this.ys.getDocuments(e,i).next(c=>{const d=this.vs(t,c);return this.Cs(t,d,i,o)?oe.resolve(null):(Fo()<=Ye.DEBUG&&ye("QueryEngine","Re-using previous result from %s to execute query: %s",o.toString(),qo(t)),this.Fs(e,d,t,Y1(o,Xc)).next(f=>f))})}vs(e,t){let i=new Ht(vj(e));return t.forEach((o,c)=>{nf(e,c)&&(i=i.add(c))}),i}Cs(e,t,i,o){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const c=e.limitType==="F"?t.last():t.first();return!!c&&(c.hasPendingWrites||c.version.compareTo(o)>0)}Ss(e,t,i){return Fo()<=Ye.DEBUG&&ye("QueryEngine","Using full collection scan to execute query:",qo(t)),this.ys.getDocumentsMatchingQuery(e,t,Ci.min(),i)}Fs(e,t,i,o){return this.ys.getDocumentsMatchingQuery(e,i,o).next(c=>(t.forEach(d=>{c=c.insert(d.key,d)}),c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cv="LocalStore",TM=3e8;class jM{constructor(e,t,i,o){this.persistence=e,this.Ms=t,this.serializer=o,this.xs=new _t(qe),this.Os=new qr(c=>ev(c),tv),this.Ns=new Map,this.Bs=e.getRemoteDocumentCache(),this.Ti=e.getTargetCache(),this.Ei=e.getBundleCache(),this.Ls(i)}Ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new fM(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.xs))}}function AM(n,e,t,i){return new jM(n,e,t,i)}async function zj(n,e){const t=ke(n);return await t.persistence.runTransaction("Handle user change","readonly",i=>{let o;return t.mutationQueue.getAllMutationBatches(i).next(c=>(o=c,t.Ls(e),t.mutationQueue.getAllMutationBatches(i))).next(c=>{const d=[],f=[];let p=Qe();for(const g of o){d.push(g.batchId);for(const y of g.mutations)p=p.add(y.key)}for(const g of c){f.push(g.batchId);for(const y of g.mutations)p=p.add(y.key)}return t.localDocuments.getDocuments(i,p).next(g=>({ks:g,removedBatchIds:d,addedBatchIds:f}))})})}function CM(n,e){const t=ke(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const o=e.batch.keys(),c=t.Bs.newChangeBuffer({trackRemovals:!0});return function(f,p,g,y){const b=g.batch,E=b.keys();let j=oe.resolve();return E.forEach(N=>{j=j.next(()=>y.getEntry(p,N)).next(w=>{const T=g.docVersions.get(N);Je(T!==null,48541),w.version.compareTo(T)<0&&(b.applyToRemoteDocument(w,g),w.isValidDocument()&&(w.setReadTime(g.commitVersion),y.addEntry(w)))})}),j.next(()=>f.mutationQueue.removeMutationBatch(p,b))}(t,i,e,c).next(()=>c.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,o,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(f){let p=Qe();for(let g=0;g<f.mutationResults.length;++g)f.mutationResults[g].transformResults.length>0&&(p=p.add(f.batch.mutations[g].key));return p}(e))).next(()=>t.localDocuments.getDocuments(i,o))})}function Hj(n){const e=ke(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ti.getLastRemoteSnapshotVersion(t))}function wM(n,e){const t=ke(n),i=e.snapshotVersion;let o=t.xs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",c=>{const d=t.Bs.newChangeBuffer({trackRemovals:!0});o=t.xs;const f=[];e.targetChanges.forEach((y,b)=>{const E=o.get(b);if(!E)return;f.push(t.Ti.removeMatchingKeys(c,y.removedDocuments,b).next(()=>t.Ti.addMatchingKeys(c,y.addedDocuments,b)));let j=E.withSequenceNumber(c.currentSequenceNumber);e.targetMismatches.get(b)!==null?j=j.withResumeToken(un.EMPTY_BYTE_STRING,Se.min()).withLastLimboFreeSnapshotVersion(Se.min()):y.resumeToken.approximateByteSize()>0&&(j=j.withResumeToken(y.resumeToken,i)),o=o.insert(b,j),function(w,T,S){return w.resumeToken.approximateByteSize()===0||T.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=TM?!0:S.addedDocuments.size+S.modifiedDocuments.size+S.removedDocuments.size>0}(E,j,y)&&f.push(t.Ti.updateTargetData(c,j))});let p=Oa(),g=Qe();if(e.documentUpdates.forEach(y=>{e.resolvedLimboDocuments.has(y)&&f.push(t.persistence.referenceDelegate.updateLimboDocument(c,y))}),f.push(SM(c,d,e.documentUpdates).next(y=>{p=y.qs,g=y.Qs})),!i.isEqual(Se.min())){const y=t.Ti.getLastRemoteSnapshotVersion(c).next(b=>t.Ti.setTargetsMetadata(c,c.currentSequenceNumber,i));f.push(y)}return oe.waitFor(f).next(()=>d.apply(c)).next(()=>t.localDocuments.getLocalViewOfDocuments(c,p,g)).next(()=>p)}).then(c=>(t.xs=o,c))}function SM(n,e,t){let i=Qe(),o=Qe();return t.forEach(c=>i=i.add(c)),e.getEntries(n,i).next(c=>{let d=Oa();return t.forEach((f,p)=>{const g=c.get(f);p.isFoundDocument()!==g.isFoundDocument()&&(o=o.add(f)),p.isNoDocument()&&p.version.isEqual(Se.min())?(e.removeEntry(f,p.readTime),d=d.insert(f,p)):!g.isValidDocument()||p.version.compareTo(g.version)>0||p.version.compareTo(g.version)===0&&g.hasPendingWrites?(e.addEntry(p),d=d.insert(f,p)):ye(cv,"Ignoring outdated watch update for ",f,". Current version:",g.version," Watch version:",p.version)}),{qs:d,Qs:o}})}function IM(n,e){const t=ke(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=Wg),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function RM(n,e){const t=ke(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let o;return t.Ti.getTargetData(i,e).next(c=>c?(o=c,oe.resolve(o)):t.Ti.allocateTargetId(i).next(d=>(o=new xi(e,d,"TargetPurposeListen",i.currentSequenceNumber),t.Ti.addTargetData(i,o).next(()=>o))))}).then(i=>{const o=t.xs.get(i.targetId);return(o===null||i.snapshotVersion.compareTo(o.snapshotVersion)>0)&&(t.xs=t.xs.insert(i.targetId,i),t.Os.set(e,i.targetId)),i})}async function Ng(n,e,t){const i=ke(n),o=i.xs.get(e),c=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",c,d=>i.persistence.referenceDelegate.removeTarget(d,o))}catch(d){if(!fl(d))throw d;ye(cv,`Failed to update sequence numbers for target ${e}: ${d}`)}i.xs=i.xs.remove(e),i.Os.delete(o.target)}function LE(n,e,t){const i=ke(n);let o=Se.min(),c=Qe();return i.persistence.runTransaction("Execute query","readwrite",d=>function(p,g,y){const b=ke(p),E=b.Os.get(y);return E!==void 0?oe.resolve(b.xs.get(E)):b.Ti.getTargetData(g,y)}(i,d,Xs(e)).next(f=>{if(f)return o=f.lastLimboFreeSnapshotVersion,i.Ti.getMatchingKeysForTargetId(d,f.targetId).next(p=>{c=p})}).next(()=>i.Ms.getDocumentsMatchingQuery(d,e,t?o:Se.min(),t?c:Qe())).next(f=>(DM(i,xD(e),f),{documents:f,$s:c})))}function DM(n,e,t){let i=n.Ns.get(e)||Se.min();t.forEach((o,c)=>{c.readTime.compareTo(i)>0&&(i=c.readTime)}),n.Ns.set(e,i)}class VE{constructor(){this.activeTargetIds=jD()}js(e){this.activeTargetIds=this.activeTargetIds.add(e)}Hs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}zs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class MM{constructor(){this.xo=new VE,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.xo.js(e),this.Oo[e]||"not-current"}updateQueryState(e,t,i){this.Oo[e]=t}removeLocalQueryTarget(e){this.xo.Hs(e)}isLocalQueryTarget(e){return this.xo.activeTargetIds.has(e)}clearQueryState(e){delete this.Oo[e]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(e){return this.xo.activeTargetIds.has(e)}start(){return this.xo=new VE,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kM{No(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UE="ConnectivityMonitor";class FE{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(e){this.Qo.push(e)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){ye(UE,"Network connectivity changed: AVAILABLE");for(const e of this.Qo)e(0)}qo(){ye(UE,"Network connectivity changed: UNAVAILABLE");for(const e of this.Qo)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nh=null;function Eg(){return nh===null?nh=function(){return 268435456+Math.round(2147483648*Math.random())}():nh++,"0x"+nh.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qp="RestConnection",OM={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class PM{get Uo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),o=encodeURIComponent(this.databaseId.database);this.Ko=t+"://"+e.host,this.Wo=`projects/${i}/databases/${o}`,this.Go=this.databaseId.database===wh?`project_id=${i}`:`project_id=${i}&database_id=${o}`}zo(e,t,i,o,c){const d=Eg(),f=this.jo(e,t.toUriEncodedString());ye(qp,`Sending RPC '${e}' ${d}:`,f,i);const p={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(p,o,c);const{host:g}=new URL(f),y=Ur(g);return this.Jo(e,f,p,i,y).then(b=>(ye(qp,`Received RPC '${e}' ${d}: `,b),b),b=>{throw el(qp,`RPC '${e}' ${d} failed with error: `,b,"url: ",f,"request:",i),b})}Yo(e,t,i,o,c,d){return this.zo(e,t,i,o,c)}Ho(e,t,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+dl}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((o,c)=>e[c]=o),i&&i.headers.forEach((o,c)=>e[c]=o)}jo(e,t){const i=OM[e];return`${this.Ko}/v1/${t}:${i}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LM{constructor(e){this.Zo=e.Zo,this.Xo=e.Xo}e_(e){this.t_=e}n_(e){this.r_=e}i_(e){this.s_=e}onMessage(e){this.o_=e}close(){this.Xo()}send(e){this.Zo(e)}__(){this.t_()}a_(){this.r_()}u_(e){this.s_(e)}c_(e){this.o_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mn="WebChannelConnection";class VM extends PM{constructor(e){super(e),this.l_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,i,o,c){const d=Eg();return new Promise((f,p)=>{const g=new HT;g.setWithCredentials(!0),g.listenOnce(GT.COMPLETE,()=>{try{switch(g.getLastErrorCode()){case uh.NO_ERROR:const b=g.getResponseJson();ye(mn,`XHR for RPC '${e}' ${d} received:`,JSON.stringify(b)),f(b);break;case uh.TIMEOUT:ye(mn,`RPC '${e}' ${d} timed out`),p(new ge(ie.DEADLINE_EXCEEDED,"Request time out"));break;case uh.HTTP_ERROR:const E=g.getStatus();if(ye(mn,`RPC '${e}' ${d} failed with status:`,E,"response text:",g.getResponseText()),E>0){let j=g.getResponseJson();Array.isArray(j)&&(j=j[0]);const N=j?.error;if(N&&N.status&&N.message){const w=function(S){const q=S.toLowerCase().replace(/_/g,"-");return Object.values(ie).indexOf(q)>=0?q:ie.UNKNOWN}(N.status);p(new ge(w,N.message))}else p(new ge(ie.UNKNOWN,"Server responded with status "+g.getStatus()))}else p(new ge(ie.UNAVAILABLE,"Connection failed."));break;default:je(9055,{h_:e,streamId:d,P_:g.getLastErrorCode(),T_:g.getLastError()})}}finally{ye(mn,`RPC '${e}' ${d} completed.`)}});const y=JSON.stringify(o);ye(mn,`RPC '${e}' ${d} sending request:`,o),g.send(t,"POST",y,i,15)})}I_(e,t,i){const o=Eg(),c=[this.Ko,"/","google.firestore.v1.Firestore","/",e,"/channel"],d=QT(),f=YT(),p={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},g=this.longPollingOptions.timeoutSeconds;g!==void 0&&(p.longPollingTimeout=Math.round(1e3*g)),this.useFetchStreams&&(p.useFetchStreams=!0),this.Ho(p.initMessageHeaders,t,i),p.encodeInitMessageHeaders=!0;const y=c.join("");ye(mn,`Creating RPC '${e}' stream ${o}: ${y}`,p);const b=d.createWebChannel(y,p);this.E_(b);let E=!1,j=!1;const N=new LM({Zo:T=>{j?ye(mn,`Not sending because RPC '${e}' stream ${o} is closed:`,T):(E||(ye(mn,`Opening RPC '${e}' stream ${o} transport.`),b.open(),E=!0),ye(mn,`RPC '${e}' stream ${o} sending:`,T),b.send(T))},Xo:()=>b.close()}),w=(T,S,q)=>{T.listen(S,I=>{try{q(I)}catch(O){setTimeout(()=>{throw O},0)}})};return w(b,Rc.EventType.OPEN,()=>{j||(ye(mn,`RPC '${e}' stream ${o} transport opened.`),N.__())}),w(b,Rc.EventType.CLOSE,()=>{j||(j=!0,ye(mn,`RPC '${e}' stream ${o} transport closed`),N.u_(),this.d_(b))}),w(b,Rc.EventType.ERROR,T=>{j||(j=!0,el(mn,`RPC '${e}' stream ${o} transport errored. Name:`,T.name,"Message:",T.message),N.u_(new ge(ie.UNAVAILABLE,"The operation could not be completed")))}),w(b,Rc.EventType.MESSAGE,T=>{var S;if(!j){const q=T.data[0];Je(!!q,16349);const I=q,O=I?.error||((S=I[0])===null||S===void 0?void 0:S.error);if(O){ye(mn,`RPC '${e}' stream ${o} received error:`,O);const U=O.status;let $=function(V){const P=Pt[V];if(P!==void 0)return Ij(P)}(U),F=O.message;$===void 0&&($=ie.INTERNAL,F="Unknown error status: "+U+" with message "+O.message),j=!0,N.u_(new ge($,F)),b.close()}else ye(mn,`RPC '${e}' stream ${o} received:`,q),N.c_(q)}}),w(f,$T.STAT_EVENT,T=>{T.stat===dg.PROXY?ye(mn,`RPC '${e}' stream ${o} detected buffering proxy`):T.stat===dg.NOPROXY&&ye(mn,`RPC '${e}' stream ${o} detected no buffering proxy`)}),setTimeout(()=>{N.a_()},0),N}terminate(){this.l_.forEach(e=>e.close()),this.l_=[]}E_(e){this.l_.push(e)}d_(e){this.l_=this.l_.filter(t=>t===e)}}function Bp(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lf(n){return new BD(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uv{constructor(e,t,i=1e3,o=1.5,c=6e4){this.xi=e,this.timerId=t,this.A_=i,this.R_=o,this.V_=c,this.m_=0,this.f_=null,this.g_=Date.now(),this.reset()}reset(){this.m_=0}p_(){this.m_=this.V_}y_(e){this.cancel();const t=Math.floor(this.m_+this.w_()),i=Math.max(0,Date.now()-this.g_),o=Math.max(0,t-i);o>0&&ye("ExponentialBackoff",`Backing off for ${o} ms (base delay: ${this.m_} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.f_=this.xi.enqueueAfterDelay(this.timerId,o,()=>(this.g_=Date.now(),e())),this.m_*=this.R_,this.m_<this.A_&&(this.m_=this.A_),this.m_>this.V_&&(this.m_=this.V_)}b_(){this.f_!==null&&(this.f_.skipDelay(),this.f_=null)}cancel(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}w_(){return(Math.random()-.5)*this.m_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qE="PersistentStream";class Gj{constructor(e,t,i,o,c,d,f,p){this.xi=e,this.S_=i,this.D_=o,this.connection=c,this.authCredentialsProvider=d,this.appCheckCredentialsProvider=f,this.listener=p,this.state=0,this.v_=0,this.C_=null,this.F_=null,this.stream=null,this.M_=0,this.x_=new uv(e,t)}O_(){return this.state===1||this.state===5||this.N_()}N_(){return this.state===2||this.state===3}start(){this.M_=0,this.state!==4?this.auth():this.B_()}async stop(){this.O_()&&await this.close(0)}L_(){this.state=0,this.x_.reset()}k_(){this.N_()&&this.C_===null&&(this.C_=this.xi.enqueueAfterDelay(this.S_,6e4,()=>this.q_()))}Q_(e){this.U_(),this.stream.send(e)}async q_(){if(this.N_())return this.close(0)}U_(){this.C_&&(this.C_.cancel(),this.C_=null)}K_(){this.F_&&(this.F_.cancel(),this.F_=null)}async close(e,t){this.U_(),this.K_(),this.x_.cancel(),this.v_++,e!==4?this.x_.reset():t&&t.code===ie.RESOURCE_EXHAUSTED?(ka(t.toString()),ka("Using maximum backoff delay to prevent overloading the backend."),this.x_.p_()):t&&t.code===ie.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.i_(t)}W_(){}auth(){this.state=1;const e=this.G_(this.v_),t=this.v_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,o])=>{this.v_===t&&this.z_(i,o)},i=>{e(()=>{const o=new ge(ie.UNKNOWN,"Fetching auth token failed: "+i.message);return this.j_(o)})})}z_(e,t){const i=this.G_(this.v_);this.stream=this.H_(e,t),this.stream.e_(()=>{i(()=>this.listener.e_())}),this.stream.n_(()=>{i(()=>(this.state=2,this.F_=this.xi.enqueueAfterDelay(this.D_,1e4,()=>(this.N_()&&(this.state=3),Promise.resolve())),this.listener.n_()))}),this.stream.i_(o=>{i(()=>this.j_(o))}),this.stream.onMessage(o=>{i(()=>++this.M_==1?this.J_(o):this.onNext(o))})}B_(){this.state=5,this.x_.y_(async()=>{this.state=0,this.start()})}j_(e){return ye(qE,`close with error: ${e}`),this.stream=null,this.close(4,e)}G_(e){return t=>{this.xi.enqueueAndForget(()=>this.v_===e?t():(ye(qE,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class UM extends Gj{constructor(e,t,i,o,c,d){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,o,d),this.serializer=c}H_(e,t){return this.connection.I_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.x_.reset();const t=$D(this.serializer,e),i=function(c){if(!("targetChange"in c))return Se.min();const d=c.targetChange;return d.targetIds&&d.targetIds.length?Se.min():d.readTime?Gn(d.readTime):Se.min()}(e);return this.listener.Y_(t,i)}Z_(e){const t={};t.database=bg(this.serializer),t.addTarget=function(c,d){let f;const p=d.target;if(f=gg(p)?{documents:QD(c,p)}:{query:KD(c,p).gt},f.targetId=d.targetId,d.resumeToken.approximateByteSize()>0){f.resumeToken=Mj(c,d.resumeToken);const g=yg(c,d.expectedCount);g!==null&&(f.expectedCount=g)}else if(d.snapshotVersion.compareTo(Se.min())>0){f.readTime=Mh(c,d.snapshotVersion.toTimestamp());const g=yg(c,d.expectedCount);g!==null&&(f.expectedCount=g)}return f}(this.serializer,e);const i=WD(this.serializer,e);i&&(t.labels=i),this.Q_(t)}X_(e){const t={};t.database=bg(this.serializer),t.removeTarget=e,this.Q_(t)}}class FM extends Gj{constructor(e,t,i,o,c,d){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,o,d),this.serializer=c}get ea(){return this.M_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.ea&&this.ta([])}H_(e,t){return this.connection.I_("Write",e,t)}J_(e){return Je(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Je(!e.writeResults||e.writeResults.length===0,55816),this.listener.na()}onNext(e){Je(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.x_.reset();const t=YD(e.writeResults,e.commitTime),i=Gn(e.commitTime);return this.listener.ra(i,t)}ia(){const e={};e.database=bg(this.serializer),this.Q_(e)}ta(e){const t={streamToken:this.lastStreamToken,writes:e.map(i=>Lj(this.serializer,i))};this.Q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qM{}class BM extends qM{constructor(e,t,i,o){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=o,this.sa=!1}oa(){if(this.sa)throw new ge(ie.FAILED_PRECONDITION,"The client has already been terminated.")}zo(e,t,i,o){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([c,d])=>this.connection.zo(e,xg(t,i),o,c,d)).catch(c=>{throw c.name==="FirebaseError"?(c.code===ie.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new ge(ie.UNKNOWN,c.toString())})}Yo(e,t,i,o,c){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,f])=>this.connection.Yo(e,xg(t,i),o,d,f,c)).catch(d=>{throw d.name==="FirebaseError"?(d.code===ie.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new ge(ie.UNKNOWN,d.toString())})}terminate(){this.sa=!0,this.connection.terminate()}}class zM{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this._a=0,this.aa=null,this.ua=!0}ca(){this._a===0&&(this.la("Unknown"),this.aa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.aa=null,this.ha("Backend didn't respond within 10 seconds."),this.la("Offline"),Promise.resolve())))}Pa(e){this.state==="Online"?this.la("Unknown"):(this._a++,this._a>=1&&(this.Ta(),this.ha(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.la("Offline")))}set(e){this.Ta(),this._a=0,e==="Online"&&(this.ua=!1),this.la(e)}la(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ha(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ua?(ka(t),this.ua=!1):ye("OnlineStateTracker",t)}Ta(){this.aa!==null&&(this.aa.cancel(),this.aa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Or="RemoteStore";class HM{constructor(e,t,i,o,c){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.Ia=[],this.Ea=new Map,this.da=new Set,this.Aa=[],this.Ra=c,this.Ra.No(d=>{i.enqueueAndForget(async()=>{Br(this)&&(ye(Or,"Restarting streams for network reachability change."),await async function(p){const g=ke(p);g.da.add(4),await vu(g),g.Va.set("Unknown"),g.da.delete(4),await cf(g)}(this))})}),this.Va=new zM(i,o)}}async function cf(n){if(Br(n))for(const e of n.Aa)await e(!0)}async function vu(n){for(const e of n.Aa)await e(!1)}function $j(n,e){const t=ke(n);t.Ea.has(e.targetId)||(t.Ea.set(e.targetId,e),mv(t)?fv(t):pl(t).N_()&&hv(t,e))}function dv(n,e){const t=ke(n),i=pl(t);t.Ea.delete(e),i.N_()&&Yj(t,e),t.Ea.size===0&&(i.N_()?i.k_():Br(t)&&t.Va.set("Unknown"))}function hv(n,e){if(n.ma.Ke(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Se.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}pl(n).Z_(e)}function Yj(n,e){n.ma.Ke(e),pl(n).X_(e)}function fv(n){n.ma=new VD({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Rt:e=>n.Ea.get(e)||null,Pt:()=>n.datastore.serializer.databaseId}),pl(n).start(),n.Va.ca()}function mv(n){return Br(n)&&!pl(n).O_()&&n.Ea.size>0}function Br(n){return ke(n).da.size===0}function Qj(n){n.ma=void 0}async function GM(n){n.Va.set("Online")}async function $M(n){n.Ea.forEach((e,t)=>{hv(n,e)})}async function YM(n,e){Qj(n),mv(n)?(n.Va.Pa(e),fv(n)):n.Va.set("Unknown")}async function QM(n,e,t){if(n.Va.set("Online"),e instanceof Dj&&e.state===2&&e.cause)try{await async function(o,c){const d=c.cause;for(const f of c.targetIds)o.Ea.has(f)&&(await o.remoteSyncer.rejectListen(f,d),o.Ea.delete(f),o.ma.removeTarget(f))}(n,e)}catch(i){ye(Or,"Failed to remove targets %s: %s ",e.targetIds.join(","),i),await Ph(n,i)}else if(e instanceof mh?n.ma.Xe(e):e instanceof Rj?n.ma.ot(e):n.ma.nt(e),!t.isEqual(Se.min()))try{const i=await Hj(n.localStore);t.compareTo(i)>=0&&await function(c,d){const f=c.ma.It(d);return f.targetChanges.forEach((p,g)=>{if(p.resumeToken.approximateByteSize()>0){const y=c.Ea.get(g);y&&c.Ea.set(g,y.withResumeToken(p.resumeToken,d))}}),f.targetMismatches.forEach((p,g)=>{const y=c.Ea.get(p);if(!y)return;c.Ea.set(p,y.withResumeToken(un.EMPTY_BYTE_STRING,y.snapshotVersion)),Yj(c,p);const b=new xi(y.target,p,g,y.sequenceNumber);hv(c,b)}),c.remoteSyncer.applyRemoteEvent(f)}(n,t)}catch(i){ye(Or,"Failed to raise snapshot:",i),await Ph(n,i)}}async function Ph(n,e,t){if(!fl(e))throw e;n.da.add(1),await vu(n),n.Va.set("Offline"),t||(t=()=>Hj(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{ye(Or,"Retrying IndexedDB access"),await t(),n.da.delete(1),await cf(n)})}function Kj(n,e){return e().catch(t=>Ph(n,t,e))}async function uf(n){const e=ke(n),t=Ri(e);let i=e.Ia.length>0?e.Ia[e.Ia.length-1].batchId:Wg;for(;KM(e);)try{const o=await IM(e.localStore,i);if(o===null){e.Ia.length===0&&t.k_();break}i=o.batchId,XM(e,o)}catch(o){await Ph(e,o)}Xj(e)&&Wj(e)}function KM(n){return Br(n)&&n.Ia.length<10}function XM(n,e){n.Ia.push(e);const t=Ri(n);t.N_()&&t.ea&&t.ta(e.mutations)}function Xj(n){return Br(n)&&!Ri(n).O_()&&n.Ia.length>0}function Wj(n){Ri(n).start()}async function WM(n){Ri(n).ia()}async function ZM(n){const e=Ri(n);for(const t of n.Ia)e.ta(t.mutations)}async function JM(n,e,t){const i=n.Ia.shift(),o=sv.from(i,e,t);await Kj(n,()=>n.remoteSyncer.applySuccessfulWrite(o)),await uf(n)}async function ek(n,e){e&&Ri(n).ea&&await async function(i,o){if(function(d){return Sj(d)&&d!==ie.ABORTED}(o.code)){const c=i.Ia.shift();Ri(i).L_(),await Kj(i,()=>i.remoteSyncer.rejectFailedWrite(c.batchId,o)),await uf(i)}}(n,e),Xj(n)&&Wj(n)}async function BE(n,e){const t=ke(n);t.asyncQueue.verifyOperationInProgress(),ye(Or,"RemoteStore received new credentials");const i=Br(t);t.da.add(3),await vu(t),i&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.da.delete(3),await cf(t)}async function tk(n,e){const t=ke(n);e?(t.da.delete(2),await cf(t)):e||(t.da.add(2),await vu(t),t.Va.set("Unknown"))}function pl(n){return n.fa||(n.fa=function(t,i,o){const c=ke(t);return c.oa(),new UM(i,c.connection,c.authCredentials,c.appCheckCredentials,c.serializer,o)}(n.datastore,n.asyncQueue,{e_:GM.bind(null,n),n_:$M.bind(null,n),i_:YM.bind(null,n),Y_:QM.bind(null,n)}),n.Aa.push(async e=>{e?(n.fa.L_(),mv(n)?fv(n):n.Va.set("Unknown")):(await n.fa.stop(),Qj(n))})),n.fa}function Ri(n){return n.ga||(n.ga=function(t,i,o){const c=ke(t);return c.oa(),new FM(i,c.connection,c.authCredentials,c.appCheckCredentials,c.serializer,o)}(n.datastore,n.asyncQueue,{e_:()=>Promise.resolve(),n_:WM.bind(null,n),i_:ek.bind(null,n),na:ZM.bind(null,n),ra:JM.bind(null,n)}),n.Aa.push(async e=>{e?(n.ga.L_(),await uf(n)):(await n.ga.stop(),n.Ia.length>0&&(ye(Or,`Stopping write stream with ${n.Ia.length} pending writes`),n.Ia=[]))})),n.ga}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pv{constructor(e,t,i,o,c){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=o,this.removalCallback=c,this.deferred=new Ks,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(d=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,o,c){const d=Date.now()+i,f=new pv(e,t,d,o,c);return f.start(i),f}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ge(ie.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function gv(n,e){if(ka("AsyncQueue",`${e}: ${n}`),fl(n))return new ge(ie.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo{static emptySet(e){return new Wo(e.comparator)}constructor(e){this.comparator=e?(t,i)=>e(t,i)||_e.comparator(t.key,i.key):(t,i)=>_e.comparator(t.key,i.key),this.keyedMap=Dc(),this.sortedSet=new _t(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Wo)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const o=t.getNext().key,c=i.getNext().key;if(!o.isEqual(c))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new Wo;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zE{constructor(){this.pa=new _t(_e.comparator)}track(e){const t=e.doc.key,i=this.pa.get(t);i?e.type!==0&&i.type===3?this.pa=this.pa.insert(t,e):e.type===3&&i.type!==1?this.pa=this.pa.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.pa=this.pa.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.pa=this.pa.remove(t):e.type===1&&i.type===2?this.pa=this.pa.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):je(63341,{Vt:e,ya:i}):this.pa=this.pa.insert(t,e)}wa(){const e=[];return this.pa.inorderTraversal((t,i)=>{e.push(i)}),e}}class il{constructor(e,t,i,o,c,d,f,p,g){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=o,this.mutatedKeys=c,this.fromCache=d,this.syncStateChanged=f,this.excludesMetadataChanges=p,this.hasCachedResults=g}static fromInitialDocuments(e,t,i,o,c){const d=[];return t.forEach(f=>{d.push({type:0,doc:f})}),new il(e,t,Wo.emptySet(t),d,i,o,!0,!1,c)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&tf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let o=0;o<t.length;o++)if(t[o].type!==i[o].type||!t[o].doc.isEqual(i[o].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nk{constructor(){this.ba=void 0,this.Sa=[]}Da(){return this.Sa.some(e=>e.va())}}class sk{constructor(){this.queries=HE(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,i){const o=ke(t),c=o.queries;o.queries=HE(),c.forEach((d,f)=>{for(const p of f.Sa)p.onError(i)})})(this,new ge(ie.ABORTED,"Firestore shutting down"))}}function HE(){return new qr(n=>gj(n),tf)}async function vv(n,e){const t=ke(n);let i=3;const o=e.query;let c=t.queries.get(o);c?!c.Da()&&e.va()&&(i=2):(c=new nk,i=e.va()?0:1);try{switch(i){case 0:c.ba=await t.onListen(o,!0);break;case 1:c.ba=await t.onListen(o,!1);break;case 2:await t.onFirstRemoteStoreListen(o)}}catch(d){const f=gv(d,`Initialization of query '${qo(e.query)}' failed`);return void e.onError(f)}t.queries.set(o,c),c.Sa.push(e),e.Fa(t.onlineState),c.ba&&e.Ma(c.ba)&&xv(t)}async function yv(n,e){const t=ke(n),i=e.query;let o=3;const c=t.queries.get(i);if(c){const d=c.Sa.indexOf(e);d>=0&&(c.Sa.splice(d,1),c.Sa.length===0?o=e.va()?0:1:!c.Da()&&e.va()&&(o=2))}switch(o){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}}function ak(n,e){const t=ke(n);let i=!1;for(const o of e){const c=o.query,d=t.queries.get(c);if(d){for(const f of d.Sa)f.Ma(o)&&(i=!0);d.ba=o}}i&&xv(t)}function ik(n,e,t){const i=ke(n),o=i.queries.get(e);if(o)for(const c of o.Sa)c.onError(t);i.queries.delete(e)}function xv(n){n.Ca.forEach(e=>{e.next()})}var _g,GE;(GE=_g||(_g={})).xa="default",GE.Cache="cache";class bv{constructor(e,t,i){this.query=e,this.Oa=t,this.Na=!1,this.Ba=null,this.onlineState="Unknown",this.options=i||{}}Ma(e){if(!this.options.includeMetadataChanges){const i=[];for(const o of e.docChanges)o.type!==3&&i.push(o);e=new il(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Na?this.La(e)&&(this.Oa.next(e),t=!0):this.ka(e,this.onlineState)&&(this.qa(e),t=!0),this.Ba=e,t}onError(e){this.Oa.error(e)}Fa(e){this.onlineState=e;let t=!1;return this.Ba&&!this.Na&&this.ka(this.Ba,e)&&(this.qa(this.Ba),t=!0),t}ka(e,t){if(!e.fromCache||!this.va())return!0;const i=t!=="Offline";return(!this.options.Qa||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}La(e){if(e.docChanges.length>0)return!0;const t=this.Ba&&this.Ba.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}qa(e){e=il.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Na=!0,this.Oa.next(e)}va(){return this.options.source!==_g.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zj{constructor(e){this.key=e}}class Jj{constructor(e){this.key=e}}class rk{constructor(e,t){this.query=e,this.Ha=t,this.Ja=null,this.hasCachedResults=!1,this.current=!1,this.Ya=Qe(),this.mutatedKeys=Qe(),this.Za=vj(e),this.Xa=new Wo(this.Za)}get eu(){return this.Ha}tu(e,t){const i=t?t.nu:new zE,o=t?t.Xa:this.Xa;let c=t?t.mutatedKeys:this.mutatedKeys,d=o,f=!1;const p=this.query.limitType==="F"&&o.size===this.query.limit?o.last():null,g=this.query.limitType==="L"&&o.size===this.query.limit?o.first():null;if(e.inorderTraversal((y,b)=>{const E=o.get(y),j=nf(this.query,b)?b:null,N=!!E&&this.mutatedKeys.has(E.key),w=!!j&&(j.hasLocalMutations||this.mutatedKeys.has(j.key)&&j.hasCommittedMutations);let T=!1;E&&j?E.data.isEqual(j.data)?N!==w&&(i.track({type:3,doc:j}),T=!0):this.ru(E,j)||(i.track({type:2,doc:j}),T=!0,(p&&this.Za(j,p)>0||g&&this.Za(j,g)<0)&&(f=!0)):!E&&j?(i.track({type:0,doc:j}),T=!0):E&&!j&&(i.track({type:1,doc:E}),T=!0,(p||g)&&(f=!0)),T&&(j?(d=d.add(j),c=w?c.add(y):c.delete(y)):(d=d.delete(y),c=c.delete(y)))}),this.query.limit!==null)for(;d.size>this.query.limit;){const y=this.query.limitType==="F"?d.last():d.first();d=d.delete(y.key),c=c.delete(y.key),i.track({type:1,doc:y})}return{Xa:d,nu:i,Cs:f,mutatedKeys:c}}ru(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,o){const c=this.Xa;this.Xa=e.Xa,this.mutatedKeys=e.mutatedKeys;const d=e.nu.wa();d.sort((y,b)=>function(j,N){const w=T=>{switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return je(20277,{Vt:T})}};return w(j)-w(N)}(y.type,b.type)||this.Za(y.doc,b.doc)),this.iu(i),o=o!=null&&o;const f=t&&!o?this.su():[],p=this.Ya.size===0&&this.current&&!o?1:0,g=p!==this.Ja;return this.Ja=p,d.length!==0||g?{snapshot:new il(this.query,e.Xa,c,d,e.mutatedKeys,p===0,g,!1,!!i&&i.resumeToken.approximateByteSize()>0),ou:f}:{ou:f}}Fa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Xa:this.Xa,nu:new zE,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ou:[]}}_u(e){return!this.Ha.has(e)&&!!this.Xa.has(e)&&!this.Xa.get(e).hasLocalMutations}iu(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}su(){if(!this.current)return[];const e=this.Ya;this.Ya=Qe(),this.Xa.forEach(i=>{this._u(i.key)&&(this.Ya=this.Ya.add(i.key))});const t=[];return e.forEach(i=>{this.Ya.has(i)||t.push(new Jj(i))}),this.Ya.forEach(i=>{e.has(i)||t.push(new Zj(i))}),t}au(e){this.Ha=e.$s,this.Ya=Qe();const t=this.tu(e.documents);return this.applyChanges(t,!0)}uu(){return il.fromInitialDocuments(this.query,this.Xa,this.mutatedKeys,this.Ja===0,this.hasCachedResults)}}const Nv="SyncEngine";class ok{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class lk{constructor(e){this.key=e,this.cu=!1}}class ck{constructor(e,t,i,o,c,d){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=o,this.currentUser=c,this.maxConcurrentLimboResolutions=d,this.lu={},this.hu=new qr(f=>gj(f),tf),this.Pu=new Map,this.Tu=new Set,this.Iu=new _t(_e.comparator),this.Eu=new Map,this.du=new rv,this.Au={},this.Ru=new Map,this.Vu=al.lr(),this.onlineState="Unknown",this.mu=void 0}get isPrimaryClient(){return this.mu===!0}}async function uk(n,e,t=!0){const i=i0(n);let o;const c=i.hu.get(e);return c?(i.sharedClientState.addLocalQueryTarget(c.targetId),o=c.view.uu()):o=await e0(i,e,t,!0),o}async function dk(n,e){const t=i0(n);await e0(t,e,!0,!1)}async function e0(n,e,t,i){const o=await RM(n.localStore,Xs(e)),c=o.targetId,d=n.sharedClientState.addLocalQueryTarget(c,t);let f;return i&&(f=await hk(n,e,c,d==="current",o.resumeToken)),n.isPrimaryClient&&t&&$j(n.remoteStore,o),f}async function hk(n,e,t,i,o){n.fu=(b,E,j)=>async function(w,T,S,q){let I=T.view.tu(S);I.Cs&&(I=await LE(w.localStore,T.query,!1).then(({documents:F})=>T.view.tu(F,I)));const O=q&&q.targetChanges.get(T.targetId),U=q&&q.targetMismatches.get(T.targetId)!=null,$=T.view.applyChanges(I,w.isPrimaryClient,O,U);return YE(w,T.targetId,$.ou),$.snapshot}(n,b,E,j);const c=await LE(n.localStore,e,!0),d=new rk(e,c.$s),f=d.tu(c.documents),p=gu.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",o),g=d.applyChanges(f,n.isPrimaryClient,p);YE(n,t,g.ou);const y=new ok(e,t,d);return n.hu.set(e,y),n.Pu.has(t)?n.Pu.get(t).push(e):n.Pu.set(t,[e]),g.snapshot}async function fk(n,e,t){const i=ke(n),o=i.hu.get(e),c=i.Pu.get(o.targetId);if(c.length>1)return i.Pu.set(o.targetId,c.filter(d=>!tf(d,e))),void i.hu.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(o.targetId),i.sharedClientState.isActiveQueryTarget(o.targetId)||await Ng(i.localStore,o.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(o.targetId),t&&dv(i.remoteStore,o.targetId),Tg(i,o.targetId)}).catch(hl)):(Tg(i,o.targetId),await Ng(i.localStore,o.targetId,!0))}async function mk(n,e){const t=ke(n),i=t.hu.get(e),o=t.Pu.get(i.targetId);t.isPrimaryClient&&o.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),dv(t.remoteStore,i.targetId))}async function pk(n,e,t){const i=Ek(n);try{const o=await function(d,f){const p=ke(d),g=zt.now(),y=f.reduce((j,N)=>j.add(N.key),Qe());let b,E;return p.persistence.runTransaction("Locally write mutations","readwrite",j=>{let N=Oa(),w=Qe();return p.Bs.getEntries(j,y).next(T=>{N=T,N.forEach((S,q)=>{q.isValidDocument()||(w=w.add(S))})}).next(()=>p.localDocuments.getOverlayedDocuments(j,N)).next(T=>{b=T;const S=[];for(const q of f){const I=MD(q,b.get(q.key).overlayedDocument);I!=null&&S.push(new qi(q.key,I,lj(I.value.mapValue),ln.exists(!0)))}return p.mutationQueue.addMutationBatch(j,g,S,f)}).next(T=>{E=T;const S=T.applyToLocalDocumentSet(b,w);return p.documentOverlayCache.saveOverlays(j,T.batchId,S)})}).then(()=>({batchId:E.batchId,changes:xj(b)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(o.batchId),function(d,f,p){let g=d.Au[d.currentUser.toKey()];g||(g=new _t(qe)),g=g.insert(f,p),d.Au[d.currentUser.toKey()]=g}(i,o.batchId,t),await yu(i,o.changes),await uf(i.remoteStore)}catch(o){const c=gv(o,"Failed to persist write");t.reject(c)}}async function t0(n,e){const t=ke(n);try{const i=await wM(t.localStore,e);e.targetChanges.forEach((o,c)=>{const d=t.Eu.get(c);d&&(Je(o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size<=1,22616),o.addedDocuments.size>0?d.cu=!0:o.modifiedDocuments.size>0?Je(d.cu,14607):o.removedDocuments.size>0&&(Je(d.cu,42227),d.cu=!1))}),await yu(t,i,e)}catch(i){await hl(i)}}function $E(n,e,t){const i=ke(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const o=[];i.hu.forEach((c,d)=>{const f=d.view.Fa(e);f.snapshot&&o.push(f.snapshot)}),function(d,f){const p=ke(d);p.onlineState=f;let g=!1;p.queries.forEach((y,b)=>{for(const E of b.Sa)E.Fa(f)&&(g=!0)}),g&&xv(p)}(i.eventManager,e),o.length&&i.lu.Y_(o),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function gk(n,e,t){const i=ke(n);i.sharedClientState.updateQueryState(e,"rejected",t);const o=i.Eu.get(e),c=o&&o.key;if(c){let d=new _t(_e.comparator);d=d.insert(c,Jt.newNoDocument(c,Se.min()));const f=Qe().add(c),p=new of(Se.min(),new Map,new _t(qe),d,f);await t0(i,p),i.Iu=i.Iu.remove(c),i.Eu.delete(e),Ev(i)}else await Ng(i.localStore,e,!1).then(()=>Tg(i,e,t)).catch(hl)}async function vk(n,e){const t=ke(n),i=e.batch.batchId;try{const o=await CM(t.localStore,e);s0(t,i,null),n0(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await yu(t,o)}catch(o){await hl(o)}}async function yk(n,e,t){const i=ke(n);try{const o=await function(d,f){const p=ke(d);return p.persistence.runTransaction("Reject batch","readwrite-primary",g=>{let y;return p.mutationQueue.lookupMutationBatch(g,f).next(b=>(Je(b!==null,37113),y=b.keys(),p.mutationQueue.removeMutationBatch(g,b))).next(()=>p.mutationQueue.performConsistencyCheck(g)).next(()=>p.documentOverlayCache.removeOverlaysForBatchId(g,y,f)).next(()=>p.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(g,y)).next(()=>p.localDocuments.getDocuments(g,y))})}(i.localStore,e);s0(i,e,t),n0(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await yu(i,o)}catch(o){await hl(o)}}function n0(n,e){(n.Ru.get(e)||[]).forEach(t=>{t.resolve()}),n.Ru.delete(e)}function s0(n,e,t){const i=ke(n);let o=i.Au[i.currentUser.toKey()];if(o){const c=o.get(e);c&&(t?c.reject(t):c.resolve(),o=o.remove(e)),i.Au[i.currentUser.toKey()]=o}}function Tg(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.Pu.get(e))n.hu.delete(i),t&&n.lu.gu(i,t);n.Pu.delete(e),n.isPrimaryClient&&n.du.Hr(e).forEach(i=>{n.du.containsKey(i)||a0(n,i)})}function a0(n,e){n.Tu.delete(e.path.canonicalString());const t=n.Iu.get(e);t!==null&&(dv(n.remoteStore,t),n.Iu=n.Iu.remove(e),n.Eu.delete(t),Ev(n))}function YE(n,e,t){for(const i of t)i instanceof Zj?(n.du.addReference(i.key,e),xk(n,i)):i instanceof Jj?(ye(Nv,"Document no longer in limbo: "+i.key),n.du.removeReference(i.key,e),n.du.containsKey(i.key)||a0(n,i.key)):je(19791,{pu:i})}function xk(n,e){const t=e.key,i=t.path.canonicalString();n.Iu.get(t)||n.Tu.has(i)||(ye(Nv,"New document in limbo: "+t),n.Tu.add(i),Ev(n))}function Ev(n){for(;n.Tu.size>0&&n.Iu.size<n.maxConcurrentLimboResolutions;){const e=n.Tu.values().next().value;n.Tu.delete(e);const t=new _e(ft.fromString(e)),i=n.Vu.next();n.Eu.set(i,new lk(t)),n.Iu=n.Iu.insert(t,i),$j(n.remoteStore,new xi(Xs(ef(t.path)),i,"TargetPurposeLimboResolution",Zh.le))}}async function yu(n,e,t){const i=ke(n),o=[],c=[],d=[];i.hu.isEmpty()||(i.hu.forEach((f,p)=>{d.push(i.fu(p,e,t).then(g=>{var y;if((g||t)&&i.isPrimaryClient){const b=g?!g.fromCache:(y=t?.targetChanges.get(p.targetId))===null||y===void 0?void 0:y.current;i.sharedClientState.updateQueryState(p.targetId,b?"current":"not-current")}if(g){o.push(g);const b=lv.Rs(p.targetId,g);c.push(b)}}))}),await Promise.all(d),i.lu.Y_(o),await async function(p,g){const y=ke(p);try{await y.persistence.runTransaction("notifyLocalViewChanges","readwrite",b=>oe.forEach(g,E=>oe.forEach(E.ds,j=>y.persistence.referenceDelegate.addReference(b,E.targetId,j)).next(()=>oe.forEach(E.As,j=>y.persistence.referenceDelegate.removeReference(b,E.targetId,j)))))}catch(b){if(!fl(b))throw b;ye(cv,"Failed to update sequence numbers: "+b)}for(const b of g){const E=b.targetId;if(!b.fromCache){const j=y.xs.get(E),N=j.snapshotVersion,w=j.withLastLimboFreeSnapshotVersion(N);y.xs=y.xs.insert(E,w)}}}(i.localStore,c))}async function bk(n,e){const t=ke(n);if(!t.currentUser.isEqual(e)){ye(Nv,"User change. New user:",e.toKey());const i=await zj(t.localStore,e);t.currentUser=e,function(c,d){c.Ru.forEach(f=>{f.forEach(p=>{p.reject(new ge(ie.CANCELLED,d))})}),c.Ru.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await yu(t,i.ks)}}function Nk(n,e){const t=ke(n),i=t.Eu.get(e);if(i&&i.cu)return Qe().add(i.key);{let o=Qe();const c=t.Pu.get(e);if(!c)return o;for(const d of c){const f=t.hu.get(d);o=o.unionWith(f.view.eu)}return o}}function i0(n){const e=ke(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=t0.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Nk.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=gk.bind(null,e),e.lu.Y_=ak.bind(null,e.eventManager),e.lu.gu=ik.bind(null,e.eventManager),e}function Ek(n){const e=ke(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=vk.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=yk.bind(null,e),e}class Lh{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=lf(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Su(e),await this.persistence.start(),this.localStore=this.Du(e),this.gcScheduler=this.vu(e,this.localStore),this.indexBackfillerScheduler=this.Cu(e,this.localStore)}vu(e,t){return null}Cu(e,t){return null}Du(e){return AM(this.persistence,new _M,e.initialUser,this.serializer)}Su(e){return new Bj(ov.fi,this.serializer)}bu(e){return new MM}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Lh.provider={build:()=>new Lh};class _k extends Lh{constructor(e){super(),this.cacheSizeBytes=e}vu(e,t){Je(this.persistence.referenceDelegate instanceof Oh,46915);const i=this.persistence.referenceDelegate.garbageCollector;return new lM(i,e.asyncQueue,t)}Su(e){const t=this.cacheSizeBytes!==void 0?Rn.withCacheSize(this.cacheSizeBytes):Rn.DEFAULT;return new Bj(i=>Oh.fi(i,t),this.serializer)}}class jg{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>$E(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=bk.bind(null,this.syncEngine),await tk(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new sk}()}createDatastore(e){const t=lf(e.databaseInfo.databaseId),i=function(c){return new VM(c)}(e.databaseInfo);return function(c,d,f,p){return new BM(c,d,f,p)}(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return function(i,o,c,d,f){return new HM(i,o,c,d,f)}(this.localStore,this.datastore,e.asyncQueue,t=>$E(this.syncEngine,t,0),function(){return FE.C()?new FE:new kM}())}createSyncEngine(e,t){return function(o,c,d,f,p,g,y){const b=new ck(o,c,d,f,p,g);return y&&(b.mu=!0),b}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(o){const c=ke(o);ye(Or,"RemoteStore shutting down."),c.da.add(5),await vu(c),c.Ra.shutdown(),c.Va.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}jg.provider={build:()=>new jg};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _v{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Mu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Mu(this.observer.error,e):ka("Uncaught Error in snapshot listener:",e.toString()))}xu(){this.muted=!0}Mu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tk{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new ge(ie.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(o,c){const d=ke(o),f={documents:c.map(b=>kh(d.serializer,b))},p=await d.Yo("BatchGetDocuments",d.serializer.databaseId,ft.emptyPath(),f,c.length),g=new Map;p.forEach(b=>{const E=GD(d.serializer,b);g.set(E.key.toString(),E)});const y=[];return c.forEach(b=>{const E=g.get(b.toString());Je(!!E,55234,{key:b}),y.push(E)}),y}(this.datastore,e);return t.forEach(i=>this.recordVersion(i)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(i){this.lastTransactionError=i}this.writtenDocs.add(e.toString())}delete(e){this.write(new rf(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,i)=>{const o=_e.fromPath(i);this.mutations.push(new wj(o,this.precondition(o)))}),await async function(i,o){const c=ke(i),d={writes:o.map(f=>Lj(c.serializer,f))};await c.zo("Commit",c.serializer.databaseId,ft.emptyPath(),d)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw je(50498,{Uu:e.constructor.name});t=Se.min()}const i=this.readVersions.get(e.key.toString());if(i){if(!t.isEqual(i))throw new ge(ie.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Se.min())?ln.exists(!1):ln.updateTime(t):ln.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Se.min()))throw new ge(ie.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ln.updateTime(t)}return ln.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk{constructor(e,t,i,o,c){this.asyncQueue=e,this.datastore=t,this.options=i,this.updateFunction=o,this.deferred=c,this.Ku=i.maxAttempts,this.x_=new uv(this.asyncQueue,"transaction_retry")}Wu(){this.Ku-=1,this.Gu()}Gu(){this.x_.y_(async()=>{const e=new Tk(this.datastore),t=this.zu(e);t&&t.then(i=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(i)}).catch(o=>{this.ju(o)}))}).catch(i=>{this.ju(i)})})}zu(e){try{const t=this.updateFunction(e);return!mu(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ju(e){this.Ku>0&&this.Hu(e)?(this.Ku-=1,this.asyncQueue.enqueueAndForget(()=>(this.Gu(),Promise.resolve()))):this.deferred.reject(e)}Hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!Sj(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Di="FirestoreClient";class Ak{constructor(e,t,i,o,c){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=o,this.user=pn.UNAUTHENTICATED,this.clientId=ZT.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=c,this.authCredentials.start(i,async d=>{ye(Di,"Received user=",d.uid),await this.authCredentialListener(d),this.user=d}),this.appCheckCredentials.start(i,d=>(ye(Di,"Received new app check token=",d),this.appCheckCredentialListener(d,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ks;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=gv(t,"Failed to shutdown persistence");e.reject(i)}}),e.promise}}async function zp(n,e){n.asyncQueue.verifyOperationInProgress(),ye(Di,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(async o=>{i.isEqual(o)||(await zj(e.localStore,o),i=o)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function QE(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Ck(n);ye(Di,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(i=>BE(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,o)=>BE(e.remoteStore,o)),n._onlineComponents=e}async function Ck(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){ye(Di,"Using user provided OfflineComponentProvider");try{await zp(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(o){return o.name==="FirebaseError"?o.code===ie.FAILED_PRECONDITION||o.code===ie.UNIMPLEMENTED:!(typeof DOMException<"u"&&o instanceof DOMException)||o.code===22||o.code===20||o.code===11}(t))throw t;el("Error using user provided cache. Falling back to memory cache: "+t),await zp(n,new Lh)}}else ye(Di,"Using default OfflineComponentProvider"),await zp(n,new _k(void 0));return n._offlineComponents}async function Tv(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(ye(Di,"Using user provided OnlineComponentProvider"),await QE(n,n._uninitializedComponentsProvider._online)):(ye(Di,"Using default OnlineComponentProvider"),await QE(n,new jg))),n._onlineComponents}function wk(n){return Tv(n).then(e=>e.syncEngine)}function Sk(n){return Tv(n).then(e=>e.datastore)}async function Vh(n){const e=await Tv(n),t=e.eventManager;return t.onListen=uk.bind(null,e.syncEngine),t.onUnlisten=fk.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=dk.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=mk.bind(null,e.syncEngine),t}function Ik(n,e,t={}){const i=new Ks;return n.asyncQueue.enqueueAndForget(async()=>function(c,d,f,p,g){const y=new _v({next:E=>{y.xu(),d.enqueueAndForget(()=>yv(c,b));const j=E.docs.has(f);!j&&E.fromCache?g.reject(new ge(ie.UNAVAILABLE,"Failed to get document because the client is offline.")):j&&E.fromCache&&p&&p.source==="server"?g.reject(new ge(ie.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):g.resolve(E)},error:E=>g.reject(E)}),b=new bv(ef(f.path),y,{includeMetadataChanges:!0,Qa:!0});return vv(c,b)}(await Vh(n),n.asyncQueue,e,t,i)),i.promise}function Rk(n,e,t={}){const i=new Ks;return n.asyncQueue.enqueueAndForget(async()=>function(c,d,f,p,g){const y=new _v({next:E=>{y.xu(),d.enqueueAndForget(()=>yv(c,b)),E.fromCache&&p.source==="server"?g.reject(new ge(ie.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):g.resolve(E)},error:E=>g.reject(E)}),b=new bv(f,y,{includeMetadataChanges:!0,Qa:!0});return vv(c,b)}(await Vh(n),n.asyncQueue,e,t,i)),i.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r0(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KE=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o0(n,e,t){if(!t)throw new ge(ie.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Dk(n,e,t,i){if(e===!0&&i===!0)throw new ge(ie.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function XE(n){if(!_e.isDocumentKey(n))throw new ge(ie.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function WE(n){if(_e.isDocumentKey(n))throw new ge(ie.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function df(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(i){return i.constructor?i.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":je(12329,{type:typeof n})}function An(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new ge(ie.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=df(n);throw new ge(ie.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l0="firestore.googleapis.com",ZE=!0;class JE{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new ge(ie.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=l0,this.ssl=ZE}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:ZE;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=qj;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<rM)throw new ge(ie.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Dk("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=r0((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),function(c){if(c.timeoutSeconds!==void 0){if(isNaN(c.timeoutSeconds))throw new ge(ie.INVALID_ARGUMENT,`invalid long polling timeout: ${c.timeoutSeconds} (must not be NaN)`);if(c.timeoutSeconds<5)throw new ge(ie.INVALID_ARGUMENT,`invalid long polling timeout: ${c.timeoutSeconds} (minimum allowed value is 5)`);if(c.timeoutSeconds>30)throw new ge(ie.INVALID_ARGUMENT,`invalid long polling timeout: ${c.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(i,o){return i.timeoutSeconds===o.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class hf{constructor(e,t,i,o){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=o,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new JE({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ge(ie.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ge(ie.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new JE(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new V1;switch(i.type){case"firstParty":return new B1(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new ge(ie.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const i=KE.get(t);i&&(ye("ComponentProvider","Removing Datastore"),KE.delete(t),i.terminate())}(this),Promise.resolve()}}function Mk(n,e,t,i={}){var o;n=An(n,hf);const c=Ur(e),d=n._getSettings(),f=Object.assign(Object.assign({},d),{emulatorOptions:n._getEmulatorOptions()}),p=`${e}:${t}`;c&&(kg(`https://${p}`),Og("Firestore",!0)),d.host!==l0&&d.host!==p&&el("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const g=Object.assign(Object.assign({},d),{host:p,ssl:c,emulatorOptions:i});if(!Ai(g,f)&&(n._setSettings(g),i.mockUserToken)){let y,b;if(typeof i.mockUserToken=="string")y=i.mockUserToken,b=pn.MOCK_USER;else{y=sT(i.mockUserToken,(o=n._app)===null||o===void 0?void 0:o.options.projectId);const E=i.mockUserToken.sub||i.mockUserToken.user_id;if(!E)throw new ge(ie.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");b=new pn(E)}n._authCredentials=new U1(new XT(y,b))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new La(this.firestore,e,this._query)}}class cn{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _i(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new cn(this.firestore,e,this._key)}}class _i extends La{constructor(e,t,i){super(e,t,ef(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new cn(this.firestore,null,new _e(e))}withConverter(e){return new _i(this.firestore,e,this._path)}}function Ee(n,e,...t){if(n=yt(n),o0("collection","path",e),n instanceof hf){const i=ft.fromString(e,...t);return WE(i),new _i(n,null,i)}{if(!(n instanceof cn||n instanceof _i))throw new ge(ie.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(ft.fromString(e,...t));return WE(i),new _i(n.firestore,null,i)}}function et(n,e,...t){if(n=yt(n),arguments.length===1&&(e=ZT.newId()),o0("doc","path",e),n instanceof hf){const i=ft.fromString(e,...t);return XE(i),new cn(n,null,new _e(i))}{if(!(n instanceof cn||n instanceof _i))throw new ge(ie.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(ft.fromString(e,...t));return XE(i),new cn(n.firestore,n instanceof _i?n.converter:null,new _e(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e_="AsyncQueue";class t_{constructor(e=Promise.resolve()){this.Ju=[],this.Yu=!1,this.Zu=[],this.Xu=null,this.ec=!1,this.tc=!1,this.nc=[],this.x_=new uv(this,"async_queue_retry"),this.rc=()=>{const i=Bp();i&&ye(e_,"Visibility state changed to "+i.visibilityState),this.x_.b_()},this.sc=e;const t=Bp();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.rc)}get isShuttingDown(){return this.Yu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.oc(),this._c(e)}enterRestrictedMode(e){if(!this.Yu){this.Yu=!0,this.tc=e||!1;const t=Bp();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.rc)}}enqueue(e){if(this.oc(),this.Yu)return new Promise(()=>{});const t=new Ks;return this._c(()=>this.Yu&&this.tc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ju.push(e),this.ac()))}async ac(){if(this.Ju.length!==0){try{await this.Ju[0](),this.Ju.shift(),this.x_.reset()}catch(e){if(!fl(e))throw e;ye(e_,"Operation failed with retryable error: "+e)}this.Ju.length>0&&this.x_.y_(()=>this.ac())}}_c(e){const t=this.sc.then(()=>(this.ec=!0,e().catch(i=>{throw this.Xu=i,this.ec=!1,ka("INTERNAL UNHANDLED ERROR: ",n_(i)),i}).then(i=>(this.ec=!1,i))));return this.sc=t,t}enqueueAfterDelay(e,t,i){this.oc(),this.nc.indexOf(e)>-1&&(t=0);const o=pv.createAndSchedule(this,e,t,i,c=>this.uc(c));return this.Zu.push(o),o}oc(){this.Xu&&je(47125,{cc:n_(this.Xu)})}verifyOperationInProgress(){}async lc(){let e;do e=this.sc,await e;while(e!==this.sc)}hc(e){for(const t of this.Zu)if(t.timerId===e)return!0;return!1}Pc(e){return this.lc().then(()=>{this.Zu.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.Zu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.lc()})}Tc(e){this.nc.push(e)}uc(e){const t=this.Zu.indexOf(e);this.Zu.splice(t,1)}}function n_(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s_(n){return function(t,i){if(typeof t!="object"||t===null)return!1;const o=t;for(const c of i)if(c in o&&typeof o[c]=="function")return!0;return!1}(n,["next","error","complete"])}class Zs extends hf{constructor(e,t,i,o){super(e,t,i,o),this.type="firestore",this._queue=new t_,this._persistenceKey=o?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new t_(e),this._firestoreClient=void 0,await e}}}function kk(n,e){const t=typeof n=="object"?n:cu(),i=typeof n=="string"?n:wh,o=Pa(t,"firestore").getImmediate({identifier:i});if(!o._initialized){const c=eT("firestore");c&&Mk(o,...c)}return o}function xu(n){if(n._terminated)throw new ge(ie.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Ok(n),n._firestoreClient}function Ok(n){var e,t,i;const o=n._freezeSettings(),c=function(f,p,g,y){return new sD(f,p,g,y.host,y.ssl,y.experimentalForceLongPolling,y.experimentalAutoDetectLongPolling,r0(y.experimentalLongPollingOptions),y.useFetchStreams,y.isUsingEmulator)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,o);n._componentsProvider||!((t=o.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=o.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider}),n._firestoreClient=new Ak(n._authCredentials,n._appCheckCredentials,n._queue,c,n._componentsProvider&&function(f){const p=f?._online.build();return{_offline:f?._offline.build(p),_online:p}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Pr(un.fromBase64String(e))}catch(t){throw new ge(ie.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Pr(un.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bu{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new ge(ie.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new on(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ff{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jv{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ge(ie.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ge(ie.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return qe(this._lat,e._lat)||qe(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Av{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(i,o){if(i.length!==o.length)return!1;for(let c=0;c<i.length;++c)if(i[c]!==o[c])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pk=/^__.*__$/;class Lk{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new qi(e,this.data,this.fieldMask,t,this.fieldTransforms):new pu(e,this.data,t,this.fieldTransforms)}}class c0{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new qi(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function u0(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw je(40011,{Ic:n})}}class Cv{constructor(e,t,i,o,c,d){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=o,c===void 0&&this.Ec(),this.fieldTransforms=c||[],this.fieldMask=d||[]}get path(){return this.settings.path}get Ic(){return this.settings.Ic}dc(e){return new Cv(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ac(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),o=this.dc({path:i,Rc:!1});return o.Vc(e),o}mc(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),o=this.dc({path:i,Rc:!1});return o.Ec(),o}fc(e){return this.dc({path:void 0,Rc:!0})}gc(e){return Uh(e,this.settings.methodName,this.settings.yc||!1,this.path,this.settings.wc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ec(){if(this.path)for(let e=0;e<this.path.length;e++)this.Vc(this.path.get(e))}Vc(e){if(e.length===0)throw this.gc("Document fields must not be empty");if(u0(this.Ic)&&Pk.test(e))throw this.gc('Document fields cannot begin and end with "__"')}}class Vk{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||lf(e)}bc(e,t,i,o=!1){return new Cv({Ic:e,methodName:t,wc:i,path:on.emptyPath(),Rc:!1,yc:o},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Nu(n){const e=n._freezeSettings(),t=lf(n._databaseId);return new Vk(n._databaseId,!!e.ignoreUndefinedProperties,t)}function wv(n,e,t,i,o,c={}){const d=n.bc(c.merge||c.mergeFields?2:0,e,t,o);Iv("Data must be an object, but it was:",d,i);const f=f0(i,d);let p,g;if(c.merge)p=new zn(d.fieldMask),g=d.fieldTransforms;else if(c.mergeFields){const y=[];for(const b of c.mergeFields){const E=Ag(e,b,t);if(!d.contains(E))throw new ge(ie.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);p0(y,E)||y.push(E)}p=new zn(y),g=d.fieldTransforms.filter(b=>p.covers(b.field))}else p=null,g=d.fieldTransforms;return new Lk(new jn(f),p,g)}class mf extends ff{_toFieldTransform(e){if(e.Ic!==2)throw e.Ic===1?e.gc(`${this._methodName}() can only appear at the top level of your update data`):e.gc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof mf}}class Sv extends ff{_toFieldTransform(e){return new SD(e.path,new tu)}isEqual(e){return e instanceof Sv}}function d0(n,e,t,i){const o=n.bc(1,e,t);Iv("Data must be an object, but it was:",o,i);const c=[],d=jn.empty();Fi(i,(p,g)=>{const y=Rv(e,p,t);g=yt(g);const b=o.mc(y);if(g instanceof mf)c.push(y);else{const E=Eu(g,b);E!=null&&(c.push(y),d.set(y,E))}});const f=new zn(c);return new c0(d,f,o.fieldTransforms)}function h0(n,e,t,i,o,c){const d=n.bc(1,e,t),f=[Ag(e,i,t)],p=[o];if(c.length%2!=0)throw new ge(ie.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let E=0;E<c.length;E+=2)f.push(Ag(e,c[E])),p.push(c[E+1]);const g=[],y=jn.empty();for(let E=f.length-1;E>=0;--E)if(!p0(g,f[E])){const j=f[E];let N=p[E];N=yt(N);const w=d.mc(j);if(N instanceof mf)g.push(j);else{const T=Eu(N,w);T!=null&&(g.push(j),y.set(j,T))}}const b=new zn(g);return new c0(y,b,d.fieldTransforms)}function Uk(n,e,t,i=!1){return Eu(t,n.bc(i?4:3,e))}function Eu(n,e){if(m0(n=yt(n)))return Iv("Unsupported field value:",e,n),f0(n,e);if(n instanceof ff)return function(i,o){if(!u0(o.Ic))throw o.gc(`${i._methodName}() can only be used with update() and set()`);if(!o.path)throw o.gc(`${i._methodName}() is not currently supported inside arrays`);const c=i._toFieldTransform(o);c&&o.fieldTransforms.push(c)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Rc&&e.Ic!==4)throw e.gc("Nested arrays are not supported");return function(i,o){const c=[];let d=0;for(const f of i){let p=Eu(f,o.fc(d));p==null&&(p={nullValue:"NULL_VALUE"}),c.push(p),d++}return{arrayValue:{values:c}}}(n,e)}return function(i,o){if((i=yt(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return AD(o.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const c=zt.fromDate(i);return{timestampValue:Mh(o.serializer,c)}}if(i instanceof zt){const c=new zt(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:Mh(o.serializer,c)}}if(i instanceof jv)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof Pr)return{bytesValue:Mj(o.serializer,i._byteString)};if(i instanceof cn){const c=o.databaseId,d=i.firestore._databaseId;if(!d.isEqual(c))throw o.gc(`Document reference is for database ${d.projectId}/${d.database} but should be for database ${c.projectId}/${c.database}`);return{referenceValue:iv(i.firestore._databaseId||o.databaseId,i._key.path)}}if(i instanceof Av)return function(d,f){return{mapValue:{fields:{[rj]:{stringValue:oj},[Sh]:{arrayValue:{values:d.toArray().map(g=>{if(typeof g!="number")throw f.gc("VectorValues must only contain numeric values.");return nv(f.serializer,g)})}}}}}}(i,o);throw o.gc(`Unsupported field value: ${df(i)}`)}(n,e)}function f0(n,e){const t={};return ej(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Fi(n,(i,o)=>{const c=Eu(o,e.Ac(i));c!=null&&(t[i]=c)}),{mapValue:{fields:t}}}function m0(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof zt||n instanceof jv||n instanceof Pr||n instanceof cn||n instanceof ff||n instanceof Av)}function Iv(n,e,t){if(!m0(t)||!function(o){return typeof o=="object"&&o!==null&&(Object.getPrototypeOf(o)===Object.prototype||Object.getPrototypeOf(o)===null)}(t)){const i=df(t);throw i==="an object"?e.gc(n+" a custom object"):e.gc(n+" "+i)}}function Ag(n,e,t){if((e=yt(e))instanceof bu)return e._internalPath;if(typeof e=="string")return Rv(n,e);throw Uh("Field path arguments must be of type string or ",n,!1,void 0,t)}const Fk=new RegExp("[~\\*/\\[\\]]");function Rv(n,e,t){if(e.search(Fk)>=0)throw Uh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new bu(...e.split("."))._internalPath}catch{throw Uh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Uh(n,e,t,i,o){const c=i&&!i.isEmpty(),d=o!==void 0;let f=`Function ${e}() called with invalid data`;t&&(f+=" (via `toFirestore()`)"),f+=". ";let p="";return(c||d)&&(p+=" (found",c&&(p+=` in field ${i}`),d&&(p+=` in document ${o}`),p+=")"),new ge(ie.INVALID_ARGUMENT,f+n+p)}function p0(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fh{constructor(e,t,i,o,c){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=o,this._converter=c}get id(){return this._key.path.lastSegment()}get ref(){return new cn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new qk(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(pf("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class qk extends Fh{data(){return super.data()}}function pf(n,e){return typeof e=="string"?Rv(n,e):e instanceof bu?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g0(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new ge(ie.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Dv{}class Mv extends Dv{}function Ae(n,e,...t){let i=[];e instanceof Dv&&i.push(e),i=i.concat(t),function(c){const d=c.filter(p=>p instanceof kv).length,f=c.filter(p=>p instanceof gf).length;if(d>1||d>0&&f>0)throw new ge(ie.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const o of i)n=o._apply(n);return n}class gf extends Mv{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new gf(e,t,i)}_apply(e){const t=this._parse(e);return v0(e._query,t),new La(e.firestore,e.converter,vg(e._query,t))}_parse(e){const t=Nu(e.firestore);return function(c,d,f,p,g,y,b){let E;if(g.isKeyField()){if(y==="array-contains"||y==="array-contains-any")throw new ge(ie.INVALID_ARGUMENT,`Invalid Query. You can't perform '${y}' queries on documentId().`);if(y==="in"||y==="not-in"){i_(b,y);const N=[];for(const w of b)N.push(a_(p,c,w));E={arrayValue:{values:N}}}else E=a_(p,c,b)}else y!=="in"&&y!=="not-in"&&y!=="array-contains-any"||i_(b,y),E=Uk(f,d,b,y==="in"||y==="not-in");return Lt.create(g,y,E)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function De(n,e,t){const i=e,o=pf("where",n);return gf._create(o,i,t)}class kv extends Dv{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new kv(e,t)}_parse(e){const t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return t.length===1?t[0]:js.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(o,c){let d=o;const f=c.getFlattenedFilters();for(const p of f)v0(d,p),d=vg(d,p)}(e._query,t),new La(e.firestore,e.converter,vg(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Ov extends Mv{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ov(e,t)}_apply(e){const t=function(o,c,d){if(o.startAt!==null)throw new ge(ie.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(o.endAt!==null)throw new ge(ie.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new eu(c,d)}(e._query,this._field,this._direction);return new La(e.firestore,e.converter,function(o,c){const d=o.explicitOrderBy.concat([c]);return new ml(o.path,o.collectionGroup,d,o.filters.slice(),o.limit,o.limitType,o.startAt,o.endAt)}(e._query,t))}}function Cn(n,e="asc"){const t=e,i=pf("orderBy",n);return Ov._create(i,t)}class Pv extends Mv{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new Pv(e,t,i)}_apply(e){return new La(e.firestore,e.converter,Rh(e._query,this._limit,this._limitType))}}function Bk(n){return Pv._create("limit",n,"F")}function a_(n,e,t){if(typeof(t=yt(t))=="string"){if(t==="")throw new ge(ie.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!pj(e)&&t.indexOf("/")!==-1)throw new ge(ie.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(ft.fromString(t));if(!_e.isDocumentKey(i))throw new ge(ie.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return yE(n,new _e(i))}if(t instanceof cn)return yE(n,t._key);throw new ge(ie.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${df(t)}.`)}function i_(n,e){if(!Array.isArray(n)||n.length===0)throw new ge(ie.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function v0(n,e){const t=function(o,c){for(const d of o)for(const f of d.getFlattenedFilters())if(c.indexOf(f.op)>=0)return f.op;return null}(n.filters,function(o){switch(o){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new ge(ie.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ge(ie.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class y0{convertValue(e,t="none"){switch(Ii(e)){case 0:return null;case 1:return e.booleanValue;case 2:return It(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Si(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw je(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const i={};return Fi(e,(o,c)=>{i[o]=this.convertValue(c,t)}),i}convertVectorValue(e){var t,i,o;const c=(o=(i=(t=e.fields)===null||t===void 0?void 0:t[Sh].arrayValue)===null||i===void 0?void 0:i.values)===null||o===void 0?void 0:o.map(d=>It(d.doubleValue));return new Av(c)}convertGeoPoint(e){return new jv(It(e.latitude),It(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":const i=Jh(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(Wc(e));default:return null}}convertTimestamp(e){const t=wi(e);return new zt(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=ft.fromString(e);Je(Fj(i),9688,{name:e});const o=new Zc(i.get(1),i.get(3)),c=new _e(i.popFirst(5));return o.isEqual(t)||ka(`Document ${c} contains a document reference within a different database (${o.projectId}/${o.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lv(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}class zk extends y0{constructor(e){super(),this.firestore=e}convertBytes(e){return new Pr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new cn(this.firestore,null,t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Vv extends Fh{constructor(e,t,i,o,c,d){super(e,t,i,o,d),this._firestore=e,this._firestoreImpl=e,this.metadata=c}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ph(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(pf("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}}class ph extends Vv{data(e={}){return super.data(e)}}class x0{constructor(e,t,i,o){this._firestore=e,this._userDataWriter=t,this._snapshot=o,this.metadata=new Ho(o.hasPendingWrites,o.fromCache),this.query=i}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new ph(this._firestore,this._userDataWriter,i.key,i,new Ho(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ge(ie.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(o,c){if(o._snapshot.oldDocs.isEmpty()){let d=0;return o._snapshot.docChanges.map(f=>{const p=new ph(o._firestore,o._userDataWriter,f.doc.key,f.doc,new Ho(o._snapshot.mutatedKeys.has(f.doc.key),o._snapshot.fromCache),o.query.converter);return f.doc,{type:"added",doc:p,oldIndex:-1,newIndex:d++}})}{let d=o._snapshot.oldDocs;return o._snapshot.docChanges.filter(f=>c||f.type!==3).map(f=>{const p=new ph(o._firestore,o._userDataWriter,f.doc.key,f.doc,new Ho(o._snapshot.mutatedKeys.has(f.doc.key),o._snapshot.fromCache),o.query.converter);let g=-1,y=-1;return f.type!==0&&(g=d.indexOf(f.doc.key),d=d.delete(f.doc.key)),f.type!==1&&(d=d.add(f.doc),y=d.indexOf(f.doc.key)),{type:Hk(f.type),doc:p,oldIndex:g,newIndex:y}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Hk(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return je(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bi(n){n=An(n,cn);const e=An(n.firestore,Zs);return Ik(xu(e),n._key).then(t=>b0(e,n,t))}class vf extends y0{constructor(e){super(),this.firestore=e}convertBytes(e){return new Pr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new cn(this.firestore,null,t)}}function He(n){n=An(n,La);const e=An(n.firestore,Zs),t=xu(e),i=new vf(e);return g0(n._query),Rk(t,n._query).then(o=>new x0(e,i,n,o))}function yf(n,e,t){n=An(n,cn);const i=An(n.firestore,Zs),o=Lv(n.converter,e,t);return bf(i,[wv(Nu(i),"setDoc",n._key,o,n.converter!==null,t).toMutation(n._key,ln.none())])}function As(n,e,t,...i){n=An(n,cn);const o=An(n.firestore,Zs),c=Nu(o);let d;return d=typeof(e=yt(e))=="string"||e instanceof bu?h0(c,"updateDoc",n._key,e,t,i):d0(c,"updateDoc",n._key,e),bf(o,[d.toMutation(n._key,ln.exists(!0))])}function xf(n){return bf(An(n.firestore,Zs),[new rf(n._key,ln.none())])}function gl(n,e){const t=An(n.firestore,Zs),i=et(n),o=Lv(n.converter,e);return bf(t,[wv(Nu(n.firestore),"addDoc",i._key,o,n.converter!==null,{}).toMutation(i._key,ln.exists(!1))]).then(()=>i)}function zr(n,...e){var t,i,o;n=yt(n);let c={includeMetadataChanges:!1,source:"default"},d=0;typeof e[d]!="object"||s_(e[d])||(c=e[d],d++);const f={includeMetadataChanges:c.includeMetadataChanges,source:c.source};if(s_(e[d])){const b=e[d];e[d]=(t=b.next)===null||t===void 0?void 0:t.bind(b),e[d+1]=(i=b.error)===null||i===void 0?void 0:i.bind(b),e[d+2]=(o=b.complete)===null||o===void 0?void 0:o.bind(b)}let p,g,y;if(n instanceof cn)g=An(n.firestore,Zs),y=ef(n._key.path),p={next:b=>{e[d]&&e[d](b0(g,n,b))},error:e[d+1],complete:e[d+2]};else{const b=An(n,La);g=An(b.firestore,Zs),y=b._query;const E=new vf(g);p={next:j=>{e[d]&&e[d](new x0(g,E,b,j))},error:e[d+1],complete:e[d+2]},g0(n._query)}return function(E,j,N,w){const T=new _v(w),S=new bv(j,T,N);return E.asyncQueue.enqueueAndForget(async()=>vv(await Vh(E),S)),()=>{T.xu(),E.asyncQueue.enqueueAndForget(async()=>yv(await Vh(E),S))}}(xu(g),y,f,p)}function bf(n,e){return function(i,o){const c=new Ks;return i.asyncQueue.enqueueAndForget(async()=>pk(await wk(i),o,c)),c.promise}(xu(n),e)}function b0(n,e,t){const i=t.docs.get(e._key),o=new vf(n);return new Vv(n,o,e._key,i,new Ho(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gk={maxAttempts:5};function kc(n,e){if((n=yt(n)).firestore!==e)throw new ge(ie.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Nu(e)}get(e){const t=kc(e,this._firestore),i=new zk(this._firestore);return this._transaction.lookup([t._key]).then(o=>{if(!o||o.length!==1)return je(24041);const c=o[0];if(c.isFoundDocument())return new Fh(this._firestore,i,c.key,c,t.converter);if(c.isNoDocument())return new Fh(this._firestore,i,t._key,null,t.converter);throw je(18433,{doc:c})})}set(e,t,i){const o=kc(e,this._firestore),c=Lv(o.converter,t,i),d=wv(this._dataReader,"Transaction.set",o._key,c,o.converter!==null,i);return this._transaction.set(o._key,d),this}update(e,t,i,...o){const c=kc(e,this._firestore);let d;return d=typeof(t=yt(t))=="string"||t instanceof bu?h0(this._dataReader,"Transaction.update",c._key,t,i,o):d0(this._dataReader,"Transaction.update",c._key,t),this._transaction.update(c._key,d),this}delete(e){const t=kc(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yk extends $k{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=kc(e,this._firestore),i=new vf(this._firestore);return super.get(e).then(o=>new Vv(this._firestore,i,t._key,o._document,new Ho(!1,!1),t.converter))}}function Uv(n,e,t){n=An(n,Zs);const i=Object.assign(Object.assign({},Gk),t);return function(c){if(c.maxAttempts<1)throw new ge(ie.INVALID_ARGUMENT,"Max attempts must be at least 1")}(i),function(c,d,f){const p=new Ks;return c.asyncQueue.enqueueAndForget(async()=>{const g=await Sk(c);new jk(c.asyncQueue,g,f,d,p).Wu()}),p.promise}(xu(n),o=>e(new Yk(n,o)),i)}function Ue(){return new Sv("serverTimestamp")}(function(e,t=!0){(function(o){dl=o})(Fr),us(new Yn("firestore",(i,{instanceIdentifier:o,options:c})=>{const d=i.getProvider("app").getImmediate(),f=new Zs(new F1(i.getProvider("auth-internal")),new z1(d,i.getProvider("app-check-internal")),function(g,y){if(!Object.prototype.hasOwnProperty.apply(g.options,["projectId"]))throw new ge(ie.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zc(g.options.projectId,y)}(d,o),d);return c=Object.assign({useFetchStreams:t},c),f._setSettings(c),f},"PUBLIC").setMultipleInstances(!0)),vn(rE,oE,e),vn(rE,oE,"esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N0="firebasestorage.googleapis.com",Qk="storageBucket",Kk=2*60*1e3,Xk=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea extends hs{constructor(e,t,i=0){super(Hp(e),`Firebase Storage: ${t} (${Hp(e)})`),this.status_=i,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ea.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Hp(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Js;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Js||(Js={}));function Hp(n){return"storage/"+n}function Wk(){const n="An unknown error occurred, please check the error payload for server response.";return new ea(Js.UNKNOWN,n)}function Zk(){return new ea(Js.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Jk(){return new ea(Js.CANCELED,"User canceled the upload/download.")}function eO(n){return new ea(Js.INVALID_URL,"Invalid URL '"+n+"'.")}function tO(n){return new ea(Js.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function r_(n){return new ea(Js.INVALID_ARGUMENT,n)}function E0(){return new ea(Js.APP_DELETED,"The Firebase app was deleted.")}function nO(n){return new ea(Js.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let i;try{i=_s.makeFromUrl(e,t)}catch{return new _s(e,"")}if(i.path==="")return i;throw tO(e)}static makeFromUrl(e,t){let i=null;const o="([A-Za-z0-9.\\-_]+)";function c(O){O.path.charAt(O.path.length-1)==="/"&&(O.path_=O.path_.slice(0,-1))}const d="(/(.*))?$",f=new RegExp("^gs://"+o+d,"i"),p={bucket:1,path:3};function g(O){O.path_=decodeURIComponent(O.path)}const y="v[A-Za-z0-9_]+",b=t.replace(/[.]/g,"\\."),E="(/([^?#]*).*)?$",j=new RegExp(`^https?://${b}/${y}/b/${o}/o${E}`,"i"),N={bucket:1,path:3},w=t===N0?"(?:storage.googleapis.com|storage.cloud.google.com)":t,T="([^?#]*)",S=new RegExp(`^https?://${w}/${o}/${T}`,"i"),I=[{regex:f,indices:p,postModify:c},{regex:j,indices:N,postModify:g},{regex:S,indices:{bucket:1,path:2},postModify:g}];for(let O=0;O<I.length;O++){const U=I[O],$=U.regex.exec(e);if($){const F=$[U.indices.bucket];let R=$[U.indices.path];R||(R=""),i=new _s(F,R),U.postModify(i);break}}if(i==null)throw eO(e);return i}}class sO{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aO(n,e,t){let i=1,o=null,c=null,d=!1,f=0;function p(){return f===2}let g=!1;function y(...T){g||(g=!0,e.apply(null,T))}function b(T){o=setTimeout(()=>{o=null,n(j,p())},T)}function E(){c&&clearTimeout(c)}function j(T,...S){if(g){E();return}if(T){E(),y.call(null,T,...S);return}if(p()||d){E(),y.call(null,T,...S);return}i<64&&(i*=2);let I;f===1?(f=2,I=0):I=(i+Math.random())*1e3,b(I)}let N=!1;function w(T){N||(N=!0,E(),!g&&(o!==null?(T||(f=2),clearTimeout(o),b(0)):T||(f=1)))}return b(0),c=setTimeout(()=>{d=!0,w(!0)},t),w}function iO(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rO(n){return n!==void 0}function o_(n,e,t,i){if(i<e)throw r_(`Invalid value for '${n}'. Expected ${e} or greater.`);if(i>t)throw r_(`Invalid value for '${n}'. Expected ${t} or less.`)}function oO(n){const e=encodeURIComponent;let t="?";for(const i in n)if(n.hasOwnProperty(i)){const o=e(i)+"="+e(n[i]);t=t+o+"&"}return t=t.slice(0,-1),t}var qh;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(qh||(qh={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lO(n,e){const t=n>=500&&n<600,o=[408,429].indexOf(n)!==-1,c=e.indexOf(n)!==-1;return t||o||c}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cO{constructor(e,t,i,o,c,d,f,p,g,y,b,E=!0,j=!1){this.url_=e,this.method_=t,this.headers_=i,this.body_=o,this.successCodes_=c,this.additionalRetryCodes_=d,this.callback_=f,this.errorCallback_=p,this.timeout_=g,this.progressCallback_=y,this.connectionFactory_=b,this.retry=E,this.isUsingEmulator=j,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((N,w)=>{this.resolve_=N,this.reject_=w,this.start_()})}start_(){const e=(i,o)=>{if(o){i(!1,new sh(!1,null,!0));return}const c=this.connectionFactory_();this.pendingConnection_=c;const d=f=>{const p=f.loaded,g=f.lengthComputable?f.total:-1;this.progressCallback_!==null&&this.progressCallback_(p,g)};this.progressCallback_!==null&&c.addUploadProgressListener(d),c.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&c.removeUploadProgressListener(d),this.pendingConnection_=null;const f=c.getErrorCode()===qh.NO_ERROR,p=c.getStatus();if(!f||lO(p,this.additionalRetryCodes_)&&this.retry){const y=c.getErrorCode()===qh.ABORT;i(!1,new sh(!1,null,y));return}const g=this.successCodes_.indexOf(p)!==-1;i(!0,new sh(g,c))})},t=(i,o)=>{const c=this.resolve_,d=this.reject_,f=o.connection;if(o.wasSuccessCode)try{const p=this.callback_(f,f.getResponse());rO(p)?c(p):c()}catch(p){d(p)}else if(f!==null){const p=Wk();p.serverResponse=f.getErrorText(),this.errorCallback_?d(this.errorCallback_(f,p)):d(p)}else if(o.canceled){const p=this.appDelete_?E0():Jk();d(p)}else{const p=Zk();d(p)}};this.canceled_?t(!1,new sh(!1,null,!0)):this.backoffId_=aO(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&iO(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class sh{constructor(e,t,i){this.wasSuccessCode=e,this.connection=t,this.canceled=!!i}}function uO(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function dO(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function hO(n,e){e&&(n["X-Firebase-GMPID"]=e)}function fO(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function mO(n,e,t,i,o,c,d=!0,f=!1){const p=oO(n.urlParams),g=n.url+p,y=Object.assign({},n.headers);return hO(y,e),uO(y,t),dO(y,c),fO(y,i),new cO(g,n.method,y,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,o,d,f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pO(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function gO(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bh{constructor(e,t){this._service=e,t instanceof _s?this._location=t:this._location=_s.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Bh(e,t)}get root(){const e=new _s(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return gO(this._location.path)}get storage(){return this._service}get parent(){const e=pO(this._location.path);if(e===null)return null;const t=new _s(this._location.bucket,e);return new Bh(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw nO(e)}}function l_(n,e){const t=e?.[Qk];return t==null?null:_s.makeFromBucketSpec(t,n)}function vO(n,e,t,i={}){n.host=`${e}:${t}`;const o=Ur(e);o&&(kg(`https://${n.host}/b`),Og("Storage",!0)),n._isUsingEmulator=!0,n._protocol=o?"https":"http";const{mockUserToken:c}=i;c&&(n._overrideAuthToken=typeof c=="string"?c:sT(c,n.app.options.projectId))}class yO{constructor(e,t,i,o,c,d=!1){this.app=e,this._authProvider=t,this._appCheckProvider=i,this._url=o,this._firebaseVersion=c,this._isUsingEmulator=d,this._bucket=null,this._host=N0,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Kk,this._maxUploadRetryTime=Xk,this._requests=new Set,o!=null?this._bucket=_s.makeFromBucketSpec(o,this._host):this._bucket=l_(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=_s.makeFromBucketSpec(this._url,e):this._bucket=l_(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){o_("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){o_("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(Dn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Bh(this,e)}_makeRequest(e,t,i,o,c=!0){if(this._deleted)return new sO(E0());{const d=mO(e,this._appId,i,o,t,this._firebaseVersion,c,this._isUsingEmulator);return this._requests.add(d),d.getPromise().then(()=>this._requests.delete(d),()=>this._requests.delete(d)),d}}async makeRequestWithTokens(e,t){const[i,o]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,i,o).getPromise()}}const c_="@firebase/storage",u_="0.13.13";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _0="storage";function xO(n=cu(),e){n=yt(n);const i=Pa(n,_0).getImmediate({identifier:e}),o=eT("storage");return o&&bO(i,...o),i}function bO(n,e,t,i={}){vO(n,e,t,i)}function NO(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),i=n.getProvider("auth-internal"),o=n.getProvider("app-check-internal");return new yO(t,i,o,e,Fr)}function EO(){us(new Yn(_0,NO,"PUBLIC").setMultipleInstances(!0)),vn(c_,u_,""),vn(c_,u_,"esm2017")}EO();const T0="@firebase/installations",Fv="0.6.17";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j0=1e4,A0=`w:${Fv}`,C0="FIS_v2",_O="https://firebaseinstallations.googleapis.com/v1",TO=60*60*1e3,jO="installations",AO="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CO={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Lr=new Pi(jO,AO,CO);function w0(n){return n instanceof hs&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S0({projectId:n}){return`${_O}/projects/${n}/installations`}function I0(n){return{token:n.token,requestStatus:2,expiresIn:SO(n.expiresIn),creationTime:Date.now()}}async function R0(n,e){const i=(await e.json()).error;return Lr.create("request-failed",{requestName:n,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})}function D0({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function wO(n,{refreshToken:e}){const t=D0(n);return t.append("Authorization",IO(e)),t}async function M0(n){const e=await n();return e.status>=500&&e.status<600?n():e}function SO(n){return Number(n.replace("s","000"))}function IO(n){return`${C0} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RO({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const i=S0(n),o=D0(n),c=e.getImmediate({optional:!0});if(c){const g=await c.getHeartbeatsHeader();g&&o.append("x-firebase-client",g)}const d={fid:t,authVersion:C0,appId:n.appId,sdkVersion:A0},f={method:"POST",headers:o,body:JSON.stringify(d)},p=await M0(()=>fetch(i,f));if(p.ok){const g=await p.json();return{fid:g.fid||t,registrationStatus:2,refreshToken:g.refreshToken,authToken:I0(g.authToken)}}else throw await R0("Create Installation",p)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k0(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DO(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MO=/^[cdef][\w-]{21}$/,Cg="";function kO(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=OO(n);return MO.test(t)?t:Cg}catch{return Cg}}function OO(n){return DO(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nf(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O0=new Map;function P0(n,e){const t=Nf(n);L0(t,e),PO(t,e)}function L0(n,e){const t=O0.get(n);if(t)for(const i of t)i(e)}function PO(n,e){const t=LO();t&&t.postMessage({key:n,fid:e}),VO()}let Ir=null;function LO(){return!Ir&&"BroadcastChannel"in self&&(Ir=new BroadcastChannel("[Firebase] FID Change"),Ir.onmessage=n=>{L0(n.data.key,n.data.fid)}),Ir}function VO(){O0.size===0&&Ir&&(Ir.close(),Ir=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UO="firebase-installations-database",FO=1,Vr="firebase-installations-store";let Gp=null;function qv(){return Gp||(Gp=rT(UO,FO,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Vr)}}})),Gp}async function zh(n,e){const t=Nf(n),o=(await qv()).transaction(Vr,"readwrite"),c=o.objectStore(Vr),d=await c.get(t);return await c.put(e,t),await o.done,(!d||d.fid!==e.fid)&&P0(n,e.fid),e}async function V0(n){const e=Nf(n),i=(await qv()).transaction(Vr,"readwrite");await i.objectStore(Vr).delete(e),await i.done}async function Ef(n,e){const t=Nf(n),o=(await qv()).transaction(Vr,"readwrite"),c=o.objectStore(Vr),d=await c.get(t),f=e(d);return f===void 0?await c.delete(t):await c.put(f,t),await o.done,f&&(!d||d.fid!==f.fid)&&P0(n,f.fid),f}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bv(n){let e;const t=await Ef(n.appConfig,i=>{const o=qO(i),c=BO(n,o);return e=c.registrationPromise,c.installationEntry});return t.fid===Cg?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function qO(n){const e=n||{fid:kO(),registrationStatus:0};return U0(e)}function BO(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const o=Promise.reject(Lr.create("app-offline"));return{installationEntry:e,registrationPromise:o}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=zO(n,t);return{installationEntry:t,registrationPromise:i}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:HO(n)}:{installationEntry:e}}async function zO(n,e){try{const t=await RO(n,e);return zh(n.appConfig,t)}catch(t){throw w0(t)&&t.customData.serverCode===409?await V0(n.appConfig):await zh(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function HO(n){let e=await d_(n.appConfig);for(;e.registrationStatus===1;)await k0(100),e=await d_(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:i}=await Bv(n);return i||t}return e}function d_(n){return Ef(n,e=>{if(!e)throw Lr.create("installation-not-found");return U0(e)})}function U0(n){return GO(n)?{fid:n.fid,registrationStatus:0}:n}function GO(n){return n.registrationStatus===1&&n.registrationTime+j0<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $O({appConfig:n,heartbeatServiceProvider:e},t){const i=YO(n,t),o=wO(n,t),c=e.getImmediate({optional:!0});if(c){const g=await c.getHeartbeatsHeader();g&&o.append("x-firebase-client",g)}const d={installation:{sdkVersion:A0,appId:n.appId}},f={method:"POST",headers:o,body:JSON.stringify(d)},p=await M0(()=>fetch(i,f));if(p.ok){const g=await p.json();return I0(g)}else throw await R0("Generate Auth Token",p)}function YO(n,{fid:e}){return`${S0(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zv(n,e=!1){let t;const i=await Ef(n.appConfig,c=>{if(!F0(c))throw Lr.create("not-registered");const d=c.authToken;if(!e&&XO(d))return c;if(d.requestStatus===1)return t=QO(n,e),c;{if(!navigator.onLine)throw Lr.create("app-offline");const f=ZO(c);return t=KO(n,f),f}});return t?await t:i.authToken}async function QO(n,e){let t=await h_(n.appConfig);for(;t.authToken.requestStatus===1;)await k0(100),t=await h_(n.appConfig);const i=t.authToken;return i.requestStatus===0?zv(n,e):i}function h_(n){return Ef(n,e=>{if(!F0(e))throw Lr.create("not-registered");const t=e.authToken;return JO(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function KO(n,e){try{const t=await $O(n,e),i=Object.assign(Object.assign({},e),{authToken:t});return await zh(n.appConfig,i),t}catch(t){if(w0(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await V0(n.appConfig);else{const i=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await zh(n.appConfig,i)}throw t}}function F0(n){return n!==void 0&&n.registrationStatus===2}function XO(n){return n.requestStatus===2&&!WO(n)}function WO(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+TO}function ZO(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function JO(n){return n.requestStatus===1&&n.requestTime+j0<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eP(n){const e=n,{installationEntry:t,registrationPromise:i}=await Bv(e);return i?i.catch(console.error):zv(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tP(n,e=!1){const t=n;return await nP(t),(await zv(t,e)).token}async function nP(n){const{registrationPromise:e}=await Bv(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sP(n){if(!n||!n.options)throw $p("App Configuration");if(!n.name)throw $p("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw $p(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function $p(n){return Lr.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q0="installations",aP="installations-internal",iP=n=>{const e=n.getProvider("app").getImmediate(),t=sP(e),i=Pa(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},rP=n=>{const e=n.getProvider("app").getImmediate(),t=Pa(e,q0).getImmediate();return{getId:()=>eP(t),getToken:o=>tP(t,o)}};function oP(){us(new Yn(q0,iP,"PUBLIC")),us(new Yn(aP,rP,"PRIVATE"))}oP();vn(T0,Fv);vn(T0,Fv,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hh="analytics",lP="firebase_id",cP="origin",uP=60*1e3,dP="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Hv="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mn=new lu("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hP={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},$n=new Pi("analytics","Analytics",hP);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fP(n){if(!n.startsWith(Hv)){const e=$n.create("invalid-gtag-resource",{gtagURL:n});return Mn.warn(e.message),""}return n}function B0(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function mP(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function pP(n,e){const t=mP("firebase-js-sdk-policy",{createScriptURL:fP}),i=document.createElement("script"),o=`${Hv}?l=${n}&id=${e}`;i.src=t?t?.createScriptURL(o):o,i.async=!0,document.head.appendChild(i)}function gP(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function vP(n,e,t,i,o,c){const d=i[o];try{if(d)await e[d];else{const p=(await B0(t)).find(g=>g.measurementId===o);p&&await e[p.appId]}}catch(f){Mn.error(f)}n("config",o,c)}async function yP(n,e,t,i,o){try{let c=[];if(o&&o.send_to){let d=o.send_to;Array.isArray(d)||(d=[d]);const f=await B0(t);for(const p of d){const g=f.find(b=>b.measurementId===p),y=g&&e[g.appId];if(y)c.push(y);else{c=[];break}}}c.length===0&&(c=Object.values(e)),await Promise.all(c),n("event",i,o||{})}catch(c){Mn.error(c)}}function xP(n,e,t,i){async function o(c,...d){try{if(c==="event"){const[f,p]=d;await yP(n,e,t,f,p)}else if(c==="config"){const[f,p]=d;await vP(n,e,t,i,f,p)}else if(c==="consent"){const[f,p]=d;n("consent",f,p)}else if(c==="get"){const[f,p,g]=d;n("get",f,p,g)}else if(c==="set"){const[f]=d;n("set",f)}else n(c,...d)}catch(f){Mn.error(f)}}return o}function bP(n,e,t,i,o){let c=function(...d){window[i].push(arguments)};return window[o]&&typeof window[o]=="function"&&(c=window[o]),window[o]=xP(c,n,e,t),{gtagCore:c,wrappedGtag:window[o]}}function NP(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(Hv)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EP=30,_P=1e3;class TP{constructor(e={},t=_P){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const z0=new TP;function jP(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function AP(n){var e;const{appId:t,apiKey:i}=n,o={method:"GET",headers:jP(i)},c=dP.replace("{app-id}",t),d=await fetch(c,o);if(d.status!==200&&d.status!==304){let f="";try{const p=await d.json();!((e=p.error)===null||e===void 0)&&e.message&&(f=p.error.message)}catch{}throw $n.create("config-fetch-failed",{httpStatus:d.status,responseMessage:f})}return d.json()}async function CP(n,e=z0,t){const{appId:i,apiKey:o,measurementId:c}=n.options;if(!i)throw $n.create("no-app-id");if(!o){if(c)return{measurementId:c,appId:i};throw $n.create("no-api-key")}const d=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},f=new IP;return setTimeout(async()=>{f.abort()},uP),H0({appId:i,apiKey:o,measurementId:c},d,f,e)}async function H0(n,{throttleEndTimeMillis:e,backoffCount:t},i,o=z0){var c;const{appId:d,measurementId:f}=n;try{await wP(i,e)}catch(p){if(f)return Mn.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${f} provided in the "measurementId" field in the local Firebase config. [${p?.message}]`),{appId:d,measurementId:f};throw p}try{const p=await AP(n);return o.deleteThrottleMetadata(d),p}catch(p){const g=p;if(!SP(g)){if(o.deleteThrottleMetadata(d),f)return Mn.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${f} provided in the "measurementId" field in the local Firebase config. [${g?.message}]`),{appId:d,measurementId:f};throw p}const y=Number((c=g?.customData)===null||c===void 0?void 0:c.httpStatus)===503?RN(t,o.intervalMillis,EP):RN(t,o.intervalMillis),b={throttleEndTimeMillis:Date.now()+y,backoffCount:t+1};return o.setThrottleMetadata(d,b),Mn.debug(`Calling attemptFetch again in ${y} millis`),H0(n,b,i,o)}}function wP(n,e){return new Promise((t,i)=>{const o=Math.max(e-Date.now(),0),c=setTimeout(t,o);n.addEventListener(()=>{clearTimeout(c),i($n.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function SP(n){if(!(n instanceof hs)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class IP{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function RP(n,e,t,i,o){if(o&&o.global){n("event",t,i);return}else{const c=await e,d=Object.assign(Object.assign({},i),{send_to:c});n("event",t,d)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DP(){if(Yh())try{await Qh()}catch(n){return Mn.warn($n.create("indexeddb-unavailable",{errorInfo:n?.toString()}).message),!1}else return Mn.warn($n.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function MP(n,e,t,i,o,c,d){var f;const p=CP(n);p.then(j=>{t[j.measurementId]=j.appId,n.options.measurementId&&j.measurementId!==n.options.measurementId&&Mn.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${j.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(j=>Mn.error(j)),e.push(p);const g=DP().then(j=>{if(j)return i.getId()}),[y,b]=await Promise.all([p,g]);NP(c)||pP(c,y.measurementId),o("js",new Date);const E=(f=d?.config)!==null&&f!==void 0?f:{};return E[cP]="firebase",E.update=!0,b!=null&&(E[lP]=b),o("config",y.measurementId,E),y.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kP{constructor(e){this.app=e}_delete(){return delete Bc[this.app.options.appId],Promise.resolve()}}let Bc={},f_=[];const m_={};let Yp="dataLayer",OP="gtag",p_,G0,g_=!1;function PP(){const n=[];if(Pg()&&n.push("This is a browser extension environment."),Lg()||n.push("Cookies are not available."),n.length>0){const e=n.map((i,o)=>`(${o+1}) ${i}`).join(" "),t=$n.create("invalid-analytics-context",{errorInfo:e});Mn.warn(t.message)}}function LP(n,e,t){PP();const i=n.options.appId;if(!i)throw $n.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Mn.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw $n.create("no-api-key");if(Bc[i]!=null)throw $n.create("already-exists",{id:i});if(!g_){gP(Yp);const{wrappedGtag:c,gtagCore:d}=bP(Bc,f_,m_,Yp,OP);G0=c,p_=d,g_=!0}return Bc[i]=MP(n,f_,m_,e,p_,Yp,t),new kP(n)}function VP(n=cu()){n=yt(n);const e=Pa(n,Hh);return e.isInitialized()?e.getImmediate():UP(n)}function UP(n,e={}){const t=Pa(n,Hh);if(t.isInitialized()){const o=t.getImmediate();if(Ai(e,t.getOptions()))return o;throw $n.create("already-initialized")}return t.initialize({options:e})}async function FP(){if(Pg()||!Lg()||!Yh())return!1;try{return await Qh()}catch{return!1}}function qP(n,e,t,i){n=yt(n),RP(G0,Bc[n.app.options.appId],e,t,i).catch(o=>Mn.error(o))}const v_="@firebase/analytics",y_="0.10.16";function BP(){us(new Yn(Hh,(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),o=e.getProvider("installations-internal").getImmediate();return LP(i,o,t)},"PUBLIC")),us(new Yn("analytics-internal",n,"PRIVATE")),vn(v_,y_),vn(v_,y_,"esm2017");function n(e){try{const t=e.getProvider(Hh).getImmediate();return{logEvent:(i,o,c)=>qP(t,i,o,c)}}catch(t){throw $n.create("interop-component-reg-failed",{reason:t})}}}BP();var wg,x_,_f=function(){var n=self.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0];if(n&&n.responseStart>0&&n.responseStart<performance.now())return n},$0=function(n){if(document.readyState==="loading")return"loading";var e=_f();if(e){if(n<e.domInteractive)return"loading";if(e.domContentLoadedEventStart===0||n<e.domContentLoadedEventStart)return"dom-interactive";if(e.domComplete===0||n<e.domComplete)return"dom-content-loaded"}return"complete"},zP=function(n){var e=n.nodeName;return n.nodeType===1?e.toLowerCase():e.toUpperCase().replace(/^#/,"")},Gv=function(n,e){var t="";try{for(;n&&n.nodeType!==9;){var i=n,o=i.id?"#"+i.id:zP(i)+(i.classList&&i.classList.value&&i.classList.value.trim()&&i.classList.value.trim().length?"."+i.classList.value.trim().replace(/\s+/g,"."):"");if(t.length+o.length>(e||100)-1)return t||o;if(t=t?o+">"+t:o,i.id)break;n=i.parentNode}}catch{}return t},Y0=-1,HP=function(){return Y0},_u=function(n){addEventListener("pageshow",function(e){e.persisted&&(Y0=e.timeStamp,n(e))},!0)},$v=function(){var n=_f();return n&&n.activationStart||0},Mi=function(n,e){var t=_f(),i="navigate";return HP()>=0?i="back-forward-cache":t&&(document.prerendering||$v()>0?i="prerender":document.wasDiscarded?i="restore":t.type&&(i=t.type.replace(/_/g,"-"))),{name:n,value:e===void 0?-1:e,rating:"good",delta:0,entries:[],id:"v4-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:i}},vl=function(n,e,t){try{if(PerformanceObserver.supportedEntryTypes.includes(n)){var i=new PerformanceObserver(function(o){Promise.resolve().then(function(){e(o.getEntries())})});return i.observe(Object.assign({type:n,buffered:!0},t||{})),i}}catch{}},ki=function(n,e,t,i){var o,c;return function(d){e.value>=0&&(d||i)&&((c=e.value-(o||0))||o===void 0)&&(o=e.value,e.delta=c,e.rating=function(f,p){return f>p[1]?"poor":f>p[0]?"needs-improvement":"good"}(e.value,t),n(e))}},Yv=function(n){requestAnimationFrame(function(){return requestAnimationFrame(function(){return n()})})},Tf=function(n){document.addEventListener("visibilitychange",function(){document.visibilityState==="hidden"&&n()})},Qv=function(n){var e=!1;return function(){e||(n(),e=!0)}},Go=-1,b_=function(){return document.visibilityState!=="hidden"||document.prerendering?1/0:0},Gh=function(n){document.visibilityState==="hidden"&&Go>-1&&(Go=n.type==="visibilitychange"?n.timeStamp:0,GP())},N_=function(){addEventListener("visibilitychange",Gh,!0),addEventListener("prerenderingchange",Gh,!0)},GP=function(){removeEventListener("visibilitychange",Gh,!0),removeEventListener("prerenderingchange",Gh,!0)},Q0=function(){return Go<0&&(Go=b_(),N_(),_u(function(){setTimeout(function(){Go=b_(),N_()},0)})),{get firstHiddenTime(){return Go}}},Kv=function(n){document.prerendering?addEventListener("prerenderingchange",function(){return n()},!0):n()},E_=[1800,3e3],$P=function(n,e){e=e||{},Kv(function(){var t,i=Q0(),o=Mi("FCP"),c=vl("paint",function(d){d.forEach(function(f){f.name==="first-contentful-paint"&&(c.disconnect(),f.startTime<i.firstHiddenTime&&(o.value=Math.max(f.startTime-$v(),0),o.entries.push(f),t(!0)))})});c&&(t=ki(n,o,E_,e.reportAllChanges),_u(function(d){o=Mi("FCP"),t=ki(n,o,E_,e.reportAllChanges),Yv(function(){o.value=performance.now()-d.timeStamp,t(!0)})}))})},__=[.1,.25],YP=function(n,e){(function(t,i){i=i||{},$P(Qv(function(){var o,c=Mi("CLS",0),d=0,f=[],p=function(y){y.forEach(function(b){if(!b.hadRecentInput){var E=f[0],j=f[f.length-1];d&&b.startTime-j.startTime<1e3&&b.startTime-E.startTime<5e3?(d+=b.value,f.push(b)):(d=b.value,f=[b])}}),d>c.value&&(c.value=d,c.entries=f,o())},g=vl("layout-shift",p);g&&(o=ki(t,c,__,i.reportAllChanges),Tf(function(){p(g.takeRecords()),o(!0)}),_u(function(){d=0,c=Mi("CLS",0),o=ki(t,c,__,i.reportAllChanges),Yv(function(){return o()})}),setTimeout(o,0))}))})(function(t){var i=function(o){var c,d={};if(o.entries.length){var f=o.entries.reduce(function(g,y){return g&&g.value>y.value?g:y});if(f&&f.sources&&f.sources.length){var p=(c=f.sources).find(function(g){return g.node&&g.node.nodeType===1})||c[0];p&&(d={largestShiftTarget:Gv(p.node),largestShiftTime:f.startTime,largestShiftValue:f.value,largestShiftSource:p,largestShiftEntry:f,loadState:$0(f.startTime)})}}return Object.assign(o,{attribution:d})}(t);n(i)},e)},K0=0,Qp=1/0,ah=0,QP=function(n){n.forEach(function(e){e.interactionId&&(Qp=Math.min(Qp,e.interactionId),ah=Math.max(ah,e.interactionId),K0=ah?(ah-Qp)/7+1:0)})},X0=function(){return wg?K0:performance.interactionCount||0},KP=function(){"interactionCount"in performance||wg||(wg=vl("event",QP,{type:"event",buffered:!0,durationThreshold:0}))},bs=[],zc=new Map,W0=0,XP=function(){var n=Math.min(bs.length-1,Math.floor((X0()-W0)/50));return bs[n]},Z0=[],WP=function(n){if(Z0.forEach(function(o){return o(n)}),n.interactionId||n.entryType==="first-input"){var e=bs[bs.length-1],t=zc.get(n.interactionId);if(t||bs.length<10||n.duration>e.latency){if(t)n.duration>t.latency?(t.entries=[n],t.latency=n.duration):n.duration===t.latency&&n.startTime===t.entries[0].startTime&&t.entries.push(n);else{var i={id:n.interactionId,latency:n.duration,entries:[n]};zc.set(i.id,i),bs.push(i)}bs.sort(function(o,c){return c.latency-o.latency}),bs.length>10&&bs.splice(10).forEach(function(o){return zc.delete(o.id)})}}},Xv=function(n){var e=self.requestIdleCallback||self.setTimeout,t=-1;return n=Qv(n),document.visibilityState==="hidden"?n():(t=e(n),Tf(n)),t},T_=[200,500],ZP=function(n,e){"PerformanceEventTiming"in self&&"interactionId"in PerformanceEventTiming.prototype&&(e=e||{},Kv(function(){var t;KP();var i,o=Mi("INP"),c=function(f){Xv(function(){f.forEach(WP);var p=XP();p&&p.latency!==o.value&&(o.value=p.latency,o.entries=p.entries,i())})},d=vl("event",c,{durationThreshold:(t=e.durationThreshold)!==null&&t!==void 0?t:40});i=ki(n,o,T_,e.reportAllChanges),d&&(d.observe({type:"first-input",buffered:!0}),Tf(function(){c(d.takeRecords()),i(!0)}),_u(function(){W0=X0(),bs.length=0,zc.clear(),o=Mi("INP"),i=ki(n,o,T_,e.reportAllChanges)}))}))},Zo=[],yi=[],Sg=0,Wv=new WeakMap,Jo=new Map,Ig=-1,JP=function(n){Zo=Zo.concat(n),J0()},J0=function(){Ig<0&&(Ig=Xv(e2))},e2=function(){Jo.size>10&&Jo.forEach(function(d,f){zc.has(f)||Jo.delete(f)});var n=bs.map(function(d){return Wv.get(d.entries[0])}),e=yi.length-50;yi=yi.filter(function(d,f){return f>=e||n.includes(d)});for(var t=new Set,i=0;i<yi.length;i++){var o=yi[i];eA(o.startTime,o.processingEnd).forEach(function(d){t.add(d)})}var c=Zo.length-1-50;Zo=Zo.filter(function(d,f){return d.startTime>Sg&&f>c||t.has(d)}),Ig=-1};Z0.push(function(n){n.interactionId&&n.target&&!Jo.has(n.interactionId)&&Jo.set(n.interactionId,n.target)},function(n){var e,t=n.startTime+n.duration;Sg=Math.max(Sg,n.processingEnd);for(var i=yi.length-1;i>=0;i--){var o=yi[i];if(Math.abs(t-o.renderTime)<=8){(e=o).startTime=Math.min(n.startTime,e.startTime),e.processingStart=Math.min(n.processingStart,e.processingStart),e.processingEnd=Math.max(n.processingEnd,e.processingEnd),e.entries.push(n);break}}e||(e={startTime:n.startTime,processingStart:n.processingStart,processingEnd:n.processingEnd,renderTime:t,entries:[n]},yi.push(e)),(n.interactionId||n.entryType==="first-input")&&Wv.set(n,e),J0()});var eA=function(n,e){for(var t,i=[],o=0;t=Zo[o];o++)if(!(t.startTime+t.duration<n)){if(t.startTime>e)break;i.push(t)}return i},t2=function(n,e){x_||(x_=vl("long-animation-frame",JP)),ZP(function(t){var i=function(o){var c=o.entries[0],d=Wv.get(c),f=c.processingStart,p=d.processingEnd,g=d.entries.sort(function(T,S){return T.processingStart-S.processingStart}),y=eA(c.startTime,p),b=o.entries.find(function(T){return T.target}),E=b&&b.target||Jo.get(c.interactionId),j=[c.startTime+c.duration,p].concat(y.map(function(T){return T.startTime+T.duration})),N=Math.max.apply(Math,j),w={interactionTarget:Gv(E),interactionTargetElement:E,interactionType:c.name.startsWith("key")?"keyboard":"pointer",interactionTime:c.startTime,nextPaintTime:N,processedEventEntries:g,longAnimationFrameEntries:y,inputDelay:f-c.startTime,processingDuration:p-f,presentationDelay:Math.max(N-p,0),loadState:$0(c.startTime)};return Object.assign(o,{attribution:w})}(t);n(i)},e)},j_=[2500,4e3],Kp={},n2=function(n,e){(function(t,i){i=i||{},Kv(function(){var o,c=Q0(),d=Mi("LCP"),f=function(y){i.reportAllChanges||(y=y.slice(-1)),y.forEach(function(b){b.startTime<c.firstHiddenTime&&(d.value=Math.max(b.startTime-$v(),0),d.entries=[b],o())})},p=vl("largest-contentful-paint",f);if(p){o=ki(t,d,j_,i.reportAllChanges);var g=Qv(function(){Kp[d.id]||(f(p.takeRecords()),p.disconnect(),Kp[d.id]=!0,o(!0))});["keydown","click"].forEach(function(y){addEventListener(y,function(){return Xv(g)},{once:!0,capture:!0})}),Tf(g),_u(function(y){d=Mi("LCP"),o=ki(t,d,j_,i.reportAllChanges),Yv(function(){d.value=performance.now()-y.timeStamp,Kp[d.id]=!0,o(!0)})})}})})(function(t){var i=function(o){var c={timeToFirstByte:0,resourceLoadDelay:0,resourceLoadDuration:0,elementRenderDelay:o.value};if(o.entries.length){var d=_f();if(d){var f=d.activationStart||0,p=o.entries[o.entries.length-1],g=p.url&&performance.getEntriesByType("resource").filter(function(N){return N.name===p.url})[0],y=Math.max(0,d.responseStart-f),b=Math.max(y,g?(g.requestStart||g.startTime)-f:0),E=Math.max(b,g?g.responseEnd-f:0),j=Math.max(E,p.startTime-f);c={element:Gv(p.element),timeToFirstByte:y,resourceLoadDelay:b-y,resourceLoadDuration:E-b,elementRenderDelay:j-E,navigationEntry:d,lcpEntry:p},p.url&&(c.url=p.url),g&&(c.lcpResourceEntry=g)}}return Object.assign(o,{attribution:c})}(t);n(i)},e)};const A_="@firebase/performance",Rg="0.7.6";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tA=Rg,s2="FB-PERF-TRACE-START",a2="FB-PERF-TRACE-STOP",Dg="FB-PERF-TRACE-MEASURE",nA="_wt_",sA="_fp",aA="_fcp",iA="_fid",rA="_lcp",i2="lcp_element",oA="_inp",r2="inp_interactionTarget",lA="_cls",o2="cls_largestShiftTarget",cA="@firebase/performance/config",uA="@firebase/performance/configexpire",l2="performance",dA="Performance";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c2={"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."},gn=new Pi(l2,dA,c2);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oi=new lu(dA);Oi.logLevel=Ye.INFO;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xp,hA;class Gt{constructor(e){if(this.window=e,!e)throw gn.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay),this.onLCP=n2,this.onINP=t2,this.onCLS=YP}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){!this.performance||!this.performance.mark||this.performance.mark(e)}measure(e,t,i){!this.performance||!this.performance.measure||this.performance.measure(e,t,i)}getEntriesByType(e){return!this.performance||!this.performance.getEntriesByType?[]:this.performance.getEntriesByType(e)}getEntriesByName(e){return!this.performance||!this.performance.getEntriesByName?[]:this.performance.getEntriesByName(e)}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return!fetch||!Promise||!Lg()?(Oi.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1):Yh()?!0:(Oi.info("IndexedDB is not supported by current browser"),!1)}setupObserver(e,t){if(!this.PerformanceObserver)return;new this.PerformanceObserver(o=>{for(const c of o.getEntries())t(c)}).observe({entryTypes:[e]})}static getInstance(){return Xp===void 0&&(Xp=new Gt(hA)),Xp}}function u2(n){hA=n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fA;function d2(n){const e=n.getId();return e.then(t=>{fA=t}),e}function Zv(){return fA}function h2(n){const e=n.getToken();return e.then(t=>{}),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C_(n,e){const t=n.length-e.length;if(t<0||t>1)throw gn.create("invalid String merger input");const i=[];for(let o=0;o<n.length;o++)i.push(n.charAt(o)),e.length>o&&i.push(e.charAt(o));return i.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wp;class Hn{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=C_("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=C_("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return Wp===void 0&&(Wp=new Hn),Wp}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Hc;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.VISIBLE=1]="VISIBLE",n[n.HIDDEN=2]="HIDDEN"})(Hc||(Hc={}));const f2=["firebase_","google_","ga_"],m2=new RegExp("^[a-zA-Z]\\w*$"),p2=40,g2=100;function v2(){const n=Gt.getInstance().navigator;return n?.serviceWorker?n.serviceWorker.controller?2:3:1}function y2(){switch(Gt.getInstance().document.visibilityState){case"visible":return Hc.VISIBLE;case"hidden":return Hc.HIDDEN;default:return Hc.UNKNOWN}}function x2(){const e=Gt.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}function b2(n){return n.length===0||n.length>p2?!1:!f2.some(t=>n.startsWith(t))&&!!n.match(m2)}function N2(n){return n.length!==0&&n.length<=g2}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mA(n){var e;const t=(e=n.options)===null||e===void 0?void 0:e.appId;if(!t)throw gn.create("no app id");return t}function E2(n){var e;const t=(e=n.options)===null||e===void 0?void 0:e.projectId;if(!t)throw gn.create("no project id");return t}function _2(n){var e;const t=(e=n.options)===null||e===void 0?void 0:e.apiKey;if(!t)throw gn.create("no api key");return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T2="0.0.1",xs={loggingEnabled:!0},j2="FIREBASE_INSTALLATIONS_AUTH";function A2(n,e){const t=C2();return t?(w_(t),Promise.resolve()):I2(n,e).then(w_).then(i=>w2(i),()=>{})}function C2(){const n=Gt.getInstance().localStorage;if(!n)return;const e=n.getItem(uA);if(!e||!R2(e))return;const t=n.getItem(cA);if(t)try{return JSON.parse(t)}catch{return}}function w2(n){const e=Gt.getInstance().localStorage;!n||!e||(e.setItem(cA,JSON.stringify(n)),e.setItem(uA,String(Date.now()+Hn.getInstance().configTimeToLive*60*60*1e3)))}const S2="Could not fetch config, will use default configs";function I2(n,e){return h2(n.installations).then(t=>{const i=E2(n.app),o=_2(n.app),c=`https://firebaseremoteconfig.googleapis.com/v1/projects/${i}/namespaces/fireperf:fetch?key=${o}`,d=new Request(c,{method:"POST",headers:{Authorization:`${j2} ${t}`},body:JSON.stringify({app_instance_id:e,app_instance_id_token:t,app_id:mA(n.app),app_version:tA,sdk_version:T2})});return fetch(d).then(f=>{if(f.ok)return f.json();throw gn.create("RC response not ok")})}).catch(()=>{Oi.info(S2)})}function w_(n){if(!n)return n;const e=Hn.getInstance(),t=n.entries||{};return t.fpr_enabled!==void 0?e.loggingEnabled=String(t.fpr_enabled)==="true":e.loggingEnabled=xs.loggingEnabled,t.fpr_log_source?e.logSource=Number(t.fpr_log_source):xs.logSource&&(e.logSource=xs.logSource),t.fpr_log_endpoint_url?e.logEndPointUrl=t.fpr_log_endpoint_url:xs.logEndPointUrl&&(e.logEndPointUrl=xs.logEndPointUrl),t.fpr_log_transport_key?e.transportKey=t.fpr_log_transport_key:xs.transportKey&&(e.transportKey=xs.transportKey),t.fpr_vc_network_request_sampling_rate!==void 0?e.networkRequestsSamplingRate=Number(t.fpr_vc_network_request_sampling_rate):xs.networkRequestsSamplingRate!==void 0&&(e.networkRequestsSamplingRate=xs.networkRequestsSamplingRate),t.fpr_vc_trace_sampling_rate!==void 0?e.tracesSamplingRate=Number(t.fpr_vc_trace_sampling_rate):xs.tracesSamplingRate!==void 0&&(e.tracesSamplingRate=xs.tracesSamplingRate),e.logTraceAfterSampling=S_(e.tracesSamplingRate),e.logNetworkAfterSampling=S_(e.networkRequestsSamplingRate),n}function R2(n){return Number(n)>Date.now()}function S_(n){return Math.random()<=n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Jv=1,Zp;function pA(n){return Jv=2,Zp=Zp||M2(n),Zp}function D2(){return Jv===3}function M2(n){return k2().then(()=>d2(n.installations)).then(e=>A2(n,e)).then(()=>I_(),()=>I_())}function k2(){const n=Gt.getInstance().document;return new Promise(e=>{if(n&&n.readyState!=="complete"){const t=()=>{n.readyState==="complete"&&(n.removeEventListener("readystatechange",t),e())};n.addEventListener("readystatechange",t)}else e()})}function I_(){Jv=3}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gA=10*1e3,O2=5.5*1e3,P2=1e3,vA=3;let gh=vA,Rr=[],R_=!1;function L2(){R_||(ey(O2),R_=!0)}function ey(n){setTimeout(()=>{gh<=0||(Rr.length>0&&yA(),ey(gA))},n)}function yA(){const n=Rr.splice(0,P2),e=n.map(i=>({source_extension_json_proto3:i.message,event_time_ms:String(i.eventTime)})),t={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:Hn.getInstance().logSource,log_event:e};V2(t).then(()=>{gh=vA}).catch(()=>{Rr=[...n,...Rr],gh--,Oi.info(`Tries left: ${gh}.`),ey(gA)})}function V2(n){const e=Hn.getInstance().getFlTransportFullUrl(),t=JSON.stringify(n);return navigator.sendBeacon&&navigator.sendBeacon(e,t)?Promise.resolve():fetch(e,{method:"POST",body:t,keepalive:!0}).then()}function U2(n){if(!n.eventTime||!n.message)throw gn.create("invalid cc log");Rr=[...Rr,n]}function F2(n){return(...e)=>{const t=n(...e);U2({message:t,eventTime:Date.now()})}}function q2(){for(;Rr.length>0;)yA()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gc;function xA(n,e){Gc||(Gc={send:F2(H2),flush:q2}),Gc.send(n,e)}function ih(n){const e=Hn.getInstance();!e.instrumentationEnabled&&n.isAuto||!e.dataCollectionEnabled&&!n.isAuto||Gt.getInstance().requiredApisAvailable()&&(D2()?Jp(n):pA(n.performanceController).then(()=>Jp(n),()=>Jp(n)))}function B2(){Gc&&Gc.flush()}function Jp(n){if(!Zv())return;const e=Hn.getInstance();!e.loggingEnabled||!e.logTraceAfterSampling||xA(n,1)}function z2(n){const e=Hn.getInstance();if(!e.instrumentationEnabled)return;const t=n.url,i=e.logEndPointUrl.split("?")[0],o=e.flTransportEndpointUrl.split("?")[0];t===i||t===o||!e.loggingEnabled||!e.logNetworkAfterSampling||xA(n,0)}function H2(n,e){return e===0?G2(n):$2(n)}function G2(n){const e={url:n.url,http_method:n.httpMethod||0,http_response_code:200,response_payload_bytes:n.responsePayloadBytes,client_start_time_us:n.startTimeUs,time_to_response_initiated_us:n.timeToResponseInitiatedUs,time_to_response_completed_us:n.timeToResponseCompletedUs},t={application_info:bA(n.performanceController.app),network_request_metric:e};return JSON.stringify(t)}function $2(n){const e={name:n.name,is_auto:n.isAuto,client_start_time_us:n.startTimeUs,duration_us:n.durationUs};Object.keys(n.counters).length!==0&&(e.counters=n.counters);const t=n.getAttributes();Object.keys(t).length!==0&&(e.custom_attributes=t);const i={application_info:bA(n.performanceController.app),trace_metric:e};return JSON.stringify(i)}function bA(n){return{google_app_id:mA(n),app_instance_id:Zv(),web_app_info:{sdk_version:tA,page_url:Gt.getInstance().getUrl(),service_worker_status:v2(),visibility_state:y2(),effective_connection_type:x2()},application_process_state:0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D_(n,e){const t=e;if(!t||t.responseStart===void 0)return;const i=Gt.getInstance().getTimeOrigin(),o=Math.floor((t.startTime+i)*1e3),c=t.responseStart?Math.floor((t.responseStart-t.startTime)*1e3):void 0,d=Math.floor((t.responseEnd-t.startTime)*1e3),f=t.name&&t.name.split("?")[0],p={performanceController:n,url:f,responsePayloadBytes:t.transferSize,startTimeUs:o,timeToResponseInitiatedUs:c,timeToResponseCompletedUs:d};z2(p)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y2=100,Q2="_",K2=[sA,aA,iA,rA,lA,oA];function X2(n,e){return n.length===0||n.length>Y2?!1:e&&e.startsWith(nA)&&K2.indexOf(n)>-1||!n.startsWith(Q2)}function W2(n){const e=Math.floor(n);return e<n&&Oi.info(`Metric value should be an Integer, setting the value as : ${e}.`),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class au{constructor(e,t,i=!1,o){this.performanceController=e,this.name=t,this.isAuto=i,this.state=1,this.customAttributes={},this.counters={},this.api=Gt.getInstance(),this.randomId=Math.floor(Math.random()*1e6),this.isAuto||(this.traceStartMark=`${s2}-${this.randomId}-${this.name}`,this.traceStopMark=`${a2}-${this.randomId}-${this.name}`,this.traceMeasure=o||`${Dg}-${this.randomId}-${this.name}`,o&&this.calculateTraceMetrics())}start(){if(this.state!==1)throw gn.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(this.state!==2)throw gn.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),ih(this)}record(e,t,i){if(e<=0)throw gn.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw gn.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(t*1e3),this.startTimeUs=Math.floor(e*1e3),i&&i.attributes&&(this.customAttributes=Object.assign({},i.attributes)),i&&i.metrics)for(const o of Object.keys(i.metrics))isNaN(Number(i.metrics[o]))||(this.counters[o]=Math.floor(Number(i.metrics[o])));ih(this)}incrementMetric(e,t=1){this.counters[e]===void 0?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(X2(e,this.name))this.counters[e]=W2(t??0);else throw gn.create("invalid custom metric name",{customMetricName:e})}getMetric(e){return this.counters[e]||0}putAttribute(e,t){const i=b2(e),o=N2(t);if(i&&o){this.customAttributes[e]=t;return}if(!i)throw gn.create("invalid attribute name",{attributeName:e});if(!o)throw gn.create("invalid attribute value",{attributeValue:t})}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){this.customAttributes[e]!==void 0&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){const e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(t.duration*1e3),this.startTimeUs=Math.floor((t.startTime+this.api.getTimeOrigin())*1e3))}static createOobTrace(e,t,i,o,c){const d=Gt.getInstance().getUrl();if(!d)return;const f=new au(e,nA+d,!0),p=Math.floor(Gt.getInstance().getTimeOrigin()*1e3);f.setStartTime(p),t&&t[0]&&(f.setDuration(Math.floor(t[0].duration*1e3)),f.putMetric("domInteractive",Math.floor(t[0].domInteractive*1e3)),f.putMetric("domContentLoadedEventEnd",Math.floor(t[0].domContentLoadedEventEnd*1e3)),f.putMetric("loadEventEnd",Math.floor(t[0].loadEventEnd*1e3)));const g="first-paint",y="first-contentful-paint";if(i){const b=i.find(j=>j.name===g);b&&b.startTime&&f.putMetric(sA,Math.floor(b.startTime*1e3));const E=i.find(j=>j.name===y);E&&E.startTime&&f.putMetric(aA,Math.floor(E.startTime*1e3)),c&&f.putMetric(iA,Math.floor(c*1e3))}this.addWebVitalMetric(f,rA,i2,o.lcp),this.addWebVitalMetric(f,lA,o2,o.cls),this.addWebVitalMetric(f,oA,r2,o.inp),ih(f),B2()}static addWebVitalMetric(e,t,i,o){o&&(e.putMetric(t,Math.floor(o.value*1e3)),o.elementAttribution&&e.putAttribute(i,o.elementAttribution))}static createUserTimingTrace(e,t){const i=new au(e,t,!1,t);ih(i)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vh={},M_=!1,NA;function k_(n){Zv()&&(setTimeout(()=>J2(n),0),setTimeout(()=>Z2(n),0),setTimeout(()=>eL(n),0))}function Z2(n){const e=Gt.getInstance(),t=e.getEntriesByType("resource");for(const i of t)D_(n,i);e.setupObserver("resource",i=>D_(n,i))}function J2(n){const e=Gt.getInstance();"onpagehide"in window?e.document.addEventListener("pagehide",()=>eg(n)):e.document.addEventListener("unload",()=>eg(n)),e.document.addEventListener("visibilitychange",()=>{e.document.visibilityState==="hidden"&&eg(n)}),e.onFirstInputDelay&&e.onFirstInputDelay(t=>{NA=t}),e.onLCP(t=>{var i;vh.lcp={value:t.value,elementAttribution:(i=t.attribution)===null||i===void 0?void 0:i.element}}),e.onCLS(t=>{var i;vh.cls={value:t.value,elementAttribution:(i=t.attribution)===null||i===void 0?void 0:i.largestShiftTarget}}),e.onINP(t=>{var i;vh.inp={value:t.value,elementAttribution:(i=t.attribution)===null||i===void 0?void 0:i.interactionTarget}})}function eL(n){const e=Gt.getInstance(),t=e.getEntriesByType("measure");for(const i of t)O_(n,i);e.setupObserver("measure",i=>O_(n,i))}function O_(n,e){const t=e.name;t.substring(0,Dg.length)!==Dg&&au.createUserTimingTrace(n,t)}function eg(n){if(!M_){M_=!0;const e=Gt.getInstance(),t=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");setTimeout(()=>{au.createOobTrace(n,t,i,vh,NA)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tL{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(e?.dataCollectionEnabled!==void 0&&(this.dataCollectionEnabled=e.dataCollectionEnabled),e?.instrumentationEnabled!==void 0&&(this.instrumentationEnabled=e.instrumentationEnabled),Gt.getInstance().requiredApisAvailable()?Qh().then(t=>{t&&(L2(),pA(this).then(()=>k_(this),()=>k_(this)),this.initialized=!0)}).catch(t=>{Oi.info(`Environment doesn't support IndexedDB: ${t}`)}):Oi.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){Hn.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return Hn.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){Hn.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return Hn.getInstance().dataCollectionEnabled}}const nL="[DEFAULT]";function sL(n=cu()){return n=yt(n),Pa(n,"performance").getImmediate()}const aL=(n,{options:e})=>{const t=n.getProvider("app").getImmediate(),i=n.getProvider("installations-internal").getImmediate();if(t.name!==nL)throw gn.create("FB not default");if(typeof window>"u")throw gn.create("no window");u2(window);const o=new tL(t,i);return o._init(e),o};function iL(){us(new Yn("performance",aL,"PUBLIC")),vn(A_,Rg),vn(A_,Rg,"esm2017")}iL();const rL={apiKey:"AIzaSyCbU834quCY8hjSffRwljJLgZrcxK8i2F4",authDomain:"liquidacionapp-62962.firebaseapp.com",projectId:"liquidacionapp-62962",storageBucket:"liquidacionapp-62962.firebasestorage.app",messagingSenderId:"851382130132",appId:"1:851382130132:web:eaba38fab449f14fb5b241",measurementId:void 0},iu=oT(rL),$c=k1(iu),he=kk(iu);xO(iu);let oL=null,lL=null;try{FP().then(n=>{n&&(oL=VP(iu))}).catch(()=>{console.warn("Firebase Analytics no está soportado en este entorno")}),typeof window<"u"&&(lL=sL(iu))}catch(n){console.warn("Error al inicializar Firebase Analytics/Performance:",n)}const Ns={ADMIN:"admin",CONTADOR:"contador",CLIENTE:"cliente"},ht={MANAGE_INVENTORY:"canManageInventory",CREATE_MOVEMENTS:"canCreateMovements",VIEW_ALL_MOVEMENTS:"canViewAllMovements",MANAGE_VEHICLES:"canManageVehicles",MANAGE_MAINTENANCE:"canManageMaintenance",MANAGE_SUPPLIERS:"canManageSuppliers",VIEW_REPORTS:"canViewReports",EXPORT_REPORTS:"canExportReports",MODIFY_SETTINGS:"canModifySettings"},cL="contacto.evert@gmail.com",EA=n=>{switch(n){case Ns.ADMIN:return{[ht.MANAGE_INVENTORY]:!0,[ht.CREATE_MOVEMENTS]:!0,[ht.VIEW_ALL_MOVEMENTS]:!0,[ht.MANAGE_VEHICLES]:!0,[ht.MANAGE_MAINTENANCE]:!0,[ht.MANAGE_SUPPLIERS]:!0,[ht.VIEW_REPORTS]:!0,[ht.EXPORT_REPORTS]:!0,[ht.MODIFY_SETTINGS]:!0};case Ns.CONTADOR:return{[ht.MANAGE_INVENTORY]:!0,[ht.CREATE_MOVEMENTS]:!0,[ht.VIEW_ALL_MOVEMENTS]:!0,[ht.MANAGE_VEHICLES]:!1,[ht.MANAGE_MAINTENANCE]:!0,[ht.MANAGE_SUPPLIERS]:!1,[ht.VIEW_REPORTS]:!0,[ht.EXPORT_REPORTS]:!0,[ht.MODIFY_SETTINGS]:!1};case Ns.CLIENTE:default:return{[ht.MANAGE_INVENTORY]:!1,[ht.CREATE_MOVEMENTS]:!0,[ht.VIEW_ALL_MOVEMENTS]:!1,[ht.MANAGE_VEHICLES]:!1,[ht.MANAGE_MAINTENANCE]:!1,[ht.MANAGE_SUPPLIERS]:!1,[ht.VIEW_REPORTS]:!1,[ht.EXPORT_REPORTS]:!1,[ht.MODIFY_SETTINGS]:!1}}},uL=n=>n===cL?Ns.ADMIN:Ns.CLIENTE,rl=()=>"artifacts/1:851382130132:web:eaba38fab449f14fb5b241/invitations",dL=()=>{const n="ABCDEFGHIJKLMNPQRSTUVWXYZ123456789";let e="";for(let t=0;t<8;t++)e+=n.charAt(Math.floor(Math.random()*n.length));return e},hL=async(n,e)=>{try{const t=await jf(e);if(!t.success||t.userData.role!=="admin")return{success:!1,error:"Solo administradores pueden crear invitaciones"};let i,o=!1,c=0;for(;!o&&c<10;){i=dL();const p=Ae(Ee(he,rl()),De("code","==",i));(await He(p)).empty&&(o=!0),c++}if(!o)return{success:!1,error:"No se pudo generar un código único"};const d=et(Ee(he,rl())),f={code:i,targetEmail:n.email.toLowerCase(),targetRole:n.role||Ns.CLIENTE,targetName:n.name||"",status:"pending",appContext:"combustibles",expiresAt:new Date(Date.now()+7*24*60*60*1e3),createdAt:Ue(),createdBy:e,usedAt:null,usedBy:null};return await yf(d,f),console.log("🎫 Invitación creada:",{code:i,email:n.email,role:n.role}),{success:!0,invitation:{id:d.id,code:i,...f}}}catch(t){return console.error("Error creating invitation:",t),{success:!1,error:t.message}}},_A=async n=>{try{const e=Ae(Ee(he,rl()),De("code","==",n.toUpperCase()),De("status","==","pending")),t=await He(e);if(t.empty)return{success:!1,error:"Código de invitación inválido o expirado"};const i=t.docs[0],o=i.data(),c=new Date,d=o.expiresAt.toDate();return c>d?{success:!1,error:"Código de invitación expirado"}:{success:!0,invitation:{id:i.id,...o}}}catch(e){return console.error("Error validating invitation:",e),{success:!1,error:e.message}}},fL=async(n,e)=>{try{const t=et(he,rl(),n);return await As(t,{status:"used",usedAt:Ue(),usedBy:e}),{success:!0}}catch(t){return console.error("Error marking invitation as used:",t),{success:!1,error:t.message}}},mL=async n=>{try{const e=await jf(n);if(!e.success||e.userData.role!=="admin")return{success:!1,error:"Solo administradores pueden ver invitaciones"};const t=Ae(Ee(he,rl())),i=await He(t),o=[];return i.forEach(c=>{o.push({id:c.id,...c.data()})}),o.sort((c,d)=>{const f=c.createdAt?.toDate()||new Date(0);return(d.createdAt?.toDate()||new Date(0))-f}),{success:!0,invitations:o}}catch(e){return console.error("Error getting invitations:",e),{success:!1,error:e.message}}},pL=async(n,e)=>{try{const t=await jf(e);if(!t.success||t.userData.role!=="admin")return{success:!1,error:"Solo administradores pueden cancelar invitaciones"};const i=et(he,rl(),n);return await As(i,{status:"cancelled",cancelledAt:Ue(),cancelledBy:e}),{success:!0}}catch(t){return console.error("Error cancelling invitation:",t),{success:!1,error:t.message}}},gL=n=>EA(n.targetRole),TA=async(n,e={})=>{const t=et(he,"artifacts/1:851382130132:web:eaba38fab449f14fb5b241/users",n.uid);try{const i=await Bi(t);if(i.exists())return{success:!0,userData:i.data(),isNewUser:!1};{const o=uL(n.email),c={uid:n.uid,email:n.email,displayName:n.displayName||"",photoURL:n.photoURL||"",role:o,emailVerified:n.emailVerified,combustiblesPermissions:EA(o),createdAt:new Date().toISOString(),lastLogin:new Date().toISOString(),...e};return await yf(t,c),{success:!0,userData:c,isNewUser:!0}}}catch(i){return console.error("Error creating/updating user profile:",i),{success:!1,error:i.message}}},P_=async(n,e,t={})=>{const i=et(he,"artifacts/1:851382130132:web:eaba38fab449f14fb5b241/users",n.uid);try{const o=await Bi(i);if(o.exists())return{success:!0,userData:o.data(),isNewUser:!1};const c=await _A(e);if(!c.success)return c;const d=c.invitation;if(d.targetEmail!==n.email.toLowerCase())return{success:!1,error:"El código de invitación no corresponde a este email"};const f={uid:n.uid,email:n.email,displayName:n.displayName||d.targetName||"",photoURL:n.photoURL||"",role:d.targetRole,emailVerified:n.emailVerified,combustiblesPermissions:gL(d),invitationUsed:d.id,createdAt:new Date().toISOString(),lastLogin:new Date().toISOString(),...t};return await yf(i,f),await fL(d.id,n.uid),console.log("👤 Usuario creado con invitación:",{email:n.email,role:d.targetRole,invitationCode:d.code}),{success:!0,userData:f,isNewUser:!0}}catch(o){return console.error("Error creating user profile with invitation:",o),{success:!1,error:o.message}}},jf=async n=>{try{const e=et(he,"artifacts/1:851382130132:web:eaba38fab449f14fb5b241/users",n),t=await Bi(e);return t.exists()?{success:!0,userData:t.data()}:{success:!1,error:"Usuario no encontrado"}}catch(e){return console.error("Error fetching user profile:",e),{success:!1,error:e.message}}},Tn={DIESEL:"diesel",GASOLINE:"gasoline",ACPM:"acpm",LUBRICANTS:"lubricants",TWO_STROKE:"two_stroke",MIXED:"mixed"},ol={[Tn.DIESEL]:{name:"Diésel",description:"Combustible para maquinaria pesada",unit:"galones",category:"Combustible",color:"#fbbf24",icon:"🚛",density:.85,priceUnit:"COP/galón"},[Tn.GASOLINE]:{name:"Gasolina",description:"Combustible para vehículos livianos",unit:"galones",category:"Combustible",color:"#ef4444",icon:"⛽",density:.75,priceUnit:"COP/galón"},[Tn.ACPM]:{name:"ACPM",description:"Aceite Combustible Para Motor",unit:"galones",category:"Combustible",color:"#8b5cf6",icon:"🚜",density:.85,priceUnit:"COP/galón"},[Tn.LUBRICANTS]:{name:"Lubricantes",description:"Aceites y lubricantes para mantenimiento",unit:"litros",category:"Mantenimiento",color:"#06b6d4",icon:"🛢️",density:.9,priceUnit:"COP/litro"},[Tn.TWO_STROKE]:{name:"Mezcla 2T",description:"Mezcla para motores de 2 tiempos (motosierras)",unit:"litros",category:"Especializado",color:"#10b981",icon:"🪚",density:.78,priceUnit:"COP/litro"},[Tn.MIXED]:{name:"Mixto",description:"Compatible con múltiples tipos de combustible",unit:"galones",category:"Flexible",color:"#64748b",icon:"🔄",density:.8,priceUnit:"COP/galón"}},_n={CRITICAL:"critical",LOW:"low",MEDIUM:"medium",HIGH:"high",FULL:"full"},$o={[_n.CRITICAL]:{label:"Crítico",color:"#dc2626",icon:"🚨",threshold:.1},[_n.LOW]:{label:"Bajo",color:"#ea580c",icon:"⚠️",threshold:.25},[_n.MEDIUM]:{label:"Medio",color:"#ca8a04",icon:"📊",threshold:.5},[_n.HIGH]:{label:"Alto",color:"#16a34a",icon:"✅",threshold:.75},[_n.FULL]:{label:"Completo",color:"#059669",icon:"🟢",threshold:1}},jA=(n,e)=>{if(e===0)return _n.CRITICAL;const t=n/e;return t<$o[_n.CRITICAL].threshold?_n.CRITICAL:t<$o[_n.LOW].threshold?_n.LOW:t<$o[_n.MEDIUM].threshold?_n.MEDIUM:t<$o[_n.HIGH].threshold?_n.HIGH:_n.FULL},vL=(n,e=[])=>{if(!n||!n.fuelType||!n.quantity)return{isValid:!1,error:"Datos de movimiento incompletos",availableStock:0,requiredStock:0};const{fuelType:t,quantity:i,type:o,sourceLocation:c}=n,d=parseFloat(i)||0;if(o!=="outbound"&&o!=="transfer")return{isValid:!0,message:"Movimiento no requiere validación de stock",availableStock:0,requiredStock:d};const f=e.filter(y=>y.fuelType===t&&y.location?.toLowerCase()===c?.toLowerCase()&&y.status==="active").reduce((y,b)=>y+(parseFloat(b.currentStock)||0),0),p=f>=d,g=f-d;return console.log(`Validación de stock - Tipo: ${t}, Ubicación: ${c}`,{itemsEncontrados:e.filter(y=>y.fuelType===t&&y.location?.toLowerCase()===c?.toLowerCase()&&y.status==="active").length,disponible:f,requerido:d,valido:f>=d}),{isValid:p,availableStock:f,requiredStock:d,remainingStock:g,fuelType:t,location:c,error:p?null:`Stock insuficiente. Disponible: ${f}, Requerido: ${d}`,warning:g<f*.2&&g>=0?"Stock quedará bajo después del movimiento":null}},Nt=n=>typeof n!="number"||isNaN(n)?"$0":new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(n),be=(n,e=2)=>typeof n!="number"||isNaN(n)?"0":new Intl.NumberFormat("es-CO",{minimumFractionDigits:e,maximumFractionDigits:e}).format(n),Ar=(n,e=1)=>typeof n!="number"||isNaN(n)?"0%":`${(n*100).toFixed(e)}%`,Ti=(n,e,t=2)=>{const i=parseFloat(n)||0,o=parseFloat(e)||0;return parseFloat((i+o).toFixed(t))},ru=(n,e,t=2)=>{const i=parseFloat(n)||0,o=parseFloat(e)||0;return parseFloat((i-o).toFixed(t))},Rt=(n,e=2)=>{const t=parseFloat(n)||0;return parseFloat(t.toFixed(e))},ji=["principal","campamento austria","campamento ilusion","bodega austria","bodega ilusion","campo operativo","estación móvil"],yL=["bodega austria","bodega ilusion"],$s=n=>n?n.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"",Hr="combustibles_movements",ls="combustibles_inventory",de={ENTRADA:"entrada",SALIDA:"salida",TRANSFERENCIA:"transferencia",AJUSTE:"ajuste"},gt={PENDIENTE:"pendiente",COMPLETADO:"completado",CANCELADO:"cancelado"},AA=async n=>{try{bL(n);const e={...n,createdAt:Ue(),updatedAt:Ue(),status:gt.COMPLETADO,approvedAt:Ue(),totalValue:RA(n),effectiveDate:n.effectiveDate||Ue()},t=await Uv(he,async i=>{const o=et(Ee(he,Hr));return i.set(o,e),await DA(i,e,o.id),o.id});return console.log("✅ Movimiento creado exitosamente:",t),t}catch(e){throw console.error("❌ Error al crear movimiento:",e),new Error(`Error al crear movimiento: ${e.message}`)}},CA=async(n={})=>{try{let e=Ee(he,Hr);n.type&&(e=Ae(e,De("type","==",n.type))),n.status&&(e=Ae(e,De("status","==",n.status))),n.fuelType&&(e=Ae(e,De("fuelType","==",n.fuelType))),n.vehicleId&&(e=Ae(e,De("vehicleId","==",n.vehicleId))),e=Ae(e,Cn("createdAt","desc"));const t=await He(e),i=[];return t.forEach(o=>{i.push({id:o.id,...o.data(),createdAt:o.data().createdAt?.toDate?.()||o.data().createdAt,updatedAt:o.data().updatedAt?.toDate?.()||o.data().updatedAt,effectiveDate:o.data().effectiveDate?.toDate?.()||o.data().effectiveDate})}),i}catch(e){throw console.error("❌ Error al obtener movimientos:",e),new Error(`Error al obtener movimientos: ${e.message}`)}},ty=async n=>{try{if(!n)throw new Error("ID de movimiento requerido");const e=et(he,Hr,n),t=await Bi(e);return t.exists()?{id:t.id,...t.data(),createdAt:t.data().createdAt?.toDate?.()||t.data().createdAt,updatedAt:t.data().updatedAt?.toDate?.()||t.data().updatedAt,effectiveDate:t.data().effectiveDate?.toDate?.()||t.data().effectiveDate}:null}catch(e){throw console.error("❌ Error al obtener movimiento:",e),new Error(`Error al obtener movimiento: ${e.message}`)}},wA=async(n,e)=>{try{if(!n)throw new Error("ID de movimiento requerido");const t={...e,updatedAt:Ue(),...e.quantity||e.unitPrice?{totalValue:RA(e)}:{}},i=et(he,Hr,n);await As(i,t),console.log("✅ Movimiento actualizado exitosamente")}catch(t){throw console.error("❌ Error al actualizar movimiento:",t),new Error(`Error al actualizar movimiento: ${t.message}`)}},xL=async n=>{try{if(!n)throw new Error("ID de movimiento requerido");const e=await ty(n);if(!e)throw new Error("Movimiento no encontrado");await Uv(he,async t=>{const i=et(he,Hr,n);e.status===gt.COMPLETADO&&await NL(t,e),t.delete(i)}),console.log("✅ Movimiento eliminado y cambios de inventario revertidos exitosamente")}catch(e){throw console.error("❌ Error al eliminar movimiento:",e),new Error(`Error al eliminar movimiento: ${e.message}`)}},ny=(n,e={})=>{try{let t=Ee(he,Hr);return e.type&&(t=Ae(t,De("type","==",e.type))),e.status&&(t=Ae(t,De("status","==",e.status))),t=Ae(t,Cn("createdAt","desc")),zr(t,i=>{const o=[];i.forEach(c=>{o.push({id:c.id,...c.data(),createdAt:c.data().createdAt?.toDate?.()||c.data().createdAt,updatedAt:c.data().updatedAt?.toDate?.()||c.data().updatedAt,effectiveDate:c.data().effectiveDate?.toDate?.()||c.data().effectiveDate})}),n(o)},i=>{console.error("❌ Error en suscripción de movimientos:",i),n([],i)})}catch(t){throw console.error("❌ Error al configurar suscripción:",t),new Error(`Error en suscripción: ${t.message}`)}},SA=async n=>{try{const e=await ty(n);if(!e)throw new Error("Movimiento no encontrado");if(e.status!==gt.PENDIENTE)throw new Error("Solo se pueden aprobar movimientos pendientes");await Uv(he,async t=>{const i=et(he,Hr,n);t.update(i,{status:gt.COMPLETADO,approvedAt:Ue(),updatedAt:Ue()}),await DA(t,e,n)}),console.log("✅ Movimiento aprobado exitosamente")}catch(e){throw console.error("❌ Error al aprobar movimiento:",e),new Error(`Error al aprobar movimiento: ${e.message}`)}},IA=async(n={})=>{try{const e=await CA(n),t={totalMovements:e.length,byType:{},byStatus:{},byFuelType:{},totalValue:0,totalQuantity:0,averageValue:0,thisMonth:0,lastMonth:0,thisWeek:0},i=new Date,o=new Date(i.getFullYear(),i.getMonth(),1),c=new Date(i.getFullYear(),i.getMonth()-1,1),d=new Date(i.setDate(i.getDate()-i.getDay()));return e.forEach(f=>{t.byType[f.type]=(t.byType[f.type]||0)+1,t.byStatus[f.status]=(t.byStatus[f.status]||0)+1,t.byFuelType[f.fuelType]=(t.byFuelType[f.fuelType]||0)+1,t.totalValue+=f.totalValue||0,t.totalQuantity+=f.quantity||0;const p=new Date(f.createdAt);p>=o&&t.thisMonth++,p>=c&&p<o&&t.lastMonth++,p>=d&&t.thisWeek++}),t.averageValue=t.totalMovements>0?t.totalValue/t.totalMovements:0,t}catch(e){throw console.error("❌ Error al calcular estadísticas:",e),new Error(`Error al calcular estadísticas: ${e.message}`)}},L_=n=>n?ji.includes(n.toLowerCase()):!1,bL=n=>{console.log("🔍 [VALIDATE] Datos recibidos en validateMovementData:",n),console.log("🔍 [VALIDATE] Tipo de movementData:",typeof n),console.log("🔍 [VALIDATE] Es array?:",Array.isArray(n)),console.log("🔍 [VALIDATE] Keys disponibles:",Object.keys(n||{}));const e=["type","fuelType","quantity","unitPrice"];for(const t of e){const i=n[t],o=t in n,c=!i;if(console.log(`🔍 [VALIDATE] Campo ${t}:`,{exists:o,value:i,type:typeof i,isFalsy:c,length:typeof i=="string"?i.length:"N/A"}),!n[t])throw console.error(`❌ [VALIDATE] FALLO EN CAMPO: ${t}`,{fieldValue:i,movementData:n,allFields:e.map(d=>({[d]:n[d]}))}),new Error(`Campo requerido: ${t}`)}if(!Object.values(de).includes(n.type))throw new Error("Tipo de movimiento inválido");if(n.quantity<=0)throw new Error("La cantidad debe ser mayor a cero");if(n.unitPrice<0)throw new Error("El precio unitario no puede ser negativo");if(n.type===de.SALIDA&&!n.vehicleId)throw new Error("Las salidas deben tener un vehículo asociado");if(n.type===de.TRANSFERENCIA&&!n.destinationLocation)throw new Error("Las transferencias deben tener una ubicación destino");if(n.type===de.ENTRADA){if(!n.supplierName)throw new Error("Las entradas deben tener un proveedor");if(!n.destinationLocation)throw new Error("Las entradas deben tener una ubicación destino")}if(n.type!==de.ENTRADA&&n.location&&!L_(n.location))throw new Error(`Ubicación origen inválida: ${n.location}. Ubicaciones válidas: ${ji.join(", ")}`);if(n.destinationLocation&&!L_(n.destinationLocation))throw new Error(`Ubicación destino inválida: ${n.destinationLocation}. Ubicaciones válidas: ${ji.join(", ")}`);if(n.type===de.TRANSFERENCIA){const t=(n.location||"principal").toLowerCase(),i=n.destinationLocation.toLowerCase();if(t===i)throw new Error("La ubicación origen y destino no pueden ser la misma en una transferencia")}},RA=n=>(n.quantity||0)*(n.unitPrice||0),DA=async(n,e,t)=>{try{let i=e.location||"principal";e.type===de.ENTRADA&&(i=e.destinationLocation||"principal");const o=Ae(Ee(he,ls),De("fuelType","==",e.fuelType),De("location","==",i)),c=await He(o);if(c.empty){if(e.type!==de.ENTRADA)throw new Error(`No se encontró inventario para ${e.fuelType} en ${i} para realizar un movimiento de ${e.type}.`);console.log(`📦 Creando inventario automático para ${e.fuelType} en ${i}`);const d=et(Ee(he,ls)),f={fuelType:e.fuelType,location:i,name:e.fuelType,maxCapacity:1e4,currentStock:Rt(e.quantity,2),minThreshold:1500,pricePerUnit:e.unitPrice||0,createdAt:Ue(),updatedAt:Ue(),status:"active",lastMovement:{movementId:t,type:e.type,quantity:e.quantity,date:Ue()}};n.set(d,f)}else{const d=c.docs[0],f=d.data(),p=et(he,ls,d.id);let g=f.currentStock;switch(e.type){case de.ENTRADA:g=Ti(g,e.quantity);break;case de.SALIDA:if(g=ru(g,e.quantity),g<0)throw new Error("Stock insuficiente para realizar la salida");break;case de.AJUSTE:g=Ti(g,e.quantity),g<0&&(g=0);break;case de.TRANSFERENCIA:if(g=ru(g,e.quantity),g<0)throw new Error("Stock insuficiente para realizar la transferencia");await EL(n,e,t);break}g=Rt(g,2),n.update(p,{currentStock:g,lastMovement:{movementId:t,type:e.type,quantity:e.quantity,date:Ue()},updatedAt:Ue()})}e.type===de.SALIDA&&e.vehicleId&&e.currentHours&&await U_(n,e.vehicleId,e.currentHours),e.type===de.SALIDA&&e.vehicleId&&e.currentHours&&await U_(n,e.vehicleId,e.currentHours)}catch(i){throw console.error("❌ Error al actualizar inventario:",i),i}},NL=async(n,e)=>{try{console.log("🔄 Revirtiendo cambios de inventario para movimiento:",e.id);let t;switch(e.type){case de.ENTRADA:t=e.destinationLocation||"principal";break;case de.SALIDA:case de.AJUSTE:t=e.location||"principal";break;case de.TRANSFERENCIA:t=e.location||"principal";break;default:t=e.location||e.destinationLocation||"principal"}console.log(`🔍 Buscando inventario: ${e.fuelType} en ${t}`);const i=Ae(Ee(he,ls),De("fuelType","==",e.fuelType),De("location","==",t)),o=await He(i);if(o.empty){console.warn(`⚠️ No se encontró inventario para ${e.fuelType} en ${t}`);const p=Ae(Ee(he,ls),De("fuelType","==",e.fuelType)),g=await He(p);if(g.empty)throw console.error(`❌ No existe inventario para ${e.fuelType} en ninguna ubicación`),new Error(`No se puede revertir: no existe inventario para ${e.fuelType} en ninguna ubicación. Movimiento huérfano detectado.`);console.log(`🔄 Usando inventario fallback en ${g.docs[0].data().location}`);const y=g.docs[0],b=y.data(),E=et(he,ls,y.id);await V_(n,E,b,e);return}const c=o.docs[0],d=c.data(),f=et(he,ls,c.id);await V_(n,f,d,e)}catch(t){throw console.error("❌ Error al revertir cambios de inventario:",t),new Error(`Error al revertir inventario: ${t.message}`)}},V_=async(n,e,t,i)=>{try{let o=t.currentStock;switch(i.type){case de.ENTRADA:o=ru(o,i.quantity),o<0&&(console.warn("⚠️ Advertencia: La reversión resulta en stock negativo, ajustando a 0"),o=0);break;case de.SALIDA:o=Ti(o,i.quantity);break;case de.AJUSTE:o=ru(o,i.quantity),o<0&&(console.warn("⚠️ Advertencia: La reversión de ajuste resulta en stock negativo, ajustando a 0"),o=0);break;case de.TRANSFERENCIA:o=Ti(o,i.quantity),await _L(n,i);break;default:throw new Error(`Tipo de movimiento no soportado para reversión: ${i.type}`)}o=Rt(o,2),n.update(e,{currentStock:o,lastMovement:{movementId:null,type:"reversion",quantity:i.quantity,originalType:i.type,date:Ue(),note:`Reversión de movimiento ${i.id} - Ubicación original: ${i.location||i.destinationLocation||"no especificada"}`},updatedAt:Ue()}),console.log(`✅ Inventario revertido exitosamente. Stock anterior: ${t.currentStock}, Nuevo stock: ${o}`)}catch(o){throw console.error("❌ Error en procesamiento de reversión:",o),o}},EL=async(n,e,t)=>{try{if(!e.destinationLocation)throw new Error("Ubicación destino requerida para transferencias");console.log(`🔄 Transfiriendo ${e.quantity} ${e.fuelType} a ${e.destinationLocation}`);const i=Ae(Ee(he,ls),De("fuelType","==",e.fuelType),De("location","==",e.destinationLocation)),o=await He(i);if(o.empty){console.log(`📦 Creando inventario automático en destino: ${e.fuelType} en ${e.destinationLocation}`);const c=et(Ee(he,ls)),d={fuelType:e.fuelType,location:e.destinationLocation,name:e.fuelType,maxCapacity:1e4,currentStock:Rt(e.quantity,2),minThreshold:1500,pricePerUnit:e.unitPrice||0,createdAt:Ue(),updatedAt:Ue(),status:"active",lastMovement:{movementId:t,type:"transferencia_entrada",quantity:e.quantity,date:Ue(),originLocation:e.location}};n.set(c,d)}else{const c=o.docs[0],d=c.data(),f=et(he,ls,c.id),p=Rt(Ti(d.currentStock,e.quantity),2);n.update(f,{currentStock:p,lastMovement:{movementId:t,type:"transferencia_entrada",quantity:e.quantity,date:Ue(),originLocation:e.location},updatedAt:Ue()})}console.log("✅ Transferencia al destino completada exitosamente")}catch(i){throw console.error("❌ Error al transferir a destino:",i),new Error(`Error en transferencia a destino: ${i.message}`)}},_L=async(n,e)=>{try{if(!e.destinationLocation){console.warn("⚠️ No hay ubicación destino para revertir");return}console.log(`🔄 Revirtiendo transferencia en destino: ${e.destinationLocation}`);const t=Ae(Ee(he,ls),De("fuelType","==",e.fuelType),De("location","==",e.destinationLocation)),i=await He(t);if(i.empty){console.warn(`⚠️ No se encontró inventario destino para revertir: ${e.fuelType} en ${e.destinationLocation}`);return}const o=i.docs[0],c=o.data(),d=et(he,ls,o.id);let f=ru(c.currentStock,e.quantity);f<0&&(console.warn("⚠️ Advertencia: La reversión en destino resulta en stock negativo, ajustando a 0"),f=0),f=Rt(f,2),n.update(d,{currentStock:f,lastMovement:{movementId:null,type:"reversion_transferencia",quantity:e.quantity,date:Ue(),note:`Reversión de transferencia desde ${e.location}`},updatedAt:Ue()}),console.log("✅ Reversión en destino completada exitosamente")}catch(t){throw console.error("❌ Error al revertir transferencia en destino:",t),new Error(`Error al revertir destino: ${t.message}`)}},U_=async(n,e,t)=>{try{console.log(`🕒 Actualizando horómetro del vehículo ${e} a ${t} horas`);const i=Ae(Ee(he,"combustibles_vehicles"),De("vehicleId","==",e)),o=await He(i);if(o.empty){console.warn(`⚠️ Vehículo ${e} no encontrado para actualizar horómetro`);return}const c=o.docs[0],d=c.data(),f=et(he,"combustibles_vehicles",c.id),p=parseFloat(d.currentHours)||0,g=parseFloat(t);g<p&&console.warn(`⚠️ Nueva lectura horómetro (${g}) menor a la anterior (${p}). Actualizando de todas formas.`);const y=d.hourMeterHistory||[];y.push({previousHours:p,newHours:g,difference:g-p,updatedAt:new Date,updatedBy:"movement_service",source:"fuel_consumption"}),n.update(f,{currentHours:g,hourMeterHistory:y,lastHourMeterUpdate:Ue(),updatedAt:Ue()}),console.log(`✅ Horómetro actualizado: ${e} - ${p}h → ${g}h`)}catch(i){console.error("❌ Error al actualizar horómetro del vehículo:",i),console.warn("⚠️ Continuando con el movimiento sin actualización de horómetro")}},F_={createMovement:AA,getAllMovements:CA,getMovement:ty,updateMovement:wA,deleteMovement:xL,subscribeToMovements:ny,approveMovement:SA,getMovementsStats:IA,MOVEMENT_TYPES:de,MOVEMENT_STATUS:gt},ll="combustibles_inventory",TL=async(n,e)=>{try{const t=ol[n.fuelType];if(!t)return{success:!1,error:"Tipo de combustible no válido"};const i=Ae(Ee(he,ll),De("fuelType","==",n.fuelType),De("location","==",n.location.toLowerCase()));if(!(await He(i)).empty)return{success:!1,error:`Ya existe ${t.name} en ${n.location}`};const c={fuelType:n.fuelType,name:t.name,description:n.description||t.description,currentStock:Number(n.currentStock)||0,maxCapacity:Number(n.maxCapacity),minThreshold:Number(n.minThreshold)||n.maxCapacity*.15,unit:t.unit,location:n.location.toLowerCase(),pricePerUnit:Number(n.pricePerUnit)||0,supplier:n.supplier||"",status:n.status||"active",createdAt:new Date,createdBy:e,lastUpdated:new Date,updatedBy:e};return{success:!0,data:{id:(await gl(Ee(he,ll),c)).id,...c},message:`${t.name} agregado al inventario exitosamente`}}catch(t){return console.error("Error creating inventory item:",t),{success:!1,error:t.message}}},jL=async()=>{try{const n=Ae(Ee(he,ll),Cn("fuelType","asc")),e=await He(n),t=[];return e.forEach(i=>{const o=i.data();t.push({id:i.id,...o,stockLevel:jA(o.currentStock,o.maxCapacity),stockPercentage:Math.round(o.currentStock/o.maxCapacity*100),needsRestock:o.currentStock<=o.minThreshold})}),{success:!0,data:t}}catch(n){return console.error("Error fetching inventory items:",n),{success:!1,error:n.message}}},AL=async(n,e,t)=>{try{const i=et(he,ll,n);if(!(await Bi(i)).exists())return{success:!1,error:"Item no encontrado"};const c={...e,lastUpdated:new Date,updatedBy:t};return delete c.id,delete c.createdAt,delete c.createdBy,await As(i,c),{success:!0,message:"Item actualizado exitosamente",data:{id:n,...c}}}catch(i){return console.error("Error updating inventory item:",i),{success:!1,error:i.message}}},CL=async n=>{try{const e=et(he,ll,n);return(await Bi(e)).exists()?(await xf(e),{success:!0,message:"Item eliminado exitosamente"}):{success:!1,error:"Item no encontrado"}}catch(e){return console.error("Error deleting inventory item:",e),{success:!1,error:e.message}}},MA=n=>{const e=Ae(Ee(he,ll),Cn("fuelType","asc"));return zr(e,t=>{const i=[];t.forEach(o=>{const c=o.data();i.push({id:o.id,...c,stockLevel:jA(c.currentStock,c.maxCapacity),stockPercentage:Math.round(c.currentStock/c.maxCapacity*100),needsRestock:c.currentStock<=c.minThreshold})}),n(i)},t=>{console.error("Error in inventory subscription:",t),n(null,t)})},wL=async()=>{try{const n=await jL();if(!n.success)return n;const e=n.data,t={totalItems:e.length,activeItems:e.filter(i=>i.status==="active").length,lowStockItems:e.filter(i=>i.needsRestock).length,totalValue:e.reduce((i,o)=>i+o.currentStock*o.pricePerUnit,0),averageStockLevel:e.length>0?Math.round(e.reduce((i,o)=>i+o.stockPercentage,0)/e.length):0,byFuelType:{}};return e.forEach(i=>{t.byFuelType[i.fuelType]||(t.byFuelType[i.fuelType]={count:0,totalStock:0,totalCapacity:0,totalValue:0}),t.byFuelType[i.fuelType].count++,t.byFuelType[i.fuelType].totalStock+=i.currentStock,t.byFuelType[i.fuelType].totalCapacity+=i.maxCapacity,t.byFuelType[i.fuelType].totalValue+=i.currentStock*i.pricePerUnit}),{success:!0,data:t}}catch(n){return console.error("Error calculating inventory stats:",n),{success:!1,error:n.message}}},cs=[{id:"maquinaria_pesada",name:"Maquinaria Pesada",description:"Excavadoras, bulldozers, cargadores, grúas",icon:"🏗️",color:"#FF6B35",fuelTypes:["Diesel","ACPM"],fields:["enginePower","operatingWeight","bucketCapacity"]},{id:"transporte",name:"Transporte",description:"Camiones, camionetas, volquetas",icon:"🚛",color:"#2E86AB",fuelTypes:["Diesel","ACPM","Gasolina"],fields:["plateNumber","loadCapacity","enginePower"]},{id:"herramientas_motorizadas",name:"Herramientas Motorizadas",description:"Motosierras, guadañas, fumigadoras",icon:"🔧",color:"#A23B72",fuelTypes:["Gasolina","Mixto"],fields:["enginePower","weight"]},{id:"equipos_bombeo",name:"Equipos de Bombeo",description:"Motobombas, hidrolavadoras, plantas eléctricas",icon:"💧",color:"#F18F01",fuelTypes:["Diesel","Gasolina"],fields:["flow","pressure","enginePower"]},{id:"vehiculos_ligeros",name:"Vehículos Ligeros",description:"Motocicletas, cuatrimotos, vehículos de apoyo",icon:"🏍️",color:"#C73E1D",fuelTypes:["Gasolina"],fields:["plateNumber","enginePower"]},{id:"agricola",name:"Agrícola/Forestal",description:"Tractores, asperjadoras, equipos forestales",icon:"🚜",color:"#2F7D32",fuelTypes:["Diesel","ACPM"],fields:["enginePower","hasHourMeter","implementType"]},{id:"otros",name:"Otros",description:"Equipos especializados y otros vehículos",icon:"⚙️",color:"#616161",fuelTypes:["Diesel","Gasolina","ACPM","Mixto"],fields:["enginePower"]}],Ve={ACTIVO:"activo",MANTENIMIENTO:"mantenimiento",INACTIVO:"inactivo",REPARACION:"reparacion",FUERA_DE_SERVICIO:"fuera_de_servicio"},kA={DIESEL:"Diesel",GASOLINA:"Gasolina",ACPM:"ACPM",MIXTO:"Mixto"},q_=[{key:"plateNumber",label:"Número de Placa",type:"text",icon:"🏷️"},{key:"enginePower",label:"Potencia del Motor (HP)",type:"number",icon:"⚡"},{key:"fuelCapacity",label:"Capacidad de Combustible (Litros)",type:"number",icon:"⛽"},{key:"operatingWeight",label:"Peso Operativo (Toneladas)",type:"number",icon:"⚖️"},{key:"loadCapacity",label:"Capacidad de Carga (Toneladas)",type:"number",icon:"📦"},{key:"bucketCapacity",label:"Capacidad de Balde (m³)",type:"number",icon:"🪣"},{key:"hasHourMeter",label:"Tiene Horómetro",type:"boolean",icon:"⏰"},{key:"currentHours",label:"Horas Actuales",type:"number",icon:"🕐",dependsOn:"hasHourMeter"},{key:"implementType",label:"Tipo de Implemento",type:"text",icon:"🔧"},{key:"flow",label:"Caudal (L/min)",type:"number",icon:"💧"},{key:"pressure",label:"Presión (PSI)",type:"number",icon:"💨"},{key:"weight",label:"Peso (Kg)",type:"number",icon:"⚖️"}],B_=(n,e=[])=>{const t=e.find(i=>i.id===n);return t||cs.find(i=>i.id===n)||null},OA=(n=[])=>{const e=cs.map(i=>i.id),t=n.filter(i=>!e.includes(i.id));return[...cs,...t]},PA=n=>{const e=[];return(!n.id||typeof n.id!="string")&&e.push("ID de categoría requerido y debe ser texto"),(!n.name||typeof n.name!="string")&&e.push("Nombre de categoría requerido y debe ser texto"),n.name&&n.name.length<2&&e.push("Nombre debe tener al menos 2 caracteres"),n.fuelTypes&&!Array.isArray(n.fuelTypes)&&e.push("Tipos de combustible debe ser un array"),n.fields&&!Array.isArray(n.fields)&&e.push("Campos debe ser un array"),{isValid:e.length===0,errors:e}},LA=(n,e=[])=>{const t=n.toLowerCase().replace(/[^a-z0-9]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"");let i=t,o=1;for(;e.some(c=>c.id===i);)i=`${t}_${o}`,o++;return i},yl="combustibles_vehicles",vt={DIESEL:"Diesel",GASOLINA:"Gasolina",ACPM:"ACPM",MIXTO:"Mixto"},VA=async n=>{try{if(SL(n),await sy(n.vehicleId))throw new Error(`El código de vehículo '${n.vehicleId}' ya existe`);const t={...n,createdAt:Ue(),updatedAt:Ue(),status:n.status||Ve.ACTIVO,totalFuelConsumed:0,totalHoursWorked:0,totalMovements:0,lastMovementDate:null,estimatedConsumptionPerHour:BA(n)},i=await gl(Ee(he,yl),t);return console.log("✅ Vehículo creado exitosamente:",i.id),i.id}catch(e){throw console.error("❌ Error al crear vehículo:",e),new Error(`Error al crear vehículo: ${e.message}`)}},UA=async(n={})=>{try{let e=Ee(he,yl);n.type&&(e=Ae(e,De("type","==",n.type))),n.status&&(e=Ae(e,De("status","==",n.status))),n.fuelType&&(e=Ae(e,De("fuelType","==",n.fuelType))),n.location&&(e=Ae(e,De("currentLocation","==",n.location))),e=Ae(e,Cn("vehicleId","asc"));const t=await He(e),i=[];return t.forEach(o=>{i.push({id:o.id,...o.data(),createdAt:o.data().createdAt?.toDate?.()||o.data().createdAt,updatedAt:o.data().updatedAt?.toDate?.()||o.data().updatedAt,lastMovementDate:o.data().lastMovementDate?.toDate?.()||o.data().lastMovementDate,lastMaintenanceDate:o.data().lastMaintenanceDate?.toDate?.()||o.data().lastMaintenanceDate})}),i}catch(e){throw console.error("❌ Error al obtener vehículos:",e),new Error(`Error al obtener vehículos: ${e.message}`)}},sy=async n=>{try{const e=Ae(Ee(he,yl),De("vehicleId","==",n)),t=await He(e);if(t.empty)return null;const i=t.docs[0];return{id:i.id,...i.data(),createdAt:i.data().createdAt?.toDate?.()||i.data().createdAt,updatedAt:i.data().updatedAt?.toDate?.()||i.data().updatedAt,lastMovementDate:i.data().lastMovementDate?.toDate?.()||i.data().lastMovementDate,lastMaintenanceDate:i.data().lastMaintenanceDate?.toDate?.()||i.data().lastMaintenanceDate}}catch(e){throw console.error("❌ Error al buscar vehículo por código:",e),new Error(`Error al buscar vehículo: ${e.message}`)}},FA=async(n,e)=>{try{if(!n)throw new Error("ID de vehículo requerido");if(e.vehicleId){const o=await sy(e.vehicleId);if(o&&o.id!==n)throw new Error(`El código de vehículo '${e.vehicleId}' ya existe`)}const t={...e,updatedAt:Ue(),...e.enginePower||e.type?{estimatedConsumptionPerHour:BA(e)}:{}},i=et(he,yl,n);await As(i,t),console.log("✅ Vehículo actualizado exitosamente")}catch(t){throw console.error("❌ Error al actualizar vehículo:",t),new Error(`Error al actualizar vehículo: ${t.message}`)}},ay=(n,e={})=>{try{let t=Ee(he,yl);const i=[];e.category&&i.push(De("category","==",e.category)),e.status&&i.push(De("status","==",e.status)),e.fuelType&&i.push(De("fuelType","==",e.fuelType)),e.currentLocation&&i.push(De("currentLocation","==",e.currentLocation)),i.forEach(c=>{t=Ae(t,c)}),t=Ae(t,Cn("updatedAt","desc"));let o=null;return zr(t,c=>{const d=Date.now();if(o&&d-o<500)return;o=d;const f=[],p={added:[],modified:[],removed:[]};c.docChanges().forEach(g=>{const y={id:g.doc.id,...g.doc.data(),createdAt:g.doc.data().createdAt?.toDate?.()||g.doc.data().createdAt,updatedAt:g.doc.data().updatedAt?.toDate?.()||g.doc.data().updatedAt,lastMovementDate:g.doc.data().lastMovementDate?.toDate?.()||g.doc.data().lastMovementDate,lastMaintenanceDate:g.doc.data().lastMaintenanceDate?.toDate?.()||g.doc.data().lastMaintenanceDate,lastHourMeterDate:g.doc.data().lastHourMeterDate?.toDate?.()||g.doc.data().lastHourMeterDate};g.type==="added"?p.added.push(y):g.type==="modified"?p.modified.push(y):g.type==="removed"&&p.removed.push({id:g.doc.id})}),c.forEach(g=>{f.push({id:g.id,...g.data(),createdAt:g.data().createdAt?.toDate?.()||g.data().createdAt,updatedAt:g.data().updatedAt?.toDate?.()||g.data().updatedAt,lastMovementDate:g.data().lastMovementDate?.toDate?.()||g.data().lastMovementDate,lastMaintenanceDate:g.data().lastMaintenanceDate?.toDate?.()||g.data().lastMaintenanceDate,lastHourMeterDate:g.data().lastHourMeterDate?.toDate?.()||g.data().lastHourMeterDate})}),n(f,null,p)},c=>{console.error("❌ Error en suscripción de vehículos:",c),n([],c)})}catch(t){throw console.error("❌ Error al configurar suscripción:",t),new Error(`Error en suscripción: ${t.message}`)}},qA=async(n={})=>{try{const e=await UA(n),t={totalVehicles:e.length,byType:{},byStatus:{},byFuelType:{},totalFuelConsumed:0,totalHoursWorked:0,averageConsumption:0,mostActiveVehicle:null,leastActiveVehicle:null};let i=0,o=1/0;return e.forEach(c=>{t.byType[c.type]=(t.byType[c.type]||0)+1,t.byStatus[c.status]=(t.byStatus[c.status]||0)+1,t.byFuelType[c.fuelType]=(t.byFuelType[c.fuelType]||0)+1,t.totalFuelConsumed+=c.totalFuelConsumed||0,t.totalHoursWorked+=c.totalHoursWorked||0;const d=c.totalMovements||0;d>i&&(i=d,t.mostActiveVehicle=c),d<o&&d>0&&(o=d,t.leastActiveVehicle=c)}),t.totalHoursWorked>0&&(t.averageConsumption=t.totalFuelConsumed/t.totalHoursWorked),t}catch(e){throw console.error("❌ Error al calcular estadísticas:",e),new Error(`Error al calcular estadísticas: ${e.message}`)}},SL=n=>{const e=["vehicleId","name","type","fuelType"];for(const t of e)if(!n[t])throw new Error(`Campo requerido: ${t}`);if(!n.type||n.type.trim().length===0)throw new Error("Tipo de vehículo requerido");if(!Object.values(vt).includes(n.fuelType))throw new Error("Tipo de combustible inválido");if(n.status&&!Object.values(Ve).includes(n.status))throw new Error("Estado de vehículo inválido");if(n.enginePower&&n.enginePower<=0)throw new Error("La potencia del motor debe ser mayor a cero");if(n.fuelCapacity&&n.fuelCapacity<=0)throw new Error("La capacidad de combustible debe ser mayor a cero")},BA=n=>{const{type:e,enginePower:t,fuelType:i}=n,o={excavadora:.04,bulldozer:.05,cargador:.035,camion:.03,camioneta:.03,grua:.045,motosierra:.02,tractor:.025,volqueta:.035,motobomba:.035,fumigadora:.025,guadana:.02,motocicleta:.015,planta_electrica:.08,otros:.03},c={[vt.DIESEL]:1,[vt.GASOLINA]:1.2,[vt.ACPM]:.95,[vt.MIXTO]:1.1},d=o[e]||.03,f=c[i]||1;return d*(t||100)*f},IL=async n=>{try{const e=Ae(Ee(he,yl),De("category","==",n));return(await He(e)).size}catch(e){return console.error("❌ Error al contar vehículos por categoría:",e),0}},zA=Object.freeze(Object.defineProperty({__proto__:null,FUEL_COMPATIBILITY:vt,FUEL_TYPES:kA,VEHICLE_STATUS:Ve,countVehiclesByCategory:IL,createVehicle:VA,getAllVehicles:UA,getVehicleByCode:sy,getVehiclesStats:qA,subscribeToVehicles:ay,updateVehicle:FA},Symbol.toStringTag,{value:"Module"})),Ys="combustibles_suppliers",RL=async(n,e)=>{try{const t=Ae(Ee(he,Ys),De("name","==",n.name.trim()));if(!(await He(t)).empty)return{success:!1,error:`Ya existe un proveedor con el nombre "${n.name}"`};if(n.taxId){const d=Ae(Ee(he,Ys),De("taxId","==",n.taxId.trim()));if(!(await He(d)).empty)return{success:!1,error:`Ya existe un proveedor con el NIT/Documento "${n.taxId}"`}}const o={name:n.name.trim(),taxId:n.taxId?.trim()||"",type:n.type||"proveedor",category:n.category||"combustibles",contactPerson:n.contactPerson?.trim()||"",phone:n.phone?.trim()||"",email:n.email?.trim()||"",address:n.address?.trim()||"",city:n.city?.trim()||"",state:n.state?.trim()||"Colombia",fuelTypes:n.fuelTypes||[],paymentTerms:n.paymentTerms||"contado",creditLimit:Number(n.creditLimit)||0,priceList:n.priceList||{},rating:Number(n.rating)||5,evaluationNotes:n.evaluationNotes||"",status:n.status||"active",isPreferred:n.isPreferred||!1,totalOrders:0,totalPurchased:0,lastOrderDate:null,averageDeliveryTime:0,createdAt:new Date,createdBy:e,lastUpdated:new Date,updatedBy:e};return{success:!0,data:{id:(await gl(Ee(he,Ys),o)).id,...o},message:`Proveedor "${o.name}" creado exitosamente`}}catch(t){return console.error("Error creating supplier:",t),{success:!1,error:t.message}}},DL=async()=>{try{const n=Ae(Ee(he,Ys),Cn("name","asc"));return{success:!0,data:(await He(n)).docs.map(i=>({id:i.id,...i.data()}))}}catch(n){return console.error("Error getting suppliers:",n),{success:!1,error:n.message}}},HA=n=>{const e=Ae(Ee(he,Ys),Cn("name","asc"));return zr(e,t=>{const i=t.docs.map(o=>({id:o.id,...o.data()}));n(i)})},ML=async(n,e,t)=>{try{const i=await Bi(et(he,Ys,n));if(!i.exists())return{success:!1,error:"Proveedor no encontrado"};if(e.name&&e.name.trim()!==i.data().name){const c=Ae(Ee(he,Ys),De("name","==",e.name.trim()));if(!(await He(c)).empty)return{success:!1,error:`Ya existe un proveedor con el nombre "${e.name}"`}}if(e.taxId&&e.taxId.trim()!==i.data().taxId){const c=Ae(Ee(he,Ys),De("taxId","==",e.taxId.trim()));if(!(await He(c)).empty)return{success:!1,error:`Ya existe un proveedor con el NIT/Documento "${e.taxId}"`}}const o={...e,lastUpdated:new Date,updatedBy:t};return o.name&&(o.name=o.name.trim()),o.taxId&&(o.taxId=o.taxId.trim()),o.contactPerson&&(o.contactPerson=o.contactPerson.trim()),o.phone&&(o.phone=o.phone.trim()),o.email&&(o.email=o.email.trim()),await As(et(he,Ys,n),o),{success:!0,message:"Proveedor actualizado exitosamente"}}catch(i){return console.error("Error updating supplier:",i),{success:!1,error:i.message}}},kL=async(n,e)=>{try{return await As(et(he,Ys,n),{status:"inactive",lastUpdated:new Date,updatedBy:e}),{success:!0,message:"Proveedor desactivado exitosamente"}}catch(t){return console.error("Error deleting supplier:",t),{success:!1,error:t.message}}},OL=async()=>{try{const n=await DL();if(!n.success)return n;const e=n.data,t={total:e.length,active:e.filter(i=>i.status==="active").length,inactive:e.filter(i=>i.status==="inactive").length,suspended:e.filter(i=>i.status==="suspended").length,preferred:e.filter(i=>i.isPreferred).length,averageRating:e.length>0?e.reduce((i,o)=>i+(o.rating||0),0)/e.length:0,byCategory:{},byType:{}};return e.forEach(i=>{const o=i.category||"sin_categoria";t.byCategory[o]=(t.byCategory[o]||0)+1}),e.forEach(i=>{const o=i.type||"sin_tipo";t.byType[o]=(t.byType[o]||0)+1}),{success:!0,data:t}}catch(n){return console.error("Error getting suppliers stats:",n),{success:!1,error:n.message}}},GA=z.createContext(),Qn=()=>{const n=z.useContext(GA);if(n===void 0)throw new Error("useCombustibles must be used within a CombustiblesProvider");return n},PL=({children:n})=>{const[e,t]=z.useState(null),[i,o]=z.useState(null),[c,d]=z.useState(!0),[f,p]=z.useState(null),[g,y]=z.useState([]),[b,E]=z.useState([]),[j,N]=z.useState([]),[w,T]=z.useState([]);z.useEffect(()=>{const P=ER($c,async C=>{try{if(d(!0),C){t(C);let M=await jf(C.uid);M.success||(M=await TA(C,{provider:"existing_account",appContext:"combustibles"})),M.success?o(M.userData):p("Error cargando perfil de usuario")}else t(null),o(null),y([]),E([]),N([]),T([])}catch(M){console.error("Error en autenticación:",M),p("Error de autenticación")}finally{d(!1)}});return()=>P()},[]),z.useEffect(()=>{if(e){const P=MA(y),C=ay(N,le=>p(le.message)),M=HA(T),D=F_.subscribeToMovements(E,le=>p(le.message));return()=>{P(),C(),M(),D()}}},[e]);const V={user:e,userProfile:i,loading:c,error:f,hasPermission:P=>i?.combustiblesPermissions?.[P]||!1,isAdmin:()=>i?.role==="admin",isCounterOrAbove:()=>i?.role==="admin"||i?.role==="contador",inventory:g,movements:b,vehicles:j,suppliers:w,setInventory:y,setMovements:E,setVehicles:N,setSuppliers:T,deleteMovement:async P=>{try{return await F_.deleteMovement(P),{success:!0}}catch(C){return console.error("Error al eliminar el movimiento en el contexto:",C),p(C.message),{success:!1,error:C.message}}},refreshInventory:async()=>{console.log("Refrescando inventario...")},refreshMovements:async()=>{console.log("Refrescando movimientos...")},refreshVehicles:async()=>{console.log("Refrescando vehículos...")},refreshSuppliers:async()=>{console.log("Refrescando proveedores...")}};return a.jsx(GA.Provider,{value:V,children:n})},LL=({children:n,currentView:e,onViewChange:t})=>{const{userProfile:i,isAdmin:o,isCounterOrAbove:c}=Qn(),[d,f]=z.useState(!1),p=[{id:"dashboard",name:"Dashboard",icon:"📊",description:"Vista general",requiredPermission:null},{id:"inventory",name:"Inventario",icon:"🛢️",description:"Gestión de stock",requiredPermission:"canManageInventory"},{id:"movements",name:"Movimientos",icon:"📈",description:"Entradas y salidas",requiredPermission:"canCreateMovements"},{id:"vehicles",name:"Vehículos",icon:"🚜",description:"Maquinaria forestal",requiredPermission:null},{id:"maintenance",name:"Mantenimiento",icon:"🔧",description:"Cambios de aceite y baterías",requiredPermission:null},{id:"products",name:"Productos",icon:"🛢️",description:"Tipos de combustibles",requiredPermission:null},{id:"suppliers",name:"Proveedores",icon:"🏪",description:"Gestión de proveedores",requiredPermission:"canManageSuppliers"},{id:"reports",name:"Reportes",icon:"📋",description:"Análisis y reportes",requiredPermission:"canViewReports"},{id:"admin",name:"Administración",icon:"⚙️",description:"Gestión de usuarios",requiredPermission:"admin"}],g=j=>{t(j),f(!1)},y=j=>j?j==="admin"?o():i?.combustiblesPermissions?.[j]||!1:!0,b=p.filter(j=>y(j.requiredPermission)),E=async()=>{try{await _R($c)}catch(j){console.error("Error al cerrar sesión:",j)}};return a.jsxs("div",{className:"dashboard-layout",children:[a.jsx("header",{className:"dashboard-header",children:a.jsxs("div",{className:"header-content",children:[a.jsx("button",{className:"sidebar-toggle",onClick:()=>f(!d),children:"☰"}),a.jsxs("div",{className:"header-title",children:[a.jsx("h1",{children:"⛽ Gestión de Combustibles"}),a.jsx("span",{className:"subtitle",children:"Forestech Colombia"})]}),a.jsxs("div",{className:"header-user",children:[a.jsxs("div",{className:"user-info",children:[a.jsx("span",{className:"user-name",children:i?.displayName||i?.email}),a.jsx("span",{className:"user-role",children:i?.role})]}),a.jsx("div",{className:"user-avatar",children:i?.photoURL?a.jsx("img",{src:i.photoURL,alt:"Avatar"}):a.jsx("div",{className:"avatar-placeholder",children:(i?.displayName||i?.email||"U").charAt(0).toUpperCase()})}),a.jsx("button",{className:"logout-button",onClick:E,title:"Cerrar sesión",children:"🚪"})]})]})}),a.jsxs("div",{className:"dashboard-body",children:[a.jsxs("aside",{className:`dashboard-sidebar ${d?"open":""}`,children:[a.jsx("nav",{className:"sidebar-nav",children:b.map(j=>a.jsxs("button",{className:`nav-item ${e===j.id?"active":""}`,onClick:()=>g(j.id),children:[a.jsx("span",{className:"nav-icon",children:j.icon}),a.jsxs("div",{className:"nav-content",children:[a.jsx("span",{className:"nav-name",children:j.name}),a.jsx("span",{className:"nav-description",children:j.description})]})]},j.id))}),a.jsx("div",{className:"sidebar-footer",children:a.jsxs("div",{className:"user-permissions",children:[a.jsx("h4",{children:"Permisos Activos:"}),a.jsxs("div",{className:"permission-list",children:[o()&&a.jsx("span",{className:"permission admin",children:"👑 Administrador"}),c()&&a.jsx("span",{className:"permission counter",children:"📊 Gestión Operativa"}),y("canManageInventory")&&a.jsx("span",{className:"permission",children:"🛢️ Inventario"}),y("canManageVehicles")&&a.jsx("span",{className:"permission",children:"🚜 Vehículos"})]})]})})]}),a.jsx("main",{className:"dashboard-main",children:a.jsx("div",{className:"main-content",children:n})})]}),d&&a.jsx("div",{className:"sidebar-overlay",onClick:()=>f(!1)})]})},VL=(n=[])=>{if(!Array.isArray(n)||n.length===0){console.warn("📋 Inventario vacío o no válido");return}console.group("📋 Estado Actual del Inventario"),console.log(`Total de items: ${n.length}`);const e=n.reduce((o,c)=>o+(parseFloat(c.currentStock)||0),0);console.log(`Stock total: ${e.toFixed(2)} galones`);const t=n.filter(o=>typeof o.currentStock>"u"||isNaN(parseFloat(o.currentStock))||o.currentStock!==o.quantity&&typeof o.quantity<"u");t.length>0&&(console.warn(`⚠️ ${t.length} items con posibles problemas de datos:`),t.forEach(o=>{console.warn(`- ${o.fuelType||o.name||"Item sin nombre"}: currentStock=${o.currentStock}, quantity=${o.quantity}`)}));const i={};n.forEach(o=>{const c=o.fuelType||"Desconocido";i[c]||(i[c]=0),i[c]+=parseFloat(o.currentStock)||0}),console.log("Stock por tipo de combustible:"),Object.entries(i).forEach(([o,c])=>{console.log(`- ${o}: ${c.toFixed(2)} gal`)}),console.groupEnd()},UL=(n=[])=>{if(!Array.isArray(n)||n.length===0)return[];const e={},t=[];return n.forEach(i=>{const o=`${i.fuelType||""}:${i.location||""}`;e[o]?(e[o].push(i),e[o].length===2?t.push(...e[o]):e[o].length>2&&t.push(i)):e[o]=[i]}),t},z_=()=>{const{inventory:n,movements:e,vehicles:t,loading:i,error:o}=Qn();z.useEffect(()=>{if(!i&&n.length>0){console.log("🔍 Ejecutando diagnóstico del inventario..."),VL(n);const g=UL(n);g.length>0&&(console.warn(`⚠️ Se detectaron ${g.length} posibles items duplicados:`),console.table(g.map(y=>({id:y.id,tipo:y.fuelType,ubicacion:y.location,stock:y.currentStock}))))}},[i,n]);const c=g=>g?g.toDate&&typeof g.toDate=="function"?g.toDate():g.seconds?new Date(g.seconds*1e3):g instanceof Date?g:new Date(g):new Date,d=z.useMemo(()=>{const g=t.filter(N=>N.status==="activo").length,y=e.filter(N=>N.status==="pendiente").length;console.log("Inventario en DashboardMain:",n.map(N=>({id:N.id,fuelType:N.fuelType,currentStock:N.currentStock,pricePerUnit:N.pricePerUnit||N.unitPrice})));const b=n.filter(N=>N.status==="active").reduce((N,w)=>{const T=parseFloat(w.currentStock)||0;return console.log(`Sumando stock de ${w.fuelType}: ${T} gal`),N+T},0),E=n.filter(N=>N.isActive!==!1).reduce((N,w)=>{const T=parseFloat(w.currentStock)||0,S=parseFloat(w.pricePerUnit||w.unitPrice)||0;return N+T*S},0),j=n.filter(N=>{const w=parseFloat(N.currentStock)||0,T=parseFloat(N.minStock)||parseFloat(N.minThreshold)||20;return N.isActive!==!1&&w<=T}).length;return{totalFuel:b,totalValue:E,lowStockAlerts:j,activeInventoryItems:n.filter(N=>N.isActive!==!1).length,activeVehicles:g,pendingMovements:y,totalMaintenance:0,overdueMaintenance:0}},[n,t,e]),f=z.useMemo(()=>e.sort((g,y)=>c(y.createdAt).getTime()-c(g.createdAt).getTime()).slice(0,5),[e]),p=g=>{const y=g.quantity||0,b=g.fuelType||"N/A";switch(g.type){case"entrada":return`Entrada de ${y} gal de ${b}.`;case"salida":return`Salida de ${y} gal para vehículo ${g.vehicleId||"N/A"}.`;case"transferencia":return`Transferencia de ${y} gal.`;case"ajuste":return`Ajuste de inventario: ${y} gal de ${b}.`;default:return"Movimiento registrado."}};return i?a.jsxs("div",{className:"dashboard-main",children:[a.jsx("h1",{className:"dashboard-title",children:"Dashboard Operativo"}),a.jsx("p",{className:"dashboard-subtitle",children:"Cargando datos en tiempo real..."}),a.jsx("div",{className:"loading-spinner-container",children:a.jsx("div",{className:"loading-spinner"})})]}):o?a.jsxs("div",{className:"dashboard-main",children:[a.jsx("h1",{className:"dashboard-title",children:"Dashboard Operativo"}),a.jsxs("div",{className:"error-message",children:[a.jsxs("p",{children:["⚠️ ",o]}),a.jsx("button",{onClick:()=>window.location.reload(),children:"Reintentar"})]})]}):a.jsxs("div",{className:"dashboard-main",children:[a.jsx("h1",{className:"dashboard-title",children:"Dashboard Operativo"}),a.jsx("p",{className:"dashboard-subtitle",children:"Resumen general del estado de combustibles y maquinaria."}),a.jsxs("div",{className:"stats-grid",children:[a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon fuel-icon",children:"🛢️"}),a.jsxs("div",{className:"stat-info",children:[a.jsx("p",{children:"Combustible Total"}),a.jsxs("h2",{children:[be(d.totalFuel)," gal"]})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon value-icon",children:"💰"}),a.jsxs("div",{className:"stat-info",children:[a.jsx("p",{children:"Valor Inventario"}),a.jsx("h2",{children:Nt(d.totalValue)})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon vehicle-icon",children:"🚜"}),a.jsxs("div",{className:"stat-info",children:[a.jsx("p",{children:"Vehículos Activos"}),a.jsx("h2",{children:be(d.activeVehicles)})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon movement-icon",children:"🔄"}),a.jsxs("div",{className:"stat-info",children:[a.jsx("p",{children:"Movimientos Pendientes"}),a.jsx("h2",{children:be(d.pendingMovements)})]})]}),a.jsxs("div",{className:`stat-card ${d.lowStockAlerts>0?"alert":""}`,children:[a.jsx("div",{className:"stat-icon alert-icon",children:"⚠️"}),a.jsxs("div",{className:"stat-info",children:[a.jsx("p",{children:"Alertas de Stock"}),a.jsx("h2",{children:be(d.lowStockAlerts)})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon maintenance-icon",children:"🔧"}),a.jsxs("div",{className:"stat-info",children:[a.jsx("p",{children:"Mantenimientos"}),a.jsx("h2",{children:be(d.totalMaintenance)})]})]}),a.jsxs("div",{className:`stat-card ${d.overdueMaintenance>0?"alert":""}`,children:[a.jsx("div",{className:"stat-icon maintenance-alert-icon",children:"⏰"}),a.jsxs("div",{className:"stat-info",children:[a.jsx("p",{children:"Mantenimientos Vencidos"}),a.jsx("h2",{children:be(d.overdueMaintenance)})]})]})]}),a.jsxs("div",{className:"dashboard-content",children:[a.jsxs("div",{className:"dashboard-widget",children:[a.jsx("h3",{children:"Actividad Reciente"}),f.length>0?a.jsx("ul",{children:f.map(g=>a.jsxs("li",{children:[a.jsx("span",{className:`movement-type-badge ${g.type}`,children:g.type}),p(g),a.jsx("span",{className:"movement-date",children:c(g.createdAt).toLocaleDateString()})]},g.id))}):a.jsx("p",{children:"No hay movimientos recientes."})]}),a.jsxs("div",{className:"dashboard-widget",children:[a.jsx("h3",{children:"📦 Stock por Producto"}),n.length>0?a.jsx("div",{className:"products-summary",children:n.map(g=>{const y=parseFloat(g.currentStock)||0,b=parseFloat(g.minStock||g.minThreshold)||20;return a.jsxs("div",{className:"product-summary-item",children:[a.jsx("div",{className:"product-icon",children:"⛽"}),a.jsxs("div",{className:"product-info",children:[a.jsx("span",{className:"product-name",children:g.fuelType||g.name}),a.jsxs("div",{className:"product-stats",children:[a.jsxs("span",{className:"stock-value",children:[be(y)," gal"]}),a.jsx("span",{className:`stock-status ${y<=b?"low":"normal"}`,children:y<=b?"🟡 Stock bajo":"🟢 Normal"})]})]})]},g.id)})}):a.jsx("div",{className:"no-products",children:a.jsx("p",{children:"No hay inventario registrado."})})]})]})]})},FL=({items:n,onEdit:e,onDelete:t,canManage:i})=>{const[o,c]=z.useState("name"),[d,f]=z.useState("asc"),p=N=>new Intl.NumberFormat("es-CO").format(N),g=N=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(N),y=N=>{if(!N)return"N/A";const w=new Date;let T;if(N&&typeof N=="object")if(N.seconds)T=new Date(N.seconds*1e3);else if(N.toDate&&typeof N.toDate=="function")T=N.toDate();else if(N instanceof Date)T=N;else return"N/A";else if(typeof N=="string"||typeof N=="number")T=new Date(N);else return"N/A";if(isNaN(T.getTime()))return"N/A";const S=w-T,q=Math.floor(S/(1e3*60*60)),I=Math.floor(q/24);return I>0?`${I}d`:q>0?`${q}h`:"ahora"},b=N=>{o===N?f(d==="asc"?"desc":"asc"):(c(N),f("asc"))},E=[...n].sort((N,w)=>{let T=N[o],S=w[o];if(o==="lastUpdated"){const q=I=>{if(!I)return new Date(0);if(I&&typeof I=="object"){if(I.seconds)return new Date(I.seconds*1e3);if(I.toDate&&typeof I.toDate=="function")return I.toDate();if(I instanceof Date)return I}return new Date(I)};T=q(T),S=q(S)}return T<S?d==="asc"?-1:1:T>S?d==="asc"?1:-1:0}),j=N=>o!==N?"↕️":d==="asc"?"↑":"↓";return a.jsxs("div",{className:"inventory-table-container",children:[a.jsx("div",{className:"table-wrapper",children:a.jsxs("table",{className:"inventory-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsxs("th",{onClick:()=>b("name"),className:"sortable",children:["Combustible ",j("name")]}),a.jsxs("th",{onClick:()=>b("location"),className:"sortable",children:["Ubicación ",j("location")]}),a.jsxs("th",{onClick:()=>b("currentStock"),className:"sortable",children:["Stock Actual ",j("currentStock")]}),a.jsxs("th",{onClick:()=>b("stockPercentage"),className:"sortable",children:["Nivel ",j("stockPercentage")]}),a.jsxs("th",{onClick:()=>b("pricePerUnit"),className:"sortable",children:["Precio ",j("pricePerUnit")]}),a.jsx("th",{children:"Valor Total"}),a.jsxs("th",{onClick:()=>b("status"),className:"sortable",children:["Estado ",j("status")]}),a.jsxs("th",{onClick:()=>b("lastUpdated"),className:"sortable",children:["Actualizado ",j("lastUpdated")]}),i&&a.jsx("th",{children:"Acciones"})]})}),a.jsx("tbody",{children:E.map(N=>{const w=ol[N.fuelType],T=$o[N.stockLevel],S=parseFloat(N.currentStock)||0,q=parseFloat(N.pricePerUnit)||0,I=parseFloat(N.maxCapacity)||0,O=parseFloat(N.stockPercentage)||0,U=S*q;return a.jsxs("tr",{className:N.needsRestock?"needs-restock":"",children:[a.jsx("td",{className:"fuel-cell",children:a.jsxs("div",{className:"fuel-info",children:[a.jsx("span",{className:"fuel-icon",style:{color:w?.color},children:w?.icon}),a.jsxs("div",{children:[a.jsx("div",{className:"fuel-name",children:w?.name}),a.jsx("div",{className:"fuel-type",children:N.fuelType})]})]})}),a.jsx("td",{children:N.location}),a.jsxs("td",{className:"stock-cell",children:[a.jsxs("div",{className:"stock-info",children:[a.jsx("span",{className:"stock-amount",children:p(S)}),a.jsxs("span",{className:"stock-unit",children:["/ ",p(I)," ",N.unit||"gal"]})]}),N.needsRestock&&a.jsx("div",{className:"restock-indicator",children:"⚠️ Bajo mínimo"})]}),a.jsx("td",{className:"level-cell",children:a.jsxs("div",{className:"level-info",children:[a.jsxs("div",{className:"level-badge",style:{backgroundColor:T?.color,color:"white"},children:[O,"%"]}),a.jsx("div",{className:"level-bar",children:a.jsx("div",{className:"level-fill",style:{width:`${O}%`,backgroundColor:T?.color}})})]})}),a.jsx("td",{className:"price-cell",children:a.jsxs("div",{className:"price-info",children:[a.jsx("span",{className:"price-amount",children:g(q)}),a.jsxs("span",{className:"price-unit",children:["/ ",N.unit||"gal"]})]})}),a.jsx("td",{className:"value-cell",children:a.jsx("span",{className:"total-value",children:g(U)})}),a.jsx("td",{className:"status-cell",children:a.jsxs("span",{className:`status-badge ${N.status}`,children:[a.jsx("span",{className:"status-dot"}),N.status==="active"?"Activo":N.status==="inactive"?"Inactivo":N.status==="maintenance"?"Mantenimiento":N.status]})}),a.jsx("td",{className:"updated-cell",children:a.jsx("span",{className:"time-ago",children:y(N.lastUpdated)})}),i&&a.jsx("td",{className:"actions-cell",children:a.jsxs("div",{className:"action-buttons",children:[a.jsx("button",{className:"btn btn-sm btn-secondary",onClick:()=>e(N),title:"Editar",children:"✏️"}),a.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>t(N),title:"Eliminar",children:"🗑️"})]})})]},N.id)})})]})}),a.jsxs("div",{className:"table-footer",children:[a.jsxs("div",{className:"table-info",children:[E.length," items ordenados por ",o,"(",d==="asc"?"ascendente":"descendente",")"]}),a.jsxs("div",{className:"table-legend",children:[a.jsxs("span",{className:"legend-item",children:[a.jsx("span",{className:"legend-dot critical"}),"Crítico"]}),a.jsxs("span",{className:"legend-item",children:[a.jsx("span",{className:"legend-dot low"}),"Bajo"]}),a.jsxs("span",{className:"legend-item",children:[a.jsx("span",{className:"legend-dot normal"}),"Normal"]}),a.jsxs("span",{className:"legend-item",children:[a.jsx("span",{className:"legend-dot high"}),"Alto"]})]})]})]})},qL=({items:n,onEdit:e,onDelete:t,canManage:i})=>{const o=f=>new Intl.NumberFormat("es-CO").format(f),c=f=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(f),d=f=>{if(!f)return"sin fecha";try{const p=new Date;let g;f.seconds?g=new Date(f.seconds*1e3):f.toDate&&typeof f.toDate=="function"?g=f.toDate():g=new Date(f);const y=p-g,b=Math.floor(y/(1e3*60*60)),E=Math.floor(b/24);return E>0?`hace ${E} día${E>1?"s":""}`:b>0?`hace ${b} hora${b>1?"s":""}`:"hace unos minutos"}catch(p){return console.warn("Error al calcular tiempo transcurrido:",p),"fecha inválida"}};return a.jsx("div",{className:"inventory-cards-grid",children:n.map(f=>{const p=ol[f.fuelType],g=$o[f.stockLevel],y=parseFloat(f.currentStock)||0,b=parseFloat(f.pricePerUnit)||parseFloat(f.unitPrice)||0,E=parseFloat(f.maxCapacity)||parseFloat(f.capacity)||0,j=parseFloat(f.stockPercentage)||0,N=y*b;return a.jsxs("div",{className:"inventory-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsxs("div",{className:"fuel-info",children:[a.jsx("span",{className:"fuel-icon",style:{color:p?.color},children:p?.icon}),a.jsxs("div",{className:"fuel-details",children:[a.jsx("h3",{children:p?.name}),a.jsx("p",{className:"location",children:f.location})]})]}),a.jsx("div",{className:"stock-status",children:a.jsxs("span",{className:"status-badge",style:{backgroundColor:g?.color,color:"white"},children:[g?.icon," ",g?.label]})})]}),a.jsxs("div",{className:"stock-progress",children:[a.jsxs("div",{className:"progress-header",children:[a.jsxs("span",{className:"stock-text",children:[o(y)," / ",o(E)," ",f.unit||"gal"]}),a.jsxs("span",{className:"percentage",children:[j,"%"]})]}),a.jsx("div",{className:"progress-bar",children:a.jsx("div",{className:"progress-fill",style:{width:`${j}%`,backgroundColor:g?.color}})}),f.needsRestock&&a.jsxs("div",{className:"restock-warning",children:["⚠️ Bajo nivel mínimo (",o(f.minThreshold||f.minStock||0)," ",f.unit||"gal",")"]})]}),a.jsxs("div",{className:"card-metrics",children:[a.jsxs("div",{className:"metric",children:[a.jsxs("span",{className:"metric-label",children:["Precio por ",f.unit||"gal",":"]}),a.jsx("span",{className:"metric-value",children:c(b)})]}),a.jsxs("div",{className:"metric",children:[a.jsx("span",{className:"metric-label",children:"Valor total:"}),a.jsx("span",{className:"metric-value",children:c(N)})]}),f.supplier&&a.jsxs("div",{className:"metric",children:[a.jsx("span",{className:"metric-label",children:"Proveedor:"}),a.jsx("span",{className:"metric-value",children:f.supplier})]})]}),a.jsxs("div",{className:"card-footer",children:[a.jsxs("div",{className:"status-info",children:[a.jsx("span",{className:`status-dot ${f.status}`}),a.jsx("span",{className:"status-text",children:f.status==="active"?"Activo":f.status==="inactive"?"Inactivo":f.status==="maintenance"?"Mantenimiento":f.status})]}),a.jsxs("div",{className:"last-update",children:["Actualizado ",d(f.updatedAt||f.lastUpdated)]})]}),i&&a.jsxs("div",{className:"card-actions",children:[a.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>e(f),title:"Editar combustible",children:"✏️ Editar"}),a.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>t(f),title:"Eliminar combustible",children:"🗑️ Eliminar"})]}),f.description&&f.description!==p?.description&&a.jsx("div",{className:"card-description",children:a.jsx("p",{children:f.description})})]},f.id)})})},BL=({item:n,onClose:e,onSuccess:t})=>{const{userProfile:i}=Qn(),o=!!n,[c,d]=z.useState({fuelType:"",location:"",currentStock:"",maxCapacity:"",minThreshold:"",pricePerUnit:"",supplier:"",description:"",status:"active"}),[f,p]=z.useState({}),[g,y]=z.useState(!1);z.useEffect(()=>{o&&n&&d({fuelType:n.fuelType||"",location:n.location||"",currentStock:n.currentStock||"",maxCapacity:n.maxCapacity||"",minThreshold:n.minThreshold||"",pricePerUnit:n.pricePerUnit||"",supplier:n.supplier||"",description:n.description||"",status:n.status||"active"})},[o,n]),z.useEffect(()=>{if(c.maxCapacity&&!c.minThreshold){const w=Math.round(Number(c.maxCapacity)*.15);d(T=>({...T,minThreshold:w}))}},[c.maxCapacity]);const b=w=>{const{name:T,value:S}=w.target;d(q=>({...q,[T]:S})),f[T]&&p(q=>({...q,[T]:null}))},E=()=>{const w={};c.fuelType||(w.fuelType="Tipo de combustible es requerido"),c.location||(w.location="Ubicación es requerida"),c.maxCapacity||(w.maxCapacity="Capacidad máxima es requerida");const T=Number(c.currentStock),S=Number(c.maxCapacity),q=Number(c.minThreshold),I=Number(c.pricePerUnit);return c.currentStock&&(isNaN(T)||T<0)&&(w.currentStock="Stock actual debe ser un número válido mayor o igual a 0"),c.maxCapacity&&(isNaN(S)||S<=0)&&(w.maxCapacity="Capacidad máxima debe ser un número válido mayor a 0"),c.minThreshold&&(isNaN(q)||q<0)&&(w.minThreshold="Umbral mínimo debe ser un número válido mayor o igual a 0"),c.pricePerUnit&&(isNaN(I)||I<0)&&(w.pricePerUnit="Precio debe ser un número válido mayor o igual a 0"),T>S&&(w.currentStock="Stock actual no puede ser mayor a la capacidad máxima"),q>S&&(w.minThreshold="Umbral mínimo no puede ser mayor a la capacidad máxima"),p(w),Object.keys(w).length===0},j=async w=>{if(w.preventDefault(),!!E()){y(!0);try{let T;o?T=await AL(n.id,{location:c.location,currentStock:Number(c.currentStock)||0,maxCapacity:Number(c.maxCapacity),minThreshold:Number(c.minThreshold)||Number(c.maxCapacity)*.15,pricePerUnit:Number(c.pricePerUnit)||0,supplier:c.supplier,description:c.description,status:c.status},i.uid):T=await TL({fuelType:c.fuelType,location:c.location,currentStock:Number(c.currentStock)||0,maxCapacity:Number(c.maxCapacity),minThreshold:Number(c.minThreshold)||Number(c.maxCapacity)*.15,pricePerUnit:Number(c.pricePerUnit)||0,supplier:c.supplier,description:c.description,status:c.status},i.uid),T.success?(alert(T.message),t()):alert(`Error: ${T.error}`)}catch(T){console.error("Error saving inventory item:",T),alert("Error inesperado al guardar el item")}finally{y(!1)}}},N=ol[c.fuelType];return a.jsx("div",{className:"modal-overlay",onClick:e,children:a.jsxs("div",{className:"modal-content inventory-modal",onClick:w=>w.stopPropagation(),children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("h2",{children:o?"✏️ Editar Combustible":"➕ Agregar Nuevo Combustible"}),a.jsx("button",{className:"modal-close",onClick:e,children:"✕"})]}),a.jsxs("form",{onSubmit:j,className:"modal-form",children:[a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:"fuelType",children:["Tipo de Combustible *",N&&a.jsxs("span",{className:"fuel-preview",children:[N.icon," ",N.name]})]}),a.jsxs("select",{id:"fuelType",name:"fuelType",value:c.fuelType,onChange:b,disabled:o,className:f.fuelType?"error":"",required:!0,children:[a.jsx("option",{value:"",children:"Seleccionar tipo..."}),Object.entries(Tn).map(([w,T])=>{const S=ol[T];return a.jsxs("option",{value:T,children:[S.icon," ",S.name," (",S.unit,")"]},w)})]}),f.fuelType&&a.jsx("span",{className:"error-text",children:f.fuelType})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"location",children:"Ubicación / Tanque *"}),a.jsx("input",{type:"text",id:"location",name:"location",value:c.location,onChange:b,placeholder:"ej. Tanque Principal, Depósito A, Bodega Norte",className:f.location?"error":"",required:!0}),f.location&&a.jsx("span",{className:"error-text",children:f.location})]}),a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:"currentStock",children:["Stock Actual ",N&&`(${N.unit})`]}),a.jsx("input",{type:"number",id:"currentStock",name:"currentStock",value:c.currentStock,onChange:b,placeholder:"0",min:"0",step:"0.01",className:f.currentStock?"error":""}),f.currentStock&&a.jsx("span",{className:"error-text",children:f.currentStock})]}),a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:"maxCapacity",children:["Capacidad Máxima * ",N&&`(${N.unit})`]}),a.jsx("input",{type:"number",id:"maxCapacity",name:"maxCapacity",value:c.maxCapacity,onChange:b,placeholder:"1000",min:"1",step:"0.01",className:f.maxCapacity?"error":"",required:!0}),f.maxCapacity&&a.jsx("span",{className:"error-text",children:f.maxCapacity})]}),a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:"minThreshold",children:["Umbral Mínimo ",N&&`(${N.unit})`,a.jsx("span",{className:"field-hint",children:"Para alertas de stock bajo"})]}),a.jsx("input",{type:"number",id:"minThreshold",name:"minThreshold",value:c.minThreshold,onChange:b,placeholder:"Auto: 15% de capacidad máxima",min:"0",step:"0.01",className:f.minThreshold?"error":""}),f.minThreshold&&a.jsx("span",{className:"error-text",children:f.minThreshold}),c.maxCapacity&&a.jsxs("span",{className:"field-hint",children:["Sugerido: ",Math.round(Number(c.maxCapacity)*.15)," ",N?.unit||"unidades"]})]}),a.jsxs("div",{className:"form-group",children:[a.jsxs("label",{htmlFor:"pricePerUnit",children:["Precio por ",N?.unit||"Unidad"]}),a.jsx("input",{type:"number",id:"pricePerUnit",name:"pricePerUnit",value:c.pricePerUnit,onChange:b,placeholder:"12000",min:"0",step:"0.01",className:f.pricePerUnit?"error":""}),f.pricePerUnit&&a.jsx("span",{className:"error-text",children:f.pricePerUnit})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"supplier",children:"Proveedor Principal"}),a.jsx("input",{type:"text",id:"supplier",name:"supplier",value:c.supplier,onChange:b,placeholder:"ej. Petrobras, Terpel, Mobil"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"status",children:"Estado"}),a.jsxs("select",{id:"status",name:"status",value:c.status,onChange:b,children:[a.jsx("option",{value:"active",children:"Activo"}),a.jsx("option",{value:"inactive",children:"Inactivo"}),a.jsx("option",{value:"maintenance",children:"Mantenimiento"})]})]}),a.jsxs("div",{className:"form-group full-width",children:[a.jsx("label",{htmlFor:"description",children:"Descripción / Notas"}),a.jsx("textarea",{id:"description",name:"description",value:c.description,onChange:b,placeholder:"Información adicional sobre este combustible...",rows:"3"})]})]}),N&&c.maxCapacity&&a.jsxs("div",{className:"form-preview",children:[a.jsx("h4",{children:"📊 Vista Previa"}),a.jsxs("div",{className:"preview-card",children:[a.jsxs("div",{className:"preview-header",children:[a.jsxs("span",{style:{color:N.color},children:[N.icon," ",N.name]}),a.jsx("span",{children:c.location})]}),a.jsxs("div",{className:"preview-capacity",children:[c.currentStock||0," / ",c.maxCapacity," ",N.unit,c.currentStock&&c.maxCapacity&&a.jsxs("span",{className:"preview-percentage",children:["(",Math.round(Number(c.currentStock)/Number(c.maxCapacity)*100),"%)"]})]}),c.pricePerUnit&&a.jsxs("div",{className:"preview-value",children:["Valor total: ",new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format((Number(c.currentStock)||0)*Number(c.pricePerUnit))]})]})]}),a.jsxs("div",{className:"modal-actions",children:[a.jsx("button",{type:"button",onClick:e,className:"btn btn-secondary",children:"Cancelar"}),a.jsx("button",{type:"submit",className:"btn btn-primary",disabled:g,children:g?"Guardando...":o?"Actualizar":"Crear"})]})]})]})})},zL=({stats:n})=>a.jsxs("div",{className:"inventory-stats",children:[a.jsxs("div",{className:"stats-grid",children:[a.jsxs("div",{className:"stat-card primary",children:[a.jsx("div",{className:"stat-icon",children:"💰"}),a.jsxs("div",{className:"stat-content",children:[a.jsx("h3",{children:"Valor Total"}),a.jsx("div",{className:"stat-value",children:Nt(n.totalValue)}),a.jsxs("div",{className:"stat-subtitle",children:[be(n.totalItems)," tipos de combustible"]})]})]}),a.jsxs("div",{className:"stat-card success",children:[a.jsx("div",{className:"stat-icon",children:"✅"}),a.jsxs("div",{className:"stat-content",children:[a.jsx("h3",{children:"Items Activos"}),a.jsx("div",{className:"stat-value",children:n.activeItems}),a.jsxs("div",{className:"stat-subtitle",children:[Math.round(n.activeItems/n.totalItems*100),"% del total"]})]})]}),a.jsxs("div",{className:`stat-card ${n.lowStockItems>0?"warning":"info"}`,children:[a.jsx("div",{className:"stat-icon",children:n.lowStockItems>0?"⚠️":"📊"}),a.jsxs("div",{className:"stat-content",children:[a.jsx("h3",{children:"Stock Bajo"}),a.jsx("div",{className:"stat-value",children:n.lowStockItems}),a.jsx("div",{className:"stat-subtitle",children:n.lowStockItems>0?"Requieren atención":"Niveles normales"})]})]}),a.jsxs("div",{className:"stat-card info",children:[a.jsx("div",{className:"stat-icon",children:"📈"}),a.jsxs("div",{className:"stat-content",children:[a.jsx("h3",{children:"Nivel Promedio"}),a.jsxs("div",{className:"stat-value",children:[n.averageStockLevel,"%"]}),a.jsx("div",{className:"stat-subtitle",children:"Capacidad promedio utilizada"})]})]})]}),a.jsxs("div",{className:"fuel-type-summary",children:[a.jsx("h4",{children:"📊 Resumen por Tipo de Combustible"}),a.jsx("div",{className:"fuel-types-grid",children:Object.entries(n.byFuelType).map(([e,t])=>{const i=ol[e],o=t.totalCapacity>0?Math.round(t.totalStock/t.totalCapacity*100):0;return a.jsxs("div",{className:"fuel-type-card",children:[a.jsxs("div",{className:"fuel-header",children:[a.jsx("span",{className:"fuel-icon",style:{color:i?.color||"#6b7280"},children:i?.icon||"⛽"}),a.jsxs("div",{className:"fuel-info",children:[a.jsx("h5",{children:i?.name||e}),a.jsxs("span",{className:"fuel-count",children:[t.count," ubicaciones"]})]})]}),a.jsxs("div",{className:"fuel-metrics",children:[a.jsxs("div",{className:"metric",children:[a.jsx("span",{className:"metric-label",children:"Stock Total:"}),a.jsxs("span",{className:"metric-value",children:[be(t.totalStock)," ",i?.unit||"unidades"]})]}),a.jsxs("div",{className:"metric",children:[a.jsx("span",{className:"metric-label",children:"Capacidad:"}),a.jsxs("span",{className:"metric-value",children:[be(t.totalCapacity)," ",i?.unit||"unidades"]})]}),a.jsxs("div",{className:"metric",children:[a.jsx("span",{className:"metric-label",children:"Utilización:"}),a.jsxs("span",{className:`metric-value ${o<25?"low":o>75?"high":"normal"}`,children:[o,"%"]})]}),a.jsxs("div",{className:"metric",children:[a.jsx("span",{className:"metric-label",children:"Valor:"}),a.jsx("span",{className:"metric-value",children:Nt(t.totalValue)})]})]}),a.jsx("div",{className:"progress-bar",children:a.jsx("div",{className:"progress-fill",style:{width:`${o}%`,backgroundColor:i?.color||"#6b7280"}})})]},e)})}),Object.keys(n.byFuelType).length===0&&a.jsx("div",{className:"empty-fuel-types",children:a.jsx("p",{children:"No hay tipos de combustible registrados en el inventario."})})]})]}),HL=()=>{const{hasPermission:n}=Qn(),[e,t]=z.useState([]),[i,o]=z.useState(null),[c,d]=z.useState(!0),[f,p]=z.useState(null),[g,y]=z.useState("cards"),[b,E]=z.useState(!1),[j,N]=z.useState(null),[w,T]=z.useState("all"),[S,q]=z.useState("");z.useEffect(()=>{let R=null;return(()=>{R=MA((P,C)=>{if(C){console.error("Error in inventory subscription:",C),p("Error cargando inventario en tiempo real");return}t(P||[]),d(!1)})})(),()=>{R&&R()}},[]),z.useEffect(()=>{(async()=>{const V=await wL();V.success&&o(V.data)})()},[e]);const I=e.filter(R=>{if(w==="active"&&R.status!=="active"||w==="low-stock"&&!R.needsRestock)return!1;if(S){const V=S.toLowerCase();return R.name.toLowerCase().includes(V)||R.location.toLowerCase().includes(V)||R.fuelType.toLowerCase().includes(V)}return!0}),O=R=>{if(!n("canManageInventory")){alert("No tienes permisos para editar items de inventario");return}N(R),E(!0)},U=async R=>{if(!n("canManageInventory")){alert("No tienes permisos para eliminar items de inventario");return}if(!window.confirm(`¿Estás seguro de eliminar ${R.name} de ${R.location}?

Esta acción no se puede deshacer.`))return;d(!0);const P=await CL(R.id);P.success?alert("Item eliminado exitosamente"):(p(P.error),alert(`Error al eliminar: ${P.error}`)),d(!1)},$=()=>{E(!1),N(null)},F=()=>{$()};return c&&e.length===0?a.jsxs("div",{className:"inventory-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Cargando inventario..."})]}):a.jsxs("div",{className:"inventory-main",children:[a.jsxs("div",{className:"inventory-header",children:[a.jsxs("div",{className:"header-title",children:[a.jsx("h2",{children:"🛢️ Gestión de Inventario"}),a.jsx("p",{children:"Control de stock de combustibles en tiempo real"})]}),a.jsx("div",{className:"inventory-info",children:a.jsxs("span",{className:"info-text",children:["💡 Los combustibles se agregan automáticamente desde la pestaña ",a.jsx("strong",{children:"Movimientos"})]})})]}),i&&a.jsx(zL,{stats:i}),a.jsxs("div",{className:"inventory-controls",children:[a.jsxs("div",{className:"search-filters",children:[a.jsx("input",{type:"text",placeholder:"Buscar por nombre, ubicación o tipo...",value:S,onChange:R=>q(R.target.value),className:"search-input"}),a.jsxs("select",{value:w,onChange:R=>T(R.target.value),className:"filter-select",children:[a.jsx("option",{value:"all",children:"Todos los items"}),a.jsx("option",{value:"active",children:"Solo activos"}),a.jsx("option",{value:"low-stock",children:"Stock bajo"})]})]}),a.jsxs("div",{className:"view-toggle",children:[a.jsx("button",{className:`toggle-btn ${g==="cards"?"active":""}`,onClick:()=>y("cards"),children:"📱 Cards"}),a.jsx("button",{className:`toggle-btn ${g==="table"?"active":""}`,onClick:()=>y("table"),children:"📊 Tabla"})]})]}),f&&a.jsxs("div",{className:"error-banner",children:[a.jsxs("span",{children:["⚠️ ",f]}),a.jsx("button",{onClick:()=>p(null),children:"✕"})]}),a.jsx("div",{className:"inventory-content",children:I.length===0?a.jsxs("div",{className:"empty-state",children:[a.jsx("div",{className:"empty-icon",children:"📦"}),a.jsx("h3",{children:"No hay items de inventario"}),a.jsx("p",{children:S||w!=="all"?"No se encontraron items con los filtros aplicados":"Ve a la pestaña Movimientos para crear una ENTRADA de combustible"})]}):a.jsx(a.Fragment,{children:g==="cards"?a.jsx(qL,{items:I,onEdit:O,onDelete:U,canManage:n("canManageInventory")}):a.jsx(FL,{items:I,onEdit:O,onDelete:U,canManage:n("canManageInventory")})})}),I.length>0&&a.jsx("div",{className:"results-footer",children:a.jsxs("p",{children:["Mostrando ",I.length," de ",e.length," items",S&&` · Filtro: "${S}"`,w!=="all"&&` · Estado: ${w}`]})}),b&&a.jsx(BL,{item:j,onClose:$,onSuccess:F})]})},GL=({stats:n,filters:e})=>{if(!n)return null;const t=(d,f)=>f===0?d>0?100:0:((d-f)/f*100).toFixed(1),i=d=>{switch(d){case de.ENTRADA:return"#10b981";case de.SALIDA:return"#ef4444";case de.TRANSFERENCIA:return"#3b82f6";case de.AJUSTE:return"#f59e0b";default:return"#6b7280"}},o=d=>{switch(d){case de.ENTRADA:return"📥";case de.SALIDA:return"📤";case de.TRANSFERENCIA:return"🔄";case de.AJUSTE:return"⚖️";default:return"📋"}},c=t(n.thisMonth,n.lastMonth);return a.jsxs("div",{className:"movements-stats",children:[a.jsxs("div",{className:"stats-grid",children:[a.jsxs("div",{className:"stat-card primary",children:[a.jsx("div",{className:"stat-icon",children:"📊"}),a.jsxs("div",{className:"stat-content",children:[a.jsx("div",{className:"stat-value",children:be(n.totalMovements)}),a.jsx("div",{className:"stat-label",children:"Total Movimientos"}),a.jsxs("div",{className:"stat-trend",children:[a.jsxs("span",{className:`trend ${c>=0?"positive":"negative"}`,children:[c>=0?"📈":"📉"," ",Math.abs(c),"%"]}),a.jsx("span",{className:"trend-label",children:"vs mes anterior"})]})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:"💰"}),a.jsxs("div",{className:"stat-content",children:[a.jsx("div",{className:"stat-value",children:Nt(n.totalValue)}),a.jsx("div",{className:"stat-label",children:"Valor Total"}),a.jsxs("div",{className:"stat-secondary",children:["Promedio: ",Nt(n.averageValue)]})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:"⛽"}),a.jsxs("div",{className:"stat-content",children:[a.jsx("div",{className:"stat-value",children:be(n.totalQuantity)}),a.jsx("div",{className:"stat-label",children:"Galones Total"}),a.jsxs("div",{className:"stat-secondary",children:["Promedio: ",be(n.totalQuantity/(n.totalMovements||1))," gal/mov"]})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:"📅"}),a.jsxs("div",{className:"stat-content",children:[a.jsx("div",{className:"stat-value",children:be(n.thisWeek)}),a.jsx("div",{className:"stat-label",children:"Esta Semana"}),a.jsxs("div",{className:"stat-secondary",children:[be(n.thisMonth)," este mes"]})]})]})]}),a.jsxs("div",{className:"stats-breakdown",children:[a.jsxs("div",{className:"breakdown-section",children:[a.jsx("h4",{children:"📋 Por Tipo de Movimiento"}),a.jsx("div",{className:"breakdown-grid",children:Object.entries(n.byType).map(([d,f])=>{const p=(f/n.totalMovements*100).toFixed(1);return a.jsxs("div",{className:"breakdown-item",children:[a.jsxs("div",{className:"breakdown-header",children:[a.jsx("span",{className:"breakdown-icon",children:o(d)}),a.jsx("span",{className:"breakdown-label",children:d.charAt(0).toUpperCase()+d.slice(1)})]}),a.jsx("div",{className:"breakdown-value",children:f}),a.jsx("div",{className:"breakdown-bar",children:a.jsx("div",{className:"breakdown-fill",style:{width:`${p}%`,backgroundColor:i(d)}})}),a.jsxs("div",{className:"breakdown-percentage",children:[p,"%"]})]},d)})})]}),a.jsxs("div",{className:"breakdown-section",children:[a.jsx("h4",{children:"⚡ Por Estado"}),a.jsx("div",{className:"breakdown-grid",children:Object.entries(n.byStatus).map(([d,f])=>{const p=(f/n.totalMovements*100).toFixed(1),g=b=>{switch(b){case gt.COMPLETADO:return"#10b981";case gt.PENDIENTE:return"#f59e0b";case gt.CANCELADO:return"#ef4444";default:return"#6b7280"}},y=b=>{switch(b){case gt.COMPLETADO:return"✅";case gt.PENDIENTE:return"⏳";case gt.CANCELADO:return"❌";default:return"❓"}};return a.jsxs("div",{className:"breakdown-item",children:[a.jsxs("div",{className:"breakdown-header",children:[a.jsx("span",{className:"breakdown-icon",children:y(d)}),a.jsx("span",{className:"breakdown-label",children:d.charAt(0).toUpperCase()+d.slice(1)})]}),a.jsx("div",{className:"breakdown-value",children:f}),a.jsx("div",{className:"breakdown-bar",children:a.jsx("div",{className:"breakdown-fill",style:{width:`${p}%`,backgroundColor:g(d)}})}),a.jsxs("div",{className:"breakdown-percentage",children:[p,"%"]})]},d)})})]}),a.jsxs("div",{className:"breakdown-section",children:[a.jsx("h4",{children:"⛽ Por Tipo de Combustible"}),a.jsx("div",{className:"breakdown-grid",children:Object.entries(n.byFuelType).map(([d,f])=>{const p=(f/n.totalMovements*100).toFixed(1),g=y=>{switch(y?.toLowerCase()){case"diesel":return"🚛";case"gasolina":return"🚗";case"acpm":return"🚚";case"lubricante":return"🛢️";default:return"⛽"}};return a.jsxs("div",{className:"breakdown-item",children:[a.jsxs("div",{className:"breakdown-header",children:[a.jsx("span",{className:"breakdown-icon",children:g(d)}),a.jsx("span",{className:"breakdown-label",children:d})]}),a.jsx("div",{className:"breakdown-value",children:f}),a.jsx("div",{className:"breakdown-bar",children:a.jsx("div",{className:"breakdown-fill",style:{width:`${p}%`,backgroundColor:"#059669"}})}),a.jsxs("div",{className:"breakdown-percentage",children:[p,"%"]})]},d)})})]})]}),(e.type||e.status||e.fuelType||e.vehicleId)&&a.jsxs("div",{className:"active-filters",children:[a.jsx("h4",{children:"🔍 Filtros Activos"}),a.jsxs("div",{className:"filters-list",children:[e.type&&a.jsxs("span",{className:"filter-tag",children:["Tipo: ",e.type]}),e.status&&a.jsxs("span",{className:"filter-tag",children:["Estado: ",e.status]}),e.fuelType&&a.jsxs("span",{className:"filter-tag",children:["Combustible: ",e.fuelType]}),e.vehicleId&&a.jsxs("span",{className:"filter-tag",children:["Vehículo: ",e.vehicleId]})]})]})]})},$L=({filters:n,onFilterChange:e,onClearFilters:t,searchTerm:i,onSearchChange:o,totalResults:c})=>{const[d,f]=z.useState(!1),p=[{value:"Diesel",label:"Diesel 🚛"},{value:"Gasolina",label:"Gasolina 🚗"},{value:"ACPM",label:"ACPM 🚚"},{value:"Lubricante",label:"Lubricante 🛢️"}],g=[{value:"all",label:"Todos los períodos"},{value:"today",label:"Hoy"},{value:"week",label:"Esta semana"},{value:"month",label:"Este mes"},{value:"quarter",label:"Este trimestre"},{value:"year",label:"Este año"}],y=Object.values(n).filter(j=>j&&j!==""&&j!=="all").length,b=(j,N)=>{e({[j]:N})},E=j=>{e(j)};return a.jsxs("div",{className:"movements-filters",children:[a.jsxs("div",{className:"filters-main",children:[a.jsx("div",{className:"search-section",children:a.jsxs("div",{className:"search-box",children:[a.jsx("span",{className:"search-icon",children:"🔍"}),a.jsx("input",{type:"text",placeholder:"Buscar por combustible, vehículo, referencia...",value:i,onChange:j=>o(j.target.value),className:"search-input"}),i&&a.jsx("button",{className:"search-clear",onClick:()=>o(""),title:"Limpiar búsqueda",children:"✕"})]})}),a.jsxs("div",{className:"filters-controls",children:[a.jsxs("div",{className:"quick-filters",children:[a.jsx("button",{className:`quick-filter ${n.type===de.ENTRADA?"active":""}`,onClick:()=>E({type:de.ENTRADA}),children:"📥 Entradas"}),a.jsx("button",{className:`quick-filter ${n.type===de.SALIDA?"active":""}`,onClick:()=>E({type:de.SALIDA}),children:"📤 Salidas"}),a.jsx("button",{className:`quick-filter ${n.status===gt.PENDIENTE?"active":""}`,onClick:()=>E({status:gt.PENDIENTE}),children:"⏳ Pendientes"})]}),a.jsxs("button",{className:`btn-advanced-filters ${d?"active":""}`,onClick:()=>f(!d),children:["🎛️ Filtros",y>0&&a.jsx("span",{className:"filters-count",children:y})]}),a.jsx("div",{className:"view-indicator",children:a.jsx("span",{className:"view-info",children:"📋 Vista Tabla"})})]})]}),d&&a.jsxs("div",{className:"filters-advanced",children:[a.jsxs("div",{className:"filters-grid",children:[a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Tipo de Movimiento"}),a.jsxs("select",{value:n.type,onChange:j=>b("type",j.target.value),className:"filter-select",children:[a.jsx("option",{value:"",children:"Todos los tipos"}),a.jsx("option",{value:de.ENTRADA,children:"📥 Entrada"}),a.jsx("option",{value:de.SALIDA,children:"📤 Salida"}),a.jsx("option",{value:de.TRANSFERENCIA,children:"🔄 Transferencia"}),a.jsx("option",{value:de.AJUSTE,children:"⚖️ Ajuste"})]})]}),a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Estado"}),a.jsxs("select",{value:n.status,onChange:j=>b("status",j.target.value),className:"filter-select",children:[a.jsx("option",{value:"",children:"Todos los estados"}),a.jsx("option",{value:gt.PENDIENTE,children:"⏳ Pendiente"}),a.jsx("option",{value:gt.COMPLETADO,children:"✅ Completado"}),a.jsx("option",{value:gt.CANCELADO,children:"❌ Cancelado"})]})]}),a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Tipo de Combustible"}),a.jsxs("select",{value:n.fuelType,onChange:j=>b("fuelType",j.target.value),className:"filter-select",children:[a.jsx("option",{value:"",children:"Todos los combustibles"}),p.map(j=>a.jsx("option",{value:j.value,children:j.label},j.value))]})]}),a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Período"}),a.jsx("select",{value:n.dateRange,onChange:j=>b("dateRange",j.target.value),className:"filter-select",children:g.map(j=>a.jsx("option",{value:j.value,children:j.label},j.value))})]}),a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Vehículo/Equipo"}),a.jsx("input",{type:"text",placeholder:"ID del vehículo...",value:n.vehicleId,onChange:j=>b("vehicleId",j.target.value),className:"filter-input"})]})]}),a.jsxs("div",{className:"filters-actions",children:[a.jsx("button",{className:"btn-clear-filters",onClick:t,disabled:y===0,children:"🗑️ Limpiar Filtros"}),a.jsxs("div",{className:"filters-info",children:[a.jsxs("span",{className:"results-count",children:[c," resultado",c!==1?"s":""]}),y>0&&a.jsxs("span",{className:"active-filters-text",children:["(",y," filtro",y!==1?"s":""," activo",y!==1?"s":"",")"]})]})]})]}),a.jsx("div",{className:"keyboard-shortcuts",style:{display:"none"},children:a.jsx("small",{children:"💡 Atajos: Ctrl+F (buscar), Ctrl+1 (entradas), Ctrl+2 (salidas), Ctrl+3 (pendientes)"})})]})},YL=({movements:n,onEdit:e,onView:t,onApprove:i,onReject:o,onDelete:c,userRole:d})=>{const[f,p]=z.useState("createdAt"),[g,y]=z.useState("desc"),b=O=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(O),E=O=>O?(O instanceof Date?O:new Date(O)).toLocaleDateString("es-CO",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):"Sin fecha",j=O=>{switch(O){case de.ENTRADA:return"📥";case de.SALIDA:return"📤";case de.TRANSFERENCIA:return"🔄";case de.AJUSTE:return"⚖️";default:return"📋"}},N=O=>{switch(O?.toLowerCase()){case"diesel":return"🚛";case"gasolina":return"🚗";case"acpm":return"🚚";case"lubricante":return"🛢️";default:return"⛽"}},w=O=>{switch(O){case gt.COMPLETADO:return"✅";case gt.PENDIENTE:return"⏳";case gt.CANCELADO:return"❌";default:return"❓"}},T=O=>{switch(O){case gt.COMPLETADO:return"status-completado";case gt.PENDIENTE:return"status-pendiente";case gt.CANCELADO:return"status-cancelado";default:return"status-default"}},S=O=>{f===O?y(g==="asc"?"desc":"asc"):(p(O),y("asc"))},q=[...n].sort((O,U)=>{let $=O[f],F=U[f];return(f.includes("Date")||f.includes("At"))&&($=new Date($),F=new Date(F)),typeof $=="number"&&typeof F=="number"?g==="asc"?$-F:F-$:typeof $=="string"&&typeof F=="string"?g==="asc"?$.localeCompare(F):F.localeCompare($):$ instanceof Date&&F instanceof Date?g==="asc"?$-F:F-$:0}),I=O=>f!==O?"↕️":g==="asc"?"↑":"↓";return a.jsxs("div",{className:"movements-table-container",children:[a.jsx("div",{className:"table-wrapper",children:a.jsxs("table",{className:"movements-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsxs("th",{className:"sortable",onClick:()=>S("type"),children:["Tipo ",I("type")]}),a.jsxs("th",{className:"sortable",onClick:()=>S("fuelType"),children:["Combustible ",I("fuelType")]}),a.jsxs("th",{className:"sortable text-right",onClick:()=>S("quantity"),children:["Cantidad ",I("quantity")]}),a.jsxs("th",{className:"sortable text-right",onClick:()=>S("unitPrice"),children:["Precio/Gal ",I("unitPrice")]}),a.jsxs("th",{className:"sortable text-right",onClick:()=>S("totalValue"),children:["Valor Total ",I("totalValue")]}),a.jsx("th",{children:"Vehículo"}),a.jsx("th",{children:"Ubicación"}),a.jsxs("th",{className:"sortable",onClick:()=>S("status"),children:["Estado ",I("status")]}),a.jsxs("th",{className:"sortable",onClick:()=>S("createdAt"),children:["Fecha ",I("createdAt")]}),a.jsx("th",{className:"actions-column",children:"Acciones"})]})}),a.jsx("tbody",{children:q.map(O=>a.jsxs("tr",{className:`movement-row ${O.status===gt.PENDIENTE?"pending-row":""}`,children:[a.jsx("td",{className:"type-cell",children:a.jsxs("div",{className:"type-content",children:[a.jsx("span",{className:"type-icon",children:j(O.type)}),a.jsx("span",{className:"type-text",children:O.type.charAt(0).toUpperCase()+O.type.slice(1)})]})}),a.jsx("td",{className:"fuel-cell",children:a.jsxs("div",{className:"fuel-content",children:[a.jsx("span",{className:"fuel-icon",children:N(O.fuelType)}),a.jsx("span",{className:"fuel-text",children:O.fuelType})]})}),a.jsxs("td",{className:"quantity-cell text-right",children:[a.jsx("span",{className:"quantity-value",children:O.quantity}),a.jsx("span",{className:"quantity-unit",children:"gal"})]}),a.jsx("td",{className:"price-cell text-right",children:b(O.unitPrice)}),a.jsx("td",{className:"value-cell text-right",children:a.jsx("strong",{children:b(O.totalValue)})}),a.jsx("td",{className:"vehicle-cell",children:O.vehicleId?a.jsxs("span",{className:"vehicle-id",children:["🚜 ",O.vehicleId]}):a.jsx("span",{className:"no-vehicle",children:"-"})}),a.jsx("td",{className:"location-cell",children:a.jsxs("span",{className:"location-text",children:["📍 ",O.type===de.ENTRADA?O.destinationLocation||"Sin ubicación":O.location||"Principal"]})}),a.jsx("td",{className:"status-cell",children:a.jsxs("div",{className:`status-badge ${T(O.status)}`,children:[a.jsx("span",{className:"status-icon",children:w(O.status)}),a.jsx("span",{className:"status-text",children:O.status.charAt(0).toUpperCase()+O.status.slice(1)})]})}),a.jsx("td",{className:"date-cell",children:a.jsxs("div",{className:"date-content",children:[a.jsx("span",{className:"date-value",children:E(O.createdAt)}),O.reference&&a.jsxs("span",{className:"reference-small",children:["#",O.reference]})]})}),a.jsx("td",{className:"actions-cell",children:a.jsxs("div",{className:"action-buttons",children:[a.jsx("button",{className:"btn-action btn-view",onClick:()=>t(O),title:"Ver detalles",children:"👁️"}),d==="admin"&&O.status===gt.PENDIENTE&&a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"btn-action btn-approve",onClick:()=>i(O.id),title:"Aprobar movimiento",children:"✓"}),a.jsx("button",{className:"btn-action btn-reject",onClick:()=>o(O.id),title:"Rechazar movimiento",children:"✗"})]}),e&&O.status===gt.PENDIENTE&&a.jsx("button",{className:"btn-action btn-edit",onClick:()=>e(O),title:"Editar movimiento",children:"✏️"}),d==="admin"&&a.jsx("button",{className:"btn-action btn-delete",onClick:()=>{window.confirm("¿Estás seguro de que deseas eliminar este movimiento? Esta acción no se puede deshacer.")&&c(O.id)},title:"Eliminar movimiento",children:"🗑️"})]})})]},O.id))})]})}),a.jsxs("div",{className:"table-info",children:[a.jsxs("div",{className:"table-summary",children:[a.jsxs("span",{className:"total-rows",children:[n.length," movimiento",n.length!==1?"s":""]}),f&&a.jsxs("span",{className:"sort-info",children:["Ordenado por ",f," (",g==="asc"?"ascendente":"descendente",")"]})]}),a.jsxs("div",{className:"table-legend",children:[a.jsxs("span",{className:"legend-item",children:[a.jsx("span",{className:"legend-icon",children:"⏳"})," Pendiente"]}),a.jsxs("span",{className:"legend-item",children:[a.jsx("span",{className:"legend-icon",children:"✅"})," Completado"]}),a.jsxs("span",{className:"legend-item",children:[a.jsx("span",{className:"legend-icon",children:"❌"})," Cancelado"]})]})]})]})},QL=({movements:n,onEdit:e,onView:t,onApprove:i,onReject:o,onDelete:c,userRole:d})=>a.jsx(YL,{movements:n,onEdit:e,onView:t,onApprove:i,onReject:o,onDelete:c,userRole:d}),Ca={ACPM:"ACPM",GASOLINA:"GASOLINA",ACEITE_HIDRAULICO:"ACEITE_HIDRAULICO",ACEITE_MOTOR_20W50:"ACEITE_MOTOR_20W50",GRASA_ROJA:"GRASA_ROJA",VALVULINA:"VALVULINA",LIQUIDO_FRENOS:"LIQUIDO_FRENOS",MISTURA_LIGA:"MISTURA_LIGA",ACEITE_TRACTORES_15W40:"ACEITE_TRACTORES_15W40"},$A={[Ca.ACPM]:{name:"ACPM",displayName:"ACPM 🚛",category:"Combustible",unit:"gal",defaultPrice:12500,color:"#FF6B35",icon:"🚛",description:"Combustible diesel para vehículos pesados"},[Ca.GASOLINA]:{name:"GASOLINA",displayName:"Gasolina 🚗",category:"Combustible",unit:"gal",defaultPrice:14200,color:"#4CAF50",icon:"🚗",description:"Gasolina corriente para vehículos livianos"},[Ca.ACEITE_HIDRAULICO]:{name:"ACEITE_HIDRAULICO",displayName:"Aceite Hidráulico 🔧",category:"Aceite",unit:"L",defaultPrice:28e3,color:"#2196F3",icon:"🔧",description:"Aceite hidráulico para sistemas de maquinaria"},[Ca.ACEITE_MOTOR_20W50]:{name:"ACEITE_MOTOR_20W50",displayName:"Aceite Motor 20W50 🛢️",category:"Aceite",unit:"L",defaultPrice:35e3,color:"#FF9800",icon:"🛢️",description:"Aceite multigrado para motores"},[Ca.GRASA_ROJA]:{name:"GRASA_ROJA",displayName:"Grasa Roja 🟥",category:"Lubricante",unit:"kg",defaultPrice:12e3,color:"#F44336",icon:"🟥",description:"Grasa lubricante multipropósito"},[Ca.VALVULINA]:{name:"VALVULINA",displayName:"Valvulina ⚙️",category:"Aceite",unit:"L",defaultPrice:25e3,color:"#9C27B0",icon:"⚙️",description:"Aceite para transmisiones y diferenciales"},[Ca.LIQUIDO_FRENOS]:{name:"LIQUIDO_FRENOS",displayName:"Líquido para Frenos 🛑",category:"Fluido",unit:"L",defaultPrice:18e3,color:"#E91E63",icon:"🛑",description:"Líquido de frenos DOT 3/4"},[Ca.MISTURA_LIGA]:{name:"MISTURA_LIGA",displayName:"Mistura o Liga 🌿",category:"Combustible",unit:"L",defaultPrice:8500,color:"#4CAF50",icon:"🌿",description:"Mezcla de combustible para equipos menores"},[Ca.ACEITE_TRACTORES_15W40]:{name:"ACEITE_TRACTORES_15W40",displayName:"Aceite Tractores 15W40 🚜",category:"Aceite",unit:"L",defaultPrice:32e3,color:"#795548",icon:"🚜",description:"Aceite especializado para tractores"}},Hs={COMBUSTIBLE:"Combustible",ACEITE:"Aceite",LUBRICANTE:"Lubricante",FLUIDO:"Fluido"},H_=()=>Object.values($A),G_="combustibles_products",KL=async()=>{try{console.log("🔄 Verificando productos existentes...");const n=Ae(Ee(he,G_),Bk(1));if(!(await He(n)).empty){console.log("✅ Productos ya existen en Firebase");return}console.log("📦 Creando productos predefinidos...");const t=Object.values($A).map(async o=>{const c={name:o.name,displayName:o.displayName,category:o.category,unit:o.unit,defaultPrice:o.defaultPrice,color:o.color,icon:o.icon,description:o.description,isActive:!0,createdAt:new Date,updatedAt:new Date,createdBy:"system-initialization"},d=et(Ee(he,G_));return await yf(d,c),console.log(`✅ Producto creado: ${o.displayName}`),{id:d.id,...c}}),i=await Promise.all(t);return console.log(`🎉 ${i.length} productos inicializados correctamente`),i}catch(n){throw console.error("❌ Error inicializando productos:",n),n}},XL=async()=>{try{await KL()}catch(n){console.error("❌ Error en inicialización automática:",n)}},cl="combustibles_products",tg=async n=>{try{const e={...n,createdAt:Ue(),updatedAt:Ue()},t=await gl(Ee(he,cl),e);return console.log("Product created with ID:",t.id),t.id}catch(e){throw console.error("Error creating product:",e),e}},WL=async(n,e)=>{try{const t=et(he,cl,n);await As(t,{...e,updatedAt:Ue()}),console.log("Product updated successfully")}catch(t){throw console.error("Error updating product:",t),t}},ZL=async n=>{try{await xf(et(he,cl,n)),console.log("Product deleted successfully")}catch(e){throw console.error("Error deleting product:",e),e}},JL=async()=>{try{await XL(),console.log("🔍 Obteniendo productos activos...");const n=Ae(Ee(he,cl),De("isActive","==",!0),Cn("name")),t=(await He(n)).docs.map(i=>({id:i.id,...i.data()}));return console.log(`✅ Productos activos obtenidos: ${t.length}`),t}catch(n){if(console.error("❌ Error obteniendo productos activos:",n),n.code==="failed-precondition"||n.message.includes("index")){console.warn("⚠️ Índice no disponible, usando consulta alternativa...");try{const e=Ae(Ee(he,cl),De("isActive","==",!0)),o=(await He(e)).docs.map(c=>({id:c.id,...c.data()})).sort((c,d)=>(c.name||"").localeCompare(d.name||""));return console.log(`✅ Productos activos obtenidos (ordenamiento en cliente): ${o.length}`),o}catch(e){throw console.error("❌ Error en consulta alternativa:",e),e}}throw n}},eV=(n,e)=>{try{const t=Ae(Ee(he,cl),Cn("name"));return zr(t,i=>{const o=i.docs.map(c=>({id:c.id,...c.data()}));n(o)},i=>{console.error("Error in products subscription:",i),e(i)})}catch(t){return console.error("Error setting up products subscription:",t),e(t),()=>{}}},tV=({formData:n,updateFormData:e,setError:t})=>{const i=[{type:de.ENTRADA,icon:"📥",title:"Entrada",description:"Compra o reabastecimiento de combustible",color:"entrada",details:"Registra combustible que llega desde proveedores"},{type:de.SALIDA,icon:"📤",title:"Salida",description:"Consumo de combustible por vehículos",color:"salida",details:"Asigna combustible a vehículos y equipos"},{type:de.TRANSFERENCIA,icon:"🔄",title:"Transferencia",description:"Movimiento entre ubicaciones",color:"transferencia",details:"Traslada combustible entre tanques o sitios"},{type:de.AJUSTE,icon:"⚖️",title:"Ajuste",description:"Corrección de inventario",color:"ajuste",details:"Ajusta stock por mermas, pérdidas o calibraciones"}],o=c=>{e("type",c),t("")};return a.jsx("div",{className:"wizard-step step-movement-type",children:a.jsxs("div",{className:"step-content",children:[a.jsxs("div",{className:"step-question",children:[a.jsx("h3",{children:"🍀 ¿Qué tipo de operación realizarás?"}),a.jsx("p",{children:"Selecciona el tipo de movimiento que necesitas registrar:"})]}),a.jsx("div",{className:"movement-options",children:i.map(c=>a.jsxs("div",{className:`movement-option ${n.type===c.type?"selected":""} ${c.color}`,onClick:()=>o(c.type),children:[a.jsx("div",{className:"option-icon",children:c.icon}),a.jsxs("div",{className:"option-content",children:[a.jsx("h4",{children:c.title}),a.jsx("p",{className:"option-description",children:c.description}),a.jsx("small",{className:"option-details",children:c.details})]}),a.jsx("div",{className:"option-selector",children:n.type===c.type&&a.jsx("span",{className:"check-icon",children:"✅"})})]},c.type))}),n.type&&a.jsx("div",{className:"selection-confirmation",children:a.jsxs("div",{className:"confirmation-card",children:[a.jsx("span",{className:"confirmation-icon",children:i.find(c=>c.type===n.type)?.icon}),a.jsxs("div",{className:"confirmation-text",children:[a.jsx("strong",{children:"Seleccionado:"})," ",i.find(c=>c.type===n.type)?.title,a.jsx("br",{}),a.jsx("small",{children:i.find(c=>c.type===n.type)?.description})]})]})})]})})},nV=({formData:n,updateFormData:e,systemData:t,setError:i})=>{const[o,c]=z.useState(!1),[d,f]=z.useState(null),{products:p}=t;z.useEffect(()=>{if(n.fuelType&&p.length>0){const y=p.find(b=>b.name===n.fuelType||b.displayName===n.fuelType);f(y),y&&y.defaultPrice&&!n.unitPrice&&e("unitPrice",y.defaultPrice.toString())}},[n.fuelType,n.unitPrice,p,e]);const g=async(y,b)=>{c(!0),i("");try{await new Promise(E=>setTimeout(E,800)),e("fuelType",y),f(b),b.defaultPrice&&e("unitPrice",b.defaultPrice.toString()),console.log("🔄 [Step2] Combustible seleccionado:",y,"Precio:",b.defaultPrice),console.log("🔍 [Step2] FormData después de actualización:",{fuelType:y,unitPrice:b.defaultPrice})}catch(E){console.error("Error al cargar combustible:",E),i("Error al cargar información del combustible")}finally{c(!1)}};return p.length===0?a.jsx("div",{className:"wizard-step step-fuel-type",children:a.jsx("div",{className:"step-content",children:a.jsxs("div",{className:"loading-state",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"🔄 Cargando productos disponibles..."})]})})}):a.jsx("div",{className:"wizard-step step-fuel-type",children:a.jsxs("div",{className:"step-content",children:[a.jsxs("div",{className:"step-question",children:[a.jsx("h3",{children:"⛽ ¿Qué combustible vas a mover?"}),a.jsx("p",{children:"Selecciona el producto del inventario:"})]}),o&&a.jsxs("div",{className:"loading-overlay",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"📡 Solicitando precios actualizados..."})]}),a.jsx("div",{className:"fuel-options",children:p.map(y=>a.jsxs("div",{className:`fuel-option ${n.fuelType===y.name?"selected":""} ${o?"disabled":""}`,onClick:()=>!o&&g(y.name,y),children:[a.jsx("div",{className:"fuel-icon",children:y.icon||"🛢️"}),a.jsxs("div",{className:"fuel-content",children:[a.jsx("h4",{children:y.displayName||y.name}),a.jsx("p",{className:"fuel-description",children:y.description||"Combustible"}),y.defaultPrice&&a.jsxs("div",{className:"fuel-price",children:[a.jsx("span",{className:"price-label",children:"Precio actual:"}),a.jsxs("span",{className:"price-value",children:["$",y.defaultPrice.toLocaleString("es-CO")," COP/gal"]})]}),y.category&&a.jsx("small",{className:"fuel-category",children:y.category})]}),a.jsx("div",{className:"fuel-selector",children:n.fuelType===y.name&&a.jsx("span",{className:"check-icon",children:"✅"})})]},y.id))}),d&&n.fuelType&&a.jsx("div",{className:"selection-confirmation",children:a.jsxs("div",{className:"confirmation-card fuel-confirmation",children:[a.jsxs("div",{className:"confirmation-header",children:[a.jsx("span",{className:"confirmation-icon",children:d.icon||"🛢️"}),a.jsxs("div",{className:"confirmation-text",children:[a.jsx("strong",{children:d.displayName||d.name}),a.jsx("br",{}),a.jsx("small",{children:d.description||"Combustible seleccionado"})]})]}),d.defaultPrice&&a.jsxs("div",{className:"price-confirmation",children:[a.jsxs("div",{className:"price-info",children:[a.jsx("span",{className:"price-label",children:"💰 Precio por galón:"}),a.jsxs("span",{className:"price-amount",children:["$",d.defaultPrice.toLocaleString("es-CO")," COP"]})]}),a.jsx("small",{className:"price-note",children:"✨ Precio aplicado automáticamente (puedes modificarlo más adelante)"})]})]})})]})})},sV=({formData:n,updateFormData:e,systemData:t,setError:i})=>{const[o,c]=z.useState(!1),[d,f]=z.useState({}),[p,g]=z.useState(!1),{suppliers:y,inventory:b}=t,E=n.type===de.ENTRADA;z.useEffect(()=>{(async()=>{if(!E&&n.fuelType&&b.length>0){g(!0),await new Promise(T=>setTimeout(T,600));const w={};console.log("🔍 DEBUG Step3 - Datos para validación:",{fuelType:n.fuelType,inventoryTotal:b.length,inventarioMuestra:b.slice(0,2),operationalLocations:ji}),ji.forEach(T=>{const S=b.filter($=>$.fuelType===n.fuelType&&$.location?.toLowerCase()===T.toLowerCase()&&$.status==="active");console.log(`🔍 DEBUG ${T}:`,{itemsEncontrados:S.length,detalles:S.map($=>({id:$.id,fuelType:$.fuelType,location:$.location,status:$.status,currentStock:$.currentStock,maxCapacity:$.maxCapacity}))});const q=S.reduce(($,F)=>$+(parseFloat(F.currentStock)||0),0),I=b.filter($=>$.fuelType===n.fuelType&&$.location?.toLowerCase()===T.toLowerCase()&&$.status==="active").reduce(($,F)=>$+(parseFloat(F.maxCapacity)||0),0);let O="available",U=`${q.toFixed(1)} gal disponibles`;q===0?(O="empty",U="Sin stock disponible"):q<I*.2&&(O="low",U=`${q.toFixed(1)} gal (stock bajo)`),w[T]={available:q,maxCapacity:I,status:O,message:U,percentage:I>0?q/I*100:0}}),f(w),g(!1),console.log("🔍 Stock validado por ubicación:",w)}})()},[n.fuelType,E,b]);const j=async N=>{c(!0),i("");try{await new Promise(w=>setTimeout(w,400)),e(E?"supplierName":"location",N),console.log("📍 Ubicación seleccionada:",N)}catch(w){console.error("Error al validar ubicación:",w),i("Error al validar la ubicación")}finally{c(!1)}};if(E){const N=y.filter(w=>w.status==="active");return a.jsx("div",{className:"wizard-step step-location",children:a.jsxs("div",{className:"step-content",children:[a.jsxs("div",{className:"step-question",children:[a.jsx("h3",{children:"🏪 ¿De qué proveedor viene el combustible?"}),a.jsx("p",{children:"Selecciona el proveedor de origen:"})]}),o&&a.jsxs("div",{className:"loading-overlay",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"🔄 Validando proveedor..."})]}),a.jsx("div",{className:"supplier-options",children:N.map(w=>a.jsxs("div",{className:`supplier-option ${n.supplierName===w.name?"selected":""} ${o?"disabled":""}`,onClick:()=>!o&&j(w.name),children:[a.jsx("div",{className:"supplier-icon",children:"🏪"}),a.jsxs("div",{className:"supplier-content",children:[a.jsx("h4",{children:w.name}),a.jsx("p",{className:"supplier-location",children:w.city}),w.phone&&a.jsxs("small",{className:"supplier-contact",children:["📞 ",w.phone]})]}),a.jsx("div",{className:"supplier-selector",children:n.supplierName===w.name&&a.jsx("span",{className:"check-icon",children:"✅"})})]},w.id))}),n.supplierName&&a.jsx("div",{className:"selection-confirmation",children:a.jsxs("div",{className:"confirmation-card",children:[a.jsx("span",{className:"confirmation-icon",children:"🏪"}),a.jsxs("div",{className:"confirmation-text",children:[a.jsx("strong",{children:"Proveedor:"})," ",n.supplierName,a.jsx("br",{}),a.jsx("small",{children:"Origen del combustible confirmado"})]})]})})]})})}return a.jsx("div",{className:"wizard-step step-location",children:a.jsxs("div",{className:"step-content",children:[a.jsxs("div",{className:"step-question",children:[a.jsx("h3",{children:"📍 ¿De qué ubicación sale el combustible?"}),a.jsx("p",{children:"Selecciona la ubicación de origen:"})]}),p&&a.jsxs("div",{className:"loading-overlay",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"🔍 Verificando stock disponible..."})]}),a.jsx("div",{className:"location-options",children:ji.map(N=>{const w=d[N],T=!w||w.status!=="empty";return a.jsxs("div",{className:`location-option ${n.location===N?"selected":""} 
                           ${w?.status||"unknown"} ${!T||o?"disabled":""}`,onClick:()=>T&&!o&&j(N),children:[a.jsx("div",{className:"location-icon",children:"📍"}),a.jsxs("div",{className:"location-content",children:[a.jsx("h4",{children:$s(N)}),w&&a.jsxs("div",{className:"stock-info",children:[a.jsx("p",{className:"stock-message",children:w.message}),w.available>0&&a.jsx("div",{className:"stock-bar-mini",children:a.jsx("div",{className:"stock-fill-mini",style:{width:`${Math.min(100,w.percentage)}%`}})})]}),p&&a.jsx("small",{className:"validating-text",children:"🔄 Verificando..."})]}),a.jsxs("div",{className:"location-selector",children:[w?.status==="empty"&&a.jsx("span",{className:"warning-icon",children:"🚫"}),w?.status==="low"&&a.jsx("span",{className:"warning-icon",children:"⚠️"}),w?.status==="available"&&a.jsx("span",{className:"success-icon",children:"✅"}),n.location===N&&a.jsx("span",{className:"check-icon",children:"✅"})]})]},N)})}),n.location&&d[n.location]&&a.jsx("div",{className:"selection-confirmation",children:a.jsxs("div",{className:"confirmation-card location-confirmation",children:[a.jsxs("div",{className:"confirmation-header",children:[a.jsx("span",{className:"confirmation-icon",children:"📍"}),a.jsxs("div",{className:"confirmation-text",children:[a.jsx("strong",{children:$s(n.location)}),a.jsx("br",{}),a.jsx("small",{children:"Ubicación de origen confirmada"})]})]}),a.jsxs("div",{className:"stock-confirmation",children:[a.jsxs("div",{className:"stock-detail",children:[a.jsx("span",{className:"stock-label",children:"📊 Stock disponible:"}),a.jsxs("span",{className:"stock-value",children:[d[n.location].available.toFixed(1)," gal"]})]}),a.jsx("div",{className:"capacity-bar",children:a.jsx("div",{className:"capacity-fill",style:{width:`${d[n.location].percentage}%`}})}),a.jsxs("small",{className:"capacity-text",children:[d[n.location].percentage.toFixed(1),"% de capacidad ocupada"]})]})]})})]})})},aV=({formData:n,updateFormData:e,systemData:t,setError:i})=>{const[o,c]=z.useState(!1),[d,f]=z.useState(null),[p,g]=z.useState(""),{inventory:y}=t,b=n.type===de.SALIDA||n.type===de.TRANSFERENCIA;z.useEffect(()=>{(async()=>{if(b&&n.fuelType&&n.location&&y.length>0){c(!0),await new Promise(R=>setTimeout(R,500));const w=y.filter(R=>R.fuelType===n.fuelType&&R.location?.toLowerCase()===n.location?.toLowerCase()&&R.status==="active").reduce((R,V)=>R+(parseFloat(V.currentStock)||0),0),T=y.filter(R=>R.fuelType===n.fuelType&&R.location?.toLowerCase()===n.location?.toLowerCase()&&R.status==="active").reduce((R,V)=>R+(parseFloat(V.maxCapacity)||0),0),S=parseFloat(n.quantity)||0,q=w-S,I=T>0?w/T*100:0;let O="available",U="✅",$="Stock Suficiente",F="Hay suficiente combustible disponible.";if(S>0&&(w<S?(O="critical",U="🚫",$="Stock Insuficiente",F=`Faltan ${(S-w).toFixed(2)} galones.`):q<w*.2?(O="warning",U="⚠️",$="Stock Quedará Bajo",F=`Después del movimiento quedarán ${q.toFixed(2)} galones.`):F=`Después del movimiento quedarán ${q.toFixed(2)} galones disponibles.`),f({available:w,required:S,remaining:Math.max(0,q),maxCapacity:T,capacityPercentage:I,status:O,icon:U,title:$,message:F,isValid:w>=S}),S>0&&b){const R={type:n.type===de.SALIDA?"outbound":"transfer",fuelType:n.fuelType,quantity:n.quantity,sourceLocation:n.location},V=vL(R,y);V.isValid?V.warning?g(`⚠️ ${V.warning}`):g(""):g(`🚫 ${V.error}`)}else b||g("");c(!1)}})()},[n.quantity,n.fuelType,n.location,n.type,b,y]);const E=N=>{const w=parseFloat(N);(N===""||!isNaN(w)&&w>=0)&&(e("quantity",N),i(""))},j=()=>{if(!d||!d.available)return[];const N=d.available;return[{label:"25%",value:(N*.25).toFixed(1)},{label:"50%",value:(N*.5).toFixed(1)},{label:"75%",value:(N*.75).toFixed(1)},{label:"Todo",value:N.toFixed(1)}]};return a.jsx("div",{className:"wizard-step step-quantity",children:a.jsxs("div",{className:"step-content",children:[a.jsxs("div",{className:"step-question",children:[a.jsx("h3",{children:"📊 ¿Cuántos galones necesitas?"}),a.jsx("p",{children:"Especifica la cantidad de combustible:"})]}),a.jsxs("div",{className:"quantity-input-section",children:[a.jsxs("div",{className:"quantity-input-wrapper",children:[a.jsx("label",{htmlFor:"quantity",children:"Cantidad (galones)"}),a.jsxs("div",{className:"quantity-input-container",children:[a.jsx("input",{id:"quantity",type:"number",step:"0.1",min:"0",value:n.quantity,onChange:N=>E(N.target.value),placeholder:"0.0",className:`quantity-input ${p?"error":""}`}),a.jsx("span",{className:"quantity-unit",children:"gal"})]})]}),d&&d.available>0&&a.jsxs("div",{className:"quantity-suggestions",children:[a.jsx("label",{children:"Cantidades sugeridas:"}),a.jsx("div",{className:"suggestion-buttons",children:j().map((N,w)=>a.jsxs("button",{type:"button",className:"suggestion-btn",onClick:()=>E(N.value),children:[N.label,a.jsx("br",{}),a.jsxs("small",{children:[N.value," gal"]})]},w))})]})]}),o&&a.jsxs("div",{className:"calculating-indicator",children:[a.jsx("div",{className:"loading-spinner small"}),a.jsx("span",{children:"⚙️ Calculando disponibilidad..."})]}),d&&b&&!o&&a.jsxs("div",{className:`stock-info-container ${d.status}`,children:[a.jsxs("div",{className:"stock-info-header",children:[a.jsx("div",{className:"stock-info-icon",children:d.icon}),a.jsx("h4",{className:"stock-info-title",children:d.title})]}),a.jsxs("div",{className:"stock-info-details",children:[a.jsxs("div",{className:"stock-detail-item",children:[a.jsx("span",{className:"stock-detail-label",children:"Stock Disponible"}),a.jsxs("span",{className:"stock-detail-value",children:[d.available.toFixed(2)," gal"]})]}),d.required>0&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"stock-detail-item",children:[a.jsx("span",{className:"stock-detail-label",children:"Cantidad Solicitada"}),a.jsxs("span",{className:"stock-detail-value",children:[d.required.toFixed(2)," gal"]})]}),a.jsxs("div",{className:"stock-detail-item",children:[a.jsx("span",{className:"stock-detail-label",children:"Stock Restante"}),a.jsxs("span",{className:"stock-detail-value",children:[d.remaining.toFixed(2)," gal"]})]})]})]}),d.maxCapacity>0&&a.jsxs("div",{className:"stock-bar-container",children:[a.jsxs("div",{className:"stock-bar",children:[a.jsx("div",{className:"stock-bar-current",style:{width:`${Math.min(100,d.capacityPercentage)}%`}}),d.required>0&&d.isValid&&a.jsx("div",{className:"stock-bar-after",style:{width:`${Math.min(100,d.remaining/d.maxCapacity*100)}%`}})]}),a.jsxs("div",{className:"stock-bar-labels",children:[a.jsxs("span",{children:["Actual: ",d.capacityPercentage.toFixed(1),"%"]}),d.required>0&&d.isValid&&a.jsxs("span",{children:["Después: ",(d.remaining/d.maxCapacity*100).toFixed(1),"%"]})]})]}),a.jsx("div",{className:"stock-info-message",children:d.message})]}),p&&a.jsx("div",{className:"validation-warning",children:p}),!b&&n.quantity&&parseFloat(n.quantity)>0&&a.jsx("div",{className:"selection-confirmation",children:a.jsxs("div",{className:"confirmation-card",children:[a.jsx("span",{className:"confirmation-icon",children:"📊"}),a.jsxs("div",{className:"confirmation-text",children:[a.jsx("strong",{children:"Cantidad:"})," ",parseFloat(n.quantity).toFixed(2)," galones",a.jsx("br",{}),a.jsxs("small",{children:["Se añadirá al inventario de ",n.destinationLocation||"ubicación no especificada"]})]})]})}),b&&n.quantity&&parseFloat(n.quantity)>0&&d&&d.isValid&&a.jsx("div",{className:"selection-confirmation",children:a.jsxs("div",{className:"confirmation-card",children:[a.jsx("span",{className:"confirmation-icon",children:"🔥"}),a.jsxs("div",{className:"confirmation-text",children:[a.jsx("strong",{children:"Cantidad:"})," ",parseFloat(n.quantity).toFixed(2)," galones",a.jsx("br",{}),a.jsxs("small",{children:["Se restará del inventario de ",n.location]})]})]})})]})})},iV=({formData:n,updateFormData:e,systemData:t,setError:i})=>{const[o,c]=z.useState(!1),[d,f]=z.useState(null),[p,g]=z.useState(!1),[y,b]=z.useState(""),{vehicles:E}=t;z.useEffect(()=>{if(n.vehicleId&&E.length>0){const T=E.find(q=>q.vehicleId===n.vehicleId);f(T);const S=j(T);g(S)}},[n.vehicleId,E]);const j=T=>{if(!T)return!1;const S=T.vehicleId?.toUpperCase(),q=S&&(S.includes("TR1")||S.includes("TR2")||S.includes("TR3")||S==="TR1"||S==="TR2"||S==="TR3"),I=T.category==="tractor"||T.type?.toLowerCase().includes("tractor");return q||I},N=async T=>{c(!0),i("");try{await new Promise(q=>setTimeout(q,600)),e("vehicleId",T.vehicleId),f(T);const S=j(T);g(S),!S&&n.currentHours&&e("currentHours",""),console.log("🚜 [Step5] Vehículo seleccionado:",T.vehicleId,"Es tractor:",S),console.log("🔍 [Step5] FormData después de selección:",{vehicleId:T.vehicleId,type:n.type,fuelType:n.fuelType,location:n.location})}catch(S){console.error("Error al validar vehículo:",S),i("Error al validar el vehículo")}finally{c(!1)}},w=T=>{const S=parseFloat(T);(T===""||!isNaN(S)&&S>=0)&&(e("currentHours",T),d?.currentHours&&S<parseFloat(d.currentHours)?b(`La lectura debe ser mayor a la anterior: ${d.currentHours} hrs`):b(""))};return n.type!==de.SALIDA?null:E.length===0?a.jsx("div",{className:"wizard-step step-vehicle",children:a.jsx("div",{className:"step-content",children:a.jsxs("div",{className:"loading-state",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"🔄 Cargando vehículos disponibles..."})]})})}):a.jsx("div",{className:"wizard-step step-vehicle",children:a.jsxs("div",{className:"step-content",children:[a.jsxs("div",{className:"step-question",children:[a.jsx("h3",{children:"🚜 ¿A qué vehículo/equipo va el combustible?"}),a.jsx("p",{children:"Selecciona el vehículo que recibirá el combustible:"})]}),o&&a.jsxs("div",{className:"loading-overlay",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"🔄 Validando vehículo..."})]}),a.jsx("div",{className:"vehicle-options",children:E.map(T=>{const S=j(T);return a.jsxs("div",{className:`vehicle-option ${n.vehicleId===T.vehicleId?"selected":""} 
                           ${S?"tractor":""} ${o?"disabled":""}`,onClick:()=>!o&&N(T),children:[a.jsx("div",{className:"vehicle-icon",children:S?"🚜":"🚚"}),a.jsxs("div",{className:"vehicle-content",children:[a.jsxs("h4",{children:[T.vehicleId," - ",T.name]}),a.jsx("p",{className:"vehicle-type",children:T.type}),T.currentHours&&S&&a.jsxs("small",{className:"vehicle-hours",children:["⏱️ Horómetro: ",T.currentHours," hrs"]}),T.status&&a.jsx("span",{className:`vehicle-status ${T.status}`,children:T.status==="active"?"✅ Activo":"⚠️ "+T.status})]}),a.jsxs("div",{className:"vehicle-selector",children:[S&&a.jsx("span",{className:"tractor-badge",children:"TRACTOR"}),n.vehicleId===T.vehicleId&&a.jsx("span",{className:"check-icon",children:"✅"})]})]},T.id)})}),p&&d&&a.jsxs("div",{className:"hour-meter-section",children:[a.jsxs("div",{className:"hour-meter-header",children:[a.jsx("h4",{children:"⏱️ Lectura del Horómetro"}),a.jsx("p",{children:"Los tractores requieren registro de horómetro:"})]}),a.jsxs("div",{className:"hour-meter-input-wrapper",children:[a.jsx("label",{htmlFor:"currentHours",children:"Horas actuales *"}),a.jsxs("div",{className:"hour-meter-input-container",children:[a.jsx("input",{id:"currentHours",type:"number",step:"0.1",min:"0",value:n.currentHours,onChange:T=>w(T.target.value),placeholder:"0.0",className:`hour-meter-input ${y?"error":""}`}),a.jsx("span",{className:"hour-meter-unit",children:"hrs"})]}),d.currentHours&&a.jsxs("small",{className:"hour-meter-hint",children:["💡 Última lectura: ",d.currentHours," horas"]}),y&&a.jsx("div",{className:"field-error",children:y})]})]}),d&&n.vehicleId&&a.jsx("div",{className:"selection-confirmation",children:a.jsxs("div",{className:"confirmation-card vehicle-confirmation",children:[a.jsxs("div",{className:"confirmation-header",children:[a.jsx("span",{className:"confirmation-icon",children:j(d)?"🚜":"🚚"}),a.jsxs("div",{className:"confirmation-text",children:[a.jsxs("strong",{children:[d.vehicleId," - ",d.name]}),a.jsx("br",{}),a.jsx("small",{children:d.type})]})]}),a.jsxs("div",{className:"vehicle-details",children:[a.jsxs("div",{className:"detail-item",children:[a.jsx("span",{className:"detail-label",children:"📋 Tipo:"}),a.jsx("span",{className:"detail-value",children:d.type})]}),d.category&&a.jsxs("div",{className:"detail-item",children:[a.jsx("span",{className:"detail-label",children:"🏷️ Categoría:"}),a.jsx("span",{className:"detail-value",children:d.category})]}),p&&n.currentHours&&a.jsxs("div",{className:"detail-item",children:[a.jsx("span",{className:"detail-label",children:"⏱️ Horómetro:"}),a.jsxs("span",{className:"detail-value",children:[n.currentHours," hrs"]})]})]}),j(d)&&!n.currentHours&&a.jsx("div",{className:"warning-message",children:"⚠️ Se requiere lectura del horómetro para tractores"})]})})]})})},$_=({formData:n,updateFormData:e,systemData:t,setError:i,isEntryDestination:o=!1})=>{const[c,d]=z.useState(!1),[f,p]=z.useState({}),[g,y]=z.useState(!1),{inventory:b}=t;z.useEffect(()=>{(async()=>{if(n.fuelType&&n.quantity&&b.length>0&&!o){y(!0),await new Promise(S=>setTimeout(S,700));const w=parseFloat(n.quantity)||0,T={};ji.filter(S=>o?!0:S!==n.location).forEach(S=>{const q=b.filter(P=>P.fuelType===n.fuelType&&P.location?.toLowerCase()===S.toLowerCase()&&P.status==="active").reduce((P,C)=>P+(parseFloat(C.currentStock)||0),0),I=b.filter(P=>P.fuelType===n.fuelType&&P.location?.toLowerCase()===S.toLowerCase()&&P.status==="active").reduce((P,C)=>P+(parseFloat(C.maxCapacity)||0),0),O=I-q,U=q+w,$=I>0?U/I*100:0;let F="available",R=`Capacidad: ${O.toFixed(1)} gal libres`,V=O>=w;I===0?(F="no_capacity",R="Sin tanques configurados",V=!1):O<w?(F="insufficient",R=`Insuficiente: faltan ${(w-O).toFixed(1)} gal`,V=!1):$>90&&(F="warning",R=`Quedará al ${$.toFixed(1)}% (casi lleno)`),T[S]={currentStock:q,maxCapacity:I,availableCapacity:O,afterTransfer:U,occupancyAfter:$,status:F,message:R,canAcceptTransfer:V}}),p(T),y(!1),console.log("🔍 Capacidad validada por destino:",T)}})()},[n.fuelType,n.quantity,n.location,b,o]);const E=async N=>{const w=f[N];if(!o&&!w?.canAcceptTransfer){i("Esta ubicación no puede recibir la cantidad solicitada");return}d(!0),i("");try{await new Promise(T=>setTimeout(T,500)),e("destinationLocation",N),console.log("🎯 Destino seleccionado:",N)}catch(T){console.error("Error al validar destino:",T),i("Error al validar el destino")}finally{d(!1)}};if(!o&&n.type!==de.TRANSFERENCIA)return null;const j=o?yL:ji.filter(N=>N!==n.location);return a.jsx("div",{className:"wizard-step step-destination",children:a.jsxs("div",{className:"step-content",children:[a.jsxs("div",{className:"step-question",children:[a.jsxs("h3",{children:["🎯 ",o?"¿A qué ubicación llegará el combustible?":"¿Hacia qué ubicación se transfiere?"]}),a.jsx("p",{children:"Selecciona la ubicación de destino:"})]}),g&&a.jsxs("div",{className:"loading-overlay",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"🔍 Verificando capacidad disponible..."})]}),a.jsx("div",{className:"destination-options",children:j.map(N=>{const w=f[N],T=!w||w.canAcceptTransfer;return a.jsxs("div",{className:`destination-option ${n.destinationLocation===N?"selected":""} 
                           ${w?.status||"unknown"} ${!T||c?"disabled":""}`,onClick:()=>T&&!c&&E(N),children:[a.jsx("div",{className:"destination-icon",children:"🎯"}),a.jsxs("div",{className:"destination-content",children:[a.jsx("h4",{children:$s(N)}),w&&a.jsxs("div",{className:"capacity-info",children:[a.jsx("p",{className:"capacity-message",children:w.message}),w.maxCapacity>0&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"capacity-bar-mini",children:[a.jsx("div",{className:"capacity-current-mini",style:{width:`${Math.min(100,w.currentStock/w.maxCapacity*100)}%`}}),w.canAcceptTransfer&&a.jsx("div",{className:"capacity-after-mini",style:{width:`${Math.min(100,w.occupancyAfter)}%`,left:`${Math.min(100,w.currentStock/w.maxCapacity*100)}%`}})]}),a.jsxs("small",{className:"capacity-details",children:["Actual: ",w.currentStock.toFixed(1),"/",w.maxCapacity.toFixed(1)," gal"]})]})]}),g&&a.jsx("small",{className:"validating-text",children:"🔄 Verificando capacidad..."})]}),a.jsxs("div",{className:"destination-selector",children:[w?.status==="insufficient"&&a.jsx("span",{className:"warning-icon",children:"🚫"}),w?.status==="no_capacity"&&a.jsx("span",{className:"warning-icon",children:"❌"}),w?.status==="warning"&&a.jsx("span",{className:"warning-icon",children:"⚠️"}),w?.status==="available"&&a.jsx("span",{className:"success-icon",children:"✅"}),n.destinationLocation===N&&a.jsx("span",{className:"check-icon",children:"✅"})]})]},N)})}),n.location&&n.quantity&&a.jsx("div",{className:"transfer-summary",children:a.jsxs("div",{className:"transfer-flow",children:[a.jsxs("div",{className:"transfer-origin",children:[a.jsx("span",{className:"transfer-icon",children:"📍"}),a.jsxs("div",{className:"transfer-info",children:[a.jsx("strong",{children:$s(n.location)}),a.jsx("small",{children:"Origen"})]})]}),a.jsxs("div",{className:"transfer-arrow",children:[a.jsx("span",{children:"→"}),a.jsxs("small",{children:[parseFloat(n.quantity).toFixed(1)," gal"]})]}),a.jsxs("div",{className:"transfer-destination",children:[a.jsx("span",{className:"transfer-icon",children:"🎯"}),a.jsxs("div",{className:"transfer-info",children:[a.jsx("strong",{children:n.destinationLocation?$s(n.destinationLocation):"Seleccionar destino"}),a.jsx("small",{children:"Destino"})]})]})]})}),n.destinationLocation&&f[n.destinationLocation]&&a.jsx("div",{className:"selection-confirmation",children:a.jsxs("div",{className:"confirmation-card destination-confirmation",children:[a.jsxs("div",{className:"confirmation-header",children:[a.jsx("span",{className:"confirmation-icon",children:"🎯"}),a.jsxs("div",{className:"confirmation-text",children:[a.jsx("strong",{children:$s(n.destinationLocation)}),a.jsx("br",{}),a.jsx("small",{children:"Ubicación de destino confirmada"})]})]}),a.jsxs("div",{className:"capacity-confirmation",children:[a.jsxs("div",{className:"capacity-detail",children:[a.jsx("span",{className:"capacity-label",children:"📊 Después de transferir:"}),a.jsxs("span",{className:"capacity-value",children:[f[n.destinationLocation].afterTransfer.toFixed(1)," gal"]})]}),a.jsx("div",{className:"occupancy-bar",children:a.jsx("div",{className:"occupancy-fill",style:{width:`${f[n.destinationLocation].occupancyAfter}%`}})}),a.jsxs("small",{className:"occupancy-text",children:[f[n.destinationLocation].occupancyAfter.toFixed(1),"% de capacidad ocupada"]})]})]})})]})})},rV=({formData:n,updateFormData:e,systemData:t,error:i,setError:o})=>{const[c,d]=z.useState(!1),[f,p]=z.useState(!1),{products:g}=t;z.useEffect(()=>{if(n.fuelType&&!n.unitPrice&&g.length>0){const S=g.find(q=>q.name===n.fuelType||q.displayName===n.fuelType);S&&S.defaultPrice&&(e("unitPrice",S.defaultPrice.toString()),p(!0))}},[n.fuelType,n.unitPrice,g,e]);const y=async S=>{const q=parseFloat(S);(S===""||!isNaN(q)&&q>=0)&&(d(!0),await new Promise(I=>setTimeout(I,300)),e("unitPrice",S),p(S!==""),o(""),d(!1))},b=S=>{e("effectiveDate",S)},E=S=>{e("reference",S)},j=S=>{e("description",S)},N=(parseFloat(n.quantity)||0)*(parseFloat(n.unitPrice)||0),w=S=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(S),T=()=>g.find(S=>S.name===n.fuelType||S.displayName===n.fuelType);return a.jsx("div",{className:"wizard-step step-details",children:a.jsxs("div",{className:"step-content",children:[a.jsxs("div",{className:"step-question",children:[a.jsx("h3",{children:"📋 Información adicional del movimiento"}),a.jsx("p",{children:"Completa los detalles restantes:"})]}),a.jsxs("div",{className:"detail-section",children:[a.jsx("div",{className:"detail-header",children:a.jsx("h4",{children:"💰 Precio Unitario"})}),a.jsxs("div",{className:"price-input-wrapper",children:[a.jsx("label",{htmlFor:"unitPrice",children:"Precio por galón (COP) *"}),a.jsxs("div",{className:"price-input-container",children:[a.jsx("span",{className:"currency-symbol",children:"$"}),a.jsx("input",{id:"unitPrice",type:"number",step:"1",min:"0",value:n.unitPrice,onChange:S=>y(S.target.value),placeholder:"0",className:`price-input ${i?"error":""}`}),a.jsx("span",{className:"currency-unit",children:"COP"})]}),c&&a.jsxs("div",{className:"calculating-price",children:[a.jsx("div",{className:"loading-spinner small"}),a.jsx("span",{children:"💰 Validando precio..."})]}),T()?.defaultPrice&&a.jsxs("small",{className:"price-suggestion",children:["💡 Precio sugerido: $",T().defaultPrice.toLocaleString("es-CO")," COP"]})]})]}),n.quantity&&n.unitPrice&&f&&a.jsx("div",{className:"total-value-section",children:a.jsxs("div",{className:"total-value-card",children:[a.jsx("div",{className:"total-icon",children:"📊"}),a.jsxs("div",{className:"total-content",children:[a.jsx("h4",{children:"Valor Total Calculado"}),a.jsxs("div",{className:"total-calculation",children:[a.jsxs("span",{className:"calculation-details",children:[parseFloat(n.quantity).toFixed(2)," gal × $",parseFloat(n.unitPrice).toLocaleString("es-CO")," COP"]}),a.jsx("div",{className:"total-amount",children:w(N)})]})]})]})}),a.jsxs("div",{className:"detail-section",children:[a.jsx("div",{className:"detail-header",children:a.jsx("h4",{children:"📅 Fecha y Hora Efectiva"})}),a.jsxs("div",{className:"date-input-wrapper",children:[a.jsx("label",{htmlFor:"effectiveDate",children:"¿Cuándo ocurrió este movimiento?"}),a.jsx("input",{id:"effectiveDate",type:"datetime-local",value:n.effectiveDate,onChange:S=>b(S.target.value),className:"date-input"}),a.jsx("small",{className:"date-hint",children:"💡 Por defecto se usa la fecha y hora actual"})]})]}),a.jsxs("div",{className:"detail-section",children:[a.jsx("div",{className:"detail-header",children:a.jsx("h4",{children:"📄 Referencia"})}),a.jsxs("div",{className:"reference-input-wrapper",children:[a.jsx("label",{htmlFor:"reference",children:"Número de factura, orden o referencia (opcional)"}),a.jsx("input",{id:"reference",type:"text",value:n.reference,onChange:S=>E(S.target.value),placeholder:"Ej: Factura #12345, Orden #ORD-001",className:"reference-input",maxLength:"100"}),a.jsx("small",{className:"reference-hint",children:"📝 Ayuda a identificar el movimiento en reportes"})]})]}),a.jsxs("div",{className:"detail-section",children:[a.jsx("div",{className:"detail-header",children:a.jsx("h4",{children:"📝 Descripción"})}),a.jsxs("div",{className:"description-input-wrapper",children:[a.jsx("label",{htmlFor:"description",children:"Detalles adicionales del movimiento (opcional)"}),a.jsx("textarea",{id:"description",value:n.description,onChange:S=>j(S.target.value),placeholder:"Ej: Combustible para operación en sector norte, mantenimiento programado, etc.",className:"description-input",rows:"3",maxLength:"500"}),a.jsxs("div",{className:"description-counter",children:[n.description.length,"/500 caracteres"]})]})]}),f&&a.jsx("div",{className:"details-summary",children:a.jsxs("div",{className:"summary-card",children:[a.jsx("h4",{children:"📋 Resumen de Detalles"}),a.jsxs("div",{className:"summary-items",children:[a.jsxs("div",{className:"summary-item",children:[a.jsx("span",{className:"summary-label",children:"💰 Precio unitario:"}),a.jsxs("span",{className:"summary-value",children:["$",parseFloat(n.unitPrice).toLocaleString("es-CO")," COP/gal"]})]}),N>0&&a.jsxs("div",{className:"summary-item",children:[a.jsx("span",{className:"summary-label",children:"📊 Valor total:"}),a.jsx("span",{className:"summary-value total",children:w(N)})]}),a.jsxs("div",{className:"summary-item",children:[a.jsx("span",{className:"summary-label",children:"📅 Fecha:"}),a.jsx("span",{className:"summary-value",children:new Date(n.effectiveDate).toLocaleString("es-CO")})]}),n.reference&&a.jsxs("div",{className:"summary-item",children:[a.jsx("span",{className:"summary-label",children:"📄 Referencia:"}),a.jsx("span",{className:"summary-value",children:n.reference})]}),n.description&&a.jsxs("div",{className:"summary-item",children:[a.jsx("span",{className:"summary-label",children:"📝 Descripción:"}),a.jsx("span",{className:"summary-value description",children:n.description.length>50?n.description.substring(0,50)+"...":n.description})]})]})]})})]})})},oV=({formData:n,systemData:e,onSubmit:t,isLoading:i,error:o,setError:c})=>{const[d,f]=z.useState(!1),[p,g]=z.useState(""),{vehicles:y,products:b,suppliers:E}=e,j=R=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(R),N=()=>({[de.ENTRADA]:{icon:"📥",title:"Entrada",color:"entrada"},[de.SALIDA]:{icon:"📤",title:"Salida",color:"salida"},[de.TRANSFERENCIA]:{icon:"🔄",title:"Transferencia",color:"transferencia"},[de.AJUSTE]:{icon:"⚖️",title:"Ajuste",color:"ajuste"}})[n.type]||{icon:"❓",title:"Desconocido",color:"unknown"},w=()=>b.find(R=>R.name===n.fuelType||R.displayName===n.fuelType),T=()=>y.find(R=>R.vehicleId===n.vehicleId),S=()=>{const R=n.type===de.ENTRADA?n.supplierName:n.location;return E.find(V=>V.name===R)},q=(parseFloat(n.quantity)||0)*(parseFloat(n.unitPrice)||0),I=N(),O=w(),U=T(),$=S(),F=()=>{if(!d){c("Debes confirmar que la información es correcta");return}const R={...n,additionalComments:p.trim()};t(R)};return a.jsx("div",{className:"wizard-step step-summary",children:a.jsxs("div",{className:"step-content",children:[a.jsxs("div",{className:"step-question",children:[a.jsx("h3",{children:"✅ Confirma tu movimiento"}),a.jsx("p",{children:"Revisa toda la información antes de crear el movimiento:"})]}),a.jsxs("div",{className:"summary-main",children:[a.jsxs("div",{className:`summary-header ${I.color}`,children:[a.jsx("div",{className:"summary-icon",children:I.icon}),a.jsxs("div",{className:"summary-title",children:[a.jsxs("h4",{children:[I.title," de Combustible"]}),a.jsxs("p",{children:[parseFloat(n.quantity).toFixed(2)," galones de ",O?.displayName||n.fuelType]})]}),a.jsx("div",{className:"summary-value",children:j(q)})]}),a.jsxs("div",{className:"summary-details",children:[a.jsxs("div",{className:"detail-row",children:[a.jsx("div",{className:"detail-icon",children:"⛽"}),a.jsxs("div",{className:"detail-content",children:[a.jsx("span",{className:"detail-label",children:"Combustible:"}),a.jsxs("span",{className:"detail-value",children:[O?.icon," ",O?.displayName||n.fuelType]})]})]}),a.jsxs("div",{className:"detail-row",children:[a.jsx("div",{className:"detail-icon",children:"📊"}),a.jsxs("div",{className:"detail-content",children:[a.jsx("span",{className:"detail-label",children:"Cantidad:"}),a.jsxs("span",{className:"detail-value",children:[parseFloat(n.quantity).toFixed(2)," gal × $",parseFloat(n.unitPrice).toLocaleString("es-CO")," COP"]})]})]}),a.jsxs("div",{className:"detail-row",children:[a.jsx("div",{className:"detail-icon",children:n.type===de.ENTRADA?"🏪":"📍"}),a.jsxs("div",{className:"detail-content",children:[a.jsx("span",{className:"detail-label",children:n.type===de.ENTRADA?"Proveedor:":"Origen:"}),a.jsx("span",{className:"detail-value",children:n.type===de.ENTRADA?$?`${$.name} - ${$.city}`:n.location:$s(n.location)})]})]}),n.type===de.SALIDA&&U&&a.jsxs("div",{className:"detail-row",children:[a.jsx("div",{className:"detail-icon",children:"🚜"}),a.jsxs("div",{className:"detail-content",children:[a.jsx("span",{className:"detail-label",children:"Vehículo:"}),a.jsxs("span",{className:"detail-value",children:[U.vehicleId," - ",U.name," (",U.type,")"]})]})]}),n.currentHours&&a.jsxs("div",{className:"detail-row",children:[a.jsx("div",{className:"detail-icon",children:"⏱️"}),a.jsxs("div",{className:"detail-content",children:[a.jsx("span",{className:"detail-label",children:"Horómetro:"}),a.jsxs("span",{className:"detail-value",children:[n.currentHours," horas"]})]})]}),n.type===de.TRANSFERENCIA&&n.destinationLocation&&a.jsxs("div",{className:"detail-row",children:[a.jsx("div",{className:"detail-icon",children:"🎯"}),a.jsxs("div",{className:"detail-content",children:[a.jsx("span",{className:"detail-label",children:"Destino:"}),a.jsx("span",{className:"detail-value",children:$s(n.destinationLocation)})]})]}),a.jsxs("div",{className:"detail-row",children:[a.jsx("div",{className:"detail-icon",children:"📅"}),a.jsxs("div",{className:"detail-content",children:[a.jsx("span",{className:"detail-label",children:"Fecha:"}),a.jsx("span",{className:"detail-value",children:new Date(n.effectiveDate).toLocaleString("es-CO")})]})]}),n.reference&&a.jsxs("div",{className:"detail-row",children:[a.jsx("div",{className:"detail-icon",children:"📄"}),a.jsxs("div",{className:"detail-content",children:[a.jsx("span",{className:"detail-label",children:"Referencia:"}),a.jsx("span",{className:"detail-value",children:n.reference})]})]}),n.description&&a.jsxs("div",{className:"detail-row",children:[a.jsx("div",{className:"detail-icon",children:"📝"}),a.jsxs("div",{className:"detail-content",children:[a.jsx("span",{className:"detail-label",children:"Descripción:"}),a.jsx("span",{className:"detail-value description",children:n.description})]})]})]})]}),n.type===de.TRANSFERENCIA&&a.jsxs("div",{className:"transfer-flow-summary",children:[a.jsx("div",{className:"flow-header",children:"🔄 Flujo de Transferencia"}),a.jsxs("div",{className:"flow-diagram",children:[a.jsxs("div",{className:"flow-location origin",children:[a.jsx("div",{className:"flow-icon",children:"📍"}),a.jsxs("div",{className:"flow-text",children:[a.jsx("strong",{children:$s(n.location)}),a.jsx("small",{children:"Origen"})]})]}),a.jsxs("div",{className:"flow-arrow",children:[a.jsx("div",{className:"arrow-line"}),a.jsx("div",{className:"arrow-head",children:"→"}),a.jsxs("div",{className:"flow-quantity",children:[parseFloat(n.quantity).toFixed(1)," gal"]})]}),a.jsxs("div",{className:"flow-location destination",children:[a.jsx("div",{className:"flow-icon",children:"🎯"}),a.jsxs("div",{className:"flow-text",children:[a.jsx("strong",{children:$s(n.destinationLocation)}),a.jsx("small",{children:"Destino"})]})]})]})]}),a.jsxs("div",{className:"additional-comments-section",children:[a.jsxs("div",{className:"comments-header",children:[a.jsx("h4",{children:"💬 Comentarios Adicionales"}),a.jsx("small",{children:"Opcional - Agrega información adicional sobre este movimiento"})]}),a.jsx("textarea",{className:"comments-textarea",value:p,onChange:R=>g(R.target.value),placeholder:"Ejemplo: Combustible entregado por transporte especial, requiere almacenamiento prioritario, etc.",rows:3,maxLength:500}),a.jsxs("div",{className:"comments-counter",children:[p.length,"/500 caracteres"]})]}),a.jsxs("div",{className:"confirmation-section",children:[a.jsxs("div",{className:"confirmation-checkbox",children:[a.jsx("input",{type:"checkbox",id:"confirmMovement",checked:d,onChange:R=>f(R.target.checked)}),a.jsx("label",{htmlFor:"confirmMovement",children:"✅ Confirmo que toda la información es correcta y autorizo crear este movimiento"})]}),a.jsx("div",{className:"confirmation-warning",children:"⚠️ Una vez creado, el movimiento actualizará automáticamente el inventario"})]}),o&&a.jsxs("div",{className:"summary-error",children:[a.jsx("span",{className:"error-icon",children:"⚠️"}),o]}),a.jsxs("div",{className:"final-actions",children:[a.jsx("button",{type:"button",className:`btn-final-confirm ${!d||i?"disabled":""}`,onClick:F,disabled:!d||i,children:i?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"loading-spinner small"}),"💾 Creando movimiento..."]}):a.jsx(a.Fragment,{children:"🚀 Crear Movimiento"})}),a.jsx("small",{className:"final-note",children:"El movimiento se guardará inmediatamente y actualizará el inventario"})]})]})})},lV=({isOpen:n,onClose:e,onSuccess:t})=>{const{inventory:i,vehicles:o,suppliers:c}=Qn(),[d,f]=z.useState(1),[p,g]=z.useState(!1),[y,b]=z.useState(""),[E,j]=z.useState({type:"",fuelType:"",quantity:"",unitPrice:"",location:"",supplierName:"",vehicleId:"",destinationLocation:"",description:"",reference:"",effectiveDate:new Date().toISOString().slice(0,16),currentHours:""}),[N,w]=z.useState({vehicles:[],inventory:[],suppliers:[],products:[],loadingData:!0}),T={1:{title:"Tipo de Movimiento",description:"¿Qué operación realizarás?"},2:{title:"Combustible",description:"¿Qué producto vas a mover?"},3:{title:"Origen/Proveedor",description:E.type===de.ENTRADA?"¿De qué proveedor?":"¿De dónde proviene?"},"3b":{title:"Ubicación Destino",description:"¿A dónde llegará?"},4:{title:"Cantidad",description:"¿Cuánto necesitas?"},5:{title:"Vehículo/Equipo",description:"¿A qué destino?"},6:{title:"Ubicación Destino",description:"¿Hacia dónde va?"},7:{title:"Detalles",description:"Información adicional"},8:{title:"Confirmación",description:"Revisa y confirma"}};z.useEffect(()=>((async()=>{if(n){document.body.style.overflow="hidden",w(le=>({...le,loadingData:!0}));try{console.log("🔄 Cargando productos y sincronizando datos en tiempo real...");const le=await JL();w({vehicles:o||[],inventory:i||[],suppliers:c||[],products:le||[],loadingData:!1}),console.log("✅ Datos sincronizados para wizard - inventario en tiempo real:",i?.length||0,"items")}catch(le){console.error("❌ Error al cargar datos del sistema:",le),w(ve=>({...ve,loadingData:!1}))}}else document.body.style.overflow="unset"})(),()=>{document.body.style.overflow="unset"}),[n,i,o,c]);const S=()=>{if(!E.type)return 8;let D;return E.type===de.TRANSFERENCIA?D=8:E.type===de.SALIDA||E.type===de.ENTRADA?D=7:D=6,console.log("🔍 [TOTAL STEPS]",{type:E.type,totalSteps:D,currentStep:d}),D},q=(D,le)=>{j(ve=>({...ve,[D]:le})),b("")},I=()=>{let D=!1;switch(d){case 1:D=!!E.type;break;case 2:D=!!E.fuelType,console.log("🔍 [STEP 2 VALIDATION]",{fuelType:E.fuelType,isValid:D,formData:E});break;case 3:E.type===de.ENTRADA?D=!!E.supplierName:D=!!E.location;break;case"3b":D=!!E.destinationLocation;break;case 4:D=E.quantity&&parseFloat(E.quantity)>0,console.log("🔍 [DEBUG Step 4] Validación cantidad:",{step:d,quantity:E.quantity,parsedQuantity:parseFloat(E.quantity),isQuantityValid:!!E.quantity,isParsedValid:parseFloat(E.quantity)>0,finalValidation:D,formData:E});break;case 5:E.type===de.SALIDA?D=!!E.vehicleId:D=!0;break;case 6:E.type===de.TRANSFERENCIA?D=!!E.destinationLocation:D=!0;break;case 7:D=!!E.unitPrice&&parseFloat(E.unitPrice)>=0;break;case 8:D=!0;break;default:D=!1}return console.log("🔍 [DEBUG General] validateCurrentStep:",{currentStep:d,isValid:D,formDataKeys:Object.keys(E),formData:E}),D},O=z.useMemo(()=>I(),[d,E,de]),U=()=>{const D=I();if(console.log("🔍 [DEBUG nextStep] Intentando navegar:",{currentStep:d,isValid:D,formData:E,type:E.type}),D){const le=S();let ve=d+1;d===3&&E.type===de.ENTRADA?ve="3b":d==="3b"?ve=4:d===4&&E.type!==de.SALIDA?E.type===de.TRANSFERENCIA?ve=6:(E.type,de.ENTRADA,ve=7):d===5&&E.type!==de.TRANSFERENCIA&&(ve=7),console.log("🔍 [DEBUG Navigation] Navegando:",{from:d,to:ve,totalSteps:le}),(me=>E.type===de.ENTRADA?{1:1,2:2,3:3,"3b":4,4:5,7:6,8:7}[me]||me:E.type===de.SALIDA?{1:1,2:2,3:3,4:4,5:5,7:6,8:7}[me]||me:{1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8}[me]||me)(ve)<=le&&f(ve)}else console.log("❌ [DEBUG] Validación falló, no se puede navegar"),b("Por favor completa este paso antes de continuar")},$=()=>{if(d>1&&d!=="3b"){let D=d-1;d===4&&E.type===de.ENTRADA?D="3b":(d===7&&E.type===de.ENTRADA||d===7&&E.type!==de.TRANSFERENCIA&&E.type!==de.SALIDA||d===6&&E.type!==de.SALIDA)&&(D=4),f(D)}else d==="3b"&&f(3)},F=async(D=null)=>{g(!0),b("");try{const le=D||E;console.log("🔍 [SUBMIT] Datos completos antes de crear movimiento:",le),console.log("🔍 [SUBMIT] FuelType específico:",le.fuelType),le.type===de.SALIDA&&console.log("🔍 [SUBMIT SALIDA] Validando campos requeridos:",{type:le.type,fuelType:le.fuelType,vehicleId:le.vehicleId,location:le.location,quantity:le.quantity,unitPrice:le.unitPrice});const ve={type:le.type,fuelType:le.fuelType,quantity:parseFloat(le.quantity),unitPrice:parseFloat(le.unitPrice),location:le.location,effectiveDate:new Date(le.effectiveDate),...le.supplierName&&{supplierName:le.supplierName},...le.vehicleId&&{vehicleId:le.vehicleId},...le.destinationLocation&&{destinationLocation:le.destinationLocation},...le.description&&{description:le.description},...le.reference&&{reference:le.reference},...le.currentHours&&{currentHours:parseFloat(le.currentHours)}};console.log("🔍 [SUBMIT] MovementData enviado a createMovement:",ve),console.log("🔍 [SUBMIT] Campos específicos enviados:",{type:ve.type,fuelType:ve.fuelType,quantity:ve.quantity,unitPrice:ve.unitPrice,fuelTypeType:typeof ve.fuelType,fuelTypeLength:ve.fuelType?.length}),console.log("🔍 [SUBMIT] JSON.stringify del objeto:",JSON.stringify(ve,null,2)),await AA(ve),t(),f(1),j({type:"",fuelType:"",quantity:"",unitPrice:"",location:"",supplierName:"",vehicleId:"",destinationLocation:"",description:"",reference:"",effectiveDate:new Date().toISOString().slice(0,16),currentHours:""})}catch(le){console.error("Error al crear movimiento:",le),b(le.message||"Error al crear el movimiento")}finally{g(!1)}},R=()=>{const D={formData:E,updateFormData:q,systemData:N,error:y,setError:b};switch(d){case 1:return a.jsx(tV,{...D});case 2:return a.jsx(nV,{...D});case 3:return a.jsx(sV,{...D});case"3b":return a.jsx($_,{...D,isEntryDestination:!0});case 4:return a.jsx(aV,{...D});case 5:return a.jsx(iV,{...D});case 6:return a.jsx($_,{...D});case 7:return a.jsx(rV,{...D});case 8:return a.jsx(oV,{...D,onSubmit:F,isLoading:p});default:return a.jsx("div",{children:"Paso no encontrado"})}};if(!n)return null;const V=S(),C=(D=>E.type===de.ENTRADA?{1:1,2:2,3:3,"3b":4,4:5,7:6,8:7}[D]||D:E.type===de.SALIDA?{1:1,2:2,3:3,4:4,5:5,7:6,8:7}[D]||D:{1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8}[D]||D)(d),M=C/V*100;return console.log("🔍 [WIZARD DEBUG]",{type:E.type,currentStep:d,currentLogicalStep:C,totalSteps:V,progress:M,isLastStep:d>=V,formDataKeys:Object.keys(E).filter(D=>E[D]),fuelType:E.fuelType}),a.jsx("div",{className:"modal-overlay wizard-overlay",onClick:e,children:a.jsxs("div",{className:"modal-content wizard-modal",onClick:D=>D.stopPropagation(),children:[a.jsxs("div",{className:"wizard-header",children:[a.jsxs("div",{className:"wizard-title",children:[a.jsx("h3",{children:"🧙‍♂️ Asistente de Movimientos"}),a.jsx("button",{className:"modal-close",onClick:e,children:"✕"})]}),a.jsxs("div",{className:"wizard-progress",children:[a.jsx("div",{className:"progress-bar",children:a.jsx("div",{className:"progress-fill",style:{width:`${M}%`}})}),a.jsxs("div",{className:"progress-text",children:["Paso ",C," de ",V]})]}),a.jsxs("div",{className:"step-info",children:[a.jsx("h4",{children:T[d]?.title}),a.jsx("p",{children:T[d]?.description})]})]}),a.jsx("div",{className:"wizard-body",children:N.loadingData?a.jsxs("div",{className:"wizard-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"🔄 Cargando datos del sistema..."})]}):R()}),y&&a.jsxs("div",{className:"wizard-error",children:[a.jsx("span",{className:"error-icon",children:"⚠️"}),y]}),a.jsx("div",{className:"wizard-footer",children:a.jsxs("div",{className:"wizard-navigation",children:[a.jsx("button",{className:"btn-wizard btn-previous",onClick:$,disabled:d===1,children:"← Anterior"}),C<V?a.jsx("button",{className:"btn-wizard btn-next",onClick:U,disabled:!O,children:"Siguiente →"}):a.jsx("button",{className:"btn-wizard btn-finish",onClick:D=>{D.preventDefault(),F()},disabled:p||!O,children:p?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"loading-spinner small"}),"Creando..."]}):"✅ Confirmar Movimiento"})]})})]})})},cV=()=>{const{user:n,userProfile:e,deleteMovement:t}=Qn(),[i,o]=z.useState([]),[c,d]=z.useState(null),[f,p]=z.useState(!0),[g,y]=z.useState(null),[b,E]=z.useState({type:"",status:"",fuelType:"",vehicleId:"",dateRange:"all"}),[j,N]=z.useState(""),[w,T]=z.useState(!1);z.useEffect(()=>{if(!n)return;p(!0);const C=ny((M,D)=>{if(D){console.error("Error en suscripción de movimientos:",D),y("Error al cargar movimientos"),p(!1);return}o(M),y(null),p(!1)},b);return()=>C()},[n,b]),z.useEffect(()=>{n&&(async()=>{try{const M=await IA(b);d(M)}catch(M){console.error("Error al cargar estadísticas:",M)}})()},[n,i,b]);const S=i.filter(C=>{if(!j)return!0;const M=j.toLowerCase();return C.fuelType?.toLowerCase().includes(M)||C.type?.toLowerCase().includes(M)||C.location?.toLowerCase().includes(M)||C.vehicleId?.toLowerCase().includes(M)||C.description?.toLowerCase().includes(M)||C.reference?.toLowerCase().includes(M)}),q=()=>{T(!0)},I=C=>{alert(`📋 Detalles del movimiento:

Tipo: ${C.type}
Combustible: ${C.fuelType}
Cantidad: ${C.quantity} gal
Fecha: ${new Date(C.createdAt).toLocaleDateString("es-CO")}`)},O=()=>{T(!1)},U=C=>{E(M=>({...M,...C}))},$=()=>{E({type:"",status:"",fuelType:"",vehicleId:"",dateRange:"all"}),N("")},F=async C=>{if(window.confirm("¿Estás seguro de que quieres aprobar este movimiento? Esta acción actualizará el inventario."))try{await SA(C),alert("Movimiento aprobado y stock actualizado.")}catch(M){console.error("Error al aprobar movimiento:",M),alert(`Error al aprobar movimiento: ${M.message}`)}},R=async C=>{if(window.confirm("¿Estás seguro de que quieres rechazar este movimiento?"))try{await wA(C,{status:gt.CANCELADO}),alert("Movimiento rechazado.")}catch(M){console.error("Error al rechazar movimiento:",M),alert(`Error al rechazar movimiento: ${M.message}`)}},V=async C=>{try{const M=await t(C);if(M.success)alert("Movimiento eliminado exitosamente.");else throw new Error(M.error)}catch(M){console.error("Error al eliminar movimiento:",M),alert(`Error al eliminar movimiento: ${M.message}`)}},P=e?.role==="admin"||e?.role==="contador"||e?.role==="cliente";return f?a.jsx("div",{className:"movements-main",children:a.jsxs("div",{className:"loading-container",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Cargando movimientos..."})]})}):g?a.jsx("div",{className:"movements-main",children:a.jsxs("div",{className:"error-container",children:[a.jsx("div",{className:"error-icon",children:"⚠️"}),a.jsx("h3",{children:"Error al cargar movimientos"}),a.jsx("p",{children:g}),a.jsx("button",{className:"btn-retry",onClick:()=>window.location.reload(),children:"Reintentar"})]})}):a.jsxs("div",{className:"movements-main",children:[a.jsxs("div",{className:"movements-header",children:[a.jsxs("div",{className:"header-title",children:[a.jsx("h2",{children:"📊 Movimientos de Combustibles"}),a.jsx("p",{children:"Gestiona entradas, salidas, transferencias y ajustes de inventario"})]}),P&&a.jsx("div",{className:"create-movement-options",children:a.jsx("button",{className:"btn-create-movement primary",onClick:q,children:"➕ Nuevo Movimiento"})})]}),c&&a.jsx(GL,{stats:c,filters:b}),a.jsx($L,{filters:b,onFilterChange:U,onClearFilters:$,searchTerm:j,onSearchChange:N,totalResults:S.length}),S.length===0?a.jsxs("div",{className:"empty-state",children:[a.jsx("div",{className:"empty-icon",children:"📋"}),a.jsx("h3",{children:i.length===0?"No hay movimientos registrados":"No se encontraron movimientos"}),a.jsx("p",{children:i.length===0?"Comienza creando tu primer movimiento de combustible":"Intenta ajustar los filtros de búsqueda"}),i.length===0&&P&&a.jsx("div",{className:"create-first-options",children:a.jsx("button",{className:"btn-create-first primary",onClick:q,children:"➕ Crear Primer Movimiento"})})]}):a.jsx(QL,{movements:S,onEdit:null,onView:I,onApprove:F,onReject:R,onDelete:V,userRole:e?.role}),w&&a.jsx(lV,{isOpen:w,onClose:O,onSuccess:()=>{O()}})]})},uV=({stats:n,filters:e})=>{if(!n)return null;const t=b=>`${be(b)} gal`,i=b=>`${be(b)} hrs`,o=b=>`${b.toFixed(2)} gal/hr`,c=b=>{let E=0;for(let N=0;N<b.length;N++)E=(E<<5)-E+b.charCodeAt(N)&4294967295;const j=["#059669","#dc2626","#2563eb","#7c3aed","#ea580c","#16a34a","#ca8a04","#9333ea"];return j[Math.abs(E)%j.length]},d=b=>{if(!b)return"🚗";const E=b.toLowerCase();return E.includes("excavadora")?"🚚":E.includes("bulldozer")?"🚜":E.includes("cargador")?"🏗️":E.includes("camion")?"🚛":E.includes("grua")?"🏗️":E.includes("motosierra")?"🪚":E.includes("tractor")?"🚜":E.includes("volqueta")?"🚛":"🚗"},f=b=>{switch(b){case Ve.ACTIVO:return"#10b981";case Ve.MANTENIMIENTO:return"#f59e0b";case Ve.INACTIVO:return"#6b7280";case Ve.REPARACION:return"#ef4444";default:return"#6b7280"}},p=b=>{switch(b){case Ve.ACTIVO:return"✅";case Ve.MANTENIMIENTO:return"🔧";case Ve.INACTIVO:return"⏸️";case Ve.REPARACION:return"🔴";default:return"❓"}},g=b=>{switch(b){case vt.DIESEL:return"🚛";case vt.GASOLINA:return"🚗";case vt.ACPM:return"🚚";case vt.MIXTO:return"⛽";default:return"⛽"}},y=n.totalVehicles>0?((n.byStatus[Ve.ACTIVO]||0)/n.totalVehicles*100).toFixed(1):0;return a.jsxs("div",{className:"vehicles-stats",children:[a.jsxs("div",{className:"stats-grid",children:[a.jsxs("div",{className:"stat-card primary",children:[a.jsx("div",{className:"stat-icon",children:"🚜"}),a.jsxs("div",{className:"stat-content",children:[a.jsx("div",{className:"stat-value",children:be(n.totalVehicles)}),a.jsx("div",{className:"stat-label",children:"Total Vehículos"}),a.jsx("div",{className:"stat-trend",children:a.jsxs("span",{className:`trend ${y>=80?"positive":"warning"}`,children:[y>=80?"📈":"⚠️"," ",y,"% activos"]})})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:"⛽"}),a.jsxs("div",{className:"stat-content",children:[a.jsx("div",{className:"stat-value",children:t(n.totalFuelConsumed)}),a.jsx("div",{className:"stat-label",children:"Combustible Consumido"}),a.jsxs("div",{className:"stat-secondary",children:["Promedio: ",o(n.averageConsumption||0)]})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:"⏰"}),a.jsxs("div",{className:"stat-content",children:[a.jsx("div",{className:"stat-value",children:i(n.totalHoursWorked)}),a.jsx("div",{className:"stat-label",children:"Horas Trabajadas"}),a.jsxs("div",{className:"stat-secondary",children:["Promedio: ",i(n.totalHoursWorked/(n.totalVehicles||1))]})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:"🏆"}),a.jsxs("div",{className:"stat-content",children:[a.jsx("div",{className:"stat-value",children:n.mostActiveVehicle?n.mostActiveVehicle.vehicleId:"N/A"}),a.jsx("div",{className:"stat-label",children:"Más Activo"}),a.jsx("div",{className:"stat-secondary",children:n.mostActiveVehicle?`${n.mostActiveVehicle.totalMovements||0} movimientos`:"Sin datos"})]})]})]}),a.jsxs("div",{className:"stats-breakdown",children:[a.jsxs("div",{className:"breakdown-section",children:[a.jsx("h4",{children:"🚜 Por Tipo de Vehículo"}),a.jsx("div",{className:"breakdown-grid",children:Object.entries(n.byType).map(([b,E])=>{const j=(E/n.totalVehicles*100).toFixed(1);return a.jsxs("div",{className:"breakdown-item",children:[a.jsxs("div",{className:"breakdown-header",children:[a.jsx("span",{className:"breakdown-icon",children:d(b)}),a.jsx("span",{className:"breakdown-label",children:b.charAt(0).toUpperCase()+b.slice(1)})]}),a.jsx("div",{className:"breakdown-value",children:E}),a.jsx("div",{className:"breakdown-bar",children:a.jsx("div",{className:"breakdown-fill",style:{width:`${j}%`,backgroundColor:c(b)}})}),a.jsxs("div",{className:"breakdown-percentage",children:[j,"%"]})]},b)})})]}),a.jsxs("div",{className:"breakdown-section",children:[a.jsx("h4",{children:"⚡ Por Estado"}),a.jsx("div",{className:"breakdown-grid",children:Object.entries(n.byStatus).map(([b,E])=>{const j=(E/n.totalVehicles*100).toFixed(1);return a.jsxs("div",{className:"breakdown-item",children:[a.jsxs("div",{className:"breakdown-header",children:[a.jsx("span",{className:"breakdown-icon",children:p(b)}),a.jsx("span",{className:"breakdown-label",children:b.charAt(0).toUpperCase()+b.slice(1)})]}),a.jsx("div",{className:"breakdown-value",children:E}),a.jsx("div",{className:"breakdown-bar",children:a.jsx("div",{className:"breakdown-fill",style:{width:`${j}%`,backgroundColor:f(b)}})}),a.jsxs("div",{className:"breakdown-percentage",children:[j,"%"]})]},b)})})]}),a.jsxs("div",{className:"breakdown-section",children:[a.jsx("h4",{children:"⛽ Por Tipo de Combustible"}),a.jsx("div",{className:"breakdown-grid",children:Object.entries(n.byFuelType).map(([b,E])=>{const j=(E/n.totalVehicles*100).toFixed(1);return a.jsxs("div",{className:"breakdown-item",children:[a.jsxs("div",{className:"breakdown-header",children:[a.jsx("span",{className:"breakdown-icon",children:g(b)}),a.jsx("span",{className:"breakdown-label",children:b})]}),a.jsx("div",{className:"breakdown-value",children:E}),a.jsx("div",{className:"breakdown-bar",children:a.jsx("div",{className:"breakdown-fill",style:{width:`${j}%`,backgroundColor:"#059669"}})}),a.jsxs("div",{className:"breakdown-percentage",children:[j,"%"]})]},b)})})]})]}),(n.totalFuelConsumed>0||n.totalHoursWorked>0)&&a.jsxs("div",{className:"performance-metrics",children:[a.jsx("h4",{children:"📊 Métricas de Rendimiento"}),a.jsxs("div",{className:"metrics-grid",children:[a.jsxs("div",{className:"metric-card",children:[a.jsx("div",{className:"metric-icon",children:"⚡"}),a.jsxs("div",{className:"metric-content",children:[a.jsx("div",{className:"metric-label",children:"Eficiencia de Flota"}),a.jsxs("div",{className:"metric-value",children:[y,"%"]}),a.jsxs("div",{className:"metric-description",children:[n.byStatus[Ve.ACTIVO]||0," de ",n.totalVehicles," activos"]})]})]}),n.averageConsumption>0&&a.jsxs("div",{className:"metric-card",children:[a.jsx("div",{className:"metric-icon",children:"📈"}),a.jsxs("div",{className:"metric-content",children:[a.jsx("div",{className:"metric-label",children:"Consumo Promedio"}),a.jsx("div",{className:"metric-value",children:o(n.averageConsumption)}),a.jsx("div",{className:"metric-description",children:"Por vehículo por hora trabajada"})]})]}),n.mostActiveVehicle&&a.jsxs("div",{className:"metric-card",children:[a.jsx("div",{className:"metric-icon",children:"🏆"}),a.jsxs("div",{className:"metric-content",children:[a.jsx("div",{className:"metric-label",children:"Mayor Utilización"}),a.jsx("div",{className:"metric-value",children:n.mostActiveVehicle.vehicleId}),a.jsxs("div",{className:"metric-description",children:[t(n.mostActiveVehicle.totalFuelConsumed||0)," consumidos"]})]})]}),n.leastActiveVehicle&&a.jsxs("div",{className:"metric-card",children:[a.jsx("div",{className:"metric-icon",children:"📉"}),a.jsxs("div",{className:"metric-content",children:[a.jsx("div",{className:"metric-label",children:"Menor Utilización"}),a.jsx("div",{className:"metric-value",children:n.leastActiveVehicle.vehicleId}),a.jsxs("div",{className:"metric-description",children:[t(n.leastActiveVehicle.totalFuelConsumed||0)," consumidos"]})]})]})]})]}),(e.type||e.status||e.fuelType||e.location)&&a.jsxs("div",{className:"active-filters",children:[a.jsx("h4",{children:"🔍 Filtros Activos"}),a.jsxs("div",{className:"filters-list",children:[e.type&&a.jsxs("span",{className:"filter-tag",children:["Tipo: ",e.type]}),e.status&&a.jsxs("span",{className:"filter-tag",children:["Estado: ",e.status]}),e.fuelType&&a.jsxs("span",{className:"filter-tag",children:["Combustible: ",e.fuelType]}),e.location&&a.jsxs("span",{className:"filter-tag",children:["Ubicación: ",e.location]})]})]})]})},dV=({filters:n,onFilterChange:e,onClearFilters:t,searchTerm:i,onSearchChange:o,viewMode:c,onViewModeChange:d,totalResults:f})=>{const[p,g]=z.useState(!1),y=["Oficina Principal","Bodega Norte","Bodega Sur","Campo Operativo","Taller Mecánico","Proyecto A","Proyecto B","En Reparación","Otros"],b=Object.values(n).filter(N=>N&&N!==""&&N!=="all").length,E=(N,w)=>{e({[N]:w})},j=N=>{e(N)};return a.jsxs("div",{className:"vehicles-filters",children:[a.jsxs("div",{className:"filters-main",children:[a.jsx("div",{className:"search-section",children:a.jsxs("div",{className:"search-box",children:[a.jsx("span",{className:"search-icon",children:"🔍"}),a.jsx("input",{type:"text",placeholder:"Buscar por ID, nombre, marca, modelo, ubicación...",value:i,onChange:N=>o(N.target.value),className:"search-input"}),i&&a.jsx("button",{className:"search-clear",onClick:()=>o(""),title:"Limpiar búsqueda",children:"✕"})]})}),a.jsxs("div",{className:"filters-controls",children:[a.jsxs("div",{className:"quick-filters",children:[a.jsx("button",{className:`quick-filter ${n.status==="activo"?"active":""}`,onClick:()=>j({status:"activo"}),children:"✅ Activos"}),a.jsx("button",{className:`quick-filter ${n.status==="mantenimiento"?"active":""}`,onClick:()=>j({status:"mantenimiento"}),children:"🔧 Mantenimiento"}),a.jsx("button",{className:`quick-filter ${n.type==="excavadora"?"active":""}`,onClick:()=>j({type:"excavadora"}),children:"🚚 Excavadoras"}),a.jsx("button",{className:`quick-filter ${n.type==="tractor"?"active":""}`,onClick:()=>j({type:"tractor"}),children:"🚜 Tractores"})]}),a.jsxs("button",{className:`btn-advanced-filters ${p?"active":""}`,onClick:()=>g(!p),children:["🎛️ Filtros",b>0&&a.jsx("span",{className:"filters-count",children:b})]}),a.jsxs("div",{className:"view-modes",children:[a.jsx("button",{className:`view-mode ${c==="cards"?"active":""}`,onClick:()=>d("cards"),title:"Vista en tarjetas",children:"🎴"}),a.jsx("button",{className:`view-mode ${c==="table"?"active":""}`,onClick:()=>d("table"),title:"Vista en tabla",children:"📋"})]})]})]}),p&&a.jsxs("div",{className:"filters-advanced",children:[a.jsxs("div",{className:"filters-grid",children:[a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Tipo de Vehículo"}),a.jsxs("select",{value:n.type,onChange:N=>E("type",N.target.value),className:"filter-select",children:[a.jsx("option",{value:"",children:"Todos los tipos"}),a.jsx("option",{value:"excavadora",children:"🚚 Excavadora"}),a.jsx("option",{value:"bulldozer",children:"🚜 Bulldozer"}),a.jsx("option",{value:"cargador",children:"🏗️ Cargador"}),a.jsx("option",{value:"camion",children:"🚛 Camión"}),a.jsx("option",{value:"grua",children:"🏗️ Grúa"}),a.jsx("option",{value:"motosierra",children:"🪚 Motosierra"}),a.jsx("option",{value:"tractor",children:"🚜 Tractor"}),a.jsx("option",{value:"volqueta",children:"🚛 Volqueta"}),a.jsx("option",{value:"otros",children:"🚗 Otros"})]})]}),a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Estado"}),a.jsxs("select",{value:n.status,onChange:N=>E("status",N.target.value),className:"filter-select",children:[a.jsx("option",{value:"",children:"Todos los estados"}),a.jsx("option",{value:Ve.ACTIVO,children:"✅ Activo"}),a.jsx("option",{value:Ve.MANTENIMIENTO,children:"🔧 Mantenimiento"}),a.jsx("option",{value:Ve.INACTIVO,children:"⏸️ Inactivo"}),a.jsx("option",{value:Ve.REPARACION,children:"🔴 Reparación"})]})]}),a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Tipo de Combustible"}),a.jsxs("select",{value:n.fuelType,onChange:N=>E("fuelType",N.target.value),className:"filter-select",children:[a.jsx("option",{value:"",children:"Todos los combustibles"}),a.jsx("option",{value:vt.DIESEL,children:"🚛 Diesel"}),a.jsx("option",{value:vt.GASOLINA,children:"🚗 Gasolina"}),a.jsx("option",{value:vt.ACPM,children:"🚚 ACPM"}),a.jsx("option",{value:vt.MIXTO,children:"⛽ Mixto"})]})]}),a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Ubicación Actual"}),a.jsxs("select",{value:n.location,onChange:N=>E("location",N.target.value),className:"filter-select",children:[a.jsx("option",{value:"",children:"Todas las ubicaciones"}),y.map(N=>a.jsxs("option",{value:N,children:["📍 ",N]},N))]})]}),a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Mantenimiento"}),a.jsxs("select",{value:n.maintenance,onChange:N=>E("maintenance",N.target.value),className:"filter-select",children:[a.jsx("option",{value:"all",children:"Todos"}),a.jsx("option",{value:"due",children:"Mantenimiento debido"}),a.jsx("option",{value:"overdue",children:"Mantenimiento vencido"}),a.jsx("option",{value:"recent",children:"Mantenimiento reciente"})]})]})]}),a.jsxs("div",{className:"filters-actions",children:[a.jsx("button",{className:"btn-clear-filters",onClick:t,disabled:b===0,children:"🗑️ Limpiar Filtros"}),a.jsxs("div",{className:"filters-info",children:[a.jsxs("span",{className:"results-count",children:[f," resultado",f!==1?"s":""]}),b>0&&a.jsxs("span",{className:"active-filters-text",children:["(",b," filtro",b!==1?"s":""," activo",b!==1?"s":"",")"]})]})]})]}),b>0&&a.jsx("div",{className:"active-filters-summary",children:a.jsxs("div",{className:"summary-content",children:[a.jsx("span",{className:"summary-label",children:"Filtros activos:"}),a.jsxs("div",{className:"summary-tags",children:[n.type&&a.jsxs("span",{className:"summary-tag",onClick:()=>E("type",""),children:["Tipo: ",n.type," ✕"]}),n.status&&a.jsxs("span",{className:"summary-tag",onClick:()=>E("status",""),children:["Estado: ",n.status," ✕"]}),n.fuelType&&a.jsxs("span",{className:"summary-tag",onClick:()=>E("fuelType",""),children:["Combustible: ",n.fuelType," ✕"]}),n.location&&a.jsxs("span",{className:"summary-tag",onClick:()=>E("location",""),children:["Ubicación: ",n.location," ✕"]}),n.maintenance!=="all"&&a.jsxs("span",{className:"summary-tag",onClick:()=>E("maintenance","all"),children:["Mantenimiento: ",n.maintenance," ✕"]})]})]})}),a.jsx("div",{className:"keyboard-shortcuts",style:{display:"none"},children:a.jsx("small",{children:"💡 Atajos: Ctrl+F (buscar), Ctrl+1 (activos), Ctrl+2 (mantenimiento), Ctrl+T (tractores)"})})]})},hV=({vehicles:n,onEdit:e,onView:t,onMaintenance:i})=>{const o=T=>new Intl.NumberFormat("es-CO").format(T),c=T=>`${o(T)} gal`,d=T=>`${o(T)} hrs`,f=T=>T?(T instanceof Date?T:new Date(T)).toLocaleDateString("es-CO",{day:"2-digit",month:"2-digit",year:"numeric"}):"Sin fecha",p=T=>{if(!T)return"";const S=new Date,q=T instanceof Date?T:new Date(T),I=Math.abs(S-q),O=Math.ceil(I/(1e3*60*60*24));return O===1?"hace 1 día":O<7?`hace ${O} días`:O<30?`hace ${Math.ceil(O/7)} semanas`:O<365?`hace ${Math.ceil(O/30)} meses`:`hace ${Math.ceil(O/365)} años`},g=T=>{if(!T)return"vehicle-default";const S=T.toLowerCase();return S.includes("excavadora")?"vehicle-excavadora":S.includes("bulldozer")?"vehicle-bulldozer":S.includes("cargador")?"vehicle-cargador":S.includes("camion")?"vehicle-camion":S.includes("grua")?"vehicle-grua":S.includes("motosierra")?"vehicle-motosierra":S.includes("tractor")?"vehicle-tractor":S.includes("volqueta")?"vehicle-volqueta":"vehicle-default"},y=T=>{switch(T){case Ve.ACTIVO:return"status-activo";case Ve.MANTENIMIENTO:return"status-mantenimiento";case Ve.INACTIVO:return"status-inactivo";case Ve.REPARACION:return"status-reparacion";default:return"status-default"}},b=T=>{if(!T)return"🚗";const S=T.toLowerCase();return S.includes("excavadora")?"🚚":S.includes("bulldozer")?"🚜":S.includes("cargador")?"🏗️":S.includes("camion")?"🚛":S.includes("grua")?"🏗️":S.includes("motosierra")?"🪚":S.includes("tractor")?"🚜":S.includes("volqueta")?"🚛":"🚗"},E=T=>{switch(T){case vt.DIESEL:return"🚛";case vt.GASOLINA:return"🚗";case vt.ACPM:return"🚚";case vt.MIXTO:return"⛽";default:return"⛽"}},j=T=>{switch(T){case Ve.ACTIVO:return"✅";case Ve.MANTENIMIENTO:return"🔧";case Ve.INACTIVO:return"⏸️";case Ve.REPARACION:return"🔴";default:return"❓"}},N=T=>!T.totalHoursWorked||T.totalHoursWorked===0?T.estimatedConsumptionPerHour||0:T.totalFuelConsumed/T.totalHoursWorked,w=T=>T.lastMaintenanceDate?Math.floor((new Date-new Date(T.lastMaintenanceDate))/(1e3*60*60*24))>90:!0;return a.jsx("div",{className:"vehicles-cards",children:n.map(T=>a.jsxs("div",{className:`vehicle-card ${g(T.type)}`,children:[a.jsx("div",{className:"card-header",children:a.jsxs("div",{className:"vehicle-info",children:[a.jsxs("div",{className:"vehicle-id-section",children:[a.jsx("span",{className:"vehicle-icon",children:b(T.type)}),a.jsxs("div",{className:"vehicle-details",children:[a.jsx("span",{className:"vehicle-id",children:T.vehicleId}),a.jsx("span",{className:"vehicle-name",children:T.name})]})]}),a.jsxs("div",{className:`status-badge ${y(T.status)}`,children:[a.jsx("span",{className:"status-icon",children:j(T.status)}),a.jsx("span",{className:"status-label",children:T.status.charAt(0).toUpperCase()+T.status.slice(1)})]})]})}),a.jsxs("div",{className:"card-content",children:[a.jsxs("div",{className:"basic-info",children:[a.jsxs("div",{className:"info-row",children:[a.jsx("span",{className:"info-label",children:"Tipo:"}),a.jsxs("span",{className:"info-value",children:[b(T.type)," ",T.type.charAt(0).toUpperCase()+T.type.slice(1)]})]}),T.brand&&T.model&&a.jsxs("div",{className:"info-row",children:[a.jsx("span",{className:"info-label",children:"Marca/Modelo:"}),a.jsxs("span",{className:"info-value",children:[T.brand," ",T.model]})]}),a.jsxs("div",{className:"info-row",children:[a.jsx("span",{className:"info-label",children:"Combustible:"}),a.jsxs("span",{className:"info-value",children:[E(T.fuelType)," ",T.fuelType]})]}),T.currentLocation&&a.jsxs("div",{className:"info-row",children:[a.jsx("span",{className:"info-label",children:"Ubicación:"}),a.jsxs("span",{className:"info-value",children:["📍 ",T.currentLocation]})]})]}),a.jsxs("div",{className:"consumption-metrics",children:[a.jsxs("div",{className:"metric-item",children:[a.jsx("div",{className:"metric-icon",children:"⛽"}),a.jsxs("div",{className:"metric-content",children:[a.jsx("div",{className:"metric-value",children:c(T.totalFuelConsumed||0)}),a.jsx("div",{className:"metric-label",children:"Consumido"})]})]}),a.jsxs("div",{className:"metric-item",children:[a.jsx("div",{className:"metric-icon",children:"⏰"}),a.jsxs("div",{className:"metric-content",children:[a.jsx("div",{className:"metric-value",children:d(T.totalHoursWorked||0)}),a.jsx("div",{className:"metric-label",children:"Trabajadas"})]})]}),a.jsxs("div",{className:"metric-item",children:[a.jsx("div",{className:"metric-icon",children:"📊"}),a.jsxs("div",{className:"metric-content",children:[a.jsxs("div",{className:"metric-value",children:[N(T).toFixed(1)," gal/hr"]}),a.jsx("div",{className:"metric-label",children:"Consumo"})]})]}),a.jsxs("div",{className:"metric-item",children:[a.jsx("div",{className:"metric-icon",children:"🔄"}),a.jsxs("div",{className:"metric-content",children:[a.jsx("div",{className:"metric-value",children:T.totalMovements||0}),a.jsx("div",{className:"metric-label",children:"Movimientos"})]})]})]}),(T.enginePower||T.fuelCapacity||T.year)&&a.jsxs("div",{className:"technical-specs",children:[T.enginePower&&a.jsxs("div",{className:"spec-item",children:[a.jsx("span",{className:"spec-icon",children:"⚡"}),a.jsxs("span",{className:"spec-value",children:[T.enginePower," HP"]})]}),T.fuelCapacity&&a.jsxs("div",{className:"spec-item",children:[a.jsx("span",{className:"spec-icon",children:"🛢️"}),a.jsxs("span",{className:"spec-value",children:[T.fuelCapacity," gal"]})]}),T.year&&a.jsxs("div",{className:"spec-item",children:[a.jsx("span",{className:"spec-icon",children:"📅"}),a.jsx("span",{className:"spec-value",children:T.year})]})]}),T.description&&a.jsx("div",{className:"description",children:a.jsx("p",{children:T.description})})]}),a.jsxs("div",{className:"card-footer",children:[a.jsxs("div",{className:"date-info",children:[T.lastMovementDate&&a.jsxs("div",{className:"date-item",children:[a.jsx("span",{className:"date-label",children:"Último movimiento:"}),a.jsx("span",{className:"date-value",children:f(T.lastMovementDate)}),a.jsx("span",{className:"date-relative",children:p(T.lastMovementDate)})]}),T.lastMaintenanceDate&&a.jsxs("div",{className:"date-item",children:[a.jsx("span",{className:"date-label",children:"Último mantenimiento:"}),a.jsx("span",{className:"date-value",children:f(T.lastMaintenanceDate)}),a.jsx("span",{className:"date-relative",children:p(T.lastMaintenanceDate)})]})]}),a.jsxs("div",{className:"card-actions",children:[a.jsx("button",{className:"btn-view",onClick:()=>t(T),title:"Ver detalles",children:"👁️"}),e&&T.status!==Ve.REPARACION&&a.jsx("button",{className:"btn-edit",onClick:()=>e(T),title:"Editar vehículo",children:"✏️"}),i&&a.jsx("button",{className:"btn-maintenance",onClick:()=>i(T),title:"Registrar mantenimiento",children:"🔧"})]})]}),T.status===Ve.MANTENIMIENTO&&a.jsx("div",{className:"maintenance-indicator",children:a.jsx("div",{className:"maintenance-pulse"})}),w(T)&&T.status===Ve.ACTIVO&&a.jsx("div",{className:"maintenance-due-badge",children:a.jsx("span",{children:"Mantenimiento Debido"})}),T.status===Ve.REPARACION&&a.jsx("div",{className:"repair-badge",children:a.jsx("span",{children:"En Reparación"})}),T.totalHoursWorked>0&&a.jsxs("div",{className:"efficiency-indicator",children:[a.jsx("div",{className:"efficiency-bar",children:a.jsx("div",{className:"efficiency-fill",style:{width:`${Math.min(T.totalHoursWorked/2e3*100,100)}%`}})}),a.jsxs("span",{className:"efficiency-label",children:[(T.totalHoursWorked/2e3*100).toFixed(1),"% utilización anual"]})]})]},T.id))})},fV=({vehicles:n,onEdit:e,onView:t,onMaintenance:i})=>{const[o,c]=z.useState("vehicleId"),[d,f]=z.useState("asc"),p=U=>new Intl.NumberFormat("es-CO").format(U),g=U=>`${p(U)} gal`,y=U=>`${p(U)} hrs`,b=U=>U?(U instanceof Date?U:new Date(U)).toLocaleDateString("es-CO",{day:"2-digit",month:"2-digit",year:"2-digit"}):"-",E=U=>{if(!U)return"🚗";const $=U.toLowerCase();return $.includes("excavadora")?"🚚":$.includes("bulldozer")?"🚜":$.includes("cargador")?"🏗️":$.includes("camion")?"🚛":$.includes("grua")?"🏗️":$.includes("motosierra")?"🪚":$.includes("tractor")?"🚜":$.includes("volqueta")?"🚛":"🚗"},j=U=>{switch(U){case vt.DIESEL:return"🚛";case vt.GASOLINA:return"🚗";case vt.ACPM:return"🚚";case vt.MIXTO:return"⛽";default:return"⛽"}},N=U=>{switch(U){case Ve.ACTIVO:return"✅";case Ve.MANTENIMIENTO:return"🔧";case Ve.INACTIVO:return"⏸️";case Ve.REPARACION:return"🔴";default:return"❓"}},w=U=>{switch(U){case Ve.ACTIVO:return"status-activo";case Ve.MANTENIMIENTO:return"status-mantenimiento";case Ve.INACTIVO:return"status-inactivo";case Ve.REPARACION:return"status-reparacion";default:return"status-default"}},T=U=>{o===U?f(d==="asc"?"desc":"asc"):(c(U),f("asc"))},S=[...n].sort((U,$)=>{let F=U[o],R=$[o];return(o.includes("Date")||o.includes("At"))&&(F=new Date(F||0),R=new Date(R||0)),typeof F=="number"&&typeof R=="number"?d==="asc"?F-R:R-F:typeof F=="string"&&typeof R=="string"?d==="asc"?F.localeCompare(R):R.localeCompare(F):F instanceof Date&&R instanceof Date?d==="asc"?F-R:R-F:!F&&!R?0:F?R?0:d==="asc"?-1:1:d==="asc"?1:-1}),q=U=>o!==U?"↕️":d==="asc"?"↑":"↓",I=U=>!U.totalHoursWorked||U.totalHoursWorked===0?U.estimatedConsumptionPerHour||0:U.totalFuelConsumed/U.totalHoursWorked,O=U=>U.lastMaintenanceDate?Math.floor((new Date-new Date(U.lastMaintenanceDate))/(1e3*60*60*24))>90:!0;return a.jsxs("div",{className:"vehicles-table-container",children:[a.jsx("div",{className:"table-wrapper",children:a.jsxs("table",{className:"vehicles-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsxs("th",{className:"sortable",onClick:()=>T("vehicleId"),children:["ID Vehículo ",q("vehicleId")]}),a.jsxs("th",{className:"sortable",onClick:()=>T("name"),children:["Nombre ",q("name")]}),a.jsxs("th",{className:"sortable",onClick:()=>T("type"),children:["Tipo ",q("type")]}),a.jsx("th",{children:"Marca/Modelo"}),a.jsxs("th",{className:"sortable",onClick:()=>T("fuelType"),children:["Combustible ",q("fuelType")]}),a.jsxs("th",{className:"sortable text-right",onClick:()=>T("totalFuelConsumed"),children:["Consumido ",q("totalFuelConsumed")]}),a.jsxs("th",{className:"sortable text-right",onClick:()=>T("totalHoursWorked"),children:["Horas ",q("totalHoursWorked")]}),a.jsx("th",{className:"text-right",children:"Consumo/Hr"}),a.jsx("th",{children:"Ubicación"}),a.jsxs("th",{className:"sortable",onClick:()=>T("status"),children:["Estado ",q("status")]}),a.jsxs("th",{className:"sortable",onClick:()=>T("lastMovementDate"),children:["Último Mov. ",q("lastMovementDate")]}),a.jsx("th",{className:"actions-column",children:"Acciones"})]})}),a.jsx("tbody",{children:S.map(U=>a.jsxs("tr",{className:`vehicle-row ${U.status===Ve.MANTENIMIENTO?"maintenance-row":""} ${O(U)?"needs-maintenance":""}`,children:[a.jsx("td",{className:"vehicle-id-cell",children:a.jsxs("div",{className:"id-content",children:[a.jsx("span",{className:"vehicle-icon",children:E(U.type)}),a.jsx("span",{className:"vehicle-id",children:U.vehicleId})]})}),a.jsx("td",{className:"name-cell",children:a.jsx("span",{className:"vehicle-name",children:U.name})}),a.jsx("td",{className:"type-cell",children:a.jsx("span",{className:"type-text",children:U.type.charAt(0).toUpperCase()+U.type.slice(1)})}),a.jsx("td",{className:"brand-model-cell",children:U.brand&&U.model?a.jsxs("span",{className:"brand-model",children:[U.brand," ",U.model]}):a.jsx("span",{className:"no-data",children:"-"})}),a.jsx("td",{className:"fuel-cell",children:a.jsxs("div",{className:"fuel-content",children:[a.jsx("span",{className:"fuel-icon",children:j(U.fuelType)}),a.jsx("span",{className:"fuel-text",children:U.fuelType})]})}),a.jsx("td",{className:"consumption-cell text-right",children:a.jsx("span",{className:"consumption-value",children:g(U.totalFuelConsumed||0)})}),a.jsx("td",{className:"hours-cell text-right",children:a.jsx("span",{className:"hours-value",children:y(U.totalHoursWorked||0)})}),a.jsx("td",{className:"rate-cell text-right",children:a.jsxs("span",{className:"rate-value",children:[I(U).toFixed(1)," gal/hr"]})}),a.jsx("td",{className:"location-cell",children:a.jsxs("span",{className:"location-text",children:["📍 ",U.currentLocation||"Sin ubicación"]})}),a.jsx("td",{className:"status-cell",children:a.jsxs("div",{className:`status-badge ${w(U.status)}`,children:[a.jsx("span",{className:"status-icon",children:N(U.status)}),a.jsx("span",{className:"status-text",children:U.status.charAt(0).toUpperCase()+U.status.slice(1)})]})}),a.jsx("td",{className:"date-cell",children:a.jsxs("div",{className:"date-content",children:[a.jsx("span",{className:"date-value",children:b(U.lastMovementDate)}),O(U)&&a.jsx("span",{className:"maintenance-warning",children:"⚠️"})]})}),a.jsx("td",{className:"actions-cell",children:a.jsxs("div",{className:"action-buttons",children:[a.jsx("button",{className:"btn-action btn-view",onClick:()=>t(U),title:"Ver detalles",children:"👁️"}),e&&U.status!==Ve.REPARACION&&a.jsx("button",{className:"btn-action btn-edit",onClick:()=>e(U),title:"Editar vehículo",children:"✏️"}),i&&a.jsx("button",{className:"btn-action btn-maintenance",onClick:()=>i(U),title:"Registrar mantenimiento",children:"🔧"})]})})]},U.id))})]})}),a.jsxs("div",{className:"table-info",children:[a.jsxs("div",{className:"table-summary",children:[a.jsxs("span",{className:"total-rows",children:[n.length," vehículo",n.length!==1?"s":""]}),o&&a.jsxs("span",{className:"sort-info",children:["Ordenado por ",o," (",d==="asc"?"ascendente":"descendente",")"]})]}),a.jsxs("div",{className:"table-legend",children:[a.jsxs("span",{className:"legend-item",children:[a.jsx("span",{className:"legend-icon",children:"✅"})," Activo"]}),a.jsxs("span",{className:"legend-item",children:[a.jsx("span",{className:"legend-icon",children:"🔧"})," Mantenimiento"]}),a.jsxs("span",{className:"legend-item",children:[a.jsx("span",{className:"legend-icon",children:"⏸️"})," Inactivo"]}),a.jsxs("span",{className:"legend-item",children:[a.jsx("span",{className:"legend-icon",children:"🔴"})," Reparación"]}),a.jsxs("span",{className:"legend-item",children:[a.jsx("span",{className:"legend-icon",children:"⚠️"})," Mantto. Debido"]})]})]})]})},mV=({vehicles:n,viewMode:e,onEdit:t,onView:i,onMaintenance:o})=>e==="table"?a.jsx(fV,{vehicles:n,onEdit:t,onView:i,onMaintenance:o}):a.jsx(hV,{vehicles:n,onEdit:t,onView:i,onMaintenance:o}),pV="modulepreload",gV=function(n){return"/combustibles/"+n},Y_={},iy=function(e,t,i){let o=Promise.resolve();if(t&&t.length>0){let g=function(y){return Promise.all(y.map(b=>Promise.resolve(b).then(E=>({status:"fulfilled",value:E}),E=>({status:"rejected",reason:E}))))};var d=g;document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),p=f?.nonce||f?.getAttribute("nonce");o=g(t.map(y=>{if(y=gV(y),y in Y_)return;Y_[y]=!0;const b=y.endsWith(".css"),E=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${E}`))return;const j=document.createElement("link");if(j.rel=b?"stylesheet":pV,b||(j.as="script"),j.crossOrigin="",j.href=y,p&&j.setAttribute("nonce",p),document.head.appendChild(j),b)return new Promise((N,w)=>{j.addEventListener("load",N),j.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${y}`)))})}))}function c(f){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=f,window.dispatchEvent(p),!p.defaultPrevented)throw f}return o.then(f=>{for(const p of f||[])p.status==="rejected"&&c(p.reason);return e().catch(c)})},Tu="combustibles_vehicle_categories",vV=async n=>{try{const e=PA(n);if(!e.isValid)throw new Error(`Datos inválidos: ${e.errors.join(", ")}`);const t=await YA();if(t.some(d=>d.id===n.id||d.name.toLowerCase()===n.name.toLowerCase()))throw new Error("Ya existe una categoría con ese nombre o ID");n.id||(n.id=LA(n.name,t));const o={...n,createdAt:Ue(),updatedAt:Ue(),isCustom:!0,vehicleCount:0},c=await gl(Ee(he,Tu),o);return console.log("✅ Categoría creada:",n.name),{id:c.id,...o,createdAt:new Date,updatedAt:new Date}}catch(e){throw console.error("❌ Error al crear categoría:",e),new Error(`Error al crear categoría: ${e.message}`)}},YA=async()=>{try{const n=Ae(Ee(he,Tu),Cn("name","asc")),e=await He(n),t=[];return e.forEach(i=>{t.push({id:i.id,...i.data(),createdAt:i.data().createdAt?.toDate?.()||i.data().createdAt,updatedAt:i.data().updatedAt?.toDate?.()||i.data().updatedAt})}),t}catch(n){throw console.error("❌ Error al obtener categorías personalizadas:",n),new Error(`Error al obtener categorías: ${n.message}`)}},ry=async()=>{try{const n=await YA();return OA(n)}catch(n){return console.error("❌ Error al obtener todas las categorías:",n),cs}},yV=async(n,e)=>{try{if(!n)throw new Error("ID de categoría requerido");if(cs.some(d=>d.id===n))throw new Error("No se pueden modificar las categorías predeterminadas");if(e.name||e.fuelTypes||e.fields){const d=PA({...e,id:n});if(!d.isValid)throw new Error(`Datos inválidos: ${d.errors.join(", ")}`)}const i={...e,updatedAt:Ue()},o=et(he,Tu,n);await As(o,i),console.log("✅ Categoría actualizada:",n);const c=await Bi(o);return{id:c.id,...c.data(),createdAt:c.data().createdAt?.toDate?.()||c.data().createdAt,updatedAt:c.data().updatedAt?.toDate?.()||c.data().updatedAt}}catch(t){throw console.error("❌ Error al actualizar categoría:",t),new Error(`Error al actualizar categoría: ${t.message}`)}},xV=async n=>{try{if(!n)throw new Error("ID de categoría requerido");if(cs.some(c=>c.id===n))throw new Error("No se pueden eliminar las categorías predeterminadas");const{countVehiclesByCategory:t}=await iy(async()=>{const{countVehiclesByCategory:c}=await Promise.resolve().then(()=>zA);return{countVehiclesByCategory:c}},void 0),i=await t(n);if(i>0)throw new Error(`No se puede eliminar la categoría porque tiene ${i} vehículo(s) asignado(s)`);const o=et(he,Tu,n);return await xf(o),console.log("✅ Categoría eliminada:",n),!0}catch(e){throw console.error("❌ Error al eliminar categoría:",e),new Error(`Error al eliminar categoría: ${e.message}`)}},bV=n=>{try{const e=Ae(Ee(he,Tu),Cn("name","asc"));return zr(e,t=>{const i=[];t.forEach(c=>{i.push({id:c.id,...c.data(),createdAt:c.data().createdAt?.toDate?.()||c.data().createdAt,updatedAt:c.data().updatedAt?.toDate?.()||c.data().updatedAt})});const o=OA(i);n(o)},t=>{console.error("❌ Error en suscripción a categorías:",t),n(cs)})}catch(e){return console.error("❌ Error al suscribirse a categorías:",e),n(cs),()=>{}}},Q_=async()=>{try{const{getAllVehicles:n}=await iy(async()=>{const{getAllVehicles:i}=await Promise.resolve().then(()=>zA);return{getAllVehicles:i}},void 0),e=await n();return(await ry()).map(i=>{const o=e.filter(c=>c.category===i.id);return{...i,vehicleCount:o.length,activeVehicles:o.filter(c=>c.status==="activo").length,totalFuelCapacity:o.reduce((c,d)=>c+(d.fuelCapacity||0),0),avgEnginepower:o.length>0?o.reduce((c,d)=>c+(d.enginePower||0),0)/o.length:0}}).sort((i,o)=>o.vehicleCount-i.vehicleCount)}catch(n){return console.error("❌ Error al obtener estadísticas de categorías:",n),[]}},QA=({onClose:n,onCategoryCreated:e})=>{const[t,i]=z.useState([]),[o,c]=z.useState([]),[d,f]=z.useState(!0),[p,g]=z.useState(!1),[y,b]=z.useState(null),[E,j]=z.useState(!1),[N,w]=z.useState(""),[T,S]=z.useState({name:"",description:"",icon:"🚗",color:"#2E86AB",fuelTypes:[],fields:[]});z.useEffect(()=>{q();const C=bV(M=>{i(M),I()});return()=>C&&C()},[]);const q=async()=>{try{f(!0);const[C,M]=await Promise.all([ry(),Q_()]);i(C),c(M)}catch(C){console.error("Error cargando categorías:",C),w("Error al cargar categorías")}finally{f(!1)}},I=async()=>{try{const C=await Q_();c(C)}catch(C){console.error("Error cargando estadísticas:",C)}},O=()=>{b(null),S({name:"",description:"",icon:"🚗",color:"#2E86AB",fuelTypes:[],fields:[]}),j(!0)},U=C=>{if(cs.some(M=>M.id===C.id)){w("No se pueden editar las categorías predeterminadas");return}b(C),S({name:C.name||"",description:C.description||"",icon:C.icon||"🚗",color:C.color||"#2E86AB",fuelTypes:C.fuelTypes||[],fields:C.fields||[]}),j(!0)},$=async C=>{if(cs.some(D=>D.id===C.id)){w("No se pueden eliminar las categorías predeterminadas");return}if(window.confirm(`¿Está seguro de eliminar la categoría "${C.name}"?

Esta acción no se puede deshacer.`))try{g(!0),await xV(C.id),w("")}catch(D){console.error("Error eliminando categoría:",D),w(D.message)}finally{g(!1)}},F=async C=>{if(C.preventDefault(),!T.name.trim()){w("El nombre de la categoría es requerido");return}try{g(!0),w("");const M={...T,name:T.name.trim(),description:T.description.trim()};if(y)await yV(y.id,M);else{M.id=LA(M.name,t);const D=await vV(M);e&&e(D)}j(!1)}catch(M){console.error("Error guardando categoría:",M),w(M.message)}finally{g(!1)}},R=C=>{S(M=>({...M,fields:M.fields.includes(C)?M.fields.filter(D=>D!==C):[...M.fields,C]}))},V=C=>{S(M=>({...M,fuelTypes:M.fuelTypes.includes(C)?M.fuelTypes.filter(D=>D!==C):[...M.fuelTypes,C]}))},P=C=>o.find(M=>M.id===C)||{vehicleCount:0,activeVehicles:0};return d?a.jsx("div",{className:"categories-manager",children:a.jsxs("div",{className:"loading",children:[a.jsx("div",{className:"spinner"}),a.jsx("p",{children:"Cargando categorías..."})]})}):a.jsxs("div",{className:"categories-manager",children:[a.jsxs("div",{className:"categories-header",children:[a.jsx("h3",{children:"📋 Gestión de Categorías"}),a.jsxs("div",{className:"header-actions",children:[a.jsx("button",{className:"btn-primary",onClick:O,disabled:p,children:"➕ Nueva Categoría"}),a.jsx("button",{className:"btn-secondary",onClick:n,children:"✕ Cerrar"})]})]}),N&&a.jsxs("div",{className:"error-message",children:[a.jsxs("span",{children:["⚠️ ",N]}),a.jsx("button",{onClick:()=>w(""),children:"✕"})]}),a.jsx("div",{className:"categories-grid",children:t.map(C=>{const M=cs.some(le=>le.id===C.id),D=P(C.id);return a.jsxs("div",{className:`category-card ${M?"default":"custom"}`,style:{"--category-color":C.color},children:[a.jsxs("div",{className:"category-header",children:[a.jsx("div",{className:"category-icon",style:{color:C.color},children:C.icon}),a.jsxs("div",{className:"category-info",children:[a.jsx("h4",{children:C.name}),a.jsx("p",{children:C.description})]}),M&&a.jsx("span",{className:"default-badge",children:"Predeterminada"})]}),a.jsxs("div",{className:"category-stats",children:[a.jsxs("div",{className:"stat",children:[a.jsx("span",{className:"stat-value",children:D.vehicleCount}),a.jsx("span",{className:"stat-label",children:"Vehículos"})]}),a.jsxs("div",{className:"stat",children:[a.jsx("span",{className:"stat-value",children:D.activeVehicles}),a.jsx("span",{className:"stat-label",children:"Activos"})]})]}),a.jsxs("div",{className:"category-details",children:[a.jsxs("div",{className:"fuel-types",children:[a.jsx("strong",{children:"Combustibles:"}),a.jsx("div",{className:"fuel-list",children:(C.fuelTypes||[]).map(le=>a.jsx("span",{className:"fuel-tag",children:le},le))})]}),a.jsxs("div",{className:"fields",children:[a.jsx("strong",{children:"Campos:"}),a.jsxs("div",{className:"fields-list",children:[(C.fields||[]).slice(0,3).map(le=>{const ve=q_.find(Q=>Q.key===le);return ve?a.jsxs("span",{className:"field-tag",children:[ve.icon," ",ve.label]},le):null}),(C.fields||[]).length>3&&a.jsxs("span",{className:"more-fields",children:["+",(C.fields||[]).length-3," más"]})]})]})]}),a.jsxs("div",{className:"category-actions",children:[a.jsx("button",{className:"btn-edit",onClick:()=>U(C),disabled:M||p,title:M?"No se pueden editar categorías predeterminadas":"Editar categoría",children:"✏️ Editar"}),a.jsx("button",{className:"btn-delete",onClick:()=>$(C),disabled:M||p||D.vehicleCount>0,title:M?"No se pueden eliminar categorías predeterminadas":D.vehicleCount>0?"No se puede eliminar una categoría con vehículos asignados":"Eliminar categoría",children:"🗑️ Eliminar"})]})]},C.id)})}),E&&a.jsx("div",{className:"modal-overlay",children:a.jsxs("div",{className:"modal-content",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("h3",{children:y?"✏️ Editar Categoría":"➕ Nueva Categoría"}),a.jsx("button",{onClick:()=>j(!1),children:"✕"})]}),a.jsxs("form",{onSubmit:F,className:"category-form",children:[a.jsxs("div",{className:"form-section",children:[a.jsx("h4",{children:"Información Básica"}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Nombre *"}),a.jsx("input",{type:"text",value:T.name,onChange:C=>S(M=>({...M,name:C.target.value})),placeholder:"Ej: Maquinaria Pesada",required:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Icono"}),a.jsx("input",{type:"text",value:T.icon,onChange:C=>S(M=>({...M,icon:C.target.value})),placeholder:"🚗",className:"icon-input"})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Descripción"}),a.jsx("textarea",{value:T.description,onChange:C=>S(M=>({...M,description:C.target.value})),placeholder:"Describe el tipo de vehículos que incluye esta categoría",rows:"2"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Color"}),a.jsx("input",{type:"color",value:T.color,onChange:C=>S(M=>({...M,color:C.target.value})),className:"color-input"})]})]}),a.jsxs("div",{className:"form-section",children:[a.jsx("h4",{children:"Tipos de Combustible Compatibles"}),a.jsx("div",{className:"fuel-types-grid",children:Object.values(kA).map(C=>a.jsxs("label",{className:"checkbox-label",children:[a.jsx("input",{type:"checkbox",checked:T.fuelTypes.includes(C),onChange:()=>V(C)}),a.jsx("span",{children:C})]},C))})]}),a.jsxs("div",{className:"form-section",children:[a.jsx("h4",{children:"Campos Específicos"}),a.jsx("p",{className:"section-description",children:"Selecciona los campos que serán relevantes para esta categoría"}),a.jsx("div",{className:"fields-grid",children:q_.map(C=>a.jsxs("label",{className:"checkbox-label",children:[a.jsx("input",{type:"checkbox",checked:T.fields.includes(C.key),onChange:()=>R(C.key)}),a.jsxs("span",{children:[C.icon," ",C.label]})]},C.key))})]}),a.jsxs("div",{className:"form-section",children:[a.jsx("h4",{children:"Vista Previa"}),a.jsx("div",{className:"category-preview",style:{"--category-color":T.color},children:a.jsxs("div",{className:"category-header",children:[a.jsx("div",{className:"category-icon",style:{color:T.color},children:T.icon}),a.jsxs("div",{className:"category-info",children:[a.jsx("h4",{children:T.name||"Nombre de la categoría"}),a.jsx("p",{children:T.description||"Descripción de la categoría"})]})]})})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>j(!1),disabled:p,children:"Cancelar"}),a.jsx("button",{type:"submit",className:"btn-primary",disabled:p||!T.name.trim(),children:p?"Guardando...":y?"Actualizar":"Crear"})]})]})]})})]})},NV=({isOpen:n,onClose:e,vehicle:t,onSave:i,mode:o="create"})=>{const[c,d]=z.useState([]),[f,p]=z.useState(null),[g,y]=z.useState(!1),[b,E]=z.useState(!1),[j,N]=z.useState(!1),[w,T]=z.useState({}),S=()=>({vehicleId:t?.vehicleId||"",name:t?.name||"",category:t?.category||"",brand:t?.brand||"",model:t?.model||"",year:t?.year||new Date().getFullYear(),fuelType:t?.fuelType||vt.DIESEL,status:t?.status||Ve.ACTIVO,currentLocation:t?.currentLocation||"",description:t?.description||"",plateNumber:t?.plateNumber||"",enginePower:t?.enginePower||"",fuelCapacity:t?.fuelCapacity||"",operatingWeight:t?.operatingWeight||"",loadCapacity:t?.loadCapacity||"",bucketCapacity:t?.bucketCapacity||"",hasHourMeter:t?.hasHourMeter||!1,currentHours:t?.currentHours||"",implementType:t?.implementType||"",flow:t?.flow||"",pressure:t?.pressure||"",weight:t?.weight||"",lastMaintenanceDate:t?.lastMaintenanceDate?new Date(t.lastMaintenanceDate).toISOString().split("T")[0]:"",purchaseDate:t?.purchaseDate?new Date(t.purchaseDate).toISOString().split("T")[0]:""}),[q,I]=z.useState(S());z.useEffect(()=>(n?(O(),document.body.style.overflow="hidden"):document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[n]),z.useEffect(()=>{if(t&&c.length>0){const C=B_(t.category,c);p(C),I(S())}},[t,c]);const O=async()=>{try{N(!0);const C=await ry();if(d(C),o==="create"&&C.length>0){const M=C[0];p(M),I(D=>({...D,category:M.id}))}}catch(C){console.error("Error cargando categorías:",C)}finally{N(!1)}},U=C=>{const M=B_(C,c);p(M),I(D=>{const le=o==="create"&&D.name&&M?F(D.name,M):D.vehicleId;return{...D,category:C,vehicleId:le,fuelType:M?.fuelTypes?.includes(D.fuelType)?D.fuelType:M?.fuelTypes?.[0]||vt.DIESEL}}),T({})},$=(C,M)=>{if(I(D=>({...D,[C]:M})),w[C]&&T(D=>({...D,[C]:null})),C==="name"&&o==="create"){const D=F(M,f);I(le=>({...le,vehicleId:D}))}if(C==="category"&&o==="create"&&q.name){const D=f;if(D){const le=F(q.name,D);I(ve=>({...ve,vehicleId:le}))}}},F=(C,M)=>{if(!C||!M)return"";const D=M.name.split(" ").map(se=>se.charAt(0).toUpperCase()).join("").substring(0,3),le=C.replace(/[^a-zA-Z0-9]/g,"").substring(0,4).toUpperCase(),Q=Date.now().toString().slice(-3);return`${D}${le}${Q}`},R=()=>{const C={};return q.vehicleId?.trim()||(C.vehicleId="Código del vehículo es requerido"),q.name?.trim()||(C.name="Nombre del vehículo es requerido"),q.category||(C.category="Categoría es requerida"),q.fuelType||(C.fuelType="Tipo de combustible es requerido"),f&&q.fuelType&&(f.fuelTypes?.includes(q.fuelType)||(C.fuelType=`Este combustible no es compatible con la categoría ${f.name}`)),["enginePower","fuelCapacity","operatingWeight","loadCapacity","bucketCapacity","flow","pressure","weight"].forEach(D=>{q[D]&&(isNaN(q[D])||Number(q[D])<0)&&(C[D]="Debe ser un número válido mayor o igual a 0")}),q.year&&(q.year<1900||q.year>new Date().getFullYear()+1)&&(C.year=`Año debe estar entre 1900 y ${new Date().getFullYear()+1}`),q.hasHourMeter&&q.currentHours&&(isNaN(q.currentHours)||Number(q.currentHours)<0)&&(C.currentHours="Horas actuales debe ser un número válido mayor o igual a 0"),T(C),Object.keys(C).length===0},V=async C=>{if(C.preventDefault(),!!R())try{N(!0);const M={...q,type:f?.name||q.category||"Otro",enginePower:q.enginePower?Number(q.enginePower):null,fuelCapacity:q.fuelCapacity?Number(q.fuelCapacity):null,operatingWeight:q.operatingWeight?Number(q.operatingWeight):null,loadCapacity:q.loadCapacity?Number(q.loadCapacity):null,bucketCapacity:q.bucketCapacity?Number(q.bucketCapacity):null,currentHours:q.currentHours?Number(q.currentHours):null,flow:q.flow?Number(q.flow):null,pressure:q.pressure?Number(q.pressure):null,weight:q.weight?Number(q.weight):null,year:Number(q.year),lastMaintenanceDate:q.lastMaintenanceDate?new Date(q.lastMaintenanceDate):null,purchaseDate:q.purchaseDate?new Date(q.purchaseDate):null,categoryName:f?.name,categoryIcon:f?.icon,categoryColor:f?.color};await i(M),e()}catch(M){console.error("Error guardando vehículo:",M),T({submit:M.message})}finally{N(!1)}},P=()=>f&&f.fuelTypes||Object.values(vt);return n?a.jsxs("div",{className:"modal-overlay",children:[a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("h2",{children:o==="create"?"🚗 Nuevo Vehículo":"✏️ Editar Vehículo"}),a.jsxs("div",{className:"header-actions",children:[a.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>y(!0),disabled:j,children:"📋 Gestionar Categorías"}),a.jsx("button",{type:"button",className:"btn-close",onClick:e,children:"✕"})]})]}),a.jsxs("form",{onSubmit:V,className:"modal-body",children:[w.submit&&a.jsxs("div",{className:"error-banner",children:["⚠️ ",w.submit]}),a.jsxs("div",{className:"form-section",children:[a.jsx("h3",{children:"📂 Categoría del Vehículo"}),j?a.jsxs("div",{className:"loading-categories",children:[a.jsx("div",{className:"spinner"}),a.jsx("span",{children:"Cargando categorías..."})]}):a.jsxs("div",{className:"categories-selector",children:[a.jsxs("select",{value:q.category,onChange:C=>U(C.target.value),className:`category-select ${w.category?"error":""}`,children:[a.jsx("option",{value:"",children:"Seleccionar categoría del vehículo..."}),c.map(C=>a.jsxs("option",{value:C.id,children:[C.icon," ",C.name,cs.some(M=>M.id===C.id)&&" (Predeterminada)"]},C.id))]}),f&&a.jsx(EV,{category:f,isExpanded:b,onToggle:()=>E(!b)})]}),w.category&&a.jsx("span",{className:"field-error",children:w.category})]}),a.jsxs("div",{className:"form-section",children:[a.jsx("h3",{children:"📝 Información Básica"}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"vehicleId",className:"form-label",children:"🏷️ Código del Vehículo *"}),a.jsx("input",{type:"text",id:"vehicleId",value:q.vehicleId,className:`form-input ${w.vehicleId?"error":""} ${o==="create"?"readonly":""}`,placeholder:"Se genera automáticamente",readOnly:o==="create",onChange:o==="edit"?C=>$("vehicleId",C.target.value):void 0,required:!0}),w.vehicleId&&a.jsx("span",{className:"field-error",children:w.vehicleId})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"name",className:"form-label",children:"📛 Nombre del Vehículo *"}),a.jsx("input",{type:"text",id:"name",value:q.name,onChange:C=>$("name",C.target.value),className:`form-input ${w.name?"error":""}`,placeholder:"Ej: Excavadora Principal, Tractor TR1",required:!0}),w.name&&a.jsx("span",{className:"field-error",children:w.name})]})]}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"brand",className:"form-label",children:"🏭 Marca"}),a.jsx("input",{type:"text",id:"brand",value:q.brand,onChange:C=>$("brand",C.target.value),className:"form-input",placeholder:"Ej: Caterpillar, John Deere"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"year",className:"form-label",children:"📅 Año"}),a.jsx("input",{type:"number",id:"year",value:q.year,onChange:C=>$("year",C.target.value),className:`form-input ${w.year?"error":""}`,min:"1900",max:new Date().getFullYear()+1}),w.year&&a.jsx("span",{className:"field-error",children:w.year})]})]}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"fuelType",className:"form-label",children:"⛽ Tipo de Combustible *"}),a.jsx("select",{id:"fuelType",value:q.fuelType,onChange:C=>$("fuelType",C.target.value),className:`form-input ${w.fuelType?"error":""}`,required:!0,children:P().map(C=>a.jsx("option",{value:C,children:C},C))}),w.fuelType&&a.jsx("span",{className:"field-error",children:w.fuelType})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"status",className:"form-label",children:"🚦 Estado"}),a.jsx("select",{id:"status",value:q.status,onChange:C=>$("status",C.target.value),className:"form-input",children:Object.entries(Ve).map(([C,M])=>a.jsx("option",{value:M,children:M.charAt(0).toUpperCase()+M.slice(1)},C))})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"currentLocation",className:"form-label",children:"📍 Ubicación Actual"}),a.jsx("input",{type:"text",id:"currentLocation",value:q.currentLocation,onChange:C=>$("currentLocation",C.target.value),className:"form-input",placeholder:"Ej: Sector Norte, Patio Principal"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"description",className:"form-label",children:"📄 Descripción"}),a.jsx("textarea",{id:"description",value:q.description,onChange:C=>$("description",C.target.value),className:"form-input",rows:"3",placeholder:"Descripción adicional del vehículo, características especiales, etc."})]})]}),a.jsxs("div",{className:"form-section",children:[a.jsx("h3",{children:"📅 Fechas Importantes"}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"purchaseDate",className:"form-label",children:"💰 Fecha de Compra"}),a.jsx("input",{type:"date",id:"purchaseDate",value:q.purchaseDate,onChange:C=>$("purchaseDate",C.target.value),className:"form-input"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"lastMaintenanceDate",className:"form-label",children:"🔧 Último Mantenimiento"}),a.jsx("input",{type:"date",id:"lastMaintenanceDate",value:q.lastMaintenanceDate,onChange:C=>$("lastMaintenanceDate",C.target.value),className:"form-input"})]})]})]}),f&&a.jsxs("div",{className:"form-section",children:[a.jsx("h3",{children:"👁️ Vista Previa"}),a.jsx("div",{className:"vehicle-preview",style:{"--category-color":f.color},children:a.jsxs("div",{className:"preview-header",children:[a.jsx("div",{className:"preview-icon",style:{color:f.color},children:f.icon}),a.jsxs("div",{className:"preview-info",children:[a.jsx("h4",{children:q.name||"Nombre del vehículo"}),a.jsxs("p",{children:[q.vehicleId||"Código del vehículo"," • ",f.name]}),a.jsxs("p",{children:[q.brand," ",q.year]})]})]})})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn-secondary",onClick:e,disabled:j,children:"Cancelar"}),a.jsx("button",{type:"submit",className:"btn-primary",disabled:j||!f,children:j?"Guardando...":o==="create"?"Crear Vehículo":"Actualizar Vehículo"})]})]})]}),g&&a.jsx(QA,{onClose:()=>y(!1),onCategoryCreated:C=>{d(M=>[...M,C]),y(!1)}})]}):null},EV=({category:n,isExpanded:e,onToggle:t})=>n?a.jsxs("div",{className:"category-info-panel",children:[a.jsxs("div",{className:"category-compact",children:[a.jsxs("div",{className:"category-summary",children:[a.jsx("span",{className:"category-icon",style:{color:n.color},children:n.icon}),a.jsxs("div",{className:"category-basic-info",children:[a.jsx("span",{className:"category-name",children:n.name}),a.jsx("span",{className:"category-short-desc",children:n.description?.length>50?n.description.substring(0,50)+"...":n.description})]})]}),a.jsx("button",{type:"button",className:"category-toggle-btn",onClick:t,"aria-label":e?"Contraer información":"Expandir información",children:e?"▲":"▼"})]}),e&&a.jsxs("div",{className:"category-expanded",children:[a.jsxs("div",{className:"category-detail-section",children:[a.jsx("h4",{children:"📋 Descripción Completa"}),a.jsx("p",{children:n.description})]}),n.fuelTypes&&n.fuelTypes.length>0&&a.jsxs("div",{className:"category-detail-section",children:[a.jsx("h4",{children:"⛽ Combustibles Compatibles"}),a.jsx("div",{className:"fuel-types-list",children:n.fuelTypes.map(i=>a.jsx("span",{className:"fuel-type-badge",children:i},i))})]}),n.fields&&n.fields.length>0&&a.jsxs("div",{className:"category-detail-section",children:[a.jsx("h4",{children:"🔧 Campos Específicos"}),a.jsx("div",{className:"fields-list",children:n.fields.map(i=>a.jsx("span",{className:"field-badge",children:i},i))})]}),n.isCustom&&a.jsx("div",{className:"category-detail-section",children:a.jsx("span",{className:"custom-badge",children:"✨ Categoría Personalizada"})})]})]}):null,Vo={PREVENTIVO:"preventivo",CORRECTIVO:"correctivo",PREDICTIVO:"predictivo",EMERGENCIA:"emergencia"},mi={PROGRAMADO:"programado",EN_PROCESO:"en_proceso",COMPLETADO:"completado",CANCELADO:"cancelado"},Uo={BAJA:"baja",MEDIA:"media",ALTA:"alta",CRITICA:"critica"},_V=({isOpen:n,onClose:e,vehicle:t,maintenance:i,onSave:o,mode:c="create",userRole:d})=>{const f=()=>({vehicleId:t?.vehicleId||"",vehicleName:t?.name||"",type:i?.type||Vo.PREVENTIVO,title:i?.title||"",description:i?.description||"",priority:i?.priority||Uo.MEDIA,status:i?.status||mi.PROGRAMADO,scheduledDate:i?.scheduledDate?new Date(i.scheduledDate).toISOString().split("T")[0]:"",startDate:i?.startDate?new Date(i.startDate).toISOString().split("T")[0]:"",completedDate:i?.completedDate?new Date(i.completedDate).toISOString().split("T")[0]:"",estimatedHours:i?.estimatedHours||0,actualHours:i?.actualHours||0,estimatedCost:i?.estimatedCost||0,actualCost:i?.actualCost||0,technician:i?.technician||"",workshop:i?.workshop||"",parts:i?.parts||[],notes:i?.notes||"",nextMaintenanceKm:i?.nextMaintenanceKm||0,nextMaintenanceHours:i?.nextMaintenanceHours||0,nextMaintenanceDate:i?.nextMaintenanceDate?new Date(i.nextMaintenanceDate).toISOString().split("T")[0]:""}),[p,g]=z.useState(f()),[y,b]=z.useState({}),[E,j]=z.useState(!1),[N,w]=z.useState({name:"",quantity:1,cost:0});z.useEffect(()=>{n&&(g(f()),b({}))},[n,i,t]);const T=M=>{const{name:D,value:le,type:ve}=M.target,Q=ve==="number"?parseFloat(le)||0:le;g(se=>({...se,[D]:Q})),y[D]&&b(se=>({...se,[D]:null}))},S=M=>{const{name:D,value:le,type:ve}=M.target,Q=ve==="number"?parseFloat(le)||0:le;w(se=>({...se,[D]:Q}))},q=()=>{if(!N.name.trim())return;const M={id:Date.now().toString(),name:N.name.trim(),quantity:N.quantity,cost:N.cost,total:N.quantity*N.cost};g(D=>({...D,parts:[...D.parts,M]})),w({name:"",quantity:1,cost:0})},I=M=>{g(D=>({...D,parts:D.parts.filter(le=>le.id!==M)}))},O=()=>{const M={};if(p.title.trim()||(M.title="El título del mantenimiento es obligatorio"),p.description.trim()||(M.description="La descripción es obligatoria"),p.scheduledDate||(M.scheduledDate="La fecha programada es obligatoria"),p.startDate&&p.completedDate){const D=new Date(p.startDate);new Date(p.completedDate)<D&&(M.completedDate="La fecha de finalización debe ser posterior al inicio")}return p.scheduledDate&&p.startDate&&(new Date(p.scheduledDate),new Date(p.startDate)),p.estimatedHours<0&&(M.estimatedHours="Las horas estimadas no pueden ser negativas"),p.actualHours<0&&(M.actualHours="Las horas reales no pueden ser negativas"),p.estimatedCost<0&&(M.estimatedCost="El costo estimado no puede ser negativo"),p.actualCost<0&&(M.actualCost="El costo real no puede ser negativo"),p.status===mi.COMPLETADO&&!p.completedDate&&(M.completedDate="La fecha de finalización es obligatoria para mantenimientos completados"),p.status===mi.EN_PROCESO&&!p.startDate&&(M.startDate="La fecha de inicio es obligatoria para mantenimientos en proceso"),b(M),Object.keys(M).length===0},U=async M=>{if(M.preventDefault(),!!O()){j(!0);try{const D=p.parts.reduce((se,me)=>se+me.total,0),le=p.estimatedCost+D,ve=p.actualCost+D,Q={...p,vehicleId:t.id,vehicleName:t.name,totalPartsCost:D,totalEstimatedCost:le,totalActualCost:ve,scheduledDate:p.scheduledDate||null,startDate:p.startDate||null,completedDate:p.completedDate||null,nextMaintenanceDate:p.nextMaintenanceDate||null,createdAt:i?.createdAt||new Date,updatedAt:new Date};await o(Q),e()}catch(D){console.error("Error guardando mantenimiento:",D),b({general:"Error al guardar el mantenimiento. Intenta nuevamente."})}finally{j(!1)}}},$=M=>{switch(M){case Vo.PREVENTIVO:return"🔧";case Vo.CORRECTIVO:return"🛠️";case Vo.PREDICTIVO:return"📊";case Vo.EMERGENCIA:return"🚨";default:return"⚙️"}},F=M=>{switch(M){case Uo.BAJA:return"priority-low";case Uo.MEDIA:return"priority-medium";case Uo.ALTA:return"priority-high";case Uo.CRITICA:return"priority-critical";default:return"priority-medium"}},R=M=>{switch(M){case mi.PROGRAMADO:return"status-scheduled";case mi.EN_PROCESO:return"status-in-progress";case mi.COMPLETADO:return"status-completed";case mi.CANCELADO:return"status-cancelled";default:return"status-scheduled"}},V=()=>p.parts.reduce((M,D)=>M+D.total,0),P=c==="view",C=d==="admin"||d==="supervisor";return n?a.jsx("div",{className:"modal-overlay",onClick:e,children:a.jsxs("div",{className:"modal-content maintenance-modal",onClick:M=>M.stopPropagation(),children:[a.jsxs("div",{className:"modal-header",children:[a.jsxs("div",{className:"modal-title",children:[a.jsx("span",{className:"title-icon",children:c==="create"?"➕":c==="edit"?"✏️":"👁️"}),a.jsxs("div",{className:"title-text",children:[a.jsxs("h3",{children:[c==="create"&&"Registrar Mantenimiento",c==="edit"&&"Editar Mantenimiento",c==="view"&&"Detalles del Mantenimiento"]}),a.jsxs("p",{children:["Vehículo: ",t?.vehicleId," - ",t?.name]})]})]}),a.jsx("button",{className:"btn-close",onClick:e,type:"button",children:"✕"})]}),a.jsxs("form",{onSubmit:U,className:"modal-form",children:[a.jsxs("div",{className:"form-content",children:[y.general&&a.jsxs("div",{className:"error-message general-error",children:["⚠️ ",y.general]}),a.jsxs("div",{className:"form-section",children:[a.jsx("h4",{className:"section-title",children:"📋 Información del Mantenimiento"}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"type",children:"Tipo de Mantenimiento"}),a.jsx("select",{id:"type",name:"type",value:p.type,onChange:T,disabled:P||c==="edit"&&!C,children:Object.values(Vo).map(M=>a.jsxs("option",{value:M,children:[$(M)," ",M.charAt(0).toUpperCase()+M.slice(1)]},M))})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"priority",children:"Prioridad"}),a.jsx("select",{id:"priority",name:"priority",value:p.priority,onChange:T,className:F(p.priority),disabled:P||c==="edit"&&!C,children:Object.values(Uo).map(M=>a.jsx("option",{value:M,children:M.charAt(0).toUpperCase()+M.slice(1)},M))})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"status",children:"Estado"}),a.jsx("select",{id:"status",name:"status",value:p.status,onChange:T,className:R(p.status),disabled:P||c==="edit"&&!C,children:Object.values(mi).map(M=>a.jsx("option",{value:M,children:M.charAt(0).toUpperCase()+M.slice(1).replace("_"," ")},M))})]}),a.jsxs("div",{className:"form-group full-width",children:[a.jsx("label",{htmlFor:"title",children:"Título del Mantenimiento *"}),a.jsx("input",{type:"text",id:"title",name:"title",value:p.title,onChange:T,placeholder:"Ej: Cambio de aceite y filtros",className:y.title?"error":"",disabled:P||c==="edit"&&!C,maxLength:100}),y.title&&a.jsx("span",{className:"error-text",children:y.title})]})]})]}),a.jsxs("div",{className:"form-section",children:[a.jsx("h4",{className:"section-title",children:"📅 Programación"}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"scheduledDate",children:"Fecha Programada *"}),a.jsx("input",{type:"date",id:"scheduledDate",name:"scheduledDate",value:p.scheduledDate,onChange:T,className:y.scheduledDate?"error":"",disabled:P||c==="edit"&&!C}),y.scheduledDate&&a.jsx("span",{className:"error-text",children:y.scheduledDate})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"startDate",children:"Fecha de Inicio"}),a.jsx("input",{type:"date",id:"startDate",name:"startDate",value:p.startDate,onChange:T,className:y.startDate?"error":"",disabled:P||c==="edit"&&!C}),y.startDate&&a.jsx("span",{className:"error-text",children:y.startDate})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"completedDate",children:"Fecha de Finalización"}),a.jsx("input",{type:"date",id:"completedDate",name:"completedDate",value:p.completedDate,onChange:T,className:y.completedDate?"error":"",disabled:P||c==="edit"&&!C}),y.completedDate&&a.jsx("span",{className:"error-text",children:y.completedDate})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"nextMaintenanceDate",children:"Próximo Mantenimiento"}),a.jsx("input",{type:"date",id:"nextMaintenanceDate",name:"nextMaintenanceDate",value:p.nextMaintenanceDate,onChange:T,disabled:P||c==="edit"&&!C})]})]})]}),a.jsxs("div",{className:"form-section",children:[a.jsx("h4",{className:"section-title",children:"💰 Recursos y Costos"}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"technician",children:"Técnico Responsable"}),a.jsx("input",{type:"text",id:"technician",name:"technician",value:p.technician,onChange:T,placeholder:"Nombre del técnico",disabled:P||c==="edit"&&!C,maxLength:100})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"workshop",children:"Taller/Ubicación"}),a.jsx("input",{type:"text",id:"workshop",name:"workshop",value:p.workshop,onChange:T,placeholder:"Taller donde se realiza",disabled:P||c==="edit"&&!C,maxLength:100})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"estimatedHours",children:"Horas Estimadas"}),a.jsx("input",{type:"number",id:"estimatedHours",name:"estimatedHours",value:p.estimatedHours,onChange:T,min:"0",step:"0.5",className:y.estimatedHours?"error":"",disabled:P||c==="edit"&&!C}),y.estimatedHours&&a.jsx("span",{className:"error-text",children:y.estimatedHours})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"actualHours",children:"Horas Reales"}),a.jsx("input",{type:"number",id:"actualHours",name:"actualHours",value:p.actualHours,onChange:T,min:"0",step:"0.5",className:y.actualHours?"error":"",disabled:P||c==="edit"&&!C}),y.actualHours&&a.jsx("span",{className:"error-text",children:y.actualHours})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"estimatedCost",children:"Costo Estimado (COP)"}),a.jsx("input",{type:"number",id:"estimatedCost",name:"estimatedCost",value:p.estimatedCost,onChange:T,min:"0",step:"1000",className:y.estimatedCost?"error":"",disabled:P||c==="edit"&&!C}),y.estimatedCost&&a.jsx("span",{className:"error-text",children:y.estimatedCost})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"actualCost",children:"Costo Real (COP)"}),a.jsx("input",{type:"number",id:"actualCost",name:"actualCost",value:p.actualCost,onChange:T,min:"0",step:"1000",className:y.actualCost?"error":"",disabled:P||c==="edit"&&!C}),y.actualCost&&a.jsx("span",{className:"error-text",children:y.actualCost})]})]})]}),a.jsxs("div",{className:"form-section",children:[a.jsx("h4",{className:"section-title",children:"🔧 Partes y Repuestos"}),!P&&C&&a.jsx("div",{className:"parts-form",children:a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"partName",children:"Nombre de la Parte"}),a.jsx("input",{type:"text",id:"partName",name:"name",value:N.name,onChange:S,placeholder:"Ej: Filtro de aceite",maxLength:100})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"partQuantity",children:"Cantidad"}),a.jsx("input",{type:"number",id:"partQuantity",name:"quantity",value:N.quantity,onChange:S,min:"1",step:"1"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"partCost",children:"Costo Unitario (COP)"}),a.jsx("input",{type:"number",id:"partCost",name:"cost",value:N.cost,onChange:S,min:"0",step:"1000"})]}),a.jsx("div",{className:"form-group",children:a.jsx("button",{type:"button",className:"btn-add-part",onClick:q,disabled:!N.name.trim(),children:"➕ Agregar"})})]})}),p.parts.length>0&&a.jsx("div",{className:"parts-list",children:a.jsxs("table",{className:"parts-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Parte"}),a.jsx("th",{children:"Cantidad"}),a.jsx("th",{children:"Costo Unit."}),a.jsx("th",{children:"Total"}),!P&&C&&a.jsx("th",{children:"Acciones"})]})}),a.jsx("tbody",{children:p.parts.map(M=>a.jsxs("tr",{children:[a.jsx("td",{children:M.name}),a.jsx("td",{children:M.quantity}),a.jsxs("td",{children:["$",M.cost.toLocaleString("es-CO")]}),a.jsxs("td",{children:["$",M.total.toLocaleString("es-CO")]}),!P&&C&&a.jsx("td",{children:a.jsx("button",{type:"button",className:"btn-remove-part",onClick:()=>I(M.id),title:"Eliminar parte",children:"🗑️"})})]},M.id))}),a.jsx("tfoot",{children:a.jsxs("tr",{className:"total-row",children:[a.jsx("td",{colSpan:"3",children:a.jsx("strong",{children:"Total Partes:"})}),a.jsx("td",{children:a.jsxs("strong",{children:["$",V().toLocaleString("es-CO")]})}),!P&&C&&a.jsx("td",{})]})})]})})]}),a.jsxs("div",{className:"form-section",children:[a.jsx("h4",{className:"section-title",children:"🔄 Próximo Mantenimiento"}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"nextMaintenanceKm",children:"Próximo Mantenimiento (Km)"}),a.jsx("input",{type:"number",id:"nextMaintenanceKm",name:"nextMaintenanceKm",value:p.nextMaintenanceKm,onChange:T,min:"0",step:"1000",placeholder:"0 = No aplica",disabled:P||c==="edit"&&!C})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"nextMaintenanceHours",children:"Próximo Mantenimiento (Horas)"}),a.jsx("input",{type:"number",id:"nextMaintenanceHours",name:"nextMaintenanceHours",value:p.nextMaintenanceHours,onChange:T,min:"0",step:"100",placeholder:"0 = No aplica",disabled:P||c==="edit"&&!C})]})]})]}),a.jsxs("div",{className:"form-section",children:[a.jsx("h4",{className:"section-title",children:"📝 Descripción y Notas"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"description",children:"Descripción del Trabajo *"}),a.jsx("textarea",{id:"description",name:"description",value:p.description,onChange:T,placeholder:"Describe el trabajo a realizar o realizado...",rows:"3",maxLength:"500",className:y.description?"error":"",disabled:P||c==="edit"&&!C}),y.description&&a.jsx("span",{className:"error-text",children:y.description})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"notes",children:"Notas Adicionales"}),a.jsx("textarea",{id:"notes",name:"notes",value:p.notes,onChange:T,placeholder:"Observaciones, recomendaciones, problemas encontrados...",rows:"3",maxLength:"500",disabled:P||c==="edit"&&!C}),a.jsxs("span",{className:"char-count",children:[p.notes.length,"/500 caracteres"]})]})]}),a.jsxs("div",{className:"cost-summary",children:[a.jsx("h4",{children:"💰 Resumen de Costos"}),a.jsxs("div",{className:"cost-grid",children:[a.jsxs("div",{className:"cost-item",children:[a.jsx("span",{className:"cost-label",children:"Mano de Obra:"}),a.jsxs("span",{className:"cost-value",children:["$",p.actualCost.toLocaleString("es-CO")]})]}),a.jsxs("div",{className:"cost-item",children:[a.jsx("span",{className:"cost-label",children:"Partes:"}),a.jsxs("span",{className:"cost-value",children:["$",V().toLocaleString("es-CO")]})]}),a.jsxs("div",{className:"cost-item total-cost",children:[a.jsx("span",{className:"cost-label",children:"Total:"}),a.jsxs("span",{className:"cost-value",children:["$",(p.actualCost+V()).toLocaleString("es-CO")]})]})]})]})]}),a.jsxs("div",{className:"modal-footer",children:[a.jsx("button",{type:"button",className:"btn-secondary",onClick:e,disabled:E,children:c==="view"?"Cerrar":"Cancelar"}),!P&&C&&a.jsx("button",{type:"submit",className:"btn-primary",disabled:E,children:E?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"loading-spinner"}),"Guardando..."]}):a.jsx(a.Fragment,{children:c==="create"?"➕ Registrar Mantenimiento":"💾 Guardar Cambios"})})]})]})]})}):null},TV=()=>{const{user:n,userProfile:e}=Qn(),[t,i]=z.useState([]),[o,c]=z.useState(null),[d,f]=z.useState(!0),[p,g]=z.useState(null),[y,b]=z.useState({type:"",status:"",fuelType:"",location:"",maintenance:"all"}),[E,j]=z.useState("cards"),[N,w]=z.useState(""),[T,S]=z.useState(!1),[q,I]=z.useState(!1),[O,U]=z.useState(!1),[$,F]=z.useState(null),[R,V]=z.useState("create");z.useEffect(()=>{if(!n)return;f(!0);const ee=ay((ce,ue)=>{if(ue){console.error("Error en suscripción de vehículos:",ue),g("Error al cargar vehículos"),f(!1);return}i(ce),g(null),f(!1)},y);return()=>ee()},[n,y]),z.useEffect(()=>{n&&(async()=>{try{const ce=await qA(y);c(ce)}catch(ce){console.error("Error al cargar estadísticas:",ce)}})()},[n,t,y]);const P=t.filter(ee=>{if(!N)return!0;const ce=N.toLowerCase();return ee.vehicleId?.toLowerCase().includes(ce)||ee.name?.toLowerCase().includes(ce)||ee.type?.toLowerCase().includes(ce)||ee.brand?.toLowerCase().includes(ce)||ee.model?.toLowerCase().includes(ce)||ee.currentLocation?.toLowerCase().includes(ce)||ee.description?.toLowerCase().includes(ce)}),C=()=>{F(null),V("create"),S(!0)},M=ee=>{F(ee),V("edit"),S(!0)},D=ee=>{F(ee),V("view"),S(!0)},le=ee=>{F(ee),I(!0)},ve=()=>{S(!1),I(!1),F(null)},Q=ee=>{b(ce=>({...ce,...ee}))},se=()=>{b({type:"",status:"",fuelType:"",location:"",maintenance:"all"}),w("")},me=e?.role==="admin"||e?.role==="contador"||e?.role==="cliente",Oe=e?.role==="admin",H=e?.role==="admin"||e?.role==="contador";return d?a.jsx("div",{className:"vehicles-main",children:a.jsxs("div",{className:"loading-container",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Cargando vehículos..."})]})}):p?a.jsx("div",{className:"vehicles-main",children:a.jsxs("div",{className:"error-container",children:[a.jsx("div",{className:"error-icon",children:"⚠️"}),a.jsx("h3",{children:"Error al cargar vehículos"}),a.jsx("p",{children:p}),a.jsx("button",{className:"btn-retry",onClick:()=>window.location.reload(),children:"Reintentar"})]})}):a.jsxs("div",{className:"vehicles-main",children:[a.jsxs("div",{className:"vehicles-header",children:[a.jsxs("div",{className:"header-title",children:[a.jsx("h2",{children:"🚜 Gestión de Vehículos"}),a.jsx("p",{children:"Administra la maquinaria y vehículos forestales"})]}),me&&a.jsx("button",{className:"btn-create-vehicle",onClick:C,children:"➕ Nuevo Vehículo"})]}),o&&a.jsx(uV,{stats:o,filters:y}),a.jsx(dV,{filters:y,onFilterChange:Q,onClearFilters:se,searchTerm:N,onSearchChange:w,viewMode:E,onViewModeChange:j,totalResults:P.length}),P.length===0?a.jsxs("div",{className:"empty-state",children:[a.jsx("div",{className:"empty-icon",children:"🚜"}),a.jsx("h3",{children:t.length===0?"No hay vehículos registrados":"No se encontraron vehículos"}),a.jsx("p",{children:t.length===0?"Comienza registrando tu primer vehículo o maquinaria forestal":"Intenta ajustar los filtros de búsqueda"}),t.length===0&&me&&a.jsx("button",{className:"btn-create-first",onClick:C,children:"➕ Registrar Primer Vehículo"})]}):a.jsx(mV,{vehicles:P,viewMode:E,onEdit:Oe?M:null,onView:D,onMaintenance:H?le:null,userRole:n?.role}),T&&a.jsx(NV,{isOpen:T,onClose:ve,vehicle:$,mode:R,onSave:async ee=>{R==="create"?await VA(ee):await FA($.id,ee),ve()},userRole:e?.role}),O&&a.jsx(QA,{onClose:()=>U(!1),onCategoryCreated:()=>{}}),q&&a.jsx(_V,{isOpen:q,onClose:ve,vehicle:$,onSuccess:()=>{ve()}})]})},ju="combustibles_maintenance",KA="combustibles_vehicles",pe={OIL_CHANGE:"oil_change",BATTERY_CHANGE:"battery_change",FILTER_CHANGE:"filter_change",GENERAL_MAINTENANCE:"general_maintenance"},Pe={COMPLETED:"completado",PENDING:"pendiente",CANCELLED:"cancelado"},Yo={NEW:"nueva",USED:"usada",REPAIRED:"reparada"},oy={OIL_CHANGE_HOURS:250,BATTERY_LIFETIME_MONTHS:24},XA=async n=>{try{AV(n);const e={...n,createdAt:Ue(),updatedAt:Ue(),status:n.status||Pe.COMPLETED,createdBy:n.createdBy||"system"};n.type===pe.OIL_CHANGE&&(e.nextChangeHours=Af(n.currentHours)),n.type===pe.BATTERY_CHANGE&&(e.nextBatteryChange=nC(n.date));const t=await gl(Ee(he,ju),e);return n.vehicleId&&n.currentHours&&await sC(n.vehicleId,n.currentHours),console.log("✅ Mantenimiento creado exitosamente:",t.id),t.id}catch(e){throw console.error("❌ Error al crear mantenimiento:",e),new Error(`Error al crear mantenimiento: ${e.message}`)}},WA=async(n={})=>{try{let e=Ee(he,ju);n.type&&(e=Ae(e,De("type","==",n.type))),n.vehicleId&&(e=Ae(e,De("vehicleId","==",n.vehicleId))),n.status&&(e=Ae(e,De("status","==",n.status))),n.dateFrom&&(e=Ae(e,De("date",">=",new Date(n.dateFrom)))),n.dateTo&&(e=Ae(e,De("date","<=",new Date(n.dateTo)))),e=Ae(e,Cn("date","desc"));const t=await He(e),i=[];return t.forEach(o=>{i.push({id:o.id,...o.data()})}),i}catch(e){throw console.error("❌ Error al obtener mantenimientos:",e),new Error(`Error al obtener mantenimientos: ${e.message}`)}},ZA=async(n,e)=>{try{CV(e);const t=et(he,ju,n),i={...e,updatedAt:Ue()};e.currentHours&&e.type===pe.OIL_CHANGE&&(i.nextChangeHours=Af(e.currentHours)),await As(t,i),e.vehicleId&&e.currentHours&&await sC(e.vehicleId,e.currentHours),console.log("✅ Mantenimiento actualizado exitosamente:",n)}catch(t){throw console.error("❌ Error al actualizar mantenimiento:",t),new Error(`Error al actualizar mantenimiento: ${t.message}`)}},jV=async n=>{try{const e=et(he,ju,n);await xf(e),console.log("✅ Mantenimiento eliminado exitosamente:",n)}catch(e){throw console.error("❌ Error al eliminar mantenimiento:",e),new Error(`Error al eliminar mantenimiento: ${e.message}`)}},JA=async(n={})=>{try{const e=await WA(n),t={total:e.length,byType:{},byStatus:{},byVehicle:{},totalCost:0,averageCost:0,upcomingCount:0,overdueCount:0};let i=0;return e.forEach(o=>{t.byType[o.type]=(t.byType[o.type]||0)+1,t.byStatus[o.status]=(t.byStatus[o.status]||0)+1,t.byVehicle[o.vehicleId]=(t.byVehicle[o.vehicleId]||0)+1,o.cost&&(i+=parseFloat(o.cost)),o.nextChangeDate&&(new Date(o.nextChangeDate)>new Date?t.upcomingCount++:t.overdueCount++)}),t.totalCost=i,t.averageCost=t.total>0?i/t.total:0,t}catch(e){throw console.error("❌ Error al obtener estadísticas de mantenimiento:",e),new Error(`Error al obtener estadísticas de mantenimiento: ${e.message}`)}},eC=(n,e={})=>{try{let t=Ee(he,ju);return e.type&&(t=Ae(t,De("type","==",e.type))),e.vehicleId&&(t=Ae(t,De("vehicleId","==",e.vehicleId))),e.status&&(t=Ae(t,De("status","==",e.status))),t=Ae(t,Cn("date","desc")),zr(t,o=>{const c=[];o.forEach(d=>{c.push({id:d.id,...d.data()})}),n(c,null)},o=>{console.error("❌ Error en suscripción de mantenimientos:",o),n([],o)})}catch(t){return console.error("❌ Error al suscribirse a mantenimientos:",t),n([],t),()=>{}}},tC=async()=>{try{const n=Ae(Ee(he,KA),De("status","in",["activo","mantenimiento"]),Cn("name","asc")),e=await He(n),t=[];return e.forEach(i=>{t.push({id:i.id,...i.data()})}),t}catch(n){throw console.error("❌ Error al obtener vehículos para mantenimiento:",n),new Error(`Error al obtener vehículos para mantenimiento: ${n.message}`)}},Af=n=>parseInt(n)+oy.OIL_CHANGE_HOURS,nC=n=>{const e=new Date(n);return e.setMonth(e.getMonth()+oy.BATTERY_LIFETIME_MONTHS),e},sC=async(n,e)=>{try{const t=Ae(Ee(he,KA),De("vehicleId","==",n)),i=await He(t);if(!i.empty){const o=i.docs[0],c=o.data();if(c.hasHourMeter&&c.type==="tractor"){const d=parseInt(c.currentHours)||0,f=parseInt(e)||0;f>d&&(await As(o.ref,{currentHours:f,lastHourMeterDate:Ue(),updatedAt:Ue()}),console.log(`✅ Horómetro actualizado para ${n}: ${d} → ${f}`))}}}catch(t){console.error("❌ Error al actualizar horómetro del vehículo:",t)}},AV=n=>{const e=[];if(n.type||e.push("El tipo de mantenimiento es obligatorio"),n.vehicleId||e.push("El vehículo es obligatorio"),n.date||e.push("La fecha es obligatoria"),n.type===pe.OIL_CHANGE&&((!n.quantity||n.quantity<=0)&&e.push("La cantidad de aceite es obligatoria y debe ser mayor a 0"),(!n.currentHours||n.currentHours<0)&&e.push("La lectura del horómetro es obligatoria")),n.type===pe.BATTERY_CHANGE&&(n.batteryType||e.push("El tipo de batería es obligatorio"),(!n.cost||n.cost<=0)&&e.push("El costo de la batería es obligatorio")),e.length>0)throw new Error(e.join(", "))},CV=n=>{const e=[];if(n.type&&!Object.values(pe).includes(n.type)&&e.push("Tipo de mantenimiento inválido"),n.status&&!Object.values(Pe).includes(n.status)&&e.push("Estado de mantenimiento inválido"),n.batteryStatus&&!Object.values(Yo).includes(n.batteryStatus)&&e.push("Estado de batería inválido"),e.length>0)throw new Error(e.join(", "))},wV=Object.freeze(Object.defineProperty({__proto__:null,BATTERY_STATUS:Yo,MAINTENANCE_CONSTANTS:oy,MAINTENANCE_STATUS:Pe,MAINTENANCE_TYPES:pe,calculateNextBatteryChange:nC,calculateNextOilChange:Af,createMaintenanceRecord:XA,deleteMaintenanceRecord:jV,getAllMaintenanceRecords:WA,getMaintenanceStats:JA,getVehiclesForMaintenance:tC,subscribeToMaintenance:eC,updateMaintenanceRecord:ZA},Symbol.toStringTag,{value:"Module"})),SV=({stats:n})=>{if(!n)return null;const e=c=>{switch(c){case pe.OIL_CHANGE:return"🛢️";case pe.BATTERY_CHANGE:return"🔋";case pe.FILTER_CHANGE:return"🔧";case pe.GENERAL_MAINTENANCE:return"⚙️";default:return"🔧"}},t=c=>{switch(c){case pe.OIL_CHANGE:return"Cambios de Aceite";case pe.BATTERY_CHANGE:return"Cambios de Batería";case pe.FILTER_CHANGE:return"Cambios de Filtros";case pe.GENERAL_MAINTENANCE:return"Mantenimientos Generales";default:return c}},i=c=>{switch(c){case Pe.COMPLETED:return"#10b981";case Pe.PENDING:return"#f59e0b";case Pe.CANCELLED:return"#ef4444";default:return"#6b7280"}},o=c=>{switch(c){case Pe.COMPLETED:return"Completados";case Pe.PENDING:return"Pendientes";case Pe.CANCELLED:return"Cancelados";default:return c}};return a.jsxs("div",{className:"maintenance-stats",children:[a.jsxs("div",{className:"stats-grid",children:[a.jsxs("div",{className:"stat-card primary",children:[a.jsx("div",{className:"stat-icon",children:"🔧"}),a.jsxs("div",{className:"stat-content",children:[a.jsx("h3",{children:be(n.total)}),a.jsx("p",{children:"Total Mantenimientos"})]})]}),a.jsxs("div",{className:"stat-card success",children:[a.jsx("div",{className:"stat-icon",children:"💰"}),a.jsxs("div",{className:"stat-content",children:[a.jsx("h3",{children:Nt(n.totalCost)}),a.jsx("p",{children:"Costo Total"})]})]}),a.jsxs("div",{className:"stat-card warning",children:[a.jsx("div",{className:"stat-icon",children:"⏰"}),a.jsxs("div",{className:"stat-content",children:[a.jsx("h3",{children:be(n.upcomingCount)}),a.jsx("p",{children:"Próximos"})]})]}),a.jsxs("div",{className:"stat-card danger",children:[a.jsx("div",{className:"stat-icon",children:"⚠️"}),a.jsxs("div",{className:"stat-content",children:[a.jsx("h3",{children:be(n.overdueCount)}),a.jsx("p",{children:"Vencidos"})]})]})]}),Object.keys(n.byType).length>0&&a.jsxs("div",{className:"stats-breakdown",children:[a.jsx("h3",{children:"📊 Desglose por Tipo"}),a.jsx("div",{className:"breakdown-grid",children:Object.entries(n.byType).map(([c,d])=>a.jsxs("div",{className:"breakdown-item",children:[a.jsxs("div",{className:"breakdown-header",children:[a.jsx("span",{className:"breakdown-icon",children:e(c)}),a.jsx("span",{className:"breakdown-label",children:t(c)})]}),a.jsx("div",{className:"breakdown-value",children:be(d)}),a.jsx("div",{className:"breakdown-bar",children:a.jsx("div",{className:"breakdown-fill",style:{width:`${d/n.total*100}%`,backgroundColor:"#3b82f6"}})}),a.jsxs("div",{className:"breakdown-percentage",children:[(d/n.total*100).toFixed(1),"%"]})]},c))})]}),Object.keys(n.byStatus).length>0&&a.jsxs("div",{className:"stats-breakdown",children:[a.jsx("h3",{children:"📈 Desglose por Estado"}),a.jsx("div",{className:"breakdown-grid",children:Object.entries(n.byStatus).map(([c,d])=>a.jsxs("div",{className:"breakdown-item",children:[a.jsxs("div",{className:"breakdown-header",children:[a.jsx("span",{className:"status-dot",style:{backgroundColor:i(c)}}),a.jsx("span",{className:"breakdown-label",children:o(c)})]}),a.jsx("div",{className:"breakdown-value",children:be(d)}),a.jsx("div",{className:"breakdown-bar",children:a.jsx("div",{className:"breakdown-fill",style:{width:`${d/n.total*100}%`,backgroundColor:i(c)}})}),a.jsxs("div",{className:"breakdown-percentage",children:[(d/n.total*100).toFixed(1),"%"]})]},c))})]}),a.jsxs("div",{className:"stats-insights",children:[a.jsx("h3",{children:"💡 Insights"}),a.jsxs("div",{className:"insights-grid",children:[a.jsxs("div",{className:"insight-item",children:[a.jsx("span",{className:"insight-label",children:"Costo Promedio:"}),a.jsx("span",{className:"insight-value",children:Nt(n.averageCost)})]}),n.overdueCount>0&&a.jsxs("div",{className:"insight-item alert",children:[a.jsx("span",{className:"insight-label",children:"⚠️ Mantenimientos Vencidos:"}),a.jsxs("span",{className:"insight-value",children:[be(n.overdueCount)," requieren atención"]})]}),n.upcomingCount>0&&a.jsxs("div",{className:"insight-item info",children:[a.jsx("span",{className:"insight-label",children:"⏰ Próximos Mantenimientos:"}),a.jsxs("span",{className:"insight-value",children:[be(n.upcomingCount)," programados"]})]})]})]})]})},IV=({filters:n,onFilterChange:e,onClearFilters:t,searchTerm:i,onSearchChange:o,viewMode:c,onViewModeChange:d,totalResults:f})=>{const p=j=>{switch(j){case pe.OIL_CHANGE:return"Cambio de Aceite";case pe.BATTERY_CHANGE:return"Cambio de Batería";case pe.FILTER_CHANGE:return"Cambio de Filtros";case pe.GENERAL_MAINTENANCE:return"Mantenimiento General";default:return j}},g=j=>{switch(j){case Pe.COMPLETED:return"Completado";case Pe.PENDING:return"Pendiente";case Pe.CANCELLED:return"Cancelado";default:return j}},y=(j,N)=>{e({[j]:N})},b=j=>{e(j)},E=()=>Object.values(n).some(j=>j!=="")||i;return a.jsx("div",{className:"maintenance-filters",children:a.jsxs("div",{className:"filters-main",children:[a.jsx("div",{className:"search-section",children:a.jsxs("div",{className:"search-box",children:[a.jsx("span",{className:"search-icon",children:"🔍"}),a.jsx("input",{type:"text",className:"search-input",placeholder:"Buscar mantenimientos...",value:i,onChange:j=>o(j.target.value)}),i&&a.jsx("button",{className:"search-clear",onClick:()=>o(""),children:"×"})]})}),a.jsxs("div",{className:"filters-controls",children:[a.jsxs("div",{className:"quick-filters",children:[a.jsx("button",{className:`quick-filter ${E()?"":"active"}`,onClick:()=>t(),children:"Todos"}),a.jsx("button",{className:`quick-filter ${n.type===pe.OIL_CHANGE?"active":""}`,onClick:()=>b({type:pe.OIL_CHANGE}),children:"🛢️ Aceite"}),a.jsx("button",{className:`quick-filter ${n.type===pe.BATTERY_CHANGE?"active":""}`,onClick:()=>b({type:pe.BATTERY_CHANGE}),children:"🔋 Baterías"}),a.jsx("button",{className:`quick-filter ${n.status===Pe.PENDING?"active":""}`,onClick:()=>b({status:Pe.PENDING}),children:"⏰ Pendientes"})]}),a.jsxs("button",{className:`btn-advanced-filters ${E()?"active":""}`,onClick:()=>document.querySelector(".filters-advanced").classList.toggle("show"),children:["🔧 Filtros Avanzados",E()&&a.jsx("span",{className:"filters-count",children:Object.values(n).filter(j=>j!=="").length})]}),a.jsxs("div",{className:"view-modes",children:[a.jsx("button",{className:`view-mode ${c==="cards"?"active":""}`,onClick:()=>d("cards"),children:"📋 Cards"}),a.jsx("button",{className:`view-mode ${c==="table"?"active":""}`,onClick:()=>d("table"),children:"📊 Tabla"})]})]}),a.jsxs("div",{className:"filters-advanced",children:[a.jsxs("div",{className:"filters-grid",children:[a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Tipo de Mantenimiento"}),a.jsxs("select",{value:n.type,onChange:j=>y("type",j.target.value),children:[a.jsx("option",{value:"",children:"Todos los tipos"}),a.jsx("option",{value:pe.OIL_CHANGE,children:p(pe.OIL_CHANGE)}),a.jsx("option",{value:pe.BATTERY_CHANGE,children:p(pe.BATTERY_CHANGE)}),a.jsx("option",{value:pe.FILTER_CHANGE,children:p(pe.FILTER_CHANGE)}),a.jsx("option",{value:pe.GENERAL_MAINTENANCE,children:p(pe.GENERAL_MAINTENANCE)})]})]}),a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Estado"}),a.jsxs("select",{value:n.status,onChange:j=>y("status",j.target.value),children:[a.jsx("option",{value:"",children:"Todos los estados"}),a.jsx("option",{value:Pe.COMPLETED,children:g(Pe.COMPLETED)}),a.jsx("option",{value:Pe.PENDING,children:g(Pe.PENDING)}),a.jsx("option",{value:Pe.CANCELLED,children:g(Pe.CANCELLED)})]})]}),a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Fecha Desde"}),a.jsx("input",{type:"date",value:n.dateFrom,onChange:j=>y("dateFrom",j.target.value)})]}),a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Fecha Hasta"}),a.jsx("input",{type:"date",value:n.dateTo,onChange:j=>y("dateTo",j.target.value)})]})]}),a.jsx("div",{className:"filters-actions",children:a.jsx("button",{className:"btn-clear-filters",onClick:t,disabled:!E(),children:"🗑️ Limpiar Filtros"})})]}),a.jsxs("div",{className:"filters-info",children:[a.jsxs("div",{className:"results-count",children:[f," mantenimiento",f!==1?"s":""," encontrado",f!==1?"s":""]}),E()&&a.jsxs("div",{className:"active-filters",children:[a.jsx("span",{className:"filters-label",children:"Filtros activos:"}),a.jsxs("div",{className:"filter-tags",children:[n.type&&a.jsxs("span",{className:"filter-tag",children:["Tipo: ",p(n.type),a.jsx("button",{onClick:()=>y("type",""),children:"×"})]}),n.status&&a.jsxs("span",{className:"filter-tag",children:["Estado: ",g(n.status),a.jsx("button",{onClick:()=>y("status",""),children:"×"})]}),n.dateFrom&&a.jsxs("span",{className:"filter-tag",children:["Desde: ",n.dateFrom,a.jsx("button",{onClick:()=>y("dateFrom",""),children:"×"})]}),n.dateTo&&a.jsxs("span",{className:"filter-tag",children:["Hasta: ",n.dateTo,a.jsx("button",{onClick:()=>y("dateTo",""),children:"×"})]}),i&&a.jsxs("span",{className:"filter-tag",children:['Búsqueda: "',i,'"',a.jsx("button",{onClick:()=>o(""),children:"×"})]})]})]})]})]})})},RV=({maintenanceRecords:n,onEdit:e,onView:t,onDelete:i,userRole:o})=>{const c=N=>N?new Date(N).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric"}):"N/A",d=N=>{if(!N)return"";const w=new Date,T=new Date(N),S=Math.abs(w-T),q=Math.ceil(S/(1e3*60*60*24));return q===0?"Hoy":q===1?"Ayer":q<7?`Hace ${q} días`:q<30?`Hace ${Math.floor(q/7)} semanas`:`Hace ${Math.floor(q/30)} meses`},f=N=>{switch(N){case pe.OIL_CHANGE:return"maintenance-oil-change";case pe.BATTERY_CHANGE:return"maintenance-battery-change";case pe.FILTER_CHANGE:return"maintenance-filter-change";case pe.GENERAL_MAINTENANCE:return"maintenance-general";default:return"maintenance-general"}},p=N=>{switch(N){case Pe.COMPLETED:return"status-completado";case Pe.PENDING:return"status-pendiente";case Pe.CANCELLED:return"status-cancelado";default:return"status-unknown"}},g=N=>{switch(N){case pe.OIL_CHANGE:return"🛢️";case pe.BATTERY_CHANGE:return"🔋";case pe.FILTER_CHANGE:return"🔧";case pe.GENERAL_MAINTENANCE:return"⚙️";default:return"🔧"}},y=N=>{switch(N){case pe.OIL_CHANGE:return"Cambio de Aceite";case pe.BATTERY_CHANGE:return"Cambio de Batería";case pe.FILTER_CHANGE:return"Cambio de Filtros";case pe.GENERAL_MAINTENANCE:return"Mantenimiento General";default:return N}},b=N=>{switch(N){case Pe.COMPLETED:return"✅";case Pe.PENDING:return"⏰";case Pe.CANCELLED:return"❌";default:return"❓"}},E=N=>{switch(N){case Pe.COMPLETED:return"Completado";case Pe.PENDING:return"Pendiente";case Pe.CANCELLED:return"Cancelado";default:return N}},j=o==="admin"||o==="supervisor";return a.jsx("div",{className:"maintenance-cards",children:n.map(N=>a.jsxs("div",{className:`maintenance-card ${f(N.type)}`,children:[a.jsxs("div",{className:"card-header",children:[a.jsxs("div",{className:"maintenance-type",children:[a.jsx("span",{className:"type-icon",children:g(N.type)}),a.jsx("span",{className:"type-label",children:y(N.type)})]}),a.jsxs("div",{className:`status-badge ${p(N.status)}`,children:[b(N.status)," ",E(N.status)]})]}),a.jsxs("div",{className:"card-content",children:[a.jsxs("div",{className:"vehicle-info",children:[a.jsx("span",{className:"vehicle-icon",children:"🚜"}),a.jsxs("div",{className:"vehicle-details",children:[a.jsx("div",{className:"vehicle-name",children:N.vehicleName}),a.jsx("div",{className:"vehicle-id",children:N.vehicleId})]})]}),a.jsxs("div",{className:"date-info",children:[a.jsx("div",{className:"created-date",children:c(N.date)}),a.jsx("div",{className:"relative-time",children:d(N.date)})]}),N.type===pe.OIL_CHANGE&&a.jsxs("div",{className:"oil-change-info",children:[a.jsxs("div",{className:"info-row",children:[a.jsx("span",{className:"info-label",children:"Cantidad:"}),a.jsxs("span",{className:"info-value",children:[be(N.quantity)," galones"]})]}),a.jsxs("div",{className:"info-row",children:[a.jsx("span",{className:"info-label",children:"Horómetro:"}),a.jsxs("span",{className:"info-value",children:[be(N.currentHours)," horas"]})]}),N.nextChangeHours&&a.jsxs("div",{className:"info-row",children:[a.jsx("span",{className:"info-label",children:"Próximo cambio:"}),a.jsxs("span",{className:"info-value",children:[be(N.nextChangeHours)," horas"]})]}),N.filters&&a.jsxs("div",{className:"info-row",children:[a.jsx("span",{className:"info-label",children:"Filtros:"}),a.jsx("span",{className:"info-value",children:N.filters})]})]}),N.type===pe.BATTERY_CHANGE&&a.jsxs("div",{className:"battery-change-info",children:[a.jsxs("div",{className:"info-row",children:[a.jsx("span",{className:"info-label",children:"Tipo:"}),a.jsx("span",{className:"info-value",children:N.batteryType})]}),N.brand&&a.jsxs("div",{className:"info-row",children:[a.jsx("span",{className:"info-label",children:"Marca:"}),a.jsx("span",{className:"info-value",children:N.brand})]}),N.model&&a.jsxs("div",{className:"info-row",children:[a.jsx("span",{className:"info-label",children:"Modelo:"}),a.jsx("span",{className:"info-value",children:N.model})]}),a.jsxs("div",{className:"info-row",children:[a.jsx("span",{className:"info-label",children:"Estado:"}),a.jsx("span",{className:"info-value",children:N.batteryStatus})]}),N.cost&&a.jsxs("div",{className:"info-row",children:[a.jsx("span",{className:"info-label",children:"Costo:"}),a.jsx("span",{className:"info-value",children:Nt(N.cost)})]})]}),N.notes&&a.jsxs("div",{className:"notes-section",children:[a.jsx("span",{className:"notes-label",children:"Notas:"}),a.jsx("p",{className:"notes-text",children:N.notes})]})]}),a.jsx("div",{className:"card-footer",children:a.jsxs("div",{className:"card-actions",children:[a.jsx("button",{className:"btn-view",onClick:()=>t(N),title:"Ver detalles",children:"👁️ Ver"}),j&&e&&a.jsx("button",{className:"btn-edit",onClick:()=>e(N),title:"Editar",children:"✏️ Editar"}),j&&i&&a.jsx("button",{className:"btn-delete",onClick:()=>i(N.id),title:"Eliminar",children:"🗑️ Eliminar"})]})})]},N.id))})},DV=({maintenanceRecords:n,onEdit:e,onView:t,onDelete:i,userRole:o})=>{const[c,d]=z.useState("date"),[f,p]=z.useState("desc"),g=I=>I?new Date(I).toLocaleDateString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit"}):"N/A",y=I=>{switch(I){case pe.OIL_CHANGE:return"🛢️";case pe.BATTERY_CHANGE:return"🔋";case pe.FILTER_CHANGE:return"🔧";case pe.GENERAL_MAINTENANCE:return"⚙️";default:return"🔧"}},b=I=>{switch(I){case pe.OIL_CHANGE:return"Cambio de Aceite";case pe.BATTERY_CHANGE:return"Cambio de Batería";case pe.FILTER_CHANGE:return"Cambio de Filtros";case pe.GENERAL_MAINTENANCE:return"Mantenimiento General";default:return I}},E=I=>{switch(I){case Pe.COMPLETED:return"✅";case Pe.PENDING:return"⏰";case Pe.CANCELLED:return"❌";default:return"❓"}},j=I=>{switch(I){case Pe.COMPLETED:return"Completado";case Pe.PENDING:return"Pendiente";case Pe.CANCELLED:return"Cancelado";default:return I}},N=I=>{switch(I){case Pe.COMPLETED:return"status-completado";case Pe.PENDING:return"status-pendiente";case Pe.CANCELLED:return"status-cancelado";default:return"status-unknown"}},w=I=>{c===I?p(f==="asc"?"desc":"asc"):(d(I),p("asc"))},T=I=>c!==I?"↕️":f==="asc"?"↑":"↓",S=[...n].sort((I,O)=>{let U=I[c],$=O[c];return c==="date"&&(U=new Date(U),$=new Date($)),["quantity","currentHours","nextChangeHours","cost"].includes(c)&&(U=parseFloat(U)||0,$=parseFloat($)||0),typeof U=="string"&&(U=U.toLowerCase(),$=$.toLowerCase()),f==="asc"?U>$?1:-1:U<$?1:-1}),q=o==="admin"||o==="supervisor";return a.jsxs("div",{className:"maintenance-table-container",children:[a.jsx("div",{className:"table-wrapper",children:a.jsxs("table",{className:"maintenance-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsxs("th",{className:"sortable",onClick:()=>w("type"),children:["Tipo ",T("type")]}),a.jsxs("th",{className:"sortable",onClick:()=>w("vehicleName"),children:["Vehículo ",T("vehicleName")]}),a.jsxs("th",{className:"sortable",onClick:()=>w("date"),children:["Fecha ",T("date")]}),a.jsx("th",{children:"Detalles"}),a.jsxs("th",{className:"sortable",onClick:()=>w("status"),children:["Estado ",T("status")]}),a.jsxs("th",{className:"sortable text-right",onClick:()=>w("cost"),children:["Costo ",T("cost")]}),a.jsx("th",{children:"Acciones"})]})}),a.jsx("tbody",{children:S.map(I=>a.jsxs("tr",{className:"maintenance-row",children:[a.jsx("td",{className:"type-cell",children:a.jsxs("div",{className:"type-content",children:[a.jsx("span",{className:"type-icon",children:y(I.type)}),a.jsx("span",{className:"type-name",children:b(I.type)})]})}),a.jsx("td",{className:"vehicle-cell",children:a.jsxs("div",{className:"vehicle-info",children:[a.jsx("div",{className:"vehicle-name",children:I.vehicleName}),a.jsx("div",{className:"vehicle-id",children:I.vehicleId})]})}),a.jsx("td",{className:"date-cell",children:a.jsx("div",{className:"date-content",children:a.jsx("div",{className:"date-value",children:g(I.date)})})}),a.jsxs("td",{className:"details-cell",children:[I.type===pe.OIL_CHANGE&&a.jsxs("div",{className:"oil-details",children:[a.jsxs("div",{children:["Qty: ",be(I.quantity)," gal"]}),a.jsxs("div",{children:["Hrs: ",be(I.currentHours)]}),I.filters&&a.jsxs("div",{children:["Filtros: ",I.filters]})]}),I.type===pe.BATTERY_CHANGE&&a.jsxs("div",{className:"battery-details",children:[a.jsx("div",{children:I.batteryType}),I.brand&&a.jsx("div",{children:I.brand}),a.jsxs("div",{children:["Estado: ",I.batteryStatus]})]}),I.notes&&a.jsx("div",{className:"notes-small",children:I.notes})]}),a.jsx("td",{className:"status-cell",children:a.jsxs("div",{className:`status-badge ${N(I.status)}`,children:[E(I.status)," ",j(I.status)]})}),a.jsx("td",{className:"cost-cell text-right",children:I.cost?Nt(I.cost):"N/A"}),a.jsx("td",{className:"actions-cell",children:a.jsxs("div",{className:"action-buttons",children:[a.jsx("button",{className:"btn-action btn-view",onClick:()=>t(I),title:"Ver detalles",children:"👁️"}),q&&e&&a.jsx("button",{className:"btn-action btn-edit",onClick:()=>e(I),title:"Editar",children:"✏️"}),q&&i&&a.jsx("button",{className:"btn-action btn-delete",onClick:()=>i(I.id),title:"Eliminar",children:"🗑️"})]})})]},I.id))})]})}),a.jsxs("div",{className:"table-info",children:[a.jsx("div",{className:"table-summary",children:a.jsxs("span",{className:"total-rows",children:[n.length," mantenimiento",n.length!==1?"s":""," en total"]})}),a.jsxs("div",{className:"table-legend",children:[a.jsxs("div",{className:"legend-item",children:[a.jsx("span",{className:"legend-dot oil-change"}),a.jsx("span",{children:"Cambio de Aceite"})]}),a.jsxs("div",{className:"legend-item",children:[a.jsx("span",{className:"legend-dot battery-change"}),a.jsx("span",{children:"Cambio de Batería"})]}),a.jsxs("div",{className:"legend-item",children:[a.jsx("span",{className:"legend-dot filter-change"}),a.jsx("span",{children:"Cambio de Filtros"})]}),a.jsxs("div",{className:"legend-item",children:[a.jsx("span",{className:"legend-dot general"}),a.jsx("span",{children:"Mantenimiento General"})]})]})]})]})},MV=({maintenanceRecords:n,viewMode:e,onEdit:t,onView:i,onDelete:o,userRole:c})=>!n||n.length===0?a.jsxs("div",{className:"empty-state",children:[a.jsx("div",{className:"empty-icon",children:"🔧"}),a.jsx("h3",{children:"No hay mantenimientos registrados"}),a.jsx("p",{children:"Comienza creando el primer mantenimiento para tu flota de vehículos."})]}):a.jsx("div",{className:"maintenance-list",children:e==="cards"?a.jsx(RV,{maintenanceRecords:n,onEdit:t,onView:i,onDelete:o,userRole:c}):a.jsx(DV,{maintenanceRecords:n,onEdit:t,onView:i,onDelete:o,userRole:c})}),kV=({isOpen:n,onClose:e,onSuccess:t,maintenance:i,mode:o="create",userRole:c})=>{const d=()=>({type:i?.type||pe.OIL_CHANGE,vehicleId:i?.vehicleId||"",vehicleName:i?.vehicleName||"",date:i?.date?new Date(i.date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],status:i?.status||Pe.COMPLETED,quantity:i?.quantity||0,currentHours:i?.currentHours||0,nextChangeHours:i?.nextChangeHours||0,filters:i?.filters||"",batteryType:i?.batteryType||"",brand:i?.brand||"",model:i?.model||"",batteryStatus:i?.batteryStatus||Yo.NEW,notes:i?.notes||"",cost:i?.cost||0}),[f,p]=z.useState(d()),[g,y]=z.useState({}),[b,E]=z.useState(!1),[j,N]=z.useState([]);z.useEffect(()=>{n&&(async()=>{try{const $=await tC();N($)}catch($){console.error("Error al cargar vehículos:",$)}})()},[n]),z.useEffect(()=>{n&&(p(d()),y({}))},[n,i,j]),z.useEffect(()=>{if(f.type===pe.OIL_CHANGE&&f.currentHours>0){const U=Af(f.currentHours);p($=>({...$,nextChangeHours:U}))}},[f.currentHours,f.type]);const w=(U,$)=>{const F=typeof $=="number"?parseFloat($)||0:$;p(R=>({...R,[U]:F})),g[U]&&y(R=>({...R,[U]:null}))},T=U=>{const $=j.find(F=>F.vehicleId===U);p(F=>({...F,vehicleId:U,vehicleName:$?$.name:""})),$&&$.hasHourMeter&&$.currentHours&&p(F=>({...F,currentHours:$.currentHours}))},S=()=>{const U={};return f.type||(U.type="El tipo de mantenimiento es obligatorio"),f.vehicleId||(U.vehicleId="El vehículo es obligatorio"),f.date||(U.date="La fecha es obligatoria"),f.type===pe.OIL_CHANGE&&((!f.quantity||f.quantity<=0)&&(U.quantity="La cantidad de aceite es obligatoria y debe ser mayor a 0"),(!f.currentHours||f.currentHours<0)&&(U.currentHours="La lectura del horómetro es obligatoria")),f.type===pe.BATTERY_CHANGE&&(f.batteryType||(U.batteryType="El tipo de batería es obligatorio"),(!f.cost||f.cost<=0)&&(U.cost="El costo de la batería es obligatorio")),y(U),Object.keys(U).length===0},q=async U=>{if(U.preventDefault(),!!S()){E(!0);try{const $={...f,date:new Date(f.date),createdBy:c||"user"};o==="create"?(await XA($),console.log("✅ Mantenimiento creado exitosamente")):o==="edit"&&(await ZA(i.id,$),console.log("✅ Mantenimiento actualizado exitosamente")),t()}catch($){console.error("❌ Error al guardar mantenimiento:",$),alert("Error al guardar mantenimiento: "+$.message)}finally{E(!1)}}},I=()=>{switch(o){case"create":return"Crear Mantenimiento";case"edit":return"Editar Mantenimiento";case"view":return"Ver Mantenimiento";default:return"Mantenimiento"}},O=U=>{switch(U){case pe.OIL_CHANGE:return"🛢️";case pe.BATTERY_CHANGE:return"🔋";case pe.FILTER_CHANGE:return"🔧";case pe.GENERAL_MAINTENANCE:return"⚙️";default:return"🔧"}};return n?a.jsx("div",{className:"modal-overlay",children:a.jsxs("div",{className:"modal-content maintenance-modal",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("h2",{children:I()}),a.jsx("button",{className:"modal-close",onClick:e,children:"×"})]}),a.jsx("div",{className:"modal-body",children:a.jsxs("form",{onSubmit:q,className:"maintenance-form",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Tipo de Mantenimiento *"}),a.jsxs("select",{value:f.type,onChange:U=>w("type",U.target.value),disabled:o==="view",children:[a.jsxs("option",{value:pe.OIL_CHANGE,children:[O(pe.OIL_CHANGE)," Cambio de Aceite"]}),a.jsxs("option",{value:pe.BATTERY_CHANGE,children:[O(pe.BATTERY_CHANGE)," Cambio de Batería"]}),a.jsxs("option",{value:pe.FILTER_CHANGE,children:[O(pe.FILTER_CHANGE)," Cambio de Filtros"]}),a.jsxs("option",{value:pe.GENERAL_MAINTENANCE,children:[O(pe.GENERAL_MAINTENANCE)," Mantenimiento General"]})]}),g.type&&a.jsx("span",{className:"error-text",children:g.type})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Vehículo *"}),a.jsxs("select",{value:f.vehicleId,onChange:U=>T(U.target.value),disabled:o==="view",children:[a.jsx("option",{value:"",children:"Seleccionar vehículo"}),j.map(U=>a.jsxs("option",{value:U.vehicleId,children:[U.vehicleId," - ",U.name," (",U.type,")"]},U.vehicleId))]}),g.vehicleId&&a.jsx("span",{className:"error-text",children:g.vehicleId})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Fecha *"}),a.jsx("input",{type:"date",value:f.date,onChange:U=>w("date",U.target.value),disabled:o==="view"}),g.date&&a.jsx("span",{className:"error-text",children:g.date})]}),f.type===pe.OIL_CHANGE&&a.jsxs("div",{className:"maintenance-section",children:[a.jsx("h3",{children:"🛢️ Información del Cambio de Aceite"}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Cantidad (galones) *"}),a.jsx("input",{type:"number",step:"0.1",value:f.quantity,onChange:U=>w("quantity",U.target.value),disabled:o==="view"}),g.quantity&&a.jsx("span",{className:"error-text",children:g.quantity})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Horómetro Actual *"}),a.jsx("input",{type:"number",value:f.currentHours,onChange:U=>w("currentHours",U.target.value),disabled:o==="view"}),g.currentHours&&a.jsx("span",{className:"error-text",children:g.currentHours})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Próximo Cambio (horas)"}),a.jsx("input",{type:"number",value:f.nextChangeHours,disabled:!0,className:"readonly-input"}),a.jsx("small",{children:"Calculado automáticamente: actual + 250 horas"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Filtros o Extras"}),a.jsx("textarea",{value:f.filters,onChange:U=>w("filters",U.target.value),disabled:o==="view",placeholder:"Especificar filtros cambiados o extras..."})]})]}),f.type===pe.BATTERY_CHANGE&&a.jsxs("div",{className:"maintenance-section",children:[a.jsx("h3",{children:"🔋 Información del Cambio de Batería"}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Tipo de Batería *"}),a.jsx("input",{type:"text",value:f.batteryType,onChange:U=>w("batteryType",U.target.value),disabled:o==="view",placeholder:"Ej: 12V 60Ah"}),g.batteryType&&a.jsx("span",{className:"error-text",children:g.batteryType})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Estado *"}),a.jsxs("select",{value:f.batteryStatus,onChange:U=>w("batteryStatus",U.target.value),disabled:o==="view",children:[a.jsx("option",{value:Yo.NEW,children:"Nueva"}),a.jsx("option",{value:Yo.USED,children:"Usada"}),a.jsx("option",{value:Yo.REPAIRED,children:"Reparada"})]})]})]}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Marca"}),a.jsx("input",{type:"text",value:f.brand,onChange:U=>w("brand",U.target.value),disabled:o==="view",placeholder:"Ej: Bosch, Exide"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Modelo"}),a.jsx("input",{type:"text",value:f.model,onChange:U=>w("model",U.target.value),disabled:o==="view",placeholder:"Ej: S4 005"})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Costo *"}),a.jsx("input",{type:"number",step:"1000",value:f.cost,onChange:U=>w("cost",U.target.value),disabled:o==="view",placeholder:"0"}),g.cost&&a.jsx("span",{className:"error-text",children:g.cost})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Notas Adicionales"}),a.jsx("textarea",{value:f.notes,onChange:U=>w("notes",U.target.value),disabled:o==="view",placeholder:"Observaciones adicionales...",rows:"3"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Estado"}),a.jsxs("select",{value:f.status,onChange:U=>w("status",U.target.value),disabled:o==="view",children:[a.jsx("option",{value:Pe.COMPLETED,children:"Completado"}),a.jsx("option",{value:Pe.PENDING,children:"Pendiente"}),a.jsx("option",{value:Pe.CANCELLED,children:"Cancelado"})]})]})]})}),a.jsxs("div",{className:"modal-footer",children:[a.jsx("button",{type:"button",className:"btn btn-secondary",onClick:e,disabled:b,children:"Cancelar"}),o!=="view"&&a.jsx("button",{type:"submit",className:"btn btn-primary",onClick:q,disabled:b,children:b?"Guardando...":o==="create"?"Crear":"Actualizar"})]})]})}):null},OV=()=>{const{user:n,userProfile:e}=Qn(),[t,i]=z.useState([]),[o,c]=z.useState(null),[d,f]=z.useState(!0),[p,g]=z.useState(null),[y,b]=z.useState({type:"",status:"",vehicleId:"",dateFrom:"",dateTo:""}),[E,j]=z.useState("cards"),[N,w]=z.useState(""),[T,S]=z.useState(!1),[q,I]=z.useState(null),[O,U]=z.useState("create");z.useEffect(()=>{if(!n)return;f(!0);const Q=eC((se,me)=>{if(me){console.error("Error en suscripción de mantenimientos:",me),g("Error al cargar mantenimientos"),f(!1);return}i(se),g(null),f(!1)},y);return()=>Q()},[n,y]),z.useEffect(()=>{n&&(async()=>{try{const se=await JA(y);c(se)}catch(se){console.error("Error al cargar estadísticas:",se)}})()},[n,t,y]);const $=t.filter(Q=>{if(!N)return!0;const se=N.toLowerCase();return Q.vehicleName?.toLowerCase().includes(se)||Q.type?.toLowerCase().includes(se)||Q.status?.toLowerCase().includes(se)||Q.notes?.toLowerCase().includes(se)}),F=e?.combustiblesPermissions?.canManageMaintenance||!1,R=()=>{I(null),U("create"),S(!0)},V=Q=>{I(Q),U("edit"),S(!0)},P=Q=>{I(Q),U("view"),S(!0)},C=()=>{S(!1),I(null)},M=()=>{S(!1),I(null)},D=Q=>{b(se=>({...se,...Q}))},le=()=>{b({type:"",status:"",vehicleId:"",dateFrom:"",dateTo:""}),w("")},ve=async Q=>{if(!F){alert("No tienes permisos para eliminar mantenimientos");return}if(window.confirm("¿Estás seguro de que quieres eliminar este mantenimiento?"))try{const{deleteMaintenanceRecord:se}=await iy(async()=>{const{deleteMaintenanceRecord:me}=await Promise.resolve().then(()=>wV);return{deleteMaintenanceRecord:me}},void 0);await se(Q),console.log("✅ Mantenimiento eliminado exitosamente")}catch(se){console.error("❌ Error al eliminar mantenimiento:",se),alert("Error al eliminar mantenimiento: "+se.message)}};return n?a.jsxs("div",{className:"maintenance-main",children:[a.jsxs("div",{className:"maintenance-header",children:[a.jsxs("div",{className:"header-title",children:[a.jsx("h2",{children:"🔧 Mantenimiento de Vehículos"}),a.jsx("p",{children:"Gestión de cambios de aceite, filtros y baterías"})]}),a.jsx("div",{className:"header-actions",children:F&&a.jsx("button",{className:"btn-create-maintenance",onClick:R,children:"➕ Crear Mantenimiento"})})]}),d&&a.jsxs("div",{className:"maintenance-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Cargando mantenimientos..."})]}),p&&a.jsxs("div",{className:"error-banner",children:[a.jsxs("span",{children:["❌ ",p]}),a.jsx("button",{onClick:()=>window.location.reload(),children:"Reintentar"})]}),o&&a.jsx(SV,{stats:o}),a.jsx(IV,{filters:y,onFilterChange:D,onClearFilters:le,searchTerm:N,onSearchChange:w,viewMode:E,onViewModeChange:j,totalResults:$.length}),!d&&!p&&a.jsx(MV,{maintenanceRecords:$,viewMode:E,onEdit:F?V:null,onView:P,onDelete:F?ve:null,userRole:e?.role}),T&&a.jsx(kV,{isOpen:T,onClose:C,onSuccess:M,maintenance:q,mode:O,userRole:e?.role})]}):a.jsx("div",{className:"maintenance-main",children:a.jsxs("div",{className:"auth-required",children:[a.jsx("h2",{children:"🔐 Autenticación Requerida"}),a.jsx("p",{children:"Debes iniciar sesión para acceder al módulo de mantenimiento."})]})})},PV=({isOpen:n,onClose:e,product:t,mode:i="create",onSave:o,userRole:c})=>{const[d,f]=z.useState({name:"",displayName:"",category:Hs.COMBUSTIBLE,unit:"gal",defaultPrice:0,color:"#FF6B35",icon:"🛢️",description:"",isActive:!0,currentStock:0,minThreshold:10,maxCapacity:1e3}),[p,g]=z.useState({}),[y,b]=z.useState(!1),E=[{value:"gal",label:"Galones (gal)"},{value:"L",label:"Litros (L)"},{value:"kg",label:"Kilogramos (kg)"},{value:"und",label:"Unidades (und)"}],j={[Hs.COMBUSTIBLE]:["🛢️","🚛","🚗","⛽","🌿"],[Hs.ACEITE]:["🛢️","⚙️","🔧","🚜","🏭"],[Hs.LUBRICANTE]:["🟥","🟡","🔵","⚫","🟤"],[Hs.FLUIDO]:["🛑","💧","🔴","🟢","🔵"]},N=["#FF6B35","#4CAF50","#2196F3","#FF9800","#F44336","#9C27B0","#E91E63","#795548","#607D8B","#3F51B5"];z.useEffect(()=>{f(t&&(i==="edit"||i==="view")?{name:t.name||"",displayName:t.displayName||"",category:t.category||Hs.COMBUSTIBLE,unit:t.unit||"gal",defaultPrice:t.defaultPrice||0,color:t.color||"#FF6B35",icon:t.icon||"🛢️",description:t.description||"",isActive:t.isActive!==void 0?t.isActive:!0,currentStock:t.currentStock||0,minThreshold:t.minThreshold||10,maxCapacity:t.maxCapacity||1e3}:{name:"",displayName:"",category:Hs.COMBUSTIBLE,unit:"gal",defaultPrice:0,color:"#FF6B35",icon:"🛢️",description:"",isActive:!0,currentStock:0,minThreshold:10,maxCapacity:1e3}),g({})},[t,i,n]);const w=I=>{const{name:O,value:U,type:$,checked:F}=I.target;f(R=>({...R,[O]:$==="checkbox"?F:U})),p[O]&&g(R=>({...R,[O]:""}))},T=()=>{const I={};return d.name.trim()||(I.name="El nombre es requerido"),d.displayName.trim()||(I.displayName="El nombre de visualización es requerido"),d.category||(I.category="La categoría es requerida"),d.unit||(I.unit="La unidad es requerida"),d.defaultPrice<0&&(I.defaultPrice="El precio debe ser mayor o igual a 0"),d.currentStock<0&&(I.currentStock="El stock debe ser mayor o igual a 0"),d.minThreshold<0&&(I.minThreshold="El umbral mínimo debe ser mayor o igual a 0"),d.maxCapacity<=0&&(I.maxCapacity="La capacidad máxima debe ser mayor a 0"),d.minThreshold>=d.maxCapacity&&(I.minThreshold="El umbral mínimo debe ser menor que la capacidad máxima"),g(I),Object.keys(I).length===0},S=async I=>{if(I.preventDefault(),!!T()){b(!0);try{await o({...d,defaultPrice:parseFloat(d.defaultPrice),currentStock:parseFloat(d.currentStock),minThreshold:parseFloat(d.minThreshold),maxCapacity:parseFloat(d.maxCapacity)}),e()}catch(O){console.error("Error saving product:",O),g({submit:"Error al guardar el producto"})}finally{b(!1)}}};if(!n)return null;const q=["admin","supervisor"].includes(c)&&i!=="view";return a.jsx("div",{className:"modal-overlay",children:a.jsxs("div",{className:"modal-content product-modal",children:[a.jsxs("div",{className:"modal-header",children:[a.jsxs("h2",{children:[i==="create"&&"➕ Crear Producto",i==="edit"&&"✏️ Editar Producto",i==="view"&&"👁️ Ver Producto"]}),a.jsx("button",{className:"modal-close",onClick:e,children:"✕"})]}),a.jsxs("form",{onSubmit:S,className:"modal-body",children:[a.jsx("div",{className:"product-preview",children:a.jsxs("div",{className:"preview-card",children:[a.jsx("div",{className:"preview-icon",style:{color:d.color},children:d.icon}),a.jsxs("div",{className:"preview-info",children:[a.jsx("h3",{children:d.displayName||"Nombre del producto"}),a.jsx("p",{className:"preview-category",children:d.category}),a.jsx("p",{className:"preview-description",children:d.description}),a.jsxs("div",{className:"preview-price",children:["$",new Intl.NumberFormat("es-CO").format(d.defaultPrice)," / ",d.unit]})]})]})}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{className:"form-section",children:[a.jsx("h3",{children:"📝 Información Básica"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Nombre Interno *"}),a.jsx("input",{type:"text",name:"name",value:d.name,onChange:w,disabled:!q,placeholder:"Ej: ACPM, GASOLINA"}),p.name&&a.jsx("span",{className:"error",children:p.name})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Nombre de Visualización *"}),a.jsx("input",{type:"text",name:"displayName",value:d.displayName,onChange:w,disabled:!q,placeholder:"Ej: ACPM 🚛, Gasolina 🚗"}),p.displayName&&a.jsx("span",{className:"error",children:p.displayName})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Categoría *"}),a.jsx("select",{name:"category",value:d.category,onChange:w,disabled:!q,children:Object.values(Hs).map(I=>a.jsx("option",{value:I,children:I},I))}),p.category&&a.jsx("span",{className:"error",children:p.category})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Descripción"}),a.jsx("textarea",{name:"description",value:d.description,onChange:w,disabled:!q,placeholder:"Descripción del producto...",rows:"3"})]})]}),a.jsxs("div",{className:"form-section",children:[a.jsx("h3",{children:"⚙️ Configuración"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Unidad de Medida *"}),a.jsx("select",{name:"unit",value:d.unit,onChange:w,disabled:!q,children:E.map(I=>a.jsx("option",{value:I.value,children:I.label},I.value))}),p.unit&&a.jsx("span",{className:"error",children:p.unit})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Precio por Defecto"}),a.jsx("input",{type:"number",name:"defaultPrice",value:d.defaultPrice,onChange:w,disabled:!q,min:"0",step:"0.01"}),p.defaultPrice&&a.jsx("span",{className:"error",children:p.defaultPrice})]}),a.jsx("div",{className:"form-group",children:a.jsxs("label",{children:[a.jsx("input",{type:"checkbox",name:"isActive",checked:d.isActive,onChange:w,disabled:!q}),"Producto Activo"]})})]}),a.jsxs("div",{className:"form-section",children:[a.jsx("h3",{children:"📊 Stock y Umbrales"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Stock Actual"}),a.jsx("input",{type:"number",name:"currentStock",value:d.currentStock,onChange:w,disabled:!q,min:"0",step:"0.01"}),p.currentStock&&a.jsx("span",{className:"error",children:p.currentStock})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Umbral Mínimo"}),a.jsx("input",{type:"number",name:"minThreshold",value:d.minThreshold,onChange:w,disabled:!q,min:"0",step:"0.01"}),p.minThreshold&&a.jsx("span",{className:"error",children:p.minThreshold})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Capacidad Máxima"}),a.jsx("input",{type:"number",name:"maxCapacity",value:d.maxCapacity,onChange:w,disabled:!q,min:"1",step:"0.01"}),p.maxCapacity&&a.jsx("span",{className:"error",children:p.maxCapacity})]})]}),a.jsxs("div",{className:"form-section",children:[a.jsx("h3",{children:"🎨 Apariencia"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Icono"}),a.jsx("div",{className:"icon-selector",children:j[d.category]?.map(I=>a.jsx("button",{type:"button",className:`icon-option ${d.icon===I?"selected":""}`,onClick:()=>f(O=>({...O,icon:I})),disabled:!q,children:I},I))})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Color"}),a.jsx("div",{className:"color-selector",children:N.map(I=>a.jsx("button",{type:"button",className:`color-option ${d.color===I?"selected":""}`,style:{backgroundColor:I},onClick:()=>f(O=>({...O,color:I})),disabled:!q},I))})]})]})]}),p.submit&&a.jsx("div",{className:"error-message",children:p.submit})]}),a.jsxs("div",{className:"modal-footer",children:[a.jsx("button",{type:"button",className:"btn-secondary",onClick:e,disabled:y,children:i==="view"?"Cerrar":"Cancelar"}),q&&a.jsx("button",{type:"submit",className:"btn-primary",onClick:S,disabled:y,children:y?"Guardando...":"Guardar"})]})]})})},LV=({products:n})=>{const[e,t]=z.useState([]),[i,o]=z.useState(!0);z.useEffect(()=>{const N=ny(w=>{t(w),o(!1)},w=>{console.error("Error loading movements for stats:",w),o(!1)});return()=>N()},[]);const c=()=>n.map(w=>{const T=e.filter($=>$.fuelType===w.name||$.fuelType===w.displayName),S=T.filter($=>$.type==="entrada"),q=T.filter($=>$.type==="salida"),I=S.reduce(($,F)=>$+(F.quantity||0),0),O=q.reduce(($,F)=>$+(F.quantity||0),0),U=(w.currentStock||0)*(w.defaultPrice||0);return{...w,totalEntries:I,totalExits:O,totalValue:U,entriesCount:S.length,exitsCount:q.length,stockStatus:d(w)}}),d=N=>{const w=N.currentStock||0,T=N.minThreshold||0,S=N.maxCapacity||1e3;return w===0?"empty":w<=T?"low":w>=S*.9?"high":"normal"},f=N=>{const w={};return Object.values(Hs).forEach(T=>{const S=N.filter(q=>q.category===T);w[T]={totalProducts:S.length,totalStock:S.reduce((q,I)=>q+(I.currentStock||0),0),totalValue:S.reduce((q,I)=>q+I.totalValue,0),totalEntries:S.reduce((q,I)=>q+I.totalEntries,0),totalExits:S.reduce((q,I)=>q+I.totalExits,0),lowStockCount:S.filter(q=>q.stockStatus==="low"||q.stockStatus==="empty").length}}),w};if(i)return a.jsxs("div",{className:"products-stats loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Cargando estadísticas..."})]});const p=c(),g=f(p),y=n.length,b=n.filter(N=>N.isActive).length,E=p.reduce((N,w)=>N+w.totalValue,0),j=p.filter(N=>N.stockStatus==="low"||N.stockStatus==="empty").length;return a.jsxs("div",{className:"products-stats",children:[a.jsx("h2",{children:"📊 Estadísticas de Productos"}),a.jsxs("div",{className:"stats-general",children:[a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:"📦"}),a.jsxs("div",{className:"stat-info",children:[a.jsx("h3",{children:be(y)}),a.jsx("p",{children:"Total Productos"})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:"✅"}),a.jsxs("div",{className:"stat-info",children:[a.jsx("h3",{children:be(b)}),a.jsx("p",{children:"Productos Activos"})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:"💰"}),a.jsxs("div",{className:"stat-info",children:[a.jsx("h3",{children:Nt(E)}),a.jsx("p",{children:"Valor Total Stock"})]})]}),a.jsxs("div",{className:`stat-card ${j>0?"alert":""}`,children:[a.jsx("div",{className:"stat-icon",children:"⚠️"}),a.jsxs("div",{className:"stat-info",children:[a.jsx("h3",{children:be(j)}),a.jsx("p",{children:"Stock Bajo"})]})]})]}),a.jsxs("div",{className:"stats-categories",children:[a.jsx("h3",{children:"📈 Por Categoría"}),a.jsx("div",{className:"categories-grid",children:Object.entries(g).map(([N,w])=>a.jsxs("div",{className:"category-card",children:[a.jsx("h4",{children:N}),a.jsxs("div",{className:"category-stats",children:[a.jsxs("div",{className:"stat-row",children:[a.jsx("span",{children:"Productos:"}),a.jsx("span",{children:be(w.totalProducts)})]}),a.jsxs("div",{className:"stat-row",children:[a.jsx("span",{children:"Stock Total:"}),a.jsxs("span",{children:[be(w.totalStock)," unidades"]})]}),a.jsxs("div",{className:"stat-row",children:[a.jsx("span",{children:"Valor:"}),a.jsx("span",{children:Nt(w.totalValue)})]}),a.jsxs("div",{className:"stat-row",children:[a.jsx("span",{children:"Entradas:"}),a.jsx("span",{className:"positive",children:be(w.totalEntries)})]}),a.jsxs("div",{className:"stat-row",children:[a.jsx("span",{children:"Salidas:"}),a.jsx("span",{className:"negative",children:be(w.totalExits)})]}),w.lowStockCount>0&&a.jsxs("div",{className:"stat-row alert",children:[a.jsx("span",{children:"Stock Bajo:"}),a.jsx("span",{children:be(w.lowStockCount)})]})]})]},N))})]}),a.jsxs("div",{className:"stats-top-products",children:[a.jsx("h3",{children:"🏆 Top Productos por Stock"}),a.jsx("div",{className:"top-products-list",children:p.sort((N,w)=>(w.currentStock||0)-(N.currentStock||0)).slice(0,5).map((N,w)=>a.jsxs("div",{className:"top-product-item",children:[a.jsxs("div",{className:"rank",children:["#",w+1]}),a.jsx("div",{className:"product-icon",style:{color:N.color},children:N.icon}),a.jsxs("div",{className:"product-info",children:[a.jsx("span",{className:"product-name",children:N.displayName}),a.jsxs("span",{className:"product-stock",children:[be(N.currentStock||0)," ",N.unit]})]}),a.jsx("div",{className:"product-value",children:Nt(N.totalValue)})]},N.id))})]}),j>0&&a.jsxs("div",{className:"stats-alerts",children:[a.jsx("h3",{children:"⚠️ Alertas de Stock"}),a.jsx("div",{className:"alerts-list",children:p.filter(N=>N.stockStatus==="low"||N.stockStatus==="empty").map(N=>a.jsxs("div",{className:`alert-item ${N.stockStatus}`,children:[a.jsx("div",{className:"alert-icon",children:N.stockStatus==="empty"?"🔴":"🟡"}),a.jsxs("div",{className:"alert-info",children:[a.jsx("span",{className:"alert-product",children:N.displayName}),a.jsxs("span",{className:"alert-stock",children:["Stock: ",be(N.currentStock||0)," ",N.unit,N.stockStatus==="empty"&&" - ¡SIN STOCK!",N.stockStatus==="low"&&` - Mínimo: ${N.minThreshold}`]})]})]},N.id))})]})]})},VV=({userProfile:n})=>{const[e,t]=z.useState([]),[i,o]=z.useState(!0),[c,d]=z.useState(null),[f,p]=z.useState(!1),[g,y]=z.useState(null),[b,E]=z.useState("create"),[j,N]=z.useState(""),[w,T]=z.useState(""),[S,q]=z.useState(!0),I=["admin","supervisor"].includes(n?.role);z.useEffect(()=>{o(!0);const P=eV(C=>{t(C),o(!1),d(null)},C=>{console.error("Error loading products:",C),d("Error cargando productos"),o(!1)});return()=>P()},[]),z.useEffect(()=>{(async()=>{if(console.log("🔍 Debug - Inicializando productos:",{productsLength:e.length,loading:i,canManageProducts:I}),e.length===0&&!i&&I)try{console.log("🚀 Creando productos predefinidos...");const C=H_();console.log("📦 Productos predefinidos:",C);for(const M of C)console.log("➕ Creando producto:",M.name),await tg({name:M.name,displayName:M.displayName,category:M.category,unit:M.unit,defaultPrice:M.defaultPrice,color:M.color,icon:M.icon,description:M.description,isActive:!0,currentStock:0,minThreshold:10,maxCapacity:1e3});console.log("✅ Productos predefinidos creados exitosamente")}catch(C){console.error("❌ Error inicializando productos:",C)}else console.log("ℹ️ No se inicializan productos:",{reason:e.length>0?"Ya existen productos":i?"Está cargando":I?"Otra razón":"Sin permisos"})})()},[e.length,i,I]);const O=()=>{y(null),E("create"),p(!0)},U=P=>{y(P),E("edit"),p(!0)},$=P=>{y(P),E("view"),p(!0)},F=async P=>{if(window.confirm("¿Estás seguro de que deseas eliminar este producto?"))try{await ZL(P)}catch(C){console.error("Error deleting product:",C),alert("Error al eliminar el producto")}},R=async P=>{try{b==="create"?await tg(P):b==="edit"&&await WL(g.id,P),p(!1)}catch(C){throw console.error("Error saving product:",C),C}},V=e.filter(P=>{const C=P.displayName?.toLowerCase().includes(j.toLowerCase())||P.name?.toLowerCase().includes(j.toLowerCase()),M=!w||P.category===w;return C&&M});return i?a.jsx("div",{className:"products-main",children:a.jsxs("div",{className:"loading-container",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Cargando productos..."})]})}):c?a.jsx("div",{className:"products-main",children:a.jsxs("div",{className:"error-container",children:[a.jsxs("p",{children:["⚠️ ",c]}),a.jsx("button",{onClick:()=>window.location.reload(),children:"Reintentar"})]})}):a.jsxs("div",{className:"products-main",children:[a.jsxs("div",{className:"products-header",children:[a.jsxs("div",{className:"header-title",children:[a.jsx("h1",{children:"🛢️ Gestión de Productos"}),a.jsx("p",{children:"Administra los tipos de combustibles y productos disponibles"})]}),I&&a.jsxs("div",{className:"header-actions",children:[a.jsx("button",{className:"btn-primary",onClick:O,children:"➕ Agregar Producto"}),a.jsx("button",{className:"btn-secondary",onClick:async()=>{try{console.log("🧪 Forzando creación de productos predefinidos...");const P=H_();for(const C of P)await tg({name:C.name,displayName:C.displayName,category:C.category,unit:C.unit,defaultPrice:C.defaultPrice,color:C.color,icon:C.icon,description:C.description,isActive:!0,currentStock:0,minThreshold:10,maxCapacity:1e3});alert("Productos predefinidos creados exitosamente")}catch(P){console.error("Error:",P),alert("Error creando productos: "+P.message)}},style:{marginLeft:"10px"},children:"🧪 Crear Predefinidos"})]})]}),S&&a.jsx(LV,{products:e}),a.jsxs("div",{className:"products-filters",children:[a.jsx("div",{className:"filter-group",children:a.jsx("input",{type:"text",placeholder:"🔍 Buscar productos...",value:j,onChange:P=>N(P.target.value),className:"search-input"})}),a.jsx("div",{className:"filter-group",children:a.jsxs("select",{value:w,onChange:P=>T(P.target.value),className:"filter-select",children:[a.jsx("option",{value:"",children:"🏷️ Todas las categorías"}),Object.values(Hs).map(P=>a.jsx("option",{value:P,children:P},P))]})}),a.jsx("div",{className:"filter-group",children:a.jsx("button",{className:`toggle-btn ${S?"active":""}`,onClick:()=>q(!S),children:"📊 Estadísticas"})})]}),a.jsx("div",{className:"products-grid",children:V.map(P=>a.jsxs("div",{className:"product-card",children:[a.jsx("div",{className:"product-icon",style:{color:P.color},children:P.icon}),a.jsxs("div",{className:"product-info",children:[a.jsx("h3",{children:P.displayName}),a.jsx("p",{className:"product-category",children:P.category}),a.jsx("p",{className:"product-description",children:P.description}),a.jsxs("div",{className:"product-stats",children:[a.jsxs("div",{className:"stat",children:[a.jsx("span",{className:"stat-label",children:"Stock:"}),a.jsxs("span",{className:"stat-value",children:[P.currentStock||0," ",P.unit]})]}),a.jsxs("div",{className:"stat",children:[a.jsx("span",{className:"stat-label",children:"Precio:"}),a.jsxs("span",{className:"stat-value",children:["$",new Intl.NumberFormat("es-CO").format(P.defaultPrice||0)]})]})]}),a.jsx("div",{className:`product-status ${P.isActive?"active":"inactive"}`,children:P.isActive?"✅ Activo":"❌ Inactivo"})]}),a.jsxs("div",{className:"product-actions",children:[a.jsx("button",{className:"btn-secondary",onClick:()=>$(P),children:"👁️ Ver"}),I&&a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"btn-primary",onClick:()=>U(P),children:"✏️ Editar"}),a.jsx("button",{className:"btn-danger",onClick:()=>F(P.id),children:"🗑️ Eliminar"})]})]})]},P.id))}),V.length===0&&a.jsxs("div",{className:"empty-state",children:[a.jsx("div",{className:"empty-icon",children:"📦"}),a.jsx("h3",{children:"No hay productos"}),a.jsx("p",{children:j||w?"No se encontraron productos con los filtros aplicados.":"Aún no hay productos registrados."}),I&&!j&&!w&&a.jsx("button",{className:"btn-primary",onClick:O,children:"➕ Crear primer producto"})]}),a.jsx(PV,{isOpen:f,onClose:()=>p(!1),product:g,mode:b,onSave:R,userRole:n?.role})]})},UV=({suppliers:n,onEdit:e,onDelete:t,hasEditPermission:i,hasDeletePermission:o})=>{const[c,d]=z.useState("name"),[f,p]=z.useState("asc"),g=S=>{c===S?p(f==="asc"?"desc":"asc"):(d(S),p("asc"))},y=[...n].sort((S,q)=>{let I=S[c],O=q[c];switch(c){case"rating":I=I||0,O=O||0;break;case"totalOrders":case"totalPurchased":I=I||0,O=O||0;break;case"createdAt":case"lastOrderDate":I=I?I.toDate?I.toDate():new Date(I):new Date(0),O=O?O.toDate?O.toDate():new Date(O):new Date(0);break;default:I=(I||"").toString().toLowerCase(),O=(O||"").toString().toLowerCase()}return I<O?f==="asc"?-1:1:I>O?f==="asc"?1:-1:0}),b=S=>{switch(S){case"active":return"#22c55e";case"inactive":return"#ef4444";case"suspended":return"#f59e0b";default:return"#6b7280"}},E=S=>{switch(S){case"active":return"Activo";case"inactive":return"Inactivo";case"suspended":return"Suspendido";default:return"Desconocido"}},j=S=>S?(S.toDate?S.toDate():new Date(S)).toLocaleDateString("es-CO"):"-",N=S=>{const q=[];for(let I=1;I<=5;I++)q.push(a.jsx("span",{className:`star ${I<=S?"filled":""}`,children:"★"},I));return a.jsx("div",{className:"rating-stars",children:q})},w=S=>!S||S.length===0?a.jsx("span",{className:"no-data",children:"-"}):a.jsxs("div",{className:"fuel-types-cell",children:[S.slice(0,2).map(q=>a.jsx("span",{className:"fuel-badge-sm",children:Tn[q]||q},q)),S.length>2&&a.jsxs("span",{className:"fuel-badge-sm more",title:S.slice(2).map(q=>Tn[q]||q).join(", "),children:["+",S.length-2]})]}),T=S=>c!==S?"icon-chevrons-up-down":f==="asc"?"icon-chevron-up":"icon-chevron-down";return a.jsxs("div",{className:"suppliers-table-container",children:[a.jsxs("div",{className:"table-wrapper",children:[a.jsxs("table",{className:"suppliers-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsxs("th",{className:`sortable ${c==="name"?"active":""}`,onClick:()=>g("name"),children:[a.jsx("span",{children:"Proveedor"}),a.jsx("i",{className:T("name")})]}),a.jsxs("th",{className:`sortable ${c==="status"?"active":""}`,onClick:()=>g("status"),children:[a.jsx("span",{children:"Estado"}),a.jsx("i",{className:T("status")})]}),a.jsxs("th",{className:`sortable ${c==="category"?"active":""}`,onClick:()=>g("category"),children:[a.jsx("span",{children:"Categoría"}),a.jsx("i",{className:T("category")})]}),a.jsx("th",{children:a.jsx("span",{children:"Combustibles"})}),a.jsx("th",{children:a.jsx("span",{children:"Contacto"})}),a.jsxs("th",{className:`sortable ${c==="rating"?"active":""}`,onClick:()=>g("rating"),children:[a.jsx("span",{children:"Rating"}),a.jsx("i",{className:T("rating")})]}),a.jsxs("th",{className:`sortable ${c==="totalOrders"?"active":""}`,onClick:()=>g("totalOrders"),children:[a.jsx("span",{children:"Órdenes"}),a.jsx("i",{className:T("totalOrders")})]}),a.jsxs("th",{className:`sortable ${c==="totalPurchased"?"active":""}`,onClick:()=>g("totalPurchased"),children:[a.jsx("span",{children:"Total Comprado"}),a.jsx("i",{className:T("totalPurchased")})]}),a.jsxs("th",{className:`sortable ${c==="createdAt"?"active":""}`,onClick:()=>g("createdAt"),children:[a.jsx("span",{children:"Creado"}),a.jsx("i",{className:T("createdAt")})]}),a.jsx("th",{className:"actions-column",children:a.jsx("span",{children:"Acciones"})})]})}),a.jsx("tbody",{children:y.map(S=>a.jsxs("tr",{className:`supplier-row ${S.status}`,children:[a.jsx("td",{className:"supplier-info-cell",children:a.jsxs("div",{className:"supplier-main-info",children:[a.jsxs("div",{className:"supplier-name",children:[S.name,S.isPreferred&&a.jsx("span",{className:"preferred-badge",title:"Proveedor Preferido",children:a.jsx("i",{className:"icon-star"})})]}),S.taxId&&a.jsxs("div",{className:"supplier-tax-id",children:["NIT: ",S.taxId]}),S.type&&a.jsx("div",{className:"supplier-type",children:S.type.charAt(0).toUpperCase()+S.type.slice(1)})]})}),a.jsx("td",{className:"status-cell",children:a.jsxs("div",{className:"status-display",children:[a.jsx("span",{className:"status-dot",style:{backgroundColor:b(S.status)}}),a.jsx("span",{className:"status-label",children:E(S.status)})]})}),a.jsx("td",{className:"category-cell",children:a.jsx("span",{className:"category-label",children:S.category?.charAt(0).toUpperCase()+S.category?.slice(1)||"-"})}),a.jsx("td",{className:"fuel-types-cell",children:w(S.fuelTypes)}),a.jsx("td",{className:"contact-cell",children:a.jsxs("div",{className:"contact-info",children:[S.contactPerson&&a.jsxs("div",{className:"contact-person",children:[a.jsx("i",{className:"icon-user"}),a.jsx("span",{children:S.contactPerson})]}),S.phone&&a.jsxs("div",{className:"contact-item",children:[a.jsx("i",{className:"icon-phone"}),a.jsx("a",{href:`tel:${S.phone}`,children:S.phone})]}),S.email&&a.jsxs("div",{className:"contact-item",children:[a.jsx("i",{className:"icon-mail"}),a.jsx("a",{href:`mailto:${S.email}`,children:S.email})]}),S.city&&a.jsxs("div",{className:"contact-item",children:[a.jsx("i",{className:"icon-map-pin"}),a.jsx("span",{children:S.city})]})]})}),a.jsx("td",{className:"rating-cell",children:a.jsxs("div",{className:"rating-display",children:[N(S.rating||0),a.jsx("span",{className:"rating-value",children:(S.rating||0).toFixed(1)})]})}),a.jsx("td",{className:"orders-cell",children:a.jsx("span",{className:"orders-count",children:S.totalOrders||0})}),a.jsx("td",{className:"purchased-cell",children:a.jsx("span",{className:"purchased-amount",children:Nt(S.totalPurchased||0)})}),a.jsx("td",{className:"date-cell",children:a.jsx("span",{className:"date-value",children:j(S.createdAt)})}),a.jsx("td",{className:"actions-cell",children:a.jsxs("div",{className:"action-buttons",children:[i&&a.jsx("button",{className:"btn btn-sm btn-secondary",onClick:()=>e(S),title:"Editar proveedor",children:a.jsx("i",{className:"icon-edit"})}),o&&S.status==="active"&&a.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>t(S.id,S.name),title:"Desactivar proveedor",children:a.jsx("i",{className:"icon-x-circle"})}),a.jsxs("div",{className:"quick-actions",children:[S.phone&&a.jsx("a",{href:`tel:${S.phone}`,className:"quick-action-btn",title:"Llamar",children:a.jsx("i",{className:"icon-phone"})}),S.email&&a.jsx("a",{href:`mailto:${S.email}`,className:"quick-action-btn",title:"Enviar email",children:a.jsx("i",{className:"icon-mail"})})]})]})})]},S.id))})]}),y.length===0&&a.jsxs("div",{className:"table-empty-state",children:[a.jsx("i",{className:"icon-truck"}),a.jsx("p",{children:"No hay proveedores para mostrar"})]})]}),a.jsxs("div",{className:"table-footer",children:[a.jsx("div",{className:"table-info",children:a.jsxs("span",{children:["Mostrando ",y.length," proveedor",y.length!==1?"es":""]})}),a.jsx("div",{className:"table-actions",children:a.jsxs("span",{className:"sort-info",children:["Ordenado por: ",c==="name"?"Nombre":c==="status"?"Estado":c==="category"?"Categoría":c==="rating"?"Rating":c==="totalOrders"?"Órdenes":c==="totalPurchased"?"Total Comprado":c==="createdAt"?"Fecha de Creación":c," (",f==="asc"?"Ascendente":"Descendente",")"]})})]})]})},FV=({suppliers:n,onEdit:e,onDelete:t,hasEditPermission:i,hasDeletePermission:o})=>{const c=j=>{switch(j){case"active":return"#22c55e";case"inactive":return"#ef4444";case"suspended":return"#f59e0b";default:return"#6b7280"}},d=j=>{switch(j){case"active":return"Activo";case"inactive":return"Inactivo";case"suspended":return"Suspendido";default:return"Desconocido"}},f=j=>{switch(j){case"combustibles":return"⛽";case"lubricantes":return"🛢️";case"aditivos":return"🧪";default:return"📦"}},p=j=>{switch(j){case"proveedor":return"Proveedor";case"distribuidor":return"Distribuidor";case"mayorista":return"Mayorista";default:return"Sin especificar"}},g=j=>j?(j.toDate?j.toDate():new Date(j)).toLocaleDateString("es-CO"):"No disponible",y=j=>{const N=[];for(let w=1;w<=5;w++)N.push(a.jsx("span",{className:`star ${w<=j?"filled":""}`,children:"★"},w));return a.jsx("div",{className:"rating-stars",children:N})},b=j=>!j||j.length===0?a.jsx("span",{className:"no-fuels",children:"Sin combustibles especificados"}):a.jsxs("div",{className:"fuel-types",children:[j.slice(0,3).map(N=>a.jsx("span",{className:"fuel-badge",title:Tn[N],children:Tn[N]||N},N)),j.length>3&&a.jsxs("span",{className:"fuel-badge more",title:`+${j.length-3} más`,children:["+",j.length-3]})]}),E=j=>{const N=[];return j.phone&&N.push(a.jsxs("div",{className:"contact-item",children:[a.jsx("i",{className:"icon-phone"}),a.jsx("span",{children:j.phone})]},"phone")),j.email&&N.push(a.jsxs("div",{className:"contact-item",children:[a.jsx("i",{className:"icon-mail"}),a.jsx("span",{children:j.email})]},"email")),j.city&&N.push(a.jsxs("div",{className:"contact-item",children:[a.jsx("i",{className:"icon-map-pin"}),a.jsx("span",{children:j.city})]},"city")),N.length>0?N:a.jsxs("div",{className:"contact-item no-contact",children:[a.jsx("i",{className:"icon-info-circle"}),a.jsx("span",{children:"Sin información de contacto"})]})};return a.jsx("div",{className:"suppliers-cards",children:n.map(j=>a.jsxs("div",{className:`supplier-card ${j.status}`,children:[a.jsxs("div",{className:"card-header",children:[a.jsx("div",{className:"header-left",children:a.jsxs("div",{className:"supplier-info",children:[a.jsxs("h3",{className:"supplier-name",children:[j.name,j.isPreferred&&a.jsx("span",{className:"preferred-badge",title:"Proveedor Preferido",children:a.jsx("i",{className:"icon-star"})})]}),j.taxId&&a.jsxs("div",{className:"supplier-tax-id",children:["NIT: ",j.taxId]})]})}),a.jsx("div",{className:"header-right",children:a.jsxs("div",{className:"supplier-status",children:[a.jsx("span",{className:"status-dot",style:{backgroundColor:c(j.status)}}),a.jsx("span",{className:"status-label",children:d(j.status)})]})})]}),a.jsxs("div",{className:"card-content",children:[a.jsxs("div",{className:"supplier-meta",children:[a.jsxs("div",{className:"meta-item",children:[a.jsx("span",{className:"meta-icon",children:f(j.category)}),a.jsx("span",{className:"meta-label",children:j.category?.charAt(0).toUpperCase()+j.category?.slice(1)||"Sin categoría"})]}),a.jsxs("div",{className:"meta-item",children:[a.jsx("i",{className:"icon-building meta-icon"}),a.jsx("span",{className:"meta-label",children:p(j.type)})]})]}),j.contactPerson&&a.jsxs("div",{className:"contact-person",children:[a.jsx("i",{className:"icon-user"}),a.jsx("span",{children:j.contactPerson})]}),a.jsx("div",{className:"contact-info",children:E(j)}),a.jsxs("div",{className:"fuel-types-section",children:[a.jsx("div",{className:"section-label",children:"Combustibles Suministrados:"}),b(j.fuelTypes)]}),a.jsxs("div",{className:"rating-section",children:[a.jsxs("div",{className:"rating-display",children:[y(j.rating||0),a.jsxs("span",{className:"rating-value",children:[(j.rating||0).toFixed(1),"/5"]})]}),j.evaluationNotes&&a.jsxs("div",{className:"evaluation-notes",title:j.evaluationNotes,children:[a.jsx("i",{className:"icon-message-square"}),a.jsx("span",{children:"Con evaluación"})]})]}),j.paymentTerms&&a.jsxs("div",{className:"payment-terms",children:[a.jsx("i",{className:"icon-credit-card"}),a.jsxs("span",{children:["Términos: ",j.paymentTerms==="contado"?"Contado":j.paymentTerms==="30dias"?"30 días":j.paymentTerms==="60dias"?"60 días":j.paymentTerms==="90dias"?"90 días":j.paymentTerms]})]}),a.jsxs("div",{className:"supplier-stats",children:[a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"stat-label",children:"Órdenes:"}),a.jsx("span",{className:"stat-value",children:j.totalOrders||0})]}),a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"stat-label",children:"Total Comprado:"}),a.jsx("span",{className:"stat-value",children:Nt(j.totalPurchased||0)})]}),j.lastOrderDate&&a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"stat-label",children:"Última Orden:"}),a.jsx("span",{className:"stat-value",children:g(j.lastOrderDate)})]})]})]}),a.jsxs("div",{className:"card-footer",children:[a.jsx("div",{className:"footer-info",children:a.jsxs("span",{className:"created-date",children:["Creado: ",g(j.createdAt)]})}),a.jsxs("div",{className:"card-actions",children:[i&&a.jsxs("button",{className:"btn btn-sm btn-secondary",onClick:()=>e(j),title:"Editar proveedor",children:[a.jsx("i",{className:"icon-edit"}),"Editar"]}),o&&j.status==="active"&&a.jsxs("button",{className:"btn btn-sm btn-danger",onClick:()=>t(j.id,j.name),title:"Desactivar proveedor",children:[a.jsx("i",{className:"icon-x-circle"}),"Desactivar"]}),a.jsxs("div",{className:"quick-actions",children:[j.phone&&a.jsx("a",{href:`tel:${j.phone}`,className:"quick-action-btn",title:"Llamar",children:a.jsx("i",{className:"icon-phone"})}),j.email&&a.jsx("a",{href:`mailto:${j.email}`,className:"quick-action-btn",title:"Enviar email",children:a.jsx("i",{className:"icon-mail"})})]})]})]})]},j.id))})},qV=({supplier:n,onClose:e,onSuccess:t,onError:i})=>{const{userProfile:o}=Qn(),c=!!n,[d,f]=z.useState({name:"",taxId:"",type:"proveedor",category:"combustibles",contactPerson:"",phone:"",email:"",address:"",city:"",state:"Colombia",fuelTypes:[],paymentTerms:"contado",creditLimit:"",priceList:{},rating:5,evaluationNotes:"",status:"active",isPreferred:!1}),[p,g]=z.useState(!1),[y,b]=z.useState({}),[E,j]=z.useState("basic");z.useEffect(()=>{c&&n&&f({name:n.name||"",taxId:n.taxId||"",type:n.type||"proveedor",category:n.category||"combustibles",contactPerson:n.contactPerson||"",phone:n.phone||"",email:n.email||"",address:n.address||"",city:n.city||"",state:n.state||"Colombia",fuelTypes:n.fuelTypes||[],paymentTerms:n.paymentTerms||"contado",creditLimit:n.creditLimit||"",priceList:n.priceList||{},rating:n.rating||5,evaluationNotes:n.evaluationNotes||"",status:n.status||"active",isPreferred:n.isPreferred||!1})},[c,n]);const N=(O,U)=>{f($=>({...$,[O]:U})),y[O]&&b($=>({...$,[O]:null}))},w=O=>{f(U=>({...U,fuelTypes:U.fuelTypes.includes(O)?U.fuelTypes.filter($=>$!==O):[...U.fuelTypes,O]}))},T=(O,U)=>{f($=>({...$,priceList:{...$.priceList,[O]:parseFloat(U)||0}}))},S=()=>{const O={};return d.name.trim()||(O.name="El nombre del proveedor es requerido"),d.category||(O.category="La categoría es requerida"),d.type||(O.type="El tipo de proveedor es requerido"),d.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email)&&(O.email="El formato del email no es válido"),d.phone&&!/^[\d\s\-+()]+$/.test(d.phone)&&(O.phone="El formato del teléfono no es válido"),d.creditLimit&&(isNaN(d.creditLimit)||parseFloat(d.creditLimit)<0)&&(O.creditLimit="El límite de crédito debe ser un número positivo"),(d.rating<1||d.rating>5)&&(O.rating="El rating debe estar entre 1 y 5"),d.fuelTypes.forEach(U=>{d.priceList[U]&&(isNaN(d.priceList[U])||parseFloat(d.priceList[U])<0)&&(O[`price_${U}`]=`El precio de ${Tn[U]} debe ser un número positivo`)}),b(O),Object.keys(O).length===0},q=async O=>{if(O.preventDefault(),!!S()){g(!0);try{const U={...d,creditLimit:parseFloat(d.creditLimit)||0,rating:parseFloat(d.rating)||5,priceList:Object.fromEntries(Object.entries(d.priceList).filter(([F,R])=>d.fuelTypes.includes(F)&&R>0))};let $;c?$=await ML(n.id,U,o?.email):$=await RL(U,o?.email),$.success?t():i($.error||"Error al guardar proveedor")}catch(U){console.error("Error saving supplier:",U),i("Error inesperado al guardar proveedor")}finally{g(!1)}}},I=[{id:"basic",label:"Información Básica",icon:"icon-info"},{id:"contact",label:"Contacto",icon:"icon-phone"},{id:"products",label:"Productos",icon:"icon-package"},{id:"commercial",label:"Comercial",icon:"icon-credit-card"}];return a.jsx("div",{className:"modal-overlay",onClick:e,children:a.jsxs("div",{className:"modal-container large",onClick:O=>O.stopPropagation(),children:[a.jsxs("div",{className:"modal-header",children:[a.jsxs("h2",{children:[a.jsx("i",{className:"icon-truck"}),c?"Editar Proveedor":"Nuevo Proveedor"]}),a.jsx("button",{className:"modal-close",onClick:e,children:a.jsx("i",{className:"icon-x"})})]}),a.jsxs("form",{onSubmit:q,children:[a.jsx("div",{className:"modal-tabs",children:I.map(O=>a.jsxs("button",{type:"button",className:`tab-button ${E===O.id?"active":""}`,onClick:()=>j(O.id),children:[a.jsx("i",{className:O.icon}),O.label]},O.id))}),a.jsxs("div",{className:"modal-body",children:[E==="basic"&&a.jsx("div",{className:"tab-content",children:a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"required",children:"Nombre del Proveedor"}),a.jsx("input",{type:"text",value:d.name,onChange:O=>N("name",O.target.value),placeholder:"Ingresa el nombre del proveedor",className:y.name?"error":""}),y.name&&a.jsx("span",{className:"error-message",children:y.name})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"NIT / Documento"}),a.jsx("input",{type:"text",value:d.taxId,onChange:O=>N("taxId",O.target.value),placeholder:"123456789-0",className:y.taxId?"error":""}),y.taxId&&a.jsx("span",{className:"error-message",children:y.taxId})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"required",children:"Tipo de Proveedor"}),a.jsxs("select",{value:d.type,onChange:O=>N("type",O.target.value),className:y.type?"error":"",children:[a.jsx("option",{value:"proveedor",children:"Proveedor"}),a.jsx("option",{value:"distribuidor",children:"Distribuidor"}),a.jsx("option",{value:"mayorista",children:"Mayorista"})]}),y.type&&a.jsx("span",{className:"error-message",children:y.type})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"required",children:"Categoría"}),a.jsxs("select",{value:d.category,onChange:O=>N("category",O.target.value),className:y.category?"error":"",children:[a.jsx("option",{value:"combustibles",children:"Combustibles"}),a.jsx("option",{value:"lubricantes",children:"Lubricantes"}),a.jsx("option",{value:"aditivos",children:"Aditivos"})]}),y.category&&a.jsx("span",{className:"error-message",children:y.category})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Estado"}),a.jsxs("select",{value:d.status,onChange:O=>N("status",O.target.value),children:[a.jsx("option",{value:"active",children:"Activo"}),a.jsx("option",{value:"inactive",children:"Inactivo"}),a.jsx("option",{value:"suspended",children:"Suspendido"})]})]}),a.jsx("div",{className:"form-group checkbox",children:a.jsxs("label",{className:"checkbox-label",children:[a.jsx("input",{type:"checkbox",checked:d.isPreferred,onChange:O=>N("isPreferred",O.target.checked)}),a.jsx("span",{className:"checkbox-mark"}),"Proveedor Preferido"]})})]})}),E==="contact"&&a.jsx("div",{className:"tab-content",children:a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Persona de Contacto"}),a.jsx("input",{type:"text",value:d.contactPerson,onChange:O=>N("contactPerson",O.target.value),placeholder:"Nombre del contacto principal"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Teléfono"}),a.jsx("input",{type:"tel",value:d.phone,onChange:O=>N("phone",O.target.value),placeholder:"+57 300 123 4567",className:y.phone?"error":""}),y.phone&&a.jsx("span",{className:"error-message",children:y.phone})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Email"}),a.jsx("input",{type:"email",value:d.email,onChange:O=>N("email",O.target.value),placeholder:"contacto@proveedor.com",className:y.email?"error":""}),y.email&&a.jsx("span",{className:"error-message",children:y.email})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Ciudad"}),a.jsx("input",{type:"text",value:d.city,onChange:O=>N("city",O.target.value),placeholder:"Bogotá"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Estado/País"}),a.jsx("input",{type:"text",value:d.state,onChange:O=>N("state",O.target.value),placeholder:"Colombia"})]}),a.jsxs("div",{className:"form-group full-width",children:[a.jsx("label",{children:"Dirección"}),a.jsx("textarea",{value:d.address,onChange:O=>N("address",O.target.value),placeholder:"Dirección completa del proveedor",rows:"3"})]})]})}),E==="products"&&a.jsxs("div",{className:"tab-content",children:[a.jsxs("div",{className:"section",children:[a.jsx("h3",{children:"Tipos de Combustible que Suministra"}),a.jsx("div",{className:"fuel-types-grid",children:Object.entries(Tn).map(([O,U])=>a.jsx("div",{className:"fuel-type-item",children:a.jsxs("label",{className:"checkbox-label",children:[a.jsx("input",{type:"checkbox",checked:d.fuelTypes.includes(O),onChange:()=>w(O)}),a.jsx("span",{className:"checkbox-mark"}),U]})},O))})]}),d.fuelTypes.length>0&&a.jsxs("div",{className:"section",children:[a.jsx("h3",{children:"Precios por Litro (Opcional)"}),a.jsx("div",{className:"prices-grid",children:d.fuelTypes.map(O=>a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:Tn[O]}),a.jsxs("div",{className:"input-with-currency",children:[a.jsx("span",{className:"currency-symbol",children:"$"}),a.jsx("input",{type:"number",step:"0.01",min:"0",value:d.priceList[O]||"",onChange:U=>T(O,U.target.value),placeholder:"0.00",className:y[`price_${O}`]?"error":""})]}),y[`price_${O}`]&&a.jsx("span",{className:"error-message",children:y[`price_${O}`]})]},O))})]})]}),E==="commercial"&&a.jsx("div",{className:"tab-content",children:a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Términos de Pago"}),a.jsxs("select",{value:d.paymentTerms,onChange:O=>N("paymentTerms",O.target.value),children:[a.jsx("option",{value:"contado",children:"Contado"}),a.jsx("option",{value:"30dias",children:"30 días"}),a.jsx("option",{value:"60dias",children:"60 días"}),a.jsx("option",{value:"90dias",children:"90 días"})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Límite de Crédito"}),a.jsxs("div",{className:"input-with-currency",children:[a.jsx("span",{className:"currency-symbol",children:"$"}),a.jsx("input",{type:"number",step:"0.01",min:"0",value:d.creditLimit,onChange:O=>N("creditLimit",O.target.value),placeholder:"0.00",className:y.creditLimit?"error":""})]}),y.creditLimit&&a.jsx("span",{className:"error-message",children:y.creditLimit})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Rating"}),a.jsxs("div",{className:"rating-input",children:[a.jsx("input",{type:"range",min:"1",max:"5",step:"0.1",value:d.rating,onChange:O=>N("rating",parseFloat(O.target.value)),className:y.rating?"error":""}),a.jsxs("div",{className:"rating-display",children:[a.jsx("span",{className:"rating-value",children:d.rating.toFixed(1)}),a.jsx("div",{className:"rating-stars",children:[1,2,3,4,5].map(O=>a.jsx("span",{className:`star ${O<=Math.round(d.rating)?"filled":""}`,children:"★"},O))})]})]}),y.rating&&a.jsx("span",{className:"error-message",children:y.rating})]}),a.jsxs("div",{className:"form-group full-width",children:[a.jsx("label",{children:"Notas de Evaluación"}),a.jsx("textarea",{value:d.evaluationNotes,onChange:O=>N("evaluationNotes",O.target.value),placeholder:"Comentarios sobre el desempeño del proveedor...",rows:"4"})]})]})})]}),a.jsxs("div",{className:"modal-footer",children:[a.jsx("button",{type:"button",className:"btn btn-secondary",onClick:e,disabled:p,children:"Cancelar"}),a.jsx("button",{type:"submit",className:"btn btn-primary",disabled:p,children:p?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"loading-spinner small"}),c?"Actualizando...":"Creando..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"icon-save"}),c?"Actualizar Proveedor":"Crear Proveedor"]})})]})]})]})})},BV=({stats:n,suppliersCount:e,totalSuppliers:t})=>{if(!n)return null;const i=d=>{switch(d){case"active":return"#22c55e";case"inactive":return"#ef4444";case"suspended":return"#f59e0b";default:return"#6b7280"}},o=d=>{switch(d){case"combustibles":return"⛽";case"lubricantes":return"🛢️";case"aditivos":return"🧪";default:return"📦"}},c=d=>{switch(d){case"proveedor":return"🏪";case"distribuidor":return"🚛";case"mayorista":return"🏭";default:return"🏢"}};return a.jsxs("div",{className:"suppliers-stats",children:[a.jsxs("div",{className:"stats-grid",children:[a.jsxs("div",{className:"stat-card primary",children:[a.jsx("div",{className:"stat-icon",children:a.jsx("i",{className:"icon-truck"})}),a.jsxs("div",{className:"stat-content",children:[a.jsx("div",{className:"stat-value",children:be(n.total)}),a.jsx("div",{className:"stat-label",children:"Total Proveedores"}),t!==e&&a.jsxs("div",{className:"stat-sublabel",children:[be(e)," mostrados"]})]})]}),a.jsxs("div",{className:"stat-card success",children:[a.jsx("div",{className:"stat-icon",children:a.jsx("i",{className:"icon-check-circle"})}),a.jsxs("div",{className:"stat-content",children:[a.jsx("div",{className:"stat-value",children:be(n.active)}),a.jsx("div",{className:"stat-label",children:"Activos"}),a.jsx("div",{className:"stat-sublabel",children:Ar(n.total>0?n.active/n.total:0)})]})]}),a.jsxs("div",{className:"stat-card warning",children:[a.jsx("div",{className:"stat-icon",children:a.jsx("i",{className:"icon-star"})}),a.jsxs("div",{className:"stat-content",children:[a.jsx("div",{className:"stat-value",children:be(n.preferred)}),a.jsx("div",{className:"stat-label",children:"Preferidos"}),a.jsx("div",{className:"stat-sublabel",children:Ar(n.active>0?n.preferred/n.active:0)})]})]}),a.jsxs("div",{className:"stat-card info",children:[a.jsx("div",{className:"stat-icon",children:a.jsx("i",{className:"icon-award"})}),a.jsxs("div",{className:"stat-content",children:[a.jsx("div",{className:"stat-value",children:n.averageRating.toFixed(1)}),a.jsx("div",{className:"stat-label",children:"Rating Promedio"}),a.jsx("div",{className:"stat-sublabel",children:a.jsx("div",{className:"rating-stars",children:[1,2,3,4,5].map(d=>a.jsx("span",{className:`star ${d<=Math.round(n.averageRating)?"filled":""}`,children:"★"},d))})})]})]})]}),a.jsxs("div",{className:"stats-details",children:[a.jsxs("div",{className:"stats-section",children:[a.jsx("h3",{children:"Estado de Proveedores"}),a.jsxs("div",{className:"stats-breakdown",children:[a.jsxs("div",{className:"breakdown-item",children:[a.jsxs("div",{className:"breakdown-label",children:[a.jsx("span",{className:"status-dot",style:{backgroundColor:i("active")}}),"Activos"]}),a.jsx("div",{className:"breakdown-value",children:n.active}),a.jsx("div",{className:"breakdown-percentage",children:Ar(n.total>0?n.active/n.total:0)})]}),n.inactive>0&&a.jsxs("div",{className:"breakdown-item",children:[a.jsxs("div",{className:"breakdown-label",children:[a.jsx("span",{className:"status-dot",style:{backgroundColor:i("inactive")}}),"Inactivos"]}),a.jsx("div",{className:"breakdown-value",children:n.inactive}),a.jsx("div",{className:"breakdown-percentage",children:Ar(n.total>0?n.inactive/n.total:0)})]}),n.suspended>0&&a.jsxs("div",{className:"breakdown-item",children:[a.jsxs("div",{className:"breakdown-label",children:[a.jsx("span",{className:"status-dot",style:{backgroundColor:i("suspended")}}),"Suspendidos"]}),a.jsx("div",{className:"breakdown-value",children:n.suspended}),a.jsx("div",{className:"breakdown-percentage",children:Ar(n.total>0?n.suspended/n.total:0)})]})]})]}),Object.keys(n.byCategory).length>0&&a.jsxs("div",{className:"stats-section",children:[a.jsx("h3",{children:"Por Categoría"}),a.jsx("div",{className:"stats-breakdown",children:Object.entries(n.byCategory).sort(([,d],[,f])=>f-d).map(([d,f])=>a.jsxs("div",{className:"breakdown-item",children:[a.jsxs("div",{className:"breakdown-label",children:[a.jsx("span",{className:"category-icon",children:o(d)}),d.charAt(0).toUpperCase()+d.slice(1).replace("_"," ")]}),a.jsx("div",{className:"breakdown-value",children:f}),a.jsx("div",{className:"breakdown-percentage",children:Ar(n.total>0?f/n.total:0)})]},d))})]}),Object.keys(n.byType).length>0&&a.jsxs("div",{className:"stats-section",children:[a.jsx("h3",{children:"Por Tipo"}),a.jsx("div",{className:"stats-breakdown",children:Object.entries(n.byType).sort(([,d],[,f])=>f-d).map(([d,f])=>a.jsxs("div",{className:"breakdown-item",children:[a.jsxs("div",{className:"breakdown-label",children:[a.jsx("span",{className:"type-icon",children:c(d)}),d.charAt(0).toUpperCase()+d.slice(1)]}),a.jsx("div",{className:"breakdown-value",children:f}),a.jsx("div",{className:"breakdown-percentage",children:Ar(n.total>0?f/n.total:0)})]},d))})]})]}),a.jsxs("div",{className:"stats-insights",children:[a.jsx("h3",{children:"Información Rápida"}),a.jsxs("div",{className:"insights-grid",children:[a.jsxs("div",{className:"insight-item",children:[a.jsx("div",{className:"insight-label",children:"Nivel de Satisfacción"}),a.jsx("div",{className:"insight-value",children:n.averageRating>=4.5?"Excelente":n.averageRating>=4?"Muy Bueno":n.averageRating>=3.5?"Bueno":n.averageRating>=3?"Regular":"Necesita Mejora"})]}),a.jsxs("div",{className:"insight-item",children:[a.jsx("div",{className:"insight-label",children:"Estado General"}),a.jsx("div",{className:"insight-value",children:n.active/n.total>=.9?"Excelente":n.active/n.total>=.8?"Bueno":n.active/n.total>=.7?"Regular":"Revisar"})]}),a.jsxs("div",{className:"insight-item",children:[a.jsx("div",{className:"insight-label",children:"Proveedores Preferidos"}),a.jsx("div",{className:"insight-value",children:n.preferred===0?"Ninguno":n.preferred/n.active>=.3?"Suficientes":n.preferred/n.active>=.2?"Buenos":"Pocos"})]}),a.jsxs("div",{className:"insight-item",children:[a.jsx("div",{className:"insight-label",children:"Diversificación"}),a.jsx("div",{className:"insight-value",children:Object.keys(n.byCategory).length>=3?"Alta":Object.keys(n.byCategory).length>=2?"Media":"Baja"})]})]})]})]})},zV=({searchTerm:n,setSearchTerm:e,filterStatus:t,setFilterStatus:i,filterCategory:o,setFilterCategory:c,filterFuelType:d,setFilterFuelType:f,viewMode:p,setViewMode:g,onClearFilters:y,resultsCount:b})=>{const E=[{value:"all",label:"Todos los Estados",icon:"list"},{value:"active",label:"Activos",icon:"check-circle"},{value:"inactive",label:"Inactivos",icon:"x-circle"},{value:"suspended",label:"Suspendidos",icon:"alert-circle"},{value:"preferred",label:"Preferidos",icon:"star"}],j=[{value:"all",label:"Todas las Categorías",icon:"grid"},{value:"combustibles",label:"Combustibles",icon:"fuel"},{value:"lubricantes",label:"Lubricantes",icon:"droplets"},{value:"aditivos",label:"Aditivos",icon:"flask"}],N=[{value:"all",label:"Todos los Combustibles",icon:"fuel"},...Object.entries(Tn).map(([T,S])=>({value:T,label:S,icon:"droplet"}))],w=n||t!=="all"||o!=="all"||d!=="all";return a.jsxs("div",{className:"suppliers-filters",children:[a.jsxs("div",{className:"filters-top",children:[a.jsx("div",{className:"search-container",children:a.jsxs("div",{className:"search-input-wrapper",children:[a.jsx("i",{className:"icon-search search-icon"}),a.jsx("input",{type:"text",placeholder:"Buscar por nombre, NIT, contacto, ciudad...",value:n,onChange:T=>e(T.target.value),className:"search-input"}),n&&a.jsx("button",{className:"search-clear",onClick:()=>e(""),title:"Limpiar búsqueda",children:a.jsx("i",{className:"icon-x"})})]})}),a.jsxs("div",{className:"view-controls",children:[a.jsxs("div",{className:"view-mode-toggle",children:[a.jsx("button",{className:`view-btn ${p==="cards"?"active":""}`,onClick:()=>g("cards"),title:"Vista de tarjetas",children:a.jsx("i",{className:"icon-grid"})}),a.jsx("button",{className:`view-btn ${p==="table"?"active":""}`,onClick:()=>g("table"),title:"Vista de tabla",children:a.jsx("i",{className:"icon-list"})})]}),w&&a.jsxs("button",{className:"btn btn-secondary clear-filters",onClick:y,title:"Limpiar todos los filtros",children:[a.jsx("i",{className:"icon-filter-x"}),"Limpiar"]})]})]}),a.jsxs("div",{className:"filters-dropdowns",children:[a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{className:"filter-label",children:"Estado"}),a.jsxs("div",{className:"select-wrapper",children:[a.jsx("select",{value:t,onChange:T=>i(T.target.value),className:"filter-select",children:E.map(T=>a.jsx("option",{value:T.value,children:T.label},T.value))}),a.jsx("i",{className:"icon-chevron-down select-arrow"})]})]}),a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{className:"filter-label",children:"Categoría"}),a.jsxs("div",{className:"select-wrapper",children:[a.jsx("select",{value:o,onChange:T=>c(T.target.value),className:"filter-select",children:j.map(T=>a.jsx("option",{value:T.value,children:T.label},T.value))}),a.jsx("i",{className:"icon-chevron-down select-arrow"})]})]}),a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{className:"filter-label",children:"Tipo de Combustible"}),a.jsxs("div",{className:"select-wrapper",children:[a.jsx("select",{value:d,onChange:T=>f(T.target.value),className:"filter-select",children:N.map(T=>a.jsx("option",{value:T.value,children:T.label},T.value))}),a.jsx("i",{className:"icon-chevron-down select-arrow"})]})]})]}),a.jsxs("div",{className:"filters-summary",children:[a.jsxs("div",{className:"results-count",children:[a.jsx("i",{className:"icon-info-circle"}),a.jsx("span",{children:b===0?"No se encontraron proveedores":`Mostrando ${b} proveedor${b!==1?"es":""}`})]}),w&&a.jsxs("div",{className:"active-filters",children:[a.jsx("span",{className:"filters-label",children:"Filtros activos:"}),a.jsxs("div",{className:"filter-tags",children:[n&&a.jsxs("span",{className:"filter-tag",children:[a.jsx("i",{className:"icon-search"}),n,a.jsx("button",{onClick:()=>e(""),children:a.jsx("i",{className:"icon-x"})})]}),t!=="all"&&a.jsxs("span",{className:"filter-tag",children:[a.jsx("i",{className:"icon-filter"}),E.find(T=>T.value===t)?.label,a.jsx("button",{onClick:()=>i("all"),children:a.jsx("i",{className:"icon-x"})})]}),o!=="all"&&a.jsxs("span",{className:"filter-tag",children:[a.jsx("i",{className:"icon-tag"}),j.find(T=>T.value===o)?.label,a.jsx("button",{onClick:()=>c("all"),children:a.jsx("i",{className:"icon-x"})})]}),d!=="all"&&a.jsxs("span",{className:"filter-tag",children:[a.jsx("i",{className:"icon-droplet"}),N.find(T=>T.value===d)?.label,a.jsx("button",{onClick:()=>f("all"),children:a.jsx("i",{className:"icon-x"})})]})]})]})]}),a.jsxs("div",{className:"quick-filters",children:[a.jsx("span",{className:"quick-filters-label",children:"Acceso rápido:"}),a.jsxs("div",{className:"quick-filter-buttons",children:[a.jsxs("button",{className:`quick-filter-btn ${t==="preferred"?"active":""}`,onClick:()=>i(t==="preferred"?"all":"preferred"),children:[a.jsx("i",{className:"icon-star"}),"Preferidos"]}),a.jsxs("button",{className:`quick-filter-btn ${t==="active"?"active":""}`,onClick:()=>i(t==="active"?"all":"active"),children:[a.jsx("i",{className:"icon-check-circle"}),"Activos"]}),a.jsxs("button",{className:`quick-filter-btn ${o==="combustibles"?"active":""}`,onClick:()=>c(o==="combustibles"?"all":"combustibles"),children:[a.jsx("i",{className:"icon-fuel"}),"Combustibles"]}),a.jsxs("button",{className:`quick-filter-btn ${d==="diesel"?"active":""}`,onClick:()=>f(d==="diesel"?"all":"diesel"),children:[a.jsx("i",{className:"icon-droplet"}),"Diésel"]})]})]})]})},HV=()=>{const{hasPermission:n,userProfile:e}=Qn(),[t,i]=z.useState([]),[o,c]=z.useState(null),[d,f]=z.useState(!0),[p,g]=z.useState(null),[y,b]=z.useState("cards"),[E,j]=z.useState(!1),[N,w]=z.useState(null),[T,S]=z.useState("all"),[q,I]=z.useState("all"),[O,U]=z.useState("all"),[$,F]=z.useState("");z.useEffect(()=>{let Q=null;return(()=>{Q=HA(me=>{i(me||[]),f(!1)})})(),()=>{Q&&Q()}},[]),z.useEffect(()=>{const Q=async()=>{const se=await OL();se.success&&c(se.data)};t.length>0&&Q()},[t]);const R=t.filter(Q=>{const se=!$||Q.name?.toLowerCase().includes($.toLowerCase())||Q.taxId?.toLowerCase().includes($.toLowerCase())||Q.contactPerson?.toLowerCase().includes($.toLowerCase())||Q.city?.toLowerCase().includes($.toLowerCase()),me=T==="all"||(T==="preferred"?Q.isPreferred:Q.status===T),Oe=q==="all"||Q.category===q,H=O==="all"||Q.fuelTypes&&Q.fuelTypes.includes(O);return se&&me&&Oe&&H}),V=()=>{if(!n("canManageSuppliers")){g("No tienes permisos para agregar proveedores");return}w(null),j(!0)},P=Q=>{if(!n("canManageSuppliers")){g("No tienes permisos para editar proveedores");return}w(Q),j(!0)},C=async(Q,se)=>{if(!n("canManageSuppliers")){g("No tienes permisos para eliminar proveedores");return}if(window.confirm(`¿Estás seguro de que deseas desactivar el proveedor "${se}"?

Esta acción se puede revertir cambiando su estado a activo.`))try{const me=await kL(Q,e?.email);me.success?g(null):g(me.error||"Error al desactivar proveedor")}catch(me){console.error("Error deleting supplier:",me),g("Error inesperado al eliminar proveedor")}},M=()=>{j(!1),w(null),g(null)},D=()=>{j(!1),w(null),g(null)},le=()=>{S("all"),I("all"),U("all"),F("")},ve=()=>{if(!n("canExportReports")){g("No tienes permisos para exportar datos");return}try{const Q=R.map(ee=>({Nombre:ee.name,"NIT/Documento":ee.taxId,Tipo:ee.type,Categoría:ee.category,"Persona de Contacto":ee.contactPerson,Teléfono:ee.phone,Email:ee.email,Ciudad:ee.city,Combustibles:ee.fuelTypes?.join(", "),Rating:ee.rating,Estado:ee.status,Preferido:ee.isPreferred?"Sí":"No","Fecha Creación":ee.createdAt?.toDate?.()?.toLocaleDateString()||"N/A"})),se=[Object.keys(Q[0]).join(","),...Q.map(ee=>Object.values(ee).map(ce=>`"${ce||""}"`).join(","))].join(`
`),me=new Blob([se],{type:"text/csv;charset=utf-8;"}),Oe=document.createElement("a"),H=URL.createObjectURL(me);Oe.setAttribute("href",H),Oe.setAttribute("download",`proveedores_${new Date().toISOString().split("T")[0]}.csv`),Oe.style.visibility="hidden",document.body.appendChild(Oe),Oe.click(),document.body.removeChild(Oe)}catch(Q){console.error("Error exporting suppliers:",Q),g("Error al exportar proveedores")}};return d?a.jsx("div",{className:"suppliers-main",children:a.jsxs("div",{className:"loading-container",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Cargando proveedores..."})]})}):a.jsxs("div",{className:"suppliers-main",children:[a.jsxs("div",{className:"suppliers-header",children:[a.jsxs("div",{className:"header-content",children:[a.jsx("h1",{children:"Gestión de Proveedores"}),a.jsx("p",{className:"header-subtitle",children:"Administra los proveedores de combustibles y materiales"})]}),a.jsxs("div",{className:"header-actions",children:[n("canManageSuppliers")&&a.jsxs("button",{className:"btn btn-primary",onClick:V,children:[a.jsx("i",{className:"icon-plus"}),"Agregar Proveedor"]}),n("canExportReports")&&a.jsxs("button",{className:"btn btn-secondary",onClick:ve,disabled:R.length===0,children:[a.jsx("i",{className:"icon-download"}),"Exportar"]})]})]}),p&&a.jsxs("div",{className:"alert alert-error",children:[a.jsx("i",{className:"icon-alert-circle"}),a.jsx("span",{children:p}),a.jsx("button",{onClick:()=>g(null),className:"alert-close",children:a.jsx("i",{className:"icon-x"})})]}),o&&a.jsx(BV,{stats:o,suppliersCount:R.length,totalSuppliers:t.length}),a.jsx(zV,{searchTerm:$,setSearchTerm:F,filterStatus:T,setFilterStatus:S,filterCategory:q,setFilterCategory:I,filterFuelType:O,setFilterFuelType:U,viewMode:y,setViewMode:b,onClearFilters:le,resultsCount:R.length}),R.length===0?a.jsxs("div",{className:"empty-state",children:[a.jsx("div",{className:"empty-icon",children:a.jsx("i",{className:"icon-truck"})}),a.jsx("h3",{children:"No hay proveedores"}),a.jsx("p",{children:t.length===0?"Comienza agregando tu primer proveedor de combustibles.":"No se encontraron proveedores que coincidan con los filtros aplicados."}),t.length===0&&n("canManageSuppliers")&&a.jsxs("button",{className:"btn btn-primary",onClick:V,children:[a.jsx("i",{className:"icon-plus"}),"Agregar Primer Proveedor"]}),t.length>0&&a.jsxs("button",{className:"btn btn-secondary",onClick:le,children:[a.jsx("i",{className:"icon-filter-x"}),"Limpiar Filtros"]})]}):a.jsx("div",{className:"suppliers-content",children:y==="cards"?a.jsx(FV,{suppliers:R,onEdit:P,onDelete:C,hasEditPermission:n("canManageSuppliers"),hasDeletePermission:n("canManageSuppliers")}):a.jsx(UV,{suppliers:R,onEdit:P,onDelete:C,hasEditPermission:n("canManageSuppliers"),hasDeletePermission:n("canManageSuppliers")})}),E&&a.jsx(qV,{supplier:N,onClose:M,onSuccess:D,onError:g})]})},GV=()=>{const{user:n,userProfile:e}=Qn(),[t,i]=z.useState("invitations"),[o,c]=z.useState([]),[d,f]=z.useState(!1),[p,g]=z.useState(!1),[y,b]=z.useState(!1),[E,j]=z.useState({email:"",name:"",role:Ns.CLIENTE});z.useEffect(()=>{n&&e?.role==="admin"&&N()},[n,e]);const N=async()=>{f(!0);try{const O=await mL(n.uid);O.success?c(O.invitations):console.error("Error loading invitations:",O.error)}catch(O){console.error("Error loading invitations:",O)}finally{f(!1)}},w=async O=>{O.preventDefault(),b(!0);try{const U=await hL(E,n.uid);U.success?(j({email:"",name:"",role:Ns.CLIENTE}),g(!1),await N(),alert(`Invitación creada exitosamente!
Código: ${U.invitation.code}`)):alert(`Error: ${U.error}`)}catch(U){console.error("Error creating invitation:",U),alert("Error creando invitación")}finally{b(!1)}},T=async O=>{if(confirm("¿Estás seguro de cancelar esta invitación?"))try{const U=await pL(O,n.uid);U.success?(await N(),alert("Invitación cancelada exitosamente")):alert(`Error: ${U.error}`)}catch(U){console.error("Error cancelling invitation:",U),alert("Error cancelando invitación")}},S=O=>({pending:{text:"Pendiente",class:"status-pending"},used:{text:"Usada",class:"status-used"},cancelled:{text:"Cancelada",class:"status-cancelled"},expired:{text:"Expirada",class:"status-expired"}})[O]||{text:O,class:"status-unknown"},q=O=>({admin:"Administrador",contador:"Contador",cliente:"Cliente"})[O]||O,I=O=>O?(O.toDate?O.toDate():new Date(O)).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";return e?.role!=="admin"?a.jsxs("div",{className:"admin-unauthorized",children:[a.jsx("h2",{children:"⛔ Acceso Denegado"}),a.jsx("p",{children:"Solo los administradores pueden acceder a esta sección."})]}):a.jsxs("div",{className:"admin-main",children:[a.jsxs("div",{className:"admin-header",children:[a.jsx("h1",{children:"⚙️ Administración del Sistema"}),a.jsx("p",{children:"Gestión de usuarios y configuraciones"})]}),a.jsxs("div",{className:"admin-tabs",children:[a.jsx("button",{className:`tab-button ${t==="invitations"?"active":""}`,onClick:()=>i("invitations"),children:"🎫 Invitaciones"}),a.jsx("button",{className:`tab-button ${t==="users"?"active":""}`,onClick:()=>i("users"),children:"👥 Usuarios"}),a.jsx("button",{className:`tab-button ${t==="settings"?"active":""}`,onClick:()=>i("settings"),children:"⚙️ Configuración"})]}),a.jsxs("div",{className:"admin-content",children:[t==="invitations"&&a.jsxs("div",{className:"invitations-section",children:[a.jsxs("div",{className:"section-header",children:[a.jsx("h2",{children:"Gestión de Invitaciones"}),a.jsx("button",{className:"create-button",onClick:()=>g(!0),children:"+ Crear Invitación"})]}),d?a.jsx("div",{className:"loading",children:"Cargando invitaciones..."}):a.jsxs("div",{className:"invitations-table",children:[a.jsxs("table",{children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Código"}),a.jsx("th",{children:"Email"}),a.jsx("th",{children:"Nombre"}),a.jsx("th",{children:"Rol"}),a.jsx("th",{children:"Estado"}),a.jsx("th",{children:"Creada"}),a.jsx("th",{children:"Expira"}),a.jsx("th",{children:"Acciones"})]})}),a.jsx("tbody",{children:o.map(O=>{const U=S(O.status);return a.jsxs("tr",{children:[a.jsx("td",{children:a.jsx("code",{className:"invitation-code",children:O.code})}),a.jsx("td",{children:O.targetEmail}),a.jsx("td",{children:O.targetName||"-"}),a.jsx("td",{children:q(O.targetRole)}),a.jsx("td",{children:a.jsx("span",{className:`status-badge ${U.class}`,children:U.text})}),a.jsx("td",{children:I(O.createdAt)}),a.jsx("td",{children:I(O.expiresAt)}),a.jsx("td",{children:O.status==="pending"&&a.jsx("button",{className:"cancel-button",onClick:()=>T(O.id),children:"Cancelar"})})]},O.id)})})]}),o.length===0&&a.jsx("div",{className:"empty-state",children:a.jsx("p",{children:"No hay invitaciones creadas"})})]})]}),t==="users"&&a.jsxs("div",{className:"users-section",children:[a.jsx("h2",{children:"👥 Usuarios del Sistema"}),a.jsxs("div",{className:"coming-soon",children:[a.jsx("span",{children:"🚧 En desarrollo"}),a.jsx("p",{children:"Próximamente: Lista de usuarios registrados, edición de permisos, y estadísticas."})]})]}),t==="settings"&&a.jsxs("div",{className:"settings-section",children:[a.jsx("h2",{children:"⚙️ Configuración del Sistema"}),a.jsxs("div",{className:"coming-soon",children:[a.jsx("span",{children:"🚧 En desarrollo"}),a.jsx("p",{children:"Próximamente: Configuraciones generales, notificaciones, y parámetros del sistema."})]})]})]}),p&&a.jsx("div",{className:"modal-overlay",onClick:()=>g(!1),children:a.jsxs("div",{className:"modal-content",onClick:O=>O.stopPropagation(),children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("h3",{children:"Crear Nueva Invitación"}),a.jsx("button",{className:"modal-close",onClick:()=>g(!1),children:"×"})]}),a.jsxs("form",{onSubmit:w,className:"invitation-form",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"email",children:"Email del usuario:"}),a.jsx("input",{id:"email",type:"email",required:!0,value:E.email,onChange:O=>j({...E,email:O.target.value}),placeholder:"usuario@ejemplo.com"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"name",children:"Nombre (opcional):"}),a.jsx("input",{id:"name",type:"text",value:E.name,onChange:O=>j({...E,name:O.target.value}),placeholder:"Nombre del usuario"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"role",children:"Rol:"}),a.jsxs("select",{id:"role",value:E.role,onChange:O=>j({...E,role:O.target.value}),children:[a.jsx("option",{value:Ns.CLIENTE,children:"Cliente"}),a.jsx("option",{value:Ns.CONTADOR,children:"Contador"}),a.jsx("option",{value:Ns.ADMIN,children:"Administrador"})]})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"cancel-button",onClick:()=>g(!1),children:"Cancelar"}),a.jsx("button",{type:"submit",className:"create-button",disabled:y,children:y?"Creando...":"Crear Invitación"})]})]})]})})]})},aC="combustibles_inventory",Cf="combustibles_movements",Au="combustibles_vehicles",$V=async()=>{try{const[n,e,t]=await Promise.all([He(Ee(he,aC)),He(Ee(he,Cf)),He(Ee(he,Au))]),i=n.docs.map(S=>({id:S.id,...S.data()})),o=e.docs.map(S=>({id:S.id,...S.data()})),c=t.docs.map(S=>({id:S.id,...S.data()})),d=i.reduce((S,q)=>{const I=q.pricePerUnit||0,O=q.currentStock||0;return Ti(S,I*O)},0),f=new Date,p=new Date(f.getFullYear(),f.getMonth(),1),y=o.filter(S=>(S.createdAt?.toDate()||new Date(0))>=p&&(S.type==="salida"||S.type==="ajuste")).reduce((S,q)=>Ti(S,q.totalValue||0),0),b=c.filter(S=>S.status==="activo"&&S.totalHoursWorked>0&&S.totalFuelConsumed>0),E=b.length>0?b.reduce((S,q)=>{const I=q.totalFuelConsumed/q.totalHoursWorked;return Ti(S,I)},0)/b.length:0,j=c.length,N=c.filter(S=>S.status==="activo").length,w=j>0?Rt(N/j*100,1):0,T=i.filter(S=>{const q=S.currentStock||0,I=S.minThreshold||0;return q<=I&&q>0}).length;return{totalInventoryValue:Rt(d,2),monthlyFuelCost:Rt(y,2),avgFleetEfficiency:Rt(E,2),fleetAvailability:w,lowStockAlerts:T,totalVehicles:j,activeVehiclesCount:N,lastUpdated:new Date}}catch(n){throw console.error("Error obteniendo métricas ejecutivas:",n),n}},YV=async(n=6)=>{try{const t=(await He(Ee(he,Cf))).docs.map(j=>({id:j.id,...j.data()})),i=new Date;i.setMonth(i.getMonth()-n);const o=t.filter(j=>(j.createdAt?.toDate()||new Date(0))>=i),c={};o.forEach(j=>{const N=j.createdAt?.toDate()||new Date,w=`${N.getFullYear()}-${String(N.getMonth()+1).padStart(2,"0")}`;c[w]||(c[w]={cost:0,volume:0}),(j.type==="salida"||j.type==="ajuste")&&(c[w].cost+=j.totalValue||0,c[w].volume+=j.quantity||0)});const d={labels:Object.keys(c).sort(),datasets:[{label:"Costo Mensual (COP)",data:Object.keys(c).sort().map(j=>c[j].cost),borderColor:"#2D5016",backgroundColor:"rgba(45, 80, 22, 0.1)",tension:.4}]},p=(await He(Ee(he,Au))).docs.map(j=>({id:j.id,...j.data()})),g={};p.forEach(j=>{const N=j.type||"Otros",w=j.totalFuelConsumed||0;g[N]||(g[N]=0),g[N]+=w});const y={labels:Object.keys(g),datasets:[{label:"Consumo Total (gal)",data:Object.values(g),backgroundColor:["#2D5016","#4A7C59","#5D8B3B","#7A9A01","#8FBC8F","#32CD32","#228B22","#006400"],borderWidth:2,borderColor:"#ffffff"}]},b={};o.forEach(j=>{const N=j.location||"No especificada",w=j.totalValue||0;b[N]||(b[N]=0),b[N]+=w});const E={labels:Object.keys(b),datasets:[{label:"Costo por Ubicación (COP)",data:Object.values(b),backgroundColor:["#2D5016","#4A7C59","#5D8B3B","#7A9A01","#8FBC8F","#32CD32","#228B22","#006400"],borderWidth:2,borderColor:"#ffffff"}]};return{monthlyCostData:d,consumptionByTypeData:y,costsByLocationData:E,lastUpdated:new Date}}catch(e){throw console.error("Error obteniendo datos de gráficos ejecutivos:",e),e}},QV=async()=>{try{const[n,e,t]=await Promise.all([He(Ee(he,aC)),He(Ee(he,Cf)),He(Ee(he,Au))]),i=n.docs.map(y=>({id:y.id,...y.data()})),o=e.docs.map(y=>({id:y.id,...y.data()})),c=t.docs.map(y=>({id:y.id,...y.data()})),d=i.filter(y=>{const b=y.currentStock||0,E=y.minThreshold||0;return b<=E&&b>0}).map(y=>({id:y.id,fuelType:y.fuelType,location:y.location,currentStock:y.currentStock,maxCapacity:y.maxCapacity,percentage:Rt(y.currentStock/y.maxCapacity*100,1),severity:y.currentStock<=y.maxCapacity*.1?"critical":"warning"})).sort((y,b)=>y.percentage-b.percentage),f=o.filter(y=>y.status==="pendiente").map(y=>({id:y.id,type:y.type,fuelType:y.fuelType,quantity:y.quantity,location:y.location,vehicleId:y.vehicleId,createdAt:y.createdAt,daysPending:Math.floor((new Date-y.createdAt?.toDate())/(1e3*60*60*24))})).sort((y,b)=>b.daysPending-y.daysPending),p=c.filter(y=>y.status==="mantenimiento"||y.status==="reparacion").map(y=>({vehicleId:y.vehicleId,name:y.name,type:y.type,status:y.status,location:y.currentLocation,nextMaintenanceDate:y.nextMaintenanceDate})),g=i.map(y=>({id:y.id,fuelType:y.fuelType,location:y.location,currentStock:y.currentStock||0,maxCapacity:y.maxCapacity||0,percentage:y.maxCapacity>0?Rt(y.currentStock/y.maxCapacity*100,1):0,status:WV(y.currentStock,y.maxCapacity)})).sort((y,b)=>y.percentage-b.percentage);return{lowStockItems:d,pendingMovements:f,maintenanceVehicles:p,stockLevels:g,summary:{lowStockCount:d.length,pendingMovementsCount:f.length,maintenanceVehiclesCount:p.length,criticalStockCount:d.filter(y=>y.severity==="critical").length},lastUpdated:new Date}}catch(n){throw console.error("Error obteniendo alertas operativas:",n),n}},KV=async()=>{try{const t=(await He(Ee(he,Au))).docs.map(o=>({id:o.id,...o.data()})).filter(o=>o.totalHoursWorked>0&&o.totalFuelConsumed>0).map(o=>{const c=o.totalFuelConsumed/o.totalHoursWorked,d=o.estimatedConsumptionPerHour||c,f=Rt((c-d)/d*100,2);return{vehicleId:o.vehicleId,name:o.name,type:o.type,status:o.status,totalHoursWorked:o.totalHoursWorked,totalFuelConsumed:o.totalFuelConsumed,actualEfficiency:Rt(c,2),estimatedEfficiency:Rt(d,2),efficiencyVariance:f,performanceRating:ZV(f),fuelCompatibility:o.fuelCompatibility}}).sort((o,c)=>o.actualEfficiency-c.actualEfficiency),i={};return t.forEach(o=>{const c=o.type;i[c]||(i[c]={vehicles:[],avgEfficiency:0,totalHours:0,totalFuel:0}),i[c].vehicles.push(o),i[c].totalHours+=o.totalHoursWorked,i[c].totalFuel+=o.totalFuelConsumed}),Object.keys(i).forEach(o=>{const c=i[o];c.avgEfficiency=Rt(c.totalFuel/c.totalHours,2)}),{vehicleEfficiency:t,efficiencyByType:i,topPerformers:t.slice(0,5),worstPerformers:t.slice(-5).reverse(),lastUpdated:new Date}}catch(n){throw console.error("Error en análisis de eficiencia:",n),n}},XV=async()=>{try{const[n,e]=await Promise.all([He(Ee(he,Cf)),He(Ee(he,Au))]),t=n.docs.map(d=>({id:d.id,...d.data()})),i=e.docs.map(d=>({id:d.id,...d.data()})),o={};t.filter(d=>d.type==="salida"&&d.vehicleId).forEach(d=>{const f=d.vehicleId;o[f]||(o[f]={totalCost:0,totalFuel:0,movements:[]}),o[f].totalCost+=d.totalValue||0,o[f].totalFuel+=d.quantity||0,o[f].movements.push(d)});const c=i.map(d=>{const f=d.vehicleId,p=o[f]||{totalCost:0,totalFuel:0,movements:[]},g=d.totalHoursWorked||0;return{vehicleId:f,name:d.name,type:d.type,status:d.status,totalCost:Rt(p.totalCost,2),totalFuel:Rt(p.totalFuel,2),totalHours:g,costPerHour:g>0?Rt(p.totalCost/g,2):0,costPerGallon:p.totalFuel>0?Rt(p.totalCost/p.totalFuel,2):0,movementsCount:p.movements.length,avgMovementCost:p.movements.length>0?Rt(p.totalCost/p.movements.length,2):0}}).sort((d,f)=>f.costPerHour-d.costPerHour);return{vehicleCosts:c,mostExpensive:c.slice(0,10),leastExpensive:c.filter(d=>d.totalCost>0).slice(-10),lastUpdated:new Date}}catch(n){throw console.error("Error en análisis de costos:",n),n}};function WV(n,e){const t=e>0?n/e*100:0;return t<=10?"critical":t<=20?"warning":t>=90?"full":"normal"}function ZV(n){return n<=-15?"excellent":n<=-5?"good":n<=5?"average":n<=15?"poor":"critical"}const yh=z.forwardRef(({type:n,data:e},t)=>a.jsxs("div",{ref:t,className:"chart-placeholder",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"300px",background:"#F9FAFB",border:"2px dashed #D1D5DB",borderRadius:"8px",color:"#6B7280"},children:[a.jsx("div",{style:{fontSize:"2rem",marginBottom:"1rem"},children:n==="line"?"📈":n==="bar"?"📊":n==="pie"?"🥧":n==="doughnut"?"🍩":n==="scatter"?"🔸":"📊"}),a.jsxs("h3",{style:{margin:"0 0 0.5rem 0",fontSize:"1.125rem",fontWeight:"600"},children:["Gráfico ",n]}),a.jsx("p",{style:{margin:0,fontSize:"0.875rem"},children:e?.datasets?.[0]?.label||"Datos del gráfico"}),a.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.75rem"},children:[e?.labels?.length||0," puntos de datos"]})]}));yh.displayName="ChartComponent";const K_=({executiveData:n,onRefresh:e,loading:t,error:i})=>{const[o,c]=z.useState(null),[d,f]=z.useState(!1),[p,g]=z.useState(6);z.useEffect(()=>{y()},[p]);const y=async()=>{try{f(!0);const S=await YV(p);c(S)}catch(S){console.error("Error cargando datos de gráficos:",S)}finally{f(!1)}},b=()=>{if(!o||!o.monthlyCostData||!o.monthlyCostData.datasets||!o.monthlyCostData.datasets[0]||!o.monthlyCostData.datasets[0].data||o.monthlyCostData.datasets[0].data.length<2)return{value:0,trend:"neutral"};const S=o.monthlyCostData.datasets[0].data,q=S[S.length-1]||0,I=S[S.length-2]||0;if(I===0)return{value:0,trend:"neutral"};const O=(q-I)/I*100,U=O>5?"up":O<-5?"down":"neutral";return{value:Math.abs(O),trend:U}},E=()=>{if(!n||typeof n.fleetAvailability>"u")return"unknown";const S=n.fleetAvailability||0;return S>=90?"excellent":S>=75?"good":S>=60?"warning":"critical"},j=()=>{if(!n||typeof n.lowStockAlerts>"u")return"unknown";const S=n.lowStockAlerts||0;return S===0?"excellent":S<=2?"good":S<=5?"warning":"critical"},N=z.useMemo(()=>b(),[o]),w=z.useMemo(()=>E(),[n]),T=z.useMemo(()=>j(),[n]);return t&&!n?a.jsxs("div",{className:"dashboard-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Cargando métricas ejecutivas..."})]}):i?a.jsxs("div",{className:"dashboard-error",children:[a.jsx("h3",{children:"Error en Dashboard Ejecutivo"}),a.jsx("p",{children:i}),a.jsx("button",{onClick:e,children:"Reintentar"})]}):a.jsxs("div",{className:"executive-dashboard",children:[a.jsx("div",{className:"dashboard-controls",children:a.jsxs("div",{className:"period-selector",children:[a.jsx("label",{children:"Período de análisis:"}),a.jsxs("select",{value:p,onChange:S=>g(Number(S.target.value)),children:[a.jsx("option",{value:3,children:"Últimos 3 meses"}),a.jsx("option",{value:6,children:"Últimos 6 meses"}),a.jsx("option",{value:12,children:"Último año"})]})]})}),a.jsxs("div",{className:"kpi-cards-grid",children:[a.jsxs("div",{className:`kpi-card inventory-value ${T}`,children:[a.jsxs("div",{className:"kpi-header",children:[a.jsx("h3",{children:"📦 Valor del Inventario"}),a.jsx("span",{className:`status-badge ${T}`,children:T==="excellent"?"✅":T==="good"?"🟡":T==="warning"?"⚠️":"🚨"})]}),a.jsx("div",{className:"kpi-value",children:Nt(n?.totalInventoryValue||0)}),a.jsx("div",{className:"kpi-footer",children:a.jsxs("span",{className:"kpi-metric",children:[n?.lowStockAlerts||0," alertas de stock bajo"]})})]}),a.jsxs("div",{className:"kpi-card monthly-cost",children:[a.jsxs("div",{className:"kpi-header",children:[a.jsx("h3",{children:"💰 Costo Mensual"}),a.jsx("span",{className:`trend-indicator ${N.trend}`,children:N.trend==="up"?"📈":N.trend==="down"?"📉":"➖"})]}),a.jsx("div",{className:"kpi-value",children:Nt(n?.monthlyFuelCost||0)}),a.jsx("div",{className:"kpi-footer",children:a.jsx("span",{className:`variation ${N.trend}`,children:N.trend==="neutral"?"Sin cambios":`${N.trend==="up"?"+":"-"}${N.value.toFixed(1)}% vs mes anterior`})})]}),a.jsxs("div",{className:"kpi-card fleet-efficiency",children:[a.jsxs("div",{className:"kpi-header",children:[a.jsx("h3",{children:"⚡ Eficiencia Flota"}),a.jsx("span",{className:"unit",children:"gal/hr"})]}),a.jsx("div",{className:"kpi-value",children:be(n?.avgFleetEfficiency||0,2)}),a.jsx("div",{className:"kpi-footer",children:a.jsxs("span",{className:"kpi-metric",children:["Promedio de ",n?.totalVehicles||0," vehículos"]})})]}),a.jsxs("div",{className:`kpi-card fleet-availability ${w}`,children:[a.jsxs("div",{className:"kpi-header",children:[a.jsx("h3",{children:"🚜 Disponibilidad Flota"}),a.jsx("span",{className:`status-badge ${w}`,children:w==="excellent"?"✅":w==="good"?"🟡":w==="warning"?"⚠️":"🚨"})]}),a.jsxs("div",{className:"kpi-value",children:[n?.fleetAvailability||0,"%"]}),a.jsx("div",{className:"kpi-footer",children:a.jsxs("span",{className:"kpi-metric",children:[n?.activeVehiclesCount||0," de ",n?.totalVehicles||0," activos"]})})]})]}),o&&!d?a.jsxs("div",{className:"executive-charts",children:[o.monthlyCostData&&a.jsxs("div",{className:"chart-container large",children:[a.jsxs("div",{className:"chart-header",children:[a.jsx("h3",{children:"📈 Evolución de Costos Mensuales"}),a.jsx("p",{children:"Tendencia de gastos en combustible"})]}),a.jsx("div",{className:"chart-content",children:a.jsx(yh,{type:"line",data:o.monthlyCostData,options:{responsive:!0,plugins:{title:{display:!1},legend:{display:!1}}}})})]}),o.consumptionByTypeData&&a.jsxs("div",{className:"chart-container medium",children:[a.jsxs("div",{className:"chart-header",children:[a.jsx("h3",{children:"🚜 Consumo por Tipo de Vehículo"}),a.jsx("p",{children:"Distribución del consumo total"})]}),a.jsx("div",{className:"chart-content",children:a.jsx(yh,{type:"bar",data:o.consumptionByTypeData,options:{responsive:!0,plugins:{title:{display:!1}}}})})]}),o.costsByLocationData&&a.jsxs("div",{className:"chart-container medium",children:[a.jsxs("div",{className:"chart-header",children:[a.jsx("h3",{children:"📍 Costos por Ubicación"}),a.jsx("p",{children:"Distribución geográfica del gasto"})]}),a.jsx("div",{className:"chart-content",children:a.jsx(yh,{type:"pie",data:o.costsByLocationData,options:{responsive:!0,plugins:{title:{display:!1}}}})})]})]}):a.jsxs("div",{className:"charts-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Cargando gráficos estratégicos..."})]}),a.jsxs("div",{className:"executive-summary",children:[a.jsx("h3",{children:"📋 Resumen Ejecutivo"}),a.jsxs("div",{className:"summary-grid",children:[a.jsxs("div",{className:"summary-item",children:[a.jsx("h4",{children:"💡 Insights Clave"}),a.jsxs("ul",{children:[a.jsxs("li",{children:["Inventario valorado en ",Nt(n?.totalInventoryValue||0)]}),a.jsxs("li",{children:["Eficiencia promedio de ",be(n?.avgFleetEfficiency||0,2)," gal/hr"]}),a.jsxs("li",{children:[n?.fleetAvailability||0,"% de disponibilidad operativa"]})]})]}),a.jsxs("div",{className:"summary-item",children:[a.jsx("h4",{children:"⚠️ Alertas y Acciones"}),a.jsxs("ul",{children:[(n?.lowStockAlerts||0)>0&&a.jsxs("li",{className:"alert",children:[n.lowStockAlerts," items con stock bajo requieren reabastecimiento"]}),(n?.fleetAvailability||0)<80&&a.jsx("li",{className:"alert",children:"Disponibilidad de flota por debajo del 80% - revisar mantenimientos"}),(n?.lowStockAlerts||0)===0&&(n?.fleetAvailability||0)>=80&&a.jsx("li",{className:"success",children:"✅ Operación normal - sin alertas críticas"})]})]})]})]})]})},JV=({operationalData:n,onRefresh:e,loading:t,error:i})=>t&&!n?a.jsxs("div",{className:"dashboard-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Cargando alertas operativas..."})]}):i?a.jsxs("div",{className:"dashboard-error",children:[a.jsx("h3",{children:"Error en Dashboard Operativo"}),a.jsx("p",{children:i}),a.jsx("button",{onClick:e,children:"Reintentar"})]}):a.jsxs("div",{className:"operational-dashboard",children:[a.jsxs("div",{className:"dashboard-controls",children:[a.jsx("h2",{children:"⚡ Dashboard Operativo"}),a.jsx("p",{children:"Alertas y métricas en tiempo real"})]}),n&&a.jsxs("div",{className:"alerts-summary",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"2rem"},children:[a.jsxs("div",{className:"alert-card",style:{background:"white",padding:"1rem",borderRadius:"8px",border:"1px solid #E5E7EB"},children:[a.jsx("h4",{style:{margin:"0 0 0.5rem 0",color:"#DC2626"},children:"🚨 Stock Bajo"}),a.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#DC2626"},children:n.summary?.lowStockCount||0}),a.jsx("p",{style:{margin:0,fontSize:"0.875rem",color:"#6B7280"},children:"Items requieren reabastecimiento"})]}),a.jsxs("div",{className:"alert-card",style:{background:"white",padding:"1rem",borderRadius:"8px",border:"1px solid #E5E7EB"},children:[a.jsx("h4",{style:{margin:"0 0 0.5rem 0",color:"#F59E0B"},children:"⏳ Pendientes"}),a.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#F59E0B"},children:n.summary?.pendingMovementsCount||0}),a.jsx("p",{style:{margin:0,fontSize:"0.875rem",color:"#6B7280"},children:"Movimientos por aprobar"})]}),a.jsxs("div",{className:"alert-card",style:{background:"white",padding:"1rem",borderRadius:"8px",border:"1px solid #E5E7EB"},children:[a.jsx("h4",{style:{margin:"0 0 0.5rem 0",color:"#EF4444"},children:"🔧 Mantenimiento"}),a.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#EF4444"},children:n.summary?.maintenanceVehiclesCount||0}),a.jsx("p",{style:{margin:0,fontSize:"0.875rem",color:"#6B7280"},children:"Vehículos en reparación"})]}),a.jsxs("div",{className:"alert-card",style:{background:"white",padding:"1rem",borderRadius:"8px",border:"1px solid #E5E7EB"},children:[a.jsx("h4",{style:{margin:"0 0 0.5rem 0",color:"#DC2626"},children:"🚨 Críticos"}),a.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#DC2626"},children:n.summary?.criticalStockCount||0}),a.jsx("p",{style:{margin:0,fontSize:"0.875rem",color:"#6B7280"},children:"Items en estado crítico"})]})]}),n?.lowStockItems&&n.lowStockItems.length>0&&a.jsxs("div",{className:"alerts-section",style:{background:"white",borderRadius:"8px",padding:"1.5rem",marginBottom:"1.5rem",border:"1px solid #E5E7EB"},children:[a.jsx("h3",{style:{margin:"0 0 1rem 0",color:"#DC2626"},children:"🚨 Alertas de Stock Bajo"}),a.jsx("div",{style:{display:"grid",gap:"0.75rem"},children:n.lowStockItems.slice(0,5).map((o,c)=>a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem",background:o.severity==="critical"?"#FEF2F2":"#FFFBEB",borderRadius:"6px",borderLeft:`4px solid ${o.severity==="critical"?"#DC2626":"#F59E0B"}`},children:[a.jsxs("div",{children:[a.jsxs("div",{style:{fontWeight:"600",color:"#1F2937"},children:[o.fuelType," - ",o.location]}),a.jsxs("div",{style:{fontSize:"0.875rem",color:"#6B7280"},children:["Stock actual: ",o.currentStock," gal (",o.percentage,"% de capacidad)"]})]}),a.jsx("div",{style:{padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"600",color:"white",background:o.severity==="critical"?"#DC2626":"#F59E0B"},children:o.severity==="critical"?"CRÍTICO":"BAJO"})]},o.id||c))})]}),n?.pendingMovements&&n.pendingMovements.length>0&&a.jsxs("div",{className:"pending-section",style:{background:"white",borderRadius:"8px",padding:"1.5rem",marginBottom:"1.5rem",border:"1px solid #E5E7EB"},children:[a.jsx("h3",{style:{margin:"0 0 1rem 0",color:"#F59E0B"},children:"⏳ Movimientos Pendientes"}),a.jsx("div",{style:{display:"grid",gap:"0.75rem"},children:n.pendingMovements.slice(0,5).map((o,c)=>a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem",background:"#FFFBEB",borderRadius:"6px",borderLeft:"4px solid #F59E0B"},children:[a.jsxs("div",{children:[a.jsxs("div",{style:{fontWeight:"600",color:"#1F2937"},children:[o.type?.toUpperCase()," - ",o.fuelType]}),a.jsxs("div",{style:{fontSize:"0.875rem",color:"#6B7280"},children:[o.quantity," gal - ",o.location,o.vehicleId&&` → ${o.vehicleId}`]})]}),a.jsxs("div",{style:{padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"600",color:"white",background:"#F59E0B"},children:[o.daysPending," días"]})]},o.id||c))})]}),a.jsxs("div",{className:"implementation-note",style:{background:"#F0FDF4",border:"1px solid #BBF7D0",borderRadius:"8px",padding:"1rem",textAlign:"center",color:"#166534"},children:[a.jsx("h4",{style:{margin:"0 0 0.5rem 0"},children:"🚧 Dashboard Operativo en Desarrollo"}),a.jsx("p",{style:{margin:0,fontSize:"0.875rem"},children:"Gemini está completando la implementación final con barras de progreso, gráficos en tiempo real y funcionalidades avanzadas."})]})]}),e4=({onRefresh:n,lastRefresh:e,loading:t,error:i})=>{const[o,c]=z.useState(null),[d,f]=z.useState(null),[p,g]=z.useState(!1),[y,b]=z.useState("efficiency"),E=[{id:"efficiency",name:"Análisis de Eficiencia",icon:"⚡",description:"Rendimiento gal/hr por vehículo"},{id:"costs",name:"Análisis de Costos",icon:"💰",description:"Costo operativo por vehículo y hora"},{id:"trends",name:"Análisis de Tendencias",icon:"📈",description:"Patrones y proyecciones"}];z.useEffect(()=>{j()},[]);const j=async()=>{try{g(!0);const[I,O]=await Promise.all([KV(),XV()]);c(I),f(O)}catch(I){console.error("Error cargando datos analíticos:",I)}finally{g(!1)}},N=I=>{switch(I){case"excellent":return"#10B981";case"good":return"#2D5016";case"average":return"#F59E0B";case"poor":return"#EF4444";case"critical":return"#DC2626";default:return"#6B7280"}},w=I=>{switch(I){case"excellent":return"🏆";case"good":return"✅";case"average":return"🟡";case"poor":return"⚠️";case"critical":return"🚨";default:return"❓"}},T=()=>o?a.jsxs("div",{className:"analysis-section",children:[a.jsxs("div",{className:"analysis-header",children:[a.jsx("h3",{children:"⚡ Análisis de Eficiencia de Vehículos"}),a.jsx("p",{children:"Ranking de rendimiento basado en consumo gal/hr"})]}),a.jsxs("div",{className:"efficiency-summary",children:[a.jsx("h4",{children:"📊 Eficiencia por Tipo de Vehículo"}),a.jsx("div",{className:"efficiency-types-grid",children:Object.entries(o.efficiencyByType).map(([I,O])=>a.jsxs("div",{className:"efficiency-type-card",children:[a.jsxs("div",{className:"type-header",children:[a.jsx("h5",{children:I}),a.jsxs("span",{className:"vehicle-count",children:[O.vehicles.length," vehículos"]})]}),a.jsxs("div",{className:"type-metrics",children:[a.jsxs("div",{className:"metric",children:[a.jsx("span",{className:"label",children:"Eficiencia promedio:"}),a.jsxs("span",{className:"value",children:[be(O.avgEfficiency,2)," gal/hr"]})]}),a.jsxs("div",{className:"metric",children:[a.jsx("span",{className:"label",children:"Horas totales:"}),a.jsxs("span",{className:"value",children:[be(O.totalHours,0)," hr"]})]}),a.jsxs("div",{className:"metric",children:[a.jsx("span",{className:"label",children:"Combustible total:"}),a.jsxs("span",{className:"value",children:[be(O.totalFuel,0)," gal"]})]})]})]},I))})]}),a.jsxs("div",{className:"performance-comparison",children:[a.jsxs("div",{className:"performance-section",children:[a.jsx("h4",{children:"🏆 Mejores Rendimientos"}),a.jsx("div",{className:"vehicle-ranking",children:o.topPerformers.map((I,O)=>a.jsxs("div",{className:"ranking-item excellent",children:[a.jsxs("div",{className:"rank",children:["#",O+1]}),a.jsxs("div",{className:"vehicle-info",children:[a.jsx("div",{className:"vehicle-name",children:I.name||I.vehicleId}),a.jsx("div",{className:"vehicle-type",children:I.type})]}),a.jsxs("div",{className:"efficiency-metric",children:[a.jsx("span",{className:"value",children:be(I.actualEfficiency,2)}),a.jsx("span",{className:"unit",children:"gal/hr"})]}),a.jsxs("div",{className:"performance-badge",children:[a.jsx("span",{className:"emoji",children:w(I.performanceRating)}),a.jsx("span",{className:"rating",children:I.performanceRating})]})]},I.vehicleId))})]}),a.jsxs("div",{className:"performance-section",children:[a.jsx("h4",{children:"⚠️ Rendimientos a Mejorar"}),a.jsx("div",{className:"vehicle-ranking",children:o.worstPerformers.map((I,O)=>a.jsxs("div",{className:"ranking-item poor",children:[a.jsxs("div",{className:"rank",children:["#",o.vehicleEfficiency.length-O]}),a.jsxs("div",{className:"vehicle-info",children:[a.jsx("div",{className:"vehicle-name",children:I.name||I.vehicleId}),a.jsx("div",{className:"vehicle-type",children:I.type})]}),a.jsxs("div",{className:"efficiency-metric",children:[a.jsx("span",{className:"value",children:be(I.actualEfficiency,2)}),a.jsx("span",{className:"unit",children:"gal/hr"})]}),a.jsxs("div",{className:"performance-badge",children:[a.jsx("span",{className:"emoji",children:w(I.performanceRating)}),a.jsx("span",{className:"rating",children:I.performanceRating})]})]},I.vehicleId))})]})]}),a.jsxs("div",{className:"detailed-efficiency-table",children:[a.jsx("h4",{children:"📋 Tabla Detallada de Eficiencia"}),a.jsx("div",{className:"table-container",children:a.jsxs("table",{className:"efficiency-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Vehículo"}),a.jsx("th",{children:"Tipo"}),a.jsx("th",{children:"Horas Trabajadas"}),a.jsx("th",{children:"Combustible Consumido"}),a.jsx("th",{children:"Eficiencia Real"}),a.jsx("th",{children:"Eficiencia Estimada"}),a.jsx("th",{children:"Variación"}),a.jsx("th",{children:"Calificación"})]})}),a.jsx("tbody",{children:o.vehicleEfficiency.map(I=>a.jsxs("tr",{children:[a.jsxs("td",{className:"vehicle-cell",children:[a.jsx("div",{className:"vehicle-name",children:I.name||I.vehicleId}),a.jsx("div",{className:"vehicle-status",children:I.status})]}),a.jsx("td",{children:I.type}),a.jsxs("td",{children:[be(I.totalHoursWorked,1)," hr"]}),a.jsxs("td",{children:[be(I.totalFuelConsumed,1)," gal"]}),a.jsx("td",{className:"efficiency-cell",children:a.jsxs("strong",{children:[be(I.actualEfficiency,2)," gal/hr"]})}),a.jsxs("td",{children:[be(I.estimatedEfficiency,2)," gal/hr"]}),a.jsxs("td",{className:`variance-cell ${I.efficiencyVariance>=0?"negative":"positive"}`,children:[I.efficiencyVariance>=0?"+":"",be(I.efficiencyVariance,1),"%"]}),a.jsx("td",{className:"rating-cell",children:a.jsxs("span",{className:"rating-badge",style:{backgroundColor:N(I.performanceRating)},children:[w(I.performanceRating)," ",I.performanceRating]})})]},I.vehicleId))})]})})]})]}):null,S=()=>d?a.jsxs("div",{className:"analysis-section",children:[a.jsxs("div",{className:"analysis-header",children:[a.jsx("h3",{children:"💰 Análisis de Costos Operativos"}),a.jsx("p",{children:"Costo por hora de operación y eficiencia financiera"})]}),a.jsxs("div",{className:"cost-comparison",children:[a.jsxs("div",{className:"cost-section",children:[a.jsx("h4",{children:"💸 Vehículos Más Costosos"}),a.jsx("div",{className:"cost-ranking",children:d.mostExpensive.slice(0,5).map((I,O)=>a.jsxs("div",{className:"cost-item expensive",children:[a.jsxs("div",{className:"rank",children:["#",O+1]}),a.jsxs("div",{className:"vehicle-info",children:[a.jsx("div",{className:"vehicle-name",children:I.name||I.vehicleId}),a.jsx("div",{className:"vehicle-type",children:I.type})]}),a.jsxs("div",{className:"cost-metrics",children:[a.jsxs("div",{className:"cost-per-hour",children:[a.jsx("span",{className:"value",children:Nt(I.costPerHour)}),a.jsx("span",{className:"unit",children:"/hr"})]}),a.jsxs("div",{className:"total-cost",children:["Total: ",Nt(I.totalCost)]})]})]},I.vehicleId))})]}),a.jsxs("div",{className:"cost-section",children:[a.jsx("h4",{children:"💚 Vehículos Más Eficientes"}),a.jsx("div",{className:"cost-ranking",children:d.leastExpensive.slice(0,5).map((I,O)=>a.jsxs("div",{className:"cost-item efficient",children:[a.jsxs("div",{className:"rank",children:["#",O+1]}),a.jsxs("div",{className:"vehicle-info",children:[a.jsx("div",{className:"vehicle-name",children:I.name||I.vehicleId}),a.jsx("div",{className:"vehicle-type",children:I.type})]}),a.jsxs("div",{className:"cost-metrics",children:[a.jsxs("div",{className:"cost-per-hour",children:[a.jsx("span",{className:"value",children:Nt(I.costPerHour)}),a.jsx("span",{className:"unit",children:"/hr"})]}),a.jsxs("div",{className:"total-cost",children:["Total: ",Nt(I.totalCost)]})]})]},I.vehicleId))})]})]}),a.jsxs("div",{className:"detailed-cost-table",children:[a.jsx("h4",{children:"📋 Análisis Detallado de Costos"}),a.jsx("div",{className:"table-container",children:a.jsxs("table",{className:"cost-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Vehículo"}),a.jsx("th",{children:"Tipo"}),a.jsx("th",{children:"Costo Total"}),a.jsx("th",{children:"Horas Trabajadas"}),a.jsx("th",{children:"Costo/Hora"}),a.jsx("th",{children:"Combustible Total"}),a.jsx("th",{children:"Costo/Galón"}),a.jsx("th",{children:"Movimientos"})]})}),a.jsx("tbody",{children:d.vehicleCosts.filter(I=>I.totalCost>0).map(I=>a.jsxs("tr",{children:[a.jsxs("td",{className:"vehicle-cell",children:[a.jsx("div",{className:"vehicle-name",children:I.name||I.vehicleId}),a.jsx("div",{className:"vehicle-status",children:I.status})]}),a.jsx("td",{children:I.type}),a.jsx("td",{className:"cost-cell",children:a.jsx("strong",{children:Nt(I.totalCost)})}),a.jsxs("td",{children:[be(I.totalHours,1)," hr"]}),a.jsx("td",{className:"cost-per-hour-cell",children:a.jsxs("strong",{children:[Nt(I.costPerHour),"/hr"]})}),a.jsxs("td",{children:[be(I.totalFuel,1)," gal"]}),a.jsxs("td",{children:[Nt(I.costPerGallon),"/gal"]}),a.jsx("td",{children:I.movementsCount})]},I.vehicleId))})]})})]})]}):null,q=()=>a.jsxs("div",{className:"analysis-section",children:[a.jsxs("div",{className:"analysis-header",children:[a.jsx("h3",{children:"📈 Análisis de Tendencias"}),a.jsx("p",{children:"Patrones históricos y proyecciones futuras"})]}),a.jsx("div",{className:"trends-placeholder",children:a.jsxs("div",{className:"placeholder-content",children:[a.jsx("h4",{children:"🔮 Próximamente"}),a.jsx("p",{children:"Análisis predictivo y proyecciones de consumo"}),a.jsxs("ul",{children:[a.jsx("li",{children:"📊 Tendencias de consumo por estación"}),a.jsx("li",{children:"📈 Proyecciones de compra automáticas"}),a.jsx("li",{children:"🎯 Optimización de inventario"}),a.jsx("li",{children:"💡 Recomendaciones de mantenimiento"})]})]})})]});return t&&!o&&!d?a.jsxs("div",{className:"dashboard-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Cargando análisis profundo..."})]}):i?a.jsxs("div",{className:"dashboard-error",children:[a.jsx("h3",{children:"Error en Dashboard Analítico"}),a.jsx("p",{children:i}),a.jsx("button",{onClick:n,children:"Reintentar"})]}):a.jsxs("div",{className:"analytical-dashboard",children:[a.jsx("div",{className:"analysis-selector",children:a.jsx("div",{className:"selector-tabs",children:E.map(I=>a.jsxs("button",{className:`selector-tab ${y===I.id?"active":""}`,onClick:()=>b(I.id),disabled:p,children:[a.jsx("span",{className:"tab-icon",children:I.icon}),a.jsxs("div",{className:"tab-info",children:[a.jsx("span",{className:"tab-name",children:I.name}),a.jsx("span",{className:"tab-description",children:I.description})]})]},I.id))})}),a.jsx("div",{className:"analysis-content",children:p?a.jsxs("div",{className:"analytics-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Procesando datos analíticos..."})]}):a.jsxs(a.Fragment,{children:[y==="efficiency"&&T(),y==="costs"&&S(),y==="trends"&&q()]})}),a.jsx("div",{className:"analytics-footer",children:a.jsxs("div",{className:"footer-stats",children:[a.jsxs("div",{className:"stat",children:[a.jsx("span",{className:"label",children:"Vehículos analizados:"}),a.jsx("span",{className:"value",children:o?.vehicleEfficiency?.length||0})]}),a.jsxs("div",{className:"stat",children:[a.jsx("span",{className:"label",children:"Última actualización:"}),a.jsx("span",{className:"value",children:e?e.toLocaleTimeString():"No disponible"})]})]})})]})},t4=()=>{const[n,e]=z.useState("executive"),[t,i]=z.useState(!0),[o,c]=z.useState(null),[d,f]=z.useState(null),[p,g]=z.useState(null),[y,b]=z.useState(null),{inventory:E,movements:j,vehicles:N,loading:w}=Qn(),T=[{id:"executive",name:"Ejecutivo",icon:"📊",description:"KPIs estratégicos y métricas consolidadas"},{id:"operational",name:"Operativo",icon:"⚡",description:"Alertas tiempo real y gestión diaria"},{id:"analytical",name:"Analítico",icon:"🔍",description:"Análisis profundo y reportes detallados"}];z.useEffect(()=>{!w&&E.length>=0&&S()},[w,E,j,N]);const S=async()=>{try{i(!0),c(null);const[U,$]=await Promise.all([$V(),QV()]);f(U),g($),b(new Date)}catch(U){console.error("Error cargando datos de reportes:",U),c("Error al cargar los datos de reportes. Intenta refrescar la página.")}finally{i(!1)}},q=async()=>{await S()},I=U=>{e(U)},O=()=>{const U={executiveData:d,operationalData:p,onRefresh:q,lastRefresh:y,loading:t,error:o};switch(n){case"executive":return a.jsx(K_,{...U});case"operational":return a.jsx(JV,{...U});case"analytical":return a.jsx(e4,{...U});default:return a.jsx(K_,{...U})}};return w?a.jsxs("div",{className:"reports-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Cargando datos del sistema..."})]}):a.jsxs("div",{className:"reports-main",children:[a.jsxs("div",{className:"reports-header",children:[a.jsxs("div",{className:"reports-title-section",children:[a.jsx("h1",{className:"reports-title",children:"📊 Reportes y Analytics"}),a.jsx("p",{className:"reports-subtitle",children:"Panel de control ejecutivo y operativo para la gestión de combustibles"})]}),a.jsxs("div",{className:"reports-actions",children:[a.jsxs("button",{className:"refresh-btn",onClick:q,disabled:t,title:"Actualizar datos",children:[t?"🔄":"↻",t?"Cargando...":"Actualizar"]}),y&&a.jsxs("span",{className:"last-refresh",children:["Última actualización: ",y.toLocaleTimeString()]})]})]}),a.jsx("div",{className:"reports-nav",children:a.jsx("div",{className:"reports-tabs",children:T.map(U=>a.jsxs("button",{className:`tab-button ${n===U.id?"active":""}`,onClick:()=>I(U.id),disabled:t,children:[a.jsx("span",{className:"tab-icon",children:U.icon}),a.jsxs("div",{className:"tab-content",children:[a.jsx("span",{className:"tab-name",children:U.name}),a.jsx("span",{className:"tab-description",children:U.description})]})]},U.id))})}),d&&a.jsxs("div",{className:"reports-status-bar",children:[a.jsxs("div",{className:"status-item",children:[a.jsx("span",{className:"status-label",children:"📦 Inventario:"}),a.jsxs("span",{className:"status-value",children:["$",d.totalInventoryValue?.toLocaleString("es-CO")," COP"]})]}),a.jsxs("div",{className:"status-item",children:[a.jsx("span",{className:"status-label",children:"⚠️ Alertas:"}),a.jsxs("span",{className:`status-value ${d.lowStockAlerts>0?"warning":"success"}`,children:[d.lowStockAlerts," stock bajo"]})]}),a.jsxs("div",{className:"status-item",children:[a.jsx("span",{className:"status-label",children:"🚜 Flota:"}),a.jsxs("span",{className:"status-value",children:[d.fleetAvailability,"% disponible"]})]}),a.jsxs("div",{className:"status-item",children:[a.jsx("span",{className:"status-label",children:"⛽ Eficiencia:"}),a.jsxs("span",{className:"status-value",children:[d.avgFleetEfficiency," gal/hr promedio"]})]})]}),o&&a.jsx("div",{className:"reports-error",children:a.jsxs("div",{className:"error-content",children:[a.jsx("span",{className:"error-icon",children:"⚠️"}),a.jsx("span",{className:"error-message",children:o}),a.jsx("button",{className:"error-retry",onClick:q,children:"Reintentar"})]})}),a.jsx("div",{className:"reports-content",children:O()}),a.jsx("div",{className:"reports-footer",children:a.jsxs("div",{className:"footer-info",children:[a.jsx("span",{children:"Forestech Colombia - Sistema de Gestión de Combustibles"}),a.jsx("span",{children:"|"}),a.jsx("span",{children:"Datos en tiempo real desde Firebase"}),a.jsx("span",{children:"|"}),a.jsxs("span",{children:[E.length," items inventario • ",j.length," movimientos • ",N.length," vehículos"]})]})})]})},n4=()=>{const[n,e]=z.useState("dashboard"),t=()=>{switch(n){case"dashboard":return a.jsx(z_,{});case"inventory":return a.jsx(HL,{});case"movements":return a.jsx(cV,{});case"vehicles":return a.jsx(TV,{});case"maintenance":return a.jsx(OV,{});case"products":return a.jsx(VV,{});case"suppliers":return a.jsx(HV,{});case"reports":return a.jsx(t4,{});case"admin":return a.jsx(GV,{});default:return a.jsx(z_,{})}};return a.jsx(LL,{currentView:n,onViewChange:e,children:t()})},s4=()=>{const[n,e]=z.useState("login"),[t,i]=z.useState(!1),[o,c]=z.useState(""),[d,f]=z.useState(""),[p,g]=z.useState(""),[y,b]=z.useState(""),[E,j]=z.useState({email:"",password:"",confirmPassword:"",invitationCode:""}),[N,w]=z.useState(""),[T,S]=z.useState(null),q=async V=>{V.preventDefault(),i(!0),c("");try{await xR($c,p,y)}catch(P){console.error("Error en login:",P),c($(P.code))}finally{i(!1)}},I=async()=>{i(!0),c("");try{const V=new wa,P=await zR($c,V);T?await P_(P.user,T.code):await TA(P.user)}catch(V){console.error("Error en login con Google:",V),c("Error al iniciar sesión con Google")}finally{i(!1)}},O=async V=>{V.preventDefault(),i(!0),c(""),f("");try{const P=await _A(N);P.success?(S(P.invitation),f(`Invitación válida para: ${P.invitation.targetEmail}`),e("register"),j({...E,email:P.invitation.targetEmail,invitationCode:N})):c(P.error)}catch(P){console.error("Error validando invitación:",P),c("Error validando código de invitación")}finally{i(!1)}},U=async V=>{if(V.preventDefault(),i(!0),c(""),E.password!==E.confirmPassword){c("Las contraseñas no coinciden"),i(!1);return}if(E.password.length<6){c("La contraseña debe tener al menos 6 caracteres"),i(!1);return}try{const P=await yR($c,E.email,E.password),C=await P_(P.user,E.invitationCode);C.success?f("¡Registro exitoso! Bienvenido al sistema."):c(C.error)}catch(P){console.error("Error en registro:",P),c($(P.code))}finally{i(!1)}},$=V=>{switch(V){case"auth/invalid-email":return"El formato del email es inválido";case"auth/user-not-found":return"Usuario no encontrado";case"auth/wrong-password":return"Contraseña incorrecta";case"auth/invalid-credential":return"Email o contraseña incorrectos";case"auth/email-already-in-use":return"Este email ya está registrado";case"auth/weak-password":return"La contraseña es muy débil";default:return"Error de autenticación. Inténtalo de nuevo."}},F=()=>{c(""),f(""),g(""),b(""),w(""),S(null),j({email:"",password:"",confirmPassword:"",invitationCode:""})},R=()=>{switch(n){case"login":return a.jsxs(a.Fragment,{children:[a.jsxs("form",{onSubmit:q,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"email",children:"Email:"}),a.jsx("input",{id:"email",type:"email",value:p,onChange:V=>g(V.target.value),required:!0,disabled:t,placeholder:"tu-email@ejemplo.com"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"password",children:"Contraseña:"}),a.jsx("input",{id:"password",type:"password",value:y,onChange:V=>b(V.target.value),required:!0,disabled:t,placeholder:"Tu contraseña"})]}),a.jsx("button",{type:"submit",className:"auth-button primary",disabled:t,children:t?"Iniciando sesión...":"Iniciar Sesión"})]}),a.jsx("div",{className:"auth-divider",children:a.jsx("span",{children:"o"})}),a.jsxs("button",{onClick:I,className:"auth-button google",disabled:t,children:[a.jsx("span",{children:"🔗"}),"Continuar con Google"]}),a.jsx("div",{className:"auth-actions",children:a.jsx("button",{className:"link-button",onClick:()=>{F(),e("invite")},children:"¿Tienes un código de invitación? Regístrate aquí"})})]});case"invite":return a.jsxs(a.Fragment,{children:[a.jsxs("form",{onSubmit:O,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"inviteCode",children:"Código de invitación:"}),a.jsx("input",{id:"inviteCode",type:"text",value:N,onChange:V=>w(V.target.value.toUpperCase()),required:!0,disabled:t,placeholder:"XXXXXXXX",maxLength:8,style:{textTransform:"uppercase",fontFamily:"monospace"}}),a.jsx("small",{children:"Ingresa el código de 8 caracteres que recibiste"})]}),a.jsx("button",{type:"submit",className:"auth-button primary",disabled:t,children:t?"Validando...":"Validar Código"})]}),a.jsx("div",{className:"auth-actions",children:a.jsx("button",{className:"link-button",onClick:()=>{F(),e("login")},children:"Volver al inicio de sesión"})})]});case"register":return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"invitation-info",children:a.jsxs("div",{className:"success-message",children:["✅ Código válido para: ",T?.targetEmail]})}),a.jsxs("form",{onSubmit:U,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"registerEmail",children:"Email:"}),a.jsx("input",{id:"registerEmail",type:"email",value:E.email,disabled:!0,className:"disabled-input"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"registerPassword",children:"Contraseña:"}),a.jsx("input",{id:"registerPassword",type:"password",value:E.password,onChange:V=>j({...E,password:V.target.value}),required:!0,disabled:t,placeholder:"Mínimo 6 caracteres",minLength:6})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"confirmPassword",children:"Confirmar contraseña:"}),a.jsx("input",{id:"confirmPassword",type:"password",value:E.confirmPassword,onChange:V=>j({...E,confirmPassword:V.target.value}),required:!0,disabled:t,placeholder:"Repite tu contraseña"})]}),a.jsx("button",{type:"submit",className:"auth-button primary",disabled:t,children:t?"Registrando...":"Crear Cuenta"})]}),a.jsx("div",{className:"auth-divider",children:a.jsx("span",{children:"o"})}),a.jsxs("button",{onClick:I,className:"auth-button google",disabled:t,children:[a.jsx("span",{children:"🔗"}),"Registrarse con Google"]}),a.jsx("div",{className:"auth-actions",children:a.jsx("button",{className:"link-button",onClick:()=>{F(),e("invite")},children:"Usar otro código de invitación"})})]});default:return null}};return a.jsx("div",{className:"auth-container",children:a.jsxs("div",{className:"auth-card",children:[a.jsxs("div",{className:"auth-header",children:[a.jsx("h1",{children:"⛽ Combustibles"}),a.jsx("h2",{children:"Forestech Colombia"}),a.jsxs("p",{children:[n==="login"&&"Sistema de gestión de combustibles",n==="invite"&&"Validar código de invitación",n==="register"&&"Crear nueva cuenta"]})]}),a.jsxs("div",{className:"auth-form",children:[o&&a.jsx("div",{className:"error-message",children:o}),d&&a.jsx("div",{className:"success-message",children:d}),R(),a.jsx("div",{className:"auth-footer",children:a.jsx("p",{children:a.jsxs("small",{children:["Solo usuarios autorizados pueden acceder al sistema.",a.jsx("br",{}),n==="login"?"Contacta al administrador para obtener un código de invitación.":"Si no tienes código, contacta al administrador."]})})})]})]})})};function a4(){return a.jsx(PL,{children:a.jsx(i4,{})})}function i4(){const{user:n,loading:e}=Qn();return e?a.jsx("div",{className:"loading-container",children:a.jsxs("div",{className:"loader",children:[a.jsx("div",{className:"spinner"}),a.jsx("p",{children:"Cargando..."})]})}):a.jsxs("div",{className:"App",children:[!n&&a.jsx(s4,{}),n&&a.jsx(n4,{})]})}Vw.createRoot(document.getElementById("root")).render(a.jsx(z.StrictMode,{children:a.jsx(a4,{})}));
